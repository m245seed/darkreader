# Codebase Analysis for: src

## Directory Structure

```
└── src
    ├── api
    │   ├── tsconfig.json (97 bytes)
    │   ├── index.ts (2526 bytes)
    │   ├── fetch.ts (829 bytes)
    │   └── chrome.ts (2123 bytes)
    ├── background
    │   ├── utils
    │   │   ├── sendLog.ts (829 bytes)
    │   │   ├── extension-api.ts (6640 bytes)
    │   │   ├── network.ts (7499 bytes)
    │   │   ├── log.ts (1097 bytes)
    │   │   └── tab.ts (468 bytes)
    │   ├── tab-manager.ts (22323 bytes)
    │   ├── user-storage.ts (9982 bytes)
    │   ├── newsmaker.ts (7442 bytes)
    │   ├── index.ts (9521 bytes)
    │   ├── config-manager.ts (8698 bytes)
    │   ├── ui-highlights.ts (877 bytes)
    │   ├── content-script-manager.ts (3886 bytes)
    │   ├── icon-manager.ts (3639 bytes)
    │   ├── extension.ts (32089 bytes)
    │   ├── devtools.ts (8584 bytes)
    │   ├── messenger.ts (8214 bytes)
    │   ├── make-chromium-happy.ts (61 bytes)
    │   └── window-theme.ts (3268 bytes)
    ├── config
    │   ├── detector-hints.config (7945 bytes)
    │   ├── dark-sites.config (19177 bytes)
    │   ├── color-schemes.drconf (1940 bytes)
    │   ├── dynamic-theme-fixes.config (675243 bytes)
    │   ├── static-themes.config (2850 bytes)
    │   └── inversion-fixes.config (44353 bytes)
    ├── generators
    │   ├── utils
    │   │   ├── parse.ts (14839 bytes)
    │   │   ├── matrix.ts (3032 bytes)
    │   │   └── format.ts (1238 bytes)
    │   ├── theme-engines.ts (153 bytes)
    │   ├── text-style.ts (1227 bytes)
    │   ├── svg-filter.ts (1904 bytes)
    │   ├── static-theme.ts (12248 bytes)
    │   ├── dynamic-theme.ts (3707 bytes)
    │   ├── detector-hints.ts (2272 bytes)
    │   └── css-filter.ts (9336 bytes)
    ├── icons
    │   ├── dr_active_light_19.png (686 bytes)
    │   ├── dr_active_light_38.png (1694 bytes)
    │   ├── dr_active_38.png (1522 bytes)
    │   ├── dr_active_19.png (615 bytes)
    │   ├── dr_48.png (2289 bytes)
    │   ├── dr_16.png (608 bytes)
    │   └── dr_128.png (7950 bytes)
    ├── inject
    │   ├── dynamic-theme
    │   │   ├── watch
    │   │   │   ├── style-position.ts (8676 bytes)
    │   │   │   ├── sheet-changes.ts (3350 bytes)
    │   │   │   ├── index.ts (635 bytes)
    │   │   │   └── custom-elements.ts (4656 bytes)
    │   │   ├── adopted-style-manger.ts (9995 bytes)
    │   │   ├── variables.ts (29577 bytes)
    │   │   ├── stylesheet-proxy.ts (28561 bytes)
    │   │   ├── stylesheet-modifier.ts (14509 bytes)
    │   │   ├── style-scope.ts (695 bytes)
    │   │   ├── style-manager.ts (691 bytes)
    │   │   ├── palette.ts (2940 bytes)
    │   │   ├── network.ts (1329 bytes)
    │   │   ├── mv3-proxy.ts (2538 bytes)
    │   │   ├── modify-css.ts (14606 bytes)
    │   │   ├── modify-colors.ts (9672 bytes)
    │   │   ├── meta-theme-color.ts (1945 bytes)
    │   │   ├── inline-style.ts (20236 bytes)
    │   │   ├── injection.ts (735 bytes)
    │   │   ├── index.ts (31861 bytes)
    │   │   ├── image.ts (10714 bytes)
    │   │   ├── fixes.ts (2523 bytes)
    │   │   ├── css-rules.ts (8734 bytes)
    │   │   └── css-collection.ts (2876 bytes)
    │   ├── utils
    │   │   ├── log.ts (1738 bytes)
    │   │   └── dom.ts (12905 bytes)
    │   ├── detector.ts (8115 bytes)
    │   ├── color-scheme-watcher.ts (2184 bytes)
    │   ├── cache.ts (2884 bytes)
    │   ├── svg-filter.ts (2746 bytes)
    │   ├── style.ts (1350 bytes)
    │   ├── index.ts (13343 bytes)
    │   └── fallback.ts (2351 bytes)
    ├── stubs
    │   ├── popup
    │   │   └── plus-body.tsx (100 bytes)
    │   ├── utils
    │   │   └── theme.ts (705 bytes)
    │   └── defaults.ts (112 bytes)
    ├── ui
    │   ├── assets
    │   │   ├── fonts
    │   │   │   ├── OpenSans-SemiBold.ttf (100820 bytes)
    │   │   │   ├── OpenSans-Regular.ttf (96932 bytes)
    │   │   │   ├── OpenSans-Light.ttf (101696 bytes)
    │   │   │   └── LICENSE.txt (11358 bytes)
    │   │   └── images
    │   │       ├── mode-light-32.svg (9342 bytes)
    │   │       ├── mode-dark-32.svg (9003 bytes)
    │   │       ├── mobile-qr-code.png (513 bytes)
    │   │       ├── mobile-qr-code-firefox.png (609 bytes)
    │   │       ├── mobile-icon-40x64.svg (10104 bytes)
    │   │       ├── icon-apple-white.svg (1122 bytes)
    │   │       ├── icon-android-dark.svg (728 bytes)
    │   │       ├── darkreader-type.svg (3292 bytes)
    │   │       ├── darkreader-icon-256x256.png (16484 bytes)
    │   │       └── birthday-icon.svg (7623 bytes)
    │   ├── connect
    │   │   ├── mock.ts (2925 bytes)
    │   │   └── connector.ts (6592 bytes)
    │   ├── controls
    │   │   ├── button
    │   │   │   ├── style.less (772 bytes)
    │   │   │   └── index.tsx (438 bytes)
    │   │   ├── check-button
    │   │   │   ├── check-button.tsx (873 bytes)
    │   │   │   └── check-button.less (1109 bytes)
    │   │   ├── checkbox
    │   │   │   ├── style.less (1613 bytes)
    │   │   │   └── index.tsx (798 bytes)
    │   │   ├── color-dropdown
    │   │   │   ├── style.less (443 bytes)
    │   │   │   └── index.tsx (2889 bytes)
    │   │   ├── color-picker
    │   │   │   ├── index.tsx (4150 bytes)
    │   │   │   ├── hsb-picker.tsx (7890 bytes)
    │   │   │   ├── hsb-picker.less (1313 bytes)
    │   │   │   └── style.less (2436 bytes)
    │   │   ├── control-group
    │   │   │   ├── control-group.tsx (760 bytes)
    │   │   │   └── control-group.less (423 bytes)
    │   │   ├── dropdown
    │   │   │   ├── style.less (2532 bytes)
    │   │   │   └── index.tsx (3424 bytes)
    │   │   ├── message-box
    │   │   │   ├── style.less (638 bytes)
    │   │   │   └── index.tsx (1084 bytes)
    │   │   ├── multi-switch
    │   │   │   ├── index.tsx (1089 bytes)
    │   │   │   └── style.less (1000 bytes)
    │   │   ├── nav-button
    │   │   │   ├── style.less (364 bytes)
    │   │   │   └── index.tsx (469 bytes)
    │   │   ├── overlay
    │   │   │   ├── style.less (337 bytes)
    │   │   │   └── index.ts (1674 bytes)
    │   │   ├── reset-button
    │   │   │   ├── style.less (454 bytes)
    │   │   │   └── index.tsx (500 bytes)
    │   │   ├── select
    │   │   │   ├── style.less (2246 bytes)
    │   │   │   └── index.tsx (4779 bytes)
    │   │   ├── shortcut
    │   │   │   ├── style.less (687 bytes)
    │   │   │   └── index.tsx (6775 bytes)
    │   │   ├── slider
    │   │   │   ├── style.less (2938 bytes)
    │   │   │   └── index.tsx (7758 bytes)
    │   │   ├── tab-panel
    │   │   │   ├── tab.tsx (351 bytes)
    │   │   │   ├── style.less (1941 bytes)
    │   │   │   └── index.tsx (1334 bytes)
    │   │   ├── text-list
    │   │   │   ├── index.tsx (2667 bytes)
    │   │   │   └── style.less (983 bytes)
    │   │   ├── textbox
    │   │   │   ├── style.less (959 bytes)
    │   │   │   └── index.tsx (582 bytes)
    │   │   ├── time-range-picker
    │   │   │   ├── index.tsx (2427 bytes)
    │   │   │   └── style.less (374 bytes)
    │   │   ├── toggle
    │   │   │   ├── index.tsx (1130 bytes)
    │   │   │   └── style.less (1068 bytes)
    │   │   ├── updown
    │   │   │   ├── index.tsx (2521 bytes)
    │   │   │   ├── style.less (2880 bytes)
    │   │   │   └── track.tsx (2269 bytes)
    │   │   ├── virtual-scroll
    │   │   │   └── index.tsx (4345 bytes)
    │   │   ├── utils.ts (846 bytes)
    │   │   ├── style.less (636 bytes)
    │   │   └── index.ts (1138 bytes)
    │   ├── devtools
    │   │   ├── components
    │   │   │   ├── body.tsx (3637 bytes)
    │   │   │   ├── dynamic-per-site.tsx (5174 bytes)
    │   │   │   ├── config-editor.tsx (4223 bytes)
    │   │   │   └── dynamic-mode-editor.tsx (1308 bytes)
    │   │   ├── style.less (4386 bytes)
    │   │   ├── types.d.ts (133 bytes)
    │   │   └── index.tsx (4238 bytes)
    │   ├── icons
    │   │   ├── help-icon.tsx (382 bytes)
    │   │   ├── delete-icon.tsx (650 bytes)
    │   │   ├── advanced-icon.tsx (1074 bytes)
    │   │   ├── icons.less (3967 bytes)
    │   │   ├── phone-icon.tsx (341 bytes)
    │   │   ├── index.tsx (542 bytes)
    │   │   ├── watch-icon.tsx (1457 bytes)
    │   │   ├── system-icon.tsx (324 bytes)
    │   │   ├── list-icon.tsx (276 bytes)
    │   │   ├── sun-moon-icon.tsx (1879 bytes)
    │   │   ├── settings-icon.tsx (912 bytes)
    │   │   └── keyboard-icon.tsx (695 bytes)
    │   ├── options
    │   │   ├── about
    │   │   │   ├── version.tsx (358 bytes)
    │   │   │   ├── about-tab.tsx (1570 bytes)
    │   │   │   └── about.less (126 bytes)
    │   │   ├── advanced
    │   │   │   ├── advanced-tab.tsx (874 bytes)
    │   │   │   ├── advanced.less (197 bytes)
    │   │   │   ├── import-settings.tsx (2854 bytes)
    │   │   │   ├── fetch-news.tsx (651 bytes)
    │   │   │   ├── sync-config.tsx (618 bytes)
    │   │   │   ├── sync-settings.tsx (667 bytes)
    │   │   │   ├── export-settings.tsx (845 bytes)
    │   │   │   ├── enable-for-protected-pages.tsx (746 bytes)
    │   │   │   ├── reset-settings.tsx (1365 bytes)
    │   │   │   ├── context-menus.tsx (1710 bytes)
    │   │   │   └── devtools.tsx (744 bytes)
    │   │   ├── automation
    │   │   │   ├── automation-tab.tsx (7455 bytes)
    │   │   │   └── automation.less (2511 bytes)
    │   │   ├── body
    │   │   │   └── body.tsx (2609 bytes)
    │   │   ├── general
    │   │   │   ├── change-browser-theme.tsx (694 bytes)
    │   │   │   ├── general-tab.tsx (662 bytes)
    │   │   │   ├── enabled-for-pdf.tsx (654 bytes)
    │   │   │   ├── detect-dark-theme.tsx (696 bytes)
    │   │   │   └── enabled-by-default.tsx (699 bytes)
    │   │   ├── hotkeys
    │   │   │   ├── hotkeys-tab.tsx (1716 bytes)
    │   │   │   └── hotkeys.less (692 bytes)
    │   │   ├── site-list
    │   │   │   ├── site-list.tsx (3739 bytes)
    │   │   │   ├── site-list.less (2227 bytes)
    │   │   │   ├── clear-site-list.tsx (1672 bytes)
    │   │   │   └── site-list-tab.tsx (994 bytes)
    │   │   ├── tab-panel
    │   │   │   ├── tab-panel.tsx (2315 bytes)
    │   │   │   └── tab-panel.less (1790 bytes)
    │   │   ├── style.less (1570 bytes)
    │   │   └── index.tsx (2110 bytes)
    │   ├── popup
    │   │   ├── body
    │   │   │   ├── style.less (5496 bytes)
    │   │   │   └── index.tsx (3809 bytes)
    │   │   ├── components
    │   │   │   ├── custom-settings-toggle
    │   │   │   │   ├── style.less (713 bytes)
    │   │   │   │   └── index.tsx (1911 bytes)
    │   │   │   ├── engine-switch
    │   │   │   │   ├── style.less (1031 bytes)
    │   │   │   │   └── index.tsx (1558 bytes)
    │   │   │   ├── filter-settings
    │   │   │   │   ├── mode-toggle.tsx (1278 bytes)
    │   │   │   │   ├── style.less (1262 bytes)
    │   │   │   │   └── index.tsx (2485 bytes)
    │   │   │   ├── font-settings
    │   │   │   │   ├── style.less (706 bytes)
    │   │   │   │   └── index.tsx (2063 bytes)
    │   │   │   ├── header
    │   │   │   │   ├── more-new-highlight.tsx (831 bytes)
    │   │   │   │   ├── index.tsx (5861 bytes)
    │   │   │   │   ├── more-site-settings.tsx (5090 bytes)
    │   │   │   │   ├── more-toggle-settings.tsx (8683 bytes)
    │   │   │   │   └── style.less (10163 bytes)
    │   │   │   ├── loader
    │   │   │   │   ├── index.tsx (1572 bytes)
    │   │   │   │   └── style.less (2241 bytes)
    │   │   │   ├── more-settings
    │   │   │   │   ├── index.tsx (3657 bytes)
    │   │   │   │   └── style.less (1168 bytes)
    │   │   │   ├── news
    │   │   │   │   ├── style.less (6179 bytes)
    │   │   │   │   ├── index.tsx (3616 bytes)
    │   │   │   │   └── mobile-links.tsx (3340 bytes)
    │   │   │   ├── site-list-settings
    │   │   │   │   ├── index.tsx (2025 bytes)
    │   │   │   │   └── style.less (355 bytes)
    │   │   │   ├── site-toggle
    │   │   │   │   ├── style.less (430 bytes)
    │   │   │   │   ├── index.tsx (2018 bytes)
    │   │   │   │   └── checkmark-icon.tsx (368 bytes)
    │   │   │   └── body.tsx (9478 bytes)
    │   │   ├── main-page
    │   │   │   ├── theme-group.tsx (1885 bytes)
    │   │   │   ├── site-toggle.tsx (2087 bytes)
    │   │   │   ├── app-switch.tsx (3669 bytes)
    │   │   │   ├── style.less (2750 bytes)
    │   │   │   ├── help.tsx (618 bytes)
    │   │   │   └── index.tsx (1272 bytes)
    │   │   ├── news-section
    │   │   │   ├── index.tsx (3269 bytes)
    │   │   │   └── style.less (3510 bytes)
    │   │   ├── page-viewer
    │   │   │   ├── style.less (653 bytes)
    │   │   │   └── index.tsx (1350 bytes)
    │   │   ├── theme
    │   │   │   ├── controls
    │   │   │   │   ├── style-system-controls.tsx (554 bytes)
    │   │   │   │   ├── reset-button.tsx (739 bytes)
    │   │   │   │   ├── sepia.tsx (636 bytes)
    │   │   │   │   ├── mode.tsx (1481 bytes)
    │   │   │   │   ├── grayscale.tsx (644 bytes)
    │   │   │   │   ├── index.tsx (1048 bytes)
    │   │   │   │   ├── immediate-modify.tsx (545 bytes)
    │   │   │   │   ├── color-scheme.tsx (691 bytes)
    │   │   │   │   ├── font-picker.tsx (1034 bytes)
    │   │   │   │   ├── mode.less (713 bytes)
    │   │   │   │   ├── theme-control.less (557 bytes)
    │   │   │   │   ├── export-theme.tsx (2051 bytes)
    │   │   │   │   ├── brightness.tsx (647 bytes)
    │   │   │   │   ├── contrast.tsx (643 bytes)
    │   │   │   │   ├── format.ts (73 bytes)
    │   │   │   │   ├── background-color.tsx (674 bytes)
    │   │   │   │   ├── use-font.tsx (532 bytes)
    │   │   │   │   ├── theme-control.tsx (323 bytes)
    │   │   │   │   ├── text-stroke.tsx (522 bytes)
    │   │   │   │   ├── text-color.tsx (672 bytes)
    │   │   │   │   ├── scrollbar.tsx (743 bytes)
    │   │   │   │   ├── scheme.tsx (654 bytes)
    │   │   │   │   └── selection.tsx (748 bytes)
    │   │   │   ├── page
    │   │   │   │   ├── collapsible-panel.less (1356 bytes)
    │   │   │   │   ├── index.tsx (7517 bytes)
    │   │   │   │   ├── collapsible-panel.tsx (2214 bytes)
    │   │   │   │   └── style.less (3674 bytes)
    │   │   │   ├── preset-picker
    │   │   │   │   ├── style.less (1241 bytes)
    │   │   │   │   └── index.tsx (5464 bytes)
    │   │   │   └── utils.ts (1682 bytes)
    │   │   ├── utils
    │   │   │   ├── issues.ts (732 bytes)
    │   │   │   └── markdown.tsx (183 bytes)
    │   │   ├── style.less (7035 bytes)
    │   │   ├── compatibility.js (1584 bytes)
    │   │   └── index.tsx (5244 bytes)
    │   ├── stylesheet-editor
    │   │   ├── components
    │   │   │   └── body.tsx (2874 bytes)
    │   │   ├── index.tsx (671 bytes)
    │   │   └── style.less (29 bytes)
    │   ├── theme.less (1112 bytes)
    │   ├── utils.ts (7077 bytes)
    │   └── shared.less (1569 bytes)
    ├── utils
    │   ├── css-text
    │   │   ├── parse-gradient.ts (3341 bytes)
    │   │   ├── format-css.ts (2673 bytes)
    │   │   ├── parse-css.ts (3897 bytes)
    │   │   └── css-text.ts (160 bytes)
    │   ├── array.ts (1156 bytes)
    │   ├── visibility.ts (3253 bytes)
    │   ├── uid.ts (584 bytes)
    │   ├── url.ts (10789 bytes)
    │   ├── time.ts (9113 bytes)
    │   ├── throttle.ts (2076 bytes)
    │   ├── tabs.ts (1973 bytes)
    │   ├── text.ts (4855 bytes)
    │   ├── state-manager.ts (1334 bytes)
    │   ├── state-manager-impl.ts (13997 bytes)
    │   ├── promise-barrier.ts (1712 bytes)
    │   ├── platform.ts (4319 bytes)
    │   ├── network.ts (1843 bytes)
    │   ├── message.ts (2298 bytes)
    │   ├── media-query.ts (1534 bytes)
    │   ├── math.ts (1279 bytes)
    │   ├── math-eval.ts (3774 bytes)
    │   ├── locales.ts (622 bytes)
    │   ├── links.ts (1513 bytes)
    │   ├── debounce.ts (407 bytes)
    │   ├── csp.ts (1473 bytes)
    │   ├── colorscheme-parser.ts (9433 bytes)
    │   ├── cache.ts (455 bytes)
    │   ├── automation.ts (114 bytes)
    │   ├── color.ts (15925 bytes)
    │   ├── async-queue.ts (971 bytes)
    │   └── validation.ts (9931 bytes)
    ├── _locales
    │   ├── en-GB.config (3839 bytes)
    │   ├── en-US.config (3835 bytes)
    │   └── en.config (3835 bytes)
    ├── tsconfig.json (633 bytes)
    ├── manifest.json (1648 bytes)
    ├── manifest-chrome-mv3.json (2012 bytes)
    ├── definitions.d.ts (6379 bytes)
    └── defaults.ts (3120 bytes)

```

## Summary

Total directories        : 80
Total analyzed size      : 2045.72 KB
Total tokens             : 3276
Total text content size  : 13.47 KB

## File Contents

### api\tsconfig.json

```
{
    "extends": "../tsconfig.json",
    "compilerOptions": {
        "target": "ES2020"
    }
}

```

### api\index.ts

```
import './chrome';
import {DEFAULT_THEME} from '../defaults';
import type {Theme, DynamicThemeFix} from '../definitions';
import {ThemeEngine} from '../generators/theme-engines';
import {createOrUpdateDynamicThemeInternal, removeDynamicTheme} from '../inject/dynamic-theme';
import {collectCSS} from '../inject/dynamic-theme/css-collection';
import {isMatchMediaChangeEventListenerSupported} from '../utils/platform';

import {setFetchMethod as setFetch} from './fetch';

let isDarkReaderEnabled = false;
const isIFrame = (() => {
    try {
        return window.self !== window.top;
    } catch (err) {
        console.warn(err);
        return true;
    }
})();

export function enable(themeOptions: Partial<Theme> | null = {}, fixes: DynamicThemeFix | null = null): void {
    const theme = {...DEFAULT_THEME, ...themeOptions};

    if (theme.engine !== ThemeEngine.dynamicTheme) {
        throw new Error('Theme engine is not supported.');
    }
    // TODO: replace with createOrUpdateDynamicTheme() and make fixes signature
    // DynamicThemeFix | DynamicThemeFix[]
    createOrUpdateDynamicThemeInternal(theme, fixes, isIFrame);
    isDarkReaderEnabled = true;
}

export function isEnabled(): boolean {
    return isDarkReaderEnabled;
}

export function disable(): void {
    removeDynamicTheme();
    isDarkReaderEnabled = false;
}

const darkScheme = typeof(matchMedia) === 'function' ? matchMedia('(prefers-color-scheme: dark)') : undefined;
let store = {
    themeOptions: null as Partial<Theme> | null,
    fixes: null as DynamicThemeFix | null,
};

function handleColorScheme(): void {
    if (darkScheme?.matches) {
        enable(store.themeOptions, store.fixes);
    } else {
        disable();
    }
}

export function auto(themeOptions: Partial<Theme> | false = {}, fixes: DynamicThemeFix | null = null): void {
    if (themeOptions) {
        store = {themeOptions, fixes};
        handleColorScheme();
        if (isMatchMediaChangeEventListenerSupported) {
            darkScheme?.addEventListener('change', handleColorScheme);
        } else {
            darkScheme?.addListener(handleColorScheme);
        }
    } else {
        if (isMatchMediaChangeEventListenerSupported) {
            darkScheme?.removeEventListener('change', handleColorScheme);
        } else {
            darkScheme?.removeListener(handleColorScheme);
        }
        disable();
    }
}

export async function exportGeneratedCSS(): Promise<string> {
    return await collectCSS();
}

export const setFetchMethod = setFetch;

```

### api\fetch.ts

```
const throwCORSError = async (url: string) => {
    return Promise.reject(new Error(
        [
            'Embedded Dark Reader cannot access a cross-origin resource',
            url,
            'Overview your URLs and CORS policies or use',
            '`DarkReader.setFetchMethod(fetch: (url) => Promise<Response>))`.',
            'See if using `DarkReader.setFetchMethod(window.fetch)`',
            'before `DarkReader.enable()` works.',
        ].join(' '),
    ));
};

type Fetcher = (url: string) => Promise<Response>;

let fetcher: Fetcher = throwCORSError;

export function setFetchMethod(fetch: Fetcher): void {
    if (fetch) {
        fetcher = fetch;
    } else {
        fetcher = throwCORSError;
    }
}

export async function callFetchMethod(url: string): Promise<Response> {
    return await fetcher(url);
}

```

### api\chrome.ts

```
import type {MessageBGtoCS} from '../definitions';
import {MessageTypeCStoBG, MessageTypeBGtoCS} from '../utils/message';
import {readResponseAsDataURL} from '../utils/network';

import {callFetchMethod} from './fetch';

if (!window.chrome) {
    window.chrome = {} as any;
}
if (!chrome.runtime) {
    chrome.runtime = {} as any;
}

const messageListeners = new Set<(message: MessageBGtoCS) => void>();

async function sendMessage(...args: any[]) {
    if (args[0] && args[0].type === MessageTypeCStoBG.FETCH) {
        const {id} = args[0];
        try {
            const {url, responseType} = args[0].data;
            const response = await callFetchMethod(url);
            let text: string;
            if (responseType === 'data-url') {
                text = await readResponseAsDataURL(response);
            } else {
                text = await response.text();
            }
            messageListeners.forEach((cb) => cb({type: MessageTypeBGtoCS.FETCH_RESPONSE, data: text, error: null, id}));
        } catch (error) {
            console.error(error);
            messageListeners.forEach((cb) => cb({type: MessageTypeBGtoCS.FETCH_RESPONSE, data: null, error, id}));
        }
    }
}

function addMessageListener(callback: (data: any) => void) {
    messageListeners.add(callback);
}

if (typeof chrome.runtime.sendMessage === 'function') {
    const nativeSendMessage = chrome.runtime.sendMessage;
    (chrome.runtime.sendMessage as unknown) = (...args: any[]) => {
        sendMessage(...args);
        nativeSendMessage.apply(chrome.runtime, args);
    };
} else {
    chrome.runtime.sendMessage = sendMessage;
}

if (!chrome.runtime.onMessage) {
    chrome.runtime.onMessage = {} as any;
}
if (typeof chrome.runtime.onMessage.addListener === 'function') {
    const nativeAddListener = chrome.runtime.onMessage.addListener;
    chrome.runtime.onMessage.addListener = (...args: any[]) => {
        addMessageListener(args[0]);
        nativeAddListener.apply(chrome.runtime.onMessage, args);
    };
} else {
    chrome.runtime.onMessage.addListener = (...args: any[]) => addMessageListener(args[0]);
}

```

### background\utils\sendLog.ts

```
declare const __DEBUG__: boolean;
declare const __LOG__: 'info' | 'warn' | 'assert';

let socket: WebSocket | null = null;
let messageQueue: string[] = [];
function createSocket(): void {
    if (socket) {
        return;
    }
    const newSocket = new WebSocket(`ws://localhost:${9000}`);
    socket = newSocket;
    newSocket.addEventListener('open', () => {
        messageQueue.forEach((message) => newSocket.send(message));
        messageQueue = [];
    });
}

export function sendLog(level: 'info' | 'warn' | 'assert', ...args: any[]): void {
    if (!__DEBUG__ || !__LOG__) {
        return;
    }
    const message = JSON.stringify({level, log: args});
    if (socket && socket.readyState === socket.OPEN) {
        socket.send(message);
    } else {
        createSocket();
        messageQueue.push(message);
    }
}

```

### background\utils\extension-api.ts

```
import {isFirefox, isEdge} from '../../utils/platform';
import {getDuration} from '../../utils/time';
import {isPDF} from '../../utils/url';

export function canInjectScript(url: string | null | undefined): boolean {
    if (url === 'about:blank') {
        return false;
    }
    if (isFirefox) {
        return Boolean(url
            && !url.startsWith('about:')
            && !url.startsWith('moz')
            && !url.startsWith('view-source:')
            && !url.startsWith('resource:')
            && !url.startsWith('chrome:')
            && !url.startsWith('jar:')
            && !url.startsWith('https://addons.mozilla.org/')
            && !isPDF(url)
        );
    }
    if (isEdge) {
        return Boolean(url
            && !url.startsWith('chrome')
            && !url.startsWith('data')
            && !url.startsWith('devtools')
            && !url.startsWith('edge')
            && !url.startsWith('https://chrome.google.com/webstore')
            && !url.startsWith('https://chromewebstore.google.com/')
            && !url.startsWith('https://microsoftedge.microsoft.com/addons')
            && !url.startsWith('view-source')
        );
    }
    return Boolean(url
        && !url.startsWith('chrome')
        && !url.startsWith('https://chrome.google.com/webstore')
        && !url.startsWith('https://chromewebstore.google.com/')
        && !url.startsWith('data')
        && !url.startsWith('devtools')
        && !url.startsWith('view-source')
    );
}

export async function readSyncStorage<T extends {[key: string]: any}>(defaults: T): Promise<T | null> {
    return new Promise<T | null>((resolve) => {
        chrome.storage.sync.get(null, (sync: any) => {
            if (chrome.runtime.lastError) {
                console.error(chrome.runtime.lastError.message);
                resolve(null);
                return;
            }

            for (const key in sync) {
                // Just to be sure: https://github.com/darkreader/darkreader/issues/7270
                // The value of sync[key] shouldn't be null.
                if (!sync[key]) {
                    continue;
                }
                const metaKeysCount = sync[key].__meta_split_count;
                if (!metaKeysCount) {
                    continue;
                }

                let string = '';
                for (let i = 0; i < metaKeysCount; i++) {
                    string += sync[`${key}_${i.toString(36)}`];
                    delete sync[`${key}_${i.toString(36)}`];
                }
                try {
                    sync[key] = JSON.parse(string);
                } catch (error) {
                    console.error(`sync[${key}]: Could not parse record from sync storage: ${string}`);
                    resolve(null);
                    return;
                }
            }

            sync = {
                ...defaults,
                ...sync,
            };

            resolve(sync);
        });
    });
}

export async function readLocalStorage<T extends {[key: string]: any}>(defaults: T): Promise<T> {
    return new Promise<T>((resolve) => {
        chrome.storage.local.get(defaults, (local: T) => {
            if (chrome.runtime.lastError) {
                console.error(chrome.runtime.lastError.message);
                resolve(defaults);
                return;
            }
            resolve(local);
        });
    });
}

function prepareSyncStorage<T extends {[key: string]: any}>(values: T): {[key: string]: any} {
    for (const key in values) {
        const value = values[key];
        const string = JSON.stringify(value);
        // The maximum size of any one item that each extension is allowed to store in the sync storage area,
        // as measured by the JSON stringification of the item's value plus the length of its key.
        // Source: https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/storage/sync
        const totalLength = string.length + key.length;
        if (totalLength > chrome.storage.sync.QUOTA_BYTES_PER_ITEM) {
            // This length limit permits us to store up to 1000 = (parseInt('rr', 36) + 1) records.
            const maxLength = chrome.storage.sync.QUOTA_BYTES_PER_ITEM - key.length - 1 - 2;
            const minimalKeysNeeded = Math.ceil(string.length / maxLength);
            for (let i = 0; i < minimalKeysNeeded; i++) {
                (values as any)[`${key}_${i.toString(36)}`] = string.substring(i * maxLength, (i + 1) * maxLength);
            }
            (values as any)[key] = {
                __meta_split_count: minimalKeysNeeded,
            };
        }
    }
    return values;
}

export async function writeSyncStorage<T extends {[key: string]: any}>(values: T): Promise<void> {
    return new Promise<void>((resolve, reject) => {
        const packaged = prepareSyncStorage(values);
        chrome.storage.sync.set(packaged, () => {
            if (chrome.runtime.lastError) {
                reject(chrome.runtime.lastError);
                return;
            }
            resolve();
        });
    });
}

export async function writeLocalStorage<T extends {[key: string]: any}>(values: T): Promise<void> {
    return new Promise<void>((resolve) => {
        chrome.storage.local.set(values, () => {
            resolve();
        });
    });
}

export async function removeSyncStorage(keys: string[]): Promise<void> {
    return new Promise<void>((resolve) => {
        chrome.storage.sync.remove(keys, () => {
            resolve();
        });
    });
}

export async function removeLocalStorage(keys: string[]): Promise<void> {
    return new Promise<void>((resolve) => {
        chrome.storage.local.remove(keys, () => {
            resolve();
        });
    });
}

export async function getCommands(): Promise<chrome.commands.Command[]> {
    return new Promise<chrome.commands.Command[]>((resolve) => {
        if (!chrome.commands) {
            resolve([]);
            return;
        }
        chrome.commands.getAll((commands) => {
            if (commands) {
                resolve(commands);
            } else {
                resolve([]);
            }
        });
    });
}

export function keepListeningToEvents(): () => void {
    let intervalId = 0;
    const keepHopeAlive = () => {
        intervalId = setInterval(chrome.runtime.getPlatformInfo, getDuration({seconds: 10}));
    };
    chrome.runtime.onStartup.addListener(keepHopeAlive);
    keepHopeAlive();
    const stopListening = () => {
        clearInterval(intervalId);
        chrome.runtime.onStartup.removeListener(keepHopeAlive);
    };
    return stopListening;
}

```

### background\utils\network.ts

```
import {loadAsDataURL, loadAsText} from '../../utils/network';
import {isXMLHttpRequestSupported, isFetchSupported} from '../../utils/platform';
import {getStringSize} from '../../utils/text';
import {getDuration} from '../../utils/time';

declare const __TEST__: boolean;

interface RequestParams {
    url: string;
    timeout?: number;
}

interface FileLoader {
    get: (fetchRequestParameters: FetchRequestParameters) => Promise<string | null>;
}

export async function readText(params: RequestParams): Promise<string> {
    return new Promise((resolve, reject) => {
        if (isXMLHttpRequestSupported) {
            // Use XMLHttpRequest if it is available
            const request = new XMLHttpRequest();
            request.overrideMimeType('text/plain');
            request.open('GET', params.url, true);
            request.onload = () => {
                if (request.status >= 200 && request.status < 300) {
                    resolve(request.responseText);
                } else {
                    reject(new Error(`${request.status}: ${request.statusText}`));
                }
            };
            request.onerror = () => reject(new Error(`${request.status}: ${request.statusText}`));
            if (params.timeout) {
                request.timeout = params.timeout;
                request.ontimeout = () => reject(new Error('File loading stopped due to timeout'));
            }
            request.send();
        } else if (isFetchSupported) {
            // XMLHttpRequest is not available in Service Worker contexts like
            // Manifest V3 background context
            let abortController: AbortController;
            let signal: AbortSignal | undefined;
            let timedOut = false;
            if (params.timeout) {
                abortController = new AbortController();
                signal = abortController.signal;
                setTimeout(() => {
                    abortController.abort();
                    timedOut = true;
                }, params.timeout);
            }

            fetch(params.url, {signal})
                .then((response) => {
                    if (response.status >= 200 && (response.status < 300)) {
                        resolve(response.text());
                    } else {
                        reject(new Error(`${response.status}: ${response.statusText}`));
                    }
                }).catch((error) => {
                    if (timedOut) {
                        reject(new Error('File loading stopped due to timeout'));
                    } else {
                        reject(error);
                    }
                });
        } else {
            reject(new Error(`Neither XMLHttpRequest nor Fetch API are accessible!`));
        }
    });
}

interface CacheRecord {
    expires: number;
    size: number;
    url: string;
    value: string;
}

class LimitedCacheStorage {
    // TODO: remove type cast after dependency update
    private static readonly QUOTA_BYTES = ((!__TEST__ && (navigator as any).deviceMemory) || 4) * 16 * 1024 * 1024;
    private static readonly TTL = getDuration({minutes: 10});
    private static readonly ALARM_NAME = 'network';

    private bytesInUse = 0;
    private records = new Map<string, CacheRecord>();
    private static alarmIsActive = false;

    constructor() {
        chrome.alarms.onAlarm.addListener(async (alarm) => {
            if (alarm.name === LimitedCacheStorage.ALARM_NAME) {
                // We schedule only one-time alarms, so once it goes off,
                // there are no more alarms scheduled.
                LimitedCacheStorage.alarmIsActive = false;
                this.removeExpiredRecords();
            }
        });
    }

    private static ensureAlarmIsScheduled(){
        if (!this.alarmIsActive) {
            chrome.alarms.create(LimitedCacheStorage.ALARM_NAME, {delayInMinutes: 1});
            this.alarmIsActive = true;
        }
    }

    has(url: string) {
        return this.records.has(url);
    }

    get(url: string) {
        if (this.records.has(url)) {
            const record = this.records.get(url)!;
            record.expires = Date.now() + LimitedCacheStorage.TTL;
            this.records.delete(url);
            this.records.set(url, record);
            return record.value;
        }
        return null;
    }

    set(url: string, value: string) {
        LimitedCacheStorage.ensureAlarmIsScheduled();

        const size = getStringSize(value);
        if (size > LimitedCacheStorage.QUOTA_BYTES) {
            return;
        }

        for (const [url, record] of this.records) {
            if (this.bytesInUse + size > LimitedCacheStorage.QUOTA_BYTES) {
                this.records.delete(url);
                this.bytesInUse -= record.size;
            } else {
                break;
            }
        }

        if (this.records.size === 0) {
            this.bytesInUse = 0;
        }

        const expires = Date.now() + LimitedCacheStorage.TTL;
        this.records.set(url, {url, value, size, expires});
        this.bytesInUse += size;
    }

    private removeExpiredRecords() {
        const now = Date.now();
        for (const [url, record] of this.records) {
            if (record.expires < now) {
                this.records.delete(url);
                this.bytesInUse -= record.size;
            } else {
                break;
            }
        }

        if (this.records.size === 0) {
            this.bytesInUse = 0;
        } else {
            LimitedCacheStorage.ensureAlarmIsScheduled();
        }
    }
}

function createLimiter() {
    const loadingUrls = new Set<string>();
    const awaitingUrls = new Map<string, Set<(data: string) => void>>();

    function loading(url: string) {
        const result = loadingUrls.has(url);
        loadingUrls.add(url);
        return result;
    }

    async function wait(url: string) {
        return new Promise<string>((resolve) => {
            if (!awaitingUrls.has(url)) {
                awaitingUrls.set(url, new Set());
            }
            awaitingUrls.get(url)?.add(resolve);
        });
    }

    async function loaded(url: string, data: string) {
        loadingUrls.delete(url);
        if (awaitingUrls.has(url)) {
            awaitingUrls.get(url)!.forEach((callback) => callback(data));
            awaitingUrls.delete(url);
        }
    }

    return {loading, wait, loaded};
}

export interface FetchRequestParameters {
    url: string;
    responseType: 'data-url' | 'text';
    mimeType?: string;
    origin?: string;
}

export function createFileLoader(): FileLoader {
    const caches = {
        'data-url': new LimitedCacheStorage(),
        'text': new LimitedCacheStorage(),
    };

    const loaders = {
        'data-url': loadAsDataURL,
        'text': loadAsText,
    };

    const limiters = {
        'data-url': createLimiter(),
        'text': createLimiter(),
    };

    async function get({url, responseType, mimeType, origin}: FetchRequestParameters) {
        const cache = caches[responseType];
        const load = loaders[responseType];
        const limiter = limiters[responseType];
        if (cache.has(url)) {
            return cache.get(url)!;
        }

        if (limiter.loading(url)) {
            return limiter.wait(url);
        }

        const data = await load(url, mimeType, origin);
        cache.set(url, data);
        limiter.loaded(url, data);

        return data;
    }

    return {get};
}

```

### background\utils\log.ts

```
import {sendLog} from './sendLog';

declare const __DEBUG__: boolean;
declare const __TEST__: boolean;

export function logInfo(...args: any[]): void {
    if (__DEBUG__) {
        console.info(...args);
        sendLog('info', args);
    }
}

export function logWarn(...args: any[]): void {
    if (__DEBUG__) {
        console.warn(...args);
        sendLog('warn', args);
    }
}

export function logInfoCollapsed(title: string, ...args: any[]): void {
    if (__DEBUG__) {
        console.groupCollapsed(title);
        console.log(...args);
        console.groupEnd();
        sendLog('info', args);
    }
}

function logAssert(...args: any[]): void {
    if ((__TEST__ || __DEBUG__)) {
        console.assert(...args);
        sendLog('assert', ...args);
    }
}

export function ASSERT(description: string, condition: (() => boolean) | any): void {
    if ((__TEST__ || __DEBUG__) && (typeof condition === 'function' && !condition()) || !condition) {
        logAssert(description);
        if (__TEST__) {
            throw new Error(`Assertion failed: ${description}`);
        }
    }
}

```

### background\utils\tab.ts

```
import {isOpera} from '../../utils/platform';

// On Thunderbird, sometimes sender.tab is undefined but accessing it will throw a very nice error.
// On Vivaldi, sometimes sender.tab is undefined as well, but error is not very helpful.
// On Opera, sender.tab.index === -1.
export function isPanel(sender: chrome.runtime.MessageSender): boolean {
    return typeof sender === 'undefined' || typeof sender.tab === 'undefined' || (isOpera && sender.tab.index === -1);
}

```

### background\tab-manager.ts

```
import {canInjectScript} from '../background/utils/extension-api';
import type {MessageBGtoCS, MessageCStoBG, MessageUItoBG} from '../definitions';
import {MessageTypeCStoBG, MessageTypeBGtoCS, MessageTypeUItoBG} from '../utils/message';
import {isFirefox} from '../utils/platform';
import {StateManager} from '../utils/state-manager';
import {getActiveTab, queryTabs} from '../utils/tabs';
import {getURLHostOrProtocol} from '../utils/url';
import IconManager from './icon-manager';

import {makeFirefoxHappy} from './make-firefox-happy';
import {ASSERT, logInfo, logWarn} from './utils/log';
import type {FetchRequestParameters} from './utils/network';
import {createFileLoader} from './utils/network';
import {isPanel} from './utils/tab';

declare const __CHROMIUM_MV3__: boolean;

interface TabManagerOptions {
    getConnectionMessage: (tabURl: string, url: string, isTopFrame: boolean, topFrameHasDarkTheme?: boolean) => Promise<MessageBGtoCS>;
    getTabMessage: (tabURL: string, url: string, isTopFrame: boolean) => MessageBGtoCS;
    onColorSchemeChange: (isDark: boolean) => void;
}

interface DocumentInfo {
    scriptId: string;
    documentId: string | null;
    isTop: true | undefined;
    url: string | null;
    state: DocumentState;
    timestamp: number;
    darkThemeDetected: boolean;
}

interface TabManagerState extends Record<string, unknown> {
    tabs: {[tabId: number]: {[frameId: number]: DocumentInfo}};
    timestamp: number;
}

/**
 * These states correspond to possible document states in Page Lifecycle API:
 * https://developers.google.com/web/updates/2018/07/page-lifecycle-api#developer-recommendations-for-each-state
 * Some states are not currently used (they are declared for future-proofing).
 */
enum DocumentState {
    ACTIVE = 0,
    PASSIVE = 1,
    HIDDEN = 2,
    FROZEN = 3,
    TERMINATED = 4,
    DISCARDED = 5
}

/**
 * Note: On Chromium builds, we use documentId if it is available.
 * We avoid messaging using frameId entirely since when document is pre-rendered, it gets a temporary frameId
 * and if we attempt to send to {frameId, documentId} with old frameId, then the message will be dropped.
 */
export default class TabManager {
    private static tabs: TabManagerState['tabs'];
    private static stateManager: StateManager<TabManagerState>;
    private static fileLoader: {get: (params: FetchRequestParameters) => Promise<string | null>} | null = null;
    private static onColorSchemeChange: TabManagerOptions['onColorSchemeChange'];
    private static getTabMessage: TabManagerOptions['getTabMessage'];
    private static timestamp: TabManagerState['timestamp'];
    private static readonly LOCAL_STORAGE_KEY = 'TabManager-state';

    static init({getConnectionMessage, onColorSchemeChange, getTabMessage}: TabManagerOptions): void {
        TabManager.stateManager = new StateManager<TabManagerState>(TabManager.LOCAL_STORAGE_KEY, this, {tabs: {}, timestamp: 0}, logWarn);
        TabManager.tabs = {};
        TabManager.onColorSchemeChange = onColorSchemeChange;
        TabManager.getTabMessage = getTabMessage;

        chrome.runtime.onMessage.addListener(async (message: MessageCStoBG | MessageUItoBG, sender, sendResponse) => {
            if (isFirefox && makeFirefoxHappy(message, sender, sendResponse)) {
                return;
            }
            switch (message.type) {
                case MessageTypeCStoBG.DOCUMENT_CONNECT: {
                    if (__CHROMIUM_MV3__ && isPanel(sender)) {
                        sendResponse({
                            type: MessageTypeBGtoCS.UNSUPPORTED_SENDER,
                        });
                        return;
                    }
                    TabManager.onColorSchemeMessage(message, sender);
                    await TabManager.stateManager.loadState();
                    const reply = (tabURL: string, url: string, isTopFrame: boolean, topFrameHasDarkTheme?: boolean) => {
                        getConnectionMessage(tabURL, url, isTopFrame, topFrameHasDarkTheme).then((response) => {
                            if (!response) {
                                return;
                            }
                            response.scriptId = message.scriptId!;
                            TabManager.sendDocumentMessage(sender.tab!.id!, sender.documentId!, response, sender.frameId!);
                        });
                    };

                    if (isPanel(sender)) {
                        // NOTE: Vivaldi and Opera can show a page in a side panel,
                        // but it is not possible to handle messaging correctly (no tab ID, frame ID).
                        if (isFirefox) {
                            if (sender && sender.tab && typeof sender.tab.id === 'number') {
                                chrome.tabs.sendMessage<MessageBGtoCS>(sender.tab.id,
                                    {
                                        type: MessageTypeBGtoCS.UNSUPPORTED_SENDER,
                                        scriptId: message.scriptId!,
                                    },
                                    {
                                        frameId: sender && typeof sender.frameId === 'number' ? sender.frameId : undefined,
                                    });
                            }
                        } else {
                            sendResponse('unsupportedSender');
                        }
                        return;
                    }

                    const {frameId} = sender;
                    const isTopFrame: boolean = frameId === 0 || message.data.isTopFrame;
                    const url = sender.url!;
                    const tabId = sender.tab!.id!;
                    const scriptId = message.scriptId!;
                    const topFrameHasDarkTheme = isTopFrame ? false : TabManager.tabs[tabId]?.[0]?.darkThemeDetected;
                    // Chromium 106+ may prerender frames resulting in top-level frames with chrome.runtime.MessageSender.tab.url
                    // set to chrome://newtab/ and positive chrome.runtime.MessageSender.frameId
                    const tabURL = isTopFrame ? url : sender.tab!.url!;
                    const documentId: string | null = __CHROMIUM_MV3__ ? sender.documentId! : (sender.documentId || null);

                    TabManager.addFrame(tabId, frameId!, documentId, scriptId, url, isTopFrame);

                    reply(tabURL, url, isTopFrame, topFrameHasDarkTheme);
                    TabManager.stateManager.saveState();
                    break;
                }

                case MessageTypeCStoBG.DOCUMENT_FORGET:
                    if (!sender.tab) {
                        logWarn('Unexpected message', message, sender);
                        break;
                    }
                    ASSERT('Has a scriptId', () => Boolean(message.scriptId));
                    TabManager.removeFrame(sender.tab!.id!, sender.frameId!);
                    break;

                case MessageTypeCStoBG.DOCUMENT_FREEZE: {
                    await TabManager.stateManager.loadState();
                    const info = TabManager.tabs[sender.tab!.id!][sender.frameId!];
                    info.state = DocumentState.FROZEN;
                    info.url = null;
                    TabManager.stateManager.saveState();
                    break;
                }

                case MessageTypeCStoBG.DOCUMENT_RESUME: {
                    TabManager.onColorSchemeMessage(message, sender);
                    await TabManager.stateManager.loadState();
                    const tabId = sender.tab!.id!;
                    const tabURL = sender.tab!.url!;
                    const frameId = sender.frameId!;
                    const url = sender.url!;
                    const documentId: string | null = sender.documentId!;
                    const isTopFrame: boolean = frameId === 0 || message.data.isTopFrame;
                    if (TabManager.tabs[tabId][frameId].timestamp < TabManager.timestamp) {
                        const response = TabManager.getTabMessage(tabURL, url, isTopFrame);
                        response.scriptId = message.scriptId!;
                        TabManager.sendDocumentMessage(tabId, documentId!, response, frameId!);
                    }
                    TabManager.tabs[sender.tab!.id!][sender.frameId!] = {
                        documentId,
                        scriptId: message.scriptId!,
                        url,
                        isTop: isTopFrame || undefined,
                        state: DocumentState.ACTIVE,
                        darkThemeDetected: false,
                        timestamp: TabManager.timestamp,
                    };
                    TabManager.stateManager.saveState();
                    break;
                }

                case MessageTypeCStoBG.DARK_THEME_DETECTED: {
                    const tabId = sender.tab!.id!;
                    const frames = TabManager.tabs[tabId];
                    if (!frames) {
                        break;
                    }
                    for (const entry of Object.entries(frames)) {
                        const frameId = Number(entry[0]);
                        const frame = entry[1];
                        frame.darkThemeDetected = true;
                        const {documentId, scriptId} = frame;
                        if (documentId) {
                            const message = {
                                type: MessageTypeBGtoCS.CLEAN_UP,
                                scriptId,
                            };
                            TabManager.sendDocumentMessage(tabId, documentId, message, frameId);
                        }
                        if (frameId === 0) {
                            IconManager.setIcon({tabId, isActive: false});
                        }
                    }
                    break;
                }

                case MessageTypeCStoBG.FETCH: {
                    // Using custom response due to Chrome and Firefox incompatibility
                    // Sometimes fetch error behaves like synchronous and sends `undefined`
                    const id = message.id;
                    // We do not need to use scriptId here since every request has a unique id already
                    const sendResponse = (response: Partial<MessageBGtoCS>) => {
                        TabManager.sendDocumentMessage(sender.tab!.id!, sender.documentId!, {type: MessageTypeBGtoCS.FETCH_RESPONSE, id, ...response}, sender.frameId!);
                    };

                    try {
                        const {url, responseType, mimeType, origin} = message.data;
                        if (!TabManager.fileLoader) {
                            TabManager.fileLoader = createFileLoader();
                        }
                        const response = await TabManager.fileLoader.get({url, responseType, mimeType, origin});
                        sendResponse({data: response});
                    } catch (err) {
                        sendResponse({error: err && err.message ? err.message : err});
                    }
                    break;
                }

                case MessageTypeUItoBG.COLOR_SCHEME_CHANGE:
                    // fallthrough
                case MessageTypeCStoBG.COLOR_SCHEME_CHANGE:
                    TabManager.onColorSchemeMessage(message as MessageCStoBG, sender);
                    break;

                default:
                    break;
            }
        });

        chrome.tabs.onRemoved.addListener(async (tabId) => TabManager.removeFrame(tabId, 0));
    }

    private static sendDocumentMessage(tabId: number, documentId: string, message: MessageBGtoCS, frameId: number) {
        if (frameId === 0) {
            const themeMessageTypes: MessageTypeBGtoCS[] = [
                MessageTypeBGtoCS.ADD_CSS_FILTER,
                MessageTypeBGtoCS.ADD_DYNAMIC_THEME,
                MessageTypeBGtoCS.ADD_STATIC_THEME,
                MessageTypeBGtoCS.ADD_SVG_FILTER,
            ];
            if (themeMessageTypes.includes(message.type)) {
                IconManager.setIcon({tabId, isActive: true, colorScheme: message.data?.theme?.mode ? 'dark' : 'light'});
            } else if (message.type === MessageTypeBGtoCS.CLEAN_UP) {
                const isActive = TabManager.tabs[tabId]?.[0]?.url?.startsWith('https://darkreader.org/');
                IconManager.setIcon({tabId, isActive});
            }
        }

        if (__CHROMIUM_MV3__) {
            // On MV3, Chromium has a bug which prevents sending messages to pre-rendered frames without specifying frameId
            // Furthermore, if we send a message addressed to a temporary frameId after the document exits prerender state,
            // the message will also fail to be delivered.
            //
            // To work around this:
            //  1. Attempt to send the message by documentId. If this fails, this means the document is in prerender state.
            //  2. Attempt to send the message by documentId and temporary frameId. If this fails, this means the document
            //     either already exited pre-rendered state or was discarded.
            //  3. Attempt to send the message by documentId (omitting the permanent frameId which is 0).If this fails, this
            //     means the document was already discarded.
            //
            // More info: https://crbug.com/1455817

            chrome.tabs.sendMessage<MessageBGtoCS>(tabId, message, {documentId}).catch(() =>
                chrome.tabs.sendMessage<MessageBGtoCS>(tabId, message, {frameId, documentId}).catch(() =>
                    chrome.tabs.sendMessage<MessageBGtoCS>(tabId, message, {documentId}).catch(() => { /* noop */ })
                )
            );
            return;
        }
        chrome.tabs.sendMessage<MessageBGtoCS>(tabId, message, {frameId});
    }

    private static onColorSchemeMessage(message: MessageCStoBG, sender: chrome.runtime.MessageSender) {
        ASSERT('TabManager.onColorSchemeMessage is set', () => Boolean(TabManager.onColorSchemeChange));

        // We honor only messages which come from tab's top frame
        // because sub-frames color scheme can be overridden by style with prefers-color-scheme
        // TODO(MV3): instead of dropping these messages, consider making a query to an authoritative source
        // like offscreen document
        if (sender && sender.frameId === 0) {
            TabManager.onColorSchemeChange(message.data.isDark);
        }
    }

    private static addFrame(tabId: number, frameId: number, documentId: string | null, scriptId: string, url: string, isTop: boolean) {
        let frames: {[frameId: number]: DocumentInfo};
        if (TabManager.tabs[tabId]) {
            frames = TabManager.tabs[tabId];
        } else {
            frames = {};
            TabManager.tabs[tabId] = frames;
        }
        frames[frameId] = {
            documentId,
            scriptId,
            url,
            isTop: isTop || undefined,
            state: DocumentState.ACTIVE,
            darkThemeDetected: false,
            timestamp: TabManager.timestamp,
        };
    }

    private static async removeFrame(tabId: number, frameId: number) {
        await TabManager.stateManager.loadState();

        if (frameId === 0) {
            delete TabManager.tabs[tabId];
        }

        if (TabManager.tabs[tabId] && TabManager.tabs[tabId][frameId]) {
            // We need to use delete here because Object.entries()
            // in sendMessage() would enumerate undefined as well.
            delete TabManager.tabs[tabId][frameId];
        }

        TabManager.stateManager.saveState();
    }

    static async cleanState() {
        await TabManager.stateManager.loadState();

        const actualTabs = await queryTabs({});
        const tabIds = Object.keys(TabManager.tabs).map((id) => Number(id));
        const staleTabs = new Set(tabIds);
        actualTabs.forEach((actualTab) => {
            const tabId = actualTab.id;
            if (tabId) {
                staleTabs.delete(tabId);
            }
        });
        staleTabs.forEach((staleTabId) => {
            if (TabManager.tabs[staleTabId]) {
                delete TabManager.tabs[staleTabId];
            }
        });

        TabManager.stateManager.saveState();
    }

    static async getTabURL(tab: chrome.tabs.Tab | null): Promise<string> {
        if (__CHROMIUM_MV3__) {
            if (!tab) {
                return 'about:blank';
            }
            try {
                return (await chrome.tabs.get(tab.id!)).url || 'about:blank';
            } catch (e) {
                try {
                    return (await chrome.scripting.executeScript({
                        target: {
                            tabId: tab.id!,
                            frameIds: [0],
                        },
                        world: 'MAIN',
                        injectImmediately: true,
                        func: () => window.location.href,
                    }))[0].result || 'about:blank';
                } catch (e) {
                    const errMessage = String(e);
                    if (
                        errMessage.includes('chrome://') ||
                        errMessage.includes('chrome-extension://') ||
                        errMessage.includes('gallery')
                    ) {
                        return 'chrome://protected';
                    }
                    return 'about:blank';
                }
            }
        }
        // It can happen in cases whereby the tab.url is empty.
        // Luckily this only and will only happen on `about:blank`-like pages.
        // Due to this we can safely use `about:blank` as fallback value.
        // In some extraordinary circumstances tab may be undefined.
        return tab && tab.url || 'about:blank';
    }

    static async updateContentScript(options: {runOnProtectedPages: boolean}): Promise<void> {
        (await queryTabs({discarded: false}))
            .filter((tab) => __CHROMIUM_MV3__ || options.runOnProtectedPages || canInjectScript(tab.url))
            .filter((tab) => !TabManager.tabs[tab.id!])
            .forEach((tab) => {
                if (__CHROMIUM_MV3__) {
                    chrome.scripting.executeScript({
                        target: {
                            tabId: tab.id!,
                            allFrames: true,
                        },
                        files: ['/inject/index.js'],
                    }, () => logInfo('Could not update content script in tab', tab, chrome.runtime.lastError));
                } else {
                    chrome.tabs.executeScript(tab.id!, {
                        runAt: 'document_start',
                        file: '/inject/index.js',
                        allFrames: true,
                        matchAboutBlank: true,
                    });
                }
            });
    }

    static async registerMailDisplayScript(): Promise<void> {
        await (chrome as any).messageDisplayScripts.register({
            js: [
                {file: '/inject/fallback.js'},
                {file: '/inject/index.js'},
            ],
        });
    }

    // sendMessage will send a tab messages to all active tabs and their frames.
    // If onlyUpdateActiveTab is specified, it will only send a new message to any
    // tab that matches the active tab's hostname. This is to ensure that when a user
    // has multiple tabs of the same website, every tab will receive the new message
    // and not just that tab as Dark Reader currently doesn't have per-tab operations,
    // this should be the expected behavior.
    static async sendMessage(onlyUpdateActiveTab = false): Promise<void> {
        TabManager.timestamp++;

        const activeTabHostname = onlyUpdateActiveTab ? getURLHostOrProtocol(await TabManager.getActiveTabURL()) : null;

        (await queryTabs({discarded: false}))
            .filter((tab) => Boolean(TabManager.tabs[tab.id!]))
            .forEach((tab) => {
                const frames = TabManager.tabs[tab.id!];
                Object.entries(frames)
                    .filter(([, {state}]) => state === DocumentState.ACTIVE || state === DocumentState.PASSIVE)
                    .forEach(async ([id, {url, documentId, scriptId, isTop}]) => {
                        const frameId = Number(id);
                        const tabURL = await TabManager.getTabURL(tab);

                        // Check if hostname are equal when we only want to update active tab.
                        if (onlyUpdateActiveTab && getURLHostOrProtocol(tabURL) !== activeTabHostname) {
                            return;
                        }

                        const message = TabManager.getTabMessage(tabURL, url!, isTop || false);
                        message.scriptId = scriptId;

                        if (tab.active && isTop) {
                            TabManager.sendDocumentMessage(tab!.id!, documentId!, message, frameId);
                        } else {
                            setTimeout(() => {
                                TabManager.sendDocumentMessage(tab!.id!, documentId!, message, frameId);
                            });
                        }
                        if (TabManager.tabs[tab.id!][frameId]) {
                            TabManager.tabs[tab.id!][frameId].timestamp = TabManager.timestamp;
                        }
                    });
            });
    }

    static canAccessTab(tab: chrome.tabs.Tab | null): boolean {
        return tab && Boolean(TabManager.tabs[tab.id!]) || false;
    }

    static getTabDocumentId(tab: chrome.tabs.Tab | null): string | null {
        return tab && TabManager.tabs[tab.id!] && TabManager.tabs[tab.id!][0] && TabManager.tabs[tab.id!][0].documentId;
    }

    static isTabDarkThemeDetected(tab: chrome.tabs.Tab | null): boolean | null {
        return tab && TabManager.tabs[tab.id!] && TabManager.tabs[tab.id!][0] && TabManager.tabs[tab.id!][0].darkThemeDetected || null;
    }

    static async getActiveTabURL(): Promise<string> {
        return TabManager.getTabURL(await getActiveTab());
    }
}

```

### background\user-storage.ts

```
import {ThemeEngine} from '../generators/theme-engines';
import {DEFAULT_SETTINGS, DEFAULT_THEME} from '../defaults';
import type {UserSettings} from '../definitions';
import {debounce} from '../utils/debounce';
import {PromiseBarrier} from '../utils/promise-barrier';
import {isURLMatched} from '../utils/url';
import {validateSettings} from '../utils/validation';

import {readSyncStorage, readLocalStorage, writeSyncStorage, writeLocalStorage, removeSyncStorage, removeLocalStorage} from './utils/extension-api';
import {logWarn} from './utils/log';


const SAVE_TIMEOUT = 1000;

export default class UserStorage {
    private static loadBarrier: PromiseBarrier<UserSettings, void>;
    private static saveStorageBarrier: PromiseBarrier<void, void> | null;
    static settings: Readonly<UserSettings>;

    static async loadSettings(): Promise<void> {
        if (!UserStorage.settings) {
            UserStorage.settings = await UserStorage.loadSettingsFromStorage();
        }
    }

    private static fillDefaults(settings: UserSettings) {
        settings.theme = {...DEFAULT_THEME, ...settings.theme};
        settings.time = {...DEFAULT_SETTINGS.time, ...settings.time};
        settings.presets.forEach((preset) => {
            preset.theme = {...DEFAULT_THEME, ...preset.theme};
        });
        settings.customThemes.forEach((site) => {
            site.theme = {...DEFAULT_THEME, ...site.theme};
        });
        if (settings.customThemes.length === 0) {
            settings.customThemes = DEFAULT_SETTINGS.customThemes;
        }
    }

    // migrateAutomationSettings migrates old automation settings to the new interface.
    // It will move settings.automation & settings.automationBehavior into,
    // settings.automation = { enabled, mode, behavior }.
    // Remove this over two years(mid-2024).
    // This won't always work, because browsers can decide to instead use the default settings
    // when they notice a different type being requested for automation, in that case it's a data-loss
    // and not something we can encounter for, except for doing always two extra requests to explicitly
    // check for this case which is inefficient usage of requesting storage.
    private static migrateAutomationSettings(settings: UserSettings): void {
        if (typeof settings.automation === 'string') {
            const automationMode = settings.automation;
            const automationBehavior: UserSettings['automation']['behavior'] = (settings as any).automationBehaviour;
            if (settings.automation === '') {
                settings.automation = {
                    enabled: false,
                    mode: automationMode,
                    behavior: automationBehavior,
                };
            } else {
                settings.automation = {
                    enabled: true,
                    mode: automationMode,
                    behavior: automationBehavior,
                };
            }
            delete (settings as any).automationBehaviour;
        }
    }

    private static migrateSiteListsV2(deprecated: any): Partial<UserSettings> {
        const settings: Partial<UserSettings> = {};
        settings.enabledByDefault = !deprecated.applyToListedOnly;
        if (settings.enabledByDefault) {
            settings.disabledFor = deprecated.siteList ?? [];
            settings.enabledFor = deprecated.siteListEnabled ?? [];
        } else {
            settings.disabledFor = [];
            settings.enabledFor = deprecated.siteList ?? [];
        }
        return settings;
    }

    private static migrateBuiltInSVGFilterToCSSFilter(settings: UserSettings): void {
        settings?.customThemes?.forEach((c) => {
            if (
                c?.theme?.engine === ThemeEngine.svgFilter &&
                (c.builtIn || c.url?.includes('docs.google.com'))
            ) {
                c.theme.engine = ThemeEngine.cssFilter;
            }
        });
    }

    private static async loadSettingsFromStorage(): Promise<UserSettings> {
        if (UserStorage.loadBarrier) {
            return await UserStorage.loadBarrier.entry();
        }
        UserStorage.loadBarrier = new PromiseBarrier();

        let local = await readLocalStorage(DEFAULT_SETTINGS);

        if (local.schemeVersion < 2) {
            const sync = await readSyncStorage({schemeVersion: 0});
            if (!sync || sync.schemeVersion < 2) {
                const deprecatedDefaults = {
                    siteList: [],
                    siteListEnabled: [],
                    applyToListedOnly: false,
                };
                const localDeprecated = await readLocalStorage(deprecatedDefaults);
                const localTransformed = UserStorage.migrateSiteListsV2(localDeprecated);
                await writeLocalStorage({schemeVersion: 2, ...localTransformed});
                await removeLocalStorage(Object.keys(deprecatedDefaults));

                const syncDeprecated = await readSyncStorage(deprecatedDefaults);
                const syncTransformed = UserStorage.migrateSiteListsV2(syncDeprecated);
                await writeSyncStorage({schemeVersion: 2, ...syncTransformed});
                await removeSyncStorage(Object.keys(deprecatedDefaults));

                local = await readLocalStorage(DEFAULT_SETTINGS);
            }
        }

        const {errors: localCfgErrors} = validateSettings(local);
        localCfgErrors.forEach((err) => logWarn(err));
        if (local.syncSettings == null) {
            local.syncSettings = DEFAULT_SETTINGS.syncSettings;
        }
        if (!local.syncSettings) {
            UserStorage.migrateAutomationSettings(local);
            UserStorage.migrateBuiltInSVGFilterToCSSFilter(local);
            UserStorage.fillDefaults(local);
            UserStorage.loadBarrier.resolve(local);
            return local;
        }

        const $sync = await readSyncStorage(DEFAULT_SETTINGS);
        if (!$sync) {
            logWarn('Sync settings are missing');
            local.syncSettings = false;
            UserStorage.set({syncSettings: false});
            UserStorage.saveSyncSetting(false);
            UserStorage.loadBarrier.resolve(local);
            return local;
        }

        const {errors: syncCfgErrors} = validateSettings($sync);
        syncCfgErrors.forEach((err) => logWarn(err));

        UserStorage.migrateAutomationSettings($sync);
        UserStorage.migrateBuiltInSVGFilterToCSSFilter($sync);
        UserStorage.fillDefaults($sync);

        UserStorage.loadBarrier.resolve($sync);
        return $sync;
    }

    static async saveSettings(): Promise<void> {
        if (!UserStorage.settings) {
            // This path is never taken because Extension always calls UserStorage.loadSettings()
            // before calling UserStorage.saveSettings().
            logWarn('Could not save settings into storage because the settings are missing.');
            return;
        }
        await UserStorage.saveSettingsIntoStorage();
    }

    static async saveSyncSetting(sync: boolean): Promise<void> {
        const obj = {syncSettings: sync};
        await writeLocalStorage(obj);
        try {
            await writeSyncStorage(obj);
        } catch (err) {
            logWarn('Settings synchronization was disabled due to error:', chrome.runtime.lastError);
            UserStorage.set({syncSettings: false});
        }
    }

    private static saveSettingsIntoStorage = debounce(SAVE_TIMEOUT, async () => {
        if (UserStorage.saveStorageBarrier) {
            await UserStorage.saveStorageBarrier.entry();
            return;
        }
        UserStorage.saveStorageBarrier = new PromiseBarrier();

        const settings = UserStorage.settings;
        if (settings.syncSettings) {
            try {
                await writeSyncStorage(settings);
            } catch (err) {
                logWarn('Settings synchronization was disabled due to error:', chrome.runtime.lastError);
                UserStorage.set({syncSettings: false});
                await UserStorage.saveSyncSetting(false);
                await writeLocalStorage(settings);
            }
        } else {
            await writeLocalStorage(settings);
        }

        UserStorage.saveStorageBarrier.resolve();
        UserStorage.saveStorageBarrier = null;
    });

    static set($settings: Partial<UserSettings>): void {
        if (!UserStorage.settings) {
            // This path is never taken because Extension always calls UserStorage.loadSettings()
            // before calling UserStorage.set().
            logWarn('Could not modify settings because the settings are missing.');
            return;
        }

        const filterSiteList = (siteList: string[]) => {
            if (!Array.isArray(siteList)) {
                const list: string[] = [];
                for (const key in (siteList as string[])) {
                    const index = Number(key);
                    if (!isNaN(index)) {
                        list[index] = siteList[key];
                    }
                }
                siteList = list;
            }
            return siteList.filter((pattern) => {
                let isOK = false;
                try {
                    isURLMatched('https://google.com/', pattern);
                    isURLMatched('[::1]:1337', pattern);
                    isOK = true;
                } catch (err) {
                    logWarn(`Pattern "${pattern}" excluded`);
                }
                return isOK && pattern !== '/';
            });
        };

        const {enabledFor, disabledFor} = $settings;
        const updatedSettings = {...UserStorage.settings, ...$settings};
        if (enabledFor) {
            updatedSettings.enabledFor = filterSiteList(enabledFor);
        }
        if (disabledFor) {
            updatedSettings.disabledFor = filterSiteList(disabledFor);
        }

        UserStorage.settings = updatedSettings;
    }
}

```

### background\newsmaker.ts

```
import type {News} from '../definitions';
import {getBlogPostURL, NEWS_URL} from '../utils/links';
import {StateManager} from '../utils/state-manager';
import {getDurationInMinutes} from '../utils/time';

import IconManager from './icon-manager';
import {readSyncStorage, readLocalStorage, writeSyncStorage, writeLocalStorage} from './utils/extension-api';
import {logWarn} from './utils/log';

declare const __TEST__: boolean;

interface NewsmakerState extends Record<string, unknown> {
    latest: News[];
    latestTimestamp: number | null;
}

let newsForTesting: News[] | null = [{
    id: 'some',
    date: '10',
    url: '/',
    headline: 'News',
}];

export default class Newsmaker {
    private static readonly UPDATE_INTERVAL = getDurationInMinutes({hours: 4});
    private static readonly ALARM_NAME = 'newsmaker';
    private static readonly LOCAL_STORAGE_KEY = 'Newsmaker-state';

    private static initialized: boolean;
    private static stateManager: StateManager<NewsmakerState>;
    private static latest: News[];
    private static latestTimestamp: number | null;

    private static init() {
        if (Newsmaker.initialized) {
            // This path is never taken since Extension.constructor() ever creates one instance.
            logWarn('Attempting to re-initialize Newsmaker. Doing nothing.');
            return;
        }
        Newsmaker.initialized = true;

        Newsmaker.stateManager = new StateManager<NewsmakerState>(Newsmaker.LOCAL_STORAGE_KEY, this, {latest: [], latestTimestamp: null}, logWarn);
        Newsmaker.latest = [];
        Newsmaker.latestTimestamp = null;
    }

    private static onUpdate() {
        Newsmaker.init();
        const latestNews = Newsmaker.latest.length > 0 && Newsmaker.latest[0];
        if (latestNews && latestNews.badge && !latestNews.read && !latestNews.displayed) {
            IconManager.showBadge(latestNews.badge);
            return;
        }

        IconManager.hideBadge();
    }

    static async getLatest(): Promise<News[]> {
        Newsmaker.init();
        await Newsmaker.stateManager.loadState();
        return Newsmaker.latest;
    }

    private static alarmListener = (alarm: chrome.alarms.Alarm): void => {
        Newsmaker.init();
        if (alarm.name === Newsmaker.ALARM_NAME) {
            Newsmaker.updateNews();
        }
    };

    static subscribe(): void {
        Newsmaker.init();
        if ((Newsmaker.latestTimestamp === null) || (Newsmaker.latestTimestamp + Newsmaker.UPDATE_INTERVAL < Date.now())) {
            Newsmaker.updateNews();
        }
        chrome.alarms.onAlarm.addListener(Newsmaker.alarmListener);
        chrome.alarms.create(Newsmaker.ALARM_NAME, {periodInMinutes: Newsmaker.UPDATE_INTERVAL});
    }

    static unSubscribe(): void {
        // No need to call Newsmaker.init()
        chrome.alarms.onAlarm.removeListener(Newsmaker.alarmListener);
        chrome.alarms.clear(Newsmaker.ALARM_NAME);
    }

    private static async updateNews(): Promise<void> {
        Newsmaker.init();
        const news = await Newsmaker.getNews();
        if (Array.isArray(news)) {
            Newsmaker.latest = news;
            Newsmaker.latestTimestamp = Date.now();
            Newsmaker.onUpdate();
            await Newsmaker.stateManager.saveState();
        }
    }

    private static async getReadNews(): Promise<string[]> {
        Newsmaker.init();
        const [
            sync,
            local,
        ] = await Promise.all([
            readSyncStorage({readNews: []}),
            readLocalStorage({readNews: []}),
        ]);
        return Array.from(new Set([
            ...sync ? sync.readNews : [],
            ...local ? local.readNews : [],
        ]));
    }

    private static async getDisplayedNews(): Promise<string[]> {
        Newsmaker.init();
        const [
            sync,
            local,
        ] = await Promise.all([
            readSyncStorage({displayedNews: []}),
            readLocalStorage({displayedNews: []}),
        ]);
        return Array.from(new Set([
            ...sync ? sync.displayedNews : [],
            ...local ? local.displayedNews : [],
        ]));
    }

    private static async getNews(): Promise<News[] | null> {
        Newsmaker.init();
        if (__TEST__) {
            return newsForTesting;
        }
        try {
            const response = await fetch(NEWS_URL, {cache: 'no-cache'});
            const $news: Array<Omit<News, 'read' | 'url'> & {date: string}> = await response.json();
            const readNews = await Newsmaker.getReadNews();
            const displayedNews = await Newsmaker.getDisplayedNews();
            const news: News[] = $news.map((n) => {
                const url = getBlogPostURL(n.id);
                const read = Newsmaker.wasRead(n.id, readNews);
                const displayed = Newsmaker.wasDisplayed(n.id, displayedNews);
                return {...n, url, read, displayed};
            });
            for (let i = 0; i < news.length; i++) {
                const date = new Date(news[i].date);
                if (isNaN(date.getTime())) {
                    throw new Error(`Unable to parse date ${date}`);
                }
            }
            return news;
        } catch (err) {
            console.error(err);
            return null;
        }
    }

    static async markAsRead(ids: string[]): Promise<void> {
        Newsmaker.init();
        const readNews = await Newsmaker.getReadNews();
        const results = readNews.slice();
        let changed = false;
        ids.forEach((id) => {
            if (readNews.indexOf(id) < 0) {
                results.push(id);
                changed = true;
            }
        });
        if (changed) {
            Newsmaker.latest = Newsmaker.latest.map((n) => {
                const read = Newsmaker.wasRead(n.id, results);
                return {...n, read};
            });
            Newsmaker.onUpdate();
            const obj = {readNews: results};
            await Promise.all([
                writeLocalStorage(obj),
                writeSyncStorage(obj),
                Newsmaker.stateManager.saveState(),
            ]);
        }
    }

    static async markAsDisplayed(ids: string[]): Promise<void> {
        Newsmaker.init();
        const displayedNews = await Newsmaker.getDisplayedNews();
        const results = displayedNews.slice();
        let changed = false;
        ids.forEach((id) => {
            if (displayedNews.indexOf(id) < 0) {
                results.push(id);
                changed = true;
            }
        });
        if (changed) {
            Newsmaker.latest = Newsmaker.latest.map((n) => {
                const displayed = Newsmaker.wasDisplayed(n.id, results);
                return {...n, displayed};
            });
            Newsmaker.onUpdate();
            const obj = {displayedNews: results};
            await Promise.all([
                writeLocalStorage(obj),
                writeSyncStorage(obj),
                Newsmaker.stateManager.saveState(),
            ]);
        }
    }

    private static wasRead(id: string, readNews: string[]): boolean {
        return readNews.includes(id);
    }

    private static wasDisplayed(id: string, displayedNews: string[]): boolean {
        return displayedNews.includes(id);
    }
}

export function setNewsForTesting(news: News[]): void {
    if (__TEST__) {
        newsForTesting = news;
    }
}

```

### background\index.ts

```
import {canInjectScript, keepListeningToEvents} from '../background/utils/extension-api';
import type {ColorScheme, DebugMessageBGtoCS, DebugMessageBGtoUI, DebugMessageCStoBG, ExtensionData, News, UserSettings} from '../definitions';
import {getHelpURL, UNINSTALL_URL} from '../utils/links';
import {emulateColorScheme, isSystemDarkModeEnabled} from '../utils/media-query';
import {DebugMessageTypeBGtoCS, DebugMessageTypeBGtoUI, DebugMessageTypeCStoBG} from '../utils/message';
import {isFirefox} from '../utils/platform';

import {Extension} from './extension';
import {makeChromiumHappy} from './make-chromium-happy';
import {setNewsForTesting} from './newsmaker';
import {ASSERT} from './utils/log';
import {sendLog} from './utils/sendLog';


type TestMessage = {
    type: 'getManifest';
    id: number;
} | {
    type: 'changeSettings';
    data: Partial<UserSettings>;
    id: number;
} | {
    type: 'collectData';
    id: number;
} | {
    type: 'getChromeStorage';
    data: {
        region: 'local' | 'sync';
        keys: string | string[];
    };
    id: number;
} | {
    type: 'changeChromeStorage';
    data: {
        region: 'local' | 'sync';
        data: {[key: string]: any};
    };
    id: number;
} | {
    type: 'firefox-createTab';
    data: string;
    id: number;
} | {
    type: 'firefox-getColorScheme';
    id: number;
} | {
    type: 'firefox-emulateColorScheme';
    data: ColorScheme;
    id: number;
} | {
    type: 'setNews';
    data: News[];
    id: number;
};

// Start extension
const extension = Extension.start();

const welcome = `  /''''\\
 (0)==(0)
/__||||__\\
Welcome to Dark Reader!`;
console.log(welcome);

declare const __DEBUG__: boolean;
declare const __WATCH__: boolean;
declare const __LOG__: string | false;
declare const __PORT__: number;
declare const __TEST__: boolean;
declare const __CHROMIUM_MV3__: boolean;
declare const __FIREFOX_MV2__: boolean;

if (__CHROMIUM_MV3__) {
    chrome.runtime.onInstalled.addListener(async () => {
        Extension.isFirstLoad = true;
    });
    keepListeningToEvents();
}

if (__WATCH__) {
    const PORT = __PORT__;
    const ALARM_NAME = 'socket-close';
    const PING_INTERVAL_IN_MINUTES = 1 / 60;

    const socketAlarmListener = (alarm: chrome.alarms.Alarm) => {
        if (alarm.name === ALARM_NAME) {
            listen();
        }
    };

    const listen = () => {
        const socket = new WebSocket(`ws://localhost:${PORT}`);
        const send = (message: {type: string}) => socket.send(JSON.stringify(message));
        socket.onmessage = (e) => {
            chrome.alarms.onAlarm.removeListener(socketAlarmListener);

            const message = JSON.parse(e.data);
            if (message.type.startsWith('reload:')) {
                send({type: 'reloading'});
            }
            switch (message.type) {
                case 'reload:css':
                    chrome.runtime.sendMessage<DebugMessageBGtoUI>({type: DebugMessageTypeBGtoUI.CSS_UPDATE});
                    break;
                case 'reload:ui':
                    chrome.runtime.sendMessage<DebugMessageBGtoUI>({type: DebugMessageTypeBGtoUI.UPDATE});
                    break;
                case 'reload:full':
                    chrome.tabs.query({}, (tabs) => {
                        const message: DebugMessageBGtoCS = {type: DebugMessageTypeBGtoCS.RELOAD};
                        // Some contexts are not considered to be tabs and can not receive regular messages
                        chrome.runtime.sendMessage<DebugMessageBGtoCS>(message);
                        for (const tab of tabs) {
                            if (canInjectScript(tab.url)) {
                                if (__CHROMIUM_MV3__) {
                                    chrome.tabs.sendMessage<DebugMessageBGtoCS>(tab.id!, message).catch(() => { /* noop */ });
                                    continue;
                                }
                                chrome.tabs.sendMessage<DebugMessageBGtoCS>(tab.id!, message);
                            }
                        }
                        chrome.runtime.reload();
                    });
                    break;
            }
        };
        socket.onclose = () => {
            chrome.alarms.onAlarm.addListener(socketAlarmListener);
            chrome.alarms.create(ALARM_NAME, {delayInMinutes: PING_INTERVAL_IN_MINUTES});
        };
    };

    listen();
} else if (!__DEBUG__ && !__TEST__) {
    chrome.runtime.onInstalled.addListener(({reason}) => {
        if (reason === 'install') {
            chrome.tabs.create({url: getHelpURL()});
        }
    });

    chrome.runtime.setUninstallURL(UNINSTALL_URL);
}

if (__TEST__) {
    // Open popup and DevTools pages
    chrome.tabs.create({url: chrome.runtime.getURL('/ui/popup/index.html'), active: false});
    chrome.tabs.create({url: chrome.runtime.getURL('/ui/devtools/index.html'), active: false});

    let testTabId: number | null = null;
    if (__FIREFOX_MV2__) {
        chrome.tabs.create({url: 'about:blank', active: true}, ({id}) => testTabId = id!);
    }

    const socket = new WebSocket(`ws://localhost:8894`);
    socket.onopen = async () => {
        // Wait for extension to start
        await extension;
        socket.send(JSON.stringify({
            data: {
                type: 'background',
                extensionOrigin: chrome.runtime.getURL(''),
            },
            id: null,
        }));
    };
    socket.onmessage = (e) => {
        try {
            const message: TestMessage = JSON.parse(e.data);
            const {id, type} = message;
            const respond = (data?: ExtensionData | string | boolean | {[key: string]: string} | null) => socket.send(JSON.stringify({
                data,
                id,
            }));

            switch (type) {
                case 'changeSettings':
                    Extension.changeSettings(message.data);
                    respond();
                    break;
                case 'collectData':
                    Extension.collectData().then(respond);
                    break;
                case 'getManifest': {
                    const data = chrome.runtime.getManifest();
                    respond(data);
                    break;
                }
                case 'changeChromeStorage': {
                    const region = message.data.region;
                    chrome.storage[region].set(message.data.data, () => respond());
                    break;
                }
                case 'getChromeStorage': {
                    const keys = message.data.keys;
                    const region = message.data.region;
                    chrome.storage[region].get(keys as any, respond);
                    break;
                }
                case 'setNews':
                    setNewsForTesting(message.data);
                    respond();
                    break;
                // TODO(anton): remove this once Firefox supports tab.eval() via WebDriver BiDi
                case 'firefox-createTab':
                    ASSERT('Firefox-specific function', isFirefox);
                    chrome.tabs.update(testTabId!, {url: message.data, active: true}, () => respond());
                    break;
                case 'firefox-getColorScheme': {
                    ASSERT('Firefox-specific function', isFirefox);
                    respond(isSystemDarkModeEnabled() ? 'dark' : 'light');
                    break;
                }
                case 'firefox-emulateColorScheme': {
                    ASSERT('Firefox-specific function', isFirefox);
                    emulateColorScheme(message.data);
                    respond();
                    break;
                }
            }
        } catch (err) {
            socket.send(JSON.stringify({error: String(err), original: e.data}));
        }
    };

    chrome.downloads.onCreated.addListener(({id, mime, url, danger, paused}) => {
        // Cancel download
        chrome.downloads.cancel(id);

        try {
            const {protocol, origin} = new URL(url);
            const realOrigin = (new URL(chrome.runtime.getURL(''))).origin;
            const ok = paused === false && danger === 'safe' && protocol === 'blob:' && origin === realOrigin;
            socket.send(JSON.stringify({
                data: {
                    type: 'download',
                    ok,
                    mime,
                },
                id: null,
            }));
        } catch (e) {
            // Do nothing
        }
    });
}

if (__DEBUG__ && __LOG__) {
    chrome.runtime.onMessage.addListener((message: DebugMessageCStoBG) => {
        if (message.type === DebugMessageTypeCStoBG.LOG) {
            sendLog(message.data.level, message.data.log);
        }
    });
}

makeChromiumHappy();

function writeInstallationVersion(
    storage: chrome.storage.SyncStorageArea | chrome.storage.LocalStorageArea,
    details: chrome.runtime.InstalledDetails,
) {
    storage.get({installation: {version: ''}}, (data) => {
        if (data?.installation?.version) {
            return;
        }
        storage.set({installation: {
            date: Date.now(),
            reason: details.reason,
            version: details.previousVersion ?? chrome.runtime.getManifest().version,
        }});
    });
}

chrome.runtime.onInstalled.addListener((details) => {
    writeInstallationVersion(chrome.storage.local, details);
    writeInstallationVersion(chrome.storage.sync, details);
});

```

### background\config-manager.ts

```
import {DEFAULT_COLORSCHEME} from '../defaults';
import type {InversionFix, StaticTheme, DynamicThemeFix, DetectorHint} from '../definitions';
import {indexSiteListConfig, indexSitesFixesConfig, isURLInSiteList} from '../generators/utils/parse';
import type {SiteListIndex, SitePropsIndex} from '../generators/utils/parse';
import type {ParsedColorSchemeConfig} from '../utils/colorscheme-parser';
import {parseColorSchemeConfig} from '../utils/colorscheme-parser';
import {CONFIG_URL_BASE} from '../utils/links';
import {getDuration} from '../utils/time';

import UserStorage from './user-storage';
import {logWarn} from './utils/log';
import {readText} from './utils/network';

const CONFIG_URLs = {
    darkSites: {
        remote: `${CONFIG_URL_BASE}/dark-sites.config`,
        local: '../config/dark-sites.config',
    },
    dynamicThemeFixes: {
        remote: `${CONFIG_URL_BASE}/dynamic-theme-fixes.config`,
        local: '../config/dynamic-theme-fixes.config',
    },
    inversionFixes: {
        remote: `${CONFIG_URL_BASE}/inversion-fixes.config`,
        local: '../config/inversion-fixes.config',
    },
    staticThemes: {
        remote: `${CONFIG_URL_BASE}/static-themes.config`,
        local: '../config/static-themes.config',
    },
    colorSchemes: {
        remote: `${CONFIG_URL_BASE}/color-schemes.drconf`,
        local: '../config/color-schemes.drconf',
    },
    detectorHints: {
        remote: `${CONFIG_URL_BASE}/detector-hints.config`,
        local: '../config/detector-hints.config',
    },
};

const REMOTE_TIMEOUT_MS = getDuration({seconds: 10});

interface LocalConfig {
    local: boolean;
}

interface Config extends LocalConfig {
    name?: string;
    local: boolean;
    localURL: string;
    remoteURL?: string;
}

export default class ConfigManager {
    private static DARK_SITES_INDEX: SiteListIndex | null;
    static DETECTOR_HINTS_INDEX: SitePropsIndex<DetectorHint> | null;
    static DETECTOR_HINTS_RAW: string | null;
    static DYNAMIC_THEME_FIXES_INDEX: SitePropsIndex<DynamicThemeFix> | null;
    static DYNAMIC_THEME_FIXES_RAW: string | null;
    static INVERSION_FIXES_INDEX: SitePropsIndex<InversionFix> | null;
    static INVERSION_FIXES_RAW: string | null;
    static STATIC_THEMES_INDEX: SitePropsIndex<StaticTheme> | null;
    static STATIC_THEMES_RAW: string | null;
    static COLOR_SCHEMES_RAW: ParsedColorSchemeConfig | null;

    static raw = {
        darkSites: null as string | null,
        detectorHints: null as string | null,
        dynamicThemeFixes: null as string | null,
        inversionFixes: null as string | null,
        staticThemes: null as string | null,
        colorSchemes: null as string | null,
    };

    static overrides = {
        darkSites: null as string | null,
        detectorHints: null as string | null,
        dynamicThemeFixes: null as string | null,
        inversionFixes: null as string | null,
        staticThemes: null as string | null,
    };

    private static async loadConfig({
        name,
        local,
        localURL,
        remoteURL,
    }: Config) {
        let $config: string;
        const loadLocal = async () => await readText({url: localURL});
        if (local) {
            $config = await loadLocal();
        } else {
            try {
                $config = await readText({
                    url: `${remoteURL}?nocache=${Date.now()}`,
                    timeout: REMOTE_TIMEOUT_MS,
                });
            } catch (err) {
                console.error(`${name} remote load error`, err);
                $config = await loadLocal();
            }
        }
        return $config;
    }

    private static async loadColorSchemes({local}: LocalConfig) {
        const $config = await ConfigManager.loadConfig({
            name: 'Color Schemes',
            local,
            localURL: CONFIG_URLs.colorSchemes.local,
            remoteURL: CONFIG_URLs.colorSchemes.remote,
        });
        ConfigManager.raw.colorSchemes = $config;
        ConfigManager.handleColorSchemes();
    }

    private static async loadDarkSites({local}: LocalConfig) {
        const sites = await ConfigManager.loadConfig({
            name: 'Dark Sites',
            local,
            localURL: CONFIG_URLs.darkSites.local,
            remoteURL: CONFIG_URLs.darkSites.remote,
        });
        ConfigManager.raw.darkSites = sites;
        ConfigManager.handleDarkSites();
    }

    private static async loadDetectorHints({local}: LocalConfig) {
        const $config = await ConfigManager.loadConfig({
            name: 'Detector Hints',
            local,
            localURL: CONFIG_URLs.detectorHints.local,
            remoteURL: CONFIG_URLs.detectorHints.remote,
        });
        ConfigManager.raw.detectorHints = $config;
        ConfigManager.handleDetectorHints();
    }

    private static async loadDynamicThemeFixes({local}: LocalConfig) {
        const fixes = await ConfigManager.loadConfig({
            name: 'Dynamic Theme Fixes',
            local,
            localURL: CONFIG_URLs.dynamicThemeFixes.local,
            remoteURL: CONFIG_URLs.dynamicThemeFixes.remote,
        });
        ConfigManager.raw.dynamicThemeFixes = fixes;
        ConfigManager.handleDynamicThemeFixes();
    }

    private static async loadInversionFixes({local}: LocalConfig) {
        const fixes = await ConfigManager.loadConfig({
            name: 'Inversion Fixes',
            local,
            localURL: CONFIG_URLs.inversionFixes.local,
            remoteURL: CONFIG_URLs.inversionFixes.remote,
        });
        ConfigManager.raw.inversionFixes = fixes;
        ConfigManager.handleInversionFixes();
    }

    private static async loadStaticThemes({local}: LocalConfig) {
        const themes = await ConfigManager.loadConfig({
            name: 'Static Themes',
            local,
            localURL: CONFIG_URLs.staticThemes.local,
            remoteURL: CONFIG_URLs.staticThemes.remote,
        });
        ConfigManager.raw.staticThemes = themes;
        ConfigManager.handleStaticThemes();
    }

    static async load(config?: LocalConfig): Promise<void> {
        if (!config) {
            await UserStorage.loadSettings();
            config = {
                local: !UserStorage.settings.syncSitesFixes,
            };
        }

        await Promise.all([
            ConfigManager.loadColorSchemes(config),
            ConfigManager.loadDarkSites(config),
            ConfigManager.loadDetectorHints(config),
            ConfigManager.loadDynamicThemeFixes(config),
            ConfigManager.loadInversionFixes(config),
            ConfigManager.loadStaticThemes(config),
        ]).catch((err) => console.error('Fatality', err));
    }

    private static handleColorSchemes(): void {
        const $config = ConfigManager.raw.colorSchemes;
        const {result, error} = parseColorSchemeConfig($config || '');
        if (error) {
            logWarn(`Color Schemes parse error, defaulting to fallback. ${error}.`);
            ConfigManager.COLOR_SCHEMES_RAW = DEFAULT_COLORSCHEME;
            return;
        }
        ConfigManager.COLOR_SCHEMES_RAW = result;
    }

    private static handleDarkSites(): void {
        const $sites = ConfigManager.overrides.darkSites || ConfigManager.raw.darkSites;
        ConfigManager.DARK_SITES_INDEX = indexSiteListConfig($sites || '');
    }

    private static handleDetectorHints(): void {
        const $hints = ConfigManager.overrides.detectorHints || ConfigManager.raw.detectorHints || '';
        ConfigManager.DETECTOR_HINTS_INDEX = indexSitesFixesConfig<DetectorHint>($hints);
        ConfigManager.DETECTOR_HINTS_RAW = $hints;
    }

    static handleDynamicThemeFixes(): void {
        const $fixes = ConfigManager.overrides.dynamicThemeFixes || ConfigManager.raw.dynamicThemeFixes || '';
        ConfigManager.DYNAMIC_THEME_FIXES_INDEX = indexSitesFixesConfig<DynamicThemeFix>($fixes);
        ConfigManager.DYNAMIC_THEME_FIXES_RAW = $fixes;
    }

    static handleInversionFixes(): void {
        const $fixes = ConfigManager.overrides.inversionFixes || ConfigManager.raw.inversionFixes || '';
        ConfigManager.INVERSION_FIXES_INDEX = indexSitesFixesConfig<InversionFix>($fixes);
        ConfigManager.INVERSION_FIXES_RAW = $fixes;
    }

    static handleStaticThemes(): void {
        const $themes = ConfigManager.overrides.staticThemes || ConfigManager.raw.staticThemes || '';
        ConfigManager.STATIC_THEMES_INDEX = indexSitesFixesConfig<StaticTheme>($themes);
        ConfigManager.STATIC_THEMES_RAW = $themes;
    }

    static isURLInDarkList(url: string): boolean {
        return isURLInSiteList(url, ConfigManager.DARK_SITES_INDEX);
    }
}

```

### background\ui-highlights.ts

```
import {readLocalStorage, writeLocalStorage} from './utils/extension-api';

const proposedHighlights: string[] = [];

const KEY_UI_HIDDEN_HIGHLIGHTS = 'ui-hidden-highlights';

async function getHiddenHighlights() {
    const options = await readLocalStorage({[KEY_UI_HIDDEN_HIGHLIGHTS]: [] as string[]});
    return options[KEY_UI_HIDDEN_HIGHLIGHTS];
}

async function getHighlightsToShow(): Promise<string[]> {
    const hiddenHighlights = await getHiddenHighlights();
    return proposedHighlights.filter((h) => !hiddenHighlights.includes(h));
}

async function hideHighlights(keys: string[]): Promise<void> {
    const hiddenHighlights = await getHiddenHighlights();
    const update = Array.from(new Set([...hiddenHighlights, ...keys]));
    await writeLocalStorage({[KEY_UI_HIDDEN_HIGHLIGHTS]: update});
}

export default {
    getHighlightsToShow,
    hideHighlights,
};

```

### background\content-script-manager.ts

```
import {logWarn} from './utils/log';

declare const __CHROMIUM_MV3__: boolean;

enum ContentScriptManagerState {
    UNKNOWN,
    REGISTERING,
    REGISTERED,
    NOTREGISTERED
}

export default class ContentScriptManager {
    /**
     * TODO: migrate to using promises directly instead of wrapping callbacks.
     * Docs say that Promises are not supported yet, but in practice they appear
     * to be supported already...
     */

    static state: ContentScriptManagerState;

    static async registerScripts(updateContentScripts: () => Promise<void>): Promise<void> {
        if (!__CHROMIUM_MV3__) {
            logWarn('ContentScriptManager is useful only within MV3 builds.');
            return;
        }

        if (ContentScriptManager.state === ContentScriptManagerState.REGISTERING ||
            ContentScriptManager.state === ContentScriptManagerState.REGISTERED) {
            return;
        }

        ContentScriptManager.state = ContentScriptManagerState.REGISTERING;

        return new Promise<void>((resolve) =>
            chrome.scripting.getRegisteredContentScripts(
                {ids: ['stylesheet-proxy', 'content-scripts']},
                (scripts) => {
                    if (scripts.length === 2) {
                        ContentScriptManager.state = ContentScriptManagerState.REGISTERED;
                        resolve();
                    } else {
                        ContentScriptManager.state = ContentScriptManagerState.NOTREGISTERED;
                        updateContentScripts();
                        // Note: This API does not support registering injections into about:blank.
                        // That is, there is no alternative to InjectDetails.matchAboutBlank
                        // or static manifest declaration 'match_about_blank'.
                        // Therefore we need to also specify these scripts in manifest.json
                        // just for about:blank.
                        chrome.scripting.registerContentScripts([
                            {
                                id: 'stylesheet-proxy',
                                js: [
                                    'inject/proxy.js',
                                ],
                                runAt: 'document_start',
                                persistAcrossSessions: true,
                                matches: [
                                    '<all_urls>',
                                ],
                                allFrames: true,
                                world: 'MAIN',
                            },
                            {
                                id: 'content-scripts',
                                js: [
                                    'inject/fallback.js',
                                    'inject/index.js',
                                ],
                                runAt: 'document_start',
                                persistAcrossSessions: true,
                                matches: [
                                    '<all_urls>',
                                ],
                                allFrames: true,
                                world: 'ISOLATED',
                            },
                        ], resolve);
                    }
                }
            ));
    }

    static async unregisterScripts(): Promise<void> {
        if (!__CHROMIUM_MV3__) {
            logWarn('ContentScriptManager is useful only within MV3 builds.');
            return;
        }

        if (ContentScriptManager.state === ContentScriptManagerState.NOTREGISTERED) {
            return;
        }

        return new Promise<void>((resolve) => chrome.scripting.unregisterContentScripts(() => {
            ContentScriptManager.state = ContentScriptManagerState.NOTREGISTERED;
            resolve();
        }));
    }
}

```

### background\icon-manager.ts

```
import {isNonPersistent} from '../utils/platform';

interface IconState {
    badgeText: string;
    active: boolean;
}

interface IconOptions {
    colorScheme?: 'dark' | 'light';
    isActive?: boolean;
    tabId?: number;
}

export default class IconManager {
    private static readonly ICON_PATHS = {
        activeDark: {
            19: '../icons/dr_active_19.png',
            38: '../icons/dr_active_38.png',
        },
        activeLight: {
            19: '../icons/dr_active_light_19.png',
            38: '../icons/dr_active_light_38.png',
        },
        // Temporary disable the gray icon
        /*
        inactiveDark: {
            19: '../icons/dr_inactive_dark_19.png',
            38: '../icons/dr_inactive_dark_38.png',
        },
        inactiveLight: {
            19: '../icons/dr_inactive_light_19.png',
            38: '../icons/dr_inactive_light_38.png',
        },
        */
    };

    private static readonly iconState: IconState = {
        badgeText: '',
        active: true,
    };

    private static onStartup() {
        /**
         * This empty listener invokes extension background if extension has non-default
         * icon or badge. It is empty because all icon customizations will be initiated by
         * Extension class.
         * TODO: eventually, avoid running the whole Extension class on startup.
         */
    }

    /**
     * This method registers onStartup listener only if we are in non-persistent world and
     * icon is in non-default configuration.
     */
    private static handleUpdate() {
        if (!isNonPersistent) {
            return;
        }
        if (IconManager.iconState.badgeText !== '' || !IconManager.iconState.active) {
            chrome.runtime.onStartup.addListener(IconManager.onStartup);
        } else {
            chrome.runtime.onStartup.removeListener(IconManager.onStartup);
        }
    }

    static setIcon({isActive = this.iconState.active, colorScheme = 'dark', tabId}: IconOptions): void {
        if (!chrome.browserAction.setIcon) {
            return;
        }
        // Temporary disable per-site icons
        // eslint-disable-next-line no-empty
        if (colorScheme === 'dark') {
        }
        if (tabId) {
            return;
        }

        this.iconState.active = isActive;

        let path = this.ICON_PATHS.activeDark;
        if (isActive) {
            // Temporary disable the gray icon
            // path = colorScheme === 'dark' ? IconManager.ICON_PATHS.activeDark : IconManager.ICON_PATHS.activeLight;
            path = IconManager.ICON_PATHS.activeDark;
        } else {
            // Temporary disable the gray icon
            // path = colorScheme === 'dark' ? IconManager.ICON_PATHS.inactiveDark : IconManager.ICON_PATHS.inactiveLight;
            path = IconManager.ICON_PATHS.activeLight;
        }

        // Temporary disable per-site icons
        /*
        if (tabId) {
            chrome.browserAction.setIcon({tabId, path});
        } else {
            chrome.browserAction.setIcon({path});
            IconManager.handleUpdate();
        }
        */
        chrome.browserAction.setIcon({path});
        IconManager.handleUpdate();
    }

    static showBadge(text: string): void {
        IconManager.iconState.badgeText = text;
        chrome.browserAction.setBadgeBackgroundColor({color: '#e96c4c'});
        chrome.browserAction.setBadgeText({text});
        IconManager.handleUpdate();
    }

    static hideBadge(): void {
        IconManager.iconState.badgeText = '';
        chrome.browserAction.setBadgeText({text: ''});
        IconManager.handleUpdate();
    }
}

```

### background\extension.ts

```
import type {ExtensionData, Theme, Shortcuts, UserSettings, TabInfo, TabData, Command, DevToolsData} from '../definitions';
import createCSSFilterStylesheet from '../generators/css-filter';
import {getDetectorHintsFor} from '../generators/detector-hints';
import {getDynamicThemeFixesFor} from '../generators/dynamic-theme';
import createStaticStylesheet from '../generators/static-theme';
import {createSVGFilterStylesheet, getSVGFilterMatrixValue, getSVGReverseFilterMatrixValue} from '../generators/svg-filter';
import {ThemeEngine} from '../generators/theme-engines';
import {AutomationMode} from '../utils/automation';
import {debounce} from '../utils/debounce';
import {isSystemDarkModeEnabled, runColorSchemeChangeDetector} from '../utils/media-query';
import {MessageTypeBGtoCS} from '../utils/message';
import {isFirefox} from '../utils/platform';
import {PromiseBarrier} from '../utils/promise-barrier';
import {StateManager} from '../utils/state-manager';
import {getActiveTab} from '../utils/tabs';
import {isInTimeIntervalLocal, nextTimeInterval, isNightAtLocation, nextTimeChangeAtLocation, getDuration} from '../utils/time';
import {isURLInList, getURLHostOrProtocol, isURLEnabled, isPDF} from '../utils/url';

import ConfigManager from './config-manager';
import DevTools from './devtools';
import IconManager from './icon-manager';
import type {ExtensionAdapter} from './messenger';
import Messenger from './messenger';
import Newsmaker from './newsmaker';
import TabManager from './tab-manager';
import UIHighlights from './ui-highlights';
import UserStorage from './user-storage';
import {getCommands, canInjectScript} from './utils/extension-api';
import {logInfo, logWarn} from './utils/log';
import {setWindowTheme, resetWindowTheme} from './window-theme';


type AutomationState = 'turn-on' | 'turn-off' | 'scheme-dark' | 'scheme-light' | '';

interface ExtensionState extends Record<string, unknown> {
    autoState: AutomationState;
    wasEnabledOnLastCheck: boolean | null;
    registeredContextMenus: boolean | null;
}

interface SystemColorState extends Record<string, unknown> {
    wasLastColorSchemeDark: boolean | null;
}

declare const __CHROMIUM_MV3__: boolean;

export class Extension {
    private static autoState: AutomationState = '';
    private static wasEnabledOnLastCheck: boolean | null = null;
    private static registeredContextMenus: boolean | null = null;
    /**
     * This value is used for two purposes:
     *  - to bypass Firefox bug
     *  - to filter out excessive Extension.onColorSchemeChange() invocations
     */
    private static wasLastColorSchemeDark: boolean | null = null;
    private static startBarrier: PromiseBarrier<void, void> | null = null;
    private static stateManager: StateManager<ExtensionState> | null = null;

    private static readonly ALARM_NAME = 'auto-time-alarm';
    private static readonly LOCAL_STORAGE_KEY = 'Extension-state';

    // Store system color theme
    private static readonly SYSTEM_COLOR_LOCAL_STORAGE_KEY = 'system-color-state';
    private static systemColorStateManager: StateManager<SystemColorState>;

    // Record whether Extension.init() already ran since the last GB start
    private static initialized = false;

    static isFirstLoad = false;

    // This sync initializer needs to run on every BG restart before anything else can happen
    private static init() {
        if (Extension.initialized) {
            return;
        }
        Extension.initialized = true;

        DevTools.init(Extension.onSettingsChanged);
        Messenger.init(Extension.getMessengerAdapter());
        TabManager.init({
            getConnectionMessage: Extension.getConnectionMessage,
            getTabMessage: Extension.getTabMessage,
            onColorSchemeChange: Extension.onColorSchemeChange,
        });

        Extension.startBarrier = new PromiseBarrier();
        Extension.stateManager = new StateManager<ExtensionState>(Extension.LOCAL_STORAGE_KEY, Extension, {
            autoState: '',
            wasEnabledOnLastCheck: null,
            registeredContextMenus: null,
        }, logWarn);

        chrome.alarms.onAlarm.addListener(Extension.alarmListener);

        if (chrome.commands) {
            // Firefox Android does not support chrome.commands
            if (isFirefox) {
                // Firefox may not register onCommand listener on extension startup so we need to use setTimeout
                setTimeout(() => chrome.commands.onCommand.addListener(async (command) => Extension.onCommand(command as Command, null, null, null)));
            } else {
                chrome.commands.onCommand.addListener(async (command, tab) => Extension.onCommand(command as Command, tab && tab.id! || null, 0, null));
            }
        }

        if (chrome.permissions.onRemoved) {
            chrome.permissions.onRemoved.addListener((permissions) => {
                // As far as we know, this code is never actually run because there
                // is no browser UI for removing 'contextMenus' permission.
                // This code exists for future-proofing in case browsers ever add such UI.
                if (!permissions?.permissions?.includes('contextMenus')) {
                    Extension.registeredContextMenus = false;
                }
            });
        }
    }

    private static async MV3syncSystemColorStateManager(isDark: boolean | null): Promise<void> {
        if (!__CHROMIUM_MV3__) {
            return;
        }
        if (!Extension.systemColorStateManager) {
            Extension.systemColorStateManager = new StateManager<SystemColorState>(Extension.SYSTEM_COLOR_LOCAL_STORAGE_KEY, Extension, {
                wasLastColorSchemeDark: isDark,
            }, logWarn);
        }
        if (isDark === null) {
            // Attempt to restore data from storage
            return Extension.systemColorStateManager.loadState();
        } else if (Extension.wasLastColorSchemeDark !== isDark) {
            Extension.wasLastColorSchemeDark = isDark;
            return Extension.systemColorStateManager.saveState();
        }
    }

    private static alarmListener = (alarm: chrome.alarms.Alarm): void => {
        if (alarm.name === Extension.ALARM_NAME) {
            Extension.loadData().then(() => Extension.handleAutomationCheck());
        }
    };

    private static isExtensionSwitchedOn() {
        return (
            Extension.autoState === 'turn-on' ||
            Extension.autoState === 'scheme-dark' ||
            Extension.autoState === 'scheme-light' ||
            (Extension.autoState === '' && UserStorage.settings.enabled)
        );
    }

    private static updateAutoState() {
        const {mode, behavior, enabled} = UserStorage.settings.automation;

        let isAutoDark: boolean | null | undefined;
        let nextCheck: number | null | undefined;
        switch (mode) {
            case AutomationMode.TIME: {
                const {time} = UserStorage.settings;
                isAutoDark = isInTimeIntervalLocal(time.activation, time.deactivation);
                nextCheck = nextTimeInterval(time.activation, time.deactivation);
                break;
            }
            case AutomationMode.SYSTEM:
                if (__CHROMIUM_MV3__) {
                    isAutoDark = Extension.wasLastColorSchemeDark;
                    if (Extension.wasLastColorSchemeDark === null) {
                        logWarn('System color scheme is unknown. Defaulting to Dark.');
                        isAutoDark = true;
                    }
                    break;
                }
                isAutoDark = Extension.wasLastColorSchemeDark === null
                    ? isSystemDarkModeEnabled()
                    : Extension.wasLastColorSchemeDark;
                if (isFirefox) {
                    runColorSchemeChangeDetector(Extension.onColorSchemeChange);
                }
                break;
            case AutomationMode.LOCATION: {
                const {latitude, longitude} = UserStorage.settings.location;
                if (latitude != null && longitude != null) {
                    isAutoDark = isNightAtLocation(latitude, longitude);
                    nextCheck = nextTimeChangeAtLocation(latitude, longitude);
                }
                break;
            }
            case AutomationMode.NONE:
                break;
        }

        let state: AutomationState = '';
        if (enabled) {
            if (behavior === 'OnOff') {
                state = isAutoDark ? 'turn-on' : 'turn-off';
            } else if (behavior === 'Scheme') {
                state = isAutoDark ? 'scheme-dark' : 'scheme-light';
            }
        }
        Extension.autoState = state;

        if (nextCheck) {
            if (nextCheck < Date.now()) {
                logWarn(`Alarm is set in the past: ${nextCheck}. The time is: ${new Date()}. ISO: ${(new Date()).toISOString()}`);
            } else {
                chrome.alarms.create(Extension.ALARM_NAME, {when: nextCheck});
            }
        }
    }

    private static wakeInterval: number = -1;

    private static runWakeDetector() {
        const WAKE_CHECK_INTERVAL = getDuration({minutes: 1});
        const WAKE_CHECK_INTERVAL_ERROR = getDuration({seconds: 10});
        if (this.wakeInterval >= 0) {
            clearInterval(this.wakeInterval);
        }

        let lastRun = Date.now();
        this.wakeInterval = setInterval(() => {
            const now = Date.now();
            if (now - lastRun > WAKE_CHECK_INTERVAL + WAKE_CHECK_INTERVAL_ERROR) {
                Extension.handleAutomationCheck();
            }
            lastRun = now;
        }, WAKE_CHECK_INTERVAL);
    }

    static async start(): Promise<void> {
        Extension.init();
        await TabManager.cleanState();
        await Promise.all([
            ConfigManager.load({local: true}),
            Extension.MV3syncSystemColorStateManager(null),
            UserStorage.loadSettings(),
        ]);

        if (UserStorage.settings.enableContextMenus && !Extension.registeredContextMenus) {
            chrome.permissions.contains({permissions: ['contextMenus']}, (permitted) => {
                if (permitted) {
                    Extension.registerContextMenus();
                } else {
                    logWarn('User has enabled context menus, but did not provide permission.');
                }
            });
        }
        if (UserStorage.settings.syncSitesFixes) {
            await ConfigManager.load({local: false});
        }
        Extension.updateAutoState();
        Extension.runWakeDetector();
        Extension.onAppToggle();
        logInfo('loaded', UserStorage.settings);

        if (!__CHROMIUM_MV3__ || Extension.isFirstLoad) {
            TabManager.updateContentScript({runOnProtectedPages: UserStorage.settings.enableForProtectedPages});
        }

        UserStorage.settings.fetchNews && Newsmaker.subscribe();
        Extension.startBarrier!.resolve();
    }

    private static getMessengerAdapter(): ExtensionAdapter {
        return {
            collect: async () => {
                return await Extension.collectData();
            },
            collectDevToolsData: async () => {
                return await Extension.collectDevToolsData();
            },
            changeSettings: Extension.changeSettings,
            setTheme: Extension.setTheme,
            toggleActiveTab: Extension.toggleActiveTab,
            markNewsAsRead: Newsmaker.markAsRead,
            markNewsAsDisplayed: Newsmaker.markAsDisplayed,
            loadConfig: ConfigManager.load,
            applyDevDynamicThemeFixes: DevTools.applyDynamicThemeFixes,
            resetDevDynamicThemeFixes: DevTools.resetDynamicThemeFixes,
            applyDevInversionFixes: DevTools.applyInversionFixes,
            resetDevInversionFixes: DevTools.resetInversionFixes,
            applyDevStaticThemes: DevTools.applyStaticThemes,
            resetDevStaticThemes: DevTools.resetStaticThemes,
            hideHighlights: UIHighlights.hideHighlights,
        };
    }

    private static onCommandInternal = async (command: Command, tabId: number | null, frameId: number | null, frameURL: string | null) => {
        if (Extension.startBarrier!.isPending()) {
            await Extension.startBarrier!.entry();
        }
        Extension.stateManager!.loadState();
        switch (command) {
            case 'toggle':
                logInfo('Toggle command entered');
                Extension.changeSettings({
                    enabled: !Extension.isExtensionSwitchedOn(),
                    automation: {...UserStorage.settings.automation, ...{enabled: false}},
                });
                break;
            case 'addSite': {
                logInfo('Add Site command entered');
                async function scriptPDF(tabId: number, frameId: number): Promise<boolean> {
                    // We can not detect PDF if we do not know where we are looking for it
                    if (!(Number.isInteger(tabId) && Number.isInteger(frameId))) {
                        return false;
                    }
                    function detectPDF(): boolean {
                        if (document.body.childElementCount !== 1) {
                            return false;
                        }
                        const {nodeName, type} = document.body.childNodes[0] as HTMLEmbedElement;
                        return nodeName === 'EMBED' && type === 'application/pdf';
                    }

                    if (__CHROMIUM_MV3__) {
                        return (await chrome.scripting.executeScript({
                            target: {tabId, frameIds: [frameId]},
                            func: detectPDF,
                        }))[0].result || false;
                    } else if (__CHROMIUM_MV2__) {
                        return new Promise<boolean>((resolve) => chrome.tabs.executeScript(tabId, {
                            frameId,
                            code: `(${detectPDF.toString()})()`,
                        }, ([r]) => resolve(r)));
                    }
                    return false;
                }

                const pdf = async () => isPDF(frameURL || await TabManager.getActiveTabURL());
                if (((__CHROMIUM_MV2__ || __CHROMIUM_MV3__) && await scriptPDF(tabId!, frameId!)) || await pdf()) {
                    Extension.changeSettings({enableForPDF: !UserStorage.settings.enableForPDF});
                } else {
                    Extension.toggleActiveTab();
                }
                break;
            }
            case 'switchEngine': {
                logInfo('Switch Engine command entered');
                const engines = Object.values(ThemeEngine);
                const index = engines.indexOf(UserStorage.settings.theme.engine);
                const next = engines[(index + 1) % engines.length];
                Extension.setTheme({engine: next});
                break;
            }
        }
    };

    // 75 is small enough to not notice it, and still catches when someone
    // is holding down a certain shortcut.
    private static onCommand = debounce(75, Extension.onCommandInternal);

    private static registerContextMenus() {
        chrome.contextMenus.onClicked.addListener(async ({menuItemId, frameId, frameUrl, pageUrl}, tab) =>
            Extension.onCommand(menuItemId as Command, tab && tab.id || null, frameId || null, frameUrl || pageUrl || null));
        chrome.contextMenus.removeAll(() => {
            Extension.registeredContextMenus = false;
            chrome.contextMenus.create({
                id: 'DarkReader-top',
                title: 'Dark Reader',
            }, () => {
                if (chrome.runtime.lastError) {
                    // Failed to create the context menu
                    return;
                }
                const msgToggle = chrome.i18n.getMessage('toggle_extension');
                const msgAddSite = chrome.i18n.getMessage('toggle_current_site');
                const msgSwitchEngine = chrome.i18n.getMessage('theme_generation_mode');
                chrome.contextMenus.create({
                    id: 'toggle',
                    parentId: 'DarkReader-top',
                    title: msgToggle || 'Toggle everywhere',
                });
                chrome.contextMenus.create({
                    id: 'addSite',
                    parentId: 'DarkReader-top',
                    title: msgAddSite || 'Toggle for current site',
                });
                chrome.contextMenus.create({
                    id: 'switchEngine',
                    parentId: 'DarkReader-top',
                    title: msgSwitchEngine || 'Switch engine',
                });
                Extension.registeredContextMenus = true;
            });
        });
    }

    private static async getShortcuts() {
        const commands = await getCommands();
        return commands.reduce((map, cmd) => Object.assign(map, {[cmd.name!]: cmd.shortcut}), {} as Shortcuts);
    }

    static async collectData(): Promise<ExtensionData> {
        await Extension.loadData();
        const [
            news,
            shortcuts,
            activeTab,
            isAllowedFileSchemeAccess,
            uiHighlights,
        ] = await Promise.all([
            Newsmaker.getLatest(),
            Extension.getShortcuts(),
            Extension.getActiveTabInfo(),
            new Promise<boolean>((r) => chrome.extension.isAllowedFileSchemeAccess(r)),
            UIHighlights.getHighlightsToShow(),
        ]);
        return {
            isEnabled: Extension.isExtensionSwitchedOn(),
            isReady: true,
            isAllowedFileSchemeAccess,
            settings: UserStorage.settings,
            news,
            shortcuts,
            colorScheme: ConfigManager.COLOR_SCHEMES_RAW!,
            forcedScheme: Extension.autoState === 'scheme-dark' ? 'dark' : Extension.autoState === 'scheme-light' ? 'light' : null,
            activeTab,
            uiHighlights,
        };
    }

    static async collectDevToolsData(): Promise<DevToolsData> {
        const [
            dynamicFixesText,
            filterFixesText,
            staticThemesText,
        ] = await Promise.all([
            DevTools.getDynamicThemeFixesText(),
            DevTools.getInversionFixesText(),
            DevTools.getStaticThemesText(),
        ]);
        return {
            dynamicFixesText,
            filterFixesText,
            staticThemesText,
        };
    }

    private static async getActiveTabInfo(): Promise<TabInfo> {
        await Extension.loadData();
        const tab = await getActiveTab();
        const url = await TabManager.getTabURL(tab);
        const {isInDarkList, isProtected} = Extension.getTabInfo(url);
        const isInjected = TabManager.canAccessTab(tab);
        const documentId = TabManager.getTabDocumentId(tab);
        let isDarkThemeDetected = null;
        if (UserStorage.settings.detectDarkTheme) {
            isDarkThemeDetected = TabManager.isTabDarkThemeDetected(tab);
        }
        const id = tab && tab.id || null;
        return {
            id,
            documentId,
            url,
            isInDarkList,
            isProtected,
            isInjected,
            isDarkThemeDetected,
        };
    }

    private static async getConnectionMessage(tabURL: string, url: string, isTopFrame: boolean, topFrameHasDarkTheme?: boolean) {
        await Extension.loadData();
        return Extension.getTabMessage(tabURL, url, isTopFrame, topFrameHasDarkTheme);
    }

    private static async loadData() {
        Extension.init();
        await Promise.all([
            Extension.stateManager!.loadState(),
            UserStorage.loadSettings(),
        ]);
    }

    private static onColorSchemeChange = async (isDark: boolean) => {
        if (Extension.wasLastColorSchemeDark === isDark) {
            // If color scheme was already correct, we do not need to do anything
            return;
        }
        Extension.wasLastColorSchemeDark = isDark;
        Extension.MV3syncSystemColorStateManager(isDark);
        await Extension.loadData();
        if (UserStorage.settings.automation.mode !== AutomationMode.SYSTEM) {
            return;
        }
        Extension.handleAutomationCheck();
    };

    private static handleAutomationCheck = () => {
        Extension.updateAutoState();

        const isSwitchedOn = Extension.isExtensionSwitchedOn();
        if (
            Extension.wasEnabledOnLastCheck === null ||
            Extension.wasEnabledOnLastCheck !== isSwitchedOn ||
            Extension.autoState === 'scheme-dark' ||
            Extension.autoState === 'scheme-light'
        ) {
            Extension.wasEnabledOnLastCheck = isSwitchedOn;
            Extension.onAppToggle();
            TabManager.sendMessage();
            Extension.reportChanges();
            Extension.stateManager!.saveState();
        }
    };

    static async changeSettings($settings: Partial<UserSettings>, onlyUpdateActiveTab = false): Promise<void> {
        const promises = [];
        const prev = {...UserStorage.settings};

        UserStorage.set($settings);

        if (
            (prev.enabled !== UserStorage.settings.enabled) ||
            (prev.automation.enabled !== UserStorage.settings.automation.enabled) ||
            (prev.automation.mode !== UserStorage.settings.automation.mode) ||
            (prev.automation.behavior !== UserStorage.settings.automation.behavior) ||
            (prev.time.activation !== UserStorage.settings.time.activation) ||
            (prev.time.deactivation !== UserStorage.settings.time.deactivation) ||
            (prev.location.latitude !== UserStorage.settings.location.latitude) ||
            (prev.location.longitude !== UserStorage.settings.location.longitude)
        ) {
            Extension.updateAutoState();
            Extension.onAppToggle();
        }
        if (prev.syncSettings !== UserStorage.settings.syncSettings) {
            const promise = UserStorage.saveSyncSetting(UserStorage.settings.syncSettings);
            promises.push(promise);
        }
        if (Extension.isExtensionSwitchedOn() && $settings.changeBrowserTheme != null && prev.changeBrowserTheme !== $settings.changeBrowserTheme) {
            if ($settings.changeBrowserTheme) {
                setWindowTheme(UserStorage.settings.theme);
            } else {
                resetWindowTheme();
            }
        }
        if (prev.fetchNews !== UserStorage.settings.fetchNews) {
            UserStorage.settings.fetchNews ? Newsmaker.subscribe() : Newsmaker.unSubscribe();
        }

        if (prev.enableContextMenus !== UserStorage.settings.enableContextMenus) {
            if (UserStorage.settings.enableContextMenus) {
                Extension.registerContextMenus();
            } else {
                chrome.contextMenus.removeAll();
            }
        }
        const promise = Extension.onSettingsChanged(onlyUpdateActiveTab);
        promises.push(promise);
        await Promise.all(promises);
    }

    private static setTheme($theme: Partial<Theme>) {
        UserStorage.set({theme: {...UserStorage.settings.theme, ...$theme}});

        if (Extension.isExtensionSwitchedOn() && UserStorage.settings.changeBrowserTheme) {
            setWindowTheme(UserStorage.settings.theme);
        }

        Extension.onSettingsChanged();
    }

    private static async reportChanges() {
        const info = await Extension.collectData();
        Messenger.reportChanges(info);
    }

    private static async toggleActiveTab() {
        const settings = UserStorage.settings;
        const tab = await Extension.getActiveTabInfo();
        if (!tab) {
            return;
        }
        const {url} = tab;
        const isInDarkList = ConfigManager.isURLInDarkList(url);
        const host = getURLHostOrProtocol(url);

        function getToggledList(sourceList: string[]) {
            const list = sourceList.slice();

            let index = list.indexOf(host);
            if (index < 0 && host.startsWith('www.')) {
                const noWwwHost = host.substring(4);
                index = list.indexOf(noWwwHost);
            }

            if (index < 0) {
                list.push(host);
            } else {
                list.splice(index, 1);
            }
            return list;
        }

        const darkThemeDetected = settings.enabledByDefault && settings.detectDarkTheme && tab.isDarkThemeDetected;
        if (!settings.enabledByDefault || isInDarkList || darkThemeDetected) {
            const toggledList = getToggledList(settings.enabledFor);
            Extension.changeSettings({enabledFor: toggledList}, true);
            return;
        }
        if (settings.enabledByDefault && settings.enabledFor.includes(host)) {
            const enabledFor = getToggledList(settings.enabledFor);
            const disabledFor = getToggledList(settings.disabledFor);
            Extension.changeSettings({enabledFor, disabledFor}, true);
            return;
        }

        const toggledList = getToggledList(settings.disabledFor);
        Extension.changeSettings({disabledFor: toggledList}, true);
    }

    //------------------------------------
    //
    //       Handle config changes
    //

    private static onAppToggle() {
        if (Extension.isExtensionSwitchedOn()) {
            IconManager.setIcon({isActive: true, colorScheme: UserStorage.settings.theme.mode ? 'dark' : 'light'});
        } else {
            IconManager.setIcon({isActive: false, colorScheme: UserStorage.settings.theme.mode ? 'dark' : 'light'});
        }

        if (UserStorage.settings.changeBrowserTheme) {
            if (Extension.isExtensionSwitchedOn() && Extension.autoState !== 'scheme-light') {
                setWindowTheme(UserStorage.settings.theme);
            } else {
                resetWindowTheme();
            }
        }
    }

    private static async onSettingsChanged(onlyUpdateActiveTab = false) {
        await Extension.loadData();
        Extension.wasEnabledOnLastCheck = Extension.isExtensionSwitchedOn();
        TabManager.sendMessage(onlyUpdateActiveTab);
        Extension.saveUserSettings();
        Extension.reportChanges();
        IconManager.setIcon({colorScheme: UserStorage.settings.theme.mode ? 'dark' : 'light'});
        Extension.stateManager!.saveState();
    }

    //----------------------
    //
    // Add/remove css to tab
    //
    //----------------------

    private static getTabInfo(tabURL: string): Pick<TabInfo, 'isInDarkList' | 'isProtected'> {
        const isInDarkList = ConfigManager.isURLInDarkList(tabURL);
        const isProtected = !canInjectScript(tabURL);
        return {
            isInDarkList,
            isProtected,
        };
    }

    private static getTabMessage = (tabURL: string, url: string, isTopFrame: boolean, topFrameHasDarkTheme?: boolean): TabData => {
        const settings = UserStorage.settings;
        const tabInfo = Extension.getTabInfo(tabURL);
        if (Extension.isExtensionSwitchedOn() && isURLEnabled(tabURL, settings, tabInfo) && !topFrameHasDarkTheme) {
            const custom = settings.customThemes.find(({url: urlList}) => isURLInList(tabURL, urlList));
            const preset = custom ? null : settings.presets.find(({urls}) => isURLInList(tabURL, urls));
            let theme = custom ? custom.theme : preset ? preset.theme : settings.theme;
            if (Extension.autoState === 'scheme-dark' || Extension.autoState === 'scheme-light') {
                const mode = Extension.autoState === 'scheme-dark' ? 1 : 0;
                theme = {...theme, mode};
            }
            const detectorHints = settings.detectDarkTheme ? getDetectorHintsFor(url, ConfigManager.DETECTOR_HINTS_RAW!, ConfigManager.DETECTOR_HINTS_INDEX!) : null;
            const detectDarkTheme = (
                settings.detectDarkTheme &&
                (isTopFrame || detectorHints?.some((h) => h.iframe)) &&
                !isURLInList(tabURL, settings.enabledFor) &&
                !isPDF(tabURL)
            );

            logInfo(`Creating CSS for url: ${url}`);
            logInfo(`Custom theme ${custom ? 'was found' : 'was not found'}, Preset theme ${preset ? 'was found' : 'was not found'}
            The theme(${custom ? 'custom' : preset ? 'preset' : 'global'} settings) used is: ${JSON.stringify(theme)}`);
            switch (theme.engine) {
                case ThemeEngine.cssFilter: {
                    return {
                        type: MessageTypeBGtoCS.ADD_CSS_FILTER,
                        data: {
                            css: createCSSFilterStylesheet(theme, url, isTopFrame, ConfigManager.INVERSION_FIXES_RAW!, ConfigManager.INVERSION_FIXES_INDEX!),
                            detectDarkTheme,
                            detectorHints,
                            theme,
                        },
                    };
                }
                case ThemeEngine.svgFilter: {
                    if (isFirefox) {
                        return {
                            type: MessageTypeBGtoCS.ADD_CSS_FILTER,
                            data: {
                                css: createSVGFilterStylesheet(theme, url, isTopFrame, ConfigManager.INVERSION_FIXES_RAW!, ConfigManager.INVERSION_FIXES_INDEX!),
                                detectDarkTheme,
                                detectorHints,
                                theme,
                            },
                        };
                    }
                    return {
                        type: MessageTypeBGtoCS.ADD_SVG_FILTER,
                        data: {
                            css: createSVGFilterStylesheet(theme, url, isTopFrame, ConfigManager.INVERSION_FIXES_RAW!, ConfigManager.INVERSION_FIXES_INDEX!),
                            svgMatrix: getSVGFilterMatrixValue(theme),
                            svgReverseMatrix: getSVGReverseFilterMatrixValue(),
                            detectDarkTheme,
                            detectorHints,
                            theme,
                        },
                    };
                }
                case ThemeEngine.staticTheme: {
                    return {
                        type: MessageTypeBGtoCS.ADD_STATIC_THEME,
                        data: {
                            css: theme.stylesheet && theme.stylesheet.trim() ?
                                theme.stylesheet :
                                createStaticStylesheet(theme, url, isTopFrame, ConfigManager.STATIC_THEMES_RAW!, ConfigManager.STATIC_THEMES_INDEX!),
                            detectDarkTheme: settings.detectDarkTheme,
                            detectorHints,
                            theme,
                        },
                    };
                }
                case ThemeEngine.dynamicTheme: {
                    const fixes = getDynamicThemeFixesFor(url, isTopFrame, ConfigManager.DYNAMIC_THEME_FIXES_RAW!, ConfigManager.DYNAMIC_THEME_FIXES_INDEX!, UserStorage.settings.enableForPDF);
                    return {
                        type: MessageTypeBGtoCS.ADD_DYNAMIC_THEME,
                        data: {
                            theme,
                            fixes,
                            isIFrame: !isTopFrame,
                            detectDarkTheme,
                            detectorHints,
                        },
                    };
                }
                default:
                    throw new Error(`Unknown engine ${theme.engine}`);
            }
        }

        logInfo(`Site is not inverted: ${tabURL}`);
        return {
            type: MessageTypeBGtoCS.CLEAN_UP,
        };
    };

    //-------------------------------------
    //          User settings

    private static async saveUserSettings() {
        await UserStorage.saveSettings();
        logInfo('saved', UserStorage.settings);
    }
}

```

### background\devtools.ts

```
import {parseInversionFixes, formatInversionFixes} from '../generators/css-filter';
import {parseDynamicThemeFixes, formatDynamicThemeFixes} from '../generators/dynamic-theme';
import {parseStaticThemes, formatStaticThemes} from '../generators/static-theme';
import {isFirefox} from '../utils/platform';

import ConfigManager from './config-manager';
import {logInfo} from './utils/log';

// TODO(bershanskiy): Add support for reads/writes of multiple keys at once for performance.
// TODO(bershanskiy): Popup UI heeds only hasCustom*Fixes() and nothing else. Consider storing that data separately.
interface DevToolsStorage {
    get(key: string): Promise<string | null>;
    set(key: string, value: string): Promise<void> | void;
    remove(key: string): Promise<void> | void;
    has(key: string): Promise<boolean> | boolean;
}

class PersistentStorageWrapper implements DevToolsStorage {
    // Cache information within background context for future use without waiting.
    private cache: {[key: string]: string | null} = {};

    async get(key: string) {
        if (key in this.cache) {
            return this.cache[key];
        }
        return new Promise<string | null>((resolve) => {
            chrome.storage.local.get(key, (result) => {
                // If cache received a new value (from call to set())
                // before we retrieved the old value from storage,
                // return the new value.
                if (key in this.cache) {
                    logInfo(`Key ${key} was written to during read operation.`);
                    resolve(this.cache[key]);
                    return;
                }

                if (chrome.runtime.lastError) {
                    console.error('Failed to query DevTools data', chrome.runtime.lastError);
                    resolve(null);
                    return;
                }

                this.cache[key] = result[key];
                resolve(result[key]);
            });
        });
    }

    async set(key: string, value: string) {
        this.cache[key] = value;
        return new Promise<void>((resolve) => chrome.storage.local.set({[key]: value}, () => {
            if (chrome.runtime.lastError) {
                console.error('Failed to write DevTools data', chrome.runtime.lastError);
            } else {
                resolve();
            }
        }));
    }

    async remove(key: string) {
        this.cache[key] = null;
        return new Promise<void>((resolve) => chrome.storage.local.remove(key, () => {
            if (chrome.runtime.lastError) {
                console.error('Failed to delete DevTools data', chrome.runtime.lastError);
            } else {
                resolve();
            }
        }));
    }

    async has(key: string) {
        return Boolean(await this.get(key));
    }
}

class TempStorage implements DevToolsStorage {
    private map = new Map<string, string>();

    async get(key: string) {
        return this.map.get(key) || null;
    }

    set(key: string, value: string) {
        this.map.set(key, value);
    }

    remove(key: string) {
        this.map.delete(key);
    }

    async has(key: string) {
        return this.map.has(key);
    }
}

export default class DevTools {
    private static onChange: () => void;
    private static store: DevToolsStorage;

    static init(onChange: () => void): void {
        // Firefox don't seem to like using storage.local to store big data on the background-extension.
        // Disabling it for now and defaulting back to localStorage.
        if (!isFirefox && typeof chrome.storage.local !== 'undefined' && chrome.storage.local !== null) {
            DevTools.store = new PersistentStorageWrapper();
        } else {
            DevTools.store = new TempStorage();
        }
        DevTools.loadConfigOverrides();
        DevTools.onChange = onChange;
    }

    private static KEY_DYNAMIC = 'dev_dynamic_theme_fixes';
    private static KEY_FILTER = 'dev_inversion_fixes';
    private static KEY_STATIC = 'dev_static_themes';

    private static async loadConfigOverrides(): Promise<void> {
        const [
            dynamicThemeFixes,
            inversionFixes,
            staticThemes,
        ] = await Promise.all([
            DevTools.getSavedDynamicThemeFixes(),
            DevTools.getSavedInversionFixes(),
            DevTools.getSavedStaticThemes(),
        ]);
        ConfigManager.overrides.dynamicThemeFixes = dynamicThemeFixes || null;
        ConfigManager.overrides.inversionFixes = inversionFixes || null;
        ConfigManager.overrides.staticThemes = staticThemes || null;
    }

    private static async getSavedDynamicThemeFixes() {
        return DevTools.store.get(DevTools.KEY_DYNAMIC);
    }

    private static saveDynamicThemeFixes(text: string) {
        DevTools.store.set(DevTools.KEY_DYNAMIC, text);
    }

    static async getDynamicThemeFixesText(): Promise<string> {
        let rawFixes = await DevTools.getSavedDynamicThemeFixes();
        if (!rawFixes) {
            await ConfigManager.load();
            rawFixes = ConfigManager.DYNAMIC_THEME_FIXES_RAW || '';
        }
        const fixes = parseDynamicThemeFixes(rawFixes);
        return formatDynamicThemeFixes(fixes);
    }

    static resetDynamicThemeFixes(): void {
        DevTools.store.remove(DevTools.KEY_DYNAMIC);
        ConfigManager.overrides.dynamicThemeFixes = null;
        ConfigManager.handleDynamicThemeFixes();
        DevTools.onChange();
    }

    // TODO(Anton): remove any
    static applyDynamicThemeFixes(text: string): any {
        try {
            const formatted = formatDynamicThemeFixes(parseDynamicThemeFixes(text));
            ConfigManager.overrides.dynamicThemeFixes = formatted;
            ConfigManager.handleDynamicThemeFixes();
            DevTools.saveDynamicThemeFixes(formatted);
            DevTools.onChange();
            return null;
        } catch (err) {
            return err;
        }
    }

    private static async getSavedInversionFixes(): Promise<string | null> {
        return this.store.get(DevTools.KEY_FILTER);
    }

    private static saveInversionFixes(text: string): void {
        this.store.set(DevTools.KEY_FILTER, text);
    }

    static async getInversionFixesText(): Promise<string> {
        let rawFixes = await DevTools.getSavedInversionFixes();
        if (!rawFixes) {
            await ConfigManager.load();
            rawFixes = ConfigManager.INVERSION_FIXES_RAW || '';
        }
        const fixes = parseInversionFixes(rawFixes);
        return formatInversionFixes(fixes);
    }

    static resetInversionFixes(): void {
        DevTools.store.remove(DevTools.KEY_FILTER);
        ConfigManager.overrides.inversionFixes = null;
        ConfigManager.handleInversionFixes();
        DevTools.onChange();
    }

    // TODO(Anton): remove any
    static applyInversionFixes(text: string): any {
        try {
            const formatted = formatInversionFixes(parseInversionFixes(text));
            ConfigManager.overrides.inversionFixes = formatted;
            ConfigManager.handleInversionFixes();
            DevTools.saveInversionFixes(formatted);
            DevTools.onChange();
            return null;
        } catch (err) {
            return err;
        }
    }

    private static async getSavedStaticThemes(): Promise<string | null> {
        return DevTools.store.get(DevTools.KEY_STATIC);
    }

    private static saveStaticThemes(text: string): void {
        DevTools.store.set(DevTools.KEY_STATIC, text);
    }

    static async getStaticThemesText(): Promise<string> {
        let rawThemes = await DevTools.getSavedStaticThemes();
        if (!rawThemes) {
            await ConfigManager.load();
            rawThemes = ConfigManager.STATIC_THEMES_RAW || '';
        }
        const themes = parseStaticThemes(rawThemes);
        return formatStaticThemes(themes);
    }

    static resetStaticThemes(): void {
        DevTools.store.remove(DevTools.KEY_STATIC);
        ConfigManager.overrides.staticThemes = null;
        ConfigManager.handleStaticThemes();
        DevTools.onChange();
    }

    // TODO(Anton): remove any
    static applyStaticThemes(text: string): any {
        try {
            const formatted = formatStaticThemes(parseStaticThemes(text));
            ConfigManager.overrides.staticThemes = formatted;
            ConfigManager.handleStaticThemes();
            DevTools.saveStaticThemes(formatted);
            DevTools.onChange();
            return null;
        } catch (err) {
            return err;
        }
    }
}

```

### background\messenger.ts

```
import type {ExtensionData, Theme, TabInfo, MessageUItoBG, UserSettings, DevToolsData, MessageCStoBG, MessageBGtoUI} from '../definitions';
import {MessageTypeBGtoUI, MessageTypeUItoBG} from '../utils/message';
import {isFirefox} from '../utils/platform';

import {makeFirefoxHappy} from './make-firefox-happy';
import {ASSERT} from './utils/log';

export interface ExtensionAdapter {
    collect: () => Promise<ExtensionData>;
    collectDevToolsData: () => Promise<DevToolsData>;
    changeSettings: (settings: Partial<UserSettings>) => void;
    setTheme: (theme: Partial<Theme>) => void;
    markNewsAsRead: (ids: string[]) => Promise<void>;
    markNewsAsDisplayed: (ids: string[]) => Promise<void>;
    toggleActiveTab: () => void;
    loadConfig: (options: {local: boolean}) => Promise<void>;
    applyDevDynamicThemeFixes: (json: string) => Error;
    resetDevDynamicThemeFixes: () => void;
    applyDevInversionFixes: (json: string) => Error;
    resetDevInversionFixes: () => void;
    applyDevStaticThemes: (text: string) => Error;
    resetDevStaticThemes: () => void;
    hideHighlights: (ids: string[]) => Promise<void>;
}

export default class Messenger {
    private static adapter: ExtensionAdapter;
    private static changeListenerCount: number;

    static init(adapter: ExtensionAdapter): void {
        Messenger.adapter = adapter;
        Messenger.changeListenerCount = 0;

        chrome.runtime.onMessage.addListener(Messenger.messageListener);

        // This is a work-around for Firefox bug which does not permit responding to onMessage handler above.
        if (isFirefox) {
            chrome.runtime.onConnect.addListener(Messenger.firefoxPortListener);
        }
    }

    private static messageListener(message: MessageUItoBG | MessageCStoBG, sender: chrome.runtime.MessageSender, sendResponse: (response: {data?: ExtensionData | DevToolsData | TabInfo; error?: string} | 'unsupportedSender') => void) {
        if (isFirefox && makeFirefoxHappy(message, sender, sendResponse)) {
            return;
        }
        const allowedSenderURL = [
            chrome.runtime.getURL('/ui/popup/index.html'),
            chrome.runtime.getURL('/ui/devtools/index.html'),
            chrome.runtime.getURL('/ui/options/index.html'),
            chrome.runtime.getURL('/ui/stylesheet-editor/index.html'),
        ];
        if (allowedSenderURL.includes(sender.url!)) {
            Messenger.onUIMessage(message as MessageUItoBG, sendResponse);
            return ([
                MessageTypeUItoBG.GET_DATA,
                MessageTypeUItoBG.GET_DEVTOOLS_DATA,
            ].includes(message.type as MessageTypeUItoBG));
        }
    }

    private static firefoxPortListener(port: chrome.runtime.Port) {
        ASSERT('Messenger.firefoxPortListener() is used only on Firefox', isFirefox);

        if (!isFirefox) {
            return;
        }

        let promise: Promise<ExtensionData | DevToolsData | TabInfo | null>;
        switch (port.name) {
            case MessageTypeUItoBG.GET_DATA:
                promise = Messenger.adapter.collect();
                break;
            case MessageTypeUItoBG.GET_DEVTOOLS_DATA:
                promise = Messenger.adapter.collectDevToolsData();
                break;
            // These types require data, so we need to add a listener to the port.
            case MessageTypeUItoBG.APPLY_DEV_DYNAMIC_THEME_FIXES:
            case MessageTypeUItoBG.APPLY_DEV_INVERSION_FIXES:
            case MessageTypeUItoBG.APPLY_DEV_STATIC_THEMES:
                promise = new Promise((resolve, reject) => {
                    port.onMessage.addListener((message: MessageUItoBG | MessageCStoBG) => {
                        const {data} = message;
                        let error: Error;
                        switch (port.name) {
                            case MessageTypeUItoBG.APPLY_DEV_DYNAMIC_THEME_FIXES:
                                error = Messenger.adapter.applyDevDynamicThemeFixes(data);
                                break;
                            case MessageTypeUItoBG.APPLY_DEV_INVERSION_FIXES:
                                error = Messenger.adapter.applyDevInversionFixes(data);
                                break;
                            case MessageTypeUItoBG.APPLY_DEV_STATIC_THEMES:
                                error = Messenger.adapter.applyDevStaticThemes(data);
                                break;
                            default:
                                throw new Error(`Unknown port name: ${port.name}`);
                        }
                        if (error) {
                            reject(error);
                        } else {
                            resolve(null);
                        }
                    });
                });
                break;
            default:
                return;
        }
        promise.then((data) => port.postMessage({data}))
            .catch((error) => port.postMessage({error}));
    }

    private static onUIMessage({type, data}: MessageUItoBG, sendResponse: (response: {data?: ExtensionData | DevToolsData | TabInfo; error?: string}) => void) {
        switch (type) {
            case MessageTypeUItoBG.GET_DATA:
                Messenger.adapter.collect().then((data) => sendResponse({data}));
                break;
            case MessageTypeUItoBG.GET_DEVTOOLS_DATA:
                Messenger.adapter.collectDevToolsData().then((data) => sendResponse({data}));
                break;
            case MessageTypeUItoBG.SUBSCRIBE_TO_CHANGES:
                Messenger.changeListenerCount++;
                break;
            case MessageTypeUItoBG.UNSUBSCRIBE_FROM_CHANGES:
                Messenger.changeListenerCount--;
                break;
            case MessageTypeUItoBG.CHANGE_SETTINGS:
                Messenger.adapter.changeSettings(data);
                break;
            case MessageTypeUItoBG.SET_THEME:
                Messenger.adapter.setTheme(data);
                break;
            case MessageTypeUItoBG.TOGGLE_ACTIVE_TAB:
                Messenger.adapter.toggleActiveTab();
                break;
            case MessageTypeUItoBG.MARK_NEWS_AS_READ:
                Messenger.adapter.markNewsAsRead(data);
                break;
            case MessageTypeUItoBG.MARK_NEWS_AS_DISPLAYED:
                Messenger.adapter.markNewsAsDisplayed(data);
                break;
            case MessageTypeUItoBG.LOAD_CONFIG:
                Messenger.adapter.loadConfig(data);
                break;
            case MessageTypeUItoBG.APPLY_DEV_DYNAMIC_THEME_FIXES: {
                const error = Messenger.adapter.applyDevDynamicThemeFixes(data);
                sendResponse({error: (error ? error.message : undefined)});
                break;
            }
            case MessageTypeUItoBG.RESET_DEV_DYNAMIC_THEME_FIXES:
                Messenger.adapter.resetDevDynamicThemeFixes();
                break;
            case MessageTypeUItoBG.APPLY_DEV_INVERSION_FIXES: {
                const error = Messenger.adapter.applyDevInversionFixes(data);
                sendResponse({error: (error ? error.message : undefined)});
                break;
            }
            case MessageTypeUItoBG.RESET_DEV_INVERSION_FIXES:
                Messenger.adapter.resetDevInversionFixes();
                break;
            case MessageTypeUItoBG.APPLY_DEV_STATIC_THEMES: {
                const error = Messenger.adapter.applyDevStaticThemes(data);
                sendResponse({error: error ? error.message : undefined});
                break;
            }
            case MessageTypeUItoBG.RESET_DEV_STATIC_THEMES:
                Messenger.adapter.resetDevStaticThemes();
                break;
            case MessageTypeUItoBG.HIDE_HIGHLIGHTS:
                Messenger.adapter.hideHighlights(data);
                break;
            default:
                break;
        }
    }

    static reportChanges(data: ExtensionData): void {
        if (Messenger.changeListenerCount > 0) {
            chrome.runtime.sendMessage<MessageBGtoUI>({
                type: MessageTypeBGtoUI.CHANGES,
                data,
            });
        }
    }
}

```

### background\make-chromium-happy.ts

```
export function makeChromiumHappy(): void {
    /* noop */
}

```

### background\window-theme.ts

```
import type {Theme} from '../definitions';
import {modifyBackgroundColor, modifyForegroundColor, modifyBorderColor} from '../inject/dynamic-theme/modify-colors';
import type {RGBA} from '../utils/color';
import {parseColorWithCache} from '../utils/color';

// TODO: remove type after dependency update
declare const browser: {
    theme: {
        update: ((theme: any) => Promise<void>);
        reset: (() => Promise<void>);
    };
};

const themeColorTypes: { [key: string]: 'bg' | 'text' | 'border' } = {
    accentcolor: 'bg',
    button_background_active: 'text',
    button_background_hover: 'text',
    frame: 'bg',
    icons: 'text',
    icons_attention: 'text',
    ntp_background: 'bg',
    ntp_text: 'text',
    popup: 'bg',
    popup_border: 'bg',
    popup_highlight: 'bg',
    popup_highlight_text: 'text',
    popup_text: 'text',
    sidebar: 'bg',
    sidebar_border: 'border',
    sidebar_text: 'text',
    tab_background_text: 'text',
    tab_line: 'bg',
    tab_loading: 'bg',
    tab_selected: 'bg',
    textcolor: 'text',
    toolbar: 'bg',
    toolbar_bottom_separator: 'border',
    toolbar_field: 'bg',
    toolbar_field_border: 'border',
    toolbar_field_border_focus: 'border',
    toolbar_field_focus: 'bg',
    toolbar_field_separator: 'border',
    toolbar_field_text: 'text',
    toolbar_field_text_focus: 'text',
    toolbar_text: 'text',
    toolbar_top_separator: 'border',
    toolbar_vertical_separator: 'border',
};

const $colors: { [key: string]: string } = {
    // 'accentcolor' is the deprecated predecessor of 'frame'.
    // https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/theme#colors
    accentcolor: '#111111',
    frame: '#111111',
    ntp_background: 'white',
    ntp_text: 'black',
    popup: '#cccccc',
    popup_text: 'black',
    sidebar: '#cccccc',
    sidebar_border: '#333',
    sidebar_text: 'black',
    tab_background_text: 'white',
    tab_loading: '#23aeff',
    // 'textcolor' is the predecessor of 'tab_background_text'.
    // https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/theme#colors
    textcolor: 'white',
    toolbar: '#707070',
    toolbar_field: 'lightgray',
    toolbar_field_text: 'black',
};

export function setWindowTheme(theme: Theme): void {
    const colors = Object.entries($colors).reduce((obj: { [key: string]: string }, [key, value]) => {
        const type: 'bg' | 'text' | 'border' = themeColorTypes[key];
        const modify: ((rgb: RGBA, theme: Theme, shouldRegister: boolean) => string) = {
            'bg': modifyBackgroundColor,
            'text': modifyForegroundColor,
            'border': modifyBorderColor,
        }[type];
        const rgb = parseColorWithCache(value)!;
        const modified = modify(rgb, theme, false);
        obj[key] = modified;
        return obj;
    }, {});
    if (typeof browser !== 'undefined' && browser.theme && browser.theme.update) {
        browser.theme.update({colors});
    }
}

export function resetWindowTheme(): void {
    if (typeof browser !== 'undefined' && browser.theme && browser.theme.reset) {
        // BUG: resets browser theme to entire
        // https://bugzilla.mozilla.org/show_bug.cgi?id=1415267
        browser.theme.reset();
    }
}

```

### config\detector-hints.config

```
*.autotask.net

TARGET
html

MATCH
link[href*="/Mvc/FrameworkContent/Styles/LandingMidnight.min.css?"]

================================

*.gamer.com.tw

TARGET
html

MATCH
[data-theme="dark"]

================================

activestate.com

TARGET
body

MATCH
.dark_bg

================================

adguard-dns.io

TARGET
body

MATCH
[data-theme="DARK"]

================================

alarabiya.net

TARGET
body

MATCH
.night-theme

================================

android-x86.org

NO DARK THEME

================================

anonymfile.com

TARGET
html

MATCH
.dark

================================

app.pachca.com

TARGET
html

MATCH
.dark

================================

app.raindrop.io

TARGET
html

MATCH
[data-theme="night"]

================================

app.thestorygraph.com

TARGET
html

MATCH
.dark

================================

app.todoist.com

TARGET
html

MATCH
.theme_dark

================================

arstechnica.com

NO DARK THEME

================================

bard.google.com

TARGET
body

MATCH
.dark-theme

================================

blog.stevezmt.top
blog-preview.stevezmt.top

TARGET
body

MATCH
.mdui-theme-layout-dark

================================

calendar.cron.com

TARGET
html

MATCH
.dark

================================

canva.com

TARGET
html

MATCH
.dark

================================

cezarywalenciuk.pl

NO DARK THEME

================================

chat.deepseek.com

TARGET
body

MATCH
.dark

================================

cia.gov

NO DARK THEME

================================

codebuff.com

TARGET
html

MATCH
.dark

================================

console.aws.amazon.com
*.console.aws.amazon.com

TARGET
body

MATCH
.awsui-polaris-dark-mode

================================

cybenetics.com

TARGET
body

MATCH
.dark

================================

dashboardicons.com

TARGET
html

MATCH
.dark

================================

dcard.tw

NO DARK THEME

================================

developer.chrome.com

NO DARK THEME

================================

dictionary.com

NO DARK THEME

================================

discord.com

TARGET
html

MATCH
.theme-dark

================================

docmost.com

TARGET
html

MATCH
data-mantine-color-scheme="dark"

================================

docs.piral.io
docs.piral.cloud

TARGET
body

MATCH
.dark

================================

facebook.com

TARGET
html

MATCH
.__fb-dark-mode

================================

fitgirl-repacks.site

NO DARK THEME

================================

flashscore.com

TARGET
body

MATCH
.theme--dark

================================

flathub.org

TARGET
html

MATCH
.dark

================================

gamedev.net

NO DARK THEME

================================

gimp.org

NO DARK THEME

================================

github.com

TARGET
html

MATCH
[data-color-mode="dark"]

================================

gotquestions.org

NO DARK THEME

================================

hdblog.it

NO DARK THEME

================================

ign.com

TARGET
html

MATCH
[data-theme="dark"]

================================

inkscape.org

NO DARK THEME

================================

knightedgemedia.com

NO DARK THEME

================================

learn.standardresume.co

TARGET
html

MATCH
.dark

================================

lingoblocks.com

TARGET
html

MATCH
.dark-mode

================================

linkedin.com

TARGET
html

MATCH
.theme--dark
.theme--mercado-dark

================================

majorgeeks.com

NO DARK THEME

================================

messages.google.com

TARGET
body

MATCH
.dark-theme

================================

msn.com

NO DARK THEME

================================

next-episode.net

NO DARK THEME

================================

nomoremister.blogspot.com

NO DARK THEME

================================

norfolk.citizenspace.com

NO DARK THEME

================================

notion.so

TARGET
body

MATCH
.dark

================================

objshadow.is-a.dev
objshadow.pages.dev
objshadow.tun.webredirect.org
shadow.tun.webredirect.org
shadowobj.eu.org

TARGET
html

MATCH
[data-scheme="dark"]

================================

omnivore.app

TARGET
html

MATCH
.Dark

================================

onedrive.live.com
word-edit.officeapps.live.com

TARGET
body

MATCH
.UxDarkMode

IFRAME

================================

open-meteo.com

TARGET
html

MATCH
.dark

================================

outlook.live.com
outlook.office.com

TARGET
html

MATCH
[style*="--black: #FFFFFF"]

================================

philosophicaldisquisitions.blogspot.com

NO DARK THEME

================================

photopea.com

TARGET
html

MATCH
[style*="--base: #474747"]
[style*="--base: #404550"]
[style*="--base: #222531"]
[style*="--base: #4b3e51"]
[style*="--base: #353535"]

================================

php.net

NO DARK THEME

================================

pkmer.cn

TARGET
html

MATCH
.theme-dark

================================

powerthesaurus.org
*.powerthesaurus.org

TARGET
body

MATCH
[data-theme="dark"]

================================

psnprofiles.com

NO DARK THEME

================================

qobuz.com

NO DARK THEME

================================

radboudumc.nl

NO DARK THEME

================================

reddit.com
new.reddit.com

TARGET
html

MATCH
.theme-dark

================================

reduced.to

TARGET
html

MATCH
[data-theme="dracula"]

================================

regex101.com

TARGET
html

MATCH
[data-theme="dark"]

================================

regexr.com

TARGET
link[href*="dark.css"]

MATCH
*

================================

satisfactory.wiki.gg

TARGET
html

MATCH
.theme-dark

================================

scrumguides.org

NO DARK THEME

================================

search.brave.com

TARGET
html

MATCH
.dark

================================

sevendistrictscoffee.com

NO DARK THEME

================================

si.edu

NO DARK THEME

================================

slack.com
*.slack.com

TARGET
body

MATCH
.sk-client-theme--dark

================================

slightknack.github.io

TARGET
html

MATCH
.coal
.navy
.ayu

================================

soccer24.com

TARGET
body

MATCH
.theme--dark

================================

sojo.net

NO DARK THEME

================================

steamgifts.com

NO DARK THEME

================================

switchbacktravel.com

NO DARK THEME

================================

telex.hu

TARGET
html

MATCH
.dark-mode

================================

thefederalist.com

NO DARK THEME

================================

themoviedb.org

NO DARK THEME

================================

thetrevorproject.org

NO DARK THEME

================================

theverge.com

TARGET
main

MATCH
.dark

================================

thurrott.com

NO DARK THEME

================================

twitch.tv

TARGET
body

MATCH
.dark-theme

================================

twitter.com

TARGET
body

MATCH
[style*="background-color: rgb(0, 0, 0)"]

================================

vecernji.hr

TARGET
html

MATCH
[data-theme="dark"]

================================

wccftech.com

TARGET
html

MATCH
.dark

================================

web.telegram.org/a

TARGET
html

MATCH
.theme-dark

================================

web.telegram.org/k

TARGET
html

MATCH
.night

================================

web.whatsapp.com

TARGET
body

MATCH
.dark

================================

wiki.greasespot.net

NO DARK THEME

================================

wikipedia.org

TARGET
html

MATCH
.skin-theme-clientpref-night

================================

x.com

TARGET
body

MATCH
[style*="background-color: rgb(0, 0, 0)"]

================================

yandex.*/maps

TARGET
body

MATCH
._theme_dark

================================

youtube.com

TARGET
html

MATCH
[dark]

```

### config\dark-sites.config

```
*.cases.gg
*.clash.gg
*.cncnet.org
*.comfig.app
*.curseforge.com
*.furaffinity.net
*.hadesblack.com
*.iaas.store
*.iaasdev.ru
*.mastercomfig.com
*.newgrounds.com
*.paydaythegame.com
*.pleasefix.gg
*.rustclash.com
*.sapph.xyz
*.starbreeze.com
*.suyu.dev
*.tickettool.xyz
*.tracker.gg
*.tracker.network
0bin.net
0x00sec.org
12bytes.org
1337x.*/$
13willow.com
1lighty.github.io/BetterDiscordStuff
1maginary.online
1nf.me
23.social
2600.com
3072.vercel.app
314n.org
5cs.fail
5stardata.info
a-maze.jothin.tech
aagaming.me
abhiyan.me
absolucy.moe
academy.hackthebox.com
account.bhvr.com
account.hackthebox.com
accursedfarms.com
aceship.github.io
acespace.love
addictinggames.com
adridoesthings.com
adventofcode.com
agent-stats.com
ageofempires.com
agfy.co
airconsole.com
ajay.app
akkoma.dev
albony.xyz
alecks.dev
alfawal.dev
aliciasykes.com
altimeter-app.com/altimeter-plus
ambr.top
ameliorated.info
ameliorated.io
amog-os.github.io
amp-what.com
an3x.org
andrew-larson.dev
andrewleguay.com
andrewthedev.com
androiddev.social
animepahe.ru
animixplay.to
animk.info
anishde.dev
anitrack.co
annaaurora.eu
annapurnainteractive.com
answeroverflow.com
antalbiztonsag.com
aonprd.com
apbdb.com
app.destinyitemmanager.com
app.hackthebox.com
app.keeweb.info
app.minehut.com
app.mobalytics.gg
app.pianorhythm.io
app.plex.tv
app.pluralsight.com
app.revolt.chat
app.spacebar.chat
app.sqldbm.com
applesilicongames.com
application.security
aqtiongame.com
archive.ragtag.moe
archon.gg
ard.social
ardov.me
ari.lt
arialfx.com
arkenfox.github.io/TZP/
armaforces.com
artixlinux.org
artlist.io
arweave.app
asciimation.co.nz
ashcam.xyz
ashishpanigrahi.com
asoftmurmur.com
assassins-creed.de
astronvim.github.io
atelier.net/virtual-economy
atelier801.com
athome.fandango.com
atlasos.net
atresplayer.com
attackontitan.fandom.com
audiomass.co
audioz.download
augmentedsteam.com
auth.tedomum.net
av9.dev
avengedsevenfold.com
azeria-labs.com
badboybill.com
badlion.net
baldursgate3.game
banfeed.com
baobun.dev
based.cooking
battle.net
battlefieldtracker.com
battlelog.battlefield.com/bf4
bbc.co.uk/iplayer
bdeditor.dev
beastskills.com
beatleader.xyz
beatsaver.com
bedrocklinux.org
beepbox.co
bequiet.com
bereal.com
bestblackhatforum.com
beta.destinyitemmanager.com
beta.gippity.chat
betterdiscord.app
betterttv.com
bg3.wiki
bherila.net
bidet.gg
bildung.social
bin.disroot.org
bin.veracry.pt
birdflop.com
birdie0.github.io
bitcoinity.org/markets
bithatch.co.uk
blackarch.org
blackhat.com
blackhatsem.com
blackhatworld.com
blackle.com
blackmod.net
blast.tv
blastpremier.com
blgn.dev
blink.sh
blizzard.com
blocks.pandadev.net
blog.aractus.com
blog.counter-strike.net
blog.pixelexperience.org
blox.link
blueagle.top
bluefirestudios.com
bobjoerules.github.io
bocchilorenzo.github.io
bogleech.com
bondoer.fr
bonfirenetworks.org
bonn.social
bootstrap.academy
botboy.snaz.in
bouncingdvdlogo.com
brew.sh
bri.io
brianlovin.com
brianpmaher.com
briantakita.me
broadcasthe.net
brodierobertson.xyz
brunotome.dev
bsodium.fr
bugmenot.com
bungie.net
bytebin.lucko.me
c-saccoccio.fr
cadence.moe
canalplus.com
caniuse.com
canyoublockit.com
capcut.com
caracal.club
carbon.now.sh
carl.gg
carrd.co
casaos.io
cascadr.co
catvibers.me
cc.com
ccugame.app
cdkeys.com
cdn.minlor.net
cdnnow.pro
changelog.pandadev.net
chaos.social
chat-gpt.org
chat.openai.com
chat.ryzom.com
chat.vote
cheat.sh
checkout.steampowered.com
checkra.in
chess.com
chess.wintrcat.uk
chesstempo.com
chitownhousemusic.com
chromatic-tuner.com
cider.sh
cjratliff.com
cl00e9ment.gitlab.io/kingdom-blazon-generator/
clashofstats.com
cleo.li
cloud.minlor.net
club.steam250.com
cnc-comm.com
cncnet.org
co.wukko.me
cobalt.tools
codeium.com
codepen.io
coder.com
codesandbox.io
codestackr.com
codewars.com
colean.cc
colordesigner.io
comfig.app
community.eveonline.com
conexo.ws
console.firebase.google.com
cookieplmonster.github.io
coolmathgames.com
coriolis.io
counter-strike.net
countermail.com
cp.minetro.com
cracked.to
craiyon.com
crazygames.com
create.roblox.com/docs
crontab.guru
crunchyroll.com
cs.rin.ru
csfail.link
cssbattle.dev
ctf.hackthebox.com
ctt.cx
cuibonobo.com
curia.social-network.europa.eu
curiositystream.com
curseforge.com
cxsecurity.com
cybercodeonline.com
cybercrime-tracker.net
cyberdrop.me
cyberpunk.net
cybersole.io
cytu.be
daddyanity.com
daily-fire.com
daksh.eu.org
damnvulnerabledefi.xyz
danidev.net
daringfireball.net
dark.diatr.us
darkmode.com
darkmodelist.com
darkreader.org
dartpad.dev
dashy.to
datomatic.no-intro.org
davros.netlify.app
dblstatistics.com
dbzer0.com
dd-wrt.com
ddpe.androz2091.fr
deadbydaylight.com
deadbydaylight.fandom.com
decrypt.day
deepswap.ai
deepweblinks.net
defcon.org
deidetected.com
deltarune.com
demo.photoprism.app
demonforums.net
denims.tv
denshi.org
desktop.github.com
desoroxxx.github.io/Portfolio/
destiny.gg
destinytracker.com
det.social
devanbuggay.com
developer.valvesoftware.com
developerinsider.co
developers.cloudflare.com
di.fm
diablogame.de
dicebear.com
diep.io
digi77.com
digikam.org
disasm.pro
disboard.org
discadia.com
discohook.org
discord-date.shyked.fr
discord.bots.gg
discord.com/app
discord.com/developers
discord.com/login
discord.com/register
discord.id
discordbotlist.com
discordpackage.com
discords.com
discordservers.com
discordtimestamp.com
discourse.automationgame.com
discourse.cataclysmdda.org
discuss.logseq.com
disneyplus.com
distro.tube
djflame.tech
dlive.tv
docs.adonisjs.com
docs.gofiber.io
docs.quad9.net
dodi-repacks.site
doesitarm.com
doge.gov
dominion.games
donk.link
donklink.com
doodstream.com
dota2.com
dota2.ru
dotabuff.com
dotapicker.com
draculatheme.com
draftbot.fr
dragonage-game.de
drakewars.com
droidify.eu.org
drunkenslug.com
dsa-drakensang.de
dsc.gg
dualshockers.com
duckychannel.com.tw
duelingnexus.com
dumpert.nl
dumpus.app
dungeon-lords.de
dustinbrett.com
dyinglight.fandom.com
dyinglight.wiki.gg
dyno.gg
e-z.bio
e-z.host
eclipse.menu
ecosia.org
ecys.xyz
edi.social
edit-csv.net
editor.method.ac
eki.wtf
elderscrolls.fandom.com
elitedangerous.com
ellie-app.com
elybeatmaker.com
emeraldchat.com/app
emkc.org
emoji.supply/kitchen/
emuparadise.me
energiewende.social
enig.ma.tum.de
enigame.de
enlightenment.org
enlisted.net
enterprise.hackthebox.com
epicgames.com
epilogue.team
erai-raws.info
eren.si
escapefromtarkov.com
escapefromtarkov.fandom.com
esplay.com
esportal.com
etke.cc
etlegacy.com
eveonline.com
evewho.com
evowars.io
excel-dna.net
extrememusic.com
f.vision
f3bpodcast.com
f95zone.to
faceit-enhancer.com
faceit.com
factorio.com
factoriobin.com
fakeupdate.net/apple
fakeupdate.net/steam
fakeupdate.net/vista
fakeupdate.net/win10
fakeupdate.net/win10ue
fakeupdate.net/win7
fakeupdate.net/win8
fakeupdate.net/wnc
fakeupdate.net/xp
fallout-area.de
fandango.com
fastro.dev
fedidb.org
filegarden.com
filmmakermode.com
filterblade.xyz
filterlists.com
finder.usmans.me
findmcserver.com
fireship.io
fishshell.com
flavibot.xyz
fleepy.tv
flightlessmango.com
florr.io
floss.social
fluxpoint.dev
forgejo.org
forsen.horse
fortnite.com
fortnite.gg
fortnitetracker.com
forum.lastos.org
forum.tribler.org
forum.xda-developers.com
forumplayer.dev
forums.bhvr.com/dead-by-daylight/
forums.eveonline.com
forums.launchbox-app.com
fosstodon.org
fox.com
fragment.com
framp.me
frankerfacez.com/$
freecodecamp.org/$
freecodecamp.org/learn/
freeipa.org
frozensand.com
funnyjunk.com
furry.engineer
fusengine.github.io/apaxy-v2
fv.pro
gaijin.net
galacticabot.vercel.app
game.chronodivide.com
gamebanana.com
gamedle.wtf
gamejolt.com
gamersnexus.net
gaming.amazon.com
garudalinux.org
geektyper.com
genshin-impact.fandom.com
genshin.gg
geocities.restorativland.org
getaether.net
getdweb.net
gethalfmoon.com
gethomepage.dev
getsharex.com
getwacup.com
gfl.matsuda.tips
gflcorner.com
gfverse.info
ggapp.io
ghidra-sre.org
gi.yatta.moe
gianmarco.gg
giantbomb.com
gibber.cc
gibbu.github.io/ThemePreview/
gifrun.com
gifyourgame.com
gikken.co
giphy.com
git.gnous.eu
github1s.com
gitkraken.com
gitmoji.kaki87.net
glow.phoesion.com
glowing-bear.org
glslsandbox.com
glyphtones.is-a.dev
go4liftoff.com
gog.com/forum
gogalaxy.com
goodfirstissue.dev
goosegame.io
gopiratesoftware.com
grafana.social
graydon2.dreamwidth.org
grayjay.app
grc.arikado.ru
greatview.video
greynoise.io
grim.ac
groovy.bot
gtaforums.com
guessr.tv
gundamcocks.riflesniper.art
gunshipmusic.com
gusted.xyz
hachyderm.io
hack.chat
hackaday.com
hackaday.io
hackertyper.com
hackforums.net
hackthebox.com
hackthebox.eu
hackthissite.org
hacktoberfest-projects.vercel.app
hadesblack.com
halotracker.com
halowaypoint.com
hang.fm
hardforum.com
hardstuck.gg
hardwaretimes.com
hawkbot1cs.org
hbomax.com
hctiwt.tv
hdencode.com
heavybit.com
heckerbot.dev
hedgewars.org
heliotrope.dk
help.steampowered.com
herodamage.com
hexiro.me
hidive.com
himovies.to
hiserod.github.io
hitnmix.com
hiveon.net
hkamran.com
hostedtalk.net
hotstar.com
howlongtobeat.com
hpdevone.com
hqapps.org
hrmspms.sicorax.mu
hub.warframestat.us
humblebundle.com/$
humblebundle.com/accessibility
humblebundle.com/charities
humblebundle.com/refer
humblegames.com
hyper.is
i3wm.org
iaas.store
iaasdev.ru
idlesteam.com
ifkash.vercel.app
igg-games.com
iipython.dev
imageglass.org
imgbox.com
imgur.com
impb.in
imperialb.in
imxnoobx.com
indieweb.social
indiexpo.net
infinitezoom.net
infocon.org
infosec.exchange
inker.app
inker.co
intactphone.com
intothetrenches.1917.movie
iskdeusingqt6.org
isthereanydeal.com
isxander.dev
itrade.gg
jackdaniels.com
jakeroman.com
jakobneumann.com
jakopavouk.cz
jakubkaczor.com
jaxcore.app
jbzd.com.pl
jekyllrb.com
jellymar.io
jetify.com
jeusto.com
jhey.dev
jigsawpuzzles.io
joeydrewstudios.com
join-lemmy.org
jonahsnider.com
josephchataignon.github.io
jothin.tech
jqbx.fm
jsben.ch
jsitor.com
json-diff.com
justfive.news
justwatch.com
kadantiscam.netlify.app
kaioken.dev
kalence2.github.io
kanoa.de
kaoskrew.org
kazimagazine.com
kbh.games
kbhgames.com
keenwrite.com
keezersquest.nl
kernel.fish
kestra.io
kfocus.org
khor.store
khuwawa.com
kika.de/$
kika.de/kika-live/*
kika.de/kummerkasten/*
kika.de/live/*
kika.de/selbermachen/*
kika.de/spiele/*
kika.de/suche/*
kika.de/ueber-kika/*
kika.de/videos/*
kilonova.ro
kimbatt.github.io/js-Z
kingdom-leaks.com
kittybot.de
knockout.chat
kocowa.com
kodenames.io
korino.dev
krisoneil.com/home
kristal.cc
krunker.io
ksenon.net
ksp.mff.cuni.cz
kuik.li
kulbachny.com
kwejk.pl
kyleggiero.me
kyun.host
lagom.nl/lcd-test
lainchan.org
landchad.net
larbs.xyz
lazer.ppy.sh
lemm.ee
lemmi.no
lemmy.world
lemmyverse.net
letroso.com
letterboxd.com
lichess.org
lightweightpdf.com
linear.app
lingva.ml
linku.la
linux.org.ru
liquidplus.com
lishogi.org
listen.moe
littlealchemy2.com
livesplit.org
liveweave.com
loadout.tf
login.eveonline.com
logseq.com
loldle.net
lolesports.com
lollilol.xyz
looskie.com
lospec.com
lucasmellof.com
luckyone-dev.com
luckyone.dev
lukesmith.xyz
lumina-desktop.org
lutris.net
m.daum.net
m2v.ru
macbb.org
mango.pdf.zone
mapstodon.space
marte.dev
marvil.co
maskbox.app
masseffect.fandom.com
mastercomfig.com
mastofeed.com
max.com
maximepinot.com
mazes.jothin.tech
md.quad.codes
mechapower.eu
mednafen.github.io
megathread.pages.dev
melody.ml
melonds.kuribo64.net
memory-alpha.fandom.com
mempool.space
merged.games
metronom.us
mewho.com/starfield47
midnight.day
migueldemoura.com
mikemaximus.github.io/gbm-web
minecraft.net
minehut.com
minetro.com/panel
minlor.net
miru.watch
misode.github.io
mit.gg
mixxx.org
mizik.eu
mmorpg.com
mnsr.win
modworkshop.net
monitoror.com
monkeytype.com
morethantech.it
morrowshore.com
motion-canvas.github.io
motioncanvas.io
motz.xyz
mouse-sensitivity.com
mrms.cz
mrquantumoff.dev
mrtipson.github.io/otz-builds/
ms-paint-i.de
mstdn.social
mtv.com
mulv.tycrek.dev
musedash.moe
music.com
music.youtube.com
muttwizard.com
mutualaiddisasterrelief.org
mwittrien.github.io
mwomercs.com
mynoise.net
mypodficacademia.com
n-o-d-e.net
n7hq.masseffect.com
nameslol.com
nanobun.tv
nationsglory.com
nationsglory.es
nationsglory.fr
neal.fun/size-of-space
nee.lv
nemanjadragun.com
nerimity.com
netflix.com
netzhack.de
neundex.com
neurocore.xyz
newgrounds.com
nextron.pandadev.net
nextts.org
nextui.org
nexusmods.com
nfs.fandom.com
nfsmods.xyz
nfspolska.pl
ngplus.net
nh-server.github.io/switch-guide/
nheko-reborn.github.io
nicholasjohnson.ch
nickgen.netlify.app
niebezpiecznik.pl
nightlight.gg
nightly.smithed.net
nikse.dk
nitter.kavin.rocks
nitter.nixnet.services
nixos-and-flakes.thiscute.world
nomanssky.com
noob.bio
norden.social
nostr.com
nostv.pt
notesnook.com
nowplayi.ng
nulledbb.com
nvstly.com
obsidian.md
obsproject.com
odysee.com
offshorecorptalk.com
okayeg.com
oldfag.org
on.quad9.net
onionplay.asia
onionplay.co
onlyformats.netlify.app
onlyfors.com
open.spotify.com
opendota.com
openemu.org
openrazer.github.io
openrgb.org
orama-interactive.itch.io/pixelorama
orbstack.dev
orteil.dashnet.org/cookieclicker
osu.ppy.sh
osumatrix.me
otz-addon-tierlist.pages.dev
otz-opinions.pages.dev
otzdarva.com
ovagames.com
overdodactyl.github.io/ShadowFox
ovosimpatico.com
oxide.computer
pages.gay
paimon.moe
pally.gg
pandadev.net
paniash.netlify.app
paper-io.com
parahumans.wordpress.com
parrotsec.org
partner.steamgames.com/doc/
partner.steamgames.com/pccafe
partner.steamgames.com/vrlicensing
passthepopcorn.me
pastes.dev
pathofexile.com
pathofexile.fandom.com
payday.fandom.com
paydaythegame.com
pcgamestorrents.com
pedrorok.com
perf.link
peterlindbergh.obys.agency
petersalomonsen.com/webassemblymusic/livecodev2
phind.com
photomosh.com
photopea.com
physgun.com
pic.cleoold.com
pic8.co
ping.pe
pinia.vuejs.org
piped.kavin.rocks
piped.mha.fi
piped.privacy.com.de
piped.tokhmi.xyz
piracybank.org
piskelapp.com
pitokmm.it
pixlr.com
planetneverwinter.de
plasticuproject.com
platinumgod.co.uk
play.geforcenow.com
playclassic.games
pleasefix.gg
pluto.tv
poal.co
poe-racing.com
poe.ninja
poe2.ninja
poeapp.com
poelab.com
poliigon.com
poll.chat.vote
polsatboxgo.pl
polsatgo.pl
polychromatic.app
polyhaven.com
pony.tube
pool.pm
poweroutage.com
poweroutage.us
ppluss.de
ppy.sh
pr0gramm.com
premid.app
privacytools.io
progettosnaps.net
projectdiscovery.io
protondb.com
proxx.app
ps2alerts.com
ptdtw.fun
pvplegacy.net
pxseu.com
pylon.bot
qalculator.xyz
quad9.net
raidbots.com
raider.io
raidplan.io
rakowiecki.pl
rate.house
raunaksitoula.com
ravenation.club
rawgiving.com
ray.so
razeenf.ca
razer.com
razorsecure.com
redasm.io
redeclipse.net
reelgood.com
relay.firefox.com/faq
renderlab.net
reniguide.carrd.co
reniguide.info
renkon.github.io/lolbacktracker-frontend
replit.com
replugged.dev
reposilite.com
restream4me.com
retromusic.app
returnyoutubedislike.com
revanced.app
reveddit.com
review.lineageos.org
rhwiki.net
richup.io
riflesniper.art
ripped.guide
ritsuka.moe
rl6mans.com
robinhood.com
rokoko.com
roleypoly.com
roosterteeth.fandom.com
router.vuejs.org
rtbyte.xyz
rtech.support
ruben-p.com
ruffle.rs
runechanger.stirante.com
runevm.io
runicgames.com
rusherhack.org
rust.facepunch.com
rust.nolt.io
rythm.fm
sa.jothin.tech
sacred-legends.de
sadh.life
sadistic.pl
safereddit.com
saintsrow.com
saliven.com
sammcheese.net
samseeman.com
sandervanderburg.blogspot.com
sapph.xyz
satisfactory-factories.app
sauce420.github.io
sauce420.gitlab.io
save.tf
sb.ltn.fi
schildi.chat
science-news.co
scriptkit.com
seaofthieves.fandom.com
search.biboumail.fr
search.nebulacentre.net
secrethitler.io
secure.eveonline.com
senkognito.com
senkuro.com
septatrix.github.io/prefers-color-scheme-test/
serebii.net
settings.gg
seximal.net
seyi.dev
sharetextures.com
sharkiller.ddns.net
shatteredpixel.com
sheet.host
shellshock.io
sherlock-project.github.io
shockbs.is-a.dev
shockbs.pro
showtimeanytime.com
shpposter.club
shubhamprasad.dev
shubhamprasad.vercel.app
siddharthray.com
siderite.dev
simkl.com
sinister.ly
sive.rs
skeld.net
skeptikon.fr
skidrowreloaded.com
skiftos.org
skinport.com
skinsmonkey.com
sky.lea.moe
skylabmusic.com
skynetsimulator.com
slay.one
sleeplessbeastie.eu
slider.kz
slippi.gg
slither.com
slither.io
smithed.dev
smithed.net
snazzah.com
snoozing.com
snowsta.mp
sober.vinegarhq.org
social.bund.de
social.cologne
social.saarland
social.tchncs.de
somafm.com
spacestationgaming.com
spacex.com
spark.lucko.me
speedrun.com
speedtest.net
splatoon.nintendo.com
splatoon3.ink
sponsor.ajay.app
spotfy.one
spoticord.com
spyware.neocities.org
srrdb.com
star-made.org
starbreeze.com
starlink.com
starmadedock.net
statbot.net
stateofjs.com
status.codeberg.eu
status.kyun.host
steam.design
steam250.com
steambase.io
steamcharts.com
steamcommunity.com
steamdb.info
steamdeckhq.com
steamhunters.com
steamstat.us
steamtimeidler.com
stillu.cc
store.epicgames.com
store.gaijin.net
store.steampowered.com
storyfire.com
stray.game
studiomaertens.com
stylus-lang.com
sunxdcc.com
supinic.com
support.deadbydaylight.com
supremacy1914.com
surrealdb.com
surviv.io
suyu.dev
svtplay.se
sylviefox.ca
sync-tube.de
szmarczak.com
t3.chat
tabby.sh
tacoanon.github.io
talentbrick.com
tarkov-market.com
tautulli.com
tboi.com
teamfortress.com
teamliquid.com
teamsds.net
telescope.org
teleseer.com
televizeseznam.cz
term.ooo
terminal.sexy
terminalroot.com
tetr.io
textfiles.com
texture.ninja
texturebox.com
texturemax.com
textures.com
tf2mart.net
tgw1916.net/bacteria_abis.html
thecolonialtheatre.com
thehomelab.wiki
thelastofus.fandom.com
thelinuxcast.org
theme-park.dev
themes.vscode.one
themetphilly.com
thespacedevs.com
thetatoken.org
thetrackernetwork.com
thispersondoesnotexist.com
tickettool.xyz
tilde.club
tilde.team
tilde.town
tildeverse.org
timharek.no
tio.run
title-case-converter.vercel.app
tommytran.io
toneden.io
toolscord.com
top.gg
tostories.app
totems.me
tov.monster
tracker.gg
trblwlf.net
trigger.dev
trilon.io
tripleaughtdesign.com
trojansource.codes
trovo.live
truckersmp.com
truffle.vip
tsssaver.1conan.com
tube.kdy.ch
tukui.org
tvnz.co.nz
tvplus.com.tr
twitch.tv
twiukraine.com
twnft.vercel.app
tycrek.com
tylerpalko.github.io
tynker.com/ide
tyt.com
ufplanets.com
ultrajs.dev
undergroundcellar.com
underlords.com
undertale.com
universe.eveonline.com
universeodon.com
unrealengine.com
urbanlinker.com
us.shop.battle.net
userdiag.com
ussr.obys.agency
v3.wttr.in
vanillatweaks.net
vcjhwebdev.github.io/useless-translator/
victordarras.fr/cssgame
vid.puffyan.us
viddit.red
villains.fandom.com
vimm.net
vinesauce.com
vivek9patel.github.io
vixeny.dev
vleer.app
vogons.org
volta.net
vrv.co
vscode.dev
vudu.com
vuecinemas.nl
w0rp.com
w41k3r.com
wago.io
wallhaven.cc
warcraftlogs.com
warezforums.com
warsow.net
warthunder.com
wasm.continuation-labs.com/d3demo/
weavesilk.com
web-check.xyz
weichong.dev
whipcode.app
whirlxd.xyz
wickeditor.com/editor/
widgetbot.io
wiki.dignityofwar.com
wiki.eveuniversity.org
wiki.fireundubh.com
wiki.pixelexperience.org
wiki.the-elite.net
wiktrek.xyz
windowsterminalthemes.dev
winget.run
wiocha.pl
wisehosting.com
worldofcyberpunk.de
worldofgothic.de
worldofplayers.de
worldofrisen.de
worldoftanks.asia
worldoftanks.com
worldoftanks.eu
wormate.io
wormhole.app
wowaudit.com
wowhead.com
wowinterface.com
wtfast.com
wttr.in
wuemeli.com
x1337x.*/$
x64dbg.com
xbins.org
xbox.com/play
xdaforums.com
xela.codes
xela.dev
xerolinux.xyz
xmission.com
xn--rpa.cc
xonotic.org
yande.re
yarmo.eu
yashsingh.us
ynoproject.net
you.dj
your.gg
yts.*
zaufanatrzeciastrona.pl
zee5.com
zerodayinitiative.com
zkillboard.com
zombsroyale.io
zt64.github.io
ztdp.ca
zunivers.zerator.com
zyrenth.dev

```

### config\color-schemes.drconf

```
Default

DARK
background: #181a1b
text: #e8e6e3

LIGHT
background: #181a1b
text: #e8e6e3

================================

Catppuccin

DARK
background: #1e1e2e
text: #cdd6f4

LIGHT
background: #eff1f5
text: #4c4f69

================================

Deep Ocean

DARK
background: #00222b
text: #a9b4b4

LIGHT
background: #cac5b6
text: #cdd4d6

================================

Dracula

DARK
background: #282b36
text: #e8e6e3

================================

Everforest

DARK
background: #2b3339
text: #d1c4a9

LIGHT
background: #fdf9ed
text: #5b6971

================================

Github Modern

DARK
background: #0d1117
text: #c9d1d9

LIGHT
background: #ffffff
text: #24292f

================================

Gruvbox

DARK
background: #282828
text: #ebdbb2

LIGHT
background: #fbf1c7
text: #3c3836

================================

Kanagawa

DARK
background: #1f1f28
text: #dcd7ba

LIGHT
background: #f4ecca
text: #1e4887

================================

Material You

DARK
background: #1f1b24
text: #e3e3e3

LIGHT
background: #fefbff
text: #1f1b24

================================

Nord

DARK
background: #2e3440
text: #eceff4

LIGHT
background: #eceff4
text: #3b4252

================================

One Dark

DARK
background: #282c34
text: #abb2bf

LIGHT
background: #fafafa
text: #383a42

================================

Oxocarbon

DARK
background: #161616
text: #f2f4f8

LIGHT
background: #f2f4f8
text: #393939

================================

Rosé Pine

DARK
background: #191724
text: #e0def4

LIGHT
background: #faf4ed
text: #575279

================================

Selenized

DARK
background: #103c48
text: #adbcbc

LIGHT
background: #fbf3db
text: #53676d

================================

Solarized

DARK
background: #002b36
text: #93a1a1

LIGHT
background: #fdf6e3
text: #586e75

================================

Tokyo Night

DARK
background: #1a1b26
text: #a9b1d6

LIGHT
background: #d5d6db
text: #343b58

```

### config\dynamic-theme-fixes.config

```
*

INVERT
.jfk-bubble.gtx-bubble
.captcheck_answer_label > input + img
span#closed_text > img[src^="https://www.gstatic.com/images/branding/googlelogo"]
span[data-href^="https://www.hcaptcha.com/"] > #icon
img.Wirisformula
a[data-testid="headerMediumLogo"]>svg
.d2l-navigation-link-image-container
.d2l-iframe-loading-container

CSS
.vimvixen-hint {
    background-color: ${#ffd76e} !important;
    border-color: ${#c59d00} !important;
    color: ${#302505} !important;
}
#vimvixen-console-frame {
    color-scheme: light !important;
}
::placeholder {
    opacity: 0.5 !important;
}
#edge-translate-panel-body,
.MuiTypography-body1,
.nfe-quote-text {
    color: var(--darkreader-neutral-text) !important;
}
gr-main-header {
    background-color: ${lightblue} !important;
}
.tou-z65h9k,
.tou-mignzq,
.tou-1b6i2ox,
.tou-lnqlqk {
    background-color: var(--darkreader-neutral-background) !important;
}
.tou-75mvi {
    background-color: ${rgb(207, 236, 245)} !important;
}
.tou-ta9e87,
.tou-1w3fhi0,
.tou-1b8t2us,
.tou-py7lfi,
.tou-1lpmd9d,
.tou-1frrtv8,
.tou-17ezmgn {
    background-color: ${rgb(245, 245, 245)} !important;
}
.tou-uknfeu {
    background-color: ${rgb(250, 237, 218)} !important;
}
.tou-6i3zyv {
    background-color: ${rgb(133, 195, 216)} !important;
}
div.mermaid-viewer-control-panel .btn {
    background-color: var(--darkreader-neutral-background);
    fill: var(--darkreader-neutral-text);
}
svg g rect.er {
    fill: var(--darkreader-neutral-background) !important;
}
svg g rect.er.entityBox {
    fill: var(--darkreader-neutral-background) !important;
}
svg g rect.er.attributeBoxOdd {
    fill: var(--darkreader-neutral-background) !important;
}
svg g rect.er.attributeBoxEven {
    fill: var(--darkreader-selection-background);
    fill-opacity: 0.8 !important;
}
svg rect.er.relationshipLabelBox {
    fill: var(--darkreader-neutral-background) !important;
}
svg g g.nodes rect,
svg g g.nodes polygon {
    fill: var(--darkreader-neutral-background) !important;
}
svg g rect.task {
    fill: var(--darkreader-selection-background) !important;
}
svg line.messageLine0,
svg line.messageLine1 {
    stroke: var(--darkreader-neutral-text) !important;
}
div.mermaid .actor {
    fill: var(--darkreader-neutral-background) !important;
}
mitid-authenticators-code-app > .code-app-container {
    background-color: white !important;
    padding-top: 1rem;
}
iframe#unpaywall[src$="unpaywall.html"] {
    color-scheme: light !important;
}
select option {
    background-color: var(--darkreader-neutral-background) !important;
}
body#tumblr {
    --darkreader-bg--secondary-accent: 31, 32, 34 !important;
    --darkreader-bg--white: 23, 23, 23 !important;
    --darkreader-text--black: 228, 224, 218 !important;
}
:host {
    --d2l-border-color: var(--darkreader-bg--d2l-color-gypsum) !important;
    --d2l-button-icon-background-color-hover: var(--darkreader-bg--d2l-color-gypsum) !important;
    --d2l-color-ferrite: var(--darkreader-neutral-text) !important;
    --d2l-color-sylvite: var(--darkreader-bg--d2l-color-sylvite) !important;
    --d2l-dropdown-background-color: var(--darkreader-neutral-background) !important;
    --d2l-dropdown-border-color: var(--darkreader-border--d2l-color-mica) !important;
    --d2l-input-backgroud-color: var(--darkreader-neutral-background) !important;
    --d2l-menu-border-color: var(--darkreader-bg--d2l-color-gypsum) !important;
    --d2l-tooltip-background-color: var(--darkreader-neutral-background) !important;
    --d2l-tooltip-border-color: var(--darkreader-bg--d2l-color-gypsum) !important;
}
:host([_floating]) .d2l-floating-buttons-container {
    background-color: var(--darkreader-neutral-background) !important;
    border-top-color: var(--darkreader-border--d2l-color-mica) !important;
    opacity: 0.88 !important;
}
d2l-card {
    background: var(--darkreader-neutral-background) !important;
    border-color: var(--darkreader-border--d2l-color-gypsum) !important;
}
d2l-dropdown-content > div,
d2l-menu-item {
    background-color: var(--darkreader-neutral-background) !important;
    border-radius: 10px !important;
}
d2l-empty-state-simple {
    border-color: var(--darkreader-bg--d2l-color-gypsum) !important;
}
.d2l-button-filter > ul > li > a.vui-button {
    border-color: var(--darkreader-border--d2l-color-mica) !important;
}
.d2l-label-text:has(.d2l-button-subtle-content):hover,
.d2l-label-text:has(.d2l-button-subtle-content):focus,
.d2l-label-text:has(.d2l-button-subtle-content):active {
    background-color: var(--darkreader-bg--d2l-color-gypsum) !important;
}
.d2l-navigation-centerer {
    color: inherit !important;
}
.d2l-tabs-layout {
    border-color: var(--darkreader-border--d2l-color-gypsum) !important;
}
.d2l-input,
.d2l-calendar-date,
.d2l-htmleditor-container {
    background-color: var(--darkreader-neutral-background) !important;
}
.d2l-collapsible-panel {
    border: 1px solid var(--darkreader-border--d2l-color-mica) !important;
    border-radius: 0.4rem !important;
}
.d2l-collapsible-panel-divider {
    border-bottom: 1px solid var(--darkreader-border--d2l-color-mica) !important;
}
.d2l-w2d-flex {
    border-bottom: 2px solid var(--darkreader-border--d2l-color-mica) !important;
}
.d2l-collapsible-panel scrolled,
.d2l-collapsible-panel-header,
.d2l-w2d-collection-fixed {
    background-color: var(--darkreader-neutral-background) !important;
}
.d2l-loading-spinner-bg {
    fill: var(--darkreader-bg--d2l-color-gypsum) !important;
}
.d2l-loading-spinner-bg-stroke {
    stroke: var(--darkreader-border--d2l-color-mica) !important;
}
.d2l-loading-spinner-wrapper svg path,
.d2l-loading-spinner-wrapper svg circle {
    fill: var(--darkreader-neutral-background) !important;
}

IGNORE INLINE STYLE
.sr-wrapper *
.sr-reader *
.diigoHighlight

================================

*.abc.net.au

INVERT
[data-component="ABCNewsLogo"] *

IGNORE INLINE STYLE
[data-component="ABCLogo"] *

================================

*.americanexpress.com

INVERT
img[alt*="FDIC-Insured"]

CSS
select[aria-labelledby="bankAccount-label"] > option {
    background-color: var(--darkreader-neutral-background) !important;
}

================================

*.archlinux.org

INVERT
img[src*="icons/"]
img[src="/svg/calendar.svg"]
.cdx-search-input .cdx-text-input__icon.cdx-text-input__start-icon
.cdx-button--icon-only .vector-icon

CSS
.vector-sticky-pinned-container::after {
    background: inherit;
}
body {
    height: fit-content;
}

================================

*.babbel.com

IGNORE INLINE STYLE
#radix-\:r2\: > svg:nth-child(1) *
#radix-\:r3\: > div > div > div > svg *
#\32 53PcCLJv1hu747b7LM72J > div > div > div > div > div > a > div > svg *
#\35 1RrI7tAWynOXHmNFDQeaT > div > div > div > div > div > a > div > svg *

================================

*.bambulab.com

CSS
.bannerTextWrap .title,
.bannerTextWrap .subtitle {
    text-shadow: ${rgb(225, 212, 201)} 1px 1px 0px !important;
}

================================

*.bitrix24.ru

INVERT
#ws-canvas

================================

*.cnrtl.fr

CSS
.tlf_cdefinition {
    background-color: ${rgb(255, 255, 0)} !important;
}
.tlf_cdomaine {
    background-color: ${rgb(255, 176, 96)} !important;
}
.tlf_csyntagme {
    background-color: ${rgb(192, 255, 192)} !important;
}

================================

*.crm*.dynamics.com

CSS
.ms-Label {
    color: var(--darkreader-neutral-text) !important;
}

================================

*.discogs.com

CSS
[class*="logo"] {
    filter: invert(100%) hue-rotate(180deg) !important;
}
.swiper-pagination-bullet {
    background: var(--swiper-pagination-bullet-inactive-color, #FFFFFF) !important;
}

================================

*.docs.kubernetes.io

CSS
.highlight pre code > span[style*="text-decoration: underline"] {
    text-decoration: none !important;
}

================================

*.galaxus.de

INVERT
#logo

CSS
#sidebarMenu div {
    background: var(--darkreader-neutral-background) !important;
}

================================

*.gamer.com.tw

INVERT
.sidenav__icon

CSS
body {
    background-color: transparent !important;
    background-image: none !important;
}
.main-nav__logo {
    background-color: currentColor !important;
}

IGNORE IMAGE ANALYSIS
.service__icon.icon-arrow
.MSG-mainpic
#BH-main_menu
#BH-master h4
.BH-slave_btns .BH-slave_btnA
#BH-slave h5

================================

*.globo.com

INVERT
.header__brand__link[href*=extra]
.header__brand__link[href*=umsoplaneta] path[fill=black]
.header__brand__link[href*=umsoplaneta] path[stroke=black]
.header__brand__link[href*=marieclaire]
.header__brand__link[href*=revistaquem]
.header__brand__link[href*=gq]
#logo-valor_100-anos
.pages-footer img[src$="logo_edg.png"]
.pages-footer img[src$="logo-Conde-Nast.png"]
.pages-footer img[src$="logo_condenast.png"]
.pages-footer img[src$="Rádio_wordmark.png"]
.header__menu__icon_background_color

CSS
.bar-scrubber .bar-scrubber-icon,
.bar-background .bar-fill-2 {
    background-color: var(--darkreader-neutral-text) !important;
}
.bar-background .bar-fill-1 {
    background-color: rgba(255, 255, 255, .3) !important;
}
.multicontent {
    background-color: var(--darkreader-neutral-background) !important;
    color: var(--darkreader-neutral-text) !important;
}
span.bstn-hl-summary {
    color: var(--darkreader-neutral-text) !important;
}
.glb-grid .tabela-body {
    background-color: var(--darkreader-neutral-background) !important;
}
.bstn-hl.with-photo::before {
    background-image: var(--bstn-hl-cover) !important;
}
.footer__logo__wrapper {
    background: var(--darkreader-bg--custom-footer-background) !important;
}

IGNORE INLINE STYLE
.poster__play-wrapper *
#Logo_Valor_Economico_Branco *

IGNORE IMAGE ANALYSIS
.barra-globocom .barra-itens li .barra-item-videos

================================

*.iherb.com

INVERT
ul.social-media-icons
.my-account-link-icon
.icon-box > svg > path
.rtl-plugin-key-1301cbg > div > div > svg > path
.add-to-cart-checkmark
.add-to-cart-close

CSS
.rtl-plugin-key-bpb6ad svg path,
.rtl-plugin-key-14wt5ex svg path,
span.search-glass {
    fill: var(--darkreader-text-666666) !important;
}
.payment-sprite,
.product-image-wrapper,
.product-image,
#productundefined > div > a > img,
.rtl-plugin-key-k008qs > div > img,
.top-affiliate-network-grid > a > img,
.brands-banner-collapsible img:first-of-type,
#brands-of-the-week-inner > li > a > div > img,
#brands-of-week > div.row.row-centered.subdivide-10-greater > div > div > img,
img[class^="ProductItem__ProductImage"] {
    background-color: #f7f8f7 !important;
}
div[class^="components__Container"],
div[class^="ProductPanel__Container"] {
    background-color: initial !important;
    opacity: 0.99 !important;
}

IGNORE INLINE STYLE
.custom-flex-box-item span

================================

*.instructure.com

CSS
.css-vrgbjj-textArea {
    background: var(--darkreader-neutral-background) !important;
    color: var(--darkreader-neutral-text) !important;
}

================================

*.maricopa.edu

CSS
#background-content {
    background: var(--darkreader-neutral-background) !important;
}

================================

*.myconnectwise.net

CSS
.cwsvg {
    fill: white;
}

================================

*.myworkday.com

INVERT
.WIF3
.WIF3:hover
.WIG3
.WIG3:hover
.WFD3 .WGL3
.WAJS
.WAJS:hover
.WJG3
.WHL3
.WKFP

================================

*.seoul.go.kr

INVERT
.h-logo
.s-live-icon

================================

*.service-now.com

INVERT
.highcharts-legend-item text
.palette-content.trees .tree_spacer
.palette-content.trees img.tree
.palette-content.trees img.wf-list-icon

CSS
.cm-s-snc span.cm-string {
    color: #cf947b !important;
}
.cm-s-snc span.cm-def {
    color: #60a4d8 !important;
}
.cm-s-snc span.cm-property {
    color: white !important;
}
.cm-s-snc_readonly span.cm-string {
    color: #cf947b !important;
}
#hierarchy-menu {
    background-color: #797774 !important;
}
.sn-ng-bsm svg {
    fill: #FFF !important;
}
.ui-refresh .btn-inline-form,
.ui-refresh .btn-inline-form-attached {
    background-color: #797774;
}
.node-outline {
    fill: #797774 !important;
}
.sn-polaris-nav {
    background-color: #000 !important;
    color: #FFF !important;
}
.snf-collapsible-list-header {
    background-color: #000 !important;
    color: #FFF !important;
}
.sn-polaris-nav-list-items a.item-label .item-icon {
    background-color: #000 !important;
    color: #FFF !important;
}
.snf-collapsible-list-items,
.snf-collapsible-list-items a {
    background-color: #000 !important;
    color: #FFF !important;
}
.sn-history-menu .menu-item > .menu-item-label > span.label {
    background-color: #000 !important;
    color: #FFF !important;
}
.sn-history-menu .menu-item > .menu-item-label > span.menu-item-description {
    background-color: #000 !important;
    color: #FFF !important;
}
div >  .sn-history-menu mark.filter-match,
.sn-history-menu mark.filter-match-fuzzy {
    color: #FFF !important;
}
div >  .sn-history-menu .is-filtered .label {
    color: #FFF !important;
}
span.is-filtered .label {
    color: #FFF !important;
}
.is-filtered .item-icon .label {
    color: #FFF !important;
}
span > mark.filter-match,
mark.filter-match-fuzzy {
    color: #FFF !important;
}
.tox .tox-tbtn svg {
    fill: #FFF !important;
}
.user-menu-label {
    color: #FFF !important;
}
.sn-polaris-tab.is-active {
    background-color: #000;
    color: #fff !important;
}
.grid-container svg path {
    fill: #000 !important;
}

================================

*.speedtestcustom.com

CSS
.stroke-primary {
    stroke: #003b5c !important;
}
.result-graph-svg {
    fill: #003b5c !important;
}

================================

*.webex.com

CSS
body {
    background: var(--darkreader-neutral-background) !important;
}
.wxp-chapter-bar-item-progress {
    background: var(--mds-color-decorative-violet-50) !important;
}

================================

*.wvu.edu

CSS
.bg-dark {
    background-color: rgba(var(--bs-dark-rgb), var(--bs-bg-opacity)) !important;
}
.bg-wvu-accent--blue {
    background-color: rgba(var(--bs-wvu-accent--blue-rgb), var(--bs-bg-opacity)) !important;
}
.bg-wvu-accent--blue-dark {
    background-color: rgba(var(--bs-wvu-accent--blue-dark-rgb), var(--bs-bg-opacity)) !important;
}
.bg-wvu-accent--blue-light {
    background-color: rgba(var(--bs-wvu-accent--blue-light-rgb), var(--bs-bg-opacity)) !important;
}
.bg-wvu-accent--old-gold {
    background-color: rgba(var(--bs-wvu-accent--old-gold-rgb), var(--bs-bg-opacity)) !important;
}
.bg-wvu-accent--sunset {
    background-color: rgba(var(--bs-wvu-accent--sunset-rgb), var(--bs-bg-opacity)) !important;
}
.bg-wvu-accent--yellow {
    background-color: rgba(var(--bs-wvu-accent--yellow-rgb), var(--bs-bg-opacity)) !important;
}
.bg-wvu-blue {
    background-color: rgba(var(--bs-wvu-blue-rgb), var(--bs-bg-opacity)) !important;
}
.bg-wvu-gold {
    background-color: rgba(var(--bs-wvu-gold-rgb), var(--bs-bg-opacity)) !important;
}
.bg-wvu-neutral--cream {
    background-color: rgba(var(--bs-wvu-neutral--cream-rgb), var(--bs-bg-opacity)) !important;
}
.bg-wvu-neutral--off-white {
    background-color: rgba(var(--bs-wvu-neutral--off-white-rgb), var(--bs-bg-opacity)) !important;
}
.bg-wvu-neutral--warm-gray-dark {
    background-color: rgba(var(--bs-wvu-neutral--warm-gray-dark-rgb), var(--bs-bg-opacity)) !important;
}
.bg-wvu-neutral--warm-gray-light {
    background-color: rgba(var(--bs-wvu-neutral--warm-gray-light-rgb), var(--bs-bg-opacity)) !important;
}
.bg-wvu-neutral--warm-gray-medium {
    background-color: rgba(var(--bs-wvu-neutral--warm-gray-medium-rgb), var(--bs-bg-opacity)) !important;
}
.bg-wvu-neutral--tan {
    background-color: rgba(var(--bs-wvu-neutral--tan-rgb), var(--bs-bg-opacity)) !important;
}
.btn-outline-wvu-blue,
.text-wvu-accent--blue,
.text-wvu-accent--blue-dark,
.text-wvu-accent--old-gold,
.text-wvu-blue,
.text-wvu-neutral--warm-gray-dark {
    background-color: var(--bs-body-bg);
}
.text-wvu-accent--blue {
    color: rgba(var(--bs-wvu-accent--blue-rgb), var(--bs-text-opacity)) !important;
}
.text-wvu-accent--blue-dark {
    color: rgba(var(--bs-wvu-accent--blue-dark-rgb), var(--bs-text-opacity)) !important;
}
.text-wvu-accent--blue-light {
    color: rgba(var(--bs-wvu-accent--blue-light-rgb), var(--bs-text-opacity)) !important;
}
.text-wvu-accent--old-gold {
    color: rgba(var(--bs-wvu-accent--old-gold-rgb), var(--bs-text-opacity)) !important;
}
.text-wvu-accent--sunset {
    color: rgba(var(--bs-wvu-accent--sunset-rgb), var(--bs-text-opacity)) !important;
}
.text-wvu-accent--yellow {
    color: rgba(var(--bs-wvu-accent--yellow-rgb), var(--bs-text-opacity)) !important;
}
.text-wvu-blue {
    color: rgba(var(--bs-wvu-blue-rgb), var(--bs-text-opacity)) !important;
}
.text-wvu-gold {
    color: rgba(var(--bs-wvu-gold-rgb), var(--bs-text-opacity)) !important;
}
.text-wvu-neutral--cream {
    color: rgba(var(--bs-wvu-neutral--cream-rgb), var(--bs-text-opacity)) !important;
}
.text-wvu-neutral--off-white {
    color: rgba(var(--bs-wvu-neutral--off-white-rgb), var(--bs-text-opacity)) !important;
}
.text-wvu-neutral--warm-gray-dark {
    color: rgba(var(--bs-wvu-neutral--warm-gray-dark-rgb), var(--bs-text-opacity)) !important;
}
.text-wvu-neutral--warm-gray-light {
    color: rgba(var(--bs-wvu-neutral--warm-gray-light-rgb), var(--bs-text-opacity)) !important;
}
.text-wvu-neutral--warm-gray-medium {
    color: rgba(var(--bs-wvu-neutral--warm-gray-medium-rgb), var(--bs-text-opacity)) !important;
}
.text-wvu-neutral--tan {
    color: rgba(var(--bs-wvu-neutral--tan-rgb), var(--bs-text-opacity)) !important;
}
.wvu-overflow-hidden {
    color: var(--bs-body-color);
}

================================

01net.com

CSS
html,
body {
    color: ${#090702} !important;
}

================================

10fastfingers.com

CSS
#speedtest-main .hide-time {
    color: transparent !important;
}
#inputfield {
    background: var(--darkreader-neutral-background) !important;
    color: var(--darkreader-neutral-text) !important;
}
body,
.container-modified > .row,
#practice-main,
#top1000-index-container,
#text-practice,
#content-bg {
    background: var(--darkreader-neutral-background) !important;
}
#main-content-trenner {
    background: var(--darkreader-neutral-background) !important;
    border-bottom: 1px solid rgb(151, 141, 127) !important;
}

================================

10minutemail.com

CSS
#main_content {
    background-image: none !important;
}

================================

123-3d.nl
123accu.nl
123inkt.nl
123led.nl
123schoon.nl

CSS
.main-panel-left,
.main-panel-right {
    background: var(--darkreader-neutral-background) !important;
}

================================

123mathe.de

INVERT
.entry-content img

CSS
body,
.post-inner,
ul.sub-menu {
    background-color: var(--darkreader-neutral-background) !important;
}
ul.sub-menu::after {
    border-bottom-color: var(--darkreader-neutral-background) !important;
}
.progress-wrap {
    box-shadow: var(--darkreader-neutral-background) 0px 0px 0px 3px inset !important;
}

================================

1337x.st
1337x.to
x1337x.eu
x1337x.se
x1337x.ws

CSS
.torrent-tabs .tab-nav {
    background-color: var(--darkreader-neutral-background) !important;
    background-image: none !important;
    border-bottom-color: var(--darkreader-neutral-background) !important;
}

================================

1917.com

CSS
body {
    background-color: var(--darkreader-neutral-background) !important;
    background-image: none !important;
}

================================

1fichier.com

CSS
body {
    background-image: none !important;
}

================================

2700chess.com

INVERT
#live-ratings-table td *:not(.flag):last-child

IGNORE IMAGE ANALYSIS
.cg-wrap piece.rook.black
.cg-wrap piece.knight.black
.cg-wrap piece.bishop.black
.cg-wrap piece.queen.black
.cg-wrap piece.king.black
.cg-wrap piece.knight.black
.cg-wrap piece.pawn.black

================================

2gis.*

INVERT
#map
path[d^="M34.8"]
._oow7vi
path[d^="M15.759"]

CSS
a,
abbr,
acronym,
address,
applet,
article,
aside,
audio,
b,
big,
blockquote,
body,
canvas,
caption,
center,
cite,
code,
dd,
del,
details,
dfn,
div,
dl,
dt,
em,
embed,
fieldset,
figcaption,
figure,
footer,
form,
h1,
h2,
h3,
h4,
h5,
h6,
header,
hgroup,
html,
i,
iframe,
img,
ins,
kbd,
label,
legend,
li,
main,
mark,
menu,
nav,
object,
ol,
output,
p,
pre,
q,
ruby,
s,
samp,
section,
small,
span,
strike,
strong,
sub,
summary,
sup,
table,
tbody,
td,
tfoot,
th,
thead,
time,
tr,
tt,
u,
ul,
var,
video {
    color: var(--darkreader-neutral-text) !important;
}
div[style^="--bg-color"] {
    --bg-color: var(--darkreader-neutral-background) !important;
}
div[style="transform:rotateX(0deg)"] > svg[width="38"] path {
    fill: ${black} !important;
}
button[data-hamburger] span {
    background-color: ${black} !important;
}

IGNORE INLINE STYLE
a[href="/"] > svg *

================================

3.basecamp.com

CSS
body,
.nav__main {
    background-color: ${white};
}
@media screen and (min-width: 768px) {
    .panel--perma,
    .panel--project {
        box-shadow: rgba(0, 0, 0, 0.05) 0px -1px 10px, rgba(0, 0, 0, 0.1) 0px 1px 4px, rgb(24, 26, 27) 0px 10px 30px;
    }
}

================================

300gospodarka.pl
300polityka.pl

INVERT
#logo
img[alt="300Gospodarka"]
img[alt="Zespół 300Gospodarki"]

================================

338canada.com

CSS
svg text:not([fill]) {
    fill: var(--darkreader-neutral-text);
}

================================

350.org
map.350.org

INVERT
.dark\:bg-gray-700
.dark\:bg-gray-700::after
.dark\:text-gray-300
.mapboxgl-canvas
.mapboxgl-ctrl-compass > .mapboxgl-ctrl-icon
.mapboxgl-ctrl-logo
.mapboxgl-marker

CSS
mapbox-search-box > input {
    --darkreader-bg--boxShadow: 0 0 10px 2px ${rgba(0, 0, 0, 0.05)}, 0 0 6px 1px ${rgba(0, 0, 0, 0.1)}, 0 0 0 1px ${rgba(0, 0, 0, 0.1)} !important;
}

================================

37.com

INVERT
.logo37

================================

3dmark.com

INVERT
.logo

================================

40ton.net

INVERT
.td-main-logo

================================

4t-niagara.com

CSS
.download_link > h3,
.buy_link > h3 {
    color: ${#88c1ff} !important;
}
.download_link li,
.buy_link li {
    color: ${white} !important;
}

================================

9game.cn

INVERT
.logo9game

================================

a11ywithlindsey.com

INVERT
.logo

CSS
:root {
    --off-white: var(--darkreader-neutral-background) !important;
}

================================

aad.org

INVERT
.header-AAD-logo

================================

aaha.org

CSS
.wrap1 {
    background-color: var(--darkreader-neutral-background) !important;
}

================================

abandonia.com

CSS
.alt1G2 {
    background-image: none !important;
}
.alt2G2 {
    background-image: none !important;
}

================================

abcnews.go.com

INVERT
.navLogo
#sections
#search
#notifications

================================

abiturma.de

INVERT
div.formula
amp-img.latex-inline
img[src^="/assets/compiled-latex/"]

================================

ableton.com

INVERT
.main-nav__logo
.main-footer__basics__logo
.main-footer__secondary__signature__logo

CSS
.body-text--manual figure img {
    background-color: #DCDAD8 !important;
}

================================

about.gitlab.com

INVERT
div.customer-logos__companies a

CSS
.progressbar {
    background: black;
}

================================

academy.abeka.com

INVERT
.logo img
.center-align img

================================

academy.dqlab.id

INVERT
.menu img

================================

access.ing.de

CSS
.tile__info {
    background-color: #fff !important;
}

================================

access.wgu.edu
my.wgu.edu

INVERT
img[alt="WGU Logo"]
.nav-hamburger

================================

accessiblepalette.com

INVERT
.swatch .hex

IGNORE INLINE STYLE
.swatch

================================

accesswire.com

INVERT
.v2-nav-logo

================================

account.live.com

INVERT
.ms-Grid-col.ms-sm8.ms-lg4
.ms-Grid-col.ms-sm4.ms-hiddenMdDown.pullout-textwrap
.ms-Grid-col.ms-sm2 img
.pullout-link-text
.pullout-icon:not(.ms-Icon--SkypeCircleCheck)
.pullout-textwrap span

CSS
img[class="ShowMoreLoading"] {
    filter: invert(93.7%) hue-rotate(180deg) contrast(90.6%) !important;
}

================================

account.microsoft.com/profile

INVERT
.ms-StackItem div div img[src*="svg?n"]

================================

account.orchid.com

INVERT
.walletconnect-qrcode__image

================================

account.proton.me
account.protonvpn.com

CSS
.qr-code {
    border: 5px solid white !important;
}

IGNORE INLINE STYLE
.logo *
.qr-code *

================================

account.ui.com

CSS
div[class^="Toggle-module_switcher"] {
    background-color: var(--darkreader-neutral-text) !important;
}
input[class^="Toggle-module_input"] {
    background-color: initial;
}
div[class^="Modal-module_content"] form > div > canvas {
    border: 5px solid white !important;
}

================================

account.xiaomi.com

CSS
.mi-profile-layout__profile {
    background-image: none !important;
}

================================

accounts.fedoraproject.org

INVERT
.navbar-brand

================================

accounts.google.com

INVERT
img[src$="signin_tapyes.gif"]

CSS
#countryList div[role="option"][data-value] > div > div > div[style] {
    background-image: url('//ssl.gstatic.com/i18n/flags/48x32/nobevel/66bdb7a1bbbdbf86a67de382fac49ecc/flags.png') !important;
}

================================

accounts.hetzner.com
dns.hetzner.com
konsoleh.hetzner.com
robot.hetzner.com

INVERT
.top-bar-link > img
.d-flex > img
#panel_dropdown_btn > img
#user_dropdown_btn > img

================================

accounts.spotify.com

INVERT
.spotify-logo

================================

accounts.zoho.com

INVERT
div#product_img.tfa_totp_mode
span.zoho_logo
.zwHDots

================================

accuweather.com

INVERT
.allergy-icon
.icon-search
img[src$="arrow-right-black.svg"]

CSS
.today-label,
.y-axis-label,
.x-axis-day-label,
.x-axis-month-label {
    fill: var(--darkreader-neutral-text) !important;
}

================================

acer.com

INVERT
.firstHeader .logos

CSS
.contSectionBen img {
    filter: brightness(50%) sepia(40%) !important;
}
.contSectionBen .textOverBen {
    position: inherit !important;
}

================================

acmicpc.net

INVERT
.cm-s-lucario.CodeMirror

================================

acorn.utoronto.ca

CSS
.acorn-classic.page-container .academic-history .sessionHeader,
.acorn-classic.page-container .academic-history .credit-earned-section,
.acorn-classic.page-container .academic-history .average-section,
.acorn-classic.page-container .academic-history .courses,
.acorn-classic.page-container .academic-history .coursesHeader,
.acorn-classic.page-container .academic-history .academic-history-report .gpa-listing,
.acorn-classic.page-container .academic-history-recent table .emph {
    color: var(--darkreader-neutral-text) !important;
}

================================

action.com

CSS
.bg-black {
    background-color: transparent !important;
}

================================

actioncardapp.com

INVERT
.logo

================================

ad.nl

CSS
.instanews-page-main-content {
    color: var(--darkreader-neutral-text) !important;
}

================================

ada.org

INVERT
.logo

================================

adata.com

INVERT
.logo-nav

================================

addic7ed.com

INVERT
.tablecorner img

CSS
.NewsTitle {
    background-color: rgb(0, 62, 81);
}
.language {
    background-color: rgba(7, 73, 89);
}

================================

addons.mozilla.org

INVERT
div[class="Rating Rating--small"]
img.SecondaryHero-module-icon

IGNORE IMAGE ANALYSIS
.Icon-youtube
span.Permission-description::before

================================

adguard-dns.io

INVERT
.animation__video
.footer__logo
.header__logo
.map__point-icon
.map__point-city
.servers-info__queries

CSS
.animation__video {
    z-index: 0 !important;
}
.map__point-city,
.servers-info__map {
    filter: invert(1) hue-rotate(120deg) brightness(250%) !important;
}

================================

adguard-vpn.com

INVERT
.header__logo

================================

adguard.com

INVERT
a.header__logo
svg.reviews__icon-topic
.article__section--list-ico .md__list .md__img
.article__content--title-ico .article__section .md__title .md__img
.p-header-logo.p-header-logo--image img
.icon--gray-chrome
.icon--gray-edge
.icon--gray-opera
.icon--gray-firefox

IGNORE IMAGE ANALYSIS
.icon--gray-opera
.icon--gray-firefox

================================

admin.google.com

INVERT
.qV6brd img

================================

admin.migadu.com

CSS
.container {
    background-image: none !important;
}

================================

afterpay.com

INVERT
div[class^="navigation_logo"]

================================

aftership.com

CSS
#sapper div.multi-track-input {
    background-color: var(--darkreader-neutral-background) !important;
}

================================

aftonbladet.se

CSS
a[href$="plus_plusikon"] > :nth-child(1) {
    color: ${white};
}

================================

ai2.appinventor.mit.edu

CSS
.blocklyDraggable text {
    color: var(--darkreader-neutral-text) !important;
}

================================

aiming.pro

INVERT
#left_side_bar > div.logo > a > img

================================

airbnb.*
airbnb.*.*

INVERT
input[name="categoryScroller"] + div img

================================

aistudio.google.com

CSS
:root .light-theme {
    color-scheme: light !important;
}
[data-darkreader-scheme="dark"] .light-theme {
    color-scheme: dark !important;
}

================================

akademy.kde.org
edu.kde.org
dot.kde.org
forum.kde.org

CSS
body,
#footer {
    background: ${rgb(225, 227, 228)} !important;
}

================================

akasa.com

INVERT
.logo

================================

akcemed.pl

INVERT
.td-main-menu-logo
.footer-logo-wrap

================================

akinator.com

INVERT
.bubble
.bubble-body

CSS
.bubble {
    background-color: ${black} !important;
    color: ${white} !important;
}
.bubble-body {
    background-color: ${white} !important;
    color: ${black} !important;
}
.question-number {
    color: ${white} !important;
}

================================

alamy.com

CSS
.bg-opacity-0 {
    background-color: transparent !important;
}

================================

aldi.us

IGNORE INLINE STYLE
.company-logo-content *

================================

alertus.com

INVERT
.Header-branding
[src^="https://images.squarespace-cdn.com"]

================================

alexpage.de

CSS
#page {
    background-color: var(--darkreader-neutral-background) !important;
    background-image: none !important;
}

================================

alfies.at

CSS
[class*="searchbox"] * {
    background-color: var(--darkreader-neutral-background) !important;
}

================================

alfredapp.com

INVERT
[src*="macworld.png"]
[src*="tuaw.png"]
[src*="eddy_awards.png"]
[src*="appstorm.png"]
[src*="tnw.png"]
[src*="search.jpg"]
[src*="clipboard.jpg"]
[src*="control.jpg"]
[src*="konami-code.png"]
[src*="oatmeal404.jpg"]
[src*="query-history.png"]

================================

algorithm-wiki.org

INVERT
.thumbimage

CSS
.thumbimage {
    background-color: ${rgb(1, 4, 5)} !important;
    border-color: ${rgb(48, 54, 57)} !important;
}

================================

aliexpress.*
aliexpress.*.*
*.aliexpress.*

INVERT
.group-title-img
.EYoOU
path[d^="M0 4C0"]
.rax-text-v2.AIC-PI-MobPriceText.rax-text-v2--overflow-hidden.rax-text-v2--singleline

CSS
a[class^="SnowOrderDetails_Product__imageWrap"],
div[class^="SnowOrderList_ProductImage__imageWrapper"],
a[class^="RedOrderDetailsProductsV2_Product__imageWrap"],
div[class^="RedOrderList_ProductImage__imageWrapper"] {
    background-color: #fff !important;
}
.comet-icon[class*="rating--top"] {
    color: ${yellow} !important;
}
._2E4Wz {
    background-color: ${yellow} !important;
}

IGNORE INLINE STYLE
svg[class^="ali-kit_Rating__star"]

================================

alipay.com

INVERT
#J_logoHomeUrl
.global-logo

CSS
.qrcode-detail-img {
    background-color: white !important;
}
.authcenter-background {
    z-index: 0 !important;
}
.authcenter-head,
.authcenter-foot,
.authcenter-body-login,
.authcenter-body-logo > a {
    z-index: 1 !important;
}

================================

aljazeera.com

INVERT
#site-logo > img
.navbar-brand > img
#navbar-hamburger-mobile

================================

allconnect.com

INVERT
.mininav-header__logo-image

================================

allegrolokalnie.pl

INVERT
.mlc-masthead__branding
.mlc-site-footer__branding

================================

allestoringen.*
downdetector.*
downdetector.*.*
xn--allestrungen-9ib.*

INVERT
#map_container
#map-card

================================

allmacworld.com

INVERT
.logo
.tie-appear.post-thumbnail
.tie-appear.post-thumbnail > [href="https://allmacworld.com/blocs-free-download/"]
.tie-appear.post-thumbnail > [href="https://allmacworld.com/waves-v11-complete-download-free/"]
.tie-appear.post-thumbnail > [href="https://allmacworld.com/3dequalizer-4-for-mac-free-download/"]
.tie-appear.post-thumbnail > [href="https://allmacworld.com/sylenth1-for-mac-free-download/"]
.tie-appear.post-thumbnail > [href="https://allmacworld.com/synapse-audio-legend-free-download/"]

================================

allrecipes.com

INVERT
.checkbox-list-checkmark::before
.external-link-icon
.icon-ellipsis > svg
.icon-email-outline
.icon-search
.icon-share-favorite
.rating-bar-wrapper
img[src="/img/profile.png"]
.mntl-header__close-icon
.mntl-header__menu-icon
.mntl-header__nav-panel-close-icon

================================

allspice.io

INVERT
[data-mesh-id="SITE_HEADERinlineContent"] img

================================

alphacoders.com

INVERT
.main
.main > *
#page_header
#page_header > *

================================

alphashooters.com

CSS
.site-container {
    --darkreader-bg--site-container-background: var(--darkreader-neutral-background) !important;
}

================================

alpine.com

INVERT
.alpsalpineLogo

================================

alt.hololive.tv

INVERT
video[src*="bg.mp4"]
video[src*="first.mp4"]
img[src*="logo_2line_gradient_color.svg"]
svg

================================

altlinux.org

INVERT
.mw-wiki-logo

================================

alza.*
m.alza.*

CSS
:root {
    --darkreader-neutral-background: ${#ebe3d5};
    --darkreader-neutral-text: ${#1a1b1a};
}
#boxc .box,
.detail-page {
    background: linear-gradient(180deg, ${#f5f5f5} 0,${#fff} 20px) !important;
}
footer {
    background-blend-mode: multiply !important;
    background-color: ${rgba(255,255,255,0.85)} !important;
}
.titleValue,
#boxc .box a.name,
#boxc .box div.Description,
#boxc .box .box-gbb-rating__text span {
    color: var(--darkreader-neutral-text) !important;
}
#tabs ul > li a {
    background-color: var(--darkreader-neutral-background) !important;
    color: var(--darkreader-neutral-text) !important;
}

================================

amalgamatedbank.com

CSS
.page-banner .banner-image {
    z-index: auto !important;
}

================================

amap.com

INVERT
.amap-info
.amap-menu
.imgfeed[style*="place_default.jpg"]
.logo-img
#subway-svg
#themap
.title01-logo > a > img

================================

amazingmarvin.com

INVERT
.header-title

================================

amazon.*
amazon.*.*

INVERT
#banner-image
#ordersContainer .a-box.order-attributes img
div.a-section.vse-lb-video-metadata
div.vse-video-content
div.vse-video-title
div.vse-video-labels
i.a-icon-search
img[role="presentation"]
img[src*="smile-logo"]
.a-icon-arrow.a-icon-small.arrow-icon
.a-icon-close
.a-icon-extender-expand
.a-icon-popover
.a-icon-section-collapse
.a-icon-section-expand
.a-link-nav-icon
.currencyINR
.ssf-share-trigger:not(.a-button)
.utility-bar-icon
.a-icon-small-add
.a-icon-small-remove
.a-icon-small-trash
.navFooterLine.navFooterLogoLine > a > img
#nav-logo > a > span
._recommendation-cards_style_bnp-card-icon__3_OCs
.bnp-feature-card-description-row > div > img
._YWItY_bnp-card-icon_T0dX_
#nav-logo-sprites

CSS
.banner-border {
    background-color: ${white} !important;
    background-image: none !important;
}
div.milestone.notReached .milestone-marker::before {
    border-color: var(--darkreader-neutral-text);
}
span.milestone-bar {
    z-index: 0;
}
span.milestone-bar_foreground {
    background-color: #4DC2B4;
}
span.milestone-bar_background {
    background-image: linear-gradient(var(--darkreader-neutral-text) 40%, #181a1b00 0px);
}
[class*="image-display"],
.a-image-container img,
.a-list-item img,
.a-section img,
[class*="imageContainer"] img,
[class*="productImageContainer"] *,
[data-pf=DESKTOP] [class*="img"] *,
[class*="ryp__review-candidate-new__product-image"] {
    mix-blend-mode: unset !important;
}
.bg-no-repeat .color-squid-ink-dark {
    color: #161e2d !important;
}
.abn-desktop-footer-app-qr > img {
    background-color: white !important;
}
#pickupInformation-container img {
    border: 20px solid white !important;
}

IGNORE INLINE STYLE
.s-color-swatch-inner-circle-fill

================================

amazon.cn

INVERT
#nav-logo

CSS
#nav-main,
.nav-search-scope {
    background-image: none !important;
}

================================

americanas.com.br

CSS
img[class*="LazyImage"] {
    mix-blend-mode: normal !important;
}

================================

ametek.com

INVERT
.ametek_logo

================================

amfam.com

INVERT
.SiteHeader__logo-img

================================

amtrak.com

INVERT
.am-simple-dropdown__control-caret
.farefinder-dash
img[alt="Click to add the number travelers and discount types"]
img[alt="Close"]
img[alt="More information about accessible travel requests."]
img[alt="Open"]
img[alt="Passenger"]
img[alt="Passenger Types and Discounts"]
img[alt="Plus Icon"]
img[alt="Switch departure and arrival stations."]
.mat-checkbox-ripple::before

CSS
.hero-banner-and-slides .full-width-img,
.hero-banner-and-slides .hero-banners__img-container {
    z-index: auto !important;
}
.promocode-input,
.value {
    background-color: inherit !important;
}

================================

amys.com

CSS
.body-with-illustration.pp,
.contact-us-footer.pp,
.dealer-link.pp,
.dealer-search.footer-strip.pp,
.featured-jobs.pp,
.featured-product.pp,
.love-letters-feedback.pp,
.social-media-feed.pp .posts a.twitter,
.social-media-feed.pp ul.juicer-feed .feed-item.j-twitter,
.social-media-feed.pp ul.juicer-feed li.placeholder.j-twitter,
.subscribe.pp,
.template-product .related-products.pp,
.two-col-images-detailed.pp,
header.main-head,
.pick-patty.pp.body-with-illustration:after,
.template-campaign-page .slideshow.pp:before,
.template-campaign-page .testimonials.pp:before,
.three-image-cta.pp.body-with-illustration:after,
header.main-head .inner:after,
nav.main-nav ul.children,
.latest-news.pp h2,
.latest-news.pp > span.herb {
    background-blend-mode: multiply !important;
    background-color: ${rgba(255,255,255,0.85)} !important;
}

================================

androidcentral.com

INVERT
.site-logo

CSS
.lazy-loaded {
    mix-blend-mode: normal !important;
}

================================

androidpolice.com

INVERT
.header-logo svg

================================

ang.pl

CSS
body {
    background-image: none !important;
}

================================

angrymetalguy.com

INVERT
.plbrand

CSS
.thepage {
    background-color: ${white} !important;
}
.content-pad {
    background-color: ${white} !important;
}

================================

anibrain.ai

IGNORE INLINE STYLE
div[class^="style__HexagonDiv"] *
svg[class^="styles__SvgWithShadow"] *

================================

anilibria.tv

CSS
#oframeanilibriaPlayer pjsdiv:nth-child(12) pjsdiv:nth-child(2) pjsdiv,
#oframeanilibriaPlayer pjsdiv:nth-child(14) pjsdiv:nth-child(2) pjsdiv {
    background-color: var(--darkreader-neutral-text) !important;
}

================================

anilist.co

CSS
:root {
    --color-background: 39,44,56 !important;
    --color-foreground: 31,35,45 !important;
    --color-foreground-blue: 25,29,38 !important;
    --color-foreground-blue-dark: 19,23,29 !important;
    --color-foreground-grey: 25,29,38 !important;
    --color-foreground-grey-dark: 16,20,25 !important;
    --color-text: 159,173,189 !important;
    --color-text-light: 129,140,153 !important;
    --color-text-lighter: 133,150,165 !important;
}

================================

ankiweb.net

CSS
.sidebar {
    background-color: var(--darkreader-neutral-background) !important;
}

================================

annas-archive.org

CSS
.header-inner div[style$="rgba(0, 0, 0, 0.41) 0px 0px 3px;"] {
    background-color: var(--darkreader-neutral-text) !important;
}

================================

anon-co-eu.com

INVERT
img[alt="Anon-Co Radios Europe"]

================================

anon-co.com

INVERT
img[alt="Anon-Co"]

================================

answers.opencv.org

CSS
#header,
body,
#question-list,
.short-summary,
#ground {
    background-image: none !important;
}

================================

answers.unity.com

IGNORE IMAGE ANALYSIS
header.section-header div.shard::before

================================

ant.design

INVERT
html[data-prefers-color="light"] .code-expand-icon

================================

antagning.se

INVERT
.a-logo
.burger
.uhrlogo
.expand-icon
.favourite-active

CSS
select {
    background-color: var(--darkreader-neutral-background) !important;
}

================================

antistorm.eu

INVERT
#map-area
#map-controls-area
#controlPlayPauseIcon
#meteogram_temperature
#meteogram_dewPoint
#meteogram_cloudCover
#meteogram_precipitation
#meteogram_precipitationProbability
#meteogram_pressure
#meteogram_windSpeed
img[src*="data:image/png;base64,iVBORw"]

================================

antywirus-nod32.pl

CSS
.module.infolinia {
    background-image: none !important;
}

================================

anytype.io

IGNORE IMAGE ANALYSIS
.img.home

================================

aol.com

INVERT
.logo

================================

aosc.io

INVERT
img[alt="logo"]
article.leading-6 img

CSS
#app > div {
    background-image: none !important;
}

================================

aosogrenci.anadolu.edu.tr

CSS
.welcome {
    background-image: none !important;
}

================================

apartmentlist.com

INVERT
div[class*="LogoContainer"]
div[class*="MenuButton"]

================================

apartments.com

INVERT
.logo

================================

apclassroom.collegeboard.org

INVERT
.overview-icon svg
.Zoom--expander svg
svg.icon--xmark
.RI_header__button svg.svg-icon

CSS
.standalone_image img {
    background-color: white;
}

================================

api.kde.org

INVERT
.center
.image

CSS
.memdoc,
.memproto {
    background-image: initial !important;
}

================================

api.rubyonrails.org

CSS
div.tree > ul > li {
    background-color: var(--darkreader-neutral-background);
}

================================

apidocs.snyk.io/

INVERT
#api-docs

================================

apie.lrt.lt

INVERT
img[alt="LRT"]
button[class^="Burger_burger"]

================================

apkpure.com

INVERT
img[src$="gp_logo.png"]

================================

apnews.com

INVERT
.hamburger-box
.sticky-part > div svg
.LeftRail > div svg
.Banner
.Banner-link

================================

apolloautomation.com

INVERT
button.pd-floating-icon__open > img
div.rating

CSS
.chat-toggle > svg > path {
    fill: var(--darkreader-neutral-text) !important;
}

================================

app.betrybe.com

INVERT
section.quiz-result__template summary
section.quiz-result__template summary .block-code

CSS
.home-projects details,
.header button,
.header a,
.module-index-content {
    background-color: transparent !important;
}
.header button:hover,
.header a:hover,
.module-index-content summary:active,
.quiz-question label {
    background-color: var(--darkreader-neutral-background) !important;
}
.quiz-question label p {
    color: rgb(180, 200, 255) !important;
}
.quiz-question__alternatives label:hover,
.quiz-question__alternatives input[type=radio]:checked + label {
    background: initial !important;
}

================================

app.circleci.com

INVERT
div[role="button"] svg[viewBox="0 0 300 100"]

================================

app.codesignal.com

CSS
.monaco-editor .cursor {
    background-color: var(--darkreader-selection-text) !important;
}

================================

app.corellium.com

INVERT
.brand
.logo

================================

app.daily.dev

IGNORE INLINE STYLE
.h-logo *

================================

app.datadoghq.com

INVERT
.HostMap-canvas

CSS
.log-dt-event.active,
.log-dt-event.active:hover,
.log-dt-event:hover {
    background-color: rgb(37, 45, 58) !important;
}
svg text.time_cursor {
    fill: ${black} !important;
}

================================

app.element.io
element.4d2.org
element.sibnsk.net

INVERT
.cpd-theme-light .mx_NotificationBadge
.cpd-theme-light .mx_ReplyPreview_header_cancel
.cpd-theme-light .mx_RoomTile_menuButton::before
.cpd-theme-light .mx_IconizedContextMenu_icon::before
.cpd-theme-light .mx_RoomTile_notificationsButton::before
.cpd-theme-light .mx_RoomTile_notificationsButton_show::before

CSS
.cpd-theme-dark .mx_NotificationBadge,
.cpd-theme-dark .mx_ReplyPreview_header_cancel,
.cpd-theme-dark .mx_RoomTile_menuButton::before,
.cpd-theme-dark .mx_IconizedContextMenu_icon::before,
.cpd-theme-dark .mx_RoomTile_notificationsButton::before,
.cpd-theme-dark .mx_RoomTile_notificationsButton_show::before {
    background: var(--cpd-color-icon-primary) !important;
}
.cpd-theme-dark .mx_MessageContextMenu_iconRedact::before {
    background: var(--cpd-color-icon-critical-primary) !important;
}
.cpd-theme-dark .mx_AccessibleButton.mx_NotificationBadge {
    background-clip: padding-box !important;
    border: 3px solid rgba(38, 39, 43, 0.82) !important;
}
.cpd-theme-dark .mx_EventTile[data-layout="group"].mx_EventTile_selected > .mx_EventTile_line {
    background-color: var(--cpd-color-bg-subtle-secondary);
    box-shadow: rgb(235, 238, 242) 54px 0px 0px -50px inset;
}
.cpd-theme-dark .mx_ReplyChain {
    border-left: 2px solid var(--username-color);
}
.cpd-theme-dark .mx_UserMenu,
.cpd-theme-dark .mx_RoomHeader,
.cpd-theme-dark .mx_TimelineSeparator > hr,
.cpd-theme-dark .mx_LeftPanel_filterContainer {
    border-bottom: 1px solid var(--cpd-color-gray-400) !important;
}
.cpd-theme-dark .mx_RoomSublist_resizeBox:hover .mx_RoomSublist_resizerHandle {
    background-color: var(--cpd-color-text-primary) !important;
}
.cpd-theme-dark .mx_RoomSearch,
.cpd-theme-dark .mx_RoomTile:hover,
.cpd-theme-dark .mx_SpaceButton_icon,
.cpd-theme-dark .mx_LeftPanel_exploreButton,
.cpd-theme-dark .mx_RoomListHeader_plusButton,
.cpd-theme-dark .mx_RoomTile.mx_RoomTile_selected {
    background-color: var(--cpd-color-alpha-gray-300) !important;
}
.cpd-theme-dark .mx_SpaceButton_icon::before {
    background-color: var(--cpd-color-text-secondary) !important;
}
.cpd-theme-dark .mx_SpaceButton.mx_SpaceButton_active.mx_SpaceButton_narrow .mx_SpaceButton_selectionWrapper {
    border: 3px solid var(--cpd-color-icon-primary) !important;
}
.cpd-theme-dark .mx_IconizedContextMenu .mx_IconizedContextMenu_optionList:nth-child(n+2) {
    border-top: var(--cpd-border-width-1) solid var(--cpd-color-gray-400);
}
.cpd-theme-dark .mx_ContextualMenu {
    border: var(--cpd-border-width-1) solid var(--cpd-color-border-interactive-secondary);
}
.cpd-theme-dark .mx_Verified {
    color: var(--cpd-color-icon-success-primary);
}
.cpd-theme-dark .mx_RightPanel {
    border-left: 1px solid var(--cpd-color-gray-400);
}

================================

app.estuda.com

INVERT
img[src*="latex"]

================================

app.getport.io

CSS
.ring-solid-gray-200 {
    --tw-ring-color: var(--darkreader-selection-text) !important;
    --tw-ring-opacity: 1;
}
.ring-1 {
    box-shadow: var(--tw-ring-offset-shadow),var(--tw-ring-shadow),var(--tw-shadow, 0 0 --darkreader-selection-text) !important;
}

================================

app.grammarly.com

CSS
use.valueCircle_f6otssy {
    stroke: url(#pb-gradient-0);
}
:root {
    --highlight-bg: ${rgba(0, 0, 0, 0.2)};
}
.alerts-clarity {
    --highlight-bg: ${rgba(57, 93, 207, 0.2)};
}
.alerts-engagement {
    --highlight-bg: ${rgba(29, 203, 162, 0.2)};
}
.alerts-correctness {
    --highlight-bg: ${rgba(255, 69, 103, 0.2)};
}
.alerts-delivery {
    --highlight-bg: ${rgba(124, 58, 172, 0.2)};
}
[class*="-alerts-markSelectedHigh"],
span[class*="markSelectedFocused"] {
    background-color: var(--highlight-bg) !important;
}
[class*="-navigation-counterWrapper"] [class*="-navigation-counterContent"],
[class*="-paidview-counter"] [class*="-paidview-counterContent"] {
    fill: rgb(0, 0, 0, .9);
}

IGNORE INLINE STYLE
use[class*="valueCircle_"]

================================

app.intercom.com

CSS
.embercom-prosemirror-composer-callout[style*="background-color: #e8e8e880"] {
    background-color: ${#e8e8e880} !important;
}
.embercom-prosemirror-composer-callout[style*="border-color: #73737633"] {
    border-color: ${#73737633} !important;
}

IGNORE INLINE STYLE
.embercom-prosemirror-composer-callout

================================

app.kognity.com

INVERT
img.KogCalculator
.content-image-figure > img[src*="png"]

CSS
body,
.KogDashboard-insideLoader {
    background: none var(--darkreader-neutral-background) !important;
}
img:not([src*="png"]):not([src*="svg"]) {
    background-color: white !important;
}

================================

app.misaka.io

INVERT
.login-cover
img[alt="logo"]

================================

app.mysms.com

CSS
.message a {
    color: grey;
}

================================

app.roll20.net

INVERT
.sheet-hp
.sheet-ac
.sheet-textbox
.sheet-name-container
.sheet-attributes-container
.sheet-attr-container button
.sheet-hlabel-container
.sheet-vitals
.sheet-init button
.sheet-spell-level
.sheet-spell-level input
.sheet-textbox .sheet-options
.sheet-speed input
.sheet-part select
.sheet-resources .sheet-subcontainer
.sheet-resources .sheet-label
.sheet-subcontainer .sheet-top
.sheet-textbox .sheet-label
.sheet-attack .sheet-options

CSS
.sheet-attributes-container,
.sheet-init,
.sheet-speed,
.sheet-trait,
.sheet-part,
.sheet-spell-level,
.sheet-details {
    color: ${white} !important;
}

================================

app.standardnotes.org

INVERT
[aria-label="Challenge modal"] > svg > circle:first-child
input[id^="react-tag-"]

CSS
search-options svg {
    fill: var(--darkreader-neutral-text) !important;
}

IGNORE INLINE STYLE
search-options svg

================================

app.tandem.net

INVERT
img[src="/static/icons/apple.svg"]
[data-tip-id=LanguageLevelIndicator] button div span

CSS
div[class*="styles_qrCode"] {
    background-color: white !important;
}

================================

app.timelyapp.com

INVERT
.Clock__clock_css_icon___LfBr6
.Clock__stopwatch___2G-CB

CSS
.Day__container___1Fpnl.Day__showBackground___3CXnw {
    background-image: none;
}

================================

app.traderepublic.com

IGNORE INLINE STYLE
#chartPriceLine

================================

app.univerusrec.com

CSS
html {
    background-color: #181a1b !important;
}
input,
select,
textarea {
    color: --darkreader-selection-text !important;
}

================================

app.ynab.com

CSS
.ynab-checkbox-button-square {
    color: transparent;
}

================================

app.youneedabudget.com

CSS
[data-darkreader-inline-fill] {
    fill: ${black} !important;
}

================================

apple.com
*.apple.com

INVERT
.ac-slider-ax-track
.controls-progress-indicator
.rf-ccard-content-info

CSS
* {
    --globalnav-background: var(--darkreader-neutral-background) !important;
    --localnav-background: var(--darkreader-neutral-background) !important;
}
option {
    background: var(--darkreader-neutral-background) !important;
}

================================

apple.com/leadership/

IGNORE IMAGE ANALYSIS
*

================================

apple.com/macos/sonoma/

INVERT
.section-hero-lockup

================================

apple.com/shop/

INVERT
.as-localnav.as-localnav-scrim
.localnav-title
.as-localnav-menucta
.as-localnav-browseall-menucta
.as-localnav-browseall-list-title
.as-localnav-browseall-listitem

================================

apps.microsoft.com

INVERT
.empty-star

================================

aprs-map.info

INVERT
img[src*="tile.openstreetmap.org/"]
img[src*="tile.opentopomap.org/"]

================================

aprs.fi
*.aprs.fi

INVERT
img[src*="maps.googleapis.com/maps/vt"]
img[src*="tile.openstreetmap.org"]

CSS
#panel {
    background-image: none !important;
}

================================

apteka.ru

INVERT
ymaps[class$="ground-pane"]
.icon--logo

================================

aras.com

CSS
.alternate_color.banner__title.display-2,
.alternate_color.banner__subtitle.display-5 {
    color: var(--darkreader-neutral-text) !important;
}
.banner__title.display-2,
.banner__subtitle.display-5 {
    color: ${white} !important;
}

================================

arcaea.lowiro.com

INVERT
img.stripe-stamp
img.image-header
.logout-button .button-text
.arcaea-links .right-section .account-button .button-text
img[alt="profile"]
img[alt="friends"]
img[alt="partners"]
img[alt="leaderboards"]
img[alt="score-data"]
img[alt="potential"]
img[alt="setting"]
img.lock
img.line-dark

IGNORE IMAGE ANALYSIS
.memory-options .memory-select[data-v-6b2b4ba0]
.memory-options .memory-select.deselected[data-v-6b2b4ba0]
.memory-options .memory-select.disabled[data-v-6b2b4ba0]
.memory-options .currency[data-v-6b2b4ba0]
.memory-options .currency.deselected[data-v-6b2b4ba0]
.memory-options .currency.disabled[data-v-6b2b4ba0]
.memory-options .memory-select .selector[data-v-6b2b4ba0]
.logout-button[data-v-59affef8]
.memories .memories-purchase[data-v-2634d0c1]
img.footer-logo
.content .user .username

================================

archenoah-kelkheim.de

IGNORE IMAGE ANALYSIS
.wsite-header

================================

architekturaibiznes.pl

INVERT
.icon-section
a span.image-rwd-dzial-logo

================================

archive.org

INVERT
p + fieldset a svg
.search-field svg
.ia-wordmark

CSS
#search-input {
    color: var(--darkreader-neutral-background) !important;
}

================================

arelion.com

INVERT
div.tc-navigation-main__text
div.tc-navigation-main__buttons
img.tc-testimonial-expand__logo

================================

argos.co.uk

IGNORE INLINE STYLE
svg[class^="Checkboxstyles"]

================================

ario-player.sourceforge.net

INVERT
div.header

CSS
div.main,
#menu li a,
#menu li {
    background-image: none !important;
}

================================

ark.no

CSS
.mix-blend-multiply {
    mix-blend-mode: normal !important;
}

================================

ars.particify.de

CSS
body {
    background-color: var(--darkreader-neutral-background) !important;
}
.mat-mini-fab {
    box-shadow: none !important;
}
.mat-card {
    background-color: #{gray} !important;
    box-shadow: none !important;
}
.mat-chip {
    background-color: var(--darkreader-neutral-background) !important;
    color: var(--darkreader-neutral-text) !important;
}

================================

arstechnica.com

CSS
.listing,
.video-thumbnail {
    background-blend-mode: initial !important;
}
.article-single figure img {
    mix-blend-mode: initial !important;
}

================================

artofproblemsolving.com

INVERT
.latex
.latexcenter

================================

artsy.net

CSS
[aria-checked="false"][role="checkbox"] svg path {
    fill: transparent !important;
}

IGNORE INLINE STYLE
[role="checkbox"] svg *

================================

arxiv.org

CSS
.abstract {
    background-color: transparent !important;
}

================================

asahichinese-j.com

INVERT
#HeaderInner img
.SocialNav
.Tag li a

CSS
.Tag li a {
    color: ${grey} !important;
}
a,
.LastUpdated,
.Lead {
    color: var(--darkreader-neutral-text) !important;
}
#Footer p,
#FooterInner {
    background-color: var(--darkreader-neutral-background) !important;
}
h1,
.ArticleBody p,
.ImagesHeightMod {
    background-color: var(--darkreader-neutral-background) !important;
    color: var(--darkreader-neutral-text) !important;
}

================================

asahilinux.org

INVERT
.header-logo

================================

asana.com

INVERT
.siteHeader__logo
.DatePickerCalendarDate--today .DatePickerCalendarDate-button::after

CSS
.MultiColorIcon--unselected .MultiColorIcon-path--fadedBlack {
    fill: var(--darkreader-bg--color-icon) !important;
}
.MultiColorIcon-path--white {
    fill: var(--darkreader-text--color-icon-foreground) !important;
}
.DailySummaryInboxThread--selected,
.TaskAddedToPotInboxThread--selected,
.InboxExpandableThread.InboxExpandableThread--selected,
.PortfolioItemRow {
    background: var(--darkreader-neutral-background) !important;
}
.PortfolioItemRow:hover {
    background: ${#FFF} !important;
}
.HomePageContent {
    background-image: none !important;
}
div.PeopleWidgetCarousel-gradient.PeopleWidgetCarousel-gradient--right {
    display: none;
}

================================

asciinema.org

IGNORE INLINE STYLE
polygon
polyline

================================

askjohnmackay.com

INVERT
[src$="ask-john-mackay-logo.png"]
[src$="side-banner-05.gif"]
[src$="reasonwhy.jpg"]

CSS
body,
header,
#site-footer,
#live-search {
    background-color: var(--darkreader-neutral-background) !important;
    background-image: none !important;
}

================================

askvg.com

INVERT
.site-header img

================================

askwoody.com

CSS
.banner,
.content {
    background-image: none !important;
}

================================

assetstore.unity.com

CSS
div[style^="background-color:var(--color-bg-gray-5)"] {
    --color-bg-gray-5: var(--darkreader-neutral-background) !important;
}
h2[style*="color:var(--color-font-header)"] {
    --color-font-header: var(--darkreader-neutral-text) !important;
}

================================

astro.build

CSS
hero-card .card {
    --darkreader-bg--tw-gradient-stops: var(--darkreader-bg--tw-gradient-from), var(--darkreader-neutral-background), var(--darkreader-bg--tw-gradient-to) !important;
}

IGNORE INLINE STYLE
#navlogo svg path

================================

astroproxy.com/dashboard/settings/profile/2fa

CSS
.card-body .col-md-6 > div > svg > rect[width="200"] {
    fill: var(--darkreader-neutral-text) !important;
}

================================

asus.com

INVERT
span.mobile-menu-toggle.mobile
em#searchopen.icon-search
#af-header .af-inner .logo

IGNORE IMAGE ANALYSIS
#af-header .af-inner .logo
li.nav-Rog a

================================

atcoder.jp

CSS
#fixed-server-timer {
    color: #333;
}
.ace-tm .ace_indent-guide {
    opacity: .3;
}

================================

athome.abeka.com

INVERT
.logo img
.center-align img

================================

atlas.herzen.spb.ru
guide.herzen.spb.ru
job.herzen.spb.ru

INVERT
img[src="/images/logo.png"]
hr

CSS
body,
.body,
table,
tbody,
tr,
td,
.corner_bottom {
    background: none !important;
}

================================

atlassian.net
*.atlassian.net

INVERT
img[src*="https://github.githubassets.com/favicon.ico"].smart-link-icon
.sc-jTzLTM
img[src^="https://latexmath.bolo-app.com/render/"]
img[src*="MathJax-SVG"]
span[aria-label="Confluence"]

CSS
span.code,
code.code {
    background-color: rgba(240,246,252,0.15) !important;
}
.ghx-parent-group,
.ghx-issue {
    background-color: rgba(119, 183, 255, 0.05) !important;
}
span.loader-wrapper a,
.css-s0tfqx,
.css-1vn31bx,
.css-1gx5gpx,
.css-wvfva4 {
    background-color: rgba(240,246,252,0.1) !important;
}
.css-1yfnrso,
.aui-flag,
.aui-message {
    box-shadow: 0 0 20px rgba(240,246,252,0.15) !important;
}
.css-1ua1xqz {
    background-color: rgba(65, 65, 83, 0.6) !important;
}
code:first-of-type {
    background-image: linear-gradient(to right, rgba(255,255,255,0.03),rgba(255,255,255,0.03) calc(1ch + 16px),transparent calc(1ch + 16px),transparent) !important;
}
.sc-1jjaulc-0 {
    background-color: ${rgba(3, 9, 15, 0.02)} !important;
    box-shadow: 0 0 4px ${rgba(3,9,15,0.15)} !important;
}
.sc-186t4q4-1 {
    background-color: ${rgba(3, 9, 15, 0.02)} !important;
}
div.zgsxji-0.jMIyWM > div > div > div > div {
    background-color: var(--darkreader-bg--ds-surface, #181a1b) !important;
}
#ak-main-content,
.pfb8c3-0.dpzKHj,
._11q7vuon {
    background-color: var(--darkreader-neutral-background) !important;
}
#jira-issue-header,
#jira-issue-header-actions {
    background-color: rgb(29, 32, 33) !important;
}
.ak-editor-panel[data-panel-type="note"] {
    background-color: ${rgb(217, 200, 228)} !important;
}
.ak-editor-panel[data-panel-type="info"] {
    background-color: ${rgb(172, 217, 242)} !important;
}
.ak-editor-panel[data-panel-type="error"] {
    background-color: ${rgb(255, 220, 211)} !important;
}
.ak-editor-panel[data-panel-type="warning"] {
    background-color: ${rgb(238, 229, 187)} !important;
}
.ak-renderer-document hr,
.ProseMirror hr {
    background-color: rgb(69, 70, 72) !important;
}
.ProseMirror hr.ak-editor-selected-node {
    background-color: rgb(0, 101, 255) !important;
}
.jira-issue-status-lozenge {
    background-color: var(--darkreader-neutral-background) !important;
}
.fabric-text-color-mark {
    --darkreader-text--custom-text-color: var(--custom-text-color);
}
#content-body {
    --ds-surface: var(--darkreader-neutral-background) !important;
}

IGNORE INLINE STYLE
.ak-editor-content-area *
span[aria-label="Jira Software"] *

================================

atptour.com

INVERT
.match .stats-item .scores.scores--strike::before

IGNORE IMAGE ANALYSIS
.match .stats-item .scores.scores--strike::before

================================

audible.com

INVERT
.navigation-header-logo img:not(img[src*="inverse"])

================================

audible.com/webplayer
audible.de

INVERT
#adbl-cloud-player-controls
.hero-img > img

CSS
.adbl-page > #center-0 {
    background-color: #0e0d0c !important;
}
.adblCloudPlayerContainer {
    height: 99999vh !important;
}
.adblCloudPlayerContainer .bc-range-progress,
.bc-range input[type="range"]::-moz-range-thumb,
.bc-range input[type="range"]::-webkit-slider-thumb {
    background-color: #f7991c !important;
}
.bc-range input[type="range"]::-moz-range-track,
.bc-range input[type="range"]::-webkit-slider-runnable-track {
    background: rgba(255,255,255,.5) !important;
}

================================

audio-technica.com

INVERT
.o-header__logo

================================

audycje.tokfm.pl/widget

CSS
body {
    background-color: var(--darkreader-neutral-background) !important;
}

================================

auth.adguard.com

INVERT
.header__logo path[fill="#000"]

================================

auth0.com

INVERT
button[data-handler="authorise-github"] > img.icon.icon-default

================================

autodesk.com

INVERT
.uh-logo-container

================================

autoweek.com

INVERT
.nav-logo

================================

avanti24.pl

INVERT
.box-logo

================================

avast.com

INVERT
.avast-logo

================================

avg.com

INVERT
.bi-nav-toplink

================================

avito.ru

INVERT
a[class^="Logo-"] > svg > path
a[class^="header-logo"]
.item-extended-phone
.item-price-old::before
.contacts-phone-3KtSI
.button-content-phone_size_l-1O5VB
._39EVKDP-9p1BREJQ3fhILl._2sPEvPi-1aWpcq1ggVph1C._4wLX_6jxKYoWRyE1U1WcZ
[class^="suggest-graySuggestCategoryImg"]
ymaps[class$="ground-pane"]

CSS
div[class^="item-preview-image"] {
    z-index: 0 !important;
}

================================

avlab.pl

INVERT
img[src*="avlab-logo"]
img[alt*="logo"]
.elementor-widget-wrap div div a.elementor-icon svg
.elementor-social-icons-wrapper

================================

aws.amazon.com

INVERT
a.lb-trigger
.hover .axis-box rect
.img-wrapper
img[alt^="WEB_FreeTier"]
.lb-is-lazyloaded
.lb-none-v-margin.lb-img
.lb-tiny-iblock .cq-dd-image

CSS
.header-background {
    fill: none !important;
}

================================

axios.com

INVERT
a[data-cy="axios-logo-main"]

================================

azure.microsoft.com

INVERT
.card .ocr-img
.img-fluid
.section-master__image

================================

azuresynapse.net

INVERT
.cursor

================================

azurlane.koumakan.jp

INVERT
.mwe-math-element

CSS
.rarity-1,
.rarity-2 {
    background: #999 !important;
}
.rarity-3 {
    background: #5fa8bf !important;
}
.rarity-4 {
    background: #846dbf !important;
}
.rarity-5 {
    background: #aa5 !important;
}
.rarity-6 {
    background: linear-gradient(120deg,#bbbf8a,#7abf7f,#67afbf,#bf6bbf) !important;
}

IGNORE IMAGE ANALYSIS
.mw-wiki-logo

================================

bab.la

INVERT
.logo-flash

================================

babyem.co.uk

INVERT
div.elementor-social-icons-wrapper a.elementor-icon
input::placeholder

================================

babylonbee.com

INVERT
.header-logo
.img-fluid.mb-2.d-none.d-sm-block

================================

backblaze.com

CSS
.rt-headingxlred-bodym > p,
a {
    color: ${white} !important;
}
.nav2_link,
.footer_link,
.footer_textlink {
    color: var(--darkreader-neutral-text) !important;
}

================================

bahai.org

INVERT
header img[src*="svg"]
header div[url*="svg"]

CSS
header,
.jyBFrT {
    background-blend-mode: multiply !important;
    background-color: ${rgba(255,255,255,0.85)} !important;
}
div[bottom="0px"] {
    background-color: var(--darkreader-neutral-background) !important;
}

================================

bahai.us

INVERT
img[src="https://www.bahai.us/wp-content/themes/bahai2019/assets/images/bahai_logo_black.svg"]
img[src*="say_hello.png"]

CSS
.site-footer {
    background-blend-mode: multiply !important;
}

================================

bahaiteachings.org

INVERT
blockquote::before
blockquote::after
blockquote.wp-block-quote::before
blockquote.wp-block-quote::after
.container-big::after
.top-info__social__link
.event-topics__search__block
.footer__info__text::after

CSS
.input-search {
    color: var(--darkreader-neutral-text) !important;
}
.author-page-bg {
    background: var(--darkreader-neutral-background) !important;
}

================================

bahnhof.net

CSS
.contact-form_section {
    background-image: none !important;
}

================================

baike.baidu.com

INVERT
.formula

IGNORE IMAGE ANALYSIS
.wiki-lemma .lemmaWgt-posterBg

================================

baitoru.com

CSS
mark {
    background-color: #cc4;
    color: black;
}

================================

bakabt.me

INVERT
span.icon.hd
span.icon.lossless

CSS
.series {
    background-size: 100% 100% !important;
}

IGNORE IMAGE ANALYSIS
.series

================================

balena.io

INVERT
.Header__main-logo

================================

bandcamp.com
allochiria.com

INVERT
.bclogo.white
.vol-control
.progress
.buffer
.seek-control
#material-close

CSS
.ui-dialog {
    background-image: none !important;
}

================================

bandshed.net

CSS
#content {
    background-color: var(--darkreader-neutral-background) !important;
}

================================

banki.ru

INVERT
.header__logo

CSS
.comment:nth-child(even) {
    background-color: ${#f5f5f5} !important;
}

================================

bankier.pl
bankier.tv

INVERT
.m-nav-header__logo
.o-home-smart-box__header > .a-anchor > .a-image >  img[class="a-image__img"]
.hamburger
.icon > img
.menu-sidebar__close-menu > img
img[class="menu-sidebar__logo-img"]
img[alt*="Bankier.pl"]
img[src*="logo-smart.svg"]
a[href="https://www.bankier.pl/"]
img[alt="Bankier.TV"]
.m-quote-list__anchor img.a-image__img
a.more-link

CSS
button.btn.period {
    color: #000 !important;
}

================================

bankofamerica.com

INVERT
.main-nav-top-logo img

CSS
.fsdnav-sub-nav-left {
    background-color: var(--darkreader-neutral-background) !important;
}
.ad-acct-layout,
.ad-acct-detail-card-layout,
.thrfwl-body,
.ad-summary-container,
.olb-summary-widget-container {
    background-image: none !important;
}

================================

barnesandnoble.com

INVERT
.logo-img

================================

basecamp.com

INVERT
.top-nav__logo

================================

baselinker.com

CSS
.form-control {
    background-color: var(--darkreader-neutral-background) !important;
    color: ${black} !important;
}

================================

battlelog.battlefield.com/bf3

INVERT
:not(.active) > .serverguide-cell-ranked-wrapper > div
:not(.active) > .serverguide-cell-pb-wrapper > div
:not(.active) > .serverguide-cell-type-wrapper > div
.common-button-medium-grey
.common-kittimes-overlay
.serverguide-headercells
table.common-table > thead > tr > th
.leaderboard-venice-specific > thead > tr > th
#selected-server-settings .selected-server-setting
.sodaSlider-arrow-left
.sodaSlider-arrow-right

CSS
.common-button-medium-grey > p {
    color: #000 !important;
}
.base-button-arrow-almost-gigantic,
.base-button-arrow-gigantic,
.base-button-arrow-large,
.btn.btn-primary,
.base-button-arrow-large-drop {
    color: #000 !important;
}
.common-button-medium > p,
.common-button-large > p {
    color: #000 !important;
}
.common-selector-alt li.selected {
    color: #262626 !important;
}
.progress-bar .progress-bar-inner,
.common-percentbar-container div {
    background-color: ${#353535} !important;
}
#selected-server-settings .selected-server-setting {
    color: ${#888} !important;
}

IGNORE IMAGE ANALYSIS
.serverguide-headercells
table.common-table > thead > tr > th
.leaderboard-venice-specific thead tr th
.base-item-ribbon-small

================================

bayfiles.com

INVERT
.img-responsive
.kopimi

================================

bbb.*

CSS
div[class^='scrollableList'] {
    background: none !important;
    box-shadow: none !important;
}

================================

bbc.co.uk
bbc.co.uk/weather
bbc.com/weather

INVERT
.orb-nav-section .orb-nav-blocks
.orb-icon .orb-icon-arrow
span[class*="LogoIconWrapper"]

CSS
.wr-icon-weather-type__svg-background,
.wr-icon-rain__svg-background,
.wr-icon-wind-direction__svg-background,
.wr-icon-gel__svg-background {
    opacity: 0% !important;
}
.wr-value--windspeed {
    color: ${#dad7d2} !important;
}
.wr-c-environmental-data__icon-text {
    color: ${#dcd9d4} !important;
}
.haCQWq,
.fFEZuA {
    filter: invert(90%) !important;
}

IGNORE IMAGE ANALYSIS
*

================================

bbc.com

CSS
.haCQWq,
.fFEZuA {
    filter: invert(90%) !important;
}

================================

bbc.com/news
bbc.com/sport
bbc.com/travel
bbc.com/capital
bbc.com/autos
bbc.com/culture
bbc.com/future
bbc.com/sounds
bbc.com/food
bbc.com/bitesize
bbc.com/earth

INVERT
.orb-nav-section .orb-nav-blocks
.orb-icon .orb-icon-arrow
[class*="NavigationLink-LogoLink"] > span > svg
span[class*="LogoIconWrapper"]

CSS
.haCQWq,
.fFEZuA {
    filter: invert(90%) !important;
}

================================

bbs.chinauos.com
bbs.deepin.org

INVERT
.post_tip

CSS
.post_edit p {
    color: var(--darkreader-neutral-text) !important;
}

================================

bbs.thinkpad.com
club.lenovo.com.cn

CSS
body[style] {
    box-shadow: inset 0px 0px 0px 9999px var(--darkreader-neutral-background);
}

================================

bbs.wenxuecity.com

INVERT
.logo

================================

behance.net

INVERT
div[class^="PrimaryNav-logoWrap"]

================================

benevity.com

INVERT
.header_logo

================================

berlingske.dk

INVERT
.site-header__logo

================================

bestbuy.ca

INVERT
.centerContainer
[class^="facetName"]
[class^="title"]
[class^="sortLabel"]
[class^="headerText"]
[class^="subTitle"]
[class^="price"]
[class^="soldByBestBuy"]
[class^="availabilityMessage"]
[class^="deliveryDate"]
[class^="storesNearCity"]
svg[class*="availabilityHeaderIcon"]

CSS
div[class*="backgroundContainer"] {
    z-index: 0 !important;
}
body {
    background-image: initial !important;
}

================================

bestbuy.com

CSS
input[type="radio" i] {
    background-color: initial;
}

================================

bestchange.ru

INVERT
.tabs li a

CSS
body,
.c-inner,
.c-block .c-wrap,
#content_table thead td,
.content .intro,
.c-block,
#content_table tbody td,
#content_reviews,
.review_header,
.review_middle,
.review_bottom {
    background-image: none !important;
}

================================

besthealthmag.ca

INVERT
.logo-container

CSS
body,
.hero-module .content-wrapper .col-middle .item .category,
.editor-explore-title {
    background-color: var(--darkreader-neutral-background) !important;
}
.content-wrapper a,
.most-popular-section h2,
.most-popular-section .most-popular-detail *,
.editor-explore-title h2,
.archive-headings,
.archive-description,
.post-title,
.dek,
.post-body,
.brand-via,
.entry-title,
.listicle-card h2,
.newsletter h3 {
    color: var(--darkreader-neutral-text) !important;
}

================================

bet.com
cmt.com
logotv.com
paramountnetwork.com
southpark.cc.com
vh1.com

CSS
body {
    background-color: var(--darkreader-neutral-background) !important;
}

================================

betanews.com

CSS
.sectionTop,
.editorial .header,
.tabbed .tabs li:not(.active),
.tabbed .tabs li:not(.active) a {
    background-image: none !important;
}
.tabbed .tabs li:not(.active) a {
    background-color: ${#d9d9ff} !important;
}

================================

betano.*

CSS
.tab-row,
.bet-activity-card,
.total-amounts {
    background-color: ${#fff} !important;
    color: ${#302505} !important;
}

================================

betterbird.eu

CSS
#content {
    background: transparent;
}
#content::before {
    background-image: url("/betterbird-bg.svg");
    background-repeat: no-repeat;
    background-size: contain;
    content: "";
    display: block;
    height: 870px;
    mask-image: linear-gradient(to bottom, rgba(0, 0, 0, 0) 50%, rgba(0, 0, 0, 1) 100%);
    opacity: 7%;
    position: absolute;
    top: 170px;
    width: 870px;
}

================================

bettercap.org

INVERT
.copy-to-clipboard
[src$="mitm.jpg"]
[src$="proxy.png"]
[src$="with-hsts.png"]
[src$="sslstrip2.png"]

CSS
.copy-to-clipboard {
    background-color: var(--darkreader-neutral-text) !important;
}

================================

bfi.org.uk

INVERT
img[src$="bfi_logo_transp.png"]
img[src$="national-lottery-logo-color.png"]
img[src*="sight-and-sound-logo-280x69.png"]

CSS
body {
    background-image: none !important;
}

================================

bgp.he.net

INVERT
img[src="/helogo.gif"]
img[src*="chart.googleapis.com"]
img[src^="/graphs/"]

================================

bible.optina.ru

CSS
body,
#left,
#right {
    background-image: none !important;
}

================================

bibleref.com

CSS
.scripture,
.content,
.content-commentary .expand {
    background: var(--darkreader-neutral-background) !important;
}

================================

bibliotecapleyades.net

CSS
body {
    background-image: none !important;
}

================================

bienici.com

INVERT
.section-header
.bv-form
.hpFeaturesRow
.hpContent
#searchSideView
.searchFilterViewContainer
.searchItemPhoto
#map
.animatedSideContent
#detailedSheetsNavigation

================================

bigberthaoriginal.*

CSS
.product-card-figure {
    background-color: #f9f9f9 !important;
}

================================

bigocheatsheet.com

INVERT
.gray

CSS
.green,
.orange,
.yellow,
.yellow-green {
    color: black !important;
}

================================

bikester.no

CSS
.lightbox img {
    mix-blend-mode: luminosity !important;
}

================================

bilet.wielkopolskiebilety.pl

INVERT
.KW__headerContainer
.logo
.map-container
img[src*="carriers/"]

================================

biletico.pl

INVERT
.biletico-logo

================================

bilety24.pl

INVERT
.logo

================================

biliomask.com

INVERT
div.header-title-logo

================================

binance.com

CSS
div.qr-code > canvas {
    outline: solid 10px white !important;
}
div > input[type="checkbox"] + svg {
    fill: transparent !important;
}
div > input[type="checkbox"]:checked + svg {
    fill: var(--darkreader-neutral-text) !important;
}
label > svg circle {
    fill: rgb(37, 40, 42) !important;
}

================================

bing.com

INVERT
canvas[id^="Microsoft.Maps"]
button[is="cib-button"] svg-icon

CSS
.options-list-container,
.b_wlcmTileWrap > *,
cib-shared,
cib-serp-feedback,
cib-typing-indicator ~ .main-container,
cib-see-more-container {
    background: var(--darkreader-neutral-background) !important;
}
.option > *,
cib-shared,
cib-tooltip,
cib-message,
.disclaimer,
.b_wlcmDesc,
.b_vfly_b,
.container>fieldset>legend {
    color: var(--darkreader-neutral-text) !important;
}
.b_searchboxForm,
.b_searchboxForm:hover,
.b_focus .b_searchboxForm,
#sw_as #sa_ul:not(:empty),
cib-typing-indicator ~ .main-container,
cib-see-more-container {
    box-shadow: ${rgba(0, 0, 0, 0.1)} 0px 0px 0px 1px !important;
}
#b_results > li.b_ans.b_topborder,
#b_results > li.b_ans.b_topborder.b_tophb.b_topshad {
    box-shadow: ${rgba(13, 13, 13, 0.05)} 0px 0px 0px 1px !important;
}
.l_ecrd_imcolheader.gradient {
    z-index: 2 !important;
}
#b_content {
    background-image: none !important;
}
cib-tooltip,
.attributions > .attribution-item > .background {
    background: var(--darkreader-neutral-background) !important;
}
cib-message[type="text"]:not([serp-slot="right-rail"]),
button.container > .item-content,
button.container > .item-content:before,
.container > .options-list-container,
.container > .options-list-container li.option button:not([selected]):before,
button.container[serp-slot="none"],
button.container[serp-slot="right-rail"],
#fbpgbt,
#stop-responding-button,
cib-feedback {
    background: ${rgba(50, 50, 50, 0.1)} !important;
}
cib-message[type="text"]:not([serp-slot="right-rail"]),
cib-shared > .content > .ac-container > .ac-textBlock {
    color: var(--darkreader-text--cib-color-neutral-foreground) !important;
}
button.container[serp-slot="right-rail"]:hover {
    background: ${rgba(0, 0, 0, 0.3)} !important;
}
button.container[serp-slot="none"] {
    border: 1px solid var(--cib-color-brand-secondary-stroke) !important;
}
.attribution-container > .attribution-items > .attribution-item,
.attribution-container > .attribution-items > button.expand-button,
.ac-container.ac-adaptiveCard > .ac-textBlock > p > .tooltip-target + a > sup {
    background: #050F2E !important;
    color: #A2B7F4 !important;
}
div.icon > svg > g:nth-child(1) > path:nth-child(1) {
    opacity: 0 !important;
}
.ac-container.ac-adaptiveCard > .ac-textBlock > p > .tooltip-target.hover {
    background: var(--cib-color-stealth-primary-foreground-hover) !important;
    color: var(--cib-color-brand-text-highlight-background) !important;
    text-decoration-color: var(--cib-color-brand-text-highlight-background) !important;
}
.ac-container.ac-adaptiveCard > .ac-textBlock > p code {
    background: rgba(255,255,255,0.2) !important;
}
.container > button:hover > svg-icon {
    fill: var(--cib-color-neutral-primary-background) !important;
}
.content > .ac-container {
    color: var(--darkreader-neutral-text);
}
#b_results .b_algo.b_deeplinks_bg_color_kc {
    background-image: none !important;
}
:root {
    --cib-color-background-serp-neutral: ${#FFFFFF} !important;
    --cib-color-background-serp-primary: ${#F5F5F5} !important;
    --cib-color-background-surface-app-primary: ${#FFFFFF} !important;
    --cib-color-background-surface-app-quaternary: ${#FFFFFF} !important;
    --cib-color-background-surface-app-secondary: ${#FFFFFF} !important;
    --cib-color-background-surface-app-tertiary: ${#F0F0F0} !important;
    --cib-color-background-surface-card-disabled: ${rgba(255, 255, 255, 0.4)} !important;
    --cib-color-background-surface-card-primary: ${rgba(255, 255, 255, 0.7)} !important;
    --cib-color-background-surface-card-secondary: ${rgba(255, 255, 255, 0.4)} !important;
    --cib-color-background-surface-card-tertiary: ${#FFFFFF} !important;
    --cib-color-background-surface-solid-base: ${#F5F5F5} !important;
    --cib-color-background-surface-solid-primary: ${#F7F7F7} !important;
    --cib-color-background-surface-solid-quaternary: ${#FFFFFF} !important;
    --cib-color-background-surface-solid-secondary: ${#EEEEEE} !important;
    --cib-color-background-surface-solid-tertiary: ${#F9F9F9} !important;
    --cib-color-background-system-attention-primary: ${rgba(255, 255, 255, 0.5)} !important;
    --cib-color-background-system-caution-primary: ${#FFF4CE} !important;
    --cib-color-background-system-critical-primary: ${#FDE7E9} !important;
    --cib-color-background-system-success-primary: ${#DFF6DD} !important;
    --cib-color-foreground-accent-balanced-primary: ${#174AE4} !important;
    --cib-color-foreground-accent-balanced-secondary: ${#1543CD} !important;
    --cib-color-foreground-accent-creative-primary: ${#75306C} !important;
    --cib-color-foreground-accent-creative-secondary: ${#692B61} !important;
    --cib-color-foreground-accent-disabled: ${rgba(23, 74, 228, 0.3)} !important;
    --cib-color-foreground-accent-precise-primary: ${#006880} !important;
    --cib-color-foreground-accent-precise-secondary: ${#005E73} !important;
    --cib-color-foreground-accent-primary: ${#174AE4} !important;
    --cib-color-foreground-accent-quaternary: ${#3B3FB2} !important;
    --cib-color-foreground-accent-secondary: ${#1543CD} !important;
    --cib-color-foreground-accent-tertiary: ${#123BB6} !important;
    --cib-color-foreground-neutral-disabled: ${rgba(17, 17, 17, 0.4)} !important;
    --cib-color-foreground-neutral-quaternary: ${#616161} !important;
    --cib-color-foreground-neutral-secondary: ${#666666} !important;
    --cib-color-foreground-neutral-tertiary: ${#919191} !important;
    --cib-color-foreground-system-attention-primary: ${#106EBE} !important;
    --cib-color-foreground-system-attribution-primary: ${#006621} !important;
    --cib-color-foreground-system-caution-primary: ${#9D5D00} !important;
    --cib-color-foreground-system-critical-primary: ${#C42B1C} !important;
    --cib-color-foreground-system-error-primary: ${#B10E1C} !important;
    --cib-color-foreground-system-link-primary: ${#4007A2} !important;
    --cib-color-foreground-system-neutral-primary: ${rgba(0, 0, 0, 0.45)} !important;
    --cib-color-foreground-system-neutral-strong: ${rgba(0, 0, 0, 0.8)} !important;
    --cib-color-foreground-system-success-primary: ${#0F7B0F} !important;
}
.sl-media-container-wrapper .media-container {
    z-index: 0 !important;
}
#b_header,
.hider-cr-wrapper {
    z-index: 1 !important;
}
.cat-nav {
    position: relative !important;
    z-index: 1 !important;
}

IGNORE INLINE STYLE
.b_header_bg
.sp-tpwebicons.WIKI *

================================

biorxiv.org

INVERT
.blood_logo
.logo-img
#czilogo

CSS
body {
    background-image: none !important;
}

================================

bitbay.net

INVERT
.navbar-brand
.logo
.full-page-preloader

================================

bitbucket.org

INVERT
a[href="/product"]
.registration-hero .form-prompt

CSS
div[data-testid="file-header"] {
    background-color: ${rgba(33, 53, 89, 0.08)} !important;
}
span[data-testid="file-tree-file__comments"] > span {
    color: var(--darkreader-neutral-text) !important;
}
span > svg {
    color: var(--icon-primary-color) !important;
}
[type="button"][tabindex="0"],
[data-testid="settingsButton"] {
    background-color: ${rgba(33, 53, 89, 0.04)} !important;
}
code.code,
[type="button"][tabindex="0"]:hover,
[data-testid="settingsButton"]:hover {
    background-color: ${rgba(33, 53, 89, 0.08)} !important;
}
.ak-navigation-resize-button {
    box-shadow: ${rgba(33, 53, 89, 0.08)} 0px 0px 0px 1px,
                ${rgba(33, 53, 89, 0.08)} 0px 2px 4px 1px !important;
}
[data-testid="pipeline-row"]:hover {
    background: var(--darkreader-neutral-background) !important;
    box-shadow: -4px 0 0 0 var(--darkreader-neutral-background), 4px 0 0 0 var(--darkreader-neutral-background) !important;
}
[data-testid="result-page"]>div>div:nth-child(3),
[data-testid="result-page"]>div>div:nth-child(3)>div {
    background: var(--darkreader-neutral-background) !important;
}

IGNORE INLINE STYLE
[role="presentation"] svg *
[aria-label="Bitbucket"] *

================================

bitcoinprice.com

CSS
.highcharts-button-box {
    fill: var(--darkreader-neutral-background) !important;
}

================================

bitcoinwisdom.com

INVERT
.site-branding

================================

bitly.com

CSS
.hero-content {
    background-image: none !important;
}

================================

bitwarden.com

INVERT
img[alt="Github Logo"]
img[src$="forbes.png"]
app-login img.logo

IGNORE IMAGE ANALYSIS
blockquote .blockquote-header

================================

bitwit.tech

CSS
.svg-primary {
    fill: #375D69 !important;
}
.svg-primary-light {
    fill: #4A7F8F !important;
}
.svg-primary-dark {
    fill: #28444D !important;
}
.svg-secondary {
    fill: #B88399 !important;
}
.svg-secondary-light {
    fill: #E8A9C4 !important;
}
.svg-secondary-dark {
    fill: #825F6E !important;
}
.svg-light {
    fill: #ADCED9 !important;
}
.svg-outline {
    fill: none !important;
    stroke: #000000 !important;
}
.svg-primary-outline {
    fill: none !important;
    stroke: #ADCED9 !important;
}
.svg-secondary-outline {
    fill: none !important;
    stroke: #375D69 !important;
}
.theme-light {
    display: none !important;
}
.theme-dark {
    display: none !important;
}
.theme-darkreader {
    display: block !important;
}

================================

biznes.pap.pl

CSS
body,
#copy {
    background-image: none !important;
}

================================

blablacar.*
blablacar.*.*

INVERT
.kirk-topBar-left

================================

blackboard.com

INVERT
li[class^="js-multiple-answer-answer"][class$="selected-answer"]
li[class^="js-answer"][class~="is-selected"][class$="answer-selected"]::before
.true-false-answer.selected-answer

CSS
li[class^="js-multiple-answer-answer"][class$="selected-answer"]::before {
    border-color: $var(--darkreader-neutral-background) !important;
}
li[class^="js-answer"][class~="is-selected"][class$="answer-selected"]::before {
    border-color: $var(--darkreader-neutral-background) !important;
}
.true-false-answer.selected-answer::before {
    border-color: $var(--darkreader-neutral-background) !important;
}

================================

blahdns.com

INVERT
[src="https://cdn.blahdns.com/logo.png"]
[src="https://cdn.blahdns.com/kofi4.png"]
.liberapay-btn > span
svg

================================

blaupunkt.com

INVERT
.fusion-standard-logo

================================

blog.arelion.com

INVERT
img[src="https://blog.arelion.com/wp-content/themes/arelion-blog-theme-kopia/public/images/logo.svg"]
img[src="https://blog.arelion.com/wp-content/themes/arelion-blog-theme-kopia/public/images/ico/search-icon.svg"]
img[src="https://blog.arelion.com/wp-content/themes/arelion-blog-theme-kopia/public/images/ico/right-arrow.png"]

================================

blog.cloudflare.com

CSS
body#main-body {
    background-color: ${white} !important;
    color: ${black} !important;
}
.dn {
    color: ${white} !important;
}
#nav {
    background-color: ${white} !important;
}
main#post {
    background-color: ${white} !important;
}
article.post-full {
    background-color: ${white} !important;
}
article p {
    color: ${gray} !important;
}
code {
    color: ${black} !important;
}
nav.pagination {
    background-color: ${white} !important;
}

================================

blog.csdn.net

CSS
html {
    height: inherit !important;
}
.main_father {
    background-color: var(--darkreader-neutral-background) !important;
}

================================

blog.documentfoundation.org

INVERT
img[alt*="The Document Foundation Blog"]

================================

blog.doist.com

INVERT
.db-header__logo-img

================================

blog.mozilla.org

INVERT
.content > .logo > [href^="https://www.mozilla.org/"]
.nav-global-donate > [href^="https://donate.mozilla.org/"]

CSS
.nav-global-donate > [href^="https://donate.mozilla.org/"] {
    color: ${white} !important;
}
#page {
    background-image: none !important;
}

================================

blog.nightly.mozilla.org

INVERT
.content > .logo > [href^="https://www.mozilla.org/"]
.nav-global-twitter a::before
.nav-global-join a::before

CSS
.nav-util-search .fm-search input {
    border-color: ${#999} !important;
}

================================

blog.scssoft.com

CSS
body {
    background: none !important;
}

================================

blogger.com

INVERT
.gb_ua
.feedflare

================================

blogs.windows.com

CSS
.c-video__icon::before {
    color: ${white} !important;
}
.item-single__content ::before {
    background-color: var(--darkreader-text--wp--preset--color--black) !important;
}

================================

bloomberg.com

INVERT
.navi-bar__button-icon
.navi-sections__item--LiveNow::before
.navi-sections__link--current::after

CSS
.navi {
    border-color: var(--darkreader-border--color-black) !important;
}

================================

blueberryroasters.pl

INVERT
div#logo

================================

bluemic.com

INVERT
.blue-logo

================================

boardgamearena.com

INVERT
.bgagame-kingoftokyo .player-board .player-hand-card

CSS
body {
    background: none;
}
.bga-dropdown__list.bg-bga-whitebg {
    background-color: rgb(35, 38, 39);
}
.bg-bga-gray-204 {
    background-color: rgb(57, 61, 62);
}
.bgagame-agricola .game-content,
.bgagame-agricola #right-side,
.agricola_popin_container,
.dijitTooltip .action-holder,
.dijitTooltip .player-card {
    color: #000;
}
:is(.bgagame-agricola, .dijitTooltip .action-component-tooltip) .action-card-holder .action-card .action-header,
:is(.bgagame-agricola, .dijitTooltip .action-component-tooltip) .action-card-holder .action-card .action-desc,
:is(.bgagame-agricola, .dijitTooltip .action-component-tooltip) .action-card-holder .action-card .action-footer {
    background-image: url("https://x.boardgamearena.net/data/themereleases/current/games/agricola/230120-1146/img/action_frame.png");
}
:is(.bgagame-agricola, .dijitTooltip .action-component-tooltip) .action-card-holder .action-s .action-header,
:is(.bgagame-agricola, .dijitTooltip .action-component-tooltip) .action-card-holder .action-s .action-desc,
:is(.bgagame-agricola, .dijitTooltip .action-component-tooltip) .action-card-holder .action-s .action-footer {
    background-image: url("https://x.boardgamearena.net/data/themereleases/current/games/agricola/230120-1146/img/action_frame_s.png");
}
.bgagame-bandada .cardontable,
.bgagame-bandada .playercard {
    background-image: url("https://x.boardgamearena.net/data/themereleases/current/games/bandada/221108-1032/img/birds312.png");
}
.bgagame-bandada #dicearea {
    background-image: url("https://x.boardgamearena.net/data/themereleases/current/games/bandada/221108-1032/img/dicecard.png");
}
.bgagame-carnegie .cng_timeline_image {
    background-image: url("https://x.boardgamearena.net/data/themereleases/current/games/carnegie/210812-1806/img/timelines.png");
}
.bgagame-catcafe .ctc_player_board {
    background-image: url("https://x.boardgamearena.net/data/themereleases/current/games/catcafe/221108-0942/img/catcafe_sheet.jpg");
}
.bgagame-catcafe .ctc_square {
    background-image: url("https://x.boardgamearena.net/data/themereleases/current/games/catcafe/221108-0942/img/drawings_black.png");
}
.bgagame-catcafe .ctc_cat_footprint {
    background-image: url("https://x.boardgamearena.net/data/themereleases/current/games/catcafe/221108-0942/img/catfootprint.png");
}
.bgagame-catcafe .ctc_column_scoring {
    background-image: url("https://x.boardgamearena.net/data/themereleases/current/games/catcafe/221108-0942/img/column_scoring.png");
}
.bgagame-catcafe .ctc_txt_flash {
    color: #007f37;
}
.bgagame-catcafe .ctc_sub_scoring {
    color: #000;
}
:is(.bgagame-doglover, .dijitTooltip) .DOG-card-name,
:is(.bgagame-doglover, .dijitTooltip) .DOG-card-type-text,
:is(.bgagame-doglover, .dijitTooltip) .DOG-card-bottom-text,
:is(.bgagame-doglover, .dijitTooltip) .DOG-card-dog-bonus-text,
:is(.bgagame-doglover, .dijitTooltip) .DOG-card-trick-cost-text,
:is(.bgagame-doglover, .dijitTooltip) .DOG-card-back-text {
    color: #000;
}
:is(.bgagame-doglover, .dijitTooltip) .DOG-card-trait-warning-text {
    color: maroon;
}
.bgagame-doglover .DOG-unfed .DOG-played-dog-card .DOG-card-placeholder .DOG-unfed-border {
    border-color: #7e0000;
}
.bgagame-evergreen .eve_remaining-actions .stockitem {
    filter: invert(100%);
}
.bgagame-kingoftokyo .player-evolution-card {
    background-image: url("https://x.boardgamearena.net/data/themereleases/current/games/kingoftokyo/230710-1229/img/evolution-cards.jpg");
}
.bgagame-kingoftokyo .kot-evolution {
    background-image: url("https://x.boardgamearena.net/data/themereleases/current/games/kingoftokyo/230710-1229/img/evolution-cards.jpg");
}
.bgagame-kingoftokyo .kot-evolution .description-wrapper {
    color: #000;
}
.bgagame-kingoftokyo #table .player-table .player-name .outline {
    -webkit-text-stroke: 4px #000;
}
.bgagame-legendraiders #bag {
    background-image: url("https://i.imgur.com/ptX6Fv7.png");
}
.bgagame-littlefactory .cardClay,
.dijitTooltip .cardClay {
    background-image: url("https://x.boardgamearena.net/data/themereleases/current/games/littlefactory/220227-0736/img/Card2.jpg");
}
.bgagame-littlefactory .cardCotton,
.dijitTooltip .cardCotton {
    background-image: url("https://x.boardgamearena.net/data/themereleases/current/games/littlefactory/220227-0736/img/Card4.jpg");
}
.bgagame-littlefactory .cardGrain,
.dijitTooltip .cardGrain {
    background-image: url("https://x.boardgamearena.net/data/themereleases/current/games/littlefactory/220227-0736/img/Card1.jpg");
}
.bgagame-littlefactory .cardStone,
.dijitTooltip .cardStone {
    background-image: url("https://x.boardgamearena.net/data/themereleases/current/games/littlefactory/220227-0736/img/Card5.jpg");
}
.bgagame-littlefactory .cardWood,
.dijitTooltip .cardWood {
    background-image: url("https://x.boardgamearena.net/data/themereleases/current/games/littlefactory/220227-0736/img/Card3.jpg");
}
.bgagame-littlefactory .cell3 {
    color: #000;
}
.bgagame-lox :is(
    .coinCountA, .coinCountB, .coinCountC, .coinCountD,
    .figurineCountA, .figurineCountB, .figurineCountC, .figurineCountD,
    .guildCountA, .guildCountB, .guildCountC, .guildCountD,
    .reputationCountA, .reputationCountB, .reputationCountC, .reputationCountD
) {
    color: #000;
}
.bgagame-microdojo .barrak {
    background-image: url(https://x.boardgamearena.net/data/themereleases/current/games/microdojo/221116-1802/img/barraks.png);
}
.bgagame-microdojo :is(.barrak, .Objname) {
    color: #000;
}
.bgagame-patchwork .cost-label {
    color: #222;
}
.bgagame-rainforest .token {
    background-image: url(https://x.boardgamearena.net/data/themereleases/current/games/rainforest/230403-1628/img/Tokens.png);
}
.bgagame-riftvalleyreserve #rvr-score-ref-holder {
    background-image: url(https://x.boardgamearena.net/data/themereleases/current/games/riftvalleyreserve/221228-1440/img/score_ref_vert.png);
}
.bgagame-riichimahjong :is(.JMJ_tile_other_annot, .JMJ_tile_self_annot) {
    background-image: url("https://x.boardgamearena.net/data/themereleases/current/games/riichimahjong/220818-0132/img/mahjongg_japan_annot.png");
}
:is(.bgagame-sevenwondersduel, .dijitTooltip) :is(.swd_title, .coin > span) {
    color: #000;
}
.bgagame-sixtyone :is(.sxt_leave, .sxt_location) {
    color: #000;
}
.bgagame-splashdown .sd_playerinfo_icon,
.bgagame-splashdown .lilypad,
.bgagame-splashdown .fly,
.bgagame-splashdown .frog,
.bgagame-splashdown .possibleMove {
    background-image: url(https://x.boardgamearena.net/data/themereleases/current/games/splashdown/230808-1947/img/tokens.png);
}
.bgagame-takaraisland .woundtoken {
    background-image: url(https://x.boardgamearena.net/data/themereleases/current/games/takaraisland/170709-1847/img/wound.png);
}
:is(.bgagame-thegnomesofzavandor, .dijitTooltip) :is(.helper, .helper2) {
    color: #000;
}
.bgagame-tickettoride .train-car-group-counter {
    -webkit-text-stroke: 3px #000;
}
.bgagame-tobago .clue_card {
    background-image: url(https://x.boardgamearena.net/data/themereleases/current/games/tobago/190401-1859/img/clue_cards.png);
}
.bgagame-tobago .hut {
    background-image: url(https://x.boardgamearena.net/data/themereleases/current/games/tobago/190401-1859/img/hut.png);
}
.kd_invite_card div[class*="bg-card"] {
    background-image: url("https://x.boardgamearena.net/data/themereleases/current/games/kado/250219-0834/img/cards.jpg");
}
.kd_card_back {
    background-image: url("https://x.boardgamearena.net/data/themereleases/current/games/kado/250219-0834/img/cards.jpg");
}
.nex_plname {
    color: #000;
}
.nex_metropad {
    background-blend-mode: multiply;
    background-color: #b0b0b0;
    background-image: url("https://x.boardgamearena.net/data/themereleases/current/games/nextstation/220831-1241/img/mainpad_back.jpg");
}
.nex_scorepad {
    background-image: url("https://x.boardgamearena.net/data/themereleases/current/games/nextstation/221221-2031/img/scorepad.jpg");
}
.rr-card {
    background-image: url("https://x.boardgamearena.net/data/themereleases/current/games/romirami/240422-0303/img/card_number.jpg") !important;
}
#rr-market-contract .rr-card-container .rr-card {
    background-image: url("https://x.boardgamearena.net/data/themereleases/current/games/romirami/240422-0303/img/card_contract.jpg") !important;
}
.rr-player-container-contract .rr-card {
    background-image: url("https://x.boardgamearena.net/data/themereleases/current/games/romirami/240422-0303/img/card_contract.jpg") !important;
}
.tactic-card .card-text {
    color: #404040;
}
.tundra .dijitTooltipContainer {
    background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAAYCAYAAAA7zJfaAAAAIklEQVQIW2OQl5f/zwAm5OTkyCFkZWX/MxBByMjI/GeAEwB0riA1hmHf7AAAAABJRU5ErkJggg==");
}

IGNORE INLINE STYLE
.bgagame-riftvalleyreserve :is(.rvr-rift, .rvr-stop, .rvr-svg-border)

================================

boardgamegeek.com

CSS
.legacy button,
.legacy input,
.legacy optgroup,
.legacy select,
.legacy textarea {
    color: var(--darkreader-neutral-text) !important;
}

================================

boincstats.com

CSS
#sidebar {
    background-image: none !important;
}

================================

bol.com

CSS
.skeleton-image[loaded] .skeleton-image__img,
.subcategory-entrances .image-card__image img,
.day-deal__image .img {
    mix-blend-mode: normal !important;
}

================================

bol.de

CSS
.tm-artikelbild-wrapper {
    z-index: 0 !important;
}

================================

boligsiden.dk

CSS
.bg-black {
    background-color: rgb(0 0 0/var(--tw-bg-opacity)) !important;
}

================================

bonfire.com

INVERT
.sw-Logo

================================

book.douban.com

IGNORE IMAGE ANALYSIS
.bigstar50
.bigstar45
.bigstar40
.bigstar35
.bigstar30
.bigstar25
.bigstar20
.bigstar15
.bigstar10
.bigstar05
.bigstar00
.allstar50
.allstar45
.allstar40
.allstar35
.allstar30
.allstar25
.allstar20
.allstar15
.allstar10
.allstar05
.allstar00
.rating
.starb
.collectors

================================

booking.com
*.booking.com

INVERT
span[data-testid="header-logo"]
.bui-calendar__control
.-iconset-close
.-iconset-navarrow_left
.-iconset-navarrow_right
.security-popup_close
.sort_more_options__button
.mb-ico
.-iconset-review_great
.-iconset-review_poor
.-iconset-chat_bubbles
.location_section_icon
.hp-date-picker-icon
.-streamline-info_sign
.-streamline-person
.-streamline-chat_bubbles
.hp-policies-calendar-icon
.-iconset-moon_crescent

CSS
#ss {
    background-position: 16px center !important;
    background-repeat: no-repeat !important;
    background-size: 20px !important;
}

================================

booking.uz.gov.ua

CSS
td:has(img[alt=QR]) {
    background-color: white !important;
}

================================

books.google.*
books.google.*.*

INVERT
.jfk-button-img

================================

books.googleusercontent.com

INVERT
reader-rendered-page.-gb-image > img

CSS
reader-rendered-page.-gb-text {
    filter: none !important;
}

================================

books.zoho.eu

CSS
.scrollbox {
    background: none !important;
}

================================

boredpanda.com

INVERT
.logotype

================================

boringcompany.com

CSS
.tweak-overlay-parallax-enabled .Parallax-item {
    z-index: 1 !important;
}

================================

bostonacoustics.com

INVERT
img[alt="logo"]

================================

bowerswilkins.com

INVERT
.logo

================================

boxberry.ru

INVERT
.slider__image
img[src$="cancel.png"]
.box_img_block
img[src$="Vector.png"]
ymaps[class$="ground-pane"]
ymaps[class$="svg-icon-content"] > ymaps

================================

bpmn.io

IGNORE INLINE STYLE
.djs-visual > *:not(text:not(rect + text))

================================

br.de

CSS
article h4,
article h3,
article p,
article .css-lip0i6,
article h5,
.asso-gtm,
.css-18ckx31 {
    color: ${#323232} !important;
}
article,
article section,
article footer,
.css-1fzo8jw,
.css-efdc07,
article .css-fhbsai,
main h3,
section.css-3copat section {
    background-color: ${white} !important;
}

================================

brack.ch

CSS
body,
body > header,
.popover,
.popover-body {
    background: var(--darkreader-neutral-background) !important;
    color: var(--darkreader-neutral-text) !important;
}
.list-group-item,
.modal-content {
    background: var(--darkreader-neutral-background) !important;
}
a:not(.product__category):not(:hover) {
    color: var(--darkreader-neutral-text) !important;
}
.bhaal1Vl:hover,
.bhauyhAt:hover {
    color: ${black} !important;
}

================================

brainly.com

INVERT
.brn-rich-content > p > img

================================

brainly.pl

INVERT
[id^="TexFormula"]
div.brn-qpage-next-answer-box__content > div > div > div img:not(.brn-qpage-next-attachments-viewer-image-preview__image)

================================

brave.com

CSS
section + img {
    display: none !important;
}

================================

breadfinancial.com

INVERT
.header-wrapper__logo

================================

breitbart.com

INVERT
#FootW #FWI p .parler

================================

bricklink.com

INVERT
.blp-header__logo-image
a[href*="/inventory.asp"]
a[href*="/wanted/list.page"]
a[href*="/myCollection/main.page"]

IGNORE INLINE STYLE
td[align="RIGHT"]+td[bgcolor]
.pciColorTabListItem
tr td+td[bgcolor]

================================

brilliant.org

INVERT
[class*="b-sprite-landing"]
[class*="b-sprite-publishers"]
.logo

================================

broadcom.com

INVERT
#header .navBrand .navbar-brand

================================

browser.kagi.com

INVERT
img[src="public/images/checkmark.svg"]
img[src="public/images/cross.svg"]

================================

browserleaks.com

INVERT
a::before

CSS
body {
    background-image: none !important;
}

IGNORE IMAGE ANALYSIS
#nav-menu a::before

================================

brucebase.wikidot.com

CSS
.yui-nav li em {
    background-color: var(--darkreader-neutral-background) !important;
    color: var(--darkreader-neutral-text) !important;
}
.yui-nav .selected a em {
    background-color: var(--darkreader-selection-background) !important;
    color: var(--darkreader-selection-text) !important;
}

================================

bsi.bund.de

INVERT
.c-branding__logo

CSS
.c-intro {
    z-index: 0 !important;
}

================================

buffer.com

IGNORE INLINE STYLE
div[class^="style__LogoWrapper"] *

================================

bugreplay.com

INVERT
.br-logo

================================

bugs.chromium.org

INVERT
hr
canvas
.dialog-content
input[type="date"]
div[class$="MuiMobileStepper-dot"]:not(div[class*="MuiMobileStepper-dotActive"])

CSS
:root {
    --chops-accessible-border: var(--chops-normal-border) !important;
    --chops-blue-50: #032742 !important;
    --chops-blue-75: #021524 !important;
    --chops-blue-gray-25: #1f1f1f !important;
    --chops-card-details-bg: #1a1a1a !important;
    --chops-choice-bg: #242628 !important;
    --chops-gray-200: #1e1e1e !important;
    --chops-gray-300: #4a4a4a !important;
    --chops-gray-400: #3f3f3f75 !important;
    --chops-gray-700: #989898 !important;
    --chops-gray-700-alpha: hsla(0, 0%, 100%, 0.62) !important;
    --chops-gray-900: var(--chops-primary-font-color) !important;
    --chops-normal-border: 1px solid #3f3f3f75 !important;
    --chops-orange-200: #6f4106 !important;
    --chops-orange-50: #342213 !important;
    --chops-primary-font-color: var(--darkreader-selection-text) !important;
    --chops-table-header-bg: #1c1c1c !important;
    --chops-white: #161616 !important;
    --darkreader-bg--chops-active-choice-bg: #06243b !important;
    --darkreader-bg--chops-blue-gray-25: var(--chops-blue-gray-25) !important;
    --darkreader-bg--chops-page-bg: var(--chops-white) !important;
    --darkreader-bg--chops-primary-button-bg: #003078 !important;
    --darkreader-bg--chops-white: var(--chops-white) !important;
    --darkreader-border--chops-accessible-border: var(--chops-normal-border) !important;
    --darkreader-border--chops-blue-100: #1b6099 !important;
    --darkreader-border--chops-checkbox-color: transparent !important;
    --darkreader-border--chops-gray-200: var(--chops-blue-gray-25) !important;
    --darkreader-border--chops-normal-border: var(--chops-normal-border) !important;
    --darkreader-border--mr-search-bar-border: var(--chops-normal-border) !important;
    --darkreader-text--chops-blue-700: var(--chops-blue-700) !important;
    --darkreader-text--chops-link-color: var(--chops-blue-700) !important;
    --darkreader-text--chops-primary-icon-color: #909090 !important;
}
body {
    background: none !important;
}
html {
    background-color: var(--chops-white) !important;
}
.metadata-container,
mr-issue-header {
    background: #141c14 !important;
}
#maincol > h3,
#maincol > div > h3 {
    background: #252525 !important;
}
.results th {
    border-color: var(--chops-white) !important;
}
input#searchq:not(input[name="member_default_query"]) {
    border-bottom: 1px solid #292929 !important;
    border-top: 1px solid #292929 !important;
}
input,
select,
textarea,
fieldset,
.MuiOutlinedInput-root:hover > fieldset {
    border-color: #3f3f3f75 !important;
    color: var(--darkreader-neutral-text) !important;
}
select:not(select[aria-label="Search scope"]),
select > *,
textarea:not(.css-66dh3a-MuiInputBase-input-MuiInput-input),
input[type="text"]:not(*:is(input[placeholder$="issues..."], input[name*="Hotlist"])) {
    background-color: #262626 !important;
}
#wordmark {
    color: #822 !important;
}
#editForm > .star-line {
    border: 1px solid var(--chops-orange-200) !important;
}
#star,
.jss24,
.jss12 > div > span,
.jss63.jss64,
.jss61 > span:nth-child(2),
div[class^="MuiDialogActions-root"] > button {
    color: var(--chops-blue-700) !important;
}
.__crdxFeedbackButton::after {
    color: #afafaf !important;
}
img[title="chromium"],
img[title="v8"] {
    filter: invert(100%) hue-rotate(180deg) contrast(83%) !important;
}
img[title="skia"] {
    filter: invert(100%) hue-rotate(180deg) contrast(87.5%) !important;
}
.select-container i {
    z-index: 4 !important;
}
.select-container select {
    background: #1e1e1e !important;
}
.dialog-content {
    background: #f5f5f5 !important;
    box-shadow: rgba(255, 255, 255, 0.4) 0px 3px 20px 0px !important;
}
button[title^="Don't show"] {
    color: var(--darkreader-text--chops-primary-font-color) !important;
}
chops-dialog *:is(i, th, td) {
    border-color: transparent !important;
    color: #22201f !important;
}
.preview {
    border: 2px solid rgb(24, 58, 114) !important;
}
.preview:hover {
    border-color: #034587 !important;
}
table > tbody:not(:has(tr[draggable="false"])) th {
    border-color: #161616 !important;
}
input#filter,
input[name="newHotlistName"],
input[type="date"] {
    background-color: #e3e3e3 !important;
    border: 1px solid #d9d9d9 !important;
    border-radius: 2px !important;
    color: black !important;
}
#issueHotlistsForm label {
    color: black !important;
}
#issueHotlistsForm chops-button[class="emphasized"] {
    background-color: #70a9fe !important;
}
#issueHotlistsForm chops-button[class*="de-"] {
    background: transparent !important;
}

IGNORE INLINE STYLE
.star
#user_star

================================

bugs.mojang.com

INVERT
#logo

================================

bugs.python.org

INVERT
img[title="has PR"]
img[title="GitHub"]

================================

bugzilla.opensuse.org
bugzilla.suse.com

CSS
body {
    background-color: var(--darkreader-neutral-background);
    background-image: url("https://bugzilla.opensuse.org/skins/contrib/openSUSE/noise.png"), linear-gradient(${#d7d3c8}, var(--darkreader-neutral-background) 400px);
}

================================

build-electronic-circuits.com

INVERT
.tutorial-intro
.tutorial-intro > *

CSS
.page-todo-list {
    background-color: rgb(109, 85, 9) !important;
}

================================

bulbagarden.net

CSS
body {
    background-image: none !important;
}

================================

bulbapedia.bulbagarden.net

INVERT
img.mwe-math-fallback-image-inline

================================

bulk.com

INVERT
.swatch-attribute.bp_size .swatch-option::before

CSS
.swatch-attribute.bp_size .swatch-option.selected::after {
    filter: none !important;
}

================================

bulldogjob.pl

INVERT
img[alt~="Bulldogjob"]
img[src="/bulldog.guide.svg"]
img[src="/bulldog.tte.icon.svg"]

================================

bulldogjob.pl/proxied/job-offers

IGNORE IMAGE ANALYSIS
*

================================

burmester.de

INVERT
.header-logo

================================

burnaware.com

INVERT
img[alt="Burnaware"]

================================

businessinsider.com
businessinsider.com.au
businessinsider.com.pl
businessinsider.co.za
businessinsider.es
businessinsider.jp
businessinsider.mx
insider.com
it.businessinsider.com

INVERT
.account-text-not-logged-in
.article-share_buttons
.brand
.brands-logo
.drawer-heading.headline-bold
.f-footer-logo
.f-header-logo
.f-header-editionLabel
.footer_logo-bi
.footer_social-links
.header-logo
.ins-drawer-button-area
.ins-drawer-vertical-link
.loginbar-icon-people svg
.logo
.logo-primary
.logo-pair-wrapper
.masthead-icon
.menu-search-icon
.menu-lang-icon
.navSocial-item
.navbar-brand
.net-social
.network-toggle
.new-menu-logo
.p-post-contentPrimeEntryPrice
.qotd_socials
.search-btn
.site-logo
.social-container
.social-icons > .social
.socialmedia-icon-list
.verticals-listitem-label
a[title="Business Insider España"]
a[id="menu-hamburger-button"]
a[href="/szukaj"]
button[class*="drawer-dropdown-button"]
button[class="unbutton"] > img
div[class*="footer__LogoWrapper"]
div[class*="footer__SocialWrapper"]
div[class*="header__Wrapper"]
section[class*="brands-social"]

================================

businesswire.com

INVERT
body > header div:first-child

CSS
#bw-home {
    background-image: none !important;
}

================================

buy.stripe.com
checkout.stripe.com

INVERT
img.Icon
svg.InlineSVG

CSS
:root {
    --darkreader-bg--border-box-shadow: 0 0 0 1px ${#c0c0c0}, 0 2px 4px 0 ${rgba(0,0,0,0.07)}, 0 1px 1.5px 0 ${rgba(0,0,0,0.05)};
    --darkreader-bg--border-box-shadowless: 0 0 0 1px ${#c0c0c0};
    --darkreader-bg--checkout-gray800: ${hsla(0,0%,10%,0.9)};
}
[style*="background-color: rgb(18, 26, 31)"],
.App-Container:has(.App-Background[style*="background-color: rgb(18, 26, 31)"]) {
    background-color: black !important;
}

================================

buzzsprout.com

INVERT
.icon_edit
.icon_stats
.icon_share

================================

byte.com

CSS
.description.show {
    z-index: 0 !important;
}

================================

c60.la.coocan.jp

CSS
body {
    background-image: none !important;
}

================================

cabinet.tax.gov.ua

INVERT
cb-header-public div.logo-add a div.icon

================================

cad.onshape.com

INVERT
.os-svg-icon
.os-form-field-container

CSS
.os-svg-icon {
    filter: grayscale(1) brightness(0.6) contrast(5) brightness(1.5) !important;
}
.os-panel-selector-button {
    border-color: transparent !important;
}

================================

caddy.community

INVERT
.logo-big

================================

caddyserver.com

INVERT
#logo
#zerossl-logo
#footer-logo

CSS
.hero {
    background-image: none !important;
}

================================

cadence.com

INVERT
.logo

================================

caf.fr

CSS
#theme-contenu-cnaf .row[class*="conteneur-"][class*="-cnaf"] > [class*="col-"],
#theme-contenu-menu-background-cnaf {
    background-image: none !important;
}

================================

caiyunapp.com

INVERT
#icon_current
#logo-name[src="/imgs/logo/logo-website.png"]
#map_canvas

================================

cake.avris.it

CSS
line[style*="stroke: black"],
polygon[style*="stroke: black"] {
    --box-a: 0.1 !important;
    stroke: white !important;
}
text {
    fill: white !important;
}

IGNORE INLINE STYLE
*

================================

caldigit.com

CSS
.elementor-widget-heading .elementor-heading-title[class*="elementor-size-"] > a {
    color: var(--darkreader-neutral-text) !important;
}

================================

calendar.google.com

INVERT
div[style*="gm_add_black"]
img[src$="google_gsuite"]
.wRfGxb > svg > path:first-child

CSS
div[role="checkbox"] > div > div > div {
    border: 1px solid ${black} !important;
}
div[role="dialog"] div[role="slider"][data-saturation] div:nth-child(2) {
    background-image: linear-gradient(to right,#fff 0%,rgba(255,255,255,0) 100%) !important;
}

IGNORE INLINE STYLE
div[role="checkbox"]
div[role="dialog"] div[role="slider"]
div[role="dialog"] div[role="slider"] div[style]
div[role="dialog"] div[role="button"][data-contrast]

================================

calibre-ebook.com

IGNORE IMAGE ANALYSIS
.tooltip
#content-wrapper

================================

calvinklein.us

INVERT
.star:not(.star-active)
.star-half

================================

canakit.com

INVERT
#homePageIcon

================================

candidates.ibo.org

INVERT
img#ibLogo

================================

canva.com

INVERT
#__next > div > section > div[style^="background-color"]
img[src*="category-public.canva.com/icons/"]

CSS
._8aslVA svg path {
    fill: ${black} !important;
}
html[data-darkreader-scheme="dark"].light {
    ---mghVQ: linear-gradient(180deg,#1d063f,#03152c) !important;
}

================================

canvas.*.edu

INVERT
.file_download_btn
.ic-DashboardCard__action-badge

CSS
textarea[class*="-textArea"],
[class*="numberInput_input"] {
    background-color: var(--darkreader-neutral-background) !important;
}

================================

canvas.usask.ca

CSS
#questions .text img {
    background-color: currentColor !important;
}

================================

capitoltrades.com

INVERT
.site-logo

================================

caramba-switcher.com

INVERT
.t996__cover

================================

cargurus.com

CSS
select > option,
select > optgroup,
select > optgroup > option {
    background-color: var(--darkreader-neutral-background) !important;
}
.homepage.redesign .ddC2dBanner .ddBannerSection .ddBannerSectionFigure .ddBannerSectionFigureWrapper {
    background-image: url(https://static-assets.cargurus.com/images/site-p2p/homePageBanner/DD_Mobile_606bb2f4286d575e9a21b2f3ac776e8dd33d0deccf409fe1598859361ce63c05.png) !important;
}

================================

carifred.com

CSS
.clform,
.headertable {
    background: var(--darkreader--neutral-background) !important;
}

================================

carmax.com

CSS
.recall__placeholder,
.vehicle-history__placeholder {
    background-color: ${yellow} !important;
}
#recall .recall__header *,
#recall .recall--link span {
    color: #2a343d !important;
}
#recall svg,
.vehicle-history__placeholder .vehicle-history a svg {
    fill: #053361 !important;
}
#recall a,
.vehicle-history__placeholder .vehicle-history a {
    color: #004487 !important;
}

================================

cars.com

CSS
.ep-theme-spark {
    --darkreader-bg--spark-color-background-action-checked: ${fff} !important;
    --ep-card-color-background: ${#fff} !important;
    --ep-tabs-tabs-color-background: ${#ddd} !important;
    --spark-color-background-action-checked: ${fff} !important;
    --spark-color-background-callout-cool: ${#ddd} !important;
    --spark-color-background-inverse: gray !important;
}
.sds-input-container .sds-text-field:focus {
    background-color: rgba(20,20,20,0) !important;
    color: var (--darkreader-neutral-text) !important;
}
[part="button"] {
    background: var(--darkreader-bg--spark-_color-black) !important;
    color: var(--darkreader-neutral-text) !important;
}
[part="base"] {
    color: var(--darkreader-text--ep-tab-color-text) !important;
}
input,
select {
    background-color: var(--darkreader-bg--ep-form-control-input-color-background) !important;
    color: var(--darkreader-text--ep-form-control-input-color-text) !important;
}

================================

casasbahia.com.br

CSS
.product-card__image {
    mix-blend-mode: normal !important;
}

================================

castbox.fm

INVERT
.nav-item.right.msg
.nav-item.right.upload
.nav-item.right.search
.userNav-img[src="https://s3.castbox.fm/webstatic/images/userIcon.06c408dc.png"]
.heart
.playbackRate.timing.icon

================================

castos.com/player/

INVERT
.playback__controls
button[class="player-btn__speed"][aria-label="Playback Speed"]
.play-pause-controls

================================

catalog.update.microsoft.com

CSS
#headerBox,
#searchButtonBox,
#searchGlowBottomBox,
#searchGlowPart4aBox,
#searchGlowPart4bBox,
#searchGlowPart8aBox,
#searchGlowPart8bBox,
#searchGlowTopBox,
.ResultsHeaderTD,
.dialogBody,
.mainBody,
.mainBodyHome,
.tabInactive {
    background-image: none !important;
}

================================

catit.com

CSS
.gb-inside-container {
    text-shadow: ${white} 1px 1px 0px !important;
}

================================

catt.rs/en/latest

CSS
code.literal {
    background-color: unset !important;
}

================================

cbpp.org

INVERT
.navbar-brand

================================

cbsnews.com

CSS
.content__read-more {
    color: var(--darkreader-neutral-color) !important;
}

================================

cdaction.pl

INVERT
a[href="/"] svg
footer > div > svg

================================

cdc.gov

INVERT
.cdc-logo path[fill="#000"]
img[src="/niosh/images/si-no-left-vp4.png"]

================================

cdimage.ubuntu.com

INVERT
.p-navigation__logo

CSS
#main {
    background-image: none !important;
}

================================

cdn5.dcbstatic.com

CSS
#image942Img {
    display: none !important;
}
li {
    list-style-image: none !important;
    list-style-type: circle !important;
}

================================

cdn77.com

INVERT
a[class^="Nav_logo"]

================================

cdp.contentdelivery.nu

CSS
body {
    background-image: none !important;
}

================================

cdrtools.sourceforge.net

CSS
body {
    background-image: none !important;
}

================================

celio.com

INVERT
.ec_account__user
.ec_header__logo
.ec_minicart__user
.ec_search__link
.ec_store__locator

================================

celum.ssg-service.com

CSS
body:hover {
    color: var(--darkreader-neutral-text) !important;
}

================================

ceneo.pl

INVERT
[data-new-icon]::before
.cat-prod-row__product-link::after
.add-to-favorite::after

IGNORE IMAGE ANALYSIS
[data-new-icon="basket"]::before
[data-new-icon="heart"]::before
[data-new-icon="user"]::before

================================

center-pf.kakao.com

CSS
.box_bubble .txt_chat {
    color: rgb(255 255 255);
}

================================

central.proxyvote.com

INVERT
.custom-control-label::after

================================

centrum24.pl

INVERT
#mobile-applications .jumbotron
.headerLogo.bankLogo
img[src*="close-black.svg"]
img[src*="GOALS.png"]
.mc-close-x-button-svg

================================

centrumxp.pl

INVERT
.badge-partner
.img-responsive

================================

cfos-emobility.de

CSS
.navbar {
    background-image: none !important;
}

================================

cfos.de

CSS
div[style*="keyboard-light.jpg"],
div[style*="organizer-light.jpg"],
div[style*="data-center-light.jpg"],
div[style*="speed-dial-light.jpg"] {
    background-image: none !important;
}

================================

changkun.de

CSS
.content h2,
h3 {
    z-index: 0 !important;
}

================================

charitynavigator.org

INVERT
img[alt="Charity Navigator Logo"]

================================

chase.com

INVERT
.single-logo-icon

CSS
.menu-button-item {
    color: var(--darkreader-neutral-text) !important;
}

================================

chat.deepseek.com

CSS
:root {
    --darkreader-background-ffffff: --darkreader-bg--dsr-bg;
}

================================

chat.google.com

CSS
:root {
    --pkw-background: var(--darkreader-neutral-background) !important;
}

================================

cheapshark.com

CSS
.header {
    border-top: 10px solid #000 !important;
}

================================

check.spamhaus.org

INVERT
.gradient-yellow
header .curve
header .logo

================================

checkout.minecraft.net

IGNORE INLINE STYLE
symbol#esrb [fill="#000"]
symbol#esrb [fill="#fff"]

================================

chem.libretexts.org

INVERT
.internal

================================

chess-results.com

INVERT
.FarbewT

================================

chessprogramming.org

INVERT
.mw-parser-output div[class^='float'] > a > img:not(.thumbimage):not(.thumbborder)
.mw-wiki-logo

IGNORE IMAGE ANALYSIS
.mw-wiki-logo

================================

chilkatsoft.com

CSS
body {
    background-color: var(--darkreader-neutral-background) !important;
    background-image: none !important;
}

================================

chinadigitaltimes.net

INVERT
.show-menu-button span

CSS
#main-header-wrapper {
    background-image: none !important;
}

================================

chinauos.com

INVERT
.brand

CSS
.choose {
    background-image: none !important;
}

================================

chipotle.com

INVERT
.banner-title
.banner-subtitle
.banner-legal

================================

christinamin9-ancientromancivilisation.weebly.com

CSS
.landing-page #main-wrap,
.tall-header-page #main-wrap,
.short-header-page #main-wrap,
.no-header-page #main-wrap {
    background-color: var(--darkreader-neutral-background) !important;
    background-image: none !important;
}

================================

chromeenterprise.google

INVERT
#post-linkedin
.ce-accordion--caret
.glue-carousel__navigation > li
.ce-device-card__details-title--icon
img[src*="hackerone"]
img[src*="blackberry"]
img[src*="samsung-knox"]
img[src*="paloalto"]
img[src*="onelogin"]
img[src*="splunk"]
img[src*="climate"]
img[src*="topcoder"]
img[src*="bailey-nelson"]
img[src*="colgate"]
img[src*="square"]
img[src*="getty-image"]
img[alt*="romevo"]
img[alt="Pythian"]
img[alt="Amazon"]
img[alt="Softbank"]
img[alt="Cameyo"]
img[alt="Citrix"]
img[alt="Nutanix Frame"]
img[alt="Dustin"]

CSS
img[alt="Onix"],
img[alt="USEN"],
img[alt="Inmac"],
img[src*="first-ipo"],
img[src*="compass-group"],
img[src*="doctor-dot-com"],
img[src*="devoted-health"],
img[alt*="See how people"] {
    filter: invert(15%) !important;
}
#how-to-buy {
    background-color: var(--darkreader-background-neutral) !important;
}

================================

chromestatus.com

INVERT
sl-icon

CSS
* {
    --button-color: ${black} !important;
    --card-background: --darkreader-background-neutral !important;
    --md-gray-700-alpha: var(--darkreader-text--default-color) !important;
}
header > aside > hgroup > a > h1,
section.card,
header#header[part=header],
p.description {
    color: var(--darkreader-text--default-color) !important;
}
chromedash-roadmap-milestone-card {
    background-color: var(--darkreader-background-neutral) !important;
}
section.release {
    background-color: transparent;
}
div.nav-dropdown-container > ul {
    background: grey !important;
}

================================

chtoes.li

INVERT
.illustration
.menu-page
.menu-item

================================

churchofjesuschrist.org

INVERT
svg

CSS
.container,
#PFmainFooter {
    background: var(--darkreader-neutral-background) !important;
}

================================

ci.appveyor.com

CSS
select {
    background-image: none !important;
}

================================

cinedrome.ch

CSS
body {
    background-image: none !important;
}

================================

circleci.com/docs

CSS
body {
    background-image: none !important;
}

================================

circuit-diagram.org

INVERT
.components-list .item .image

================================

cisce.org

INVERT
.nav-wrapper
hgroup

================================

citilink.ru

INVERT
div[class$="RatingDetail__progress_active"]

CSS
.OldPageLayout {
    color: var(--darkreader-neutral-text) !important;
}

IGNORE INLINE STYLE
.Icon

================================

cityam.com

INVERT
.site-logo__image
.menu-item a::before

================================

citybuzz.pl

INVERT
img[alt="CityBuzz"]

================================

citymapper.com

INVERT
#map

================================

classroom.google.com

INVERT
img[src$="dark_create_class_arrow.svg"]
img[aria-label="YouTube"]
div[role="dialog"] ~ div[role="menu"] > div[role="menuitem"] > div > div:not([style*="background-image"])

CSS
div[role="toolbar"] div[role="button"] > div[class*='-']:not([onclick]):not(:link):not(:visited):not([style*="background-image"]):first-child,
div[role="toolbar"] div[role="button"] > div[class*='-']:not([onclick]):not(:link):not(:visited) > :nth-child(2) > div,
div[style="bottom: 0px;"] > div[style^="opacity:"] div[role="button"] > div:not([onclick]):not(:link):not(:visited),
li[guidedhelpid="classworkTopicListGh"]:not(hover) > div {
    opacity: 99% !important;
}

================================

claude.ai

INVERT
img[src="/anthropic_app_icon.png"]

CSS
.bg-gradient-to-b {
    background-image: linear-gradient(to bottom, hsl(var(--darkreader-neutral-background)/1), hsl(var(--darkreader-neutral-background)/0)) !important;
}

================================

cleantechnica.com

CSS
body {
    background-color: #1d1e1f !important;
    background-image: none !important;
}

================================

clever.com

CSS
img[alt="i-Ready icon"],
img[alt="Google Meet icon"],
img[alt="Google icon"] {
    background-color: white !important;
}
.background-container {
    z-index: 1 !important;
}

================================

click.endnote.com

INVERT
img[src="/static/images/settings/web-of-science.png"]

================================

click.endnote.com/viewer?doi=

INVERT
canvas

================================

clients.servarica.com

INVERT
.logo

================================

cloud.databricks.com
pages.databricks.com
*.azuredatabricks.net

INVERT
.figure
#sparkui-iframe-body #plan-viz-graph svg g.cluster rect
#sparkui-iframe-body #plan-viz-graph svg g.node rect
.monaco-editor .cursors-layer .cursor

CSS
text {
    fill: ${black};
}
.cm-string {
    color: rgb(132, 179, 235) !important;
}
.cm-keyword {
    color: rgb(232, 121, 172) !important;
}
.cm-variable-2 {
    color: rgb(97, 215, 255) !important;
}
li.CodeMirror-hint {
    font-family: Source Code Pro, Menlo, monospace;
}
span[role="presentation"] {
    color: ${black} !important;
}
.CodeMirror-cursor {
    border-left-color: ${black} !important;
}
.ansiout {
    color: ${rgb(85, 85, 85)} !important;
}
.rm-modal {
    background: var(--darkreader-neutral-background) !important;
}

================================

cloud.digitalocean.com

CSS
.sc-cwHptR,
.sc-eBMEME,
.sc-tNXst,
.sc-kOPcWz,
.sc-DRugm,
.sc-dtBdUo,
.sc-dJiZtA,
.sc-bMCYpw,
.js-input,
.ember-text-field {
    background-color: inherit !important;
}
.sc-uVWWZ {
    background-color: ${#dfe0e0} !important;
}
input[type="text"],
input[type="text"]::placeholder {
    color: var(--darkreader-neutral-text) !important;
}
.action-item {
    color: var(--darkreader-neutral-text) !important;
}
.sc-cbPlza::before,
.sc-gHCuMn::before,
.sc-itktkY::before,
.sc-dnreFw::before,
.sc-hnCoju::before,
.sc-eRdibt::before,
.sc-jcdlHQ::before {
    background: none !important;
    background-color: var(--darkreader-neutral-background) !important;
}
.sc-hmdomO[data-active-item=""] {
    background-color: ${#d0d3d3} !important;
}
.sc-gRtvSG {
    background-color: ${#e2e3e3} !important;
}

================================

cloudflare.com

CSS
.cover {
    background-image: none !important;
}

IGNORE INLINE STYLE
.footer-bottom-row-margin > div > a > svg > path

================================

cloudhostnews.com

INVERT
.site-title

================================

cloudinfrastructuremap.com

INVERT
canvas.mapboxgl-canvas

================================

cloudlinux.com

INVERT
img.mega-menu-logo

================================

cloudways.com

INVERT
.md-button.md-primary.md-raised

================================

cnbc.com

INVERT
.RenderKeyPoints-list li::before
.WatchLiveRightRail-logo

CSS
div[class^="FeaturedStories-styles-makeit-background"]::before {
    opacity: 0.1 !important;
}

IGNORE INLINE STYLE
svg.ProPill-proPill *

================================

cnki.net

INVERT
.hello-yx-box
.klogin_header_Logo
.search-main > .input-box > .search-btn
.Logo

CSS
.foot-top {
    background-image: none !important;
}
.hello-yx-box {
    color: var(--darkreader-neutral-background) !important;
}

================================

cnn.com

INVERT
[data-test="section-link"] > svg:not(.business-logo-icon)
img.metadata-header__logo

CSS
#header-nav-container::before {
    border-bottom-color: transparent !important;
}

IGNORE INLINE STYLE
svg.cnn-badge-icon
svg.cnn-badge-icon > rect
svg.politics-logo-icon
svg.business-logo-icon

================================

cnnbrasil.com.br

INVERT
img[alt="CNN Brasil V&G"]
.menu__hamburguer span

CSS
.block__news__title:not(figcaption > .block__news__title):not(.carousel__item .block__news__title),
.author__group a,
.newReadMore__link:not(:hover),
.read-too__post-title,
div.single-content h2,
div.single-content h3 {
    color: var(--darkreader-text--clr-cnn-grey-5) !important;
}
:root:has([data-dark-theme="false"]) {
    --cnntv-background: ${#f3f3f3};
    --cnntv-background-1: ${#fff};
    --cnntv-bege: ${#333};
    --cnntv-dark-gray: ${#D8D8D8};
    --cnntv-dark-gray-2: ${#373737};
    --cnntv-light-gray: ${#B3B3B3};
    --cnntv-light-gray-2: ${#AEAEAE};
    --cnntv-light-gray-3: ${#676363};
    --cnntv-light-gray-4: ${#ad9f9f};
    --cnntv-search-input: ${#FFF};
    --cnntv-text__white: ${#050505};
}
html[data-darkreader-scheme="dark"] [data-dark-theme="false"] .cnntv__theater--row img {
    filter: none !important;
}

IGNORE IMAGE ANALYSIS
footer.black .footer__follow__nav .youtube__social__media a

================================

cnnews.chosun.com

INVERT
.logo

================================

cobaltstrike.com
cobalt-strike.github.io

INVERT
.navbar-brand

================================

code.qt.io

INVERT
td[class="logo"]
select
input

================================

code.visual
io.com

INVERT
img[src="/assets/icons/download_dark.svg"]

CSS
.home.linux .jumbotron .screenshot {
    background-image: url("/assets/home/home-screenshot-linux.png");
    padding-bottom: 82.65802%;
}
@media only screen and (min-width: 1200px) {
    .home.linux .jumbotron .screenshot {
        background-image: url("/assets/home/home-screenshot-linux-lg.png");
        padding-bottom: 68%;
    }
}

================================

codeberg.org
codeberg-test.org

CSS
main header .header-background-image {
    filter: brightness(50%) sepia(40%) !important;
}
main header .header-title {
    z-index: 1 !important;
}

================================

codecademy.com

INVERT
.CodeMirror-cursors
.CodeMirror-selected
span[class^="burger"]
.cursor-solid

================================

codeforces.com

INVERT
#header > div:first-child img
#userActivityGraph rect[data-items=""]
.delete-resource-link
.action-link img
.non-decorated img[src$="tablesorter-bg.gif"]
.tex-formula

CSS
.datatable,
.datatable > div,
.roundbox {
    border-radius: 6px;
}
.lt,
.rt,
.lb,
.rb,
.ilt,
.irt,
.roundbox-lt,
.roundbox-rt,
.roundbox-lb,
.roundbox-rb {
    display: none;
}
.backLava,
.leftLava {
    border-radius: 4.5px;
}
.backLava,
.leftLava,
.bottomLava,
.cornerLava {
    background: ${#BEBEBE} !important;
}
.sidebar-menu ul li {
    border-color: transparent !important;
}
.highlighted-row td,
.highlighted-row th {
    background-color: ${rgb(195, 205, 215)} !important;
}
#footer img[alt="TON"] {
    border-radius: 50%;
}
.cfpp-navbar-item > a {
    color: var(--darkreader-neutral-text) !important;
}

IGNORE INLINE STYLE
#userActivityGraph rect

================================

codewars.com

INVERT
.logo

================================

codingame.com/ide

CSS
.cg-statement .statement-body span.var,
.cg-statement .statement-body var {
    color: var(--darkreader-neutral-background) !important;
}

================================

codio.com

INVERT
.cursor

================================

coffeewatch.org

INVERT
a[title="Logo"]

================================

coinbase.com

CSS
.hjbuvQ,
.kfQbHv {
    fill: ${black} !important;
}

================================

coindesk.com

INVERT
svg[class^="desktop-navigationstyles__StyledLogo"]

================================

coingecko.com

INVERT
.highcharts-background

================================

colasoft.com

INVERT
img[alt="Colasoft"]

================================

coliss.com

CSS
body,
#container3,
#sidebar {
    background-image: none !important;
}

================================

color-hex.com

INVERT
img[src*="logo"]
.bgwhite
.bgwhite > .previewbox

IGNORE INLINE STYLE
.colordvaline
.colordva
.palettecolordiv

================================

colorhunt.co

IGNORE INLINE STYLE
.palette > div

================================

colorpicker.me

IGNORE INLINE STYLE
html
body
button

================================

colors.dopely.top

INVERT
.footer
.color-selector-icon

CSS
input.number-slider {
    filter: invert(10%) saturate(0%) !important;
}
img[src*="svg"],
.title {
    filter: invert(50%) !important;
}
.accountDopely__letter,
.editProfile__changeProfilePicture {
    filter: saturate(0%) brightness(50%) !important;
}
div[class*="text"],
a[class*="header"],
.navbar-dropdown-item__logo,
.navbar__listItem__button {
    filter: saturate(0%) !important;
}

IGNORE INLINE STYLE
.ExpandPalette *
.toner-colors-container *
.color-picker

================================

comdirect.de
*.comdirect.de

CSS
:root {
    --darkreader-bg--color--cd-lemon: 153, 147, 0 !important;
}
.layer__content {
    background-color: var(--darkreader-neutral-background) !important;
}

================================

comenius.susqu.edu

CSS
body,
table,
td {
    background-image: none !important;
}

================================

comicfury.com

CSS
#wrapper {
    background-color: inherit !important;
    padding-bottom: 10px !important;
}
#footer {
    margin-top: 0px !important;
}

================================

comingsoon.net

CSS
body,
main {
    background-color: var(--darkreader-neutral-background) !important;
}

================================

comixology.com

INVERT
.comixology-logo
.primary-heading
.heading-content
.try-now
.unlimited-disclaimer

================================

comma.ai

INVERT
.comma-header-logo
.comma-two-benefit-icon
.comma-landing-reviews-logo

================================

commoncause.org

CSS
.wrap1 {
    background-color: var(--darkreader-bg--c_b1t) !important;
}

================================

commonvoice.mozilla.org

INVERT
div:not(.logo-container) > .main-logo
.hero-box .fading
.waves
.mars + .screenshot
#help-links img
.button.outline.rounded.hidden-sm-down img
.text-button.contribute-more-button.secondary path

CSS
.language-select .current {
    --white: var(--darkreader-bg--white) !important;
}

================================

commscope.com

INVERT
.commscope-logo

================================

community.cloudflare.com

CSS
:root {
    --darkreader-text--primary-medium: ${gray} !important;
}

================================

community.kde.org

CSS
.vector-sticky-pinned-container::after {
    background: inherit;
}

================================

community.mimecast.com

CSS
.cb-section_background {
    mix-blend-mode: multiply !important;
}

================================

community.notepad-plus-plus.org

INVERT
.forum-logo

================================

community.ntppool.org

INVERT
#site-logo

================================

community.progress.com

CSS
:root {
    --lwc-colorContentAreaBackground: var(--darkreader-neutral-background) !important;
    --lwc-pageHeaderColorBackground: ${rgb(243, 243, 243)} !important;
}

================================

compass.pressekompass.net

INVERT
.logo-holder .brand-logo

IGNORE INLINE STYLE
text

================================

computerhope.com

INVERT
#text-tool > p > img

================================

computeruniverse.net

CSS
select.SortByBase_select__uXyP4,
button[class*="Button_headerLightBlue"] {
    background-color: #092846 !important;
    color: rgb(232, 230, 227) !important;
}
select.SortByBase_select__uXyP4 option {
    background-color: rgb(24, 26, 27) !important;
}

IGNORE IMAGE ANALYSIS
.SortByBase_select__uXyP4

================================

comsol.com

INVERT
div.latex
div.Eqn

================================

confectioneryproduction.com

INVERT
#mainLogo img

================================

confluence.*

INVERT
.gliffy-text-with-shape-parent-primary
.gliffy-text-with-shape-parent-secondary
.gliffy-text-with-shape-parent-tertiary
.gliffy-text-with-shape-parent-highlight

CSS
.geDiagramContainer rect,
.geDiagramContainer path {
    filter: brightness(60%);
}

================================

consent.yahoo.com

INVERT
.consent-wizard-body > .image-container > .image.yahoo

================================

console-openshift-console.*

CSS
.pf-c-dropdown__menu {
    background-color: var(--darkreader-neutral-background) !important;
}

================================

console.cloud.google.com

CSS
.cfc-ng2-region .cfc-text-title-3 {
    color: var(--darkreader-neutral-text) !important;
}
.cfc-color-text-secondary {
    color: ${#333} !important;
}
input[type=text] {
    color: var(--darkreader-neutral-text) !important;
}
.cfc-outline-focus-indicator {
    background: var(--darkreader-neutral-background) !important;
}
.bq-results-table-header-cell {
    background: var(--darkreader-neutral-background) !important;
}
.monaco-editor .cursor,
.monaco-editor .cursor-block,
.monaco-editor .cursor-line {
    background-color: ${#000000} !important;
    border-color: ${#000000} !important;
}

================================

consumerlab.com

INVERT
#overlay-toggle > .collapsed
.header-link-home

CSS
span[style*="background-color: rgb(255, 255, 0)"] {
    background-color: #550 !important;
}

================================

contacts.google.com

INVERT
img[src*="rotate"]
img[src$="google_gsuite"]

CSS
img[src^="https://ssl.gstatic.com/social/contactsui/images/emptycontacts/emptycontacts_animation_"],
div > c-wiz[data-p^='%.@.[[1,3'] > div > div > div > div > div:first-child {
    filter: invert(93.7%) hue-rotate(180deg) contrast(90.6%) !important;
}

================================

containertoolbx.org

CSS
body,
img,
video,
iframe {
    filter: none !important;
}

================================

convertio.co

INVERT
.logo svg > :last-child
.api-cta-icon > svg
.logos.no-select > *

CSS
.softobar.js-softobar,
.footer {
    background-color: #1c1f20 !important;
}
.ct-tab {
    border-bottom-color: #525252 !important;
}
.footer-sitemap {
    border-bottom-color: #3e3e3e !important;
}
.col.copyright > p.logo > a {
    color: #9D9488;
}
.col.copyright > p.logo > a > svg > use {
    filter: none !important;
}

================================

cookiepedia.co.uk

INVERT
.main-logo
.footer-logo

================================

coolblue.be
coolblue.nl
hotorangemedia.nl

IGNORE INLINE STYLE
.header__logo-image > path

================================

coolors.co

CSS
.generator_color {
    color: #fff !important;
}
.generator_color.is-light {
    color: #000 !important;
}

IGNORE INLINE STYLE
#generator *

================================

coopgames.eu

INVERT
img[alt="Online Co-Op"]
img[alt="Local Co-Op"]
img[title="PS2"]
img[title="PS3"]
img[title="PS4"]
img[title="PSP"]
img[title="PS Vita"]
img[title="DS"]
img[title="3DS"]
img[title="Switch"]

================================

coosp.etr.u-szeged.hu

INVERT
.latex

================================

copilot.microsoft.com

INVERT
button[is="cib-button"] svg-icon
button[class$="icon-button"] svg-icon

================================

copitosystem.com

CSS
body {
    background-color: var(--darkreader-neutral-background) !important;
    background-image: none !important;
}

================================

copytonotion.com

INVERT
.inline

CSS
svg.absolute {
    visibility: hidden !important;
}

================================

corriere.it

INVERT
.footer__content div div img

================================

corsair.com

INVERT
img.desktop
img[src="/_ui/responsive/common/images/icon_cart_empty.png"]
a.cart-close
input#search-btn
.swatch-white

================================

costplusdrugs.com

INVERT
img[src$="MCCP-wordmark-denim.png"]

================================

coupang.com
mc.coupang.com

INVERT
.select--category--button
img[src="https://static.coupangcdn.com/image/coupang/common/pc_header_img_sprite_new_gnb.svg#person"]
img[src="https://static.coupangcdn.com/image/coupang/common/pc_header_img_sprite_new_gnb.svg#cart"]
.main-section h2
#categoryBestMenu > .category-anchor
.category-best-title-ad-product

================================

courses.fit.cvut.cz

CSS
body {
    color: #909090;
}
.App.in-search {
    background-color: #212121 !important;
}
.UserMenu .user-initials {
    background-color: #616161 !important;
}
.CoursesItem .column-info > a:hover {
    color: #58c1ffba;
}
header {
    background-color: #212121 !important;
}
pre {
    color: #a8a6ab;
}
.header {
    background: none;
    border-bottom: 1px solid #676767;
}
main img {
    opacity: 0.8;
}
a {
    color: #58c1ffba;
}

================================

covims.org

INVERT
img[alt="Covims Logo.png"]

================================

cowkrakowie.pl

INVERT
.logo
.nav-logo

================================

coze.com

CSS
.semi-spin-children * {
    background: none;
    background-color: var(--darkreader-neutral-background) !important;
}

================================

cplusplus.com

CSS
#I_mid,
#I_top {
    background-image: none;
}
img[src$=".png"] {
    background-color: white;
}

================================

cppm3144.itdhosting.de

CSS
.ppm_button {
    background: ${white} !important;
}
.tableContent img {
    background-image: url("https://cppm3144.itdhosting.de/niku/ui/uitk/images/odf.png") !important;
}

================================

cpulator.01xz.net

INVERT
.terminal-cursor
.cm-s-neat span.cm-tag

CSS
div.dev_uart_term .terminal-cursor {
    background: var(--darkreader-neutral-background) !important;
    color: var(--darkreader-neutral-text) !important;
}
.cm-s-neat span.cm-tag {
    color: #006000;
}

================================

cqksy.cn

INVERT
td[background="image/Index_QI_CenterBar.gif"]

CSS
table {
    background-color: var(--darkreader-neutral-background) !important;
}
td[background="image/Index_QI_CenterBar.gif"],
td[background="image/Index_QI_CenterBar.gif"] a {
    color: ${white} !important;
}

================================

crates.io

IGNORE INLINE STYLE
svg[class^="_logo"] *

================================

creality.com

CSS
a.product_title {
    color: black !important;
}
div.core_main {
    text-shadow: ${rgb(225, 212, 201)} 1px 1px 0px !important;
}

IGNORE IMAGE ANALYSIS
.main .core_img .core_img_K2_Plus
.main .core_img .core_img_k1_max

================================

creative.com

INVERT
div.small-logo img.creative-logo
body:not(body[class^="storepage"]) div#all img.creative-logo
.sb-upgrade > h3
.sb-upgrade > p
.tws-series > h3
.tws-series > p

CSS
.input::placeholder {
    color: var(--darkreader-neutral-text) !important;
}

================================

creativecommons.org

INVERT
.icon-replace
a.search::before

CSS
main a,
footer a {
    --underline-background-color: transparent !important;
    background-position: 0% 93%,100% 93%,0% 93% !important;
    background-repeat: no-repeat,no-repeat,repeat-x !important;
    background-size: .05em 1px,.05em 1px,1px 1px !important;
}
.home-narrative .case-studies {
    z-index: 0 !important;
}

================================

creditkarma.com

INVERT
.navi-logo

================================

crowdfense.com

INVERT
.logo
.mega-menu.menu-hover-line > li.menu-item > a::before

================================

crowdin.com

INVERT
.crowdin-navbar__logo
svg.logo-icon-projects
.file_type
.file_type.file_folder.file_branch
[class*=static-icon]

CSS
.main-menu-wrapper {
    background-color: var(--darkreader-neutral-background) !important;
}

================================

crunchbase.com

INVERT
.identifier-nav
.tab-label

CSS
.mat-tab-label-active {
    color: var(--darkreader-neutral-background) !important;
}

================================

crutchfield.com

INVERT
.logo-module svg

================================

cryptostorm.is

INVERT
img[src*="lock.png"]
img[src*="storm.png"]

CSS
body > div {
    background-image: none !important;
}

================================

cs61a.org

CSS
table#calendar td {
    border-color: var(--darkreader-neutral-background) !important;
}

================================

css-tricks.com

CSS
.article-article {
    background: ${white} !important;
}

================================

cubawiki.com.ar

INVERT
.mwe-math-fallback-image-inline
.mwe-math-fallback-image-display

================================

curseforge.com

IGNORE IMAGE ANALYSIS
.e-generic-header

================================

cutlermaine.net

CSS
.sqs-block-button-element--medium:hover,
.sqs-block-button-element--large:hover {
    background: gray !important;
}

================================

cxp.cengage.com

INVERT
.owl_item_container img[src*=".gif"]
.ci-feedback img[src*=".gif"]
label img[src*=".gif"]
span.MathJax_SVG g[stroke="black"]

CSS
.owl_item_container img[src*=".GIF"] {
    background-color: ${black};
}
font[color="white"] {
    color: transparent !important;
}
div.tool-container.gradient > .controlButtons {
    background-image: none;
}
div.tool-container.gradient {
    box-shadow: none;
}

IGNORE INLINE STYLE
span.MathJax_SVG g

================================

cyberlink.com

INVERT
.logo_pc

================================

cybernews.com

IGNORE INLINE STYLE
svg *

================================

cynkra.com

INVERT
.btn-outline-dark
.shadow
.navbar-dark .navbar-brand
.cynkra-logo-font

CSS
.btn-outline-secondary {
    color: var(--darkreader-neutral-text) !important;
}

================================

cypress.io

INVERT
img[alt="Cypress Logo"]

CSS
.bg-gradient-to-r {
    background-image: linear-gradient(to right,var(--tw-gradient-stops)) !important;
}

================================

cyprus-mail.com

INVERT
.custom-logo-link

================================

cysgliad.com

INVERT
img[src*="logo_cysill_arlein_cy.gif"]
img[src*="hysbyseb_arlein.gif"]
div > img.gwt-Image

CSS
body {
    background-image: none !important;
}
div[tabindex] > div {
    background-color: var(--darkreader-neutral-background) !important;
    background-image: none !important;
}
textarea.cysilltextarea {
    border: none !important;
}

================================

czasnastopy.pl

INVERT
.brandinglogo-wrap

================================

czypada.pl

INVERT
#map

================================

czyztak.pl

INVERT
img[alt*="Logo"]

================================

d.hatena.ne.jp

INVERT
img[alt="Hatena Blog Tags"]

================================

d2l.ai

INVERT
img[src$=".svg"]

================================

daily.afisha.ru

INVERT
svg[class^="Logo"]
.headline__open
.search-icon
.sprite-search-black-26
mark

================================

dailydot.com

INVERT
h1.u-about-pitch

CSS
svg.main-logo.inline-flex g g[fill="#110133"] {
    --darkreader-inline-fill: ${#110133} !important;
}

================================

dailyexpose.uk

INVERT
.header-image

================================

dailymotion.com

IGNORE INLINE STYLE
div[class*="logoContainer"] a svg path

================================

dailywritingtips.com

CSS
blockquote {
    z-index: 0 !important;
}

================================

daltonmaag.com

INVERT
#panel-3 img

================================

danyk.cz

CSS
body {
    background-image: none !important;
}

================================

darcs.net

INVERT
#header > a > img

================================

darkbricks.net

IGNORE IMAGE ANALYSIS
*

================================

darksky.net

INVERT
.currentLocationButton
.searchButton
span[class^="skycon swip"]
#right-arrow
#left-arrow

================================

dash.cloudflare.com

INVERT
a[data-testid^="link-homepage"]

CSS
.monaco-editor-background,
.monaco-editor .margin {
    background-color: ${rgb(226 229 231)} !important;
}

================================

dashboard.stripe.com

CSS
[data-auto-transform-background="true"] {
    background-color: var(--darkreader-neutral-background) !important;
}

================================

dashboard.thechurchapp.org

INVERT
#ember62

================================

datacamp.com
*.datacamp.com

CSS
video#vjs_video_3_html5_api.vjs-tech {
    background-color: rgb(175, 175, 175, 0.5);
    transform: translate(0px, 0px) !important;
}
.css-hu6jey code {
    color: var(--darkreader-neutral-text) !important;
    mix-blend-mode: normal !important;
}
.css-hu6jey pre {
    color: var(--darkreader-neutral-text) !important;
    mix-blend-mode: normal !important;
}
.css-alxior code,
pre {
    color: ${#0f0f0f} !important;
    mix-blend-mode: difference !important;
}
.css-1ebl8to code,
pre {
    color: ${#0f0f0f} !important;
    mix-blend-mode: difference !important;
}

================================

daum.net

CSS
.txt_pctop,
.bg_login {
    background-image: none !important;
}

================================

dawn.com

INVERT
img[alt="Dawn Logo"]

================================

dc.sourceafrica.net

CSS
body {
    background-image: none !important;
}

================================

deadpixeltest.org

CSS
html {
    background-color: transparent !important;
}

IGNORE INLINE STYLE
body

================================

deadroots.net

INVERT
#header img

================================

debian.org
*.debian.org
*.debian.net

INVERT
.community img
img[src*="openlogo-100.jpg"]
img[src*="openlogo-50.png"]
img[src*="openlogo-50.svg"]
img[src*="openlogo-nd-75.png"]

CSS
body {
    background-image: none !important;
}
.header-logged-out {
    background-color: transparent !important;
}

IGNORE IMAGE ANALYSIS
#splash h1

================================

debijbel.nl

INVERT
.siteLogo
.filter-item__link > img

================================

decathlon.in
decathlon.nl

CSS
img {
    mix-blend-mode: normal !important;
}

================================

decathlon.pl

INVERT
.dkt_logo
.benefit-icon

IGNORE IMAGE ANALYSIS
*

================================

deccanchronicle.com

INVERT
img[src$="logo.png"]

================================

decisionproblem.com

INVERT
.qChip

CSS
#giftShopDiv {
    color: ${white} !important;
}
.projectButton:disabled {
    color: ${gray} !important;
}

================================

deepl.com

INVERT
.dl_translator_link_container > img
.dl_ad_pro__features_item::before
.dl_logo_text
img[class^="productNavigation-module--logoText"]
img#languageSelectorIcon
footer > div > div > div > div > a > img[alt="DeepL"]
div[class^="socialMediaLinks"] > a
div[class^="pageFooterV2-module--socialMediaLinks"] > a

================================

deeplearningbook.org

INVERT
.opened > img[src]

CSS
body {
    background-color: transparent !important;
}
#page-container {
    background-image: none !important;
}

================================

deepseek.com

CSS
.bg-cover,
.bg-center {
    background-image: none !important;
}
.bg-white\/50 {
    background-color: ${rgba(200, 200, 200)};
}

================================

deew.dev

CSS
[data-darkreader-inline-fill] {
    fill: #dcdad7 !important;
}

================================

deezer.com

CSS
.slider-track .gradient-default {
    background-image: linear-gradient(1deg, var(--color-dark-grey-800) 13%, var(--color-white));
}

================================

defectivebydesign.org

INVERT
.block--views-repeat-offenders-block .views-row img
img[src*="DRM-free label"]

CSS
.block--views-repeat-offenders-block {
    background: none !important;
}
.site-name a {
    background: url('https://www.defectivebydesign.org/sites/all/themes/dbd2/images/dbd-logo.png') top left no-repeat;
}
.l-region--navigation .menu li a,
.l-footer,
.l-footer .block__title {
    color: black;
}

================================

deftpdf.com

INVERT
.header__logo

================================

dell.com

INVERT
.breadcrumbs
.cat-banner-text
.cfsf-ba-content-wrap
.hpg-cat-item-wrap svg

================================

delphipraxis.net

CSS
.ipsNavBar_secondary {
    background-color: var(--darkreader-neutral-background) !important;
}
.ipsNavBar_secondary::before {
    border-bottom-color: var(--darkreader-neutral-background) !important;
}

================================

deltahub.io

INVERT
#ss-scrolling-logo-cloud a>img

================================

dennisbareis.com

CSS
body {
    background-image: none !important;
}

================================

deno.land

INVERT
img[src="/logo.svg"]

================================

dependencywalker.com

CSS
body {
    background-image: none !important;
}

================================

deraktionaer.de

INVERT
.close-dark

================================

designobserver.com

INVERT
.dologo

================================

deskmodder.de

CSS
#secondary {
    background-color: var(--darkreader-neutral-background) !important;
}

================================

desmos.com

INVERT
.dcg-calculator-api-container .dcg-grapher-2d .dcg-graph-outer[role="img"]
.dcg-calculator-api-container .dcg-grapher-3d

CSS
html[data-darkreader-scheme="dark"] .dcg-calculator-api-container :is(.dcg-graph-inner, .dcg-webgl-canvas) {
    filter: contrast(90%) saturate(200%) !important;
}
.dcg-calculator-api-container .dcg-container.dcg-inverted-colors {
    filter: hue-rotate(180deg) !important;
}
.dcg-calculator-api-container .dcg-grapher-3d .dcg-graph-outer {
    z-index: 1;
}
.dcg-expression-top-bar {
    background: var(--darkreader-neutral-background) !important;
}

IGNORE INLINE STYLE
.dcg-calculator-api-container .dcg-colored-icon
.dcg-calculator-api-container .dcg-color-swatch

================================

detexify.kirelabs.org

INVERT
.symbol

================================

dev.azure.com

CSS
:root {
    --nav-header-background: var(--darkreader-neutral-background) !important;
}

================================

dev.dota2.com

CSS
.navtabs li a.navtab:hover,
.navtabs li.selected a.navtab {
    color: black !important;
}

================================

dev.to

INVERT
img[src$=".svg"]
path[d^="M19.099 23.508c0"]

CSS
body,
h1,
h2,
h3,
h4,
h5,
h6,
a,
.content-classification-text {
    color: $(#e8e6e3) !important;
}

================================

devconnected.com

INVERT
.penci-hbg-logo-img

================================

developer.android.com
source.android.com
developer.android.google.cn
tensorflow.org
quantumai.google
cloud.google.com
webrtc.org

INVERT
.devsite-site-logo

CSS
:root {
    --devsite-background-1: var(--darkreader-neutral-background) !important;
    --devsite-background-3: ${#f1f3f4} !important;
    --devsite-footer-background: var(--darkreader-neutral-background) !important;
    --devsite-header-color-upper: var(--darkreader-neutral-background) !important;
    --devsite-inline-code-background: ${#f1f3f4} !important;
    --devsite-search-form-background-active: rgba(255, 255, 255, 0.05) !important;
    --devsite-searchbox-active: rgba(255, 255, 255, 0.05) !important;
    --devsite-searchbox-hover: rgba(255, 255, 255, 0.1) !important;
    --devsite-searchbox-inactive: rgba(255, 255, 255, 0.05) !important;
    --devsite-table-heading-background: var(--darkreader-neutral-background) !important;
}
devsite-search .devsite-searchbox::before {
    background-color: unset !important;
}
.devsite-wrapper,
button {
    background-color: inherit !important;
    border-color: rgba(255, 255, 255, 0.1) !important;
}
devsite-header .devsite-top-logo-row-wrapper-wrapper,
.devsite-article {
    border-color: rgba(255, 255, 255, 0.05) !important;
}
[role="menu"],
.toggle-button,
devsite-book-nav .devsite-book-nav-filter,
.devsite-nav-accordion,
tr,
code,
devsite-code,
devsite-selector,
devsite-selector devsite-tabs[connected],
devsite-recommendations,
devsite-footer-promos .devsite-footer-promos-list,
devsite-footer-utility .devsite-footer-sites,
devsite-footer-linkboxes .devsite-footer-linkboxes-list,
devsite-playlist .devsite-playlist--section-quiz,
devsite-footer-promos {
    border-color: rgba(255, 255, 255, 0.1) !important;
}
.devsite-breadcrumb-list {
    background: none !important;
}

================================

developer.apple.com

INVERT
.icon

CSS
.disabled {
    color: ${gray} !important;
}
pre,
.code-listing {
    background-color: var(--darkreader-neutral-background) !important;
}

IGNORE IMAGE ANALYSIS
.screen-hero
.screen-fonts
.screen-tabs
.screen-completion
.screen-swiftui

================================

developer.chrome.com

CSS
.featured-card__title-bar > svg,
.card-title-bar > svg,
.navigation-rail__icon > svg {
    fill: ${black} !important;
}
.search-box__btn > svg {
    fill: ${white} !important;
}

================================

developer.mozilla.org

INVERT
.copy-icon
.bc-browsers > th > span::before
.bc-platforms > th::before
a.external::after
.bc-has-history > .bc-history-link
.ic-footnote
.ic-non-standard
.breadcrumbs-container li .breadcrumb-penultimate::after
.breadcrumbs-container li .breadcrumb::after
ul.main-menu .top-level-entry::before
span.icon
#browser_compatibility + a + figure .icon
.bc-level
.legend-icons

CSS
.logo-text,
.search-results-list mark {
    color: var(--darkreader-neutral-text) !important;
}

IGNORE IMAGE ANALYSIS
.main-page-content .code-example .copy-icon

================================

developer.roblox.com

INVERT
.logo

================================

developer.salesforce.com

CSS
.slds-tabs_card {
    background-color: var(--darkreader-neutral-background) !important;
}

================================

developer.workday.com

INVERT
.minimap

CSS
.monaco-editor-background,
.margin {
    background-color: var(--darkreader-neutral-background) !important;
}

================================

developers.arcgis.com

CSS
a {
    text-shadow: none !important;
}

================================

developers.facebook.com

INVERT
img[alt^="Follow us on "]
img[id="u_0_1e_Fc"]
img[src^="https://scontent.fiev25-1.fna.fbcdn.net/v/t39.2365-6/306317286_5514106962009770_3327930304024114088_n.jpg"]

================================

developers.google.com

INVERT
.devsite-google-wordmark

CSS
:root {
    --devsite-background-3: ${rgb(198, 198, 198)} !important;
    --devsite-breadcrumb-list-background: var(--darkreader-neutral-background) !important;
    --devsite-button-background: var(--darkreader-neutral-background) !important;
    --devsite-footer-background: var(--darkreader-neutral-background) !important;
    --devsite-header-color-upper: var(--darkreader-neutral-background) !important;
    --devsite-searchbox-inactive: var(--darkreader-neutral-background) !important;
}
button,
a.button,
.devsite-landing-row-item {
    border-color: var(--darkreader-border--devsite-select-border) !important;
}
.pre-style,
code,
pre {
    background: var(--darkreader-neutral-background) !important;
}
.devsite-table-wrapper > table > thead > tr > th {
    background-color: var(--darkreader-neutral-background) !important;
    color: var(--darkreader-neutral-text) !important;
}
devsite-selector {
    background: var(--darkreader-neutral-background) !important;
}
devsite-book-nav .devsite-nav-title.devsite-nav-active {
    background: var(--darkreader-bg--devsite-note-notice-background) !important;
}

================================

devuan.org

INVERT
#logo

================================

dexie.org

INVERT
a[href="Download"]
img[src$="logo-dexie-black.svg"]

================================

dhmo.org

CSS
body {
    background-image: none !important;
}

================================

di.com.pl

INVERT
img[alt*="Dziennik Internautów"]

CSS
div#naglowek {
    background-image: none !important;
}

================================

diamondsdirect.com

INVERT
[alt="Diamonds Direct Logo"]

================================

dianping.com

INVERT
.logo

================================

dice.com

INVERT
dialog input
.seds-button

CSS
.match-not-logged-in-outer,
.match-not-logged-in-row,
.chip_chip__cYJs6,
.sc-dhi-candidates-modal-2 {
    background: var(--darkreader-neutral-background) !important;
}
a.link-label,
.match-not-logged-in-outer a,
.tertiary {
    color: var(--darkreader-text--djv-color-dice-blue-dark) !important;
}
.location-display,
.job-employment-type,
.employment-type,
.card,
.time-stamp,
.seds p,
.seds h1,
.seds h2,
.seds h3,
.seds h4,
.seds h5,
.seds h6,
dialog :not(input) {
    color: var(--darkreader-neutral-text) !important;
}
dialog input {
    color: black !important;
}
.collapsed {
    background: linear-gradient(rgba(24, 26, 27, 0) -7%, rgba(24, 26, 27, 0.58) 23%, rgb(24, 26, 27) 45%) !important;
}
.see-more-text {
    background-color: #181a1b !important;
}

================================

dicetower.com

CSS
body {
    background-image: none !important;
}

================================

dict.cc

CSS
#langbar {
    background-image: none !important;
}

================================

dictionary.cambridge.org

INVERT
.cb.hao.lpt-2
.cb.hv-2.lmr-10

================================

dictionary.com

INVERT
.elu13lxtzrRO8E8WYUVn
.tFCOipZXVYJAiob7tOp0

================================

dieselnet.com

CSS
:root {
    --shd-bk2: transparent;
    --shd-bkg: transparent;
}
html,
body,
article,
#mpanel,
.date {
    background-color: transparent !important;
    color: var(--darkreader-neutral-text) !important;
}
main h1,
main h2,
main h3,
main h4,
main h5,
.abox a>b {
    color: var(--darkreader-neutral-text) !important;
}
.abox {
    background-color: ${#eee} !important;
}
#footNote {
    background-color: ${#ddd} !important;
}

================================

differencebetween.net

CSS
body,
#page-wrapper {
    background-color: var(--darkreader-neutral-background) !important;
}

================================

digg.com

CSS
.digg-story__title-link {
    color: ${black} !important;
}
.digg-story__description {
    color: ${black} !important;
}

================================

digi.hu

INVERT
ol.flex-control-nav

CSS
body.not-front {
    background-image: none;
}

================================

digitalextremes.zendesk.com

INVERT
.logo

================================

disconnect.me

INVERT
img[src*="vpnCoverageMap"]
img[alt="Toolbar button"]
#press-strip > div > img

CSS
#accordion {
    background-image: none !important;
}

================================

discord.com

INVERT
div[class^="botPermissions"] > ul > li > div > div > span::after

CSS
div[class^="pill"][class*="wrapper"] > span[class^="item"],
div[class*="modeUnread"] > div[class^="unread"] {
    background-color: var(--darkreader-neutral-text) !important;
}
nav[aria-label="Servers sidebar"] foreignObject {
    border-radius: 100% !important;
    mask: none !important;
    transition: all .5s;
}
nav[aria-label="Servers sidebar"] foreignObject:hover {
    border-radius: 30% !important;
}
path[class^="wavePath"] {
    fill: ${rgb(226, 224, 220)} !important;
}
:root {
    --num-grid-columns: 4 !important;
    --page-gutter: 24px !important;
    --page-max-width: 1260px !important;
    --section-spacing: 56px !important;
}
@media screen and (min-width: 768px) {
    :root {
        --num-grid-columns: 8 !important;
        --page-gutter: 40px !important;
        --section-spacing: 80px !important;
    }
}
@media screen and (min-width: 1024px) {
    :root {
        --num-grid-columns: 12 !important;
        --section-spacing: 120px !important;
    }
}

IGNORE INLINE STYLE
div[class*="blobContainer"] > div > svg > mask
div[class*="blobContainer"] > div > svg > mask > use
div[class*="wrapper"] > svg > mask
div[class*="wrapper"] > svg > mask > use
div[class*="wrapper"] > svg > circle
mask[id*="svg-mask-avatar-status"] > *
mask[id*="svg-mask-status"] > *

================================

discourse.haskell.org

INVERT
.logo-big

================================

discover.com

INVERT
img#flag
i.icon-help
i.icon-search
i.lock-icon
div.welcome-text-wrapper
div.slide--img.credit-card
div.slide--img.personal-loan
div.slide--img.home-loan

================================

discover.forem.com

INVERT
body > div:nth-child(1) > svg:nth-child(1)

================================

discovermagazine.com

INVERT
img[alt="Discover Magazine"]

================================

discovery.endeavouros.com

INVERT
.builder-item--logo .site-logo img

================================

discuss.pixls.us

INVERT
#site-logo.logo-big

================================

discussions.apple.com

CSS
#globalnav {
    --globalnav-background: var(--darkreader-neutral-background) !important;
}

================================

disk.yandex.*
docviewer.yandex.*

INVERT
.logo
.create-resource-popup-with-anchor .ufo-icon__icon

================================

disney.*

INVERT
.disney-img

================================

distrowatch.com

INVERT
img[src="images/cpxtu/dwbanner.png"]

CSS
input,
.NavMenu,
select,
td:not(.NewsDate):not(.NewsHeadline) {
    background-color: var(--darkreader-neutral-background) !important;
}

================================

ditu.baidu.com
map.baidu.com
maps.baidu.com

INVERT
#activity-banner-panel
.BMap_bubble_pop
.BMap_contextMenu
.BMap_cpyCtrl
.BMap_scaleBarBG
.BMap_scaleTxt
.BMap_simple_bubble_pop
.BMap_stdMpZoom
.BMapLabel
#bt_trafficCtrl
.cbtlinetop
.cbtToolBar
.icon
#iw_tool_icon
.jump_back
#map-operate
#maps
.message-banner
#message-panel
.more-device
#nearby-searchbox-hint
#nearby-searchbox-hint-center
.route-button
.tang-pass-qrcode-title
#userSignPanel

CSS
#newuilogo {
    filter: brightness(80%);
}
#sole-input {
    color: var(--darkreader-neutral-text) !important;
}

================================

djrankings.org

CSS
body,
li a,
.moduleContentInner {
    background-image: none !important;
}

================================

djservice.se

INVERT
.shop_icon
img[alt="Hem djservice.se"]
img[alt="Qliro"]
img.nav-column-logo
img.listor3_box_logos_img
img.carousel_logo_img

CSS
a:link,
a:visited {
    color: var(--darkreader-neutral-text) !important;
}

================================

dlagentlemana.pl

INVERT
div.f-grid-3.logo-column > a > img
div.opineo-side-slider-widget > button
.logo-bar img

================================

dle.rae.es

CSS
.bloque_publi DE,
.spr_fundacionlacaixa,
.spr_dle90x110,
.spr_logo-enclave-rae,
.spr_google-play-badge-100x39,
.spr_badge-appstore-lrg-96x28,
.spr_edtri,
.spr_ay,
.spr_cita,
.spr_unidrae,
.spr_consultas,
.spr_pnwe2,
img[src="/images/logos/ASALE2.png"],
img[src="/images/logos/rae.png"],
img[src="/images/LibroDeEstilo_300.jpg"],
img[src="/app/doc/es/img/dle.jpg"],
a[href="https://dej.rae.es"] > img.img-responsive.b-lazy.b-loaded,
img[src="/images/logos/BCRAEl.jpg"] {
    filter: invert(93.7%) hue-rotate(180deg) contrast(90.6%) !important;
}

================================

dmca.com

INVERT
img[alt="DMCA Logo"]

================================

dmit.io

INVERT
.logo

================================

dnd.su

CSS
input,
select,
textarea,
.input-cast_time,
.input-style,
.input-select,
.button,
button:not(.lg-icon),
.workshop__checkbox .workshop__label::before,
.card-type,
.paper-1,
.desc .additionalInfo,
.subsection .additionalInfo,
.trumbowyg-editor .additionalInfo,
.social-menu ul,
#ya-site-form0 .ya-site-form__form .ya-site-form__input-text,
#ya-site-form0 .ya-site-form__submit {
    background-color: var(--darkreader-neutral-background) !important;
    background-image: none !important;
}

================================

dnd5e.wikidot.com

CSS
.feature {
    background-color: var(--darkreader-neutral-background) !important;
}
.feature.offcolor {
    background-color: ${rgb(255, 250, 180)} !important;
}
th {
    background-color: ${rgb(230, 216, 170)} !important;
}

================================

dndbeyond.com

CSS
.mon-stat-block,
.mon-stat-block::before,
.mon-stat-block::after,
body {
    background-color: var(--darkreader-neutral-background) !important;
    background-image: none !important;
}
.read-aloud-text,
.more-info::after,
.details-container::after {
    border-image: none !important;
}
::selection {
    background-color: var(--darkreader-selection-background) !important;
}

================================

dns-shop.ru

CSS
.star-rating__star svg g path {
    --darkreader-inline-fill: #afafaf !important;
    stroke: var(--darkreader-inline-fill) !important;
}
.star-rating__star[data-state="selected"] svg g path {
    --darkreader-inline-fill: #ffa319 !important;
}

================================

dnscrypt.pl

INVERT
.logo

================================

dnsleaktest.com

INVERT
img[src$="logo.png"]
img[src$="what-is-a-dns-leak.png"]
img[src$="transparent-dns-proxy.png"]

================================

dnslytics.com

INVERT
img[src*="logo.png"]

================================

doba.pl

INVERT
.social
img[src*="logo.png"]
img[src*="/img/powiaty/"]

================================

dobreprogramy.pl

CSS
header a[href="/"] svg {
    fill: #fff !important;
}

================================

doc.qt.io

CSS
:root {
    --content-bg-color: var(--darkreader-neutral-background) !important;
}

================================

doc.rust-lang.org

CSS
mark {
    color: var(--darkreader-neutral-text) !important;
}

================================

docs.asciidoctor.org

CSS
.doc .admonitionblock td.content,
.doc pre > code,
.doc p code,
.doc .colist > table code {
    background: var(--darkreader-neutral-background) !important;
}

================================

docs.codacy.com

INVERT
div.footer-logo > img[alt="Codacy"]

================================

docs.dagster.io

INVERT
img[alt="Dagster logo"]

CSS
#__next > div {
    background-image: none !important;
}

================================

docs.expo.dev

IGNORE INLINE STYLE
tr svg *

================================

docs.google.com

INVERT
.docs-icon
.punch-filmstrip-controls-icon
#docs-editor canvas
.docs-homescreen-icon
.kix-equation-toolbar-icon
.kix-equation-toolbar-palette-icon
.cell-input
.formula-content
.docs-instant-button-bubble-icon-container
.docs-gm .docs-dialog .modal-dialog-title-close::after
.docs-preview-palette-item
.goog-menuitem-checkbox
.goog-dimension-picker-unhighlighted
.goog-dimension-picker-highlighted
#docs-star
.rs-role-icon
.toggle-link-icon
.link-management-drop-down-icon
.vs-icon
.vpc-icon
.docs-analytics-img
.share-butter-copy-icon
.doc-previews-indicator-popover .docs-link-bubble-mime-icon
img[src$="googlelogo_dark_clr_74x24px.svg"]
img[src$="google_gsuite"]
.exportUnderline
.freebirdMaterialIconIconEl
.quantumWizTogglePapercheckboxCheckMark
#docs-titlebar-share-client-button .scb-button-icon:not([class*="white"])
body[itemtype*="PresentationObject"] #docs-titlebar-share-client-button .scb-button-icon
g.punch-filmstrip-indicator > image
.docs-gm .docos-icon-overflow-three-dots-size
.docs-grille-gm3 .docs-sheet-status-avs .goog-flat-menu-button-dropdown

CSS
.docs-preview-palette-item {
    border: transparent !important;
}
.cell-input {
    background-color: ${black} !important;
    color: ${white} !important;
}
.cell-input > span,
.cell-input > font {
    --darkreader-inline-color: ${white} !important;
}
.kix-cursor-caret {
    border-color: ${black} !important;
}
.kix-selection-overlay {
    background-color: var(--darkreader-selection-background) !important;
    border: var(--darkreader-selection-background) !important;
}
.ia-invite-controls-area {
    background-color: transparent !important;
}
.docs-gm .docs-revisions-switch .apps-ui-material-slide-toggle-thumb {
    background-color: rgb(43, 46, 48) !important;
}
.docs-gm .docs-revisions-switch.apps-ui-material-slide-toggle-container-checked .apps-ui-material-slide-toggle-thumb {
    background-color: rgb(9, 64, 155) !important;
}
.docs-text-ui-cursor-blink {
    fill: ${black} !important;
}
.docs-title-input-label:not([style*="pointer-events: auto"]) > #docs-title-input-label-inner {
    visibility: hidden !important;
}
input.docs-title-input {
    background-color: var(--darkreader-neutral-background) !important;
    color: var(--darkreader-neutral-text) !important;
}
.sketchy-text-background + g g rect {
    fill: var(--darkreader-selection-background) !important;
}

IGNORE INLINE STYLE
.cell-input > span

================================

docs.google.com/picker

INVERT
#doclist div > div + div div[style="user-select: none;"]:not([role="tab"]):not([role="listbox"]):not([role="menuitemradio"]):not([role^="menu"]) > div:not([aria-pressed]):not([role="tab"]):not([class$="highlightsgrid"]):first-of-type
#doclist div > div + div div[role="menu"] div[role="menuitem"][style="user-select: none;"] div[aria-label] div[data-tooltip] + div
#doclist div > div + div label + input + div[style]
img[src$="search-black.png"]

================================

docs.gtk.org

CSS
.emblem.deprecated {
    background: var(--error-bg-color);
    color: var(--darkreader-neutral-text);
}
a.current {
    background: var(--darkreader-selection-background) !important;
}
svg .node a text {
    fill: var(--darkreader-neutral-text);
}

================================

docs.manim.community

CSS
.toc-drawer {
    background: var(--darkreader-bg--color-background-primary);
}
.sidebar-search-container {
    background: var(--darkreader-bg--color-admonition-background);
}
.sidebar-tree .current > .reference {
    background: var(--darkreader-bg--color-admonition-title-background--admonition-todo);
}

================================

docs.nestjs.com

CSS
:root {
    --darkreader-bg--primary-accent-color: var(--primary-accent-color) !important;
    --darkreader-bg--primary-color: var(--primary-color) !important;
    --darkreader-bgimg--primary-gradient: var(--primary-3dp) !important;
}

================================

docs.opencv.org

CSS
#header,
.header,
.navpath ul,
.sm-dox,
body {
    background-image: none !important;
}

================================

docs.sentry.io

INVERT
.index-logo > img
a.hover-card-link[href="/platforms/apple/"] > .image-frame
a.hover-card-link[href="/platforms/javascript/guides/nextjs/"] > .image-frame

CSS
.document-wrapper,
.promo-banner {
    background-color: var(--darkreader-neutral-background) !important;
}

================================

docs.soliditylang.org

CSS
.wy-body-for-nav {
    background-color: unset;
}

================================

docs.vyos.io

CSS
.wy-menu-vertical a {
    background-color: var(--darkreader-neutral-background) !important;
    color: var(--darkreader-neutral-text) !important;
}

================================

doctorswithoutborders.org

INVERT
.site-logo

================================

documentfoundation.org

INVERT
.logo
img[alt*="LibreOffice Initial Artwork Logo ColorLogoBasic"]

================================

documentliberation.org

INVERT
img[src="assets/Uploads/dlp/images/logo-calligra.png"]
img[src="assets/Uploads/dlp/images/logo-libreoffice.png"]

================================

docusign.com
*.docusign.com

INVERT
a[data-context="nav-main-logo"]
img[data-qa="header-docusign-logo"]

================================

dominos.*

INVERT
.card--overlay > .card__header .card--overlay__close

CSS
svg.trackerbarimage:not(.complete svg.trackerbarimage) {
    fill: var(--darkreader-neutral-background) !important;
}
.stage:not(.complete) > .title > span {
    color: var(--darkreader-neutral-background) !important;
}
.tracker-page-container div.tracker-module.pizza-tracker .tracker-container > div.stage.complete [class^="chevron-"] {
    fill: #689d30 !important;
}
.tracker-page-container div.tracker-module.pizza-tracker .tracker-container > div.stage [class^="chevron"] {
    stroke: var(--darkreader-neutral-text) !important;
}

================================

donald.pl

INVERT
a[href="/"]

================================

doodle.com

INVERT
svg.d-checkmark .d-background

================================

doordash.com

INVERT
input[kind="RADIO"][id^="Toggle"]::after
.mapboxgl-canvas

================================

dotaunderlords.gamepedia.com
dota2.gamepedia.com
dota2.fandom.com

CSS
#right-navigation {
    background-image: none !important;
}

IGNORE IMAGE ANALYSIS
#left-navigation

================================

dou.ua

CSS
.g-right-shadowed,
.img::before,
.img::after {
    background-image: none !important;
}

================================

downloads.khinsider.com

CSS
body {
    background: none !important;
}
#faux {
    background-image: none !important;
}

================================

dp.ru

INVERT
.logo-image

================================

drawing.garden

CSS
html,
body {
    background-image: none !important;
}

================================

dribbble.com

INVERT
.site-nav-desktop-logo

================================

drive.google.com

INVERT
div[role="menuitem"] svg
div[role="dialog"][style^="width: 350px;"] div[role="button"][tabindex="0"]
div[role="dialog"] ~ div[role="menu"] > div[role="menuitem"] > div > div:not([style*="background-image"])
img[src$="type/audio/mp3"]
div[role="listitem"] > div > div > div > svg[fill="#000000"] > path
div[role="menu"] > div > div[role="menuitem"] > div > div > div
div[data-label="nd"] > div > div > svg > path[fill="#000000"]
div[role="document"] > div[role="button"] .a-b-c
div > svg > circle[fill="white"]
img[src*="empty_state_trash"]
img[src$="google_gsuite"]
div[tabindex="-1"][role="toolbar"] > div > div > div > svg > path[d^="M10 18h4v-2h-4v2zM3"]
button[class="ao-search-infolder ao-hint"]
button[aria-checked="true"] > div > svg > path
button[aria-checked="true"] > div > span > svg > path

CSS
span[data-type="spelling"] {
    mix-blend-mode: normal !important;
}
div[role="menu"] div[role="menuitem"][class*=" "] > div > div > div,
div[role="button"][aria-disabled="true"] > div {
    filter: invert(50%) !important;
}
#request-access-icon,
img[src="https://ssl.gstatic.com/docs/doclist/images/empty_state_details.png"] {
    filter: invert(93.7%) hue-rotate(180deg) contrast(90.6%) !important;
}
:root {
    --dt-secondary-container: ${#f1f3f4} !important;
}
button[guidedhelpid="new_menu_button"] {
    background-color: ${#dbdde0} !important;
}
div[data-target="autopurgebanner"] > section {
    background: ${#dbdde0} !important;
}
div[role="toolbar"] div[role="button"],
div[role="toolbar"] div[role="presentation"][data-active="true"] > div[role="presentation"] {
    mix-blend-mode: normal !important;
}

IGNORE INLINE STYLE
div[role="presentation"] svg
div[data-label="nd"] > div > div > svg > path[fill="#000000"]

================================

drive.google.com/file

INVERT
div[role="menu"] > div[role="menuitem"] > div > div > div
div[role="menu"] > div[role="menuitem"] > div > div

CSS
#request-access-icon {
    filter: invert(93.7%) hue-rotate(180deg) contrast(90.6%) !important;
}

================================

drive.google.com/picker

INVERT
div[role="menu"] div[role="menuitem"]:not([class*=" "]) > div > div > div
div[role="button"][tabindex="0"]

CSS
div[role="menu"] div[role="menuitem"][class*=" "] > div > div > div,
div[role="button"][aria-disabled="true"] > div {
    filter: invert(50%) !important;
}

IGNORE INLINE STYLE
svg[class=""]
svg[class=""] *

================================

droid-life.com

CSS
.collection-posts__list .preview__picture {
    mix-blend-mode: normal !important;
}

================================

dropbox.com

INVERT
.dl-dropbox
.drops-empty-page-header-image
.restorations-education__df-help__image
.search__view--empty img
.plan-status-section__icon img
.dropbox-logo__type
iframe[class^="previewhtml _previewContent"]
.toggle.toggle-block__toggle.dig-Toggle
.toggle.toggle-block__toggle.dig-Toggle.dig-Toggle--isToggled > span::after
.shared-with-members.audience-box.u-pad-top-xs.u-pad-bottom-s.u-mar-bottom-xs > .c-loader
.hp-card-carousel-dots
.loading-loading > .loading-img

CSS
.rc-inline-action-bar-container.brws-file-row-inline-action-bar {
    background: var(--darkreader-bg--color__core__secondary) !important;
}
svg.dig-GlyphLogo.dig-Waffle-row-logo path[fill="var(--color__glyph__accent)"] {
    --darkreader-inline-fill: var(--color__glyph__accent) !important;
}
svg.dig-GlyphLogo.dig-Waffle-row-logo path[fill="var(--color__glyph__primary)"] {
    --darkreader-inline-fill: var(--darkreader-text--color__standard__text) !important;
}
.dig-LabelGroup > div > input[aria-checked="false"] {
    background-color: var(--darkreader-bg--color__core__secondary) !important;
}
.dig-LabelGroup > div > input[aria-checked="true"] {
    background-color: var(--darkreader-text--color__core__secondary) !important;
}

IGNORE INLINE STYLE
.home__suggest_image path
.selection-preview-pane__icon path
.dig-WordmarkLogo path

================================

drupal.org

CSS
input[type="image"] {
    background: none;
}

================================

drvhub.net

INVERT
.vendors-block a img

CSS
.hero {
    background-color: ${white} !important;
    background-image: none !important;
}

================================

ds.163.com

INVERT
.c-slogan--normal

================================

dsausa.org

INVERT
.navbar-toggler-icon
.swiper-container-horizontal .swiper-pagination-bullet

================================

dspguide.com

CSS
#divPage {
    background-image: none !important;
}

================================

dtf.ru

INVERT
mark

================================

duckduckgo.com

INVERT
.is-active.js-tw-card.bg-clr--white.tw-card > .tw-card__footer > a.js-tweet-action.tw-card__action.tw-card__link > [src="/assets/common/slider/twitter-like.svg"]
[src="https://duckduckgo.com/assets/icons/thirdparty/wikipedia.svg"]

CSS
.justify-content-center.align-items-center.flex-lg-column.flex-md-row.card-1.card > .card-body > h3,
.justify-content-center.align-items-center.flex-lg-column.flex-md-row.card-2.card > .card-body > h3,
.justify-content-center.align-items-center.flex-lg-column.flex-md-row.card-3.card > .card-body > h3,
.justify-content-center.align-items-center.flex-lg-column.flex-md-row.card-1.card > .card-body > p,
.justify-content-center.align-items-center.flex-lg-column.flex-md-row.card-2.card > .card-body > p,
.justify-content-center.align-items-center.flex-lg-column.flex-md-row.card-3.card > .card-body > p,
.js-hiring-open-pos.join__btn.mt-5.btn.col-sm-auto.col {
    color: var(--darkreader-neutral-background) !important;
}
.logo_homepage {
    background-image: url("https://duckduckgo.com/assets/logo_homepage.alt.v108.svg") !important;
}
.header__logo {
    background: no-repeat center url("https://duckduckgo.com/assets/logo_header.alt.v108.svg") !important;
}

IGNORE INLINE STYLE
#color_picker_container .sample
.zci--color_codes .circle

================================

duo.google.com

INVERT
.gb_se .gb_ye:not(.gb_Ae)

================================

duolingo.com

INVERT
.Z392z
._24NNT
[data-test="skill-icon"] + div img

CSS
button[aria-disabled="true"] {
    opacity: 0.3 !important;
}
button.WOZnx::before,
div._3C_oC::before {
    background-color: transparent !important;
}

IGNORE INLINE STYLE
div[data-test="challenge-translate-prompt"] svg *
div[data-test="challenge challenge-translate"] svg *

================================

dvizhcom.ru

INVERT
.mobile-header-icon:nth-last-of-type(3)
.mobile-header-icon:nth-last-of-type(2)
.mobile-header-icon:nth-last-of-type(1)

================================

dw.com

CSS
#bodyMover {
    background-image: none !important;
}

================================

dynadot.com

INVERT
img[data-src="/tr/mainsite2023/navbar-logo-dark-2023.png"]
img[data-src="/tc/img/logo/navbar-logo.svg"]
.icons-line img

================================

dziennik.pl

INVERT
img[alt="Dziennik"]

================================

dziennikbaltycki.pl
dzienniklodzki.pl
dziennikpolski24.pl
echodnia.eu
expressbydgoski.pl
expressilustrowany.pl
gazetakrakowska.pl
gazetalubuska.pl
gazetawroclawska.pl
gk24.pl
gloswielkopolski.pl
gol24.pl
gp24.pl
gra.pl
gs24.pl
i.pl
kurierlubelski.pl
motofakty.pl
naszemiasto.pl
*.naszemiasto.pl
nowiny24.pl
nowosci.com.pl
nto.pl
pomorska.pl
poranny.pl
sportowy24.pl
strefaagro.pl
strefabiznesu.pl
strefaedukacji.pl
stronakobiet.pl
stronazdrowia.pl
telemagazyn.pl
to.com.pl
wspolczesna.pl

INVERT
.atomsArticleFoot__tools svg
.atomsCommentsExposition__icon svg
.atomsGalleryButtonsNavigation__left svg
.atomsGalleryButtonsNavigation__right svg
.atomsNavigationBreadcrumbs__content svg
.atomsNavigationFooterLinks__logo
.atomsNavigationIconsIcon
.atomsNavigationIconsList a svg
.atomsSocialmediaExposition__content svg
.componentsGalleryNavbar__btn_close
.componentsGalleryNavbar__logo
.componentsNavigationMenu__logo
.componentsNavigationNavbar__href
.componentsNavigationTopnavbar__icons div span svg
a[href="https://i.pl/firmy"] svg
a[href="https://i.pl/szukaj"] svg

CSS
svg path[d^="M154.992 47.9999H128L13"],
svg path[d^="M64 28L68 24V15.9999H82"] {
    fill: ${black} !important;
}

IGNORE INLINE STYLE
.componentsNavigationNavbar__href svg *

================================

dzienniknaukowy.pl

INVERT
.top-logo

================================

dziennikprawny.pl

INVERT
a[href="/"]
.fullba

CSS
.fullba {
    background-image: none !important;
}

================================

e.foundation

INVERT
img.attachment-full.size-full

================================

ea.com

INVERT
.left_context .context dl dd.select
.modifyMobilePhoneBtn

CSS
img[src*="white-bg-ea-bg-global-white"] {
    display: none !important;
}
body.origin-com,
.left_context .context {
    background-image: none !important;
}
.body_foot .language .select_language .languageText,
.buttonstyle_3 span,
.origin-ux-drop-down-selection > span,
.origin-ux-button-primary > span,
.origin-ux-button-secondary > span {
    color: var(--darkreader-neutral-background) !important;
}

================================

eapteka.ru

INVERT
ymaps[class$="ground-pane"]
ymaps[class$="svg-icon-content"] > ymaps

================================

earthquake.usgs.gov

INVERT
img[src*="services.arcgisonline.com"]:not([src*="World_Imagery"])

================================

easybib.com/guides

INVERT
.hamburger-toggle svg

================================

easypost.com

INVERT
.logo
.progress-bar

================================

eatthis.com

INVERT
svg.site-logo

CSS
.header-leading-authority {
    background-color: var(--darkreader-neutral-background);
}

================================

eblocker.org

INVERT
.site-logo-img
figure[class="aligncenter size-large is-resized"]

================================

ebok.pgnig.pl

INVERT
img[src*="logo"]

================================

ebok.vectra.pl

CSS
.side-floater {
    background-image: none !important;
}

================================

ebooks.cpm.org

INVERT
img[alt="Review and Preview problems below"]

================================

economist.com

INVERT
#ds-wordmark-1843 path:nth-child(5)

CSS
.css-1xqo7ld {
    color: transparent;
}

IGNORE INLINE STYLE
#ds-economist-logo > path
.ds-share-link > svg > g > circle

================================

eda.yandex.ru

INVERT
.DesktopHeader_logo
.DesktopLiteHeaderLayout_desktopLogoImage
.UiKitOrderStep_icon
.DesktopHeaderBlock_linkIcon
.Profile_chevronIcon
.DesktopCatalogPageSort_sliderIcon
.DesktopHeader_menuIcon
ymaps > ymaps > ymaps > canvas

================================

edmworldmagazine.com

INVERT
.q_logo

================================

edmworldshop.com

INVERT
.site-nav__link--burger
.site-header__logo-image

================================

edstem.org

CSS
.tab-bar-dark .active .tbb-tab-side .fill {
    fill: rgb(34, 37, 38) !important;
}
.tab-bar-dark .tbb-tab-side .fill {
    fill: rgb(26, 28, 29) !important;
}

================================

education.github.com

INVERT
img[alt="GitHub Education"]
.octicon-logo-github

================================

education.yandex.ru

CSS
#fix-color__white .lc-text-block {
    color: ${black} !important;
}
#fix-color__black .lc-text-block {
    color: ${white} !important;
}

IGNORE INLINE STYLE
.lc-text-block

================================

eduke32.com

CSS
.main {
    background-image: none !important;
}

================================

edulastic.com

INVERT
img.keyboardButton

================================

eduserver.ru

CSS
section.content {
    background: var(--darkreader-neutral-background) !important;
}

================================

eevblog.com

CSS
#main_content_section > div > span,
#quickModForm > div > span,
#main_content_section > span {
    mix-blend-mode: color !important;
}
.frame,
.plainbox,
#header,
#content_section,
#footer_section {
    background: var(--darkreader-neutral-background) !important;
    color: var(--darkreader-neutral-text) !important;
}

================================

eeworld.com.cn
*.eeworld.com.cn

INVERT
.header-logo-search-login
.logo_l

================================

efa.mvv-muenchen.de
rad.mvv-muenchen.de

INVERT
.personalization
.swap
.footer_btn
.footer_btn_main

CSS
#incr_date,
#incr_time,
#decr_date,
#decr_time {
    filter: invert(100%) hue-rotate(180deg) brightness(80%) !important;
}
#search_fields_wrap .no_a img,
.fav {
    filter: invert(100%) hue-rotate(180deg) brightness(350%) !important;
}
#main_nav_wrap,
#mail_feedback,
#minimized_container,
.mined_ctr,
.ui-dialog .ui-dialog-titlebar,
.leaflet-popup-content-mdv-title,
.ui-widget-header {
    background-color: rgb(59,59,59) !important;
    border-bottom-color: rgb(123,123,123) !important;
}
#main_nav > li a {
    border-color: rgb(59,59,59) !important;
    color: rgb(123,123,123) !important;
}
p img {
    filter: invert(100%) hue-rotate(180deg) brightness(100%) !important;
}
[title="Fussweg"] {
    filter: invert(100%) hue-rotate(180deg) brightness(100%) !important;
}
.text_field {
    background-color: rgb(11, 14, 15);
    border-color: rgb(255 255 255);
}
input::placeholder {
    color: rgb(255, 255, 255) !important;
}
.leaflet-tile-pane {
    filter: invert(90%) hue-rotate(180deg) brightness(120%) !important;
}
.leaflet-marker-pane {
    filter: brightness(75%) !important;
}
input[type=radio]:checked + label {
    border-color: white !important;
    border-width: 1px;
}
input::placeholder {
    color: white !important;
    font-weight: bold;
}
.historyitem {
    color: white !important;
}

================================

eff.org

INVERT
#masthead .branding a
#masthead #main-menu-nav form.search-site button[type="submit"]

CSS
select > optgroup,
select > optgroup > option {
    background-color: var(--darkreader-neutral-background) !important;
}
#masthead #main-menu-nav .pane-main-nav-menu > ul > li a::before {
    background-color: var(--darkreader-neutral-text) !important;
}

================================

elastic.co

CSS
code {
    mix-blend-mode: unset !important;
}

================================

elearning.utdallas.edu

INVERT
.contentBox.contentBox-edit
.content.clearfix

================================

electrical-symbols.com

INVERT
.table-striped img

================================

electrical4u.com

INVERT
img[src*="equation"]

================================

electricitymap.org

INVERT
.name
.circular-gauge
img[alt="logo"]
.capacity
.mapboxgl-canvas

================================

elektronik-kompendium.de

INVERT
img[src*="formel/"]
img[src*="schalt/"]

================================

element.io

INVERT
.header--logo--img
.ems-nav__logo

================================

elementalmatter.info

INVERT
[src$="atom.gif"]
[src$="periodic-atomic.gif"]

CSS
td {
    background: var(--darkreader-neutral-background) !important;
}

================================

elementary.io

IGNORE INLINE STYLE
.logotype-svg

================================

eletimes.com

INVERT
.tdb-logo-img

================================

elitepvpers.com

INVERT
.inlineimg
img[src*="images/elitepvpers/buttons/"]

CSS
body,
td[id="userbarbg"],
.alt1,
.alt1Active,
.alt2,
.alt2Active,
.panel,
.panelsurround,
.thead,
.vBulletin_editor,
.fieldset,
.ticker,
#contentshadowwhite,
td[id="navbg"],
td[id="navstart"],
.signature-preview,
.cwcontent,
.cwalt {
    background-image: none !important;
}
.alt1,
.alt1Active,
.alt2,
.alt2Active,
.panel,
.panelsurround,
.thead,
.vBulletin_editor,
.fieldset,
.ticker,
#contentshadowwhite {
    border-color: var(--darkreader-neutral-background) !important;
}
td[id="userbarbg"],
td[id="navbg"],
td[id="navstart"] {
    background-color: color-mix(in srgb, var(--darkreader-neutral-text) 10%, var(--darkreader-neutral-background) 90%) !important;
}

================================

elle.com

INVERT
.css-lgctud .e1ccpyf90

================================

elp.northumbria.ac.uk

INVERT
.selected-answer

================================

emacswiki.org

CSS
body {
    background-color: var(--darkreader-neutral-background) !important;
}

================================

eman-physics.net

INVERT
.middle_area img

CSS
.middle_area {
    border-left-color: transparent !important;
}
.middle_area,
.maintxt,
.display {
    background: none !important;
}
body {
    background-color: var(--darkreader-neutral-background) !important;
}

================================

endeavouros.com

INVERT
.navbar-brand

================================

endoflife.date

CSS
.bg-green-000,
.bg-yellow-200,
.bg-red-000 {
    color: var(--darkreader-neutral-text) !important;
}

================================

endomondo.com

INVERT
.header-shop-logo
.footer-shop-logo
.eoFeedWorkout-map-image
.workoutMap img[src*="maps"]

CSS
.highcharts-background {
    fill: rgb(24, 26, 27) !important;
}
.highcharts-data-labels text {
    text-shadow: none !important;
}

================================

enduhub.com

CSS
.navbar .nav > li > a {
    text-shadow: rgb(40, 43, 54) 0px 1px 0px !important;
}
.blurme,
.blurme a {
    color: inherit;
    filter: unset;
}

================================

enea.pl

INVERT
.menu__logo
.navbar-brand
.slider-content > .slider-title

CSS
.col-lg-12.col-md-12 > div > div > p {
    color: var(--darkreader-neutral-background) !important;
}
.bkg-icon,
.left-bkg-icon {
    color: ${white} !important;
}

================================

engines4ed.org/hyperbook/

CSS
body {
    background-image: none !important;
}

================================

enjen.net

CSS
body {
    background-image: none !important;
}
input.input-medium {
    background-image: none !important;
}
select.input-small {
    background-image: none !important;
}

================================

eps.rs

INVERT
.racun-wrapper

================================

erasmusgeneration.org

CSS
.form-item a {
    color: black !important;
}
.form-item a:hover {
    color: white !important;
}

================================

ernestjones.co.uk

INVERT
.logo__img

================================

esbuild.github.io

CSS
.progress {
    background: linear-gradient(to right, rgba(255, 255, 255, 0) 0%, #181a1b 25%, #181a1b 75%, rgba(255, 255, 255, 0) 100%);
}

================================

eshop-switch.com

INVERT
.logo

================================

eshot.gov.tr

CSS
a.navbar-brand img {
    filter: hue-rotate(90deg) invert(1) hue-rotate(90deg) saturate(15);
}
#heading .left,
#heading .sub-menu .left-xs,
#heading .sub-menu .right-xs {
    background-color: transparent !important;
    background-image: none !important;
}
section#announcements-area .container {
    background-image: none;
}

================================

esimdb.com

INVERT
img[alt="eSIMDB logo"]

================================

esphome.io

INVERT
img.component-image

================================

esquire.com

INVERT
.nav-logo

CSS
.marquee-logo-link > svg {
    background-color: ${black} !important;
}

================================

estadao.com.br

INVERT
#puzzleHolder
.puzzleField

================================

etherrag.blogspot.com

CSS
body {
    background-color: var(--darkreader-neutral-background) !important;
    background-image: none !important;
}

================================

etsy.com

INVERT
.banner-container
.secondary-banner-title
.wt-radio label::before
.review-star.rating:not(.lit)
div.rating.nolit:not(:hover) > .ss-star

================================

eu.community.samsung.com

INVERT
img[alt="search icon"]

================================

eukhost.com

INVERT
.navbar-brand

================================

everdermlaser.hu

INVERT
.icon-salient-cart
.icon-salient-m-user

================================

evernote.com

INVERT
.global-logo svg

================================

evga.com

INVERT
.evga-logo-box

CSS
.product-specs .RadTabStrip .rtsLI .rtsLink {
    background-image: none !important;
}

================================

ewybory.eu

INVERT
.navbar-brand

================================

excel.officeapps.live.com
*.officeapps.live.com

INVERT
.ewr-sheettable

CSS
#ceROOT_ELEMENT-0 > path.MSChart-HighContrast,
#ceId6_ > path.MSChart-HighContrast {
    fill: ${rgb(232, 230, 227)} !important;
}
.ewa-gridKeyHandler[style*="background-color: rgb(255, 255, 255)"] {
    background-color: var(--darkreader-neutral-background) !important;
}

================================

exercism.org

INVERT
.header-intro .c-icon
svg.rough-annotation

CSS
header.c-header-with-bg {
    background: var(--darkreader-neutral-background) !important;
}
.theme-light {
    --darkreader-bg--page-dashboard-background-image: none;
}

================================

exmo.me

INVERT
canvas

================================

expedia.com

INVERT
.uitk-header-brand-logo

================================

experian.com

INVERT
.logo

================================

experiencia.xpi.com.br

INVERT
#yield-portal-header a.xpi__header__logo svg path
#yield-portal-header a.xpi__error__logo svg path
#chart-profitability > div:nth-child(2) > svg > g > g:nth-child(2) > g:nth-child(1) > g > g > g > g:nth-child(2) > g > g:nth-child(1) > g:nth-child(2) > g:nth-child(2) > g > text > tspan

CSS
#chart-patrimony g[role='menu'] ~ g tspan {
    color: var(--darkreader-neutral-text) !important;
}

================================

explainxkcd.com

INVERT
.mwe-math-fallback-image-inline
.mwe-math-fallback-image-display
.mw-ext-score
.main-footer-menuToggle
img[src*="Loudspeaker.svg"]
img[alt="The Signpost"]

CSS
.diff-addedline .diffchange {
    background-color: ${lightblue} !important;
}
.diff-deletedline .diffchange {
    background-color: ${#feeec8} !important;
}

IGNORE INLINE STYLE
.legend-color
.infobox > tbody > tr > td[style*="background-color"]

================================

expressjs.com

CSS
body {
    background-image: none !important;
}

================================

extra.com.br

CSS
.product-card__image {
    mix-blend-mode: normal !important;
}

================================

ezgif.com

INVERT
#logo

================================

ezschoolpay.com

CSS
.menuSideLabelSubHeader,
.forgotPassword,
.rememberMeCell > label,
.rmText {
    color: var(--darkreader-selection-text) !important;
}

================================

f-droid.org

INVERT
.anti-feature-icon

================================

faasafety.gov

CSS
#navigation .rightBorder,
#footer {
    background: ${white} !important;
}
body {
    background-image: none !important;
}

================================

facebook.com

INVERT
._2o89
._2q08
.sx_af7fe0
.sx_7ed17e
.sx_a4a936
.sx_4d607f
.sx_aca067
.sx_77228a
.sx_51302f
._2yu5
._3iiv
._3pao
.kv0qyzoi
.sx_426ea6
.sx_b77acf
._2gb3
._7sjb
.sx_b9f33b
.sx_2e7846
.sx_6d18f4
.monochrome
.repliedLast
.sx_73ef60
._81u_ .img
._3ffs li
#profile_intro_card_bio i
.uiScrollableAreaWrap .uiList button[type="submit"] i._3-8_
.editPhoto i._3-8_
.sx_08856a
.sx_ac12f7
.sp_hk4DJV_EEeW
.sp_V53xxlprDHX_1_5x
.sp_V53xxlprDHX_2x
#pagelet_ego_pane button .img._3-8_
#homepage_panel_promote_footer_pagelet button .img._3-8_
#event_tabs #reaction_units span img
.fbPlaceFlyoutWrap img
._83aj
._7xv1
._83ak
._8g4q

CSS
.fbNubButton {
    background-image: none !important;
}
.jewelItemNew ._33e {
    background-color: ${#d0d1d3} !important;
}
.sx_cf4e6b {
    filter: brightness(250%) !important;
}
._34k2 {
    filter: brightness(1000%) !important;
}
._3hx- ._4tdt,
._3hx- ._5wd4,
._3hx- ._6vu5 ._5w-5,
._3hx- ._1aa6::after,
._3hx- ._6vu5 ._31o4,
._3hx- ._2cnu:only-of-type ._5wdf,
._3hx- ._5w0o,
._3hx- ._5z-5,
._3hx- ._16ys._3e7u,
._3hx- ._49or .__6j,
._3hx- ._324d .__6j,
._llj {
    border-color: ${#eee} !important;
}
._3hx- ._ua1,
._3hx- ._40qi,
._3hx- ._5ye6,
._3hx- ._llj,
._3hx- ._1a6y,
._31o4,
._3_bp,
._4gd0,
._49or,
._40fu {
    background-color: ${#eee} !important;
}
.fbNub._50mz .fbNubFlyoutFooter::after {
    background-color: ${rgba(0, 0, 0, .15)} !important;
}
.fbNub._50mz .fbNubFlyoutInner,
._4cd8 ._69pt,
._4mq3 .fbNubFlyout,
._4mq3 .fbNubButton {
    box-shadow: 0 0 0 1px ${rgba(0, 0, 0, .15)} !important;
}
.__fb-light-mode {
    --filter-blue-link-icon: invert(73%) sepia(29%) saturate(200%) saturate(200%) saturate(200%) saturate(200%) saturate(200%) saturate(200%) saturate(103.25%) hue-rotate(189deg) brightness(101%) contrast(101%) !important;
    --filter-disabled-icon: invert(100%) opacity(30%) !important;
    --filter-negative: invert(25%) sepia(33%) saturate(200%) saturate(200%) saturate(200%) saturate(200%) saturate(200%) saturate(200%) saturate(110%) hue-rotate(345deg) brightness(132%) contrast(96%) !important;
    --filter-placeholder-icon: invert(59%) sepia(11%) saturate(200%) saturate(135%) hue-rotate(176deg) brightness(96%) contrast(94%) !important;
    --filter-positive: invert(37%) sepia(61%) saturate(200%) saturate(200%) saturate(200%) saturate(200%) saturate(115%) hue-rotate(91deg) brightness(97%) contrast(105%) !important;
    --filter-primary-icon: invert(100%) !important;
    --filter-secondary-icon: invert(62%) sepia(98%) saturate(12%) hue-rotate(175deg) brightness(90%) contrast(96%) !important;
    --filter-warning-icon: invert(77%) sepia(29%) saturate(200%) saturate(200%) saturate(200%) saturate(200%) saturate(200%) saturate(128%) hue-rotate(359deg) brightness(102%) contrast(107%) !important;
}
.__fb-light-mode {
    --darkreader-border--messenger-card-background: var(--darkreader-bg--messenger-card-background) !important;
}
.__fb-dark-mode {
    --darkreader-border--messenger-card-background: #1c1e20 !important;
}
div[role=article] div.k4urcfbm[aria-hidden="true"] {
    --darkreader-inline-bgcolor: none !important;
    background-blend-mode: color;
    background-color: rgba(0, 0, 0, 0.25);
}
div[data-pagelet="Stories"] .ha302278 {
    background-color: rgba(0, 0, 0, 0.4) !important;
}
div[aria-label="Change volume"] .ha302278,
div[aria-label="Change Position"] .ha302278,
._3paq {
    background-color: rgba(255, 255, 255, 0.4) !important;
}
.r4vyqqch {
    background-color: var(--fds-white-alpha-50) !important;
}
.lyi53s4r {
    background-color: rgba(88,144,255,.9) !important;
}
.tdjehn4e,
.oo1teu6h {
    background-color: rgba(255, 255, 255, 0.1) !important;
}
.tdjehn4e:hover,
.ovq5dppa:hover {
    background-color: rgba(255, 255, 255, 0.2) !important;
}
.k19f6yf2 {
    background-color: var(--press-overlay) !important;
}
.cxbav39q {
    background-color: rbga(0, 0, 0, 0.8) !important;
}
.rnr61an3 {
    background-color: var(--hover-overlay) !important;
}
.qbubdy2e {
    fill: none !important;
}
.s1i5eluu {
    background-color: var(--primary-button-background) !important;
}
.q66pz984 {
    color: var(--accent);
}
.esnais5j,
._8bb_ img,
._8bb_ i,
._8bb_ video,
._8bb_ ._w80,
._8bb_ ._7umt ._47yj,
._8bb_ [style*='background-image: url'] {
    filter: none !important;
}
div[role="button"] > i.hu5pjgll:not(.sp_Jc8OKpJq5NW, .sp_T89CCTT7d9Z),
a[role="link"] > i.hu5pjgll,
._3w97,
svg[role="presentation"] {
    filter: var(--filter-secondary-icon) !important;
}
._2yua,
._3pas {
    background-color: #888 !important;
}
._2yu8 {
    background-color: rgba(255, 255, 255, .5) !important;
}
.leaflet-map-pane img[src*="theme=default"],
[style*="map"][style*="theme=default"],
._8bb_ img[src*="/map"],
._8bb_ [style*="map"],
img[src*="mapy.cz"],
._8bb_ img[src*="mapy.cz"],
img[src*="%2Fmap"],
._8bb_ img[src*="%2Fmap"],
img[src*="map.php"],
._8bb_ img[src*="map.php"],
img[src*="www.traseo.pl%2Froute"],
._8bb_ img[src*="www.traseo.pl%2Froute"] {
    filter: invert(100%) hue-rotate(180deg) !important;
}
.j7vl6m33 {
    fill: var(--always-white) !important;
}
::after {
    border-bottom-color: #1c1e20 !important;
    border-left-color: #1c1e20 !important;
    border-right-color: #1c1e20 !important;
    border-top-color: #1c1e20 !important;
}
.x1g6sh6t {
    fill: none !important;
}
div[style*="background-image"] {
    text-shadow: rgb(40, 43, 54) 0px 0px 3px !important;
}
.x1qhmfi1 {
    background-color: rgba(255,255,255,.1) !important;
}

IGNORE INLINE STYLE
[role="button"] svg
[role="button"] svg line
div svg[viewBox="0 0 36 36"] mask path
mask > rect
mask > circle
g > rect
.html-div svg path

IGNORE IMAGE ANALYSIS
*

================================

fairhotel.org

INVERT
.btn-close
.gm-ui-hover-effect > span
.navbar-brand > img

================================

fairtradeoriginal.*

INVERT
.SiteLayout
.SiteLayout > *
.Inset-image

================================

fairvote.org

CSS
.bg-dark-red {
    background-color: rgb(229 89 80/var(--tw-bg-opacity)) !important;
}
.bg-primary,
.header-navigation > nav#desktop-nav .nav-backdrop,
.header-navigation > nav#desktop-nav > ul > li > .content-link:after {
    background-color: rgb(71 24 120/var(--tw-bg-opacity)) !important;
}
.header-navigation > nav#desktop-nav .submenu ul.menu-list.third-level > li {
    border-color: rgb(255 255 255/var(--tw-border-opacity)) !important;
}

================================

fakespot.com

INVERT
.fs-logo
.logo
.logo-click
.press-logo-container
.app-button > img
img[alt="Header menu"]

================================

fakt.pl

INVERT
.header-links

================================

fallout.wiki

INVERT
.cosmos-actions-talk svg
img[src*="Hat_arrow.png"]

CSS
@media screen and (min-width: 850px) {
    body::after {
        z-index: 0 !important;
    }
}
.user-anon #cosmos-banner {
    position: sticky !important;
}
.k-player .control-bar {
    background: var(--darkreader-neutral-background) !important;
}

================================

fanatical.com

INVERT
.trustpilot > .logo-container > a > img

IGNORE INLINE STYLE
div.drm-container svg g

================================

fandom.com
*.fandom.com

INVERT
.mobile-global-navigation__logo
.wds-global-navigation__logo-fandom
a[href^="https://auth.fandom.com/auth/redirect?redirect="][data-test="back-button"]
.mwe-math-element

CSS
body {
    background-color: var(--darkreader-neutral-background) !important;
}
#mixed-content-footer,
.community-header-wrapper,
.top-ads-container,
.bottom-ads-container,
.global-footer {
    z-index: 1 !important;
}
.fandom-community-header__background.cover {
    z-index: 0 !important;
}
a[href^="https://auth.fandom.com/auth/redirect?redirect="][data-test="back-button"] {
    color: ${white} !important;
}

IGNORE INLINE STYLE
.wds-global-navigation__logo-image g path
.wds-global-footer__header-logo g path
.wds-global-footer__link svg g path
symbol[id^="wds-brand-other"] *

================================

fanfiction.net

CSS
#content_wrapper_inner,
#p_footer,
body,
.content_wrapper_inner,
.lc-left,
.lc,
.xcontrast_outer,
.zmenu {
    background-color: var(--darkreader-neutral-background) !important;
    background-image: none !important;
}
.btn {
    background-image: none !important;
}
#search_keywords,
select {
    background-color: var(--darkreader-neutral-background) !important;
}

IGNORE INLINE STYLE
body

================================

fantasy.premierleague.com

INVERT
.ism-table

================================

farside.ph.utexas.edu
mathpages.com
mathprofi.ru
mathprofi.net
mathworld.wolfram.com
reference.wolfram.com
terrytao.wordpress.com
wolframalpha.com

INVERT
img:not([src^="/_next/static/images/"])

================================

fast.com

INVERT
div.logo
div.powered-by

IGNORE IMAGE ANALYSIS
div.logo
div.powered-by

================================

fastcomments.com

CSS
.dark .menu-content div > i {
    filter: invert(0) !important;
}

IGNORE IMAGE ANALYSIS
.icon.edit-small
.icon.img-up
.icon.ul
.icon.bubble

================================

fastmail.com

INVERT
.logo svg

================================

fastmail.com/mail

CSS
.app-listItem.is-focused,
.app-source.is-selected {
    background-color: ${lightgray} !important;
}
.app-source.is-focused {
    background-color: ${lightblue} !important;
    color: ${black} !important;
}
.v-MailboxItem-unreadbadge {
    background-color: ${darkblue} !important;
}
.v-Message-body {
    border-color: transparent !important;
}

================================

fatmap.com

CSS
.activity-filter-single-click svg.icon {
    fill: ${black} !important;
}
.stats-container-small svg.ruler-icon {
    fill: ${#333} !important;
}

IGNORE INLINE STYLE
svg.icon

================================

fau.de

INVERT
.baselogo

CSS
.accordion-toggle:not(.active) {
    background-color: ${lightgrey} !important;
}
.accordion-toggle.active,
.accordion-toggle:hover {
    background-color: #032755 !important;
}

================================

fax.plus

INVERT
img[src$="_info.svg"]

================================

fckng-serious.de

INVERT
.logo

================================

fcmed.pl

INVERT
.mkd-logo-wrapper
a[href*="tel"]
.mkd-sidearea > .textwidget > a > img
.owl-wrapper

================================

fedex.com

CSS
.fx-global-prelog-link.fx-showlogin span {
    background-image: none !important;
}

================================

fedica.com
account.fedica.com

INVERT
.topleftLogo

================================

fedoraforum.org

INVERT
.logo-image

================================

feedly.com

CSS
.entry.u0:hover,
.entry--selected.u0,
.entry--selected.u0:hover,
.entry--selected.u4,
.entry--selected.u5,
button.secondary:hover {
    background-color: ${#ccc} !important;
}

================================

festivals.mt

CSS
body :not(iframe) {
    background-color: ${rgba(255,255,255,0.05)} !important;
}
div[data-testid="responsive-container-overflow"] {
    background-color: var(--darkreader-neutral-background) !important;
}
.wixui-mobile-menu__icon .XLAVDo div {
    background-color: var(--darkreader-neutral-text) !important;
}
a[href="http://www.festivals.mt"] svg * {
    fill: var(--darkreader-neutral-text) !important;
}

================================

feynmanlectures.caltech.edu

INVERT
.figure > img[src$=".svgz"]

================================

ffmpeg.zeranoe.com

INVERT
.active

================================

fgo.gamepress.gg

CSS
.TLW-tier-charname {
    color: ${black} !important;
}
#content-inner {
    background-image: none !important;
}

================================

fibermap.it

INVERT
img[src$="assets/images/bg-cloud.png"]

================================

figma.com

CSS
:root,
.blog-body {
    --darkreader-bg--global-bg-color: var(--darkreader-neutral-background) !important;
    --darkreader-text--global-color: var(--darkreader-neutral-text) !important;
    --global-bg-color: var(--darkreader-neutral-background) !important;
    --global-color: var(--darkreader-neutral-text) !important;
}

IGNORE INLINE STYLE
div[class*="paint_panels--chit"]
div[class*="modal--modalShadow"] div
.blog-body

================================

fileformat.info

INVERT
[src$="logo_wide.png"]
.thumbnail

CSS
body {
    background-color: var(--darkreader-neutral-background) !important;
    background-image: none !important;
}

================================

filetransfer.io

INVERT
a.logo

================================

filmweb.pl

INVERT
.ribbonLbl
.isInit.ribbon[data-state="1"]::after
.isInit.ribbon[data-state="2"]::after
.isInit.ribbon[data-state="3"]::after
.isInit.ribbon[data-state="4"]::after
.isInit.ribbon[data-state="5"]::after
.isInit.ribbon[data-state="6"]::after
.isInit.ribbon[data-state="7"]::after
.isInit.ribbon[data-state="8"]::after
.isInit.ribbon[data-state="9"]::after
.isInit.ribbon[data-state="10"]::after

CSS
.filmInfo__info {
    color: var(--darkreader-neutral-text) !important;
}

================================

filterlists.com

IGNORE INLINE STYLE
header.ant-layout-header img

================================

final-fantasy.ch

CSS
nav ul li:first-child span,
h1 {
    color: #000 !important;
}
input[type="submit" i],
input[type="file" i] {
    background-color: ${#c7c7c7} !important;
    color: var(--darkreader-neutral-text) !important;
}

================================

finn.no

INVERT
finn-footer
article.ads__unit overflowmenu-active

IGNORE INLINE STYLE
svg *

================================

fio.fnar.net

INVERT
.chartjs-render-monitor

================================

firebase.google.com

INVERT
.devsite-site-logo

CSS
.c5e-input-container input[type="text"],
.c5e-input-container input[type="password"],
.c5e-input-container input[type="url"],
.c5e-input-container input[type="number"],
.c5e-input-container input[type="email"],
.c5e-input-container input[type="search"],
.c5e-input-container input[type="time"],
.c5e-input-container input[type="tel"],
.c5e-input-container md-select,
.c5e-input-container mat-select,
.c5e-input-container textarea {
    color: var(--darkreader-bg--fire-color-grey-primary) !important;
}

================================

firefox.com

INVERT
.fx-bento-app-link.fx-bento-link.fx-mobile > span::before

================================

firefox.net.cn

CSS
.btn,
.core_follow,
.pop_deep .ct dt.reward,
.pages a,
.pages strong,
.design_mode_edit,
.pop_showmsg {
    background-image: none;
}

================================

firstcontributions.github.io

CSS
.App,
.topnav {
    background-color: ${CornflowerBlue};
}

================================

fitgirl-repacks.site

INVERT
img[src*="https://torrent-stats.info/"]
.widget_block a[href="https://fitgirl-repacks.site/games-with-my-personal-pink-paw-award/"]

CSS
div.entry-content div {
    background-blend-mode: multiply !important;
    background-color: ${rgba(255,255,255,0.85)} !important;
}

================================

fivepost.ru/o

CSS
svg[class^="OrderQRCode__StyledQRCode"] {
    background-color: var(--darkreader-neutral-text) !important;
}
svg[class^="OrderQRCode__StyledQRCode"] > path[fill="#000000"] {
    fill: var(--darkreader-neutral-text) !important;
}

================================

fiverr.com

IGNORE INLINE STYLE
.site-logo *

================================

fivethirtyeight.com
*.fivethirtyeight.com

INVERT
.logo
.abclogo
.site-logo
#searchform
.header-espn-link

CSS
.domain,
.win-prob,
.winSentText {
    stroke: none !important;
}

================================

flaggenlexikon.de

INVERT
img[src="https://www.flaggenlexikon.de/pix/flaggenlexikon.gif"]

CSS
body {
    background-image: none;
}
[background="higru.gif"] {
    background: var(--darkreader-neutral-background);
}

================================

flashscore.com.tr

INVERT
.header__logo

================================

flatuicolors.com

IGNORE INLINE STYLE
.color

================================

flcu.org
*.flcu.org

INVERT
a.brand img
.logo img

CSS
a[href="https://flcu.org/resources/solutions/make-a-payment/"] {
    color: var(--darkreader-neutral-text) !important;
}
.nav-menu-popover__background {
    background-color: var(--darkreader-background-f2f2f2) !important;
}
.irisv-button[type="submit"]:not([aria-disabled="true"]) {
    background-color: rgb(var(--colorBrandedAffordance)) !important;
    color: white !important;
}
.irisv-textfield--filled .irisv-textfield__control {
    background-color: ${lightgray} !important;
}

================================

flightfinder.fi

INVERT
.logo

================================

flipslibrary.com

CSS
:root {
    --main-background: var(--darkreader-neutral-background) !important;
    --sidebar-background: var(--darkreader-neutral-background) !important;
}

================================

flow.polar.com

INVERT
.brand
.detail-data-panel__icon
.sleep-chart-yaxis.end
.supergraph-canvas

CSS
.highcharts-container svg {
    fill: ${#3f3f3f} !important;
}
.card__item-icon--rounded img {
    background-blend-mode: color;
    background-color: rgba(255, 255, 255, 0.15) !important;
}
.altitudetitle,
.altdescmax,
.altdescmin,
.zonedesctitle,
.zonedescmax,
.zonedesclight,
.maxhighlightval,
.maxhighlightname {
    color: rgb(0, 0, 0) !important;
}
.highcharts-background {
    fill: none !important;
}

IGNORE INLINE STYLE
.zonebox
.zonestartbox
stop

================================

flowkey.com

INVERT
body.front #zone-branding-wrapper

CSS
body.html #page.page #subslogan {
    color: ${white} !important;
}

================================

fly.io

CSS
.bg-custom {
    background-image: none !important;
}
.post :not(a):not(pre):not(.changelog-item) > code {
    mix-blend-mode: normal !important;
}

================================

flybywiresim.com

CSS
.opacity-90 {
    opacity: .4 !important;
}
.-z-10 {
    z-index: 0 !important;
}
.from-primary\/30 {
    --darkreader-bg--tw-gradient-from: #181a1b !important;
    --darkreader-bg--tw-gradient-to: #181a1b !important;
}

================================

flyzipline.com

INVERT
#logo

IGNORE IMAGE ANALYSIS
#logo

================================

foli.fi

INVERT
a[title="Etusivu"] svg
a[title="Home"] svg
a[title="Huvudsida"] svg
button svg
nav g > g:nth-child(1)

================================

follow.it

INVERT
.header-logo
.logo

================================

fontawesome.com

CSS
#icons-header,
#docs-header,
#hero > div:not(.container),
.app-content.docs {
    background-color: var(--darkreader-neutral-background) !important;
}
.doc-nav > div {
    background-color: var(--darkreader-bg--background-norm) !important;
}
#search-header {
    background-color: var(--darkreader-neutral-background) !important;
}

================================

fontsinuse.com

INVERT
.fiu-header__branding
.fiu-sample-list__item img
.fiu-gallery-head__text img

================================

fontspring.com

INVERT
.grid6 .fullwidth

================================

fontsquirrel.com

INVERT
.fontlistitem

CSS
#main_content_container {
    background-image: none !important;
}

================================

foobar2000.org

INVERT
img[src="/foobarlogo.png"]

================================

food4less.com

INVERT
img[alt="Food4less logo"]

================================

foolcontrol.org

CSS
html {
    background-color: transparent !important;
}

================================

foragerproject.com

INVERT
.product-icons .icon
.navbar-brand

================================

forem.com

INVERT
nav a > img[alt="Home"]
#cta > section > div > div > img

================================

forms.reform.app

INVERT
.logo

CSS
svg.text-white {
    color: var(--darkreader-neutral-background);
}

================================

forms.yandex.ru

INVERT
.header2__service-logo
.header2__logo-wrap

================================

forsal.pl

INVERT
.serviceLogo
.homePageUrl

CSS
.mini-tabs {
    background-color: var(--darkreader-neutral-background) !important;
}

================================

forum.canardpc.com

CSS
.widget-tabs .widget-tabs-nav li,
.widget-tabs .widget-tabs-nav .ui-tabs-nav,
.view-mode .widget-tabs .widget-tabs-nav {
    background: var(--darkreader-neutral-background) !important;
}

================================

forum.dobreprogramy.pl

INVERT
#site-logo

================================

forum.donanimhaber.com

CSS
body {
    background-color: var(--darkreader-neutral-background);
}

================================

forum.eset.com
forum.ithardware.pl
forum.kaspersky.com
forums.getpaint.net
forums.laptopvideo2go.com
forums.warframe.com
nieidealny.pl/forum

INVERT
.ipsBadge_highlightedGroup
.ipsBadge_icon
.ipsBadge_popular
.ipsComment_authorBadge
.ipsItemStatus.ipsItemStatus_custom.ipsItemStatus_read
.ipsReact_button
img[alt="Forum komputerowe ITHardware"]
img[alt="paint.net Forum"]

CSS
.ipsBadge {
    --darkreader-bg--badge--background: var(--darkreader-neutral-background) !important;
}
.ipsReact_reactCount > a,
.ipsReact_reactCount > span,
.elFullInbox_menu,
.ipsHovercard,
.ipsList_reset,
.ipsMenu_auto,
.ipsMenu_footerBar,
.ipsMenu_headerBar,
.ipsMenu_innerContent,
.ipsMenu_item,
.ipsMenu_sep,
.ipsMenu_title,
.ipsPadding,
.cUserHovercard,
a[data-mentionid] {
    background-color: var(--darkreader-neutral-background) !important;
}

================================

forum.ivao.aero

INVERT
.buttonlist

CSS
.cat_bar,
.cat_bar > *,
.catbg > * {
    background-color: var(--darkreader-neutral-background) !important;
    background-image: none !important;
    color: var(--darkreader-neutral-text) !important;
}
:not(a) > span,
:not(a) > span > *,
#footer {
    background: none !important;
}
.buttonlist a:not(.active) {
    color: var(--darkreader-neutral-background) !important;
}
ul.dropmenu li {
    background: var(--darkreader-neutral-background) !important;
    border: none !important;
}
ul.dropmenu ul {
    background: var(--darkreader-neutral-background) !important;
    border: 1px solid var(--darkreader-neutral-text) !important;
}

IGNORE INLINE STYLE
#header

================================

forum.kaosx.us

INVERT
.Header-logo

CSS
.Dropdown-toggle,
.item-refresh > Button,
.DiscussionList-loadMore > Button,
.LogInButton--github,
.Button--icon {
    background: ${#6f7f92} !important;
    color: ${black} !important;
}

================================

forum.manjaro.org

CSS
.below-footer-outlet.custom-footer {
    background-image: none !important;
}

================================

forum.miranda-ng.org

CSS
.firstlevel {
    color: ${#666666} !important;
}

================================

forum.p300.it

CSS
.ipsReact_reactCount > a {
    background-color: var(--darkreader-neutral-background);
    border-color: var(--darkreader-neutral-text);
}
.ipsType_normal {
    border-color: rgb(48,52,54);
}
.ipsMenu_headerBar,
.ipsMenu_footerBar,
.ipsEmoticons_category,
.ipsMenu_innerContent,
ul.ipsMenu,
.ipsMenu > ul,
a[data-mentionid],
.cUserHovercard {
    background-color: var(--darkreader-neutral-background) !important;
}

================================

forums.ankiweb.net

CSS
#user-content {
    background: transparent;
}

================================

forums.comodo.com

INVERT
.windowbg span.topslice
.windowbg span.botslice
.windowbg2 span.topslice
.windowbg2 span.botslice

CSS
body {
    background-image: none !important;
}
.buttonlist ul li a span:not(:hover) {
    color: ${white} !important;
}

================================

forums.gearsofwar.com

IGNORE IMAGE ANALYSIS
body

================================

forums.mydigitallife.net

IGNORE INLINE STYLE
#TotpQrCode

================================

forums.opera.com

INVERT
.forum-logo-wrapper

================================

forums.operationsports.com

INVERT
i
.smallfont
strong

================================

forums.stardock.com

IGNORE IMAGE ANALYSIS
.body .forum > .post .postcontainer .postinfo .menu .karma_badge

================================

forums.tomshardware.com

INVERT
img[src="/styles/tomshardware/tomshardware/toms-hardware-logo.png"]
div.trophyShowcase.trophyShowcase--postbit

================================

forvo.com

INVERT
img[src$="layout/logo.svg"]

================================

fotor.com

INVERT
div[style^="background-image: url(\"https://imgv3.fotor.com/images/background/background-image.png\");"]
div[style^="background-image: url(\"https://imgv3.fotor.com/images/background/background-image.png\");"] > *

================================

fotw.info

CSS
body {
    background-image: none !important;
}

================================

foundation.rust-lang.org

CSS
.peoplelist li {
    background-position: center;
    background-size: cover;
}

================================

framatube.org

INVERT
.vjs-load-progress
.vjs-play-progress
.vjs-play-progress::before

================================

frame.work

INVERT
a[title="Framework Home"] > img[alt="Framework"]
#site-logo
[type="checkbox"].checkbox-black:checked

================================

fredmeyerjewelers.com

INVERT
#header1_mainlogo
.mobileNavIcons img
.mobileNavIcons input:not(.searchdesktop)

================================

freebsdfoundation.org

CSS
.content-wrapper {
    background-image: none !important;
}

================================

freecodecamp.org

CSS
.video-quiz-selected-input {
    background-color: var(--darkreader-neutral-text) !important;
}
.progress-bar-percent {
    background-color: ${gray} !important;
}
.map-title polygon {
    fill: var(--darkreader-neutral-text) !important;
}
.map-badge circle {
    fill: var(--darkreader-neutral-background) !important;
}

================================

freecommander.com

CSS
.am-body,
#subsilver-nav-topic {
    background-image: none !important;
}
.forabg,
.forumbg,
.header > .row-item,
.body-blok-h3 h3 {
    background: var(--darkreader-neutral-background) !important;
}

================================

freedom.press

INVERT
.logo-heading-text

================================

freelancer.com

INVERT
.LogoImg[src*="freelancer-logo.svg"]

================================

freemaptools.com

INVERT
img[src="images/freemaptools-logo.jpg"]

CSS
body {
    background-image: none !important;
}

================================

freesound.org

CSS
#search input:not(#search_submit) {
    background-color: var(--darkreader-neutral-background) !important;
}

================================

freetp.org

CSS
html,
body,
.wmid,
.wfoot {
    background-image: none !important;
}
html,
body {
    background-color: var(--darkreader-neutral-background) !important;
}

================================

fresha.com

INVERT
a[aria-label="Fresha"]

================================

freshprep.ca

INVERT
img.logo

CSS
.recipe .product-image {
    z-index: 0 !important;
}

================================

fritz.box

INVERT
div.formular input[type="radio"]
div.formular input[type="checkbox"]

CSS
div.formular input[type="radio"],
div.formular input[type="checkbox"] {
    background-color: transparent !important;
}
#navigationMenu {
    background: linear-gradient(--darkreader-bg--charcoal-gray-20: 30%, rgba(255, 255, 255, 0)) center top,linear-gradient(rgba(255, 255, 255, 0), #1b1e1f 70%) center bottom,linear-gradient(var(--charcoal-gray-30), transparent) center top,linear-gradient(transparent, --darkreader-bg--charcoal-gray-20:) center bottom !important;
    background-attachment: local,local,scroll,scroll !important;
    background-repeat: no-repeat !important;
    background-size: 100% 1.2rem,100% 1.2rem,100% .5rem,100% .5rem !important;
}

================================

fs.blog

INVERT
.shared-counts-icon

CSS
body,
.header-box {
    background-color: var(--darkreader-neutral-background) !important;
}

================================

fsfe.org

INVERT
#logo

CSS
body {
    background-image: none !important;
}

================================

ftp.nluug.nl

INVERT
img[alt="[NLUUG]"]

================================

fullstackopen.com

CSS
.gatsby-highlight-code-line {
    background-color: ${hsla(0,0%,48.2%,.3)} !important;
}

================================

funpay.ru

INVERT
.logo-color
.logo

================================

furrychina.com

INVERT
.main_logo

================================

fusoya.eludevisibility.org

CSS
body {
    background-image: none !important;
}
td {
    background-image: none !important;
    color: var(--darkreader-neutral-text) !important;
}

================================

futar.bkk.hu

INVERT
.mapboxgl-map

================================

futureplc.com

INVERT
img[src$="future-logo.svg"]

================================

fyziklani.*
online.fyziklani.cz
physicsbrawl.org

IGNORE IMAGE ANALYSIS
.flag-icon-bg
.flag-icon-co
.flag-icon-fi
.flag-icon-jp
.flag-icon-kr
.flag-icon-lt
.flag-icon-pl
.flag-icon-ru
.flag-icon-sk

================================

fz-juelich.de

CSS
body {
    background-image: none !important;
}

================================

gadzetomania.pl

CSS
a svg path[d^="M12.881 14.785v-"] {
    fill: #fff !important;
}

================================

gain.tv

CSS
.body-new-index .hero-img-container {
    z-index: 0 !important;
}

================================

gameinformer.com

INVERT
.site-logo

================================

gameranx.com

CSS
body {
    background-color: var(--darkreader-neutral-background) !important;
}
.mai-toc__listitem,
.mai-toc__details,
.mai-toc-default .mai-toc__summary {
    background-color: ${#f7f7f7} !important;
}

================================

gamerevolution.com

INVERT
.wp-block-xwp-curated-content__card-title
.wp-block-xwp-curated-content__card-excerpt
.wp-block-xwp-curated-content__card-footer
.wp-block-xwp-curated-content__title
.xe-footer-nav__menu
.xe-footer-social-nav__menu
.xe-site-footer__bottom-column-2
#h-featured

================================

gamesindustry.biz

INVERT
.logo

================================

gamestop.com

INVERT
.nav-logo

================================

garmin.com
*.garmin.com

INVERT
.gh__logo
.map-controls.player .pause span
.recharts-dot
.highcharts-plot-line-label

CSS
.recharts-wrapper text {
    fill: ${rgba(0, 0, 0, 0.75)} !important;
}
span[class*="Carousel_carouselHighlightedDot"] {
    background-color: ${rgba(0, 0, 0, 0.75)} !important;
}
span[class*="Gc5ChallengesCard_progressBar"] div[class*="ProgressBar_bar__"],
span[class*="DayView_progressBar"] div[class*="ProgressBar_bar__"] {
    background: ${black} !important;
}
.find-plan-filters button {
    background-color: var(--darkreader-neutral-background) !important;
}
.plan-section-label {
    color: var(--darkreader-neutral-text) !important;
}
.plan-info,
.plan-specs {
    background-color: var(--darkreader-neutral-background) !important;
    border-color: transparent !important;
    color: var(--darkreader-neutral-text) !important;
}

================================

gasbuddy.com

INVERT
.pin
.pin-small

CSS
.VehicleRecallSearchBar-module__searchBar___3EjPt .VehicleRecallSearchBar-module__dropDown___23Uqi button {
    background-color: var(--darkreader-neutral-background) !important;
}

================================

gat.no

INVERT
figure.logo > img

CSS
main.container .every_board > .row:not(.row--takeover) {
    --front-background-color: var(--darkreader-neutral-background) !important;
}

================================

gatsbyjs.com

INVERT
.ais-InfiniteHits-item

CSS
.gatsby-highlight,
.language-text {
    background-color: var(--darkreader-neutral-background);
}

================================

gazeta.pl
plotek.pl
sport.pl
edziecko.pl
moto.pl
ukrayina.pl

INVERT
img[alt^="logo"]
.vs__actions
a.item.noSwiper img
.navigation__logo

CSS
.top_section_bg,
.bottom_section_bg {
    background-color: ${#e5e5e5} !important;
}
svg [id="Group_242"],
svg [id="Path_9914"] {
    fill: ${black} !important;
}

================================

gazetaprawna.pl

INVERT
.bubbleMenuHamburger
.homePageUrl
.serviceLogo
.servicesMenu #menuTrigger span

================================

gazetaswietokrzyska.pl

INVERT
.logo

CSS
.elementor-column-wrap.elementor-element-populated {
    background-color: var(--darkreader-neutral-background) !important;
}

================================

geekflare.com

INVERT
.logo

================================

geeksforgeeks.org

CSS
.gsc-input-box {
    box-shadow: ${rgba(0, 0, 0, 0.3)} 0px 0px 2px !important;
}

================================

geeksonsite.com

CSS
#page-content {
    background: var(--darkreader-neutral-background) !important;
}

================================

geizhals.*
skinflint.co.uk
cenowarka.pl

CSS
img,
.mocat-item__image,
.primary-nav .nav-item-type-cat-image {
    mix-blend-mode: normal !important;
}

================================

generatorbible.com

CSS
.noUi-handle,
.noUi-target {
    border-color: #8c8273 !important;
}

================================

genius.com

INVERT
.texmath

================================

genome-euro.ucsc.edu

INVERT
td.tdData
.tdLeft

================================

genshin-impact-map.appsample.com

INVERT
.bg-secondary.px-1.py-0.input-group-text > .icon
.border-top2.text-center.w-100.sidebar-footer
.gm-ui-hover-effect

================================

gentoo.org

INVERT
.site-logo

================================

geogebra.org

INVERT
.icon-m
.elemText canvas
.gwt-Image
.gwt-StackPanelItem img
.GeoGebraMenuImage.menuImg
.menuImg
.buttonContent.stylebarButton
.EuclidianPanel > canvas
.stepTreeElem

================================

gestis.dguv.de

CSS
.v-application {
    background: var(--darkreader-neutral-background) !important;
    color: var(--darkreader-neutral-text) !important;
    display: flex;
}
#home-content-wrapper {
    background-blend-mode: multiply !important;
    background-color: ${rgba(255,255,255,0.65)} !important;
}

================================

get.google.*
get.google.*.*

INVERT
a[href*="about/products"]
span[aria-label="Settings"][role="menuitem"] path
span[aria-label="About Album Archive"][role="menuitem"] path
span[aria-label="Download photo"][role="menuitem"] path
span[aria-label="Manage in Google Photos"][role="menuitem"] path

================================

getalt.org

INVERT
.site-title

================================

getfedora.org

INVERT
img[alt="globe"]

================================

getlektor.com

CSS
.body-wrapper .container {
    background-color: var(--darkreader-neutral-background) !important;
}
pre {
    background-image: none !important;
}

================================

getmimo.com

INVERT
a[title="Home"][href] > svg
div[class^="FifthSection___StyledDiv8"] > svg
div[class^="Footer__Row"] > :nth-child(1) svg

CSS
login-container {
    background: var(--darkreader-neutral-background) !important;
}

================================

getpocket.com

CSS
p a[rel="noopener noreferrer"] {
    background-image: linear-gradient(to top,transparent,transparent 1px,var(--darkreader-text--color-canvas) 1px,var(--darkreader-text--color-canvas) 2px,transparent 2px) !important;
    text-shadow: none !important;
}

================================

getsol.us

INVERT
img[alt="Logo"]

================================

getsuperpowers.app

CSS
.bg-gradient-to-r {
    background-image: linear-gradient(to right,var(--tw-gradient-stops)) !important;
}

================================

gg.pl

INVERT
.chat-btns
.profile-close i
.settings-close i

CSS
.sr-contact-name span {
    background-image: none !important;
}

================================

ggmania.com

CSS
body {
    background-image: none !important;
}

================================

ghisler.com

INVERT
img[src$="bit.gif"]

================================

gigabyte.com

INVERT
.kf-vision
.kf-vision > *
.creator-vision
.creator-vision > *
.InnerGIGABYTEContent .scroll_bg_01
.InnerGIGABYTEContent .scroll_bg_01 > *
.InnerGIGABYTEContent .eagle_build_strong
.InnerGIGABYTEContent .eagle_build_strong > *

================================

git-scm.com

INVERT
img[alt="Git"]

CSS
body,
#masthead {
    background-image: none !important;
}

================================

github.com
github.*.*

INVERT
[src="https://github.githubassets.com/images/modules/site/icons/footer/github-logo.svg"]
[src^="https://github.githubassets.com/images/modules/site/home/community-sponsor-"]
[src^="https://github.githubassets.com/images/modules/site/home/community-readme-"]
[src^="https://github.githubassets.com/images/modules/site/home/community-discussions-"]
[src="https://github.githubassets.com/images/modules/site/home/dependabot-merge.png"]
[src="https://github.githubassets.com/images/modules/site/home/dependabot-pr.png"]
[src="https://github.githubassets.com/images/modules/site/home/gh-desktop.png"]
[src="https://github.githubassets.com/images/modules/site/home/pr-merge.png"]
[src="https://github.githubassets.com/images/modules/site/home/pr-comment.png"]
[src="https://github.githubassets.com/images/modules/site/home/pr-description.png"]
[src="https://github.githubassets.com/images/modules/site/home/pr-screen.png"]
[src="https://github.githubassets.com/images/modules/site/home/enterprise-city-w-logos.jpg"]
[src="https://github.githubassets.com/images/modules/site/codespaces/codespaces-icon.png"]
[src="https://github.githubassets.com/images/modules/site/codespaces/dependency-rust.png"]
[src="https://github.githubassets.com/images/modules/site/codespaces/dependency-3.png"]
[src^="https://github.githubassets.com/images/modules/site/codespaces/dependencies-"]
[src="https://github.githubassets.com/images/modules/site/codespaces/commit-3.png"]
[src="https://github.githubassets.com/images/modules/site/codespaces/extensions-1.png"]
[src="https://github.githubassets.com/images/modules/site/codespaces/extensions-2.png"]
[src="https://github.githubassets.com/images/modules/site/codespaces/commit-workflow.png"]
[src="https://github.githubassets.com/images/modules/site/codespaces/workflow-view.png"]
[src="https://github.githubassets.com/images/modules/site/codespaces/code.png"]
[src="https://github.githubassets.com/images/email/explore/explore-gradient-icon.png"]
[src="https://raw.githubusercontent.com/github/explore/80688e429a7d4ef2fca1e82350fe8e3517d3494d/collections/learn-to-code/learn-to-code.png"]
.js-viewport-aware-video.color-bg-primary.width-full.d-block.codespaces-hero-video
.build-in-animate.position-relative.mb-6-fluid.box-shadow-active-mktg.mx-auto.home-mobile-iphone.build-in-slideY.js-build-in > .js-viewport-aware-video.width-full
.overflow-hidden.position-relative.box-shadow-active-border-mktg.rounded-2-fluid.color-bg-primary.build-in-scale-fade.js-build-in-item
.build-in-animate.overflow-hidden.box-shadow-active-border-mktg.rounded-2-fluid.position-relative.home-workflow-comp.js-build-in-item
.mx-lg-auto.col-lg-7.col-12
#hero-section-brand-heading

CSS
.blob-code-inner,
.blob-num,
.cm-s-github-light .CodeMirror-lines,
.CodeMirror pre > span,
.CodeMirror,
.CodeMirror-dialog input,
.CodeMirror-hints,
.CodeMirror-linenumber,
.CodeMirror-lines,
.commit .sha,
.commit .sha-block,
.commit-desc pre,
.commit-ref,
.commit-tease-sha,
.export-phrase pre,
.file-info,
.FormControl-input.FormControl-monospace,
.FormControl-select.FormControl-monospace,
.FormControl-textarea.FormControl-monospace,
.input-monospace,
.markdown-body .footnotes .data-footnote-backref g-emoji,
.pr-1 > code > a,
.react-blob-print-hide,
.react-code-text,
.react-code-view-edit .cm-s-github-light .CodeMirror-lines,
.text-mono *,
.text-mono,
.two-factor-recovery-codes,
[aria-labelledby*="codemirror"] *,
[class*="blob-code"] *,
code > a[class="Link--secondary"],
section[aria-labelledby*="file-name-id"] > div > div *,
span.commit-ref > a > *,
span.commit-ref > a {
    font-family: ui-monospace, SFMono-Regular, "SF Mono", Menlo, Consolas, "Liberation Mono", monospace !important;
}
.markdown-body code,
.markdown-title code {
    background-color: ${rgba(27, 31, 35, 0.1)} !important;
}
.markdown-body pre code {
    background-color: transparent !important;
}
.refined-github .dashboard .js-all-activity-header + div {
    background-color: ${#e4e5e9} !important;
    border-color: ${#bbc1c9} !important;
}
.refined-github .dashboard-rollup-items .body {
    border-top-color: ${#bbc1c9} !important;
}
.refined-github .reaction-summary-item a {
    box-shadow: 0 0 0 2px ${white} !important;
}
.refined-github button.reaction-summary-item {
    border-bottom: rgb(77, 172, 253) !important;
    border-top-color: rgb(52, 59, 68) !important;
}
.js-site-search-form {
    background-color: #ffffff1a !important;
    border-radius: 2pt !important;
}
.blob-num:not(.cc-coverage-covered-border):not(.cc-coverage-missed-border) {
    border-right: 0 !important;
}
.cc-issue-description {
    color: #24292e !important;
}
.cc-readup-background {
    background-color: rgb(28, 30, 31) !important;
}
.cc-readup-content {
    border-left: 1px solid grey !important;
    color: rgb(216, 214, 208) !important;
}
.cc-readup-content blockquote {
    border-left: 3px solid dimgrey !important;
}
.cc-pr__link-text {
    color: darkgrey !important;
}
.cc-pr__tooltip {
    background-color: rgb(28, 30, 31) !important;
    color: darkgrey !important;
}
.jfk-bubble,
.octotree-sidebar,
.cc-pr__logo,
.cc-octicon,
#network canvas,
img.network-tree {
    filter: invert(94.4%) hue-rotate(180deg) contrast(90%) !important;
}
#commit-activity-detail > svg {
    fill: ${black} !important;
}
.ContributionCalendar-day,
.ContributionCalendar-day[data-level="0"] {
    fill: var(--color-calendar-graph-day-bg) !important;
}
.ContributionCalendar-day[data-level="1"] {
    fill: var(--color-calendar-graph-day-L1-bg) !important;
}
.ContributionCalendar-day[data-level="2"] {
    fill: var(--color-calendar-graph-day-L2-bg) !important;
}
.ContributionCalendar-day[data-level="3"] {
    fill: var(--color-calendar-graph-day-L3-bg) !important;
}
.ContributionCalendar-day[data-level="4"] {
    fill: var(--color-calendar-graph-day-L4-bg) !important;
}
.day,
.day[data-Count="0"] {
    fill: var(--color-calendar-graph-day-bg) !important;
}
.day[data-Count="1"] {
    fill: var(--color-calendar-graph-day-L1-bg) !important;
}
.day[data-Count="2"] {
    fill: var(--color-calendar-graph-day-L2-bg) !important;
}
.day[data-Count="3"] {
    fill: var(--color-calendar-graph-day-L3-bg) !important;
}
.day[data-Count="4"] {
    fill: var(--color-calendar-graph-day-L4-bg) !important;
}
:root {
    --color-calendar-graph-day-bg: ${#ebedf0} !important;
    --color-calendar-graph-day-L1-bg: ${#9be9a8} !important;
    --color-calendar-graph-day-L2-bg: ${#40c463} !important;
    --color-calendar-graph-day-L3-bg: ${#30a14e} !important;
    --color-calendar-graph-day-L4-bg: ${#216e39} !important;
    --color-previewable-comment-form-bg: var(--darkreader-neutral-background) !important;
}
.Box-row--yellow {
    background-color: ${#fffbdd} !important;
}
.merge-status-list {
    border-color: ${#c0c5c7} !important;
}
.user-has-reacted {
    background-color: rgba(17, 88, 199, 0.2) !important;
}
.hx_IssueLabel,
.TokenBase__StyledTokenBase-sc-47c3884c-0 {
    background: rgba(var(--label-r),var(--label-g),var(--label-b),var(--background-alpha)) !important;
    border-color: hsla(var(--label-h),calc(var(--label-s) * 1%),calc((var(--label-l) + var(--lighten-by)) * 1%),var(--border-alpha)) !important;
    color: hsl(var(--label-h),calc(var(--label-s) * 1%),calc((var(--label-l) + var(--lighten-by)) * 1%)) !important;
}
.header-search-input {
    border: 0 !important;
}
.HeaderMenu-link--sign-in {
    border: 0 !important;
}
.timeline-comment--caret.current-user::after {
    --color-current-user-tip-bg: var(--darkreader-bg--color-box-bg-info) !important;
}
.timeline-comment--caret.current-user::before {
    background-color: var(--darkreader-border--color-box-border-info) !important;
}
@media screen and (min-width: 1012px) {
    markdown-toolbar.border-lg-top-0 {
        border-top: 1px solid var(--darkreader-border--color-border-primary) !important;
    }
}
@media screen and (max-width: 767px) {
    div.tabnav--responsive button.tabnav-tab {
        --color-border-primary: var(--darkreader-border--color-border-primary) !important;
    }
}
.TimelineItem-badge[style^="background-color: var(--color-timeline-merged-bg)"] {
    background-color: var(--color-timeline-merged-bg) !important;
}
.ContributionCalendar-label {
    --color-text-primary: var(--darkreader-neutral-text) !important;
}
article div[style^="background: linear-gradient"] {
    background: linear-gradient(to top, var(--darkreader-bg--color-bg-primary), transparent) !important;
}
.ͼ5 .cm-content,
.ͼ5 .cm-panel.cm-search > button {
    background-color: var(--darkreader-neutral-background) !important;
}

IGNORE INLINE STYLE
a[href^="https://apps.apple.com/app/"] g
a[href^="https://apps.apple.com/app/"] path
tracked-issues-progress svg *
div#user-repositories-list .tooltipped svg *
div#org-repositories .tooltipped svg *

================================

github.myshopify.com

INVERT
.site-header__logo-image
.column-gh.column-full>svg

================================

githubstatus.com

CSS
.illo-desktop-header {
    z-index: 0 !important;
}

================================

gitlab.com
gitlab.host
gitlab.*.*
gitlab.*.*.*
code.videolan.org
framagit.org
git.fairkom.net
repo1.dso.mil

INVERT
.js-contrib-calendar

CSS
:root {
    --svg-status-bg: #181a1b;
}
.avatar,
.avatar-container {
    border: none !important;
}
table.code .line_content *:not(pre),
.job-log *:not(pre) {
    font-family: "Menlo", "DejaVu Sans Mono", "Liberation Mono", "Consolas", "Ubuntu Mono", "Courier New", "andale mono", "lucida console", monospace !important;
}
.gl-drawer-close-button,
.js-reply-button,
.dropdown.more-actions > button,
.js-note-edit,
.btn-default-tertiary,
.btn-confirm-tertiary {
    mix-blend-mode: unset !important;
}
.board-inner {
    --darkreader-border--gray-100: ${#d1cdc7} !important;
    --gray-10: ${#e1e3e4} !important;
}
.mr-tree-list:not(.tree-list-blobs) .tree-list-parent::before {
    background-color: transparent !important;
}

================================

gittigidiyor.com

CSS
img[data-testid="productImage"] {
    mix-blend-mode: normal !important;
}

================================

giveawayoftheday.com

INVERT
.header_lang .curr_lang::before
.header_logo
.header_nav_trig
.header_search
.header_search .button

IGNORE IMAGE ANALYSIS
.countdown-amount .diggit

================================

giveaways.cavebot.xyz

CSS
.respon1.p-r-50.p-l-50.p-b-22.p-t-42.bor1.cd100.flex-sa-m.flex-w {
    border: none !important;
}
.overlay1::after {
    background: unset !important;
}
.overlay1::before {
    background-color: unset !impotant;
    background-image: unset !impotant;
    opacity: 0.8 !important;
}
.overlay1::before {
    background-color: unset !important;
    background-image: unset !important;
}

================================

gizmodo.com

INVERT
[aria-label="Gizmodo logo"]

================================

glasswire.com

INVERT
.download-n-marks div img
.menu

CSS
.head-menu .menu a {
    color: var(--darkreader-neutral-background) !important;
}

================================

global.gotomeeting.com/join/*

IGNORE IMAGE ANALYSIS
body

================================

gloswielkopolski.pl

INVERT
.componentsNavigationNavbar__brand

================================

gls-pakete.de

CSS
.tracking--status .status-box::before,
.tracking--status .status-box::after {
    z-index: 0 !important;
}
.tracking--status .status-box.status--complete.status--lastcomplete .status-box--tooltip,
.tracking--status .status-box.status--current .status-box--tooltip {
    bottom: 0 !important;
    margin-bottom: 0px !important;
    margin-top: -10px !important;
    position: absolute !important;
    transform: none !important;
}

================================

gnc.com

IGNORE INLINE STYLE
a[id^="powered_by_pixlee"]

================================

gnu.org

INVERT
#gnu-banner img
#search-icon

================================

godaddy.com

INVERT
.logo-mark

================================

godbolt.org

CSS
div.view-lines * {
    font-family: ui-monospace, SFMono-Regular, "SF Mono", Menlo, Consolas, "Liberation Mono", monospace !important;
}

================================

godfathers.com

INVERT
.header .top-bar .top-bar-wrapper .page-header-branding img

================================

godoc.org

CSS
.banner {
    background-color: ${rgb(225, 190, 130)} !important;
}

================================

godzinyotwarcia24.pl

INVERT
.mbdtr
.mpktr
form[action="/szukaj"]
div[id="suchfeldlabels"]

================================

gog-games.com/game

INVERT
img[src*="hoster_logos"]
div.close

CSS
#game-details > .container::before {
    background-image: none !important;
}

================================

gog.com

INVERT
i.icn.icn--close
svg.icon-wrapper-icon
svg.big-spot__add-to-cart-icon
svg.ic-svg:not(.button__icon):not(.productcard-slider__nav-icon)
.productcard-thumbnails-slider-pagination
.carousel-pagination__page
.big-spot__carousel-pages-container
.big-spots__arrow-icon
.discover-games-more__icon

CSS
.product-tile__info:hover {
    background-color: var(--darkreader-neutral-background) !important;
}
a.product-tile__content {
    background-color: var(--darkreader-neutral-background) !important;
}
.galaxy-tooltip__layer {
    background: ${#d9d9d9} !important;
    color: var(--darkreader-neutral-text) !important;
}
.big-spot__content,
.big-spot__text,
.big-spot__action {
    backdrop-filter: brightness(50%) !important;
}
.big-spot__title,
.big-spot__super-title,
.big-spot__action {
    filter: brightness(130%) !important;
}
.wishlist-button,
.review__read-more,
.review-new__add-button,
.review-new__guideline-button {
    background-image: none !important;
}
.productcard-thumbnails-slider__play-btn {
    border-color: rgb(220, 218, 215) !important;
}
.productcard-thumbnails-slider__play-btn::before {
    border-left-color: rgb(220, 218, 215) !important;
}
.list--summary.shelf-skin--wood .product-row-wrapper:after {
    background-image: url(/bundles/gogwebsiteaccount/img/shelf/wood.png);
}

IGNORE IMAGE ANALYSIS
.menu-anonymous__shelf

================================

gog.com/promo
gog.com/partner

CSS
.wrapper.cf > .content.cf::before {
    background-color: rgba(0,0,0,0.5);
    height: 100%;
    left: 0;
    position: fixed;
    top: 0;
    width: 100%;
}
.container.promo-page-header.cf {
    filter: brightness(100%) !important;
}

================================

gokulv.netlify.app

IGNORE IMAGE ANALYSIS
body

================================

golang.org

INVERT
.Footer-gopher
.gopher

CSS
#file-editor .CodeMirror,
#file-editor .CodeMirror-lines,
#file-editor .CodeMirror-gutters,
#wrap {
    background-color: var(--darkreader-neutral-background) !important;
}

================================

goodreads.com

INVERT
.responsiveSiteFooter__socialLinkWrapper

================================

google.*/chrome

INVERT
[src$="slate.png"]
[src$="articles.png"]
[src$="phone_desktop.png"]
[src$="homepage_tools.png"]
[src$="chrome-ui-sync.png"]
[src$="password-check.png"]
[src$="big_pixel_phone.png"]
[src=$"homepage_privacy.png"]
[src$="big_phone_desktop.png"]
[src$="chrome-ui_desktop.png"]
[src$="pixel_slate_port_desktop.png"]
[src^="/chrome/static/images/productivity/"]
[src^="/chrome/static/images/be-more-productive/"]
[src^="/chrome/static/images/download-browser/pixel"]
[src^="/chrome/static/images/google-translate/screen-"]

================================

google.*/maps
google.*.*/maps

INVERT
#app-container.vasquette:not(.app-imagery-mode):not(.app-globe-mode) .widget-scene-canvas
#app-container.vasquette:not(.app-imagery-mode):not(.app-globe-mode) .canvas-container > canvas
#app-container.vasquette:not(.app-imagery-mode):not(.app-globe-mode) .full-screen > img
.widget-settings-button-icon
.searchbox-button
.searchbox-searchbutton
.searchbox-hamburger::before
.maps-sprite-settings-chevron-left
a.ita-kd-icon-button > span
li.ita-kd-menuitem > span.ita-kd-menuitem-inputtool-icon
li.ita-kd-menuitem > span.ita-kd-checkbox
div.maps-sprite-common-chevron-left
span.maps-sprite-common-chevron-right
span.section-destination-via-line-icon
div.section-directions-trip-travel-mode-icon
button.searchbox-hamburger.white-foreground
label.kd-radio-label::before
label.kd-checkbox-label::before
label.kd-checkbox-label::after
button.section-directions-details-action-button
div.section-loading-spinner
a.gb_b > div
a.gb_xc
.gm-style img[role="presentation"]:not([src*="v="])
.i4ewOd-xl07Ob
.i4ewOd-LQLjdd li::before
.un1lmc-j4gsHd
.maps-sprite-settings-languages
a[href*="about/products"]
.google-logo
.watermark
.section-review-action-menu
.section-review-interaction-button
.section-directions-trip-travel-mode-icon
.renderable-component-icon
.cards-rating-star
.maps-sprite-common-chevron-right
[role="region"] button[jsaction^="pane.list-item.add"] [class*="icon-background"] [class*="icon"][src*="black"]
.top-activity-icon
.activity-icon
img[src$="menu_black_24dp.png"]
#assistive-chips .e2moi img
button[guidedhelpid="searchbutton"]
a[href^="//myaccount.google.com/yourdata/maps"] > div
img[src^="//www.google.com/images/branding/lockups/"][alt="Google Maps"]
div[role="checkbox"] > div
div[aria-label="Toggle star"][role="checkbox"]
#legendPanel > div > div > div > div > div > div > div > div > div[jsaction^="keydown"][jsshadow=""][role="checkbox"][style=""]
#legendPanel > div > div > div > div > div > div > div > div > div > div > div > div[jsaction^="keydown"][jsshadow=""][role="checkbox"]
#map-canvas > div > #watermark
body.vsc-initialized > #app > #map-container > #map > .map-outer.map-extent
body.vsc-initialized > #app > #map-container > #map > div > div > div > button[jsaction="map.toggle-map-control"] > img
body.vsc-initialized > #app > #map-container > #map > div > div > div > div > div > button[jsaction="map.zoom-out"] > img
body.vsc-initialized > #app > #map-container > #map > div > div > div > div > div > button[jsaction="map.zoom-in"] > img
#app-container > #modal-dialog > div > div > div > div > button[jsaction="modal.close"]
#map-canvas div[data-tooltip]
div[style="top: 0px;"] > div > div > div > :first-child
div[style="top: 0px;"] > div > :last-child > div > :nth-child(2)
div[style="top: 0px;"] > div:first-child:not([style^="background"]) > :last-child

CSS
#app-container > #modal-dialog > div > div > div > div > button[jsaction="modal.close"] {
    background-color: $var(--darkreader-neutral-background) !important;
}
span.google-symbols > * {
    font-family: "Google Symbols" !important;
}

IGNORE IMAGE ANALYSIS
.widget-settings-map
.widget-settings-satellite
.widget-settings-terrain
.widget-settings-globe
.widget-settings-traffic
.widget-settings-transit
.widget-settings-bike
.widget-settings-street-view
.widget-settings-covid-info-icon
.widget-settings-location-sharing
.widget-settings-your-places
.widget-settings-rate-review
.widget-settings-timeline
.widget-settings-link
.widget-settings-print

================================

googleprojectzero.blogspot.com

CSS
.c5 a img {
    background-color: white !important;
}

================================

goplay.anontpp.com

INVERT
img[src*="download.svg"]
img[src*="cast.png"]
img[src*="bookmark.png"]
.jw-slider-container
.jw-time-tip::after

================================

goproblems.com

INVERT
.navbar-brand

IGNORE INLINE STYLE
<div class="player-container">

================================

gorod.gov.spb.ru

INVERT
.header__logo
.reason__icon
.map-with-address
.problem-details__map
.problem-map-page__map
.evtmap canvas

================================

gorod.mos.ru

INVERT
.scene__logo
div[id^="map"] > div > div > div
div[style^="text-align: center; margin"] > div > div:first-of-type

CSS
#footer {
    background: ${#CCECE8} !important;
}

================================

gosuslugi.ru

INVERT
ymaps[class$="ground-pane"]
ymaps[class$="places-pane"] span

================================

gotquestions.org

CSS
.gradient-to-b {
    --color-end: var(--darkreader-neutral-background) !important;
    --color-start: var(--darkreader-neutral-background) !important;
}

================================

gov.pl/web/bip

INVERT
.banner-promo
.banner-promo__text

================================

gowork.pl

INVERT
.city__img .city__text

================================

gp.se

CSS
header nav {
    border-top: unset !important;
}
header nav::after {
    background: linear-gradient( 90deg, hsl(0deg 0% 100% / 4%) 0, hsl(0deg 0% 30.39% / 40%) 25%, var(--darkreader-bg--white) ) !important;
}
article.teaser-article {
    --teaser-background-color: var(--darkreader-neutral-background) !important;
}

================================

gptzero.me

CSS
.bg-home-mobile-background {
    background-image: none !important;
}
img[alt="background image"] {
    display: none !important;
}

================================

grammarly.com

INVERT
img[alt="Grammarly logo"]

IGNORE INLINE STYLE
div[data-qa="heroSectionAnimationContainer"] path

================================

gramota.ru

INVERT
img[src*="logo-gramota"]
.caret
td > strong

================================

gravatar.com

INVERT
a.g-home
.g-user-menu > svg
body#page > div > div > nav > ul > li > a > svg.g-logo.g-logo--name-gravatar

CSS
a[class="g-sign-in"] > svg > path {
    fill: white !important;
}
body {
    background-image: none !important;
}

================================

grc.com

INVERT
img[src*="gif"]

================================

greatergood.com

INVERT
.ctg-logo
.logo-ggc-color
#site-logo

================================

grocy.info

INVERT
.navbar-brand
.carousel-control-prev-icon
.carousel-control-next-icon

================================

grovedb.org

INVERT
.title-background *

CSS
.main-banner {
    background: var(--darkreader-neutral-background) !important;
}

IGNORE IMAGE ANALYSIS
.banner-background

================================

grubhub.com

CSS
.s-checkbox-filler {
    color: rgb(24, 26, 27) !important;
}
label,
h5,
h6,
header,
.h5 {
    color: ${black};
}

================================

gsmchoice.com
mgsm.pl

INVERT
.promo-sticky__item--large
.promo-sticky__item--small
.social-fixed--infoline
img[alt="GSMchoice.com"]
img[alt="mGSM.pl"]
img[src*="card_ico"]
img[src*="short"]

================================

gsuite.google.com

INVERT
.header--logo img

================================

gu.spb.ru

INVERT
ymaps[class$="ground-pane"]

CSS
.bg {
    background-image: var(--darkreader-neutral-background) !important;
}

================================

guancha.cn

CSS
.dahui {
    background-image: none !important;
}

================================

guiott.com

CSS
.Section1 > div {
    background-image: none !important;
}

================================

guitarcenter.pl

INVERT
tr > td > img
p.standard_price
p.promo_price

================================

guitarworld.com

INVERT
.site-logo

================================

gumroad.com

INVERT
.mega-gum-logo

================================

gurushots.com

CSS
.c-challenges-speed-item__countdown > .round-progress-wrapper,
.challengesItemSuggested__timer .round-progress-wrapper {
    background-color: transparent !important;
}
.modal-vote__exposure-meter__arrow,
.modal-vote__exposure-meter__arrow::after {
    background-color: var(--darkreader-neutral-text) !important;
}

================================

gutrad.com

CSS
.g_parallex_bnr li .g_no_slider {
    color: black !important;
}

================================

habitica.com

INVERT
.logo path:nth-child(2)

IGNORE IMAGE ANALYSIS
*

================================

habr.com

INVERT
img[src*="//tex.s2cms.ru/"]
img[data-tex]
img.formula

CSS
html {
    text-shadow: none !important;
}
.main-navbar .icon-svg {
    fill: ${#929ca5} !important;
}

================================

hacdias.com

CSS
:root {
    --background: var(--darkreader-neutral-background) !important;
}

================================

hackerone.com

INVERT
.app__logo

================================

hackerrank.com

INVERT
.badge-icon
.CodeMirror-cursors
.CodeMirror-selected

CSS
.monaco-editor .cursor {
    background-color: ${black} !important;
}

================================

half-life-calculator.com

INVERT
canvas#chart

================================

hampage.hu

CSS
body {
    background-image: none !important;
}

================================

handshake.org

INVERT
[src*="logo-dark.svg"]
[src*="blocks.svg"]

CSS
ul.notes li::before {
    background-color: var(--darkreader-neutral-text) !important;
}

================================

handwiki.org

CSS
#mw-content {
    background-color: var(--darkreader-neutral-background) !important;
}

================================

haokan.baidu.com

INVERT
.header-logo-icon

================================

hazi.ro

CSS
:root {
    --app-nav-top-bg: var(--darkreader-neutral-background);
    --dropdown-bg: var(--darkreader-neutral-background);
    --input-bg: var(--darkreader-neutral-background);
    --input-disabled-bg: var(--darkreader-neutral-background);
    --site-section-bg: ${#ddd};
    --ui-block-bg: var(--darkreader-neutral-background);
}
.main-footer-extended.main-footer-extended-gray {
    background: var(--darkreader-neutral-background) !important;
}

================================

hbo.com

INVERT
img[alt="HBO Logo"]

================================

hbr.org

INVERT
.hamburger-icon
.top-header--logo
.search-icon
.footer-logo

================================

hbweb.hu

CSS
[background] {
    background-image: unset;
}

================================

hdgo.cc
vio.to

INVERT
.hdplayer .big_play_button div
.hdplayer .hdgo_controls div.hdgo_pause_control div
.hdplayer .hdgo_controls div.hdgo_play_control div

================================

hdlbits.01xz.net

CSS
img.image,
.image > img {
    background-color: white !important;
    filter: brightness(50%) sepia(40%) !important;
}

================================

headphones.com

INVERT
.header__heading-logo

CSS
#MainContent,
.header__menu-container,
details > ul,
.search__input {
    background-color: rgb(30, 33, 34) !important;
}
.search__input::placeholder {
    color: rgb(30, 33, 34) !important;
}

================================

heise.de

INVERT
.heise-online-logo

================================

helix.ru

INVERT
.Site-Header-Logo

================================

help.ea.com

CSS
.app,
.app > div {
    background-image: var(--darkreader-neutral-background) !important;
}

================================

help.nextdns.io

INVERT
.logo-desktop
.logo-mobile

================================

helzberg.com

INVERT
.logo
.footer.content
.footer.content > div
.footer__column--logo

IGNORE INLINE STYLE
a[id^="powered_by_pixleee"]

================================

heraldscotland.com

INVERT
.brand

================================

heritage.org/index

INVERT
.bar

CSS
.content-container {
    background-image: none !important;
}

================================

hex-rays.com

INVERT
#logo
.footer-logo

================================

hexos.com

CSS
.fe-block {
    text-shadow: ${white} 1px 1px 0px !important;
}

================================

hh.ru

CSS
html {
    text-shadow: none !important;
}

================================

hificompass.com

CSS
.field-slideshow-slide img {
    background-color: cornsilk !important;
}

================================

high-minded.cx

CSS
i[aria-hidden="true"] {
    font: normal normal normal 18px/1 "Material Design Icons" !important;
}

================================

hindustantimes.com

INVERT
.menu.noti-dot
.searchHolder .search
img[src$="logo-big-cm.png"]
img[src$="logo-ht.png"]
img[src$="htlogo.png"]

================================

hionnature.com

INVERT
img.header__heading-logo
div.footer-block-image > img

CSS
.gradient {
    background: var(--darkreader-neutral-background) !important;
}

================================

history.state.gov

CSS
body {
    background-image: none !important;
}

IGNORE IMAGE ANALYSIS
body

================================

hktdc.com

INVERT
.header-logo

================================

hm.com

INVERT
[class^="TurnToReviewsButton-module--ratingStars"]

CSS
.review-answers .review-answer .average-score {
    background-color: var(--darkreader-neutral-text) !important;
}

IGNORE INLINE STYLE
.swatch

================================

hmong.*
wikihmong.com

INVERT
span.mwe-math-element

================================

hoi4.paradoxwikis.com

INVERT
.mwe-math-fallback-image-inline

================================

homebrewery.naturalcrit.com

CSS
.CodeMirror-scroll {
    background-color: #444;
}
span[role="presentation"] {
    color: white;
}
span[role="presentation"] > .cm-header {
    color: rgb(50, 150, 250);
}
span[role="presentation"] > .cm-variable-2 {
    color: rgb(50, 150, 250);
}
.phb blockquote {
    background-color: #e0e5c1 !important;
}
.phb h3,
.phb h2,
.phb h1 {
    color: #58180D;
}
.phb p {
    color: black;
}
.cm-link,
.cm-attribute {
    color: rgb(90, 140, 255) !important;
}
.cm-url,
.cm-string {
    color: rgb(200, 50, 50) !important;
}
.cm-quote,
.cm-tag {
    color: rgb(50, 200, 50) !important;
}

================================

homedepot.com

CSS
span[role="progressbar"] > .sui-bg-inverse {
    background-color: ${#f70} !important;
}

================================

hooktail.sub.jp
hooktail.org

INVERT
#box img
.box img

CSS
#box,
.box {
    background-color: var(--darkreader-neutral-background) !important;
}
h2 {
    background-image: none;
}
a {
    color: rgb(157, 149, 237);
}

================================

hootsuite.com

INVERT
img[src$="hootsuite_white_form3.png"]

================================

host-c.com

INVERT
.logo

================================

hotcrp.com

CSS
select,
button,
.btn,
button.btn-t:hover {
    color: silver;
}

================================

hotel.meituan.com

INVERT
.poi-hotellbs-map
.small-map

================================

howbuy.com

INVERT
.bottomStar
.cpBottomWord
.logo
.navList dt
.phCon
.title
#valuationChar

================================

howstuffworks.com

INVERT
a[data-track-gtm="Logo"]

================================

hp.com
*.hp.com

INVERT
#g-nav .c-logo
.w-100
img[src*="CCLS_SSL_Icon.svg"]
.lia-img-powered-by-khoros
a[aria-label="Options"]
.myprofile-img
.solutions-img
.mykudo-img
.ikudo-img
.osDetectionWindows img
.hpsaImg

CSS
.pdp-bg {
    background-image: none !important;
}

================================

hs.fi

CSS
article,
article > article {
    background-color: var(--darkreader-neutral-background) !important;
}

================================

hstechdocs.helpsystems.com

CSS
.body-container {
    background-color: var(--darkreader-neutral-background) !important;
}
ul.sidenav li a,
ul.sidenav ul > li > a {
    color: var(--darkreader-neutral-text) !important;
}

================================

htmlcolorcodes.com

IGNORE INLINE STYLE
.js-palette-color
.js-swatch
.js-color

================================

httpwg.org

CSS
svg.diagram text {
    fill: var(--darkreader-neutral-text) !important;
}

================================

huawei.com

INVERT
.logo

================================

huba.news

INVERT
img[alt="Huba"]
img[alt="INTERIA.PL"]
.most-interesting-topics-header::before

================================

hubs.mozilla.com

INVERT
svg.hmc-logo

================================

hugoboss.com

INVERT
.dy_reco-product__image svg.dy_reco-product__logo
.dch-footer
.dch-footer img

CSS
.dch-head-teaser__text-container h1,
.dch-textbox-item,
.dch-footer {
    text-shadow: ${rgb(225, 212, 201)} 1px 1px 0px !important;
}

================================

huji.ac.il/dataj/controller/

CSS
body {
    background-image: none !important;
}

================================

hvdic.thivien.net

INVERT
img.hvres-variant-img.lazy

CSS
body {
    background-image: none !important;
}

================================

hyperphysics.phy-astr.gsu.edu

INVERT
tbody td > img
tbody center > img
tbody center > a > img

================================

hyperskill.org

INVERT
.html-preview

CSS
.monaco-editor .margin,
.monaco-editor-background {
    background-color: #181A1B !important;
}
.monaco-editor .cursor {
    background-color: ${#000000} !important;
}
.step-text[data-v-341d1caa] pre {
    background-color: var(--darkreader-neutral-background);
}

================================

hyperx.com

CSS
.product-card__thumbnail-container,
.knockout-image {
    mix-blend-mode: unset !important;
}

================================

hypixel.net

INVERT
.p-nav-inner
.message-avatar::after

CSS
.p-navEl-link,
.p-header-playNow .p-header-playNow-button,
.p-navgroup-link--search {
    color: ${rgb(214, 210, 205)} !important;
}

================================

hypothes.is

INVERT
a[href="https://hypothes.is"] > svg[aria-labelledby="logo-title"] > g > path[fill-rule="nonzero"]
img[class="fusion-standard-logo"]

================================

i-item.jd.com

CSS
.itemInfo-wrap .summary-price-wrap .summary-top .summary-promotion {
    background-image: none !important;
}

================================

iadisportal.org

CSS
#iadis-container #iadis-container2,
#iadis-containerwrap2 {
    background-color: var(--darkreader-neutral-background) !important;
    background-image: none !important;
}

================================

ica.coop

INVERT
.main-header__logo

================================

icloud.com

INVERT
.rm-list-body
.note-list-item-attachment
.sc-iujRgT.jxLrRl
.icloud-text.image
.img.app-icon-icloud
#cloudos-loading-spinner
.editor-container
.light > svg

CSS
.cw-pane-container,
.reminders {
    background-image: none !important;
}
.homepage-viewport .homepage-gradient-background {
    filter: grayscale(0.8) !important;
}
.content > .title {
    color: var(--darkreader-neutral-background) !important;
}
.content > .description {
    color: var(--darkreader-neutral-background) !important;
}

================================

icofont.com

INVERT
.logo

================================

iconfinder.com

INVERT
.logo

================================

iconify.design

IGNORE INLINE STYLE
svg.iconify *
svg#footer-icon-name *
svg#icon-nav-prev *
svg#icon-nav-next *
.si-svg-wrapper svg *
.block-container .icons svg *

================================

icons8.com

CSS
.main-page .gradient {
    background-image: none !important;
}

================================

icrc.org

CSS
.logo,
.logo img {
    background-color: #fff !important;
}

================================

id.fedoraproject.org

INVERT
img[alt="logo"]

================================

id.unity.com

CSS
.qr-code {
    border: calc(150px * 1/45) solid #f5f8f9;
}

================================

identity.kde.org

CSS
body,
.navbar-inner,
.navbar {
    background-image: none !important;
}

================================

ieee.org

INVERT
.logo-left

================================

iett.istanbul

CSS
#routedesc p:nth-child(2) {
    font-size: 0;
}
#routedesc p:nth-child(2)::after {
    content: "Kırmızı renkli seferler ÖHO ve OAŞ; beyaz renkli seferler İETT’ye aittir.";
    font-size: 20px;
}

================================

ifixit.com

INVERT
a[aria-label="home page"] > svg > path:first-child

IGNORE IMAGE ANALYSIS
*

================================

iflscience.com

INVERT
.header-primary div a svg
.footer-branding a svg
.footer-subscribeBox div span a svg

================================

ifood.com.br

CSS
.responsive-header__logo svg {
    --darkreader-inline-fill: rgb(212, 45, 58) !important;
}

================================

igraal.com
*.igraal.com

INVERT
.vouchers-main__top
.vouchers-main__top .title
.vouchers-main__top .subtitle

CSS
body,
body .main-content {
    background: var(--darkreader-bg--grey-100) !important;
}

================================

igurublog.wordpress.com

CSS
body,
.entry,
#content,
#container {
    background-image: none !important;
}

================================

ikea.*

INVERT
.menu-btn

CSS
.range-revamp-ratings-bar__star--empty path,
.range-revamp-ratings-bar__star--half path:first-child {
    fill: ${rgb(246, 245, 244)} !important;
}
.hnf-svg-icon {
    fill: var(--darkreader-neutral-text) !important;
}
.card,
.card-header,
.card-footer {
    background-color: var(--darkreader-neutral-background) !important;
}

IGNORE INLINE STYLE
.gpr__color-dot

================================

iliad.it

IGNORE IMAGE ANALYSIS
.background

================================

ilovepdf.com

INVERT
.brand__logo
.ico--down
.ico--desk
.ico--hamburger

================================

ilyabirman.*

INVERT
img[src*="layout-win"]

CSS
body {
    background: none !important;
}

================================

image-net.org

INVERT
img[src="/static_files/index_files/logo.jpg"]

================================

imap:
mailbox:
pop3:

INVERT
div.mc-ip-hide[style*="background: rgb(255, 255, 255) !important"]

CSS
table[class|="moz-header"] {
    background: none;
}
*[style*="color: rgba(0,0,0,"],
*[style*="color: rgba(0, 0, 0,"],
*[style*="color:#000"],
*[style*="color:black"],
*[style*="color:#282828"],
*[style*="color:#444"] {
    color: var(--darkreader-neutral-text) !important;
}
*[style*="background:#fff"],
*[style*="background-color:#fff"] {
    background: var(--darkreader-neutral-background) !important;
}
*[bgcolor="#F5F5F5"],
*[style*="background-color: #F5F5F5"] {
    background: ${#F5F5F5} !important;
}
body[style*="background: rgb(255, 255, 255) !important"] *:not(a),
.body[style*="background-color: rgb(254, 254, 254) !important"] *:not(a) {
    background-color: var(--darkreader-neutral-background) !important;
}
div[style*="www.gstatic.com/android/"] {
    background: none !important;
}
*[style*="background:#f9f9f9"] {
    background: ${#F9F9F9} !important;
}

================================

imdb.com

INVERT
.a-icon
.jw-slider-volume

CSS
#wrapper {
    background: ${#e3e2dd} !important;
}
.ipc-page-section--base {
    --ipc-pageSection-base-bg: var(--darkreader-neutral-background) !important;
}
:root: {
    --darkreader-bg--ipt-baseAlt-shade1-bg: var(--darkreader-neutral-background) !important;
}
.imdb-header__nav-drawer div,
.ipc-menu--on-baseAlt,
.imdb-header__search-menu,
.ipc-promptable-base__panel {
    background-color: var(--darkreader-neutral-background) !important;
}
.ipc-promptable-base__content {
    background-color: #171a1b !important;
}
div[class^="SubNav__SubNavContainer"],
div[class^="Media__ButtonContainer"] > a,
div[class*="WatchlistButton__ButtonParent"] > button,
a[class*="EmptyState__FYWStateButton"],
a[class*="EmptyState__FromYourWatchlistRibbon"] > svg,
.ipc-poster-card,
.ipc-poster-card__actions > .ipc-button {
    background: rgba( var(--ipt-on-baseAlt-rgb,255,255,255),var(--ipt-baseAlt-hover-opacity,0.08) ) !important;
}
div[class^="SubNav__ShareButtonWrapper"]::before,
div[class^="Root__Separator"] {
    background: rgba(var(--ipt-base-rgb,255,255,255),0.2);
}
.ipc-title__text::before,
.ipc-tabs__indicator {
    background: #f5c518 !important;
}
.ipc-signpost--accent1 {
    background: var(--darkreader-bg--mdc-theme-ipt-accent1-color, #bb9508) !important;
}
hgroup[class*="ipc-title--category-title"] > .ipc-title__text,
.ipc-title-prompt__title {
    color: #f5c518 !important;
}
.boxOfficeTitle:nth-of-type(2n) {
    background: linear-gradient( to right,rgba(var(--ipt-on-baseAlt-rgb),0),rgba(var(--ipt-on-baseAlt-rgb),0.06) ) !important;
}
div[class^="VideoInfostyles__VideoDescriptionOverlay"] {
    background: linear-gradient(transparent 50%,var(--ipt-baseAlt-bg)) !important;
}
main {
    background: var(--ipc-pageSection-baseAlt-bg) !important;
}
.ipc-watchlist-ribbon__bg-ribbon {
    fill: rgba(var(--ipt-baseAlt-shade1-rgb), 0.75) !important;
}
.ipc-watchlist-ribbon--inWatchlist .ipc-watchlist-ribbon__bg-ribbon {
    fill: #BB9508 !important;
}
.ipc-switch__slider::before,
.ipc-switch__slider::after {
    background: #5799ef !important;
}
.aux-content-widget-2 {
    background: none !important;
}
.ipc-tabs--display-chip .ipc-tab--active,
.ipc-tabs--display-chip .ipc-tab--active:hover {
    background: ${rgb(245,197,24)} !important;
}
.ipc-split-button {
    border: solid 2px currentcolor !important;
}
section[cel_widget_id="StaticFeature_Photos"] button {
    background: none;
}

================================

immobilienscout24.de

INVERT
img[alt^="ImmobilienScout24"]
.topnavigation__sso-login__plus-logo
.button-primary
.main-search__content--rent--from-0
.result-list-entry__new-flag
.product-teaser__image
.no-of-results-highlighter

CSS
.result-list__listing {
    background-color: transparent !important;
}

================================

imwithgeekarchive.weebly.com

CSS
body {
    background-color: var(--darkreader-neutral-background) !important;
    background-image: none !important;
}

================================

inaturalist.org

INVERT
.logolink

================================

inc.com

INVERT
svg[class*="logo"]

================================

ind.ie

INVERT
.three-rs .three-rs-list p

================================

independent.co.uk

INVERT
.logo-text
#MegaMenuButton
.search-toggle
.jw-slider-horizontal
.jw-slider-volume

IGNORE INLINE STYLE
.logo-svg-cls-2

================================

index-education.net
*.index-education.net

INVERT
.widget .content-container::after
.conteneurAbs>canvas

CSS
body:not(.ThemeAccessible) .ThemeCat-edt {
    --darkreader-text--theme-claire-scalePlus80: ${#e8e6e3} !important;
}
body:not(.ThemeAccessible) .ThemeCat-resultat {
    --darkreader-text--theme-claire-scalePlus80: ${#cdc8c2} !important;
}
body:not(.ThemeAccessible) .ThemeProduitEDT,
body:not(.ThemeAccessible) .ThemeCat-viescolaire {
    --darkreader-text--theme-claire-scalePlus80: ${#ccc7c1} !important;
}
body:not(.ThemeAccessible) .ThemeCat-pedagogie {
    --darkreader-text--theme-claire-scalePlus80: ${#cecac3} !important;
}
body:not(.ThemeAccessible) .ThemeCat-communication {
    --darkreader-text--theme-claire-scalePlus80: ${#cecac4} !important;
}
.ObjetBandeauPied .knowledge-container .ibp-pill {
    border-color: ${#a49d91} !important;
}
.ObjetBandeauPied hr {
    background-color: ${#2f323470} !important;
}
:root,
:root body.dark-mode .disable-dark-mode {
    --theme-neutre-claire: ${#c6caca} !important;
    --theme-neutre-moyen2: ${#b4b4b4} !important;
}
html[data-darkreader-scheme="dark"] .ibe_gauche>* {
    filter: invert(94%) hue-rotate(180deg) contrast(90%) !important;
}
.ie-chips.tag-style {
    background: linear-gradient(90deg, var(--darkreader-bg--theme-neutre-claire) 0, var(--darkreader-bg--theme-neutre-claire) calc(100% - 0.8rem), transparent calc(100% - 0.8rem), transparent 100%) !important;
}

================================

inet.se

INVERT
.h1yh8nho
a.item-button span[class*="icon"]

CSS
:root {
    --svg-icon-default-color: #e8e6e3 !important;
}

================================

infinity-academies.com

INVERT
img.bb-logo
img[src*="profile-avatar-buddyboss-50.png"]

================================

infinitysearch.co

INVERT
img[src$="github.ico"]
img[src$="unsplash.png"]
img[src$="boardreader.ico"]
#logo_img_home[src$="logo_text_black.png"]

================================

info.wyborcza.biz

INVERT
.imgw

================================

infoq.com

CSS
.bg-cover {
    background-blend-mode: multiply;
}

================================

inforlex.pl

INVERT
div[class="content -dark"]
div[class="loginLogo"]
img[src*="infor-lex_2020.jpg"]
a[class="client-logo-entry"]

================================

informa.com

INVERT
.header-logo

================================

informatech.com

INVERT
.log-img

================================

inibuilds.com

INVERT
.header__heading-logo
.icon
img[alt="add icon"]
img[alt="plus"]
.footer-block__image-wrapper
.list-social__link

IGNORE IMAGE ANALYSIS
.flagged .flags-AUD
.flagged .flags-EUR

================================

inoreader.com

CSS
.article_expanded {
    background-color: rgb(31, 35, 38) !important;
}

================================

inquirer.com

CSS
.footer-share-bar-container > a > svg,
.search-bar > .relative button svg {
    fill: var(--darkreader-neutral-text) !important;
}
.hamburger-inner,
.hamburger-inner::after,
.hamburger-inner::before {
    background-color: var(--darkreader-neutral-text) !important;
}

================================

insomniac.com

INVERT
.global-navbar__logo
.social:not(.social--bordered-white):not(.social--white)
.icon-menu span

IGNORE IMAGE ANALYSIS
.social__twitch

================================

inspirehep.net

CSS
svg text {
    fill: ${black} !important;
}

================================

instacart.com

CSS
html[data-darkreader-scheme="dark"] button:not(:hover) {
    color: gray;
}

================================

instagram.com

INVERT
.s4Iyt
.coreSpriteActivityHeart
.coreSpriteAppStoreButton
.coreSpriteCall
.coreSpriteCheck
.coreSpriteCi
.coreSpriteClose
.coreSpriteDesktopNavDirect
.coreSpriteDesktopProfileSaveActive
.coreSpriteDesktopProfileTaggedActive
.coreSpriteDirectHeart
.coreSpriteDownload
.coreSpriteDropdownArrowGrey9
.coreSpriteGallery
.coreSpriteGooglePlayButton
.coreSpriteKeyhole
.coreSpriteLockSmall
.coreSpriteLoggedOutWordmark
.coreSpriteMobileNavDirect
.coreSpriteMobileNavTypeLogo
.coreSpriteNavBack
.coreSpriteNotificationLeftChevron
.coreSpriteNullProfile
.coreSpriteOptionsEllipsis
.coreSpritePagingChevron
.coreSpriteProfileCamera
.coreSpriteReload
.coreSpriteSaveNull
.coreSpriteSpinstaStory
.coreSpriteStoryCreation
.coreSpriteTaggedNull
.coreSpriteVideoNux
.coreSpriteWindowsStoreButton
.coreSpriteWordmark
.glyphsSpriteAdd__outline__24__grey_9
.glyphsSpriteAdd_friend__outline__96
.glyphsSpriteApp_instagram__outline__24__grey_9
.glyphsSpriteApp_messenger__outline__24__grey_9
.glyphsSpriteApp_twitter__outline__24__grey_9
.glyphsSpriteApp_whatsapp__outline__24__grey_9
.glyphsSpriteCall__outline__24__grey_9
.glyphsSpriteCamera__outline__24__grey_9
.glyphsSpriteChevron_down__outline__24__grey_9
.glyphsSpriteChevron_left__outline__24__grey_9
.glyphsSpriteChevron_up__outline__24__grey_9
.glyphsSpriteCircle_add__outline__24__grey_9
.glyphsSpriteComment__outline__24__grey_9
.glyphsSpriteContact_import
.glyphsSpriteContact_import_sm
.glyphsSpriteDirect__outline__24__grey_9
.glyphsSpriteDirect__outline__96
.glyphsSpriteDownload_2FAC
.glyphsSpriteError__outline__24__grey_9
.glyphsSpriteError__outline__96
.glyphsSpriteFacebook__outline__24__grey_9
.glyphsSpriteFb_brand_center_grey
.glyphsSpriteForward__outline__24__grey_9
.glyphsSpriteFriend_Follow
.glyphsSpriteGlyph_chevron_right
.glyphsSpriteHashtag__outline__24__grey_9
.glyphsSpriteHeart__filled__16__grey_9
.glyphsSpriteHeart__filled__24__grey_9
.glyphsSpriteHeart__outline__24__grey_9
.glyphsSpriteHome__filled__24__grey_9
.glyphsSpriteHome__outline__24__grey_9
.glyphsSpriteInfo__filled__16__grey_9
.glyphsSpriteLink__outline__24__grey_9
.glyphsSpriteLocation__outline__24__grey_9
.glyphsSpriteLock__outline__24__grey_9
.glyphsSpriteLock__outline__96
.glyphsSpriteMail__outline__24__grey_9
.glyphsSpriteMenu__outline__24__grey_9
.glyphsSpriteMore_horizontal__outline__24__grey_9
.glyphsSpriteNew_post__outline__24__grey_9
.glyphsSpritePaging_chevron
.glyphsSpritePlay__filled__16__grey_9
.glyphsSpriteSave__filled__24__grey_9
.glyphsSpriteSave__outline__24__grey_9
.glyphsSpriteSearch__filled__24__grey_9
.glyphsSpriteSearch__outline__24__grey_9
.glyphsSpriteSettings__outline__24__grey_9
.glyphsSpriteShare__outline__24__grey_9
.glyphsSpriteShopping__outline__16__grey_9
.glyphsSpriteStar_filled_24
.glyphsSpriteStar_half_filled_24
.glyphsSpriteStory__outline__24__grey_9
.glyphsSpriteUser__filled__24__grey_9
.glyphsSpriteUser__outline__24__grey_9
.glyphsSpriteUser_follow__filled__24__grey_9
.glyphsSpriteUser_follow__outline__24__grey_9
.glyphsSpriteUsers__outline__24__grey_9
.glyphsSpriteVideo_chat__outline__24__grey_9
.glyphsSpriteWhatsapp__outline__24__grey_9
.glyphsSpriteX__outline__24__grey_9
span.LikeSprite.embedSpriteHeartOpen
span.hideText.embedSpriteComment
span.hideText.embedSpriteShare
span.hideText.embedSpriteSaveOpen
span.Sprite.embedSpriteGlyph.hideText
.-Nmqg
svg[aria-label*="Facebook"]
a[role="link"][href="/"] i[role="img"]

CSS
div > a[tabindex],
div > span > a[tabindex] {
    border-color: transparent !important;
}
._ac3p {
    background-color: rgb(180, 180, 180) !important;
}
._ac3o {
    background-color: rgb(68, 68, 68) !important;
}

================================

instantpot.com

CSS
:root {
    --darkreader-bg--bg-color: var(--darkreader-neutral-background) !important;
}
input,
select {
    background-color: ${#ddd} !important;
}

================================

instructables.com

INVERT
.site-logo

================================

instructure.com

INVERT
.equation_image
.Page-container

================================

interaktywnie.com

INVERT
img[alt="Interaktywnie.com"]
img[src*="companym/"]

================================

interia.pl

INVERT
.logo
.search-submit

CSS
.calendar-date,
.calendar-body {
    background-color: var(--darkreader-neutral-background) !important;
    background-image: none !important;
}

================================

internationalrightsadvocates.org

INVERT
.header-title

CSS
.container .section-background {
    background-color: var(--darkreader-neutral-background) !important;
}
.container .section-background .background-fx-canvas > canvas {
    display: none !important;
}
.page-section h3,
.sqsrte-text-color--lightAccent {
    color: var(--darkreader-neutral-text) !important;
    text-shadow: ${rgb(225, 212, 201)} 1px 1px 0px !important;
}

================================

internetexchangemap.com

INVERT
div[aria-label="Map"] > div:first-child
div.fade

================================

interpride.org

INVERT
.header__logo
.search-open
.top-line::after
.logo-items picture
.footer__logo

================================

investopedia.com

INVERT
.widget-ticker-container
.mntl-dotdash-universal-nav__logo

================================

invisioncommunity.com

INVERT
img[src*="customer_logos.png"]
img[src*="logo_dark.png"]
img[src*="footer"]
.cDownloadsCategoryCount

CSS
.ipsBadge {
    --darkreader-bg--badge--background: var(--darkreader-neutral-background) !important;
}
.ipsReact_reactCount > a,
.ipsReact_reactCount > span,
.elFullInbox_menu,
.ipsMenu_auto,
.ipsMenu_footerBar,
.ipsMenu_headerBar,
.ipsMenu_innerContent,
.ipsMenu_item,
.ipsMenu_sep,
.ipsMenu_title,
.ipsPadding {
    background-color: var(--darkreader-neutral-background) !important;
}

================================

inwestomat.eu

CSS
main {
    background-color: var(--darkreader-neutral-background) !important;
}

================================

iopscience.iop.org

INVERT
.article-text img[alt^="$"]

================================

ip-api.com

INVERT
img[alt="logo"]

================================

ipinfo.io

INVERT
.navbar-brand

================================

ipko.pl

INVERT
a[href="#"]:has(span)

CSS
._1IGN3 {
    background-size: 75px 56px !important;
}
._3cnGx::before {
    background-size: 112px 80px !important;
}
._3o8il {
    background-size: 48px 48px !important;
}
._2A4oT::before {
    background-size: 36px 38px !important;
}

================================

iplocation.net

INVERT
img[src="/assets/images/logo.png"]

================================

iqiyi.com

INVERT
.qy-micro-bg

================================

irishtimes.com

INVERT
.masthead-block-logo img

================================

is.muni.cz

INVERT
.isElInput_label_latex
.se-tex-img

================================

isbgpsafeyet.com

CSS
h1,
h2,
h3,
h4,
h5,
h6 {
    color: rgb(255, 255, 255) !important;
}
.Hero,
.Footer {
    background: None !important;
}
.Button-is-primary {
    background: var(--primary-background-color);
}

================================

isharkieblanket.com

CSS
.gradient {
    background: var(--darkreader-neutral-background) !important;
}
h1,
h2,
h3,
h4,
h5,
.h0,
.h1,
.h2,
.h3,
.h4,
.h5,
.header__active-menu-item,
.header__menu-item,
.color-background-1,
.color-background-2,
.color-inverse,
.list-menu__item--link,
.localization-selector.link,
.price,
.rte a,
.shopify-payment-button__more-options,
.link {
    color: var(--darkreader-neutral-text) !important;
}

================================

ising.pl

CSS
body.grey-gui-bg #content,
div.grey-gui-bg,
.small-navy-heading,
.small-blue-heading,
.small-purple-heading,
.small-navy2-heading {
    background-image: none !important;
}

================================

isitdownrightnow.com

CSS
.ts1,
.ts2,
.ts3,
.ts4,
.ts5,
.ts6,
.ts7,
.ts8,
.ts9,
.ts10,
.ts11,
.ts12,
.ts13,
.ts14,
.ts15,
.ts16,
.ts17,
.ts18,
.ts19,
.ts20,
.ts21,
.ts22,
.ts23,
.ts24,
.ts25,
.ts26,
.ts27,
.ts28,
.ts29,
.ts30,
.ts31,
.ts32,
.ts33,
.ts34,
.ts35,
.ts36,
.ts37,
.ts38 {
    background-image: none !important;
}

================================

istanbulfm.com.tr

CSS
#jarallax-container-0 {
    z-index: 0 !important;
}

================================

italy-vms.ru

INVERT
#main_logo

================================

itbiznes.pl

INVERT
.custom-logo

================================

itch.io

INVERT
.header_widget .mobile_nav_btn
img[src="https://static.itch.io/images/logo-black-new.svg"]

CSS
.index_page .app_banner .outline_button,
.youtube_game_promo_banner_widget .game_information .cta_button {
    border-color: var(--darkreader-neutral-text) !important;
}

================================

item.jd.com

IGNORE IMAGE ANALYSIS
*

================================

itemfix.com

INVERT
.logo-outer
.footer-logo
a[href="ll"]

================================

ithardware.pl

INVERT
.navbar-brand
a[href*="uzywki.expert"]
a[href*="rankingi"]
a[href*="feed"]

================================

iu-fernstudium.de

INVERT
.cp-logo
.cp-contact-bubble__svg-open
svg[class$="transform"]

================================

iubenda.com

INVERT
img[alt="Iubenda logo"]

================================

iupts.org

CSS
body,
.loginbg {
    background-image: none !important;
}

================================

ixbt.com

CSS
body {
    background-color: var(--darkreader-neutral-background) !important;
    color: var(--darkreader-neutral-text);
}

================================

jacobin.com

INVERT
.hm-sd-b-ty
.hm-sd-b-ty > *
.po-cn .po-cn__intro
.po-cn .po-cn__intro > *
.po-cn .po-cn__rule
.po-hr-cn
.po-hr-cn > *
.pq::after
.pq::before
.si-hr-nv__icon--menu

================================

jailbreak.fce365.info

CSS
body {
    background-image: none !important;
}

================================

jakdojade.pl

INVERT
#main-map

================================

jamboard.google.com

INVERT
.docs-icon-img-container
.jam-button-content
.jam-icon-palette-black
.jam-icon-sticky-note-black

================================

jamendo.com

INVERT
.player-volume_range_track
.player-volume_range_fill

================================

japscan.lol

CSS
body {
    background-image: none !important;
}

================================

jared.com
kay.com
banter.com
peoplesjewellers.com
zales.com

INVERT
.company-logo

================================

java.com

INVERT
html #jvc0v2.bg1 .jvc0w1
html #jvc0v2.bg3 .jvc0w1
html #jvc0v2.bg5 .jvc0w1

================================

jbl.com

CSS
.product-tile .product-image .thumb-link img {
    mix-blend-mode: normal !important;
}
.search-refinement,
i[class^="icon"].hidden-xs {
    color: var(--darkreader-neutral-text) !important;
}
.product-tile .product-image {
    background-color: white !important;
}
.product-tile .product-swatches .swatch-list li.selected img,
.product-tile .product-swatches .swatch-list li.selected:hover img {
    border-color: white !important;
}

================================

jegy.mav.hu

INVERT
.service-icon-container
.standard-icon-size

CSS
.text-content .box {
    color: black !important;
}
div[style='background-image: url("https://jegy.mav.hu//PlaceReservationIcons/Graphic/Cars/wagon_base-empty.svg");'] span {
    color: black !important;
}

IGNORE INLINE STYLE
g[id*="ules"] path
#seat-info-container svg path
span

================================

jenkins.io

IGNORE INLINE STYLE
.logo-jenkins *

================================

jewishcurrents.org

INVERT
img[alt="Jewish Currents"]

================================

jira.*.com

INVERT
.aui-dropdown2-trigger::after

================================

jira.*.services

CSS
.hstbad {
    z-index: 1 !important;
}

================================

jisho.org

INVERT
h1.logo
.stage

================================

jlcpcb.com
*.jlcpcb.com

IGNORE INLINE STYLE
svg *

================================

jobs.github.com

CSS
#page {
    background-image: none !important;
}

================================

joemonster.org

INVERT
#commentHeader
.art-details span
.item-vote-down
.logo
.moderb
.mtv-item-not-working
.vote-down
.vote-up

CSS
body {
    background-image: none !important;
}

================================

johnhorgan.org

CSS
.column-sidebar-02 h4,
.column-sidebar-02 div,
.column-sidebar-02 a {
    color: ${white} !important;
}

================================

joincake.com

INVERT
.theme-revamp .bg-wave
.theme-revamp .bg-wave > *

CSS
.theme-revamp .bg-wave {
    background-color: white !important;
}

================================

joinhoney.com
*.joinhoney.com

INVERT
img[src$="paypal-honey-logo-bl.svg"]
img[src$="star-honey-rating.svg"]

CSS
#lp-pom-block-11 {
    background-color: black;
}

================================

joinpickleheads.com
*.joinpickleheads.com

CSS
.bg-\[\#E5E7EB\] {
    background-color: gray !important;
}
.bg-\[\#111827\] {
    background-color: darkblue !important;
}
span.inline-block.rounded-full.bg-white {
    background-color: rgb(255 255 255/var(--tw-bg-opacity)) !important;
}

================================

jojowiki.com

CSS
.mw-body {
    background-image: none !important;
}

================================

joplinapp.org

CSS
#in-the-press-section {
    background-image: none !important;
}

================================

journal.tinkoff.ru

INVERT
._17-LK > span
._3aEco
._1Dhxk
.uVy35.V6dif::before
._38Vkx.FrrKu::after
._3LO60._4GqdT::after
.PwECA
.best-authors__arrow.best-authors__arrow--active
.best-authors__arrow
label[class^="hamburgerMenu"]

================================

journals.aps.org

INVERT
a.logo-link

CSS
.headline,
.teaser p,
h1,
p.description-text,
.content-container .title,
.content-container .title-description,
.description-container {
    color: var(--darkreader-neutral-text) !important;
}
.card,
.article-fulltext-figure-heading {
    background-color: ${rgb(249,249,249)} !important;
}
summary,
.export-article-citation,
.physh-concept {
    background-color: ${rgb(225, 225, 225)} !important;
    color: ${rgb(0, 83, 139)} !important;
}
summary:hover,
.export-article-citation:hover,
.physh-concept:hover {
    background-color: rgb(0, 64, 105) !important;
    color: white !important;
}
figcaption p {
    color: ${rgb(107, 107, 108)} !important;
}

================================

jpl.nasa.gov

CSS
.brand_area {
    background-image: url("https://www.jpl.nasa.gov/assets/images/logo_nasa_trio_white@2x.png") !important;
}

================================

jpmorgan.com

INVERT
.first-logo

================================

jpost.com

INVERT
img[alt*="The Jerusalem Post"]
img[class*="header"]
.btn-digital-library-header > img

================================

jsdelivr.com

INVERT
.navbar-brand > img

================================

jsr.io

CSS
.pl-smi {
    color: ${black} !important;
}
.pl-s {
    color: ${#313688} !important;
}
.pl-c1 {
    color: ${#2f84d0} !important;
}
.pl-en {
    color: ${#009759} !important;
}
.ddoc :not(.highlight) > code {
    background-color: ${#ccd4da} !important;
}
.ddoc a > code {
    color: ${#205faa} !important;
}
#usageSelector > summary {
    background-color: ${white} !important;
}
.markdown_summary p code {
    color: white !important;
    opacity: 0.50 !important;
}
html[data-darkreader-scheme="dimmed"] .markdown_summary p code {
    filter: invert(100%) hue-rotate(180deg) !important;
}

================================

jsware.net

INVERT
img[src="since.gif"]

CSS
h5.H5Dex,
td.Dex {
    background: unset !important;
}

================================

juejin.cn

INVERT
.equation

================================

jumia.*
jumia.*.*
zando.co.za

INVERT
svg.ic[role="img"]:not([aria-label="Zando logo"])
.logo > a > img
.inbox > a:not(:nth-of-type(1)) > svg
img[src*="jumia-group-logo.png"]
img[src*="jumia_logo_small_checkout.png"]
img[src*="/Jumia-Pay"]
li.logo:nth-child(1) > .-i-jumia-logo
.-ecosystem > a.-category.-inlineblock.-vatop:not([href*="mall"]) > img
img[src*="empty-cart.png"]
.-header > img:nth-child(1)
.-gy5 > .-fs0 > .vent-link[title*="Rewards"]
.-gy5 > .-fs0 > .vent-link[title*="Pay"]
.-gy5 > .-fs0 > .vent-link[title*="Primo"]
.-gy5 > .-fs0 > .vent-link[title*="Food"]
.-gy5 > .-fs0 > .vent-link[title*="Party"]
.-gy5 > .-fs0 > .vent-link[title*="Now"]
.col4 > .s-menu > a:not(:nth-child(1)):not(:nth-child(3)):not(:nth-child(7)) > svg
div.-fw-w:nth-child(1) > a.-fs0 > img
article.-df > svg > use
svg.ic.xprss
div.-df.-d-co.-c-bet > h3.-fw > svg.ic
a.fk-cb.-me-start.-fsh0 > svg.ic.-h-24

================================

justhost.ru

INVERT
.header__logo

================================

justjoin.it

CSS
.css-oi8ccm {
    height: 98px !important;
}

================================

justtherecipe.com

INVERT
flt-glass-pane

================================

juwai.com

INVERT
.c-header__logo
.c-responsive-navigation__logo

================================

jvc.net

INVERT
img[src="img/logo.jpg"]

================================

k-report.net

CSS
.dfzlu1 div,
#diskuse_zahlavi a,
.dfprofil,
#diskuse_zahlavi td {
    color: var(--darkreader-neutral-background) !important;
}

================================

kaggle.com
kaggleusercontent.com

CSS
div.output_png img {
    background-color: ${black} !important;
}

IGNORE INLINE STYLE
div.output_png img

================================

kahoot.it

INVERT
main[data-functional-selector="correct-answer"] > div > div > div > svg > g > path
main[data-functional-selector="incorrect-answer"] > div > div > div > svg > g > path
main[data-functional-selector="time-up-answer"] > div > div > div > svg > g > path
div[data-functional-selector="kahoot-settings__language-picker"] > div > div > div > div > img
.sc-iqxcLP.klWCeb
g#Background
g#Greyscale
span[data-functional-selector="kahoot-logo"] > svg > g > path

IGNORE INLINE STYLE
[data-functional-selector^="answer"]
[data-functional-selector="intro-animation-animation_pre-question-animation"] *

IGNORE IMAGE ANALYSIS
*

================================

kaldata.com

IGNORE IMAGE ANALYSIS
.tdi_112 .tdb-featured-image-bg

================================

kali.org

CSS
#kali-platforms .card > div {
    background-image: none !important;
}

IGNORE IMAGE ANALYSIS
#banner-logo

================================

kamigame.jp

CSS
article,
.article {
    background-image: none !important;
}

================================

kaos-community-packages.github.io

INVERT
.Header-brand

================================

kaosx.us

INVERT
.Header-brand img

================================

kapitanbomba.pl

INVERT
.custom-logo

================================

kartotekaonline.pl

CSS
body {
    background-image: none !important;
}

================================

kasmedia.com

CSS
.flex {
    z-index: 1 !important;
}
.z-10 {
    z-index: 0 !important;
}

================================

katahiromz.web.fc2.com

CSS
body {
    background-image: none !important;
}

================================

kaytrip.com

INVERT
.date
.jd_ss
.liuchengt
.nApp
.nTel
.n_app
.tt_t
.wmap

CSS
#imageField {
    background-color: transparent !important;
}
.jd_xl {
    filter: none !important;
}

================================

kbb.com

IGNORE INLINE STYLE
svg[class*="LogoText"] g

================================

kcsoftwares.com

CSS
.status-10-fg {
    color: #FF14FF !important;
}
.status-20-fg {
    color: #FF2190 !important;
}
.status-30-fg {
    color: #FFF719 !important;
}
.status-40-fg {
    color: #FF1919 !important;
}
.status-50-fg {
    color: #0062FF !important;
}
.status-80-fg {
    color: #47FF19 !important;
}
.status-90-fg {
    color: #727985 !important;
}

================================

keep.google.com

INVERT
img[src$="google_gsuite"]
.gb_hc

================================

keepa.com

INVERT
div#loadingIcon
div.pLText

================================

keepass.info

INVERT
img[src="help/images/trans.png"]

CSS
body {
    background-image: none !important;
}

================================

keepassxc.org

CSS
.btn-primary {
    color: var(--darkreader-neutral-background) !important;
}

================================

kelkoo.it

IGNORE INLINE STYLE
svg *

================================

kenh14.vn

CSS
.kbwcb-left,
.kbwcb-left::before {
    background-image: none !important;
}

================================

kenmore.com

INVERT
.navbar-brand

================================

kenwood.com

INVERT
.logo01

================================

kernel.org

INVERT
img[src*="understand"]

================================

keychron.*

INVERT
img[src*="keychron-logo-transparent"]
img[src*="keychron_600_V1.png"]
.btn--secondary

CSS
body,
.header,
.product-info,
.footer {
    background-color: var(--darkreader-neutral-background) !important;
}

================================

keyserver.pgp.com

INVERT
a.button-text
#ImPGPComHelp
#ImPGPComHome
[src="images/crystal_button_left.gif"]
[src="images/crystal_button_left-dark.gif"]
[src="images/crystal_button_right.gif"]
[src="images/crystal_button_right-dark.gif"]
[src="images/global_dir_logo_web.gif"]
[background="images/crystal_button_fill.gif"]
[background="images/crystal_button_fill-dark.gif"]

CSS
.card-top,
.card-top-left-corner,
.card-top-right-corner,
.divide-fill,
.header-bar-left,
.header-bar-right,
.title-left,
.title-right {
    background-image: none !important;
}

================================

kfccoupons.co.nz

CSS
.img-container {
    z-index: 0 !important;
}
.img-container > img {
    filter: brightness(50%) sepia(40%) !important;
}

================================

khronos.org

INVERT
.navbar-brand

================================

kiedyprzyjedzie.pl

INVERT
.cluster-marker div
.leaflet-pane > .leaflet-layer

CSS
.cluster-marker div span {
    color: var(--darkreader-neutral-background) !important;
}

================================

killedbygoogle.com

INVERT
img[src*="e.svg"]
img[src*="-logo"]

================================

kingston.com

INVERT
.s-kt-navigation .nav-logo img

================================

kinhmatanna.com

INVERT
img[src$="/logo-anna.svg"]
img[src$="/anna-text.svg"]
i.eicon
.elementor-button-icon > svg
.elementor-button-icon > svg > g

CSS
.elementor-button-icon::before {
    z-index: 1 !important;
}
.elementor-icon svg {
    fill: #f0f0f0 !important;
}
a[href="/danh-muc-san-pham/gong-kinh/"] {
    background-color: black !important;
    border-color: black !important;
    color: white !important;
}
a[href="/danh-muc-san-pham/gong-kinh/"]:hover {
    filter: invert(100%) contrast(90%) !important;
}
.product:not(div[data-elementor-type="product-archive"]) {
    background-color: #121212 !important;
}
.ast-container > div > section:nth-child(4) > div > div:nth-child(2) > div > div:nth-child(4) {
    z-index: 0 !important;
}

================================

kinoart.ru

INVERT
main > div > svg
header > a > svg
footer > div > svg
header > div > a > svg

================================

kinopoisk.ru

CSS
input[name="kp_query"]::placeholder {
    background-image: linear-gradient(45deg, var(--darkreader-neutral-text) 70%, transparent 100%) !important;
}
input[name="kp_query"] {
    background-color: ${lightgray};
}
input[name="kp_query"]:focus {
    background-color: ${rgb(195, 195, 195)};
}

================================

kinsta.com

INVERT
.wp-block-kinsta-hero-title
.wp-block-kinsta-hero-title > *

================================

kinzhal.media

INVERT
img[src$="logo.svg"]
img[src$="search.svg"]
img[src$="close.svg"]
.footer-soc
.footer__18
.kinzhal-icon

================================

kioxia.com

INVERT
.header__logo

================================

kipling-usa.com

IGNORE INLINE STYLE
[id^=powered_by_pixlee]

================================

kivra.se

CSS
.FullSizeHero-module--background-image--8c4a3 {
    opacity: 0.75;
    z-index: 0;
}

================================

klarna.com
*.klarna.com

CSS
input {
    -webkit-text-fill-color: var(--darkreader-neutral-text) !important;
}

================================

klibs.io

CSS
.rs-text_hardness_hard:not(a),
.rs-text_hardness_average:not(a),
.rs-h1:not(a) {
    color: var(--darkreader-neutral-text) !important;
}
label[data-test="menu-item"] span:not([data-test="checkbox"]) {
    color: white !important;
}

================================

klubjagiellonski.pl

INVERT
.logo
.site_hamb svg

================================

knaben.eu

INVERT
a[href="https://matrix.to/#/#general:knaben.org"]

CSS
form .text-darker,
div.text-bright,
div.text-darker,
pre.text-bright,
h3.text-darker,
h1.text-darker,
h2.text-bright,
button.text-darker {
    color: var(--darkreader-text-netural) !important;
}

================================

knife.media

INVERT
svg[class$="logo-image"]
.explorer__header-close

================================

knossos.sice.com

CSS
#sidebar {
    background: var(--darkreader-neutral-background) !important;
    color: var(--darkreader-neutral-text) !important;
}
input,
select,
textarea {
    background: var(--darkreader-neutral-background) !important;
    color: var(--darkreader-neutral-text) !important;
}
.drdn-trigger,
tr.group td {
    background: var(--darkreader-neutral-background) !important;
    color: var(--darkreader-neutral-text) !important;
}

================================

knowyourmeme.com

INVERT
.enlargeNavigation > #enlargeNav-prev
.enlargeNavigation > #enlargeNav-next

================================

ko-fi.com

INVERT
img[alt="Ko-fi Logo"]
.ui-mobile-nav-toggle

================================

kohls.com

INVERT
.top-global-header #logo

================================

koji.fedoraproject.org
koji.rpmfusion.org

CSS
* {
    border: none !important;
    margin: auto !important;
    padding: 5px !important;
}
body {
    background-blend-mode: multiply !important;
    background-color: var(--darkreader-neutral-background) !important;
    color: var(--darkreader-neutral-text);
}
.footer {
    position: relative !important;
}
table.data-list td {
    vertical-align: top !important;
}
tr.list-header,
.taskclosed,
.taskclosed:visited,
.taskclosed:hover,
.taskfailed,
.taskfailed:visited,
.taskfailed:hover,
.taskfree,
.taskfree:visited,
.taskfree:hover,
.taskopen,
.taskopen:visited,
.taskopen:hover,
td.tree,
.tree span.root,
.tree span.treeLabel {
    background-color: transparent !important;
}
tr.list-header th {
    background-color: var(--darkreader-background-dddddd);
}
tr.row-odd {
    background-color: var(--darkreader-background-ffffff);
}
tr.row-even {
    background-color: var(--darkreader-background-eeeeee);
}
span#loginInfo,
#headerSearch input[type="submit"] {
    background-color: transparent !important;
}

================================

komorkomat.pl

INVERT
.navbar-brand > img
.owl-wrapper
.result-item-logo

================================

komputerswiat.pl

INVERT
.serviceLogoImg
.serviceIcon
.secondaryLogoImg

================================

konicaminolta.us

INVERT
#km_Header .logo img

================================

konkret24.tvn24.pl

INVERT
.header-left-corner__logo
.menu-button__bars
.report-toggle-button__icon
.search-panel-toggle-button__icon

================================

konto.onet.pl

INVERT
img[alt="Business Insider"]
img[alt="Onet Konto"]
img[alt="Onet Poczta"]
img[alt="Menu aplikacji"]
img[alt="Powiadomienia"]

IGNORE INLINE STYLE
div[class="sc-50572c49-8 kbIkEh"]

================================

kopalniawiedzy.pl

INVERT
img[alt="Patronite"]

================================

korso24.pl
korsosanockie.pl

INVERT
img.weather-box__img
.nav-top__logo-wrapper
.nav-top__footer-burger > div > span
a.footer__logo

================================

kort.foroyakort.fo

INVERT
.header-section > a:first-child
.container-section > .icon-node

================================

kraken.com

CSS
header > nav > ul > li > a::after,
span[data-testid^="asset-pair"][data-testid$="-low"] + div > :last-child {
    background-color: var(--darkreader-neutral-text) !important;
}

================================

krew.info

INVERT
a[class*="kropla"]

================================

krita.org

CSS
.container {
    background: none !important;
}

================================

krytykapolityczna.pl

INVERT
img[src*="logo"]

================================

ksiegowawsieci.pl

INVERT
.logo

================================

kubuntu.org

INVERT
.logo

================================

kulinarnyblog.pl

INVERT
.logo-img

================================

kwyk.fr

CSS
body {
    background-image: none !important;
}

================================

kyivindependent.com

INVERT
.custom-logo-link
.donate__patreon::before

================================

l10n.kde.org

CSS
body {
    background-image: none !important;
}

================================

labcorp.com

INVERT
.logo

================================

labfolder.com

CSS
:root {
    --secondary-color: ${#002b56} !important;
}

================================

laczynasnapiecie.pl

INVERT
.navbar-brand
.tim-power
.row-partners-logo a

================================

ladybird.org

INVERT
.text-black img

CSS
.text-\[\#000\] {
    text-shadow: ${rgb(225, 212, 201)} 1px 1px 0px !important;
}

================================

lafibre.info

CSS
.frame,
#header {
    background-image: none !important;
}

================================

lajtmobile.pl

CSS
body > * {
    --background: var(--darkreader-neutral-background) !important;
}
.ls-bg-wrap > img,
.generatorTemplate > .columnsBlockGeneratorBlock.mobileHide {
    filter: brightness(50%) sepia(40%) !important;
}
.columnsBlockGeneratorBlock .offertBlock:not(.highlightOffert),
.generatorTemplate > .columnsBlockGeneratorBlock.mobileHide,
.summaryModule,
.formModule,
input[type="text"] {
    background: var(--darkreader-neutral-background) !important;
}
.generatorTemplate > .columnsBlockGeneratorBlock.mobileHide > * {
    background: ${#FEF} !important;
}

================================

lambda-the-ultimate.org

CSS
a {
    color: #3391ff !important;
}

================================

lambdalabs.com

INVERT
.lambda-logo

================================

lambdatest.com

INVERT
.tools_logo a img

================================

landscan.ornl.gov

INVERT
img[src*="tile.openstreetmap.org"]
img[src*="landscan.ornl.gov/tiles"]

CSS
.global-key-values .square1 {
    background-color: ${${#15150d}};
}
.global-key-values .square2 {
    background-color: ${${#1f1f0d}};
}
.global-key-values .square3 {
    background-color: ${${#2e2e0d}};
}
.global-key-values .square4 {
    background-color: ${${#9b4e0d}};
}
.global-key-values .square5 {
    background-color: ${${#f2690e}};
}
.global-key-values .square6 {
    background-color: ${${#f29191}};
}
.global-key-values .square7 {
    background-color: ${${#f2a4a4}};
}
.global-key-values .square8 {
    background-color: ${${#f2c6c6}};
}
.hd-us-key-values .square1 {
    background-color: ${${#15150d}};
}
.hd-us-key-values .square2 {
    background-color: ${${#1f1f0d}};
}
.hd-us-key-values .square3 {
    background-color: ${${#2e2e0d}};
}
.hd-us-key-values .square4 {
    background-color: ${${#9b4e0d}};
}
.hd-us-key-values .square5 {
    background-color: ${${#f27c38}};
}
.hd-us-key-values .square6 {
    background-color: ${${#f29a9a}};
}
.hd-us-key-values .square7 {
    background-color: ${${#f2c6c6}};
}

================================

languagetool.org

INVERT
#checktext_ifr

================================

laptopmag.com

INVERT
div#publisherDetails.logo
.qc-cmp-publisher-logo

================================

laravel.com

CSS
.bg-gray-100,
aside > div {
    background-color: var(--darkreader-neutral-background) !important;
}

================================

last.fm

INVERT
.resource-external-link--homepage::before
.share-option
.report-headline-share
.avatar-status-dot
.toggle-button::before
.js-playlink::before
.js-playlink-station::before
.header-new-playlink::before
.header-new-more-button::before
.dropdown-menu-clickable-item::before
.play-this-track-playlink--itunes::before
.resource-external-link--apple-music::before

CSS
.user-dashboard-loved-tracks .user-dashboard-big-datapoint-value a {
    color: ${#666666} !important;
}
.user-dashboard-catalogue-item-total a {
    color: ${#666666} !important;
}
.highcharts-text-outline {
    stroke: none !important;
}
.user-dashboard-scalable-content span {
    color: ${#666666} !important;
}
.linkfire-button {
    --darkreader-border--play-arrow-color: var(--gray-50) !important;
}
.promo-v3 .listening-report-promo-date::after {
    filter: invert(0.5) !important;
}
.js-playlink::before,
.header-new-playlink::before {
    background-color: hsla(0,0%,100%,.85) !important;
}
.js-playlink-station::before {
    background-color: hsla(0,0%,100%,.85) !important;
    background-image: url("/static/images/icons/play_dark_32.2d17859fb8d8.png") !important;
}
.artist-header-featured-items-item-playlink::before,
.image-overlay-playlink-link::before,
.recs-feed-playlink::before {
    background-image: url("/static/images/icons/play_dark_24.44cbb56c2236.png") !important;
}
.chartlist-play-button::before,
.stationlink::before,
.header-new-playlink::before {
    background-image: url("/static/images/icons/play_dark_16.e469e7d1482a.png") !important;
}
.highcharts-background {
    fill: transparent !important;
}
.adaptive-skin-container,
.container.page-content,
.container.content-top-lower,
.shout-user a,
textarea.js-shout-input,
.content-top-inner-wrap,
textarea#id_tags {
    background-color: var(--darkreader-neutral-background);
    color: var(--darkreader-neutral-text);
}
.navlist-hidden-list-wrap * {
    background-color: var(--darkreader-neutral-background);
    color: var(--darkreader-neutral-text) !important;
}
.chartlist-row:hover,
.section-with-separator::after,
.navlist-hidden-list-wrap a:hover {
    background-color: rgba(255, 255, 255, 0.05) !important;
}
.chartlist-row--now-scrobbling,
.subscribe-cta {
    background-color: ${#fff9e5} !important;
}
.chartlist-count-bar-slug {
    background-color: ${rgb(255, 192, 192)} !important;
}
.alert-success {
    background-color: ${#e5f4ef} !important;
}
.shout--deleted {
    background: ${#f9f9f9} !important;
}
.two-column-layout .container {
    background-image: none !important;
}

IGNORE INLINE STYLE
.page-loading-logo-container *
.highcharts-series-group *
.highcharts-legend *:not(text)

IGNORE IMAGE ANALYSIS
.masthead-logo-loading
.masthead-logo
.tag-label--average-daily-scrobbles::before
.report-headline-border
.header .header-background::before
.chartlist-play-button::before
.stationlink-list .stationlink::before
.featured-item-art .image-overlay-playlink-link::before
.header-new-playlink::before
.header-new-love-button::before
.header-new-bookmark-button::before
.header-new-more-button::before
.more-item--obsession::before
.more-item--artist-link::before
.buylink.buylink--amazon::before
.buylink.buylink--itunes::before
.buylink.buylink--ebay::before
.play-this-track-playlink--itunes::before

================================

lastpass.com

INVERT
.lp-header__logo--link

================================

latex.wikia.org

INVERT
.mwe-math-fallback-image-inline
.mwe-math-fallback-image-display

================================

latimes.com

INVERT
.page-logo
.page-header-logo

================================

launchpad.net

INVERT
.edit-controls
#launchpad-logo-and-name

CSS
.footer .lp-arcana {
    background-image: none !important;
}

================================

laurelroad.key.com

INVERT
img[src="images/logo-lrd.svg"]
.hds-header-logo__img

CSS
.kds-layout__grid {
    background-color: var(--darkreader-neutral-background) !important;
}

================================

leafblowerguide.com

CSS
.noUi-handle,
.noUi-target {
    border-color: #8c8273 !important;
}

================================

leagueoflegends.com

INVERT
[data-testid="featurednews"] div[class^="style__ItemWrapper"] div[class^="style__Container"] canvas
.bxrpQD

CSS
article > div > canvas[class^="style__Canvas"] {
    display: none !important;
}
div[class^="style__NavContent"] {
    background-color: var(--darkreader-neutral-background) !important;
}

================================

lear.com

INVERT
.logo

================================

learn.inside.dtu.dk

INVERT
.pdfViewer
svg
d2l-icon
d2l-button-icon

CSS
a {
    color: var(--darkreader-neutral-text) !important;
}
:html {
    --d2l-color-celestine-plus-2: var(--darkreader-neutral-background) !important;
}
:host {
    --d2l-dropdown-background-color: var(--darkreader-neutral-background) !important;
    --d2l-input-background-color: var(--darkreader-neutral-background) !important;
    --d2l-list-item-content-text-color: var(--darkreader-neutral-text) !important;
    --d2l-menu-background-color: var(--darkreader-neutral-background) !important;
    --d2l-menu-background-color-hover: var(--darkreader-neutral-background) !important;
    --d2l-tabs-background-color: var(--darkreader-neutral-background) !important;
}
.d2l-navigation-s-personal-menu-text,
.d2l-menu-item-text,
.d2l-body-small,
.d2l-heading,
d2l-htmleditor-menu-item,
d2l-empty-state-simple,
button {
    color: var(--darkreader-neutral-text) !important;
}
.d2l-card-link-container,
.d2l-card-footer,
.d2l-floating-buttons-container,
.d2l-htmleditor-container,
.d2l-dialog-outer,
d2l-card,
d2l-list-item-generic-layout {
    background-color: var(--darkreader-neutral-background) !important;
}

================================

learn2.open.ac.uk

CSS
.oucontent-quote p {
    color: ${grey} !important;
}

================================

learningstylequiz.com
*.learningstylequiz.com

CSS
:root {
    --wt-text-on-background-color: var(--darkreader-text--wt-text-on-background-color) !important;
}

================================

learnopengl.com

CSS
#hover {
    background-image: none !important;
    opacity: 1 !important;
}

================================

learnroadrunner.com

INVERT
img[src*="YouAreHere"]
img[src="/assets/advanced/termination-flow.svg"]
img[src="/assets/img/max-vel-latex-half.319e0372.png"]
.u-wrap

================================

learnyouahaskell.com

CSS
.hintbox {
    background-color: ${rgb(249, 249, 147)} !important;
    background-image: none !important;
}

================================

leetcode.com
leetcode-cn.com

INVERT
img[alt="logo"]
.cursor
.CodeMirror-cursor
.user-story-chapter-base .companies-showcase-base .logo

CSS
div[class^="data-structure-viewer"] g[class^="node"] > circle {
    fill: var(--darkreader-neutral-background) !important;
}
[class^=question-picker-detail] {
    background: none !important;
}
.monaco-editor,
.monaco-editor-background,
.monaco-editor .margin {
    background-color: var(--darkreader-neutral-background) !important;
}
div#solution img {
    background-color: ${black};
}

================================

legacy.com

CSS
.Directory {
    background-image: none !important;
}

================================

lemonde.fr

INVERT
.logo__lemonde

================================

lenovo.com

INVERT
.m-megaMenu

CSS
.m-mastheadUtilityLinks {
    background: none !important;
}

================================

leroymerlin.*

CSS
.kl-tile__group {
    filter: invert(0%) !important;
}
.kl-tile .kl-blade--figure {
    z-index: 0 !important;
}

================================

lesbonscomptes.com

CSS
.important {
    background-color: rgb(92, 92, 61) !important;
}

================================

letters.gov.spb.ru

INVERT
.leaflet-map-pane

================================

letyshops.com

INVERT
.header-logo-image

================================

lever.co

INVERT
a.main-header-logo
div.site-branding

================================

lexar.com

INVERT
.page_header_wrapper a.logo img

================================

lg.com

INVERT
.logo
img[src*="/features/"]

================================

liberte.pl
sklep.liberte.pl

INVERT
img[src*="liberte_logo.svg"]
img[src*="libertesklep.svg"]
.hamburger

================================

libravatar.org

INVERT
footer::before
.hero::before

================================

libretexts.org

CSS
.mt-content-container img:hover {
    background-blend-mode: normal;
    background-color: rgba(255, 255, 255, 0.75) !important;
}

================================

librewolf-community.gitlab.io

INVERT
[src="/images/search.svg"]
[src="/images/no-looking.png"]

================================

librewolf.com

CSS
.docs-container .max-w-screen-md .screenshot + .inner {
    background-image: linear-gradient( 180deg, rgba(255, 255, 255, 0) 0%, rgba(26, 24, 26, var(--darkreader-bg--tw-bg-opacity)) 50% ) !important;
}

================================

librivox.org

INVERT
.logo

CSS
.main-content-home,
.homepage-main-wrap,
.homepage-main-block p span {
    background-color: var(--darkreader-neutral-background) !important;
    border-color: transparent !important;
}
.box_1 {
    background-color: ${#eaefdf} !important;
}
.box_2 {
    background-color: ${#e0eef1} !important;
}
.post-wrap,
.page-wrap {
    background-color: ${#f8f8f5} !important;
}
.statistics-wrap {
    background-color: unset !important;
}

================================

licensing.biz

INVERT
.logo

================================

lichess.org

CSS
.time {
    z-index: 0 !important;
}

IGNORE INLINE STYLE
cg-container > svg > line

IGNORE IMAGE ANALYSIS
.is2d .bishop.black
.is2d .king.black
.is2d .knight.black
.is2d .pawn.black
.is2d .queen.black
.is2d .rook.black
.brown .is2d cg-board

================================

life360.com

INVERT
.site-header .header-brand img

================================

lifelock.com

INVERT
.c-topnav__logo-link

================================

lightning.force.com
*.lightning.force.com

INVERT
.chart
.legend

CSS
.slds-brand-band,
.slds-brand-band::after,
.slds-brand-band_cover,
.slds-brand-band_medium,
.slds-page-header,
.slds-utility-bar,
.slds-tabs_card,
.slds-card-wrapper,
.slds-grid,
.slds-clearfix {
    background-color: var(--darkreader-neutral-background) !important;
}
.slds-card {
    background-color: ${rgb(201, 201, 201)} !important;
}
.slds-button_neutral,
.slds-button--neutral {
    color: ${rgb(1, 118, 211)} !important;
}

================================

lightningmaps.org

INVERT
.bo_map_realtime
.live_ctrl > img
.tiles_radar

================================

lingvoforum.net

INVERT
div#header
div#header img.avatar
span.topslice
span.botslice

CSS
body {
    background-image: none !important;
}
div#header {
    color: black !important;
}
div#header a:link,
div#header a:visited {
    color: black !important;
}

================================

link.springer.com

INVERT
.c-header__brand
img[src$="logo_high_res.png"]

================================

linkedin.com

INVERT
div.artdeco-carousel__item-container img.align-items-center

CSS
:root {
    --color-text-low-emphasis: ${rgba(0,0,0,0.6)};
}
.js-job-card-company-logo {
    background-blend-mode: color;
    background-color: rgba(255, 255, 255, 0.20);
}
.global-footer-compact__linkedin-logo,
li-icon[type="linkedin-logo"],
.bug-text-color {
    fill: ${black} !important;
}
.pds-ge-entry-card__card {
    background: linear-gradient(to bottom, var(--color-action, var(--blue-70, #0073b1)), var(--color-action, var(--blue-70, #0073b1)) 4px, var(--darkreader-neutral-background, #fff) 4px, var(--darkreader-neutral-background, #fff)) !important;
}
.vjs-load-progress {
    background-color: hsla(0,0%,100%,.3) !important;
}
.vjs-play-progress,
.vjs-play-progress::before,
.vjs-volume-level::before,
.vjs-volume-level {
    background-color: #fff !important;
}
.vjs-volume-bar {
    background-color: hsla(0,0%,100%,.4) !important;
}
img[class*="ghost-"],
div[class*="ghost-"] {
    background-size: 100% 100% !important;
}
.artdeco-pill {
    background-color: ${#ccc} !important;
}
img {
    background-color: transparent !important;
}
img[src*="logo"] {
    filter: brightness(75%);
}
.card-layout {
    background-color: var(---darkreader-neutral-background);
}
.member-analytics-addon-insight-v2 {
    background: var(--darkreader-bg--voyager-color-background-brand-accent-1-tint) !important;
}
.comments-highlighted-animation {
    animation: transitionHighlightedBackground 1s backwards !important;
}

================================

linode.com

INVERT
.c-identity__image

CSS
.o-form__input {
    background-color: rgb(41, 44, 46) !important;
    border-color: rgb(232, 230, 227) !important;
    color: rgb(232, 230, 227) !important;
}
.o-form__input:hover {
    background: transparent !important;
}
.o-form__icon::before {
    color: rgb(232, 230, 227) !important;
}
.o-form__input::placeholder {
    color: rgb(232, 230, 227) !important;
}
.o-button,
o-button--secondary {
    background-color: rgb(41, 44, 46) !important;
    border-color: rgb(232, 230, 227) !important;
    color: rgb(232, 230, 227) !important;
}
.o-button:hover {
    background: transparent !important;
}

================================

linotype.com

INVERT
#logo

================================

linustechtips.com

INVERT
.ipsMenu

CSS
:root {
    --darkreader-bg--badge--background: ${white} linear-gradient(rgba(0,0,0,0.9), rgba(0,0,0,0.9)) !important;
}
.ipsHovercard {
    background-color: ${#fff} !important;
}

================================

linux-hardware.org

CSS
#ezcGraphChart > path:first-of-type {
    fill: var(--darkreader-neutral-background) !important;
}

================================

linuxfoundation.org

INVERT
.logo img

================================

linuxgrandma.blogspot.com

CSS
body {
    background-color: var(--darkreader-neutral-background) !important;
    background-image: none !important;
}

================================

linuxuprising.com

INVERT
.logo

================================

lirc.org

CSS
body {
    background: none !important;
}

================================

lists.gnu.org

CSS
a:visited {
    color: ${purple} !important;
}

================================

literia.pl

INVERT
.icon-svg-pinterest
.icons-icon-facebook
.sec-logo
.slick-arrow
a::after
a#logo
span.as-label::before
img[alt="ringier axel springer"]

================================

live.myvrspot.com

INVERT
.img-logo

CSS
.wrap {
    background: var(--darkreader-neutral-background);
}

================================

liveagent.com

INVERT
.Header__logo

================================

livemint.com

INVERT
div.icoMenu
a.icoSearch.iconSprite
a.icoBell.iconSprite
a.icoBookmark2.iconSprite
a.icoBookmark3.iconSprite
a.icoTwit.iconSprite
div.icoShare.iconSprite

================================

liveuamap.com

INVERT
.comment-link::after
.leaflet-pane > .leaflet-layer
.logo
.top-bright > label::after

CSS
.head-news {
    background-image: none !important;
}

================================

lkml.org

INVERT
img[src*="corner"]

CSS
body {
    background-image: none !important;
}
td.c {
    color: ${white} !important;
}
pre[itemprop="articleBody"] a {
    color: ${lightblue};
}

================================

llvm.org
*.llvm.org

CSS
header,
.www_sectiontitle,
.www_sidebar {
    background: none !important;
}

================================

loepenshop.com
bonjourfoto.nl

CSS
body {
    background-image: none !important;
}

IGNORE IMAGE ANALYSIS
div.art-Header-jpeg

================================

login-widget.privatbank.ua

CSS
div[class*="qrContainer"] > div > div {
    background-color: white !important;
}

================================

login.assetpanda.com

CSS
tr,
.main-container {
    background-color: var(--darkreader-neutral-background) !important;
}

================================

login.docker.com

INVERT
span[data-provider^="github"]

CSS
body {
    --page-background-color: var(--darkreader-neutral-background) !important;
}
:root {
    --font-default-color: var(--darkreader-neutral-text) !important;
    --input-background-color: var(--darkreader-neutral-background) !important;
    --input-text-color: var(--darkreader-neutral-text) !important;
    --secondary-button-text-color: var(--darkreader-neutral-text) !important;
    --title-font-color: var(--darkreader-neutral-text) !important;
    --widget-background-color: var(--darkreader-neutral-background) !important;
}

================================

login.live.com

INVERT
div[id$="Proofs"] .tile-img
div.promoted-fed-cred-content > div > div > div > div > img
div#credentialList.form-group > div > div > div > div > div > img
div.pagination-view.has-identity-banner.animate.slide-in-next > div > div > div > img
span.help-button > img
button.backButton > img
img[data-testid="backgroundLogo"]
#outer img

CSS
[data-testid="backgroundImage"] {
    background-image: none !important;
}

================================

login.microsoftonline.com

INVERT
.backgroundImage

================================

login.yahoo.com

INVERT
.social-login
label[for=persistent]::before
#password-toggle-button

IGNORE IMAGE ANALYSIS
.social-login

================================

logowanie.edukacja.olsztyn.eu

INVERT
img[alt="Nagłówek strony"]
img#logo
img[src="/Resources/wylogowano-plansza.jpg"]

CSS
body {
    background-image: none !important;
}

================================

lol.fandom.com

CSS
.bracket-line:not(.l-down)::after,
.bracket-line::before,
.bracket-spacer.horizontal::before {
    border-width: 0 0 2px 0 !important;
}
.bracket-line.z-down::after {
    border-width: 0 0 2px 2px !important;
}
.bracket-line.z-down::before {
    border-width: 2px 2px 0 0 !important;
}
.bracket-line.z-up::before {
    border-width: 0 2px 2px 0 !important;
}
.bracket-line.z-up::after {
    border-width: 2px 0 0 2px !important;
}

================================

lovekrakow.pl

INVERT
.brand

================================

lowendtalk.com

INVERT
.MeMenu > :last-child
.SpBookmarks

================================

lowes.com

CSS
img {
    mix-blend-mode: normal !important;
}

================================

lrt.lt

INVERT
img[src*="/images/logo/logo-"]

================================

lsa.umich.edu

IGNORE IMAGE ANALYSIS
.header-wrap
.giving-wrap

================================

lunapic.com

INVERT
.toolbar-button
.square-toolbar-button

IGNORE INLINE STYLE
.color-well-color

================================

luogu.com.cn

IGNORE INLINE STYLE
.fa-group
.fa-secondary
.fa-primary
.lfe-caption tag status-name

================================

lux.camera

CSS
.u-content-background {
    background-color: var(--darkreader-neutral-background) !important;
}

================================

lyx.org

CSS
body,
#wrapper {
    background-image: none !important;
}
#col-right {
    background: var(--darkreader-neutral-background) !important;
}

================================

m.dianping.com

INVERT
.flash-screen
.header-download-img

================================

m.genk.vn

CSS
.news .li {
    background-image: none !important;
}

================================

m.motonet.fi

CSS
form#haku input[type="text"],
#select_my_motonet {
    color: var(--darkreader-neutral-text);
}

================================

m.slashdot.org

CSS
.slashbar,
.story-prop,
#discussion,
#filler {
    background-image: none !important;
}

================================

mabi.tmpinc.io/numbers/

INVERT
button
img.lock
div.line

CSS
.bit.blue,
.bit.red,
.bit.green {
    border-bottom: 3px solid var(--bit-color) !important;
}
.bit.gray {
    background-color: ${lightgray} !important;
}
label:first-of-type {
    border-left: 1px solid var(--darkreader-neutral-text) !important;
}
label {
    border-bottom: 1px solid var(--darkreader-neutral-text) !important;
    border-right: 1px solid var(--darkreader-neutral-text) !important;
    border-top: 1px solid var(--darkreader-neutral-text) !important;
}
.demo {
    border-color: var(--darkreader-neutral-text) !important;
}
:root {
    --darkreader-border--bit-color: var(--darkreader-neutral-text);
}

================================

machinelearningmastery.com

INVERT
img.size-full.wp-image-7676

================================

macrumors.com

CSS
body,
.js-content,
.widget--3ewetJyi {
    background-color: var(--darkreader-neutral-background) !important;
}
.textRow--3IWlPgCD {
    color: var(--darkreader-neutral-text) !important;
}

================================

madshi.net

CSS
body,
tr,
td {
    background-image: none !important;
}

================================

mafreebox.freebox.fr

CSS
* {
    filter: none !important;
}
.desktop-icon-outer {
    color: #fff !important;
}
body {
    background-image: linear-gradient(rgb(14 14 14 / 50%), rgb(40 40 40 / 50%)), url(../resources/images/fbx/bg_freeboxos.svg);
}
.setting-list-app .setting-app .setting-app-img,
.file-icon-inode_directory,
.x-tree-icon {
    opacity: 1 !important;
}
.freeboxos-southbar .btn-start .x-btn-button {
    background-color: #fff !important;
}

IGNORE IMAGE ANALYSIS
.freeboxos-southbar .btn-start .x-btn-button
body

================================

magazine.skyeng.ru

INVERT
.header__logo__img

================================

magazynbieganie.pl

INVERT
.logo-box

================================

magic.freizeitspieler.de

INVERT
img[src="pics/MtG-Freizeitspieler.gif"]

CSS
body {
    background-image: none !important;
}

================================

magister.net

INVERT
.bottom > img

CSS
.splash-container {
    z-index: 0 !important;
}
.cijfers-k-grid.k-grid .grade.empty {
    background-color: ${#cfcfcf} !important;
    background-image: none !important;
}

================================

mail.eni.it/owa

IGNORE IMAGE ANALYSIS
.image-font-png
.image-font_size-png
.image-bold-png
.image-italic-png
.image-underline-png
.image-backcolor-png
.image-forecolor-png
.image-insertunorderedlist-png
.image-insertorderedlist-png
.image-outdent-png
.image-indent-png
.image-justifyleft-png
.image-justifycenter-png
.image-justifyright-png
.image-createlink-png
.image-unlink-png
.image-superscript-png
.image-subscript-png
.image-strikethrough-png
.image-alttext-png
.image-blockdirltr-png
.image-blockdirrtl-png
.image-undo-png
.image-redo-png
.image-removeformat-png
.image-table_icon-png
.image-insertpicture-png
.image-emoji-png
.image-format-png
.image-c_word-png
.image-c_powerpoint-png
.image-c_excel-png

================================

mail.google.com

INVERT
.asor_t0
.asor_i1 > img
.asor_i4
.d-Na-Jo.d-Na-N-ax3
.RK-QJ-Jk
.RK-Mo.RK-Qq-LF
#ita-st-id-cs
.d-Na-N-M7-JX.d-Na-J3
.ita-icon-0
.ita-icon-1
.gb_df
img[src$="google_gsuite"]
img[src$="profile_mask2.png"]
.rY>.sa
.buh
.asor
.mixmax-flyout__wrapper
div[aria-label="Hangouts"] > div[role="tablist"] > div[tabid="chat"] > div
form[method="POST"] ~ table div[style] > div > :first-child button:not([string]):not([id])
img[src^="//ssl.gstatic.com/ui/v1/icons/common/x"]
div[style$="gm_add_black_24dp.png)"]
.WR .z0>.L3::before
.WR.anZ .z0>.L3::before

CSS
@media (min-resolution: 144dpi), (-webkit-min-device-pixel-ratio: 1.5) {
    .buk {
        background-image: url(//ssl.gstatic.com/ui/v1/icons/mail/rfr/density_default_v1_2x.png) !important;
    }
    .bui {
        background-image: url(//ssl.gstatic.com/ui/v1/icons/mail/rfr/density_comfortable_v1_2x.png) !important;
    }
    .buj {
        background-image: url(//ssl.gstatic.com/ui/v1/icons/mail/rfr/density_compact_v1_2x.png) !important;
    }
}
.buk {
    background-image: url(//ssl.gstatic.com/ui/v1/icons/mail/rfr/density_default_v1_1x.png) !important;
}
.bui {
    background-image: url(//ssl.gstatic.com/ui/v1/icons/mail/rfr/density_comfortable_v1_1x.png) !important;
}
.buj {
    background-image: url(//ssl.gstatic.com/ui/v1/icons/mail/rfr/density_compact_v1_1x.png) !important;
}
div[class*="bym"][role="navigation"],
.afC,
.agJ {
    background-color: var(--darkreader-neutral-background) !important;
}
.agJ:hover,
.ag5 {
    background-color: ${#E8E6E5} !important;
}
.agJ.bjE {
    background-color: ${#E3E1E0} !important;
}
.ain .TO,
.TO.ol {
    background-color: rgba(255,255,255,0.05) !important;
}
.agh,
.afV,
.afA,
.bbV {
    background-color: transparent !important;
}
.aRg,
.aRj {
    color: ${white} !important;
}
.gb_3e {
    color: ${white} !important;
}
table {
    color: ${black} !important;
}

IGNORE INLINE STYLE
.at
.au
.av
.qj
.hU.hM
.hV.hM
.ajZ-Jt
.aH5
.JA-Kn-Jr-Kw-Jt

IGNORE IMAGE ANALYSIS
.WR .z0 > .L3::before
.WR.anZ .z0>.L3::before
.d-Na-J3
.aBS .d-Na-JX-I .d-Na-J3

================================

mail.jwpub.org/owa

IGNORE IMAGE ANALYSIS
.image-font-png
.image-font_size-png
.image-bold-png
.image-italic-png
.image-underline-png
.image-backcolor-png
.image-forecolor-png
.image-insertunorderedlist-png
.image-insertorderedlist-png
.image-outdent-png
.image-indent-png
.image-justifyleft-png
.image-justifycenter-png
.image-justifyright-png
.image-createlink-png
.image-unlink-png
.image-superscript-png
.image-subscript-png
.image-strikethrough-png
.image-alttext-png
.image-blockdirltr-png
.image-blockdirrtl-png
.image-undo-png
.image-redo-png
.image-removeformat-png
.image-table_icon-png
.image-insertpicture-png
.image-emoji-png
.image-format-png

================================

mail.qq.com

INVERT
.header_logo
.imglogo
.listbg
.navbar
.topline
.topbg
.todaybar_ad_bg
.navbottom
.search_subject .smartsearch
#searchIcon

CSS
.fdbody,
.tipstitle {
    background-color: ${#9bbb59} !important;
}
.fdbody {
    border-left-color: var(--darkreader-neutral-background) !important;
}
.readmailinfo,
.settingtable,
.tabtitle td.selected,
.biginfo,
.tipstitle,
.colorsure {
    background-color: ${#ebf4d8} !important;
}
.toolbgline,
.tabtitle td,
.readmailinfo,
.settingtd,
.addr_line,
.filtertd1,
.bartools {
    border-bottom-color: ${#87a34d} !important;
}
.toolbg,
.toolbg1,
.tabtitle,
.addrsort {
    background-color: ${#bed393};
}
.attbg {
    background-color: ${#dceac0} !important;
}
body[module="qmReadMail"] {
    background-color: var(--darkreader-neutral-background) !important;
    color: var(--darkreader-neutral-color) !important;
}
.selbar_bt {
    background-color: var(--darkreader-neutral-background) !important;
    border-bottom-color: var(--darkreader-neutral-background) !important;
    border-top-color: var(--darkreader-neutral-background) !important;
}
table.O2 td {
    border-bottom-color: ${#c1c8d2} !important;
}
body[accesskey],
.cpright {
    background-color: var(--darkreader-neutral-background) !important;
}
.B,
.nomail,
.colortitle {
    background-color: ${#a9b3b6} !important;
}
.settingTitle .selected {
    color: ${#ebf4d8} !important;
}

================================

mail.snopes.com

CSS
:root {
    --wt-text-on-background-color: var(--darkreader-neutral-text) !important;
}

================================

mail.tutanota.com

CSS
div.mb > div > svg > path {
    fill: black !important;
}

================================

mailbox.org

CSS
body.bg-blog {
    background-image: none !important;
}
.common .mod_article > .inside {
    background-color: var(--darkreader-neutral-background) !important;
}

IGNORE INLINE STYLE
.io-ox-sidepopup

================================

make.com
*.make.com

CSS
.switch.active::after {
    color: var(--darkreader-bg--white) !important;
}
.switch:not(.active)::before {
    color: var(--darkreader-bg--white) !important;
}
.switch:not(.active)::after {
    color: var(--darkreader-text--white) !important;
}

================================

makeuseof.com

IGNORE IMAGE ANALYSIS
.header-logo

================================

maltapost.com

CSS
.multi-steps > li.is-active::before {
    background-color: gray !important;
}

================================

manage.buyvm.net

INVERT
.legend-container

================================

manjaro.org

INVERT
img[alt="manjaro logo"]

CSS
.bg-teal-accent-400,
.bg-teal-accent-400 path {
    background-color: ${rgb(29,233,182)} !important;
    fill: ${rgb(29,233,182)} !important;
}

IGNORE INLINE STYLE
.bg-teal-accent-400 path

================================

manualslib.com

IGNORE IMAGE ANALYSIS
div.pdf

================================

manytoon.com

CSS
.profile-manga,
.c-breadcrumb-wrapper {
    background-image: none !important;
}

================================

map.qq.com

INVERT
#FullScreen
#Logo
#Map
.MenuPanelCheckbox
.MenuPanelContent
.nextStep
.prevStep
.textInput
.titleText
.traffic_next
.traffic_rightbg_b2
.traffic_rightbg_m
.traffic_rightbg_m3
.traffic_rightbg_t2

================================

mapa-turystyczna.pl

INVERT
.ts-map svg

================================

maps.metager.de

INVERT
.map canvas

================================

mapy.cz
*.mapy.cz

INVERT
img[src*="mapserver.mapy.cz"]:not([src*="bing"])
.icon polygon

CSS
.marker span.text {
    color: black !important;
}

================================

marginalrevolution.com

INVERT
.logo-mobile
.logo-desktop
img[src$="mru-logo-450.png"]

CSS
nav {
    background-color: #288d73 !important;
}

================================

mariadb.org

INVERT
.featured-header-image

================================

marinij.com

INVERT
.custom-logo.logo > a > img

================================

market.yandex.*

INVERT
ymaps[class$="main-engine-container"] > canvas
ymaps[class$="marker"] > div > div > div

CSS
a[data-zone-name="offerLink"]:has(img) {
    background-color: #fff !important;
}
[data-baobab-name="picture"],
[data-zone-name="picture"] > div > div,
[data-zone-name="picture"] img {
    mix-blend-mode: unset !important;
}
[data-zone-name="offer"] > div > div:nth-child(1) > div:nth-child(1) {
    background-color: white;
}
[data-zone-name="cartButton"] button {
    background-color: rgb(136, 109, 0) !important;
}

IGNORE INLINE STYLE
[data-zone-name="offer"] > div > div:nth-child(1) > div:nth-child(1)

================================

marketmarketmarket.com
marketstudios.com

INVERT
img.header__heading-logo
button.is-active

CSS
:root {
    --gradient-background: rgb(24, 26, 27) !important;
}
sticky-header.header-wrapper {
    background-color: rgb(24, 26, 27) !important;
}
::placeholder {
    color: transparent !important;
}

================================

marketplace.visualstudio.com

CSS
.ux-updated-date {
    color: ${rgb(55, 255, 0)} !important;
}
.ms-Grid-row {
    color: ${rgba(0, 0, 0, .8)} !important;
}

================================

markmcgranaghan.com

CSS
body {
    background-color: transparent !important;
}

================================

marktplaats.nl

INVERT
.mp-Header-logo
.mp-svg-messages
.mp-svg-notification
.mp-svg-profile
.svg-icon-block

================================

marquette.edu

CSS
.h1 {
    -webkit-text-fill-color: unset !important;
    background-color: unset !important;
    background-image: unset !important;
    color: var(--darkreader-text--primary_blue, var(--darkreader-text-000000)) !important;
}

================================

mastarti.com
streamguard.cc

INVERT
.fp-play-icon div
.fp-pause-icon .fp-pause-block div
.fp-volumebar em.fp-color
.fp-fullscreen-line
.fp-fullscreen-dot

================================

math.semestr.ru

INVERT
.img-online

================================

math.tamu.edu

INVERT
div[align="center"] > p + p > img

================================

mathsisfun.com

CSS
#searchFld {
    background-color: var(--darkreader-neutral-background) !important;
    border-color: black !important;
}
#searchBtn {
    background-color: var(--darkreader-neutral-background) !important;
    border-color: black !important;
}
#content h1 {
    color: var(--darkreader-neutral-text) !important;
}
#hdr {
    opacity: 0.2;
}
#menuWide li {
    background-color: rgb(64, 99, 255) !important;
    color: white !important;
}
#menuWide li:hover {
    background-color: rgb(18, 35, 112) !important;
}

================================

mathsolver.microsoft.com

INVERT
img.light

CSS
.page-header {
    background: ${#e4e6e7} !important;
}
.page-layout-container {
    background: ${#d1e1e1} !important;
}
.t1 {
    color: ${#4f4941} !important;
}

================================

matomo.org

INVERT
img[alt*="WordPress"]
img[src*="Mailfence"]
img[src*="sampling"]
img[src*="logo"]
img.mega-menu-logo

CSS
select,
.elementor-text-editor,
.elementor-text-editor *,
.elementor-blockquote *,
.elementor-testimonial *,
.elementor-price-table * {
    color: var(--darkreader-neutral-text) !important;
}
.elementor-card-shadow-yes .elementor-post__card:hover {
    box-shadow: rgb(76 75 75 / 42%) 0px 0px 30px 0px;
}
.elementor-card-shadow-yes .elementor-post__card {
    box-shadow: rgb(0 0 0 / 23%) 0px 0px 10px 0px;
}

================================

matrix.org

INVERT
.mxnavbar__logo
.mxnavsection__icon
.mxgrid__item__bg__img
.mxblock__explore__item__img
a[aria-label="matrix live  permalink"] > svg
a > svg

================================

matrix.to

INVERT
div.footer > p > img

================================

matsci.org

INVERT
.d-header #site-logo

CSS
.category-logo.aspect-image img {
    background-color: white !important;
}

================================

matters.news

INVERT
.splash-screen .icon
.logo .icon

CSS
section[class$="container"][style^="background-image"] {
    background-image: none !important;
}

================================

maxar.com

INVERT
#siteSearch--desktop img:first-child

CSS
.BigHeroSingleComponent .background {
    z-index: 0 !important;
}

================================

mcbsys.com

INVERT
.site-branding
.icon-image

================================

mcdonalds.com

INVERT
.cmp-global-header__logo

================================

mechanicalkeyboards.com

INVERT
.brands__items img
img.header__heading-logo

CSS
::placeholder {
    opacity: 0 !important;
}
.predictive-search__result-group,
.header__mega-menu,
.header__menu-item {
    background: var(--darkreader-neutral-background) !important;
}
.cards-grid__heading,
.cards-grid__subheading {
    color: black !important;
}
.collapsible-content__digit,
.collapsible-content__icon {
    background-color: ${lightgray} !important;
}
.collapsible-content__item {
    border-bottom: .2rem solid ${lightgray} !important;
}
.collapsible-content__item:first-child {
    border-top: .2rem solid ${lightgray} !important;
}

================================

mediaexpert.pl

INVERT
.euronics-logo
.sg-kategory-box-txt
.sg-new-btn-white
.sg_kat_txt
img[src*="kafelki_do_bran"]
svg > path[d^="M244.122 17.1023C244.122"]

CSS
.product-image {
    mix-blend-mode: normal !important;
}

================================

medianauka.pl

INVERT
img[src*="wzory"]

================================

mediawiki.org
*.mediawiki.org
wikibooks.org
*.wikibooks.org
wikidata.org
*.wikidata.org
wikiless.org
*.wikiless.org
wikimedia.org
*.wikimedia.org
wikimediafoundation.org
*.wikimediafoundation.org
wikinews.org
*.wikinews.org
wikipedia.org
*.wikipedia.org
wikiquote.org
*.wikiquote.org
wikisource.org
*.wikisource.org
wikiversity.org
*.wikiversity.org
wikivoyage.org
*.wikivoyage.org
wikiwand.com
*.wikiwand.com
wiktionary.org
*.wiktionary.org

INVERT
#main_menu > li:not(.lang_btn) > img.logo_img ~ i
#p-logo-text
.article_btn .drop_down li a > i
.bookend
.cdx-text-input__icon.cdx-text-input__start-icon
.central-featured-logo-text
.central-textlogo__image
.feedback_btn .drop_down li a > i
.licensetpl td[style^="width"]
.locmap .pl
.locmap .pr
.logo-container
.logo:not(td)
.main-footer-menuToggle
.mf-icon-close-gray
.mf-icon-expand
.mf-icon-expand-invert
.minerva-footer-logo img
.music-symbol img
.mw-ext-score
.mw-hiero-outer.mw-hiero-table
.mw-kartographer-map
.mw-kartographer-mapDialog-map
.mw-logo-tagline
.mw-logo-wordmark
.mw-mmv-filepage-buttons .mw-mmv-view-config .mw-ui-icon::before
.mw-mmv-filepage-buttons .mw-mmv-view-expanded .mw-ui-icon::before
.mw-ui-icon-wikimedia-expand
.mw-wiki-logo
.mwe-math-fallback-image-display
.mwe-math-fallback-image-inline
.nav-logo
.svg-Wikimedia-logo_black
.title_icon
.toc-title-icon
.tool.tool-button[src$="background-image:"]
.wd-mp-headerimage
.zh-glyph img
body > .oo-ui-windowManager .vega .marks
div.post-content.footer-content > h2 > img
header .branding-box > a > span > img
img.graphite-graph
img.immediate:not(.ntmb)
img.logo_img
img[alt="Video Camera Icon.svg"]
img[alt="audio speaker icon"]
img[alt="logo Wikisource"]
img[src*="Wiktionary-logo"]
img[src="images/black.png"]
img[src*="Wikipedia-logo-textonly.svg"]
img[src*="Unbalanced_scales.svg"]
img[src*="ignature"][src*=".svg"]
img[src*="ignature"][src*=".png"]
img[src*="Emblem_of_Iran.svg"]
img[src*="Share_alt_square_font_awesome.svg"]
img[src*="Justice_scale_silhouette%2C_medium.svg"]
img[src*="Twemoji_1f464.svg"]
img[src*="Mp3.svg"]
img[src*="Globe_eye_icon.png"]
img[src*="Octicons-globe.svg"]
img[src*="Stylized_eye.svg"]
img[src*="AMD_Radeon_logo_2019.png"]
img[src*="AMD_Radeon_RX_6000_series_wordmark.png"]
img[src*="AMD_Radeon_RX_7000_Series_Logo.png"]
img[src*="Creative_Assembly_logo.png"]
img[src*="poweredby_mediawiki.svg"]
img[src*="Greek_lc"][src*=".svg"]
img[src*="Greek_uc"][src*=".svg"]
img[src*="uc_lc"][src*=".svg"]
img[src*="Greek_letter"][src*="sans.svg"]
img[src*="Psi2.svg"]
li.menu-tooltip:not(.lang_btn)
#vector-main-menu-dropdown .vector-icon
#vector-page-tools-dropdown-label::after
.vector-user-links-main .vector-icon
#vector-user-links-dropdown .vector-icon
#vector-user-links-dropdown .vector-icon:after
#vector-user-links-dropdown-label::after
.vector-menu-content .vector-icon
td.icon
.minerva-icon
.mw-mmv-icon
.cdx-button__icon
.leaflet-top
.leaflet-bottom
.mw-kartographer-fullScreen
.mw-kartographer-attribution
img[src*="GNUTLS-logo.svg"]
img[src*="Zelda_2017.svg"]
img[src*="Gnomelogo.svg"]
img[src*="Plasma_coloured_logo.svg"]
img[src*="Coreboot_full.svg"]
img[src*="Libreboot_logo.svg"]
img[src*="Meson_%28software%29_logo_2019.svg"]
img[src*="Freebsd_logo.svg"]
img[src*="DragonFly_BSD_Logo.svg"]
img[src*="Fallout_logo.svg"]
img[src*="PlayStation_4_logo_and_wordmark.svg"]
img[src*="PlayStation_logo_and_wordmark.svg"]
img[src*="Xbox_logo_%282019%29.svg"]
#p-twinkle-dropdown-label::after
#p-lang-btn-label::after
img[src*="Systemd-logo.svg"]
img[src*="PulseAudio-logo.png"]
img[src*="Pipewire_logo.svg"]
img[src*="Metal_Gear_franchise_logo.svg"]
img[src*="Persona_PSP_logo.svg"]
.popups-icon--settings
img[src*="Parteiadler_Nationalsozialistische_Deutsche_Arbeiterpartei"]
img[src*="Totenkopf.svg"]:not(img[src*="KG54_Totenkopf.svg"])
img[src*="Wolfsangel"]
img[src*="Nazi_Odal_rune.svg"]
img[src*="Schutzstaffel_SS.svg"]
img[src*="Algiz.svg"]
img[src*="Celtic-style_crossed_circle.svg"]
img[src*="Sun_Cross_Swastika.svg"]
img[src*="Black_Sun"]
.mw-mmv-restriction-nazi
img[src*="Victoria%E2%80%99s_Secret_%28logo%2C_2021%29.svg"]
img[src*="VS_%26_Co_%28logo%29.svg"]
img[src*="Industry5.svg"]
img[src*="Hame%C3%A7on.svg"]
img[src*="Reichsadler_Deutsches_Reich"]
.skin-invert-image img
.skin-invert img
img[src*="Airport_Immigration.svg"]
img[src*="Croix_de_Feu.svg"]
img[src*="Sig_runes.svg"]
img[src*="Runic_letter_"]:not(.skin-invert-image img)
img[src*="Tiwaz_rune.svg"]
img[src*="Heilszeichen.svg"]
img[src*="Armanenrunor_i_cirkel_med_siffror_vector.svg"]
img[src*="White_Pride_World_Wide_-_Stormfront_hate_symbol.svg"]
img[src*="Earth_symbol"]
img[src*="Broken_crossed_circle.svg"]
img[src*="Southern_Cult_Solar_Cross.svg"]
img[src*="Sun_cross.svg"]
img[src*="Maru_juji.svg"]
img[src*="Thule-Gesellschaft.svg"]
img[src*="BlackSun.svg"]
img[src*="Sampad.svg"]
.mw-mmv-restriction-insignia
img[src*="Yocto_Project_logo.svg"]
img[src*="The_Pirate_Bay_logo.svg"]
img[src*="President_of_India_Logo.png"]
img[src*="mediawiki_compact.svg"]
img[src*="Peace"][src*=".svg"]
img[src*="peace"][src*=".svg"]
img[src*="Pacyfa"][src*=".svg"]
img[src*="U%2B262E.svg"]
img[src*="Emojione_BW_262E.svg"]
span.mw-no-invert:not(table.infobox span):not(figure span.legend-color):not(.mw-mmv-post-image span.legend-color)
#vector-user-links-dropdown-label-sticky-header
.vector-sticky-header-icons
.vector-sticky-header-icon-start
.mw-ui-icon-wikimedia-language
.mw-interlanguage-selector::after
.mw-ui-icon-wikimedia-listBullet

CSS
:root {
    --background-color-interactive: ${#eaecf0} !important;
    --border-color-subtle: ${#a2a9b1} !important;
    --darkreader-border--border-color-base: ${#a2a9b1} !important;
}
.mwe-popups-discreet > img,
div .thumbimage[src$=".png"],
div .thumbimage img[src$=".png"],
.image-carousel .image-loaded {
    background-color: white;
}
.mw-mmv-image .svg,
.fullImageLink [src*=".svg"],
a[href$=".svg"]:hover > img,
a[href*=".gif"]:hover > img {
    background-blend-mode: color;
    background-color: rgba(255, 255, 255, 0.75) !important;
}
.diff-addedline .diffchange {
    background-color: ${lightblue} !important;
}
.diff-deletedline .diffchange {
    background-color: ${#feeec8} !important;
}
@keyframes unseen-fadeout-to-unread {
    from {
        background-color: ${#dce8ff} !important;
    }
    to {
        background-color: ${#ffffff} !important;
    }
}
@keyframes unseen-fadeout-to-read {
    from {
        background-color: ${#dce8ff} !important;
    }
    to {
        background-color: ${#eaecf0} !important;
    }
}
.main-top {
    background: none !important;
}
ol.references li:target,
sup.reference:target {
    background-color: ${lightblue} !important;
}
.control-bar {
    background-color: var(--darkreader-neutral-background) !important;
    background-image: none !important;
}
.k-player,
body.mediawiki,
#dialogEngineContainer #dialogEngineDialog {
    background-color: var(--darkreader-neutral-background) !important;
}
.template-facttext {
    background-color: ${#c8c6c3} !important;
}
#mw-page-base {
    background-color: var(--darkreader-neutral-background);
    background-image: linear-gradient(${rgb(231, 229, 228)} 50%, var(--darkreader-neutral-background) 100%) !important;
}
body.skin--responsive,
#menus-cover-background {
    background-image: linear-gradient(${rgb(231, 229, 228)} 50%, var(--darkreader-neutral-background) 100%) !important;
}
.vector-sticky-pinned-container::after {
    background: linear-gradient(transparent, var(--darkreader-neutral-background)) !important;
}
[style*="background: rgb(221, 221, 255)"],
[style*="background-color: rgb(221, 221, 255)"] {
    background: ${rgb(221, 221, 255)} !important;
}
div.mw-warning-with-logexcerpt,
div.mw-lag-warn-high,
div.mw-cascadeprotectedwarning,
div#mw-protect-cascadeon,
div.titleblacklist-warning,
div.locked-warning {
    background-color: ${#ffa9a9} !important;
    border-color: ${#ffa1a1} !important;
}
div.NavFrame div.NavHead {
    background-image: none !important;
}
figure[typeof~="mw:File/Thumb"],
figure[typeof~="mw:File/Thumb"] > figcaption,
figure[typeof~="mw:File/Thumb"] > :not(figcaption) .mw-file-element,
div.thumbinner,
#filetoc,
.mw_metadata td,
div.flaggedrevs_short,
.wbmi-entityview-captionsPanel,
.page-actions-menu,
.content .mw-image-border .mw-file-element,
.mw-footer,
.last-modified-bar,
.minerva-footer-logo,
.cdx-card,
.cdx-thumbnail__placeholder {
    border-color: var(--darkreader-border--border-color-base) !important;
}
.mw-parser-output .sidebar,
.fileinfotpl-type-information tbody div {
    background-color: var(--darkreader-bg--background-color-neutral-subtle) !important;
}
.sidebar-title-with-pretitle,
.sidebar-below {
    background: var(--darkreader-bg--background-color-interactive) !important;
}
table.layouttemplate {
    border: var(--border-color-subtle) 2px solid !important;
}
.mwe-popups {
    box-shadow: 0 30px 90px -20px rgba(0,0,0,0.3),0 0 0 1px var(--darkreader-border--border-color-base) !important;
}
.ext-discussiontools-init-targetcomment {
    background-color: rgba(192,192,255,0.25) !important;
}
.mw-parser-output .ib-company-logo img {
    background-color: transparent !important;
}
html[data-darkreader-scheme="dark"] img[src*="Eagle_with_fasces.svg"],
html[data-darkreader-scheme="dark"] img[src*="wikimedia-button.svg"] {
    filter: brightness(200%) !important;
}
.cdx-button:enabled.cdx-button--weight-quiet:hover {
    background-color: ${#BBBBBB} !important;
    mix-blend-mode: screen !important;
}
td.infobox-data span.legend-color[style*="background-color:##FFFFFF"] {
    background-color: white !important;
}

IGNORE INLINE STYLE
#on_image_elements span
.legend-color:not(table.wikitable .legend-color)

IGNORE IMAGE ANALYSIS
.k-player .k-menu-bar li a
.mf-icon-expand
.mw-wiki-logo
.toc-title-icon
body:not(.ns-0):not(.ns-2):not(.ns-100) .gallerybox .thumb img

================================

medium.com

INVERT
.svgIcon
.svgIcon-use
a[href="/"]>svg
div[role="separator"]

================================

medium.freecodecamp.org

CSS
span.markup--quote.markup--p-quote.is-other {
    background-image: linear-gradient(rgba(14, 255, 167, 0.2), rgba(14, 255, 167, 0.2)) !important;
}

================================

medrxiv.org

INVERT
.blood_logo
.logo-img

================================

meduza.io

CSS
mark {
    color: var(--darkreader-neutral-text) !important;
}

================================

meet.google.com

IGNORE INLINE STYLE
svg[preserveAspectRatio*="meet"] *

================================

meet.jit.si

IGNORE INLINE STYLE
.jitsi-icon *

================================

mega.nz

INVERT
a.fm-files-view-icon
a.top-icon.menu
div.checkdiv.megaapp-download.checkboxOff.switches
div.fm-dialog-close.medium
div.nw-tree-panel-arrows.icons-sprite
i.small-icon.context
i.small-icon.dialog-sprite.arrows-to-bottom
i.small-icon.dialog-sprite.arrows-to-top
i.small-icon.download-as-zip
i.small-icon.icons-sprite.tiny-grey-tick
i.small-icon.import-to-cloud
i.top-menu-icon.menus-sprite
i.transfer-progress-icon
span.top-icon.language

CSS
.grid-wrapper {
    outline-color: var(--darkreader-bg--surface-main);
}
.topbar-searcher {
    background: var(--darkreader-bg--surface-grey-2) !important;
}
div.mega-dialog.dialog-template-action.two-factor-dialog.verify-two-factor-login {
    background-color: var(--darkreader-bg--surface-main) !important;
}
#msgDialog {
    background: var(--darkreader-bg--surface-grey-2) !important;
}

================================

meijer.com

CSS
[class*="bv-rnr_"] {
    background-color: var(--darkreader-neutral-background) !important;
}

================================

meituan.com

INVERT
.dpLogo
.header-title
.site-logo

================================

memtest.org

INVERT
.logo-default

================================

mendeley.com

INVERT
#pdfcontainerId > div[class^="PDFReaderWithAnnotations"]
.highlightLayer > *
div[class^="AnnotationMenuStyle"]
svg[class^="IconMendeley__Icon"]
a[class^="TabCloseButton__CloseTabLink"]
g#cross3
svg[class^="ColourCircle"]

CSS
.highlightLayer * {
    background-color: var(--darkreader-selection-text) !important;
}

================================

mercury.postlight.com

INVERT
.SVGInline-svg path
#merc-logo
[src^="/_/src/components/images/reader_kindle_image"]
[href="https://postlight.com/"] > svg > g > path
[src^="/_/src/components/images/reader_tout_image"]
[src^="/_/src/components/images/phone"]
.w-0-m.db-l.dn.cover.w-50

================================

merriam-webster.com

INVERT
circle.outline.Oval

CSS
.logo-cnt path[fill="#004990"] {
    fill: ${#0085e0} !important;
}

================================

mersenneforum.org

INVERT
img[src*="mimetex"]

================================

messages.android.com

INVERT
.x4Tquc
.QrWqSe
.XCHXxd
.pXeIKc

================================

messages.google.com

INVERT
.x4Tquc
.QrWqSe
.XCHXxd
.pXeIKc

CSS
.input-background {
    --input-bg-fade-color: #202124 !important;
}

================================

messenger.com

INVERT
._4rv6
a._4ce_
div[aria-label="Change Position"]
div[role="slider"]

CSS
._8rsr {
    fill: #0098ff !important;
}
._576q mask path {
    fill: white !important;
}
._576q mask rect {
    fill: black !important;
}
._576q div {
    background-color: transparent !important;
}
.j7vl6m33,
.a8c37x1j,
.bp9cbjyn,
mask[id*="jsc_c"] > circle {
    fill: var(--always-white) !important;
}
.a8c37x1j > rect {
    fill: var(--darkreader-bg--fds-white) !important;
}
.__fb-light-mode {
    --darkreader-border--messenger-card-background: var(--darkreader-bg--messenger-card-background) !important;
    --filter-blue-link-icon: invert(73%) sepia(29%) saturate(200%) saturate(200%) saturate(200%) saturate(200%) saturate(200%) saturate(200%) saturate(103.25%) hue-rotate(189deg) brightness(101%) contrast(101%) !important;
    --filter-disabled-icon: invert(100%) opacity(30%) !important;
    --filter-negative: invert(25%) sepia(33%) saturate(200%) saturate(200%) saturate(200%) saturate(200%) saturate(200%) saturate(200%) saturate(110%) hue-rotate(345deg) brightness(132%) contrast(96%) !important;
    --filter-placeholder-icon: invert(59%) sepia(11%) saturate(200%) saturate(135%) hue-rotate(176deg) brightness(96%) contrast(94%) !important;
    --filter-positive: invert(37%) sepia(61%) saturate(200%) saturate(200%) saturate(200%) saturate(200%) saturate(115%) hue-rotate(91deg) brightness(97%) contrast(105%) !important;
    --filter-primary-icon: invert(100%) !important;
    --filter-secondary-icon: invert(62%) sepia(98%) saturate(12%) hue-rotate(175deg) brightness(90%) contrast(96%) !important;
    --filter-warning-icon: invert(77%) sepia(29%) saturate(200%) saturate(200%) saturate(200%) saturate(200%) saturate(200%) saturate(128%) hue-rotate(359deg) brightness(102%) contrast(107%) !important;
}
.qbubdy2e {
    fill: none !important;
}
.tdjehn4e,
.oo1teu6h {
    background-color: rgba(255, 255, 255, 0.1) !important;
}
.tdjehn4e:hover,
.ovq5dppa:hover {
    background-color: rgba(255, 255, 255, 0.2) !important;
}
i.eb18blue {
    filter: none;
}
div[style][title] > div[style^="transform"] {
    z-index: 0 !important;
}
.x1g6sh6t {
    fill: none !important;
}
.x1g6sh6t {
    fill: none !important;
}
.x1k4qllp {
    outline: 10px solid var(--darkreader-bg--mwp-message-row-background) !important;
}

IGNORE INLINE STYLE
[role="button"] svg
[role="button"] svg line
div svg[viewBox="0 0 36 36"] mask path
mask > rect
g > rect
mask > circle
.html-div svg path

================================

metacareers.com

INVERT
a[href="/"] img.img
#careersContentContainer div[style^="background-image: "]
#careersContentContainer div[style^="background-image: "] > *

================================

metal.equinix.com

INVERT
.tw-logo

================================

metalmadness.org

INVERT
img[alt="Rules"]

CSS
.forabg,
.forumbg,
#subsilver-nav-topic {
    background-blend-mode: multiply !important;
}

================================

meteo.imgw.pl

INVERT
.meteo-chart > div > canvas
#map-container svg

CSS
.menu-close img {
    filter: none !important;
}

IGNORE IMAGE ANALYSIS
.gory-imgw a

================================

metrics.torproject.org

INVERT
img[src^="/images/flags/"]
g > text
g > line

CSS
.dot {
    fill: var(--darkreader-neutral-background) !important;
}
div > img[src] {
    filter: invert(90%) !important;
}

================================

metro.co.uk

INVERT
#masthead__logo-default

================================

metrobyt-mobile.com

INVERT
#digital-header-logo-img

CSS
#Desktop-img {
    z-index: 0 !important;
}

================================

mewe.com

CSS
body > .ember-view {
    background-color: ${#ebf0f3} !important;
}
body > .ember-view.dialog_wrapper {
    background-color: transparent !important;
}

================================

microchip.com

INVERT
.mchp-logo

================================

microsoft.com

INVERT
.m-updated-quicklinks .c-carousel.f-single-slide ul > li > a.c-hyperlink > img.large-icon
.carousel-inner .card-background
.key-message .card-background
.animated-hero-media

CSS
#announce picture + div h3,
#announce picture + div p,
.edgeconsumer.features .m-hero h1,
.edgeconsumer.features .m-hero p {
    color: var(--darkreader-neutral-background) !important;
}
div[aria-label="Download Microsoft Edge dialog"] {
    background-color: #389fef !important;
}

================================

microsoftedge.microsoft.com

INVERT
rect[x="7.5"]
text[text-anchor="middle"]

================================

midkar.com

CSS
body {
    background-image: unset !important;
}

================================

mikanani.me

INVERT
.an-res-row-bg

================================

mikrotik.com

INVERT
img[alt="MikroTik Logo"]
img[src*="down.png"]
img[src*="file.png"]
img[src*="md5.png"]

CSS
img[src*="ros.jpg"] {
    filter: invert(1) !important;
    mix-blend-mode: exclusion !important;
}
img[src*="demo.png"] {
    filter: invert(1) !important;
    mix-blend-mode: exclusion !important;
}
img[src*="install.png"] {
    filter: invert(1) !important;
    mix-blend-mode: exclusion !important;
}
img[src*="cloud.png"] {
    filter: invert(1) !important;
    mix-blend-mode: exclusion !important;
}
img[src*="read.png"] {
    filter: invert(1) !important;
    mix-blend-mode: exclusion !important;
}
img[src*="buy.png"] {
    filter: invert(1) !important;
    mix-blend-mode: exclusion !important;
}
img[alt="MikroTik App"] {
    filter: invert(1) hue-rotate(180deg) !important;
    mix-blend-mode: difference !important;
}
img[alt="MikroTik Home App"] {
    filter: invert(1) hue-rotate(180deg) !important;
    mix-blend-mode: difference !important;
}
img[alt="Beacon Manager app"] {
    filter: invert(1) hue-rotate(180deg) !important;
    mix-blend-mode: difference !important;
}
img[src*="map_lv.jpg"] {
    filter: invert(1) hue-rotate(180deg) saturate(5) !important;
    mix-blend-mode: difference !important;
}

================================

miktex.org

INVERT
.icon-bar

CSS
body,
.site-footer {
    background-image: none !important;
}

================================

mikufan.com

IGNORE IMAGE ANALYSIS
#header-container

================================

mindfactory.de

INVERT
.col-icons
img[src*="icon_cart.svg"], img[src*="icon_gamepad.png"], img[src*="icon_schnaepp.png"], img[src*="schnaeppshop_logo_icon.webp"]
#dienst_montage, #dienst_montage .icons, img[src*="mindfactory_komplettsystemmontage.png"]
#ic_aboutus > div:nth-child(2), img[src*="ueberuns/middle.jpg"]
.ms_group_icon > a > img
.text-center > a > img

CSS
.ms_product {
    background-blend-mode: difference !important;
}
.itemhighlight > .ms_product {
    background-color: var(--darkreader-selection-text) !important;
}
.p {
    background-blend-mode: normal !important;
}
#dienst_montage > div > p {
    color: var(--darkreader-neutral-background) !important;
}
body,
.ground-layer {
    background-blend-mode: soft-light !important;
}

================================

minecraftskins.com

CSS
.farbtastic .overlay {
    background-image: url("https://www.minecraftskins.com/bundles/app/images/mask.png") !important;
}
.header__menu-outer > ul > li > a {
    color: black !important;
}

IGNORE INLINE STYLE
.color
#color

IGNORE IMAGE ANALYSIS
.farbtastic .overlay

================================

minesweeper.online

IGNORE IMAGE ANALYSIS
*

================================

minsu.dianping.com

INVERT
.zg-map

================================

mint.intuit.com

INVERT
.recharts-cartesian-axis-ticks

CSS
[class*="ExpandableCard-wrapper"] {
    background: none !important;
}
[class*=' TextField-TFInput'] {
    background: var(--darkreader-neutral-background) !important;
}
[class*='BudgetCardstyle__ProgressLine'],
[class*='OverviewCardUIstyle__ProgressLine'] {
    border-right-color: ${black} !important;
    opacity: 1 !important;
}

IGNORE INLINE STYLE
.recharts-sector

================================

miro.com

INVERT
#pixiCanvasContainer > :nth-child(1)
.b-icon

================================

mistral.ai

INVERT
img[alt="linkedin"]
img[alt="facebook"]
img[alt="twitter"]
img[alt="Black"]
a[aria-label="X"] img
a[aria-label="Linkedin"] img
a[aria-label="Discord"] img
#splide01-list img

CSS
img[src^="https://cms.mistral.ai/assets"] {
    filter: none !important;
    mix-blend-mode: normal !important;
}
.blog-rich-text p,
.blog-rich-text h1,
.blog-rich-text h2,
.blog-rich-text h3 {
    color: inherit;
}
.subMenuItem,
a.inline-block {
    background-clip: initial !important;
    background-image: none !important;
    color: var(--darkreader-neutral-text) !important;
}
.menuItem.animate-shine-black {
    background-image: none !important;
    color: var(--darkreader-neutral-text) !important;
}
.relative.svg-container svg path,
.size-3.svg-container svg path,
.svg-container:not([class*=' ']) svg path,
.hidden.svg-container svg path {
    fill: #EC6D36 !important;
}
body > main > div.pointer-events-none.fixed.inset-x-0.bottom-0.z-50.flex.justify-center.px-4.pb-8.transition-all.duration-300.ease-in-out.translate-y-0.opacity-100 > form > div > button,
body > main > div:nth-child(2) > div.relative.flex.max-h-\[690px\].min-h-\[690px\].items-center.justify-center > div > form > div > button,
body > main > div:nth-child(8) > article > div > header > a > h4 > button {
    background-color: #EC6D36 !important;
}
table {
    border-color: inherit !important;
}
td,
th {
    border-color: inherit !important;
}
thead {
    background-color: ${white} !important;
}
span.h-\[11px\].w-px.bg-foreground {
    background-color: ${black} !important;
}
.divider.h-full.w-px.bg-primary.z-20.top-0.absolute.pointer-events-none {
    background-color: red !important;
}
.items-center button,
.container,
.w-full {
    text-shadow: black 1px 1px 0px !important;
}

================================

mit.edu

INVERT
.mit-logo

================================

mitx.*

CSS
img {
    background-color: white !important;
}

================================

mixcloud.com

INVERT
.cQABPj

IGNORE INLINE STYLE
path[fill="none"]
path[fill-rule="evenodd"]

================================

mjtnet.com

INVERT
.navbar-brand

================================

mlb.com

CSS
#percentile-rank text,
.legend {
    fill: var(--darkreader-neutral-text) !important;
}

================================

mnt.ee

CSS
#zone-content-wrapper {
    color: var(--darkreader-neutral-text) !important;
}
#zone-content {
    background-color: var(--darkreader-neutral-background) !important;
}

================================

mobiel.nl

INVERT
.credit-warning__image
.dt-carousel-home__dots
.spec__network
img[alt="Tele2"]
img[alt="hollandsnieuwe"]
.header-main__icon
.spec__network-ready

IGNORE INLINE STYLE
.version-without-subscription-row__color
.gEJLdA

================================

mobile.bg

CSS
table .tablereset {
    background-image: none !important;
}

================================

moegirl.org.cn

CSS
span.heimu a.external,
span.heimu a.external:visited,
span.heimu a.extiw,
span.heimu a.extiw:visited {
    color: #dadada !important;
}
.heimu,
.heimu a,
a .heimu,
.heimu a.new {
    background-color: #dadada !important;
    color: #dadada !important;
}
body:not(.heimu_toggle_on) .heimu:hover,
body:not(.heimu_toggle_on) .heimu:active,
body:not(.heimu_toggle_on) .heimu.off {
    color: black !important;
}
body:not(.heimu_toggle_on) .heimu:hover a,
body:not(.heimu_toggle_on) a:hover .heimu,
body:not(.heimu_toggle_on) .heimu.off a,
body:not(.heimu_toggle_on) a:hover .heimu.off {
    color: darkblue !important;
}
body:not(.heimu_toggle_on) .heimu.off .new,
body:not(.heimu_toggle_on) .heimu.off .new:hover,
body:not(.heimu_toggle_on) .new:hover .heimu.off,
body:not(.heimu_toggle_on) .heimu.off .new,
body:not(.heimu_toggle_on) .heimu.off .new:hover,
body:not(.heimu_toggle_on) .new:hover .heimu.off {
    color: #BA0000 !important;
}

================================

mojosoft.com.pl

INVERT
img[src*="logo16"]
img[src*="img/iko"]
img[src*="img/ideabank"]
img[src*="img/logo"]
img[src*="img_logo"]
#searchbox

CSS
#viewsh,
#view,
#szukajka,
header,
header.smaller #szukajka .inputsearch,
#search_query,
#mainMenusmall {
    background-color: var(--darkreader-neutral-background) !important;
    background-image: none !important;
}
#searchbox,
select {
    color: var(--darkreader-neutral-background) !important;
}

IGNORE INLINE STYLE
header.smaller

================================

moluch.ru

INVERT
.logo

CSS
body {
    background-image: var(--darkreader-neutral-background) !important;
}

================================

monde-diplomatique.fr

INVERT
.logodiplo

================================

money.pl

CSS
.dynks {
    color: ${#666666} !important;
}
a[href$="twitter.com/money_pl"] path:first-of-type {
    --darkreader-inline-fill: transparent !important;
}

================================

mongodb.com

INVERT
img[alt="MongoDB logo"]

================================

monitor.firefox.com

INVERT
svg[class="Mozilla-logo"] > path[fill="#ffffff"]
.fx-bento-app-link.fx-bento-link.fx-mobile > span::before
img[src="/img/svg/laptop.svg"]
img[src="/img/svg/globe.svg"]
img[src="/img/svg/vpn.svg"]
button[class="vpn-banner-close"]

================================

monokai.pro

INVERT
.c-icon-process

================================

monstercat.com

CSS
.volume-slider-outer {
    background-color: ${#4d4d4d} !important;
    z-index: -99999999999;
}
.volume-slider-inner {
    background-color: ${#1873cc} !important;
}
.volume-slider-handle {
    background-color: ${#1d1d1d} !important;
}
.title,
h3,
.line-bottom,
.line-top,
a,
.one-line-ellipsis {
    color: ${#4b4e50} !important;
}

================================

monta.ir

INVERT
.floatLeft
.formula-pack > img
.m--content-panel > div > div > canvas
.highcharts-background
.customized-field
.source
.choice > .layoutImageInline
.choice > img
.choice > div > img
.navbar-item > img
.empty_state_student
progress
td > img
.notice > div > img
td > div > img
.extrapractice > div > img
.extrapractice > div > div > img
.empty_teacher
.GO5O4PB-gc-b
.GO5O4PB-gc-i
.GO5O4PB-gc-e
.GO5O4PB-gc-i > div
.GO5O4PB-gc-Eb > div > a
img.is-rounded
img.is-128x128

CSS
.GO5O4PB-gc-n {
    background-image: none !important;
}

================================

moodle.herzen.spb.ru

INVERT
.img-responsive

================================

moodle.latech.edu

CSS
#snap-home.logo,
.snap-logo-sitename {
    background-image: url(//moodle.latech.edu/pluginfile.php/1/theme_snap/logo/1680805090/ltu-state-t-logo.png) !important;
}

IGNORE IMAGE ANALYSIS
#snap-home.logo
.snap-logo-sitename

================================

moovitapp.com

INVERT
.map
.logo

================================

morele.net

INVERT
.h-logo.col
.h-control-btn > [src="/static/img/shop/icon-bezpieczna-dostawa.svg"]
.swiper-slide-visible.mx-auto.swiper-slide > .d-flex.img-container
div.cn-different-frontend.cn-menu-item-hover.cn-shop > .cn-main-name.cn-name > .cn-name-value > span:nth-of-type(1)

================================

morningstar.com

INVERT
.mbc-legend-top
.mbc-legend-bottom
.mbc-legend-item-date
.mdc-medal
.mdc-icon
.legend-group
.legend-box-text
.mbc-chart-group
.square-text
.min-max
.axis .tick
.axis .name
.mbc-axis .tick
.mbc-chart-legend-inner
.mbc-layers .tick

================================

mos.ru

INVERT
div[class^="src-components-Map-___styles-module__map_container"]
div[class^="src-components-Map-___styles-module__control"]::before
div[class^="src-components-Map-___styles-module__control"]::after
#map_div_container
#points_layer > text

================================

motherjones.com

INVERT
.logo
.footer-logo
.menu-button

================================

moto.pl

INVERT
img[src="https://bi.im-g.pl/im/0/24525/m24525630.png"]

CSS
.main_wrapper,
.top_section_bg,
.bottom_section_bg {
    background-color: ${#e5e5e5} !important;
}

================================

motorsport.com

CSS
.ms-schedule-table__cell {
    background-color: var(--darkreader-neutral-dark) !important;
}

================================

mowglii.com

CSS
#itsycalbanner2 {
    background: url(/itsycal/itsycalbanner2@2x.png?v=1720157892) no-repeat !important;
    background-position: right center !important;
    background-size: 550px 430px !important;
    height: 430px !important;
    width: 100% !important;
}

IGNORE IMAGE ANALYSIS
#itsycalmenubaranimation

================================

mozilla.net

INVERT
.css-editor-container header h4::before

================================

mp.weixin.qq.com

INVERT
.audio_card_progress
.audio_card_progress_handle

================================

msi.com

INVERT
a.logo
.site-logo
.site-header-menu-toggle--button span
.flickity-button-icon
.homeLink__logo

CSS
#MSI_Support .top-headBg,
#MSI_Support .top-head,
#MSI_Support .main-contact-support {
    background-image: none !important;
}
.related__link > .related__title,
.service__link > .service__head {
    z-index: 1 !important;
}

================================

msmgtoolkit.in

CSS
.cid-r89gzwx5mR .mbr-section-title {
    color: ${white};
}
.cid-r89gzwx5mR .mbr-section-subtitle {
    color: ${white};
}

================================

msn.com

INVERT
.logowrapper

================================

msnbc.com

CSS
.styles_progress__GFuLT::-moz-progress-bar {
    background-color: var(--darkreader-neutral-text) !important;
}
.styles_progress__GFuLT {
    background-color: #666 !important;
}
.styles_volume__peSyL::-moz-range-thumb {
    background: var(--darkreader-neutral-text) !important;
}
.styles_volume__peSyL::-moz-range-track {
    background: #666 !important;
}

================================

msys2.org

CSS
body {
    background-image: none !important;
}

================================

mt.lv

CSS
.graph > text {
    fill: var(--darkreader-neutral-text) !important;
}

================================

mtggoldfish.com

IGNORE INLINE STYLE
.manacost path

================================

mturk.com

INVERT
[src="/assets/images/how-it-works.png"]
[src="/assets/images/requester_signup.svg"]
[src="/assets/images/worker_signup.svg"]
.lb-mid-8.lb-tiny-24.lb-col > .lb-img > div

================================

mubi.com

INVERT
.css-jd0r3a.e1kjxayp2
.css-k7pew6.ef3qs2t4 img
.css-ywuexf
.css-19064tz
.css-1w8phor
.css-n1xrf1
.css-1dev2nn.e18wowia1 .star
.css-ker29f.ed6irnx8
img[src*="logo-small_black.png"]
img[src*="industry_event_logo_placeholder-small_black.png"]
.css-zj1tof

CSS
.css-ztue73 {
    filter: brightness(1) !important;
}
.css-1gez225.e1t0dj1j2 svg *,
.css-1gez225.e13p4uxl2 svg * {
    --darkreader-inline-fill: #FFFFFF !important;
}
.css-1fdxz4i.e1f1mjpr0 svg *,
.css-15x1o6o.e19610x52 svg *,
.css-j9vvv8.e1gnvuk52  svg * {
    --darkreader-inline-fill: ${#000000} !important;
}

IGNORE INLINE STYLE
.star-ratings svg *

================================

mullvad.net

CSS
#bg {
    fill: #192E45;
}

================================

multilingual.com

INVERT
.td-logo

================================

multitran.com

INVERT
img[src="/gif/logoe.gif"]

CSS
body {
    background-image: none !important;
}

================================

mumble.info

INVERT
.os
.suggested-download-button-caption

================================

muratordom.pl

INVERT
.logo

================================

murena.com

INVERT
picture.wordmark--link

================================

musclewiki.com

INVERT
img[src="/static/images/logo.png"]

================================

music.163.com

INVERT
.btns
.cor
#g_backtop
#g_player
.hot
.logo
.m-playbar
.m-table thead
.u-btn2
.u-lv
.u-btn
.m-tabs
.n-srch .pgsrch
.n-srch .pgsrch .btn
.n-srch .pgsrch .srch

CSS
.n-myinfo {
    background-image: none !important;
}

================================

music.amazon.*
music.amazon.*.*

CSS
.listViewStatusButtonInLibrary .add,
.listViewStatusButtonInLibrary .added {
    background-color: ${black} !important;
}
.slider .scrubber,
.slider .scrubberHandle,
.slider .sliderTrackRemainder {
    background-color: ${black} !important;
}

================================

music.apple.com

INVERT
body:not(.dark-mode) .web-navigation__logo-link.button-reset.ember-view
body:not(.dark-mode) .native-upsell__logo
body:not(.dark-mode) .native-upsell__action
body:not(.dark-mode) .dt-search-box__icon
.web-chrome-playback-controls
.dt-media-contextual-menu
.web-chrome-playback-lcd__contextual-badge--non-marquee.web-chrome-playback-lcd__contextual-badge
.love-or-popular__popular.love-or-popular__glyph
.web-chrome-playback-lcd__progress-bar-container
.web-chrome-playback-lcd__volume

================================

musical-artifacts.com

INVERT
a.favorite i

CSS
body {
    background-color: var(--darkreader-neutral-background);
    color: var(--darkreader-neutral-text);
}
.light-item {
    background-color: ${#f8f8f8};
    border-color: ${#efefef};
}
.dark-item,
.pagination > li > a,
.pagination > .disabled > a {
    background-color: ${#eee};
    border-color: ${#ddd};
}
.tag-title,
a:hover,
a[href="https://www.gnu.org/licenses/license-list.html#NoLicense"] {
    color: ${#222};
}
a {
    color: ${#632d4d};
}
a.tag-filter:hover {
    color: ${#111};
}
.btn-default {
    background-color: ${#e6e6e6};
    border-color: ${#aaa} !important;
    color: var(--darkreader-neutral-text) !important;
}
.btn-default:hover,
.pagination > li > a:hover,
.pagination > .disabled > a:hover {
    background-color: ${#aaa};
    border-color: ${#aaa} !important;
}
.form-control {
    background-color: ${#fff};
    border: 1px solid ${#ccc};
    color: ${#555555};
}
#artifacts_search_clear {
    background-color: ${#ddd};
}

================================

musicmakers.ru

INVERT
#menubtn > *

================================

musictheory.net

INVERT
[data-musictheory-id="lesson"] canvas

================================

my.account.sony.com

INVERT
img[class*="img-wallpaper"]

================================

my.bible.com

CSS
.nav-title {
    color: var(--darkreader-neutral-text) !important;
}

================================

my.canadalife.com

CSS
.nds-card {
    background: inherit !important;
}

================================

my.canngo.express

INVERT
input[id="beeintraechtigungAlltag"]

================================

my.cofc.edu

CSS
.container {
    background-color: var(--darkreader-neutral-background) !important;
}

================================

my.contabo.com

CSS
#mainmenu > div,
#submenu > div,
.button,
.ui-button {
    background-image: none !important;
}
.ui-button {
    color: var(--darkreader-neutral-text) !important;
}

================================

my.frantech.ca

INVERT
.logo

================================

my.home-assistant.io

CSS
.ha-card {
    background: ${white} !important;
}

================================

my.nextdns.io

INVERT
.mt-2.mb-4.text-center
img[src*="/static/media/logo-large"]
img[src*="/static/media/samsung"]
img[src*="/static/media/sonos"]
.d-md-inline > img
.settings-button
.stream-button
.tooltipParent > img
.list-group-item > div > img
.d-flex > .text-break > img
.d-flex > .flex-grow-1 > div > img
.d-flex.align-items-center.flex-wrap a img

CSS
.text-right[style*="opacity: 0.3"] {
    opacity: 0.6 !important;
}
g.rsm-geographies {
    filter: invert(1) hue-rotate(180deg) brightness(130%) !important;
}
img[src*="/misc/flags/"] {
    filter: revert !important;
}

================================

my.nintendo.com

CSS
.Layout-app,
.Modal_contentInner,
.signUpButton {
    background-image: none !important;
}

================================

my.remarkable.com

INVERT
.menu-button
img[alt="desktop icon"]
img[alt="mobile icon"]

================================

my.vega.ua

INVERT
canvas#traffic_graph_canvas

================================

my.volia.com

CSS
body.signInPage {
    background-image: none !important;
}
a.mainLogo {
    background-color: ${grey} !important;
}

================================

myabandonware.com

INVERT
.sports
.duke2
.heretic
.hexen
.strategy
.simulation
.blood
.driving
.keen
.playing-rpg
.jazz-jack
.war2
.pitch

CSS
.top {
    background-image: var(--darkreader-neutral-background) !important;
}
body {
    background-color: var(--darkreader-neutral-background) !important;
    background-image: none !important;
}

================================

myacademy.oracle.com

INVERT
#logo
.login-logo
.logo--desktop
.nav-control-mobile span
.splide--container button
.dynamic-widget__result .list-view .completion-bar
.course-details__cta a.play::before
.thumb__background
.universal-side-panel__switcher button svg
.universal img
.slide-displays-root > div:nth-child(3) > div > :nth-child(2) > div > :nth-child(3)
.slide-displays-root div:nth-child(3) > div > :first-child > div > :last-child span
.slide-displays-root svg g path:nth-child(2)
.quiz-slide-visualizer
.slide-object-view-icon-placeholder
.quiz-session-view .choice-view__active-element-container .inline-border

CSS
header,
#header {
    background: ${#ccc} !important;
}
.quiz-slide-visualizer span {
    color: #4e3629 !important;
}
.quiz-slide-visualizer .slide-layout > div > :nth-child(3) span,
.quiz-slide-visualizer .slide-layout > div > :nth-child(8) span {
    color: #fed6af !important;
}
.message-box__icon,
.quiz-message-box__icon {
    background-color: white !important;
    border: 2px solid white !important;
    border-radius: 50%;
}
.slide-displays-root div:has(div) > div :first-child > :first-child > :last-child > svg {
    opacity: 0 !important;
}
#AssessmentForm :not(label) span {
    color: ${black} !important;
}
#AssessmentForm label span {
    color: ${#222} !important;
}

================================

myaccount.google.com

INVERT
.iKN8Oe

================================

myaccount.suse.com

INVERT
.auth-org-logo
.logo

================================

myalmacoffee.com

CSS
:root {
    --gradient-base-background-1: var(--darkreader-neutral-background) !important;
}

================================

myanimelist.net

INVERT
.link-provider img
.theme-songs td[width="8%"]:first-child

CSS
body:not(.ownlist) {
    background-color: var(--darkreader-neutral-background) !important;
}
body {
    background-color: var(--dakreader-neutral-background) !important;
    background-image: none !important;
}

================================

mybrandnewlogo.com

IGNORE INLINE STYLE
.b-logo-wrap *

================================

myfood4less.com

INVERT
.elementor-widget-theme-site-logo

================================

mymenu.be

INVERT
.close-icon

CSS
.uix-steps .item.active .number {
    color: ${darkred} !important;
}

IGNORE INLINE STYLE
.uix-tracking .information .step .number

================================

myorca.*

INVERT
path.b

CSS
.m-banner h1,
.m-banner p {
    color: black !important;
}

================================

myunidays.com

INVERT
.title
.menu-btn-icon

================================

mywikis.com

INVERT
.heading-primary
.heading-subtext
.hero

================================

n.maps.yandex.ru
mapeditor.yandex.com

INVERT
span[class*="nk-icon_id_commit-"] > svg > g > path
span[class*="nk-icon_id_business-feedback-task"] > svg > g > path

================================

naeu.playblackdesert.com

INVERT
.top_news_detail_visual
.top_news_detail_visual h2

CSS
.top_news_detail_visual {
    background-image: url("https://s1.pearlcdn.com/NAEU/contents/img/portal/news/news_detail_visual_top.png") !important;
}

================================

nagatabi-p.jimdofree.com

INVERT
.cc-imagewrapper > img

================================

nalog.ru

INVERT
.header__logo

================================

namecheap.com

INVERT
.whoisguard-img

================================

naps2.com

CSS
.os-icon[title="Linux"] {
    background-color: white !important;
}

================================

narimiran.github.io/nim-basics

CSS
body,
#toc.toc2 {
    background-color: var(--darkreader-neutral-background) !important;
}

================================

narrativ.com

INVERT
img[alt="Narrativ Logo"]

================================

nasa.gov

IGNORE IMAGE ANALYSIS
.vjs-has-started .vjs-control-bar .vjs-control.vjs-logo-image

================================

natemat.pl
aszdziennik.pl
innpoland.pl
dadhero.pl
mamadu.pl

INVERT
img[src*="/static/media/"]
img[alt="close icon"]
a[href="#comments"]
.st1

CSS
img[class*="Footer--Logo"] {
    background-color: #fff !important;
}

================================

nation.cymru

CSS
body {
    background-color: var(--darkreader-neutral-background) !important;
}

================================

nationaleaglecenter.org

INVERT
img[title="logo"]

================================

nationalgeographic.com

INVERT
.NavBar__Logo__Container

================================

nationalgeographic.com.es
*.nationalgeographic.com.es
nationalgeographic.pt

INVERT
#siguenos-iconos
.link-header-module img
.page-header .navbar-toggle
.page-header .brand .logo

================================

nature.com

INVERT
.c-header__logo
[href="#search-menu"] > svg
.c-header__link--chevron > svg
img[alt="Nature Careers"]

================================

naturemade.com

INVERT
div.header-banner > svg
ul.main-nav-child-links > li > a > img

CSS
:root {
    --gradient-base-background-1: unset !important;
}
form[action="/search"] > div > label {
    display: none;
}

================================

nauka.rocks

INVERT
.navigation-branding

================================

navalnews.com

INVERT
.logo

================================

nba.com

INVERT
.nlProgressBar

================================

nbc12.com

INVERT
div.logo.logo-slim
div.logo.logo-large.logo-footer

IGNORE IMAGE ANALYSIS
.logo

================================

nbcphiladelphia.com

INVERT
.site-footer__social-list-item .icon

================================

nbi.ku.dk

CSS
.tile-link {
    color: var(--darkreader-neutral-color) !important;
}

================================

ncbi.nlm.nih.gov

INVERT
.gene-genomic-context p.withnote img
.home_page .action_bar img

================================

nec.com

INVERT
.logo

================================

needymeds.org

CSS
#header {
    background: unset !important;
}

================================

nejm.org

INVERT
a[href="/"] svg

================================

neonet.pl

INVERT
div[class^="newsSingleBar"] > div[class^="newsSingleBarHeaderWidescreen-category"]

CSS
div[class^="newsSingleBar"] > div[class^="newsSingleBarHeaderWidescreen-category"] {
    color: ${white} !important;
}

================================

neoseeker.com

CSS
.hidden_text {
    background-color: var(--darkreader-neutral-text) !important;
    color: var(--darkreader-neutral-text) !important;
}
.hidden_text.shown {
    background-color: transparent !important;
    color: var(--darkreader-neutral-text) !important;
}

================================

neowin.net

INVERT
.comment-link
.news-view-switcher span
.author a.twitter-link
.meta-comments
.comment-link::before
.select-wrap::after
.report-article-button::before
#comment-help::before
.comment-button-report
.comment-interact a

CSS
.select option {
    background-color: #1c1e1f !important;
    color: white !important;
}

================================

nerdschalk.com

INVERT
.logo-default

================================

nerdwallet.com

IGNORE INLINE STYLE
#global-nav *

================================

nero.com

INVERT
.navbar-brand

================================

netbank.sparthy.dk

CSS
select option {
    background-color: var(--darkreader-neutral-background) !important;
}

================================

nethackwiki.com

INVERT
.tex

IGNORE IMAGE ANALYSIS
.mw-wiki-logo

================================

netia.pl

INVERT
.main-navigation__logo

================================

netlify.com

INVERT
.masthead-home-logo
.logo-wall
.input

CSS
.root {
    data-darkreader-inline-fill: var(--scrim-icon-color) !important;
}
.submenu,
.table-wrapper,
.table-header,
td {
    background-color: var(--darkreader-neutral-background) !important;
    color: var(--darkreader-neutral-text) !important;
}
.menu,
.ntl-announcement-bar {
    color: var(--darkreader-neutral-text) !important;
}

================================

netzpolitik.org

INVERT
img[src*="/wp-content/themes/liebefeld/images/netzpolitik_logo.svg"]
img[src*="/wp-content/themes/liebefeld/images/palasthotel.svg"]
a.menu__canvas--toggle

================================

neuralnetworksanddeeplearning.com

INVERT
img[src$=".png"]
img[src^="images/KSH"]
img[src^="images/bump_function"]
img[src^="images/high_weight_function"]
canvas
svg
video

================================

new.mta.info

CSS
.services-container > .ss-header > #service-status-widget > .active > a:link {
    background-color: #f2a900 !important;
    color: #002d72 !important;
}
.services-container > .ss-header > #service-status-widget > .active > a:link::before {
    color: #002d72 !important;
}
.ss-header {
    border-bottom: 3px solid #f2a900 !important;
}

IGNORE INLINE STYLE
a[title="MTA"] > svg > path

IGNORE IMAGE ANALYSIS
.block-service-status-block .line-1
.block-service-status-block .line-2
.block-service-status-block .line-3
.block-service-status-block .line-7
.block-service-status-block .line-A
.block-service-status-block .line-C
.block-service-status-block .line-E
.block-service-status-block .line-SI

================================

newegg.com

CSS
.show-img-bg .goods-img:not(.bg-lightgray),
.show-img-bg .goods-img > img {
    mix-blend-mode: normal !important;
}

================================

newreleases.io

CSS
.bg-white > .bg-cover {
    background-blend-mode: multiply !important;
    background-color: ${rgba(255,255,255,0.95)} !important;
}

================================

news.mit.edu

INVERT
.logo > .mit-news

================================

news.mynavi.jp

INVERT
.itsearch-head .logo
.site-header__bnr
.site-header__logo

================================

news.yahoo.co.jp

IGNORE IMAGE ANALYSIS
.QrZuR

================================

news.yahoo.com

INVERT
#uh-logo
.vp-handle

================================

news.ycombinator.com

INVERT
.votearrow

CSS
#hnmain {
    background-color: var(--darkreader-neutral-background) !important;
}
#hnmain .toptext {
    color: var(--darkreader-neutral-text) !important;
}

================================

newsmax.com

CSS
#nmMain {
    background-image: none !important;
}

================================

newyorker.com

INVERT
[data-testid="Logo"]
[class*="Logo__logo"]

================================

nexojornal.com.br

INVERT
.g-aiImg

================================

nextdns.io

CSS
.index .key-features .feature.blocklists {
    background-image: none !important;
}

IGNORE INLINE STYLE
path.rsm-geography

IGNORE IMAGE ANALYSIS
.index .hero .content .logo

================================

nextjs.org

IGNORE INLINE STYLE
.banner *

================================

nextron.no

CSS
.configurator .summary__titles .resource-row {
    border-color: var(--darkreader-neutral-text) !important;
}
.configurator .summary__titles .resource-row > .resource-shape {
    border-color: var(--darkreader-neutral-text) !important;
}
.configurator .summary__titles .resource-row > .resource-filled {
    background-color: var(--darkreader-neutral-text) !important;
    border-color: var(--darkreader-neutral-text) !important;
}

================================

ngrok.com

INVERT
.customer-logos

CSS
.browser path[fill="#BBB"],
.browser g[fill="#BBB"] {
    fill: #BBB !important;
}
.terminal tspan[fill="#FFF"] {
    fill: #FFF !important;
}
.terminal tspan[fill="#BBB"] {
    fill: #BBB !important;
}

================================

nicehash.com

INVERT
.chart
img[src*="hashpower@2x]

================================

nicovideo.jp

INVERT
.NicoruIcon circle

CSS
@media (prefers-color-scheme: dark) {
    #IMALinearView iframe {
        opacity: 0.1 !important;
    }
}

================================

niestatystyczny.pl

INVERT
div#logo > h1 > a > img

================================

nightbot.tv

CSS
.nightbot-ScrollShadows-module__scrollShadows-IWawz {
    background: transparent;
}

================================

nirsoft.net

CSS
.menub1 a:link,
.menub1 a:visited {
    color: #0040ff;
}
.menub1 a:hover {
    color: #ffffd0;
}

================================

niser.ac.in

CSS
body,
#main-content,
#page {
    background-image: none !important;
}

================================

nixos.org

INVERT
header a[href="/"]::after

CSS
.demo-preview > .thumbnail svg .background {
    fill: var(--darkreader-neutral-background) !important;
}
.packages-searchbox::before,
.packages-searchbox::after {
    background-image: none !important;
}

================================

nlnet.nl

INVERT
.header_logo

================================

nlopt.readthedocs.io

CSS
.wy-nav-content-wrap {
    background-color: var(--darkreader-neutral-background) !important;
}

================================

nnmclub.to
nnm-club.me

INVERT
img[src$="images/icon_arrow.gif"]
img[src$="images/freeleech.gif"]

CSS
div.ui-datepicker {
    background: none !important;
}

IGNORE IMAGE ANALYSIS
*

================================

nodejs.org

CSS
[data-theme="dark"] h1.special {
    background-image: linear-gradient(180deg, #fff, hsla(0, 0%, 100%, .8)) !important;
}
[data-theme="light"] h1.special {
    background-image: linear-gradient(180deg, ${#2c3437}, ${rgba(44, 52, 55, .8)}) !important;
}

================================

nof1sced.org

CSS
.xU8fqS .gUbusX {
    background-color: transparent !important;
}

================================

nofluffjobs.com

INVERT
ul.posting-info-row li.tw-items-center svg.icon

================================

nokia.com

CSS
.pds-background-cover > .pds-background-image-set {
    background-color: var(--darkreader-neutral-background) !important;
}
.pds-background-cover video {
    filter: brightness(50%) sepia(40%) !important;
}

================================

nomadgoods.com

INVERT
header a[href="/"] > svg

================================

nonograms.org

CSS
.nonogram_table {
    background-color: #404040 !important;
}

================================

nonsa.pl

INVERT
a.mw-wiki-logo
#p-banner

================================

norton.com

INVERT
.c-topnav__wrap a

================================

nos.nl

INVERT
.npo-button

IGNORE IMAGE ANALYSIS
.npo-button

================================

notebooks.githubusercontent.com/view/ipynb

CSS
.jp-InputArea-editor,
.jp-CodeConsole .CodeMirror.cm-s-jupyter,
.jp-Notebook .CodeMirror.cm-s-jupyter,
.highlight {
    background-color: var(--darkreader-neutral-background) !important;
}

================================

notion.so

INVERT
img[alt="People using Notion"]
.global-margin-s .logos
.persona-grid > .persona-grid-item > .persona-grid-image
.desktop-illustration
.illustration .next-image
.api-section-image .next-image
.visual .next-image
.logo svg > :first-child

CSS
body {
    background-color: var(--darkreader-neutral-background) !important;
}
* {
    caret-color: ${gray} !important;
}
.notion-divider-block div div {
    border-bottom: 1px solid ${rgba(55, 53, 47, 0.4)} !important;
}

================================

novartis.com

INVERT
#logo

================================

novelgames.com

CSS
a#commonLogo {
    background-image: url("https://staticz.novelgames.com/style/default/common_e.5.png"), linear-gradient(rgb(255, 255, 255), rgb(255, 255, 255)), url("https://staticz.novelgames.com/style/default/common.8.png") !important;
}

================================

novinky.cz
garaz.cz
seznamzpravy.cz

CSS
.ribbon,
.szn-input-with-suggest-list {
    background-color: var(--darkreader-neutral-background) !important;
}
.szn-input-with-suggest-list {
    border-color: ${gray} !important;
}

================================

nowafarmacja.pl

INVERT
.icon-chevron-down
.payment-banners
.hheader::after

================================

nowemedium.pl

INVERT
.logo-tagline-group
.menu_toggle

================================

nperf.com

INVERT
.SpeedTest > .resultPanel

CSS
.SpeedTest > .resultPanel {
    background-color: transparent !important;
}

================================

npmjs.com

INVERT
header a[href="/"] svg
#orgs_panel img.h2
#enterprise_detail_panel img.h2
#customers_panel img[src*="adobe.full.png"]
#customers_panel img[src*="bbc.full.png"]
#customers_panel img[src*="conde-nast.full.png"]
#customers_panel img[src*="netflix.full.png"]
#customers_panel img[src*="visa.full.png"]
._5532dff2
._93bbf0b4

CSS
a title + g[data-darkreader-inline-fill] {
    fill: var(--darkreader-neutral-text) !important;
}

================================

nrc.nl

INVERT
.header__logo
.selections-bar__item__image
.header__button svg
.block__more-link__arrow path
.metabox__icon
.article__byline__icon
.footer__logo
.socialbuttons

================================

ntlite.com

CSS
.fr-wrapper *::selection {
    background-color: dodgerblue !important;
}

================================

nu.nl

CSS
.app-figure--caption-overlay {
    background: linear-gradient(0deg, var(--darkreader-neutral-background), #fff 40%) !important;
}
.main-nav__main {
    border-top: inherit !important;
}

================================

nvidia.com
nvidia.in

INVERT
svg.global-footer__logo
a.brandLink
img[src*="Experience"]
img[src*="tao-toolkit-"]
img[src*="logo"]
img[alt*="Logo"]

CSS
div.nvidia a svg {
    fill: ${black} !important;
}
div.brand-container a svg {
    fill: ${black} !important;
}
.taboff {
    background-image: none !important;
}
.mid-gray {
    background-color: #999 !important;
    fill: #999 !important;
}
.dark .green40 {
    background-color: #3b5d00 !important;
    fill: #3b5d00 !important;
}
.green50 {
    background-color: #598b00 !important;
    fill: #598b00 !important;
}
.dark .green100 {
    background-color: #76b900 !important;
    fill: #76b900 !important;
}

================================

nvidia.pl

INVERT
.brand-container
img[src*="Experience"]
a[href*="facebook"]
a[href*="twitter"]

CSS
body,
.taboff {
    background-image: none !important;
}

================================

nxos.org

INVERT
#logo
a[href^="#sidewidgetarea"]

================================

nymag.com

INVERT
.article-feed-header svg
.article-nav-top-center
#latest-feed-title
.logo-svg
#site-feed-curbed-title > .feed-title-wrapper
.tab-trigger > svg
.tab-trigger > svg > circle
.tab-trigger > svg > g > circle
.title-logo
#vulture-trigger > svg > g > path:nth-child(1)
#wwwthecut-trigger > svg > .active > path

CSS
.collection-articles-lede_first-featured .lede-item[data-track-index="0"] .lede-image-wrap {
    z-index: 0 !important;
}
.collection-articles-lede_first-featured .lede-item[data-track-index="0"] .lede-text-wrap {
    position: absolute !important;
    z-index: 1 !important;
}

================================

nytimes.com

INVERT
button[aria-label="Listen to article"] path[stroke="#DFDFDF"]
#site_header_wrapper a[aria-label="Wirecutter"]
div[data-testid="masthead-desktop-logo"] > a > svg
div#live-country-map.live-country-map-embed
div#live-us-map.live-us-map-embed
.needle-wrap > svg
.svelte-1v1dl99
.vmap-layer-container > g > text
.vmap-zoom-buttons
#xwd-board
.pz-nav__logo
.pz-nav__hamburger-box

CSS
button[aria-label="Listen to article"] path[d="M22 38L37 28L22 18V38Z"],
button[aria-label="Save article for reading later..."] .saved-stroke {
    fill: var(--darkreader-neutral-text) !important;
}
.css-oylsik,
.css-nhjhh0 svg,
.css-18z7m18 svg,
.css-1q2j1fr svg,
a[data-testid] > svg {
    fill: ${black} !important;
}
.headline-link div {
    color: ${black} !important;
}
.headline-link div:hover {
    color: ${#555} !important;
}
.svelte-15nnlbj {
    font-weight: bold !important;
}
#xwd-board rect[class^="Cell-block--"] {
    fill: ${black} !important;
}
#xwd-board text[class^="Cell-hidden--"] {
    color: ${black} !important;
}
#xwd-board rect[class^="Cell-cell--"] {
    fill: ${darkgrey} !important;
}
#xwd-board rect[class^="Cell-highlighted--"] {
    fill: ${lightgrey} !important;
}
#xwd-board rect[class^="Cell-selected--"] {
    fill: ${white} !important;
}
#xwd-board rect[class^="Cell-related--"] {
    fill: ${goldenrod} !important;
}
#xwd-board rect[class^="xwd__cell--cell"] {
    fill: ${darkgrey} !important;
}
#xwd-board rect[class^="xwd__cell--highlighted"] {
    fill: ${lightgrey} !important;
}
#xwd-board rect[class^="xwd__cell--selected"] {
    fill: ${white} !important;
}
#xwd-board rect[class^="xwd__cell--related"] {
    fill: ${khaki} !important;
}
#xwd-board rect[class*="xwd__cell--penciled"] ~ text[text-anchor^="middle"] {
    fill: ${blue} !important;
}

IGNORE INLINE STYLE
line[style="stroke: var(--tie); stroke: black;"]

================================

nzbget.*

INVERT
.icon-top
.icon-bottom
.icon-up
.icon-down

================================

nzz.ch

INVERT
.logo

CSS
.logo {
    background-color: unset !important;
    color: ${white} !important;
}

================================

o2.co.uk

INVERT
.brandLogo

================================

oalevelsolutions.com

INVERT
p > span > img

================================

objectclub.jp

INVERT
#region-content > div.plain > table > tbody > tr > td > img:nth-child(2)

CSS
body {
    background-image: none !important;
}

================================

obserwatorgospodarczy.pl

INVERT
.logo-img

================================

oclc.org

IGNORE INLINE STYLE
.chart-key

================================

odysee.com

INVERT
.header__navigation-logo
[data-vjs-player] .vjs-control-bar > [title="Autoplay Next Off"]
[data-vjs-player] .vjs-control-bar > [title="Autoplay Next On"]::after

CSS
.content__viewer {
    border: none !important;
}

================================

oed.com

INVERT
img[alt="search"]

CSS
.wordy {
    color: var(--darkreader-neutral-text) !important;
}
#maincontainer {
    color: var(--darkreader-neutral-text) !important;
}

IGNORE IMAGE ANALYSIS
select

================================

oeis.org

INVERT
.mwe-math-fallback-image-inline
.mwe-math-fallback-image-display

================================

oferteo.pl

INVERT
img[src*="oferteo-color"]
ul.logo-box.text-center
span.icon-gray.quotation-mark

================================

office.com
*.office.com

INVERT
.ms-ohp-svg-Icon.ms-ohp-Icon--privacyLogo

IGNORE IMAGE ANALYSIS
.ms-ohp-svg-Icon.ms-ohp-Icon--privacyLogo
.ms-ohp-svg-Icon.ms-ohp-Icon--calendarLogo::before
.ms-ohp-svg-Icon.ms-ohp-Icon--flowLogo::before

================================

ogs.google.com

CSS
body > div > c-wiz > div > div > c-wiz > div > div > div > div > div {
    background: var(--darkreader-neutral-background) !important;
}

================================

oisd.nl

INVERT
img[alt="logo"]

================================

okonto.pl

INVERT
.imageWidget

================================

okta.com

INVERT
.chiclet--container
.chiclet--article
.chiclet--footer
img[class="logo"]

================================

old.reddit.com

INVERT
.volume-slider-bar
.volume-slider-thumb
.reddit-video-seek-bar-root
.infobar.listingsignupbar

CSS
.seek-bar-progress {
    background-color: ${#004daa} !important;
}
body::before {
    z-index: 0 !important;
}
.link .entry,
.link .usertext-body .md,
.side,
.commentarea,
.commentarea > .usertext.cloneable,
#sr-header-area,
#sr-more-link,
.tabmenu li.selected a,
input[type="text"],
textarea,
.comment,
.comment .flat-list li,
.title-button,
.linkinfo,
.titlebox form.toggle,
.side .md > blockquote:first-child,
body.loggedin .side .redditname::after,
.side .md > blockquote:first-child > h1 + p a,
.side .md h2:first-of-type ~ *,
.side .md > p:first-of-type ~ h2::before,
.side .sidecontentbox,
.flair::before,
.flair::after,
.linkflairlabel::before,
.linkflairlabel::after {
    background-color: var(--darkreader-neutral-background) !important;
    background-image: none !important;
}

================================

oleole.pl

INVERT
#logo::after
div[id="brands-carousel"]
div[id="footer-logo-brands"]
img[src*="main_menu"]
img[src*="SG/icon"]

================================

olx.pl

CSS
.searchmain {
    background-color: var(--darkreader-inline-bgcolor) !important;
}
.wrapper,
.footer-bottom {
    background-color: var(--darkreader-neutral-background) !important;
}

IGNORE IMAGE ANALYSIS
.cat-icon.cat-cmt-icon-628
.cat-icon.cat-cmt-icon-87
.cat-icon.cat-cmt-icon-2433
.maincategories .maincategories-list .li .item a[data-id="promo"] .category-1.cat-icon-promo
.maincategories .maincategories-list .li .item a[data-id="promo"] .category-6.cat-icon-promo
.maincategories .maincategories-list .li .item a[data-id="promo"] .category-8.cat-icon-promo
.maincategories .maincategories-list .li .item a[data-id="promo"] .category-7.cat-icon-promo
.maincategories .maincategories-list .li .item a[data-id="promo"] .category-2.cat-icon-promo
.maincategories .maincategories-list .li .item a[data-id="promo"] .category-5.cat-icon-promo
.maincategories .maincategories-list .li .item a[data-id="promo"] .category-4.cat-icon-promo
.maincategories .maincategories-list .li .item a[data-id="promo"] .category-3.cat-icon-promo

================================

omarapollo.com

INVERT
.header__heading-logo

CSS
.gradient {
    background: var(--darkreader-neutral-background) !important;
}

================================

omgubuntu.co.uk

CSS
.header {
    background: var(--header-background) !important;
}

================================

omni.se

CSS
.article,
.resource,
.component--storyLink,
.component--storyHeading,
.btn--secondary,
.starbox-star {
    background-color: var(--darkreader-neutral-background) !important;
}

================================

omnicalculator.com

CSS
.GenericText {
    color: var(--darkreader-neutral-text) !important;
}

================================

omnivox.ca

INVERT
td[style*="/cvir/UI"]
img[src^="/cvir/UI/Theme/Lea_Defaut/Images/Accueil_LEA"]
img[src="/cvir/UI/Theme/Lea_Defaut/Images/mesclasses_cg_subtop.jpg"]
img[src^="/cvir/UI/Theme/Lea_Defaut/Images/accueil_"]
img[src$="/bas_du_menu.jpg"]
img[src$="tile.jpg"]
.cgSelect
.mioLinks
.calendrier
.servLinks
.descSection

CSS
.cgSelect > table > tbody > tr > td:nth-child(1) > a > font {
    color: green !important;
}
.calendrier > table > tbody > tr,
.calendrier > table > tbody > tr > td > img,
.calendrier > table > tbody > tr > td > table > tbody > tr > td > img {
    filter: invert(100%) hue-rotate(180deg) contrast(100%) !important;
}
table[style*="/cvir/UI"],
.cgBg {
    background-image: none !important;
}

================================

one.one.one.one

INVERT
.PerformanceSection--figure-item-bar

================================

one.uf.edu

CSS
body {
    background-color: var(--darkreader-neutral-background) !important;
}

================================

onedrive.live.com

CSS
.ms-CommandBar {
    background-color: var(--darkreader-neutral-background) !important;
}

================================

onelook.com

INVERT
img[alt="OneLook"]

================================

onepeterfive.com

CSS
.gb-has-dynamic-bg {
    background-image: var(--background-url) !important;
}

================================

onet.pl
plejada.pl
*.onet.pl

INVERT
[class*="WeatherDay_tempIcon"]
._3ZySwSLi_pur0unnAQO2No
.forecast img
.icon-shareIcon svg
.locationName svg
.logo-cls-1
.logoImageRight
.serviceIcon
.sheet
.weatherBox .iconNow
[class*="weatherIcon"]
.websiteLogo
[class*="Logo_"]
a.serviceLogo img
img[alt="O!Konto"]
img[alt="Plejada.pl"]
ul.contentList img.icon
svg[class*="MenuIcon"]
svg[class*="LoginIcon"]
svg[class*="ProfileImage_imageSvg"]
.weatherExtrasWidget__category-image img
[class*="SponsorImage"]
.windDirectionArrow
.geoIcon
.regionsContentList .iconHolder img
.hSunChart img
.hMoonChart img

CSS
.mainBoxBgHolder {
    background-blend-mode: color;
    background-color: rgba(0, 0, 0, 0.25);
}
.weatherMap .mapLayer .fil0,
#weatherChartsHolder .chartValue {
    fill: rgb(128, 128, 128) !important;
}
svg path[d^="M50.315,89"],
path[d^="M15.757"],
path[d^="M14.989"],
path[d^="M8.935"],
path[d^="m14.05"] {
    fill: ${white} !important;
}
.contentPremium * {
    filter: unset !important;
}

================================

online.noordhoff.nl

INVERT
#EAGABA img

================================

online.rbb.bg

INVERT
.has-context:hover
.active
.btn

================================

onlinelibrary.wiley.com

INVERT
#mainLogo

================================

onlinetrade.ru

INVERT
.drawCats__item__name

CSS
.drawCats__item__image {
    filter: brightness(50%) sepia(40%) !important;
}

================================

onlineuniversities.com

CSS
body {
    background-image: none !important;
}

================================

onlyoffice.com

INVERT
.logo

================================

onnibus.com

INVERT
.icon

================================

op.gg

INVERT
.Level
.ranking-highest__icon .ranking-highest__level

================================

open-meteo.com

CSS
.highcharts-background,
.highcharts-tooltip text,
.highcharts-no-tooltip text {
    fill: ${white} !important;
}
.highcharts-axis-title,
.highcharts-title,
.highcharts-axis-labels,
.highcharts-label-box,
.highcharts-button-box,
.highcharts-legend-item text {
    fill: ${black} !important;
}
.highcharts-axis-line {
    stroke: ${white} !important;
}
body {
    background-color: ${white} !important;
    color: ${black} !important;
}
body,
footer .text-secondary-foreground,
.text-center,
input button * {
    color: ${black} !important;
}
.text-white * {
    fill: ${black} !important;
    text-shadow: none;
}
input {
    color: var(--darkreader-neutral-text) !important;
}
.bg-background {
    background-color: var(--darkreader-neutral-background) !important;
}
.bg-accent {
    background-color: gray !important;
}
.-z-10 {
    z-index: 0 !important;
}

================================

openai.com

INVERT
figure.release-cover>div:first-of-type>img

CSS
body {
    background: initial !important;
}
header[style*="background-image"],
.bg-cover[style*="background-image"] {
    background: none !important;
}
.is-below-fold .header--cover .nav,
.is-below-fold .post-header--cover .nav {
    background: ${white} !important;
    color: ${black} !important;
}
span.token.comment {
    color: ${#aaa} !important;
}
span.token.punctuation {
    color: ${#777} !important;
}
a.btn:not(.fade),
button.btn {
    background: ${rgba(5, 5, 38, 0.05)} !important;
    color: ${#050526} !important;
}
button.btn:hover {
    color: ${#b0b0b0} !important;
}
figcaption,
.caption {
    color: ${rgba(5,5,38,0.5)} !important;
}
.content .timeline > li::before,
.timeline > li::before {
    color: ${black} !important;
}
.content .timeline > li::after,
.timeline > li::after {
    background-color: ${black} !important;
}
.switch-input:checked + .switch-label {
    color: ${rgba(0, 0, 0, 0.7)} !important;
}

================================

openanolis.org

INVERT
.logo

================================

openbenchmarking.org

INVERT
g[font-size]:not(g[font-size][fill^="#fff" i]:not(.oborg_expandable_result g))
g[font-size]:not(g[font-size][fill^="#fff" i]) > text[fill="#005a00"]

IGNORE INLINE STYLE
g[font-size][fill^="#fff" i]

================================

opencollective.com

INVERT
img[alt="Open Collective"]

CSS
#section-contributors > div {
    background-image: none !important;
}

================================

openebooks.net

INVERT
img[src="images/home_banner.png"]

================================

openenglishbible.org

INVERT
#logo
img[src="html-logo.png"]

================================

opengeofiction.net
openstreetmap.org
openhistoricalmap.org

INVERT
.map-layout #map .leaflet-tile
.map-layout #map .leaflet-image-layer
.ideditor g.vertex .icon
.ideditor g.point .icon
.ideditor .icon.areaicon-halo

CSS
:root {
    --darkreader-background-7092ff: #4050c0;
}
div[dir="ltr", id="map"] {
    background: #000 !important;
    filter: none !important;
}
.ideditor .labels-group.halo text {
    stroke: var(--darkreader-neutral-background) !important;
}
.map-layout #map {
    background-color: var(--darkreader-neutral-background) !important;
}
img.loader {
    filter: invert(93.7%) hue-rotate(180deg) contrast(90.6%) !important;
}

IGNORE INLINE STYLE
.ideditor .main-content *

================================

openoffice.org

INVERT
#ooo-logo

================================

openreview.net

CSS
#__next {
    background-color: var(--darkreader-neutral-background) !important;
}

================================

openspeedtest.com

CSS
use.Cards {
    fill: unset !important;
}

================================

openstax.org

CSS
input[data-testid$="-search-input"] {
    background-color: transparent !important;
}

================================

openvpn.net

IGNORE INLINE STYLE
.navbar-brand > svg *

================================

openwall.com

INVERT
.logo

================================

openweathermap.org

INVERT
#chart-component
#y-axis
img.leaflet-tile

================================

openwrt.org

CSS
#dw__pagetools .menuitem svg {
    fill: var(--darkreader-neutral-text) !important;
}

================================

orf.at/corona/*

INVERT
.bg
.annotation
.sparkline--fill

================================

origene.com

CSS
.block .title *,
.items > li,
.nav-item *:not(:hover),
.oti-footer *,
.product.attribute.sku,
.product.info.detailed,
.product-info-main,
.product-related-container *,
.switch,
body {
    color: var(--darkreader-neutral-text) !important;
}

================================

osu.edu
ohio-state.edu

CSS
#osu_navbar {
    background-image: linear-gradient(rgb(40, 43, 45) 0%, rgb(63, 69, 71) 100%);
    border-bottom: 5px solid rgb(187, 0, 0);
}
body.sidebar-layout #page #content,
#page #content {
    background-image: none;
}

================================

otomoto.pl

INVERT
.seller-card__links__link__icon

================================

overleaf.com

INVERT
.canvasWrapper

================================

overreacted.io

CSS
:root {
    --bg: var(--darkreader-neutral-background) !important;
}

================================

overwatchleague.com

CSS
div[class^="dynamic-bracketstyles__Container"] .connector {
    z-index: 0 !important;
}
body {
    background-image: var(--darkreader-neutral-background) !important;
}

================================

ovhcloud.com

INVERT
.oof-content-group-line-item

================================

owncube.com

INVERT
[src="/assets/img/logo.png"]

CSS
h1,
h2,
h3,
h4,
h5 {
    color: var(--darkreader-neutral-color);
}

================================

oxfordlearnersdictionaries.com

INVERT
.old_logo
.logo-footer

================================

ozbargain.com.au

CSS
div.comment-op {
    background-image: linear-gradient(#000000, #212121) !important;
}

================================

ozon.ru

INVERT
ymaps[class$="ground-pane"]

================================

p30download.com

CSS
.article-wrapper {
    color: ${#090702} !important;
}

================================

pa.gov

INVERT
.nav .nav-trigger.nav-open .inner

CSS
button {
    border: 2px solid #003e51 !important;
}
.nav-trigger:hover {
    box-shadow: inset 0 0 0 2px #003e51 !important;
}
.nav-wrapper {
    background: #003e51 !important;
}

================================

pacjent.gov.pl

CSS
.hero-content {
    color: var(--darkreader-neutral-background) !important;
}

================================

packages.ubuntu.com

CSS
body {
    background-image: none !important;
}

================================

pagerduty.com

INVERT
.navbar-brand

CSS
[class*="SearchBox_icon"] {
    filter: invert(80%);
}

================================

palemoon.org

INVERT
img[src="images/goanna200x66.png"]
img[src="images/vpsserver.png"]

================================

palshovon.wixsite.com

INVERT
#BACKGROUND_GROUP
[alt="Marble Surface"]

CSS
[data-mesh-id="SITE_FOOTERinlineContent-gridContainer"] {
    background-color: var(--darkreader-neutral-background) !important;
}

================================

pan.baidu.com

INVERT
.module-header-wrapper dt

================================

pan.quark.cn

INVERT
img[alt="夸克网盘"]
img[alt="夸克网盘 logo"]

================================

panapply.org

INVERT
.logo

================================

panerabread.com

INVERT
.pds-h-logo

================================

panthema.net

CSS
body {
    background-image: none !important;
}

================================

papaya.rocks

INVERT
.favorite.js-open-login
.header__title
.js-logo
.js-logo-big
.js-menu-toggle
.js-open-search
.nav__item--profile
.search__button
.search__close

================================

parallel42.com

INVERT
.header__logo-image

CSS
.content-over-media::before {
    background: rgb(var(--content-over-media-overlay)) !important;
}
.buy-buttons button {
    background-color: black !important;
}
.buy-buttons button:hover {
    opacity: 0.75 !important;
}

================================

park-in.gr

CSS
.div-background {
    z-index: 0 !important;
}
.container {
    position: relative !important;
    z-index: 1 !important;
}

================================

partitionwizard.com

CSS
.pw-banner {
    background-image: none !important;
}

================================

passport.baidu.com

INVERT
.pass-header-logo
.right-icon

================================

passport.bilibili.com/login

CSS
.qrcode-box {
    background: white !important;
    padding: 10px !important;
}

================================

passport.jd.com

CSS
.qrcode-img {
    background: white !important;
}

================================

passport.yandex.*

CSS
.MagicField-qr {
    background-color: white !important;
}

IGNORE IMAGE ANALYSIS
*

================================

paste.rs

CSS
pre {
    --darkreader-inline-bgcolor: var(--darkreader-neutral-background) !important;
}

================================

pathfinderwiki.com

CSS
body {
    background-color: ${rgb(245,245,245)};
    background-image: none;
}
.mw-page-container-inner {
    background-color: ${rgb(225,225,245)};
    background-image: none;
}
.fw-alignment-on {
    --darkreader-inline-bgcolor: royalblue !important;
}
.fw-alignment-on a {
    color: ${black} !important;
}

================================

patreon.com

INVERT
a[href^="https://docs.google.com"] img
a[href^="https://forms.gle"] img
button[data-tag="menuToggleDiv"] svg
[data-tag="creator-public-page-social-twitch"]
[data-tag="creator-public-page-social-twitter"]
[data-tag="pages-creator-public-page-Header-ShareCampaign"]

CSS
div[data-tag="comment-actions"] svg,
div[data-tag="post-details"] svg {
    fill: var(--darkreader-neutral-text) !important;
}

IGNORE IMAGE ANALYSIS
*

================================

patriotmemory.com

INVERT
.w-nav a[href="/"] img
.w-nav-brand

================================

patuscada.bar

INVERT
.topo
.topo > *
.patuscada-logo
.botoes-topo a:last-child img
.logo

IGNORE IMAGE ANALYSIS
.etiqueta-vermelha

================================

paulgraham.com

CSS
body {
    background-image: none !important;
}

================================

paypal-doladowania.pl

INVERT
img[src*="/img/bank-logos/"]

================================

paypal.com

INVERT
span[style*="svg"]

CSS
input.invoiceNumber,
input.transactionAmount {
    border-style: solid !important;
    border-width: 1px !important;
}
.cw_tile-promo-title-container_dw2.css-1cak51m-card_base {
    background: none !important;
}
.tab_container,
.listing_bg {
    background-color: ${#faf8f5} !important;
}
.listing_container,
.listing_container_background {
    background-color: var(--darkreader-neutral-background) !important;
}
div[data-testid="federated-moneyfragment"] span[class*="css-"]:before {
    font-family: PPUI-Icons, "Helvetica Neue", Arial, sans-serif !important;
}

================================

payu.com

CSS
img[src$="PayU-Map_Homepage_World.svg"] {
    filter: invert(90%) hue-rotate(180deg) contrast(90%) !important;
}

================================

pbs.org

CSS
BODY.normal td.bodyarea,
body[background] {
    background-image: none !important;
}

IGNORE INLINE STYLE
.page-header__brand > svg > path

================================

pcdiga.com

CSS
.data {
    background-color: var(--darkreader-neutral-background) !important;
}
input,
textarea {
    background-color: var(--darkreader-neutral-background) !important;
    color: var(--darkreader-neutral-text) !important;
}
li.level0 > a {
    color: var(--darkreader-neutral-text) !important;
}
li.level0 > a:hover {
    color: #ff4d23 !important;
}

================================

pcgamer.com

INVERT
img[alt="Best Buy"]
img[alt="Amazon"]

CSS
img {
    mix-blend-mode: normal !important;
}

IGNORE INLINE STYLE
path

================================

pcgamingwiki.com

INVERT
img[alt="Gamesplanet logo.svg"]
div.infobox-steamdb

================================

pch24.pl

INVERT
a[href="https://pch24.pl"] svg

CSS
a[href="https://pch24.pl"] svg path[fill="#1d1e1d"] {
    --darkreader-inline-fill: ${white} !important;
}

================================

pcloud.com

INVERT
.logo

================================

pcpartpicker.com

IGNORE INLINE STYLE
.price-history-legend-color

================================

peardeck.com

INVERT
.boxy-svg
.mc-answer__check-inner
.check-svg

================================

pennylane.ai

INVERT
div[style*="xanadu-background.png"]
div[style*="xanadu-background.png"] > div
div[style*="banner.png"]
div[style*="banner.png"] > div

================================

peonaviveu.blogspot.com

CSS
body {
    background-color: var(--darkreader-neutral-background) !important;
    background-image: none !important;
}

================================

perfekcyjnawdomu.pl

INVERT
img[src*="logo"]

================================

petco.com/shop/en/petcostore

INVERT
a[class^="LogoAnchor__Container"]
button[class^="HamburgerButton"]
img.center-block.margin-top-sm
h1.pals-header

================================

petri.com

INVERT
.logo

================================

pgatour.com

CSS
.score-card tr td.birdie {
    background-color: rgb(1, 76, 181);
    background-image: initial;
}

================================

pgp.net.nz

INVERT
img[src*="DotNZ.svg"]
img[src*="InternetNZ.svg"]

================================

phoenixframework.org

CSS
.eva {
    font-family: "Eva-Icons" !important;
}

================================

phonescoop.com

INVERT
#sitelogo

CSS
div#outer.wide,
#socpage,
div#top.top-lg,
div#outer {
    background-image: none !important;
}

================================

photofeeler.com

INVERT
.navbar-brand

================================

photos.google.com

CSS
svg {
    fill: var(--darkreader-neutral-text) !important;
}
.RSjvib a:hover {
    background: var(--darkreader-bg--gm3-sys-color-secondary-container) !important;
}
.RSjvib a.uprWmb {
    background: var(--darkreader-bg--gm3-sys-color-surface-tint) !important;
}

================================

phys.nagoya-u.ac.jp

INVERT
img[src="img/top_94.gif"]

CSS
#wrap table {
    background-image: none !important;
}

================================

physics.gmu.edu

INVERT
img.math-display

================================

pianistdiscography.com

CSS
.bg_white {
    background-image: none !important;
}

================================

piazza.com

CSS
.dashboard_toolbar,
.page_feed_bucket_header {
    background: linear-gradient(to bottom, ${#c5c7cd} 0%, ${#dfe1e2} 100%) !important;
}

================================

picknsave.com

INVERT
.KrogerHeader-Logo--inner

================================

picrew.me

IGNORE INLINE STYLE
.imagemaker_colorpalette li

================================

pilot.wp.pl

INVERT
.logo
div > button > svg

================================

ping.sx

INVERT
.ring-0

CSS
#headlessui-switch-1 {
    filter: brightness(70%) !important;
}

================================

pinterest.com
*.pinterest.com

INVERT
[aria-label="Home"][style*="data:image/svg+xml"]
[style*="%23111111"][style*="data:image/svg+xml"]

================================

pipewire.org

CSS
body,
img,
video,
iframe {
    filter: none !important;
}

================================

pipiwiki.com

INVERT
.mwe-math-fallback-image-inline
.mwe-math-fallback-image-display
#logo_img

================================

pir2.forumeiros.com

INVERT
img[src*="latex"]

================================

pirateship.com

INVERT
.pdf-preview

================================

pixabay.com

INVERT
#logo

================================

pixaful.com

CSS
body {
    background-image: none !important;
}

================================

pixilart.com

CSS
.dark-mode-visible {
    display: inline-block;
}
.light-mode-visible {
    display: none;
}
.navbar-nav > .nav-item > .navbar-brand > img {
    content: url("/images/public/logo_pixilart_simple_white.png?v=1.1");
}

IGNORE IMAGE ANALYSIS
#image-art-modal

================================

pixiv.net

CSS
.jAENWx,
.iYRMgo {
    color: ${aliceblue} !important;
}

================================

pixlab.pl

INVERT
img[src*="trust_us"]

================================

pizzahut.com

INVERT
.jss44

================================

pkg.go.dev

CSS
.go-Select {
    background-position: right center;
    background-repeat: no-repeat;
}

================================

pkgs.org

CSS
.text-bg-light {
    background-color: ${rgb(248, 249, 250)} !important;
}

================================

pl.glosbe.com

INVERT
footer > div > div > a > img

================================

planet.gnome.org

CSS
div.post {
    background-image: none !important;
}

================================

planetagracza.pl

INVERT
p.site-title
#footer .site-title a

================================

planetminecraft.com

CSS
#container,
.forum_replies_container,
.forum_reply,
.contents,
.spoiler_header,
#resource-log,
.tag,
.view_more:not(:hover),
#popup,
code {
    background: var(--darkreader-neutral-background) !important;
}

================================

plannedparenthood.org

INVERT
a.top-level-nav-link::after
a.top-level-nav-link::before
a.top-level-nav-link > span::after

================================

plantuml.com

INVERT
.scale

================================

play.date
*.play.date

INVERT
.navbar-top li::before
.navbar-top li form
.panic::before
#prevButton::after
#nextButton::after
.postWrapper::after
.go_button::after

================================

play.google.com

INVERT
.bUWb7c
.WF1WQd
img[src="https://www.gstatic.com/android/market_images/web/play_prism_hlock_2x.png"]
a[href*="about/products"]

CSS
a:visited {
    color: ${black} !important;
}
div {
    color: var(--darkreader-neutral-text);
}

================================

play.google.com/apps/publish

INVERT
.IXNAUGB-u-e
.IXNAUGB-U-g img
.IXNAUGB-U-g
img[src^="data:image/png;"]
.LTMPNY-u-e

================================

play.google.com/books/listen

INVERT
a[href*="books/audiobooks"]

CSS
.chapter-item:not(.iron-selected) .chapter-title {
    color: var(--darkreader-neutral-text) !important;
}

================================

play.google.com/music

INVERT
.music-logo
a[title="Google apps"]
.song-row .rating-container

================================

play.google.com/store/paymentmethods

CSS
body {
    color: var(--darkreader-neutral-text) !important;
}

================================

playstation.com

CSS
.pills__container {
    background: var(--darkreader-neutral-background) !important;
}

================================

plotkibiznesowe.pl

INVERT
#logo

================================

plumbingforums.com

INVERT
.node-icon::before

CSS
div,
.node-icon {
    background-color: var(--darkreader-neutral-background) !important;
}
.input:focus,
.input.is-focused::placeholder {
    background: var(--darkreader-neutral-background) !important;
}

================================

plus.google.com

INVERT
a.gb_b > div
a[href*="about/products"]

================================

pmc.ncbi.nlm.nih.gov

INVERT
.pmc-header__logo a
.usa-card__img img

================================

pochta.ru

INVERT
ymaps[class$="ground-pane"]

================================

pocketbase.io

INVERT
.landing-hero

CSS
.landing-hero div.wrapper:nth-child(2),
.page-header {
    filter: inherit !important;
}
div.eye-socket {
    background-color: #fff !important;
}

================================

podcast.adobe.com

INVERT
.bWTYPJ
.cylKGQ
sp-action-button > img
.track
footer > img

CSS
sp-button.sc-eSNLA-D.joqRAB {
    background-color: ${black} !important;
}
sp-button.sc-eSNLA-D.joqRAB > span {
    color: ${white} !important;
}

================================

podium.com

INVERT
.logoWrap

================================

poeditor.com

INVERT
.chart img

================================

pogoda.interia.pl

INVERT
[id^="chart-container"]
.canvas_wrapper [class*="label"]

IGNORE IMAGE ANALYSIS
.weather-map-container.is-europe
.portugalia .weather-map-container-highlight.is-europe
.hiszpania .weather-map-container-highlight.is-europe
.francja .weather-map-container-highlight.is-europe
.irlandia .weather-map-container-highlight.is-europe
.wielka-brytania .weather-map-container-highlight.is-europe
.belgia .weather-map-container-highlight.is-europe
.luksemburg .weather-map-container-highlight.is-europe
.holandia .weather-map-container-highlight.is-europe
.niemcy .weather-map-container-highlight.is-europe
.polska .weather-map-container-highlight.is-europe
.czechy .weather-map-container-highlight.is-europe
.slowacja .weather-map-container-highlight.is-europe
.szwajcaria .weather-map-container-highlight.is-europe
.wlochy .weather-map-container-highlight.is-europe
.austria .weather-map-container-highlight.is-europe
.wegry .weather-map-container-highlight.is-europe
.slowenia .weather-map-container-highlight.is-europe
.chorwacja .weather-map-container-highlight.is-europe
.bosnia .weather-map-container-highlight.is-europe
.serbia .weather-map-container-highlight.is-europe
.albania .weather-map-container-highlight.is-europe
.macedonia .weather-map-container-highlight.is-europe
.grecja .weather-map-container-highlight.is-europe
.bulgaria .weather-map-container-highlight.is-europe
.rumunia .weather-map-container-highlight.is-europe
.moldawia .weather-map-container-highlight.is-europe
.bialorus .weather-map-container-highlight.is-europe
.ukraina .weather-map-container-highlight.is-europe
.litwa .weather-map-container-highlight.is-europe
.lotwa .weather-map-container-highlight.is-europe
.estonia .weather-map-container-highlight.is-europe
.finlandia .weather-map-container-highlight.is-europe
.norwegia .weather-map-container-highlight.is-europe
.szwecja .weather-map-container-highlight.is-europe
.islandia .weather-map-container-highlight.is-europe
.dania .weather-map-container-highlight.is-europe
.rosja .weather-map-container-highlight.is-europe
.gruzja .weather-map-container-highlight.is-europe
.turcja .weather-map-container-highlight.is-europe
.weather-map-container.is-poland
.weather-map-container-highlight.is-poland
.weather-map-container.is-world

================================

polar.com

INVERT
.logo

================================

polarion.*
polarion.*.*
polarion.*.*.*

INVERT
.polarion-dle-toolbar-Button img
.polarion-dle-toolbar-ButtonWithMenu img
.polarion-MenuButton img
.polarion-rp-column-configure-layout img

================================

poll.utm.utoronto.ca

CSS
.bg-background,
body {
    background-color: var(--darkreader-neutral-background) !important;
}

================================

polsatnews.pl

INVERT
.nav__item--rss a::before
.weather-box__arrow::after
.weather-box__arrow::before

CSS
.news--over .news__category,
.news--over .news__time,
.news--over .news__title,
.sent__title {
    filter: none !important;
}

================================

polskabiega.sport.pl

CSS
.main_wrapper {
    background-color: #181a1b !important;
}

================================

polskatimes.pl

INVERT
.componentsNavigationNavbar__logo

================================

polskiemarki.info

INVERT
a[id="powrot"] > img
img[src*="logo_fakro"]

CSS
#katalog .container {
    background-image: none !important;
}

================================

polymc.org
polymc.github.io

IGNORE INLINE STYLE
svg.home *

================================

poradnikzdrowie.pl

INVERT
.logo

================================

porkbun.com

INVERT
img[src="/images/handshake-icon.svg"]

CSS
.hsds-beacon .iNBOWp iframe[data-cy="FrameComponent"] {
    color-scheme: initial !important;
}

================================

portableapps.com

INVERT
img[alt="Download, install, and GO"]

================================

portal-portail.apps.cic.gc.ca

INVERT
footer > div > div > div > div > svg > :nth-child(2)
header > div > div > div > svg > :nth-child(3)
ircc-portal-application-status-item img.detailsIcon

================================

portal.edukacja.olsztyn.eu

INVERT
div.main
div#welcome-img
#pageheader
div#ctl00_TheFooter img
a.link-gray > p

================================

portal.qiniu.com

INVERT
.global-loading-content img

================================

portal.saltyfish.io

INVERT
.logo-img

================================

portalsamorzadowy.pl

INVERT
.p-logo
.footer-logo

================================

portswigger.net

INVERT
img[alt="Web Security Academy"]
img[alt="The Daily Swig"]

================================

positiveintelligence.com

INVERT
article.logos-grid__grid
img.footer__logo
img.homepage-hero__img
img.menu__logo

================================

postani-student.hr

CSS
body {
    background-image: none !important;
}

================================

postnauka.ru

INVERT
.m-header__logo

================================

poszukiwania.pl

INVERT
.header-logo
.footer-logo-address

================================

potplayer.daum.net

INVERT
.promotion_potplayer

================================

powerapps.com
*.powerapps.com

CSS
.ag-cell .ms-Label {
    color: var(--darkreader-text--white) !important;
}

================================

pphosted.com

CSS
#menu_items {
    background-image: none !important;
}

================================

praca.pl

INVERT
img[alt="Praca.pl"]

CSS
.app-offer__content {
    background-color: rgb(25, 26, 27) !important;
}
.szcont .f1top,
.szcont .f1template_content {
    background-blend-mode: color;
    background-color: rgba(0, 0, 0, 0.25) !important;
}
.company__img {
    padding: 0 0 !important;
}
.listing__logo,
.app-offer__logo-img,
.company__img,
.employer-profile-header .logo img,
.company-job-list .logo img,
.epc-other-employers .logo img,
.home__partner-logo {
    filter: brightness(0.75);
}

IGNORE IMAGE ANALYSIS
.szcont .f1top
.szcont .f1template_content

================================

practicum.yandex.*

INVERT
img[src$="?color=000"]
.progress-circle__shape
.burger
.lesson-progress__progress-bar
.scrollbar__control-line
input[aria-checked="true"] + .radio__control

CSS
.quiz-task {
    background-color: var(--darkreader-neutral-background) !important;
}
.icon-status-error > .shape2,
.icon-status-error > .shape3,
.icon-status-success > .shape2 {
    fill: var(--darkreader-neutral-background) !important;
}

================================

pracuj.pl
*.pracuj.pl

CSS
[alt="background"] {
    display: none !important;
}
[data-test="image-background"] {
    display: none !important;
}
[data-test="section-positioned-offers"] {
    background: ${White} !important;
}

================================

prairielearn.com

INVERT
.graph text

CSS
.question-container img {
    background: var(--darkreader-neutral-text) !important;
}
div[class="pl-code mb-3 "] {
    --pl-code-background-color: var(--darkreader-neutral-background) !important;
}

================================

prajwalkoirala.com

INVERT
svg

================================

preply.com

CSS
.styles_block__BmN2c {
    background-color: ${rgb(232, 230, 227)};
}

================================

pressgazette.co.uk

INVERT
.site-logo

================================

pressurewasherdb.com

CSS
.noUi-handle,
.noUi-target {
    border-color: #8c8273 !important;
}

================================

primatelabs.com

INVERT
.logo

================================

primewire-connects.de

CSS
.tweak-overlay-parallax-enabled .Parallax-item {
    z-index: 0 !important;
}

================================

printables.com

INVERT
.navbar-brand .printables-text

CSS
market-filter-item {
    --line-color: var(--darkreader-border--line-color) !important;
}

================================

privat24.ua

CSS
div[class*=qrContainer] > div > div[class*=qr_] {
    background-color: white;
}

================================

pro-run.pl

INVERT
.td-main-logo

================================

processon.com

INVERT
#view_container canvas

================================

procyclingstats.com

IGNORE IMAGE ANALYSIS
.flag
.flag.w32
.flag.c16

================================

producthunt.com

INVERT
[class="icon_f5f81"]

================================

profile.gigabyte.com

CSS
body {
    background-image: var(--darkreader-neutral-background) !important;
}

================================

profiler.firefox.com

INVERT
.chartCanvas

================================

projectstream.it

CSS
body {
    background: none !important;
}

================================

pronote.toutatice.fr

INVERT
.ObjetGrille
.Cours
.Insecable
.Calendrier_Jour_Selection

CSS
body,
.ie-chips.tag-style {
    background: linear-gradient(90deg, #282c2d 0, #282C2D calc(100% - 0.8rem), transparent calc(100% - 0.8rem), transparent 100%);
}

================================

pronto.io

CSS
input.btn-new-group.pointer {
    background-color: var(--darkreader-neutral-background) !important;
}

================================

prospectmagazine.co.uk

INVERT
.header__logo

================================

prostovpn.org

CSS
body {
    background: none !important;
}

================================

protect-eu.ismartlife.me/login

CSS
div[class^=login_login] {
    background-image: none !important;
}
div[class^=login_qc-code-content] {
    background-color: white !important;
}

================================

protocol.com

INVERT
img.logo-icon.open
div#topbar-menu-toggle > svg.icon

================================

proton.me
mail.proton.me

INVERT
img[src$="hero-2x.png"]
iframe[data-testid="rooster-iframe"]

================================

protonvpn.com

INVERT
.navbar-brand
.protonmail-link
#page_home .parallax
#page_home .parallax > *

================================

provantage.com

CSS
body,
body.HOME {
    background-color: var(--darkreader-neutral-background) !important;
    background-image: none !important;
}

================================

proxmox.com

INVERT
#logo
.uix_logo

================================

proxyium.com

CSS
[data-darkreader-inline-bgimage] {
    background-image: none !important;
}

================================

proxyman.com

INVERT
a.ml-8[href="/download"]
div.text-center.w-full.mt-12 > div > a > span
button[class~="px-2.5"][class~="bg-gray-900"]
div.px-2.py-1
div.text-center.mt-14
button[aria-label="Previous Testimonials Page"]
button[aria-label="Next Testimonials Page"]
img[src="/assets/images/wreath_right.svg"]
img[src="/assets/images/wreath_left.svg"]
.px-8.py-3.glowingDownloadBtn
img[alt="ChowNow, a Company that uses Proxyman"]
img[alt="Cerid, a Company that uses Proxyman"]
img[alt="Shape, a Company that uses Proxyman"]
img[alt="Yelp, a Company that uses Proxyman"]
img[alt="Cisco, a Company that uses Proxyman"]
img[alt="Shopify, a Company that uses Proxyman"]
img[alt="Aws, a Company that uses Proxyman"]
img[alt="Deloitte, a Company that uses Proxyman"]
img[alt="Atlassian, a Company that uses Proxyman"]
img[alt="Futirice, a Company that uses Proxyman"]
img[alt="Atlantic, a Company that uses Proxyman"]
img[alt="Bytedance, a Company that uses Proxyman"]
img[alt="Paypal, a Company that uses Proxyman"]
img[src*="proxyman_dashboard_v6_1.webp"]

================================

psemu.pl

CSS
.menu-item {
    text-shadow: rgb(40, 43, 54) 0px 1px 0px !important;
}

================================

psprices.com

INVERT
.store-logo
.highcharts-label text
.game--description::after

CSS
body {
    background-color: var(--darkreader-neutral-background) !important;
}

================================

psychonautwiki.org

INVERT
#mw-panel > a > svg
.mw-headline > a > svg
a[href="http://www.emcdda.europa.eu/about"] > svg
img[alt="Tasks.svg"]
img[alt="Star-o.svg"]
img[alt="Pencil.svg"]
#InfoTable > tbody > tr > .Image > div > div > .image
.dosechart

CSS
.dosechart,
.thumbimage,
.mwe-popups-discreet > svg {
    background-color: ${black} !important;
}

================================

publica.fraunhofer.de

INVERT
img[src="/pub09img/logo-fraunhofer.gif"]

================================

publicwww.com

CSS
body {
    background-image: none !important;
}

================================

pulumi.com

CSS
:host {
    --neutral-fill-stealth-rest: var(--darkreader-neutral-background) !important;
}

================================

pureinfotech.com

INVERT
.pureinfotech-logo

CSS
.article-type-standard-css .entry-content::before {
    color: ${gray} !important;
}

================================

purerave.com

CSS
:root {
    --darkreader-border--border: 1px solid rgba(0, 90, 155, 1) !important;
}
div.form-buttons textarea {
    background-color: var(--darkreader-neutral-background) !important;
    border-color: #005a9b !important;
}
textarea {
    background-color: var(--darkreader-neutral-background) !important;
}

================================

purevpn.com

CSS
.inner_banner {
    background-image: none !important;
}

================================

pushsquare.com

CSS
.page {
    background-image: none !important;
}

================================

pycheung.com/checker/

IGNORE INLINE STYLE
body

IGNORE IMAGE ANALYSIS
body

================================

pyszne.pl
lieferando.*
justeat.*
just-eat.*
takeaway.com
thuisbezorgd.nl

INVERT
.gm-style

CSS
.cover img,
.logowrapper,
.orderoverview__restaurant-image-container-inner,
div[data-qa="avatar"] {
    background-blend-mode: color;
    background-color: rgba(255, 255, 255, 0.5) !important;
}

IGNORE INLINE STYLE
svg > circle
svg > text > tspan

================================

pythonanywhere.com

INVERT
#id_logo
img[src^="/static/glyphicons/"]

================================

pytorch.org

INVERT
#site-logo
.header-holder:not(.homepage-header) > div.container > div.header-container > .header-logo

================================

pz.gov.pl

CSS
.banner-text {
    color: var(--darkreader-neutral-background) !important;
}

================================

q.utoronto.ca

INVERT
.ic-sidebar-logo__image
.instructure_file_link_holder > .file_download_btn
a.external > span > img:first-child
.equation_image
span[data-testid="mathml-preview-element"] svg

CSS
:root {
    --darkreader-bg--ic-brand-global-nav-bgd: var(--ic-brand-global-nav-bgd) !important;
    --darkreader-bg--ic-brand-global-nav-logo-bgd: var(--ic-brand-global-nav-logo-bgd) !important;
    --darkreader-border--ic-brand-global-nav-avatar-border: var(--ic-brand-global-nav-avatar-border) !important;
    --ic-brand-global-nav-ic-icon-svg-fill--active: var(--darkreader-text--ic-link-color) !important;
}
.ic-app-header__menu-list-link:hover,
.ic-app-header__menu-list-link:focus {
    background-color: ${rgba(0, 0, 0, 0.2)} !important;
}
.ic-DashboardCard {
    box-shadow: ${rgba(0, 0, 0, 0.3)} 0px 1px 5px !important;
}
textarea[data-testid="advanced-editor"] {
    background-color: var(--darkreader-neutral-background) !important;
    color: var(--darkreader-neutral-text) !important;
}
math-field,
fieldset span {
    color: var(--darkreader-neutral-text) !important;
}

================================

qcc.com

INVERT
.app-login-insert
.logo
.pay-insert

================================

quantrimang.com

CSS
.taxonomyList .navigation a {
    color: var(--darkreader-neutral-text) !important;
}
.taxonomyList .navigation a:hover {
    color: ${orange} !important;
}

================================

qubes-os.org

INVERT
[src$="xen-logo.svg"]
[src$="whonix-tor.svg"]

================================

quickbase.com

CSS
td.cell,
td.label {
    border-color: rgb(24, 26, 27) !important;
}

================================

quirksmode.org

INVERT
.logoPPK

CSS
body {
    background-image: none !important;
}

================================

quizlet.com

CSS
.UIKeyboardHint {
    background-color: transparent !important;
}

IGNORE INLINE STYLE
.FeedbackHeading-emoji > svg *

================================

quora.com
*.quora.com

CSS
.logo_fill {
    fill: rgb(219, 87, 83) !important;
}
body {
    background-color: var(--darkreader-neutral-background) !important;
}
div.q-box.qu-bg--white {
    background-color: #181a1b !important;
    background-image: none !important;
}
.rf162uw:hover {
    color: rgba( 128, 128, 128, 0.15) !important;
}

IGNORE INLINE STYLE
#upvote
#downvote

================================

qwant.com

INVERT
.background-home__logo
.home__logo__container .home__logo
canvas.mapboxgl-canvas

================================

rachel53461.wordpress.com

CSS
#grad {
    background-image: none !important;
}

================================

racketboy.com

CSS
#rb-split,
#rb-split > div {
    background-image: none !important;
}

================================

radar-opadow.pl

INVERT
#chase-map
.ro_tooltip

================================

radareu.cz

INVERT
#radarMap .leaflet-map-pane

================================

radeonramdisk.com

INVERT
#logo

================================

radio17.pl

INVERT
.main-title

================================

radiokolor.pl

INVERT
.nav-brand
.buttons-1
a.logo-1

CSS
.content-box-1 {
    background-image: none !important;
}

================================

railpassengers.org

INVERT
.navbar__list-search
.navbar__logo
.navbar__mobile-icons

================================

railwaygazette.com

INVERT
.mastheadLogo

================================

rain.thecomicseries.com

CSS
body {
    background-color: var(--darkreader-neutral-background) !important;
    background-image: none !important;
    margin: 0px !important;
    padding: 8px !important;
}
#comicimage {
    background-color: #ffffff !important;
}

================================

rakuten.com
*.rakuten.com

INVERT
.chakra-image

CSS
span[class*="Checkbox_checkmark"]::after {
    border-color: rgb(207, 203, 201) !important;
}

================================

rapidtables.com

IGNORE INLINE STYLE
td[style^="background:"]

================================

raspberrypi.com

INVERT
.__rptl-header-logo path[fill="#000"]

CSS
body {
    color: var(--darkreader-neutral-text) !important;
}

================================

raspberrypi.org

INVERT
.site-header__home-link

IGNORE IMAGE ANALYSIS
.c-at-home__container

================================

rateyourmusic.com

IGNORE IMAGE ANALYSIS
*

================================

rationalwiki.org

INVERT
.mw-wiki-logo

================================

rct-portal.com

INVERT
.flow__battery::before
.flow__panel::before
.flow__grid::before
.flow-item__line::after
.flow-item__line::before

================================

read.amazon.*
read.amazon.*.*
lire.amazon.*

INVERT
.header_bar_icon:not(#kindleReader_button_close)
.header_bar_button
#kindleReader_content
.kg-full-page-img
.side-menu-close
.fixed-book-title
ion-menu
ion-header
ion-title

CSS
.kr-renderer-container,
.kr-renderer-container-fullpage {
    z-index: 0 !important;
}

================================

readme.io

CSS
.rm-PlaygroundRequest,
.CodeTabs-toolbar {
    background-color: var(--darkreader-neutral-background) !important;
}

================================

readpaper.com/pdf-annotate/note

INVERT
.page

================================

readthedocs.io

CSS
.toc-drawer,
.sig,
code.literal,
.sidebar-search-container,
.sidebar-tree .current > .reference {
    background-color: var(--darkreader-neutral-background) !important;
}

================================

real-debrid.com

CSS
#wrapper_global {
    background-image: none !important;
}
#header_img_right {
    background-image: none !important;
}

================================

realmadridfin.net

CSS
body,
.botslice,
.botslice span,
.button_submit,
.catbg,
.cat_bar,
#content_section,
.frame,
#footer_section,
#header,
.lowerframe,
.lowerframe span,
#shoutbox_b,
#shoutbox_color,
#shoutbox_face,
#shoutbox_i,
#shoutbox_nosound,
#shoutbox_u,
#shoutbox_u + img,
.titlebg,
.title_barIC,
.topslice,
.topslice span,
.upperframe,
.upperframe span {
    background-image: none !important;
}
#shoutbox_message {
    background-color: none !important;
}

================================

realmeye.com

INVERT
img[src*="latex"]

IGNORE IMAGE ANALYSIS
.character

================================

realmicentral.com

INVERT
img[itemprop="logo"]
div.fly-but-wrap.left.relative > span

================================

redbubble.com

INVERT
[data-testid="ds-wordmark"]

================================

redcross.*
redcross.*.*

CSS
.lecture-attachment img.is-loaded {
    filter: brightness(50%) sepia(40%) !important;
}

================================

reddit.com
new.reddit.com

INVERT
video ~ div [style^="height"]
.snoo-cls-1
.snoo-cls-2
.snoo-cls-3
.snoo-cls-8

CSS
[style^="--background"] {
    --background: ${#FFFFFF} !important;
}
[style^="--canvas"] {
    --canvas: ${#DAE0E6} !important;
}
[style^="--pseudo-before-background"] {
    --pseudo-before-background: ${#DAE0E6} !important;
}
[style^="--comments-overlay-background"] {
    --comments-overlay-background: ${#DAE0E6} !important;
}
[style^="--commentswrapper-gradient-color"] {
    --comments-overlay-background: ${#DAE0E6} !important;
}
[style^="--fakelightbox-overlay-background"] {
    --fakelightbox-overlay-background: ${#DAE0E6} !important;
}
.button:hover {
    --button-color-background: var(--darkreader-bg--color-neutral-background-hover) !important;
}
.hover\:text-secondary:hover {
    color: var(--darkreader-neutral-text) !important;
}
.hover\:bg-secondary-background-hover:hover {
    background-color: var(--darkreader-bg--color-neutral-background-hover) !important;
}
.hover\:border-secondary-background-hover:hover {
    border-color: var(--darkreader-border--color-neutral-border-medium) !important;
}
.before\:border-tone-4::before {
    border-color: var(--color-tone-4) !important;
}
.button-shell {
    color: var(--darkreader-neutral-text) !important;
}
.button-plain {
    --button-color-text-default: var(--darkreader-neutral-text) !important;
}
.button-secondary {
    --button-color-background-default: var(--darkreader-bg--color-neutral-background) !important;
    --button-color-text-default: var(--darkreader-text--color-neutral-content-weak) !important;
}
.internalBackButton {
    background-image: linear-gradient(to right,var(--plain-background) 0,var(--darkreader-bg--color-secondary-background) 30%) !important;
}
.internalForwardButton {
    background-image: linear-gradient(to right,var(--plain-background) 0,var(--darkreader-bg--color-secondary-background) 30%) !important;
}
.label-container {
    background: var(--darkreader-bg--color-neutral-background) !important;
}
.label-container:hover {
    background: var(--darkreader-bg--color-neutral-background-hover) !important;
}
.md p>a[href="#s"]::after,
a[href="#s"]::after {
    color: #000;
}
.text-neutral-content-strong {
    color: var(--darkreader-text--color-neutral-content-strong) !important;
}
header a[aria-label="Home"] svg:last-child g,
header > div > div + div a[href] *,
header > div > div + div button[aria-label] * {
    fill: var(--darkreader-neutral-text) !important;
}
#comment-tree {
    background-color: var(--darkreader-bg--color-neutral-background) !important;
}
#COIN_PURCHASE_DROPDOWN_ID > div {
    background: linear-gradient(180deg,hsla(0,0%,100%,.1) 45.96%,hsla(0,0%,100%,.57) 46%,hsla(0,0%,100%,0) 130%),${gold} !important;
}
#COIN_PURCHASE_DROPDOWN_ID > div > span {
    color: ${white} !important;
}
#search-input-chip {
    background: var(--darkreader-bg--color-secondary-background-selected) !important;
}
.md-spoiler-text:not([data-revealed])::selection {
    background-color: var(--darkreader-bg--newCommunityTheme-metaText) !important;
    color: transparent !important;
}
button[slot="forward-button"] {
    background-color: var(--darkreader-border--color-neutral) !important;
}
button[slot="back-button"] {
    background-color: var(--darkreader-border--color-neutral) !important;
}
div[slot="tabs"] {
    background: var(--darkreader-bg--color-neutral-background) !important;
}
div[role="menu"][style^="position: fixed"] button button[role="switch"][aria-checked="false"] {
    background-color: ${gray} !important;
}
div[role="menu"][style^="position: fixed"] button button[role="switch"] > div {
    background-color: ${black} !important;
}
object[data="about:blank"] {
    display: none !important;
}
span[class="inline-block mr-[calc(var(--size-button-sm-h)-var(--rem10)-var(--button-border-width-default))] overflow-hidden text-ellipsis"] {
    color: var(--darkreader-text--color-neutral-content) !important;
}
shreddit-comment-tree {
    background-color: var(--darkreader-bg--shreddit-content-background) !important;
}
.self-start {
    background-color: var(--darkreader-bg--shreddit-content-background) !important;
}
#comment-fold-button {
    background-color: var(--darkreader-bg--shreddit-content-background) !important;
}
button.w-lg {
    background-color: var(--darkreader-bg--shreddit-content-background) !important;
}
.bg-neutral-background {
    background-color: var(--darkreader-bg--shreddit-content-background) !important;
}
.text-secondary {
    color: var(--darkreader-text--color-secondary) !important;
}
faceplate-tracker > li > a:hover {
    background-color: var(--darkreader-bg--color-neutral-background-hover) !important;
}
faceplate-tracker > li > div:hover {
    background-color: var(--darkreader-bg--color-neutral-background-hover) !important;
}
div#RECENT > li > a:hover {
    background-color: var(--darkreader-bg--color-neutral-background-hover) !important;
}
span.input-container.stateful-input input {
    color: var(--darkreader-text--color-tone-1) !important;
}
.reddit-search-bar {
    background-color: var(--darkreader-bg--color-neutral-background) !important;
}
.reddit-search-bar .text-neutral-content {
    color: var(--darkreader-text--color-tone-1) !important;
}
faceplate-tracker > li[rpl-selected] > a {
    background-color: var(--darkreader-bg--color-tone-3) !important;
}
faceplate-menu {
    background-color: var(--darkreader-bg--color-neutral-background-strong) !important;
}
faceplate-tracker > button[rpl-selected] {
    background-color: var(--darkreader-bg--color-neutral-background-hover) !important;
}
faceplate-tracker a[data-testid]:hover {
    background-color: unset !important;
}
faceplate-tracker[noun="trending"] div:hover {
    background-color: unset !important;
}
faceplate-hovercard > div > div > div {
    background-color: var(--darkreader-bg--color-neutral-background) !important;
}
faceplate-hovercard > div > div > div:hover {
    background-color: var(--darkreader-bg--color-neutral-background) !important;
}
#faceplate-tooltip {
    background-color: var(--darkreader-bg--color-neutral-background) !important;
}
faceplate-hovercard p {
    color: var(--darkreader-text--color-neutral-content-strong) !important;
}
.text-secondary-weak {
    color: var(--darkreader-text--color-secondary-weak) !important;
}
button.button-plain:hover {
    color: var(--button-color-text-default) !important;
}
faceplate-menu > li > div {
    background-color: var(--darkreader-bg--color-neutral-background-hover) !important;
}
.text-neutral-content-weak {
    color: var(--darkreader-text--color-neutral-content-weak);
}
:host > #content {
    background-color: var(--darkreader-neutral-background) !important;
}
.bg-neutral-background-weak {
    background: var(--darkreader-neutral-background) !important;
}

================================

reddit.zendesk.com

INVERT
header > div.logo > a > img
img.hero-inner-image

================================

redditstatus.com

INVERT
.logo-container

================================

redgamingtech.com

CSS
body {
    background-image: none !important;
}

================================

redhat.com
*.redhat.com

CSS
:root {
    --pf-c-popover__arrow--BackgroundColor: ${white} !important;
    --pf-c-popover__content--BackgroundColor: ${white} !important;
    --pf-c-popover__content--Color: ${black} !important;
    --rh-color-surface-lighter: ${#f2f2f2} !important;
}
p,
li {
    color: ${black} !important;
}
.PFElement,
[part="content"] {
    background-color: ${white} !important;
}
#container {
    background-color: ${#f2f2f2} !important;
}
#close-button svg path {
    fill: var(--darkreader-neutral-text) !important;
}

IGNORE INLINE STYLE
.redhat-logo *

================================

redis.io

CSS
.bg-gradient-to-bl {
    background-image: none !important;
}

================================

redpenreviews.org

CSS
header a {
    color: var(--darkreader-neutral-text) !important;
}

================================

reebok.*

CSS
div {
    color: var(--darkreader-neutral-text) !important;
}

================================

refactoring.guru

CSS
.recipe {
    background-color: var(--darkreader-neutral-background) !important;
}

================================

referentiemateriaalvo.noordhoff.nl

CSS
body {
    background-image: none !important;
}

================================

regex101.com

INVERT
canvas

================================

registry.terraform.io

CSS
.input {
    border-color: var(--darkreader-neutral-text) !important;
}
.button,
.menu-list a,
a.dropdown-item {
    background-color: var(--darkreader-neutral-background) !important;
}

================================

reheader.glitch.me

INVERT
[src=$"GitHub-Mark.png"]
[src=*"header-image-readme-gen.gif]
[src=*"Screen%20Shot%202020-07-17%20at%205.19.18%20PM.png"]

CSS
#add-to-github {
    background-color: #96943f !important;
}
#upload-github {
    border: 1px solid #dddddd;
}

================================

rei.com

INVERT
.logo__img

================================

relay.firefox.com

INVERT
img.c-landing-hero-brands
img.c-brand-title
.fx-bento-app-link.fx-bento-link.fx-mobile > span::before
.fx-bento-app-link.fx-bento-link.fx-vpn > span::before
div.glocal-site-options > a > img
div.glocal-site-options > form > button::before

================================

relive.cc

INVERT
img[src*="logo-relive"]

IGNORE IMAGE ANALYSIS
.email-button i

================================

rememberthemilk.com

CSS
div[contenteditable="true"] {
    border: transparent !important;
}

================================

render.com

INVERT
.rm-section.rm-hero
.rm-section.rm-hero > *:not(.rm-back-bottom)
.rm-back-top
.rm-back-large

================================

render.githubusercontent.com/view/ipynb

INVERT
img.math

================================

replit.com

CSS
.monaco-editor .cursor {
    background-color: ${#000};
}

================================

repubblica.it

INVERT
.page-header__logo

================================

research.cloudflare.com

INVERT
img[src$="logo.svg"]

================================

researchgate.net

CSS
div.pdf-viewer-page div.pc {
    background: white !important;
    color: black !important;
}

================================

resetera.com

CSS
.bbc-spoiler:not(:hover):not(:active),
.bbc-spoiler:not(:hover):not(:active) * {
    background-color: ${black} !important;
    color: ${black} !important;
}

================================

resmigazete.gov.tr

CSS
img[src="/assets/img/arma.png"] {
    filter: hue-rotate(180deg) invert(1) brightness(2);
}

================================

respekt.cz

INVERT
.sitelogo-link

================================

restaurantji.com

INVERT
.logo_sticky

================================

restoreprivacy.com

CSS
body {
    background-color: var(--darkreader-bg--color-body) !important;
}

================================

retracmirrors.com

CSS
body,
#app > div {
    background-image: none !important;
}

================================

reuters.com

INVERT
path[d^="M121.865 50.29c0"]

================================

revisioncentregcse.blogspot.com

CSS
body {
    background-color: var(--darkreader-neutral-background) !important;
    background-image: none !important;
}

================================

revolut.com

CSS
[class*="Text-rui"] {
    text-shadow: rgb(40, 43, 54) 1px 1px 0px !important;
}

================================

revolver.news

INVERT
h2.title
h3.category

================================

rfc-editor.org

CSS
svg.diagram text {
    fill: var(--darkreader-neutral-text) !important;
}

================================

rfi.fr

INVERT
.o-header__site-nav-link

================================

rg-adguard.net

INVERT
img[src*="info"]
img[src*="like"]
img[src*="donate"]
img[src*="faq"]

CSS
body,
.tftable th {
    background: none !important;
}

================================

richie-bendall.ml

CSS
.content--card {
    background-color: #303030;
}
body {
    background-color: #5c6bc0;
}
.app--bar,
.drawer--content :not(.mdc-list--non-interactive) > :not(.mdc-list-item--disabled) .mdc-list-item--activated::after,
:not(.mdc-list--non-interactive) > :not(.mdc-list-item--disabled) .mdc-list-item--activated::before {
    background-color: #3f51b5;
}
.btc-dialog .mdc-button {
    color: #3f51b5;
}
.btc-dialog svg {
    fill: white;
}

================================

richiebendallstatus.ml

CSS
#page-container {
    background-image: none;
}
.success-bg {
    background-color: #80BA27;
}
.warning-bg {
    background-color: #f7921e;
}
.success {
    color: #80BA27;
}
.warning {
    color: #f7921e;
}
.danger-bg {
    background-color: #ff0000;
}
.paused-bg,
.info-bg,
.black-bg {
    background-color: #17252e;
}

================================

rimworldwiki.com

INVERT
.darkmode-invert
.mw-wiki-logo

CSS
html,
html img {
    filter: none;
}
body {
    background: var(--darkreader-neutral-background);
}

================================

ring.com

INVERT
span[alt="Ring Logo"] svg

IGNORE INLINE STYLE
span[alt="Ring Logo"] svg *

================================

riptutorial.com

CSS
.whole-container {
    background-image: none !important;
}

================================

rmf24.pl

INVERT
.mainContent3-left iframe
.belkaNew

CSS
#twojezdrowieCont .page3,
#regionySection {
    background-image: none !important;
}

================================

rnz.de

INVERT
.nfy-header img

================================

roadmap.sh

CSS
svg .done rect {
    fill: var(--darkreader-neutral-background) !important;
}

================================

roblox.com

CSS
.checkbox input[type=checkbox]:checked + label::before {
    background-color: var(--darkreader-neutral-text) !important;
}

================================

rocksbox.com

INVERT
.nav_logo

================================

rockylinux.org

INVERT
img[alt="Rocky Linux"]

================================

rog.asus.com

IGNORE IMAGE ANALYSIS
.rog-header .nav-menu .nav-bar

================================

roland.com

CSS
body {
    background: none !important;
}

================================

rollenspiel.monster

CSS
body {
    height: 100% !important;
}

================================

ros.org

CSS
.bg-ros-dots-grid {
    background-image: none !important;
}

================================

roscidus.com

CSS
span.caption-wrapper img {
    background-color: white !important;
}

================================

rosepassion.com

INVERT
.imgmap
.famille-content .image
.les_schemas img
.rpimage .follow-scroll

CSS
#selectionner_voiture .bloc .image {
    mix-blend-mode: normal !important;
}

================================

roskomsvoboda.org

INVERT
img[src="/static/core/images/logo.svg"]

================================

rostov.tele2.ru

INVERT
.header-navbar-logo

================================

rottentomatoes.com

IGNORE IMAGE ANALYSIS
.icon__fresh
.fresh
.icon

================================

royalbank.com

CSS
.rbc-select-input {
    background-color: var(--darkreader-neutral-background) !important;
}

================================

rozetka.com.ua

INVERT
div.cabinet-navigation__icon > svg
span.cabinet-navigation__icon > svg

================================

rp.pl

INVERT
a[href="/"]
.burger--menu span
.icon-logo::before
.footer--logo
.footer--copyright--content div

================================

rpcs3.net

CSS
p,
.compat-types,
.compat-hdr-left,
.compat-status-container {
    color: var(--darkreader-neutral-text) !important;
}

================================

rpm.org

IGNORE IMAGE ANALYSIS
body

================================

rpmfusion.org
*.rpmfusion.org

CSS
body {
    background: none !important;
}
#loginform {
    opacity: 1 !important;
}
#loginform fieldset {
    background-image: none !important;
}
#header {
    background-blend-mode: multiply !important;
}

================================

rpo.gov.pl

INVERT
.view-content .field-content > img
#etykieta_szukaj a

IGNORE IMAGE ANALYSIS
#bip_kontener

================================

rt.ru

INVERT
#logo_text

================================

rte.ie

INVERT
.masthead .nav-btn.menu

CSS
.masthead .weather-widget .icon {
    filter: none !important;
}
.theoplayer-skin .theo-control-bar-shadow {
    background-image: linear-gradient(transparent var(--darkreader-neutral-background)) !important;
}

================================

rtlnieuws.nl

CSS
section {
    background-color: var(--darkreader-neutral-background) !important;
}

================================

rubenfixit.com

CSS
.shape-top-left::after,
.nav-btn::after {
    border-color: transparent transparent transparent var(--darkreader-neutral-background) !important;
}
.shape-top-right::after,
.nav-btn::before {
    border-color: transparent transparent var(--darkreader-neutral-background) transparent !important;
}
.shape-bottom-left::after {
    border-color: var(--darkreader-neutral-background) transparent transparent transparent !important;
}
.shape-bottom-right::after {
    border-color: transparent var(--darkreader-neutral-background) transparent transparent !important;
}
#blog-isotope-masonry article,
.shape-top-left,
.shape-top-right,
.shape-bottom-left,
.shape-bottom-right {
    background-color: var(--darkreader-neutral-background) !important;
}

================================

rubjo.github.io

CSS
select {
    background-color: var(--darkreader-neutral-background) !important;
}

================================

rudeiczarne.pl

INVERT
#logo
#footer-logo

================================

rumratings.com

CSS
body {
    background-image: none !important;
}

================================

runkit.com

INVERT
.CodeMirror div.CodeMirror-cursor

================================

runtothefinish.com

CSS
:root {
    --body-background-color: var(--darkreader-neutral-background) !important;
}

================================

ryanair.com

CSS
.calendar-body__cell--disabled {
    color: gray !important;
}

IGNORE INLINE STYLE
.common-header__logo-icon svg *

================================

rynek-kolejowy.pl

INVERT
.logoTK
.partnerNaglowka
.pasekbocznynaglowek span
.portalLogo
.tagLogo
.zawartoscPartner
img[alt="współpraca"]
img[class="wspolpraca"]
img[src*="img/firma"]
img[src*="katalogkolejowy"]

================================

rynekzdrowia.pl

INVERT
img[src*="rynekzdrowia.svg"]
img[alt*="partner"]
.search
.copyright > img

================================

rytmy.pl

INVERT
.logo-rytmy-a

================================

s.weibo.com

INVERT
.CopyRight_aria_13ebq
.ProfileHeader_statusCounterLayer_13mzC img
.hot-band-header-refresh img
#woo_svg_nav_logo > g > path:nth-child(5)

CSS
#searchapps > div > div[role=navigation] > div.woo-panel-main {
    --darkreader-bg--weibo-top-nav-panel-bgColor: var(--darkreader-bg--w-color-light);
}
:root {
    --darkreader-bg--frame-background: var(--darkreader-bg--w-color-light);
    --darkreader-bg--w-b-flat-default-bg: #FFFFFF11;
    --darkreader-bg--w-color-gray-6: #FFFFFF11;
    --darkreader-bg--w-retweet-background: #FFFFFF08;
    --darkreader-border--w-card-border: #FFFFFF1E;
    --darkreader-border--w-dividing-line: #FFFFFF11;
    --darkreader-text--weibo-top-nav-line: #FFFFFF19;
}
.woo-divider-x {
    border-bottom-color: #FFFFFF11;
}
.m-main-nav,
.card-wrap {
    background-color: #FFFFFF08;
    border-color: #FFFFFF11;
}
.hot-band-container {
    background-color: #FFFFFF08 !important;
    border-color: #FFFFFF11 !important;
}
.Nav_panel_YI3-j {
    border-bottom-color: #FFFFFF1E !important;
}
.hot-band-tabs-item {
    background-color: #FFFFFF11 !important;
}
.hot-band-footer-link {
    background-color: #FFFFFF11 !important;
    border-radius: 8px !important;
}
.wbpro-side-opt {
    background-color: #FFFFFF11 !important;
    border-radius: 8px;
    color: rgb(143, 143, 143);
}
.m-adv-search dd [type="text"] {
    background-color: #FFFFFF11 !important;
    border: none;
}
.m-adv-search dd .txt {
    background-color: #FFFFFF18 !important;
    border: solid,1px,#FFFFFF11 !important;
}
.m-adv-search dd select {
    background-color: #FFFFFF11;
    border: none;
}
.card-feed .media {
    background: #FFFFFF08 !important;
}
.vote-item_item_2egBf {
    background-color: #FFFFFF08;
}
.card-together .card-more-a a {
    background: none;
}
.wbp-video .wbpv-load-progress div {
    background: #FFFFFF11 !important;
}
.wbp-video .wbpv-play-progress {
    background-color: #FFFFFF88;
}
.woo-panel-main {
    background-color: #FFFFFF08;
    border: solid,1px,#FFFFFF11 !important;
}

================================

sadanduseless.com

INVERT
.logo1

================================

safetysign.com

CSS
div[id*="RollUp-Aluminum-smalltext-preview"],
div[id*="RollUp-Aluminum-largetext-preview"],
#_HillGradeCustom-hillgradetext-preview {
    color: rgb(0, 0, 0) !important;
}

================================

safeweb.norton.com

INVERT
.logo img

================================

saladelcembalo.org

INVERT
#PageDiv td

CSS
html,
body,
input,
textarea,
select,
button {
    background-color: transparent !important;
    color: var(--darkreader-neutral-text) !important;
}

================================

salon24.pl

INVERT
.header-main__logo

================================

samcodes.co.uk

INVERT
.logo

================================

samsung.*

INVERT
.icon
.gnb__logo

CSS
.feature-full-bleed-text img {
    filter: brightness(50%) sepia(40%) !important;
}
.feature-full-bleed-text__content {
    z-index: 1 !important;
}

================================

sanomapro.fi

INVERT
.equation

================================

santander.pl

INVERT
img[src*="/santander/footer/"]
.topVisual__text span
.topVisual__content.topVisual__content--nobutton

================================

savannah.gnu.org

CSS
.boxtitle {
    background-image: none !important;
}

================================

sba.gov

INVERT
.usa-header--extended .site-logo

================================

sbb.ch
shop.sbb.ch

CSS
#Von0,
#Nach1,
#From0,
#To1,
#De0,
#À1,
#Da0,
#A1 {
    background: none !important;
}
.sbb-navigation__container:before {
    background-color: var(--sbb-color-white-alpha-70) !important;
}
#sbb-logo__signet,
.mod_header_logo_content > * > path:not(path[fill='#EC0000']) {
    fill: white !important;
}
.sbb-clock .face circle {
    fill: ${#dcdad7} !important;
}
.sbb-clock .face,
.sbb-clock .sbb-clock__hand-hours,
.sbb-clock .sbb-clock__hand-minutes {
    fill: ${black} !important;
}
.sbb-button,
.sbb-teaser-hero > * > * > * {
    color: ${black} !important;
}
:root {
    --sbb-color-aluminium-default: ${#d2d2d2} !important;
    --sbb-color-anthracite-default: ${#5a5a5a} !important;
    --sbb-color-autumn-default: ${#e84e10} !important;
    --sbb-color-black-alpha-0: ${transparent} !important;
    --sbb-color-black-alpha-10: ${rgba(0,0,0,.1)} !important;
    --sbb-color-black-alpha-15: ${rgba(0,0,0,.15)} !important;
    --sbb-color-black-alpha-20: ${rgba(0,0,0,.2)} !important;
    --sbb-color-black-alpha-30: ${rgba(0,0,0,.3)} !important;
    --sbb-color-black-alpha-40: ${rgba(0,0,0,.4)} !important;
    --sbb-color-black-alpha-50: ${rgba(0,0,0,.5)} !important;
    --sbb-color-black-alpha-60: ${rgba(0,0,0,.6)} !important;
    --sbb-color-black-alpha-70: ${rgba(0,0,0,.7)} !important;
    --sbb-color-black-default: ${#000} !important;
    --sbb-color-brown-default: ${#b76000} !important;
    --sbb-color-cement-alpha-0: ${hsla(0,0%,74%,0)} !important;
    --sbb-color-cement-alpha-20: ${hsla(0,0%,74%,.2)} !important;
    --sbb-color-cement-default: ${#bdbdbd} !important;
    --sbb-color-charcoal-default: ${#212121} !important;
    --sbb-color-cloud-default: ${#e5e5e5} !important;
    --sbb-color-granite-default: ${#686868} !important;
    --sbb-color-graphite-default: ${#b7b7b7} !important;
    --sbb-color-green-default: ${#008a36} !important;
    --sbb-color-iron-default: ${#444} !important;
    --sbb-color-lemon-default: ${#ffde15} !important;
    --sbb-color-metal-alpha-0: ${hsla(0,0%,46%,0)} !important;
    --sbb-color-metal-alpha-20: ${hsla(0,0%,46%,.2)} !important;
    --sbb-color-metal-default: ${#767676} !important;
    --sbb-color-midnight-default: ${#151515} !important;
    --sbb-color-milk-default: ${#f6f6f6} !important;
    --sbb-color-night-default: ${#143a85} !important;
    --sbb-color-orange-default: ${#f27e00} !important;
    --sbb-color-peach-default: ${#fcbb00} !important;
    --sbb-color-pink-default: ${#cf4082} !important;
    --sbb-color-platinum-alpha-0: ${hsla(0,0%,80%,0)} !important;
    --sbb-color-platinum-alpha-20: ${hsla(0,0%,80%,.2)} !important;
    --sbb-color-platinum-default: ${#cdcdcd} !important;
    --sbb-color-red-alpha-0: rgba(235,0,0,0) !important;
    --sbb-color-red-alpha-20: rgba(235,0,0,.2) !important;
    --sbb-color-red-alpha-90: rgba(235,0,0,.9) !important;
    --sbb-color-red-default: #eb0000 !important;
    --sbb-color-red-mode-dark: #ff3838 !important;
    --sbb-color-red125-alpha-0: rgba(198,0,24,0) !important;
    --sbb-color-red125-alpha-20: rgba(198,0,24,.2) !important;
    --sbb-color-red125-default: #c60018 !important;
    --sbb-color-red150-default: #a20013 !important;
    --sbb-color-silver-default: ${#dcdcdc} !important;
    --sbb-color-sky-default: ${#0079c7} !important;
    --sbb-color-smoke-alpha-0: ${hsla(0,0%,55%,0)} !important;
    --sbb-color-smoke-alpha-10: ${hsla(0,0%,55%,.1)} !important;
    --sbb-color-smoke-alpha-20: ${hsla(0,0%,55%,.2)} !important;
    --sbb-color-smoke-alpha-5: ${hsla(0,0%,55%,.05)} !important;
    --sbb-color-smoke-default: ${#8d8d8d} !important;
    --sbb-color-storm-default: ${#a8a8a8} !important;
    --sbb-color-turquoise-default: ${#00a59b} !important;
    --sbb-color-violet-default: ${#6f2282} !important;
    --sbb-color-white-alpha-0: ${hsla(0,0%,100%,0)} !important;
    --sbb-color-white-alpha-20: ${hsla(0,0%,100%,.2)} !important;
    --sbb-color-white-alpha-30: ${hsla(0,0%,100%,.3)} !important;
    --sbb-color-white-alpha-50: ${hsla(0,0%,100%,.5)} !important;
    --sbb-color-white-alpha-60: ${hsla(0,0%,100%,.6)} !important;
    --sbb-color-white-alpha-70: ${hsla(0,0%,100%,.7)} !important;
    --sbb-color-white-default: ${#fff} !important;
}

================================

sbermegamarket.ru

INVERT
ymaps[class$="ground-pane"]

================================

schnucks.com

CSS
.text-white {
    --darkreader-text--tw-text-opacity: 1;
    color: ${#181A1B} !important;
}

================================

scholar.google.*
scholar.google.*.*

INVERT
a[role="checkbox"] > :nth-child(2)
div[role="banner"] > a > span
a[aria-label="Homepage"]
.gs_ico
img[src*="scholar_logo"]
a#gs_hdr_lgo
a#gs_hdr_drw_lgo
span.gs_in_cb

CSS
.gs_fma_cl .gs_fma_snp,
.gs_fma_cl .gs_fma_fon {
    z-index: 0 !important;
}

================================

schwab.com

CSS
.highcharts-background {
    background-color: var(--darkreader-neutral-background) !important;
}

================================

sci-hub.*

IGNORE IMAGE ANALYSIS
#raven
#logo

================================

science.org

INVERT
.navbar-brand > .hidden-on-dark
.main-header__secondary__logo > img

CSS
h1.news-article__hero__title {
    color: var(--darkreader-neutral-text) !important;
}

================================

sciencebasedmedicine.org

INVERT
.site-logo

================================

sciencedirect.com

CSS
body,
.gh-nav .gh-nav-action,
.search-button-link>.link-button.search-button-outline,
.link-button-secondary:not(.on-dark-background),
.button-link-primary,
.button-alternative-text,
.button-alternative-text:hover,
.bibliography,
.els-footer-content .anchor,
.button-link {
    color: ${#1f1f1f} !important;
}
#gh-cnt,
.accessbar-sticky,
.search-button-link>.link-button.search-button-outline,
.link-button-secondary:not(.on-dark-background) {
    background-color: var(--darkreader-neutral-background) !important;
}
.u-bg-grey1,
.u-bg-white,
.cookie-btn {
    background-color: ${#f5f5f5} !important;
}
.authors,
.gh-nav-help-anchor,
.publication-title-link,
.pps-count,
.pps-label,
.u-margin-s-bottom {
    color: var(--darkreader-neutral-text) !important;
}
.author-highlights,
#gh-drawer,
.popover-content-inner {
    background-color: var(--darkreader-neutral-background) !important;
}
.popover-content {
    background-color: rgba(50, 50, 50, .85) !important;
}
#gh-overlay {
    background-color: rgba(20, 20, 20, .85) !important;
}
.article-textbox {
    background-color: ${rgb(213, 211, 207)} !important;
}
.Article .topic-link {
    color: ${rgb(46, 50, 52)} !important;
    text-decoration-color: ${rgb(46, 50, 52)} !important;
}
.u-fill-grey8 {
    fill: ${#1f1f1f} !important;
}
.issue-navigation .button-alternative-tertiary [class*="icon-"] {
    background: #f5f5f5 !important;
}

================================

scipy-lectures.org

INVERT
img.math

================================

scmp.com

INVERT
.header-menu-container__menu-top-left-wrapper
.global-menu-features__menu-icon
.global-menu-features__search-icon
.global-menu-features__close-icon
.social-button__twitter--active
.social-button__email--active
.footer-wrapper__logo

================================

scpclassic.wikidot.com
scpexplained.wikidot.com
scpfoundation.net
scp-wiki.net
scp-wiki.wikidot.com
scp-wiki-cn.wikidot.com
scpko.wikidot.com
scpwiki.com
scp-ru.wikidot.com
scpfoundation.net

CSS
div#container-wrap,
.panel-body,
.content-panel {
    background-image: none !important;
}
div#container-wrap::before {
    background-image: url(https://scp-wiki.wdfiles.com/local--files/component:theme/body_bg.png) !important;
    content: "";
    height: 162px;
    left: 0;
    position: absolute;
    top: 0;
    width: 100%;
}
.yui-navset .yui-nav a {
    background-image: none !important;
}

================================

scratch-wiki.info

INVERT
.sb3-comment-label
.sb3-literal-string
.sb3-literal-number

================================

scratch.mit.edu/projects/*

CSS
path.blocklyFlyoutBackground {
    fill: rgb(32, 32, 32);
}

IGNORE INLINE STYLE
g[data-argument-type="colour"] > path
.scratchColourPickerLabel + .goog-slider-horizontal
.color-button_color-button-swatch_37evk
.color-picker_row-header_173LQ + div > .slider_container_o2aIb

================================

screenconnect.com
*.screenconnect.com

CSS
.OuterPanel .MainPanel .MasterPanel .MasterListContainer ul li.HasChildren > div > p {
    filter: brightness(100%) !important;
}

================================

scribd.com

INVERT
.logo
.document_container

================================

scribe.rip
scribe.nixnet.services
scribe.citizen4.eu
scribe.bus-hit.me
scribe.froth.zone

CSS
body {
    background-color: var(--darkreader-neutral-background) !important;
}

================================

scribus.net

INVERT
#site-header img

================================

script.google.com

INVERT
.docs-icon
.icon
.monaco-editor .cursors-layer > .cursor

IGNORE INLINE STYLE
mask > *

================================

scroll.com

INVERT
#content > div > div > header > div > div > div > a.Titlebar__wordMark___2U8-r.display__desktop___1Cfo7 > div > div > svg
#content > div > div > footer > div > div > div > div.layout__column___diAE2.layout__span-12___2a4Fw.layout__span___31pR0.layout__portrait-span-3___A34nc.layout__span___31pR0.layout__landscape-span-2___30F_p.layout__order-3___3WFlS.layout__portrait-order-0___108js.space__stack-xl___1oKsQ.flex__column___JnBPu.flex__flex___1N4XU.flex__align-stretch___2HAV3.flex__direction-column___fSYwh > div > div > div > svg

CSS
.Careers__logo___1kLq6 {
    z-index: 1 !important;
}

================================

scroll.morele.net

INVERT
.navbar-logo
.social-link

================================

se.pl

INVERT
.mobile-bars

================================

sea.playblackdesert.com

INVERT
.original .characteristic .desc
.original .characteristic h3
.original .characteristic .feature li span

================================

sealegacy.org

INVERT
.custom-logo

================================

seamonkey-project.org

INVERT
img[src*="logo.png"]

CSS
#breadcrumbs {
    background-image: none !important;
}

================================

sec.sangfor.com
sec.sangfor.com.cn

INVERT
.en-logo

================================

secondlife.com

INVERT
nav > div > div > div[class$=-line]

CSS
div.hero-section.homepage.wf-section {
    z-index: 0;
}

================================

sectigo.com

INVERT
.bg-object-fit

================================

secure.ally.com

INVERT
.nobd-aob-day
#lp_invite
#manageNonAllyAccountsFrame .third-party-iframe
#billPayFrame

================================

secure.fanboy.co.nz

CSS
html {
    background-image: none !important;
}

================================

secureage.com

INVERT
.logo-block

================================

security.org

INVERT
.category-cards img
.featured-in img
.grid-x.stats img
.product-logo
a.brand
section[id="our-top-picks"] img

================================

seedr.cc

INVERT
.content-item-filename
.content-link
div[id="folder-up"] img

================================

segmentfault.com

INVERT
.sf-header-logo
.sf-header__logo
.sf-logo
.navbar-brand

================================

sejm.gov.pl

CSS
.main {
    background-image: none !important;
}

================================

sematext.com

INVERT
#logo
.sematext-clients-gamma figure

================================

sembr.org

CSS
mark {
    color: var(--darkreader-neutral-text) !important;
}

================================

seminka-chilli.cz
chilli-shop.sk

CSS
#pannelWrapper {
    background-color: var(--darkreader-neutral-background) !important;
}

================================

semmle.com

CSS
#Header-logo * {
    fill: #ffffff !important;
}

================================

senscritique.com

INVERT
.d-media-videos::before
.eins-wish.black
.eins-logo-small
.header-navigation-main-item a img
.eins-search-header
.eins-poll
.eins-compass
.eins-compass-xl
.eins-notification
.eins-tv
.eins-ticket
.eins-current.black
.eins-done.green
.eins-done.white
.eins-newspaper
.juyLRn

CSS
.ecap-products-next,
.ecap-products-prev {
    background-color: hsla(100, 20%, 50%, .8) !important;
    color: ${black} !important;
}
.d-chevron3-b,
.d-chevron3-l,
.d-chevron3-r,
.d-chevron3-t {
    background-image: -webkit-image-set(url(https://static.senscritique.com/img/layout/icons/chevrons/chevron-size3.png?201710121789416) 1x,url(https://static.senscritique.com/img/layout/icons/chevrons/chevron-size3@2x.png?201710121789416) 2x);
}

================================

sephora.com

INVERT
img[alt="Sephora"]
img[src="/img/ufe/icons/stores.svg"]
img[src="/img/ufe/icons/community.svg"]
img[src="/img/ufe/icons/me32.svg"]
svg[data-at="basket_icon_large"]
div[aria-label$="stars"]

================================

septa.org

INVERT
.checked > label > div > .switch-marker
.clear-btn
.leaflet-control-attribution
.leaflet-popup
.listbox-row[role="presentation"] > svg-icon
.map-container
.map-zoom-controls > button > i
.search-icon

CSS
.bg-black,
.is-frequent {
    background-color: var(--darkreader-neutral-text) !important;
    color: var(--darkreader-neutral-background) !important;
}
.bus,
.circle {
    border: 2px solid var(--darkreader-neutral-text) !important;
}
.leaflet-routes-pane > svg > g > path {
    stroke: #000 !important;
}
.leaflet-stops-pane > svg > g > path,
.trip-icon-container > svg > path {
    fill: #fff !important;
    stroke: #000 !important;
}

================================

sergeistrelec.name

CSS
.bl0 {
    background: #f8fbf8 !important;
}
html[data-darkreader-scheme="dark"] .bl2 {
    background-blend-mode: multiply !important;
    background-color: ${rgba(255,255,255,0.80)} !important;
}
html[data-darkreader-scheme="dark"] .bln li {
    background-blend-mode: multiply !important;
    background-color: ${rgba(255,255,255,0.85)} !important;
}
html[data-darkreader-scheme="dark"] #footer,
html[data-darkreader-scheme="dark"] .small-logo,
html[data-darkreader-scheme="dark"] .sh10 {
    background-blend-mode: multiply !important;
    background-color: ${rgba(255,255,255,0.95)} !important;
}

IGNORE IMAGE ANALYSIS
.bln li
#footer
.small-logo
.bl2
.sh9
.sh10

================================

server.pro

INVERT
svg.server-pro-logo

================================

servercat.net

INVERT
.theme-header-logo

================================

servercontrolpanel.de

CSS
body {
    background-color: transparent !important;
}

================================

setupbits.com

INVERT
.td-header-logo
.td-main-logo

================================

sf-express.com

INVERT
.home-icon
.map
.order-btn

================================

shaneco.com

INVERT
.logo-full

================================

shapecatcher.com

INVERT
img[src^="https://shapecatcher.com/svg/"]

CSS
html[data-darkreader-scheme="dark"] img[src*="header.png"] {
    background-color: #333 !important;
}

================================

share.dmhy.org

CSS
.jmd_base td a {
    color: ${#3391ff};
}
.jmd .today a {
    color: ${#fff};
}

================================

sharedrop.io

CSS
.qr-code img {
    border: 10px solid white !important;
}

================================

sharepoint.com
*.sharepoint.com

INVERT
img.WACPageImg

CSS
.ms-FocusZone,
.ms-DetailsRow-cell,
.ms-Button {
    background-color: var(--darkreader-neutral-background) !important;
}
.ms-DetailsRow-cell,
.ms-FocusZone,
.ms-Button,
.od-ItemContent-title,
.ms-DetailsHeader-cellName {
    color: var(--darkreader-neutral-text) !important;
}
.ms-Button {
    border-color: ${#F0F0F0} !important;
}

================================

shazam.com

INVERT
.media.track::after

CSS
.google,
.apple-app-store {
    background-image: url(/resources/f6f457227917dcdfc9538fbbb5a931f111648b3d/sprite.png) !important;
}
button[data-shz-cmd="try"] {
    background-color: rgba(232, 230, 227) !important;
    color: rgb(29, 33, 34) !important;
}
.shz-frame-ux-playerbar-upsell-variant-b {
    --darkreader-bg--background-color: #1d2122 !important;
}

================================

shells.com

INVERT
img[alt="Shells Logo"]

================================

shields.io

INVERT
#app a
object

================================

shimadzu.com

INVERT
.header-logo

================================

shipstation.com
*.shipstation.com

INVERT
[class*="sub-item-icon"]
[data-testid*="note-icon"]
[class*="pill-content"]
.quantity-3CkoKmy

CSS
div[class*="status-text"] {
    background-color: var(--darkreader-neutral-background) !important;
}

IGNORE INLINE STYLE
[class*="pill"]
[class*="color-button"]
[class*="dropdown-toggler-color"]

================================

shoecarnival.com

INVERT
.jss140

================================

shop.dr-rath.com

CSS
.colored-header-desktop {
    background-color: var(--darkreader-neutral-background) !important;
}

================================

shop.surfboard.com

INVERT
img.header-logo-image

CSS
.homepage {
    background-image: none !important;
}
.sb-searchpro .input-group .btn {
    background-color: ${#fee9a4} !important;
}

================================

shopify.com
shopify.dev

INVERT
.marketing-nav--skin-light > .marketing-nav__logo
.shopify-logo
.header-country-select__trigger
.lia-message-count::before
.DateTime::before

================================

shoppy.gg

INVERT
.footer-profile__logo

================================

shorthistory.org

INVERT
.td-logo > .td-main-logo > .td-retina-data

================================

shutupwrite.com

CSS
.suaw-welcome-section,
.suaw-how-section,
.suaw-wp-section,
.suaw-why-section,
.suaw-testimonial-section,
.suaw-organize-section {
    background: var(--darkreader-neutral-backround) !important;
}

================================

signal.org

INVERT
.navbar-item .icon
.signal-logo

================================

signin.ea.com

IGNORE INLINE STYLE
svg *

================================

signin.nianticlabs.com

INVERT
img[alt="Niantic"]

================================

signulous.com

INVERT
.checkbox input:checked

CSS
.checkbox input:checked {
    background-color: white;
}

================================

silhouette.com

INVERT
.retailer-newsletter-teaser__icon

CSS
div.slideshow-slide[data-swiper-slide-index="1"] {
    background-image: url('//img2.storyblok.com/0x800/filters:no_upscale():format(webp)/f/40252/1920x800/df0f0f3709/2024_11_dyncwcontour_home-header.jpg') !important;
}

================================

simepar.br

CSS
.highcharts-text-outline {
    display: none !important;
}

================================

similarweb.com

INVERT
.app-header__logo

================================

simplemachines.org

INVERT
h1.forumtitle

CSS
#header div.frame,
#header,
span.botslice span,
span.botslice,
span.topslice,
span.topslice span,
#content_section,
#content_section div.frame,
span.lowerframe,
span.lowerframe span,
div.title_bar,
h4.titlebg,
h3.titlebg,
h4.catbg,
h4.catbg2,
h3.catbg,
h3.catbg2,
.table_list tbody.header td.catbg {
    background-image: none !important;
}

================================

simply-v.de

CSS
body {
    background-image: none !important;
}

================================

simplywall.st

INVERT
img[alt="tick"]
img[alt="google-five-stars"]
img[alt="logos-forbes-afr-cnbc"]
img[alt="logos-techcrunch-skynews"]
.social-link-x
.trustpilot-logo
img.snowflake-image
img[alt="SP Global logo"]

CSS
.about-us-hero {
    background-image: url(https://cdn.prod.website-files.com/648009cb318551f1806b36b4/67614e7c7d4c0cf325ab0154_about-us-header.jpg) !important;
}
.main-links,
.our-people-hero-text,
.w-dropdown,
.sc-pyeOL div,
.sc-pyeOL a {
    text-shadow: ${rgb(225, 212, 201)} 1px 1px 0px !important;
}
.sc-pyeOL svg path:nth-child(1):not(footer path):not(.sc-gmxqhk-2 svg path):not(data-cy-id="segment-dividend"),
.sc-pyeOL svg path:nth-child(2):not(footer path):not(.sc-gmxqhk-2 svg path):not(data-cy-id="segment-dividend"),
.sc-pyeOL svg path:nth-child(3):not(footer path):not(.sc-gmxqhk-2 svg path):not(data-cy-id="segment-dividend"),
svg path[fill="black"] {
    fill: gray !important;
}

IGNORE INLINE STYLE
a[href="/?view"] *
footer *
.sc-pyeOL svg *
a[href="/dashboard"] *
a[href="https://simplywall.st"] *
a[href^="https://simplywall.st/stocks/nz/transportation/"] *
a[href="https://simplywall.st/?view"] *

IGNORE IMAGE ANALYSIS
.jSLugk
.efQHY
.jXRsGN
.portfolio-section

================================

simracingmachines.com

INVERT
slider-component div.media.media--transparent > img[class="multicolumn-card__image"][src*=".png" i]

CSS
.gradient {
    background: var(--darkreader-neutral-background) !important;
}

================================

singularlabs.com

INVERT
img[alt="SingularLabs"]

================================

sio2.staszic.waw.pl

INVERT
.texmath

================================

sitecheck.sucuri.net

INVERT
.icon
.logo

================================

sklepbiegacza.pl

INVERT
.header__logo
.button__icon
.main-slider__nav-item
.homepage__brand-logo
.footer__list-image
img.footer__image[src*=cash]
.product__brand-logo
.paypo-info__button

================================

skycash.com

CSS
.c-hero__newsletter {
    background-image: none !important;
}

================================

skyscanner.*
skyscanner.*.*
backpack.github.io
tianxun.cn
whoflies.com

CSS
body {
    background: ${white} !important;
}
[class*=bpk-flare-bar__curve] {
    fill: ${white} !important;
}

================================

slack.com

CSS
.c-slacklogo svg path:first-child {
    fill: var(--darkreader-selection-text) !important;
}
.c-button:not(.v--primary, .v--secondary) {
    background: inherit !important;
    color: inherit !important;
}
.c-button:not(.v--primary, .v--secondary):hover {
    text-decoration: underline !important;
}

================================

slackware.com

CSS
body {
    background-image: none !important;
}
td[bgcolor="#000000"] {
    border: 1px solid !important;
}

================================

slader.com

INVERT
.navigation__logo
.explanation
.solution-cell img
.solution-content img
.answer img

================================

slashnet.wordpress.com

CSS
#container,
.entry,
body {
    background-image: none !important;
}

================================

slazag.pl

INVERT
.focus__portals__banner__single
.footer__title__wrapper
.logo__wrapper
.social-bar
.triangle-slazag-svg
img.section-bg-absolute

================================

slovensko.sk
*.slovensko.sk

CSS
.enrollment-portal__authentication-process__qr-image img {
    background-color: white !important;
}

================================

smallcultfollowing.com

CSS
*:not(a) {
    color: var(--darkreader-neutral-text) !important;
}

================================

smap.uthm.edu.my

CSS
.slider-background {
    background: none !important;
}
.backstretch {
    opacity: 0.5 !important;
}

================================

smcdsb.elearningontario.ca

CSS
:host([no-padding-footer]) .d2l-dropdown-content-footer,
:host([no-padding-header]) .d2l-dropdown-content-header,
:host([no-padding]) .d2l-dropdown-content-container {
    background: var(--darkreader-neutral-background);
}

================================

smithsonianmag.com

INVERT
.site-logo
.footerLogo > a > img
#mobile-icon > span

================================

smoglab.pl

CSS
.main-nav,
.footer,
.module-title .main-title {
    background-image: none !important;
}

================================

smokin-guns.org

CSS
#page-body .smoke-grid-9 .inner {
    background-image: none !important;
}

================================

smtp2go.com

INVERT
canvas

================================

smzdm.com

INVERT
#logo
.logo-left

================================

snack.expo.io

CSS
#root > div > div > div:nth-child(2) > div:nth-child(2) > div:nth-child(2) > div > div:nth-child(2) {
    background-color: white !important;
}

================================

snapcraft.io

CSS
#search-docs {
    background-image: none !important;
}

================================

snapeda.com

INVERT
img[title="SnapEDA"]
img.part-organization
canvas:not(#firstfootprint)

================================

softorage.com

CSS
.tg {
    background-image: linear-gradient(36deg,#fc466b,#3f5efb) !important;
}

================================

softpedia.com

IGNORE IMAGE ANALYSIS
.menubar-hp span.logov
h1.logov

================================

soha.vn

INVERT
.page-head__right .head-hanhtrinh img

CSS
.page-body .page-head,
.page-menu,
.page-top,
.sh_home20-wrapper,
.sh_home20-wrapper .shcategory.layout-bd-nonebg,
.sh_home20-wrapper .shnews_box .noticable-news,
.sh_home20-wrapper .shnews_box .reviewer .list-cmt .item-cmt,
.news-detail .share {
    background-color: var(--darkreader-neutral-background) !important;
}
.sh_home20-wrapper .shnews_box .shnews_title,
.sh_home20-wrapper .sh_hotnews .hotnews-label a,
.news-detail .news-title,
.news-content p,
.list-topic-cate .item-news-cate .title-new-cate,
.itembigs .related-special-news .item-related-news:first-child,
.itembigs .related-special-news .item-related-news:first-child a,
.rowccm li.tincungmucfocus .info h4.ksclili-title a {
    color: var(--darkreader-neutral-text) !important;
}
.page-head,
.page-top {
    background-image: none !important;
}

================================

sony.*

IGNORE INLINE STYLE
.brand-logo-svg > g

================================

sophgo.com
en.sophgo.com

INVERT
.logo

================================

soulsplanner.com

CSS
.form-controls input[type="checkbox"]:not(:checked) + label::before {
    color: transparent !important;
}

================================

soundcloud.com

INVERT
.notificationIcon.messages::before

CSS
.listenEngagement,
.commentForm__wrapper {
    border: none !important;
}
body,
.commentForm__wrapper,
.searchTitle {
    background: none !important;
}
.sc-classic .header__navMenu > li > a {
    border-right-color: #454545 !important;
}
.headerSearch__input {
    background: ${#f1f4f6} !important;
}

================================

souq.com

INVERT
img[src*="/souqAmazon-logo-v2"]
li.fashion-menu-link[aria-expanded="false"]
.userNameField::after
.filter-icon.deals
.cart-icon

================================

source.dot.net

CSS
.r {
    border-style: none !important;
}

================================

sourceforge.net

CSS
.intro,
.audience {
    background-image: none !important;
}
.all-facets,
.m-project-search-results {
    background-color: ${white} !important;
}

================================

sourcegraph.com

INVERT
.header__logo

CSS
body {
    background-image: none !important;
}

================================

sourcing.hktdc.com

INVERT
.logo

================================

southparkstudios.com
southpark.de

CSS
:root {
    --page-background: var(--darkreader-neutral-background) !important;
}

================================

soylent.com

INVERT
.header-logo__image
.d-header #site-logo

================================

space.bilibili.com

INVERT
.count::before
.h .h-gradient

CSS
.elec .elec-status {
    display: none;
}
:root {
    --bg1: var(--darkreader-neutral-background) !important;
    --darkreader-bg--_container-color: transparent !important;
    --darkreader-text--_label-text-color: var(--darkreader-text--text3) !important;
    --graph_bg_thick: var(--darkreader-border--graph_bg_thick) !important;
}

================================

spaceship.com

IGNORE INLINE STYLE
svg *

================================

spaceweather.com

INVERT
[src$="current_conditions.jpg"]
[src$="center_tablebg_top_r2_c1.jpg"]

CSS
[background] {
    background-image: none !important;
}

================================

spanish.kwiziq.com

CSS
.bg-clouds {
    background-image: none !important;
}
.table-scroll-shadow-wrapper table td,
.table-scroll-shadow-wrapper table th,
.table-scroll-shadow-wrapper table tr {
    mix-blend-mode: normal !important;
}

================================

spboms.ru

CSS
body {
    background: var(--darkreader-neutral-background) !important;
}

================================

spc.noaa.gov

CSS
body {
    background-image: none !important;
}

================================

spdx.org/licenses

INVERT
.gray-diagonal
#logo

================================

spectrum.com

INVERT
img[src$="spectrum-logo.svg"]

CSS
.sp-background-image {
    background-image: none !important;
}

================================

spectrum.ieee.org

INVERT
a[title="Spectrum Logo"] > svg

================================

spectrum.net

INVERT
.banner-wrapper > .image-container
img[src$="spectrum-logo.svg"]

CSS
.unauthenticated-homepage {
    background-image: none !important;
}

================================

speed.cloudflare.com

INVERT
img[src*="speedrabbit-animate.gif"]
img[src*="speedrabbit-static.png"]

================================

speeddial2.com

INVERT
img[src*="images/"]

================================

spidersweb.pl

INVERT
.amp-site-title
img[alt="logo bizBlog"]
img[alt="bizblog to ludzie"]

================================

spidersweb.pl/plus

INVERT
a[href="/plus"] svg

================================

spidersweb.pl/rozrywka

INVERT
a[href="/rozrywka"] svg

CSS
a[href="/rozrywka"] svg path[fill="#211D26"] {
    --darkreader-inline-fill: ${white} !important;
}

================================

sports.ru

INVERT
.nav-top-line__logo

================================

sporza.be

CSS
.sc-score,
.sc-score__away,
.bouton:hover {
    color: ${#222} !important;
}
.sc-score__wrapper {
    background-color: ${#BBB} !important;
}
.bouton {
    color: ${#fff} !important;
}
.sc-epg--live .sc-epg__program {
    background-color: ${#CCC} !important;
}
.vrt-newsletter {
    background-color: ${#EEE} !important;
}
.vrt-site-footer .vrt-newsletter .vrt-link--newsletter {
    background-color: ${#AAA} !important;
}
.logo__letters {
    fill: var(--darkreader-neutral-background) !important;
}
.vrt-link {
    background-color: ${rgba(255, 165, 0, 0)} !important;
    color: ${rgba(50, 50, 50)} !important;
}
.vrt-link:hover {
    background-color: ${rgb(100, 100, 100)} !important;
}
.vrt-site-footer__navigation--green {
    background-color: ${#AAA} !important;
    color: var(--darkreader-neutral-background) !important;
}

================================

spreadprivacy.com

INVERT
[src^="https://spreadprivacy.com/content/images/2017/07/linux"]
[src^="https://spreadprivacy.com/content/images/2017/11/Significant-Actions"]
[src^="https://spreadprivacy.com/content/images/2018/09/ddg-traffic"]
[src^="https://openclipart.org/image/24px/svg_to_png/28768/qubodup-Cubikopp-smilies"]
[src="https://spreadprivacy.com/content/images/2017/10/smiley.png"]
[src="https://spreadprivacy.com/content/images/2018/09/private-browsing4.png"]
[src="https://spreadprivacy.com/content/images/2017/10/https-in-address-bar26.png"]
[src="https://spreadprivacy.com/content/images/2018/01/private-browsing-reasons-1.png"]
[src="https://spreadprivacy.com/content/images/2020/05/search-preference-menu_heatmap.jpg"]
[src="https://spreadprivacy.com/content/images/2020/10/trilateral-invitation_header-1.png"]
[src="https://spreadprivacy.com/content/images/2020/05/search-preference-menu_comparison-1.jpg"]
[src="https://spreadprivacy.com/content/images/2020/05/search-preference-menu_screen-sizes-1.jpg"]
[src="https://spreadprivacy.com/content/images/2020/02/Awareness-of-Privacy-Risk-of-Public-USB-Charging-.jpg"]
[src="https://spreadprivacy.com/content/images/2018/02/DuckDuckGo-Extension_Desktop-OnDevice.jpg"]

================================

sqlitebrowser.org/stats

IGNORE INLINE STYLE
.plot-container.plotly *

================================

squareup.com

INVERT
.logo

================================

src.fedoraproject.org
pagure.io

IGNORE INLINE STYLE
#cal-heatmap svg rect

================================

ss64.com/pass

CSS
.mainpw {
    background-color: #ffffff;
    color: #202223;
}

IGNORE INLINE STYLE
.mainpw

================================

ssllabs.com

INVERT
#logo

================================

sso.qiniu.com

INVERT
.navbar-brand

================================

stablediffusionweb.com

INVERT
img[src="https://r2.stablediffusionweb.com/images/background-faqs.jpg"]

================================

stackage.org

INVERT
.logo

================================

stackexchange.com
askubuntu.com
mathoverflow.net
serverfault.com
stackapps.com
stackoverflow.com
superuser.com
*.stackexchange.com

INVERT
._glyph:not(.top-bar .-logo ._glyph)
.favicon-mathoverflow
.favicon-mathoverflowmeta
.favicon-stackoverflowmeta
.h-auto[alt="Academia"]
.h-auto[alt="Anime & Manga"]
.h-auto[alt="Ask Different"]
.h-auto[alt="Aviation"]
.h-auto[alt="Code Review"]
.h-auto[alt="Electrical Engineering"]
.h-auto[alt="English Language Learners"]
.h-auto[alt="Japanese Language"]
.h-auto[alt="MathOverflow"]
.h-auto[alt="Mathematics"]
.h-auto[alt="Server Fault"]
.h-auto[alt="Skeptics"]
.h-auto[alt="Software Engineering"]
.h-auto[alt="Stack Apps"]
.h-auto[alt="Super User"]
.h-auto[alt="The Workplace"]
.h-auto[alt="Theoretical Computer Science"]
.h-auto[alt="Unix & Linux"]
.h-auto[alt="Web Applications"]
.h-auto[alt="Role-playing Games"]
a.js-gps-track::before
img[alt="The Stack Exchange Network"]
button[class^="js-vote"]
.MathJax img

CSS
body,
#content {
    background-color: var(--darkreader-neutral-background) !important;
    background-image: none !important;
    border-color: var(--darkreader-bg--theme-primary-custom) !important;
}
.profile-cards--graph {
    background-image: repeating-linear-gradient(0deg, transparent, transparent 13px, ${#e4e6e8} -13px, ${#e4e6e8} 21px) !important;
}
.c-pointer {
    color: grey;
}
.js-accepted-answer-indicator.fc-green-500 {
    color: var(--green) !important;
}
#newuser-box {
    background-color: ${#FFF8DC} !important;
}
.topbar .icon-site-switcher-bubble {
    background-repeat: no-repeat !important;
}
div.h100.bar-lg.p-bs-wrapper:has(a[href="/questions"]) {
    background: linear-gradient(0deg, #502502 30%, #FFFFFF) !important;
}
div.h100.bar-lg.p-bs-wrapper:has(a[href="https://stackoverflow.co/teams"]) {
    background: linear-gradient(0deg, hsl(209,100%,26%) 30%, #FFFFFF) !important;
}
button[class^="js-vote"] {
    border-color: var(--darkreader-dark-background) !important;
}

IGNORE INLINE STYLE
.chess-replayer-board td

IGNORE IMAGE ANALYSIS
.hero-background

================================

standards.ieee.org

INVERT
.logo-link

================================

stardewvalleywiki.com

CSS
html {
    background: none !important;
}

================================

stardock.com

INVERT
.mid
.careers

================================

start64.com

INVERT
img[alt="logo"]

================================

startech.com.bd

INVERT
#nav-toggler

================================

startpage.com

INVERT
.hamburger-menu .hamburger-button

IGNORE IMAGE ANALYSIS
.home__section__search-logo
.header__logo
.header-settings__logo
.hamburger-menu .hamburger-button

================================

stat.utels.ua

CSS
img[src="/i/btm_m1.gif"],
img[src="/i/top_m1.gif"] {
    display: none !important;
}
[style*="background: url(\"/i/box"],
td[background="/i/cntr_m1.gif"] {
    background-image: none !important;
}

================================

station-drivers.com

INVERT
img[src*="/topic_icons/"]
img[src*="/folder_icons/"]
img[src*="/images/bios_firmware"]
img[src*="/images/driver.jpg"]
img[src*="/images/utile"]
img[src*="/images/rating"]
img[src*="/images/star"]
img[src*="/images/downl"]
img[src*="/components/com_remository/images/file_icons/"]
img[src*="/images/gohome.gif"]

================================

stats.arp242.net

INVERT
.chart-line

================================

stats.stackexchange.com

CSS
.site-header {
    background-image: none !important;
}

================================

status.aws.amazon.com

INVERT
.logo
.tabStandard
td > img
td > a > img
th > a > img
th > div > a > img

CSS
.tabStandard a {
    color: ${white} !important;
}
.tabStandard,
.selected a {
    background-color: ${black} !important;
    color: ${white} !important;
}
tbody > tr > th {
    background: transparent !important;
}
table > tbody > tr > td {
    background: transparent !important;
}
.gradient {
    background: transparent !important;
}

================================

status.epicgames.com

INVERT
div.eg-shield.white

================================

status.npmjs.org

INVERT
.logo-container > a > img

================================

status.quad9.net

INVERT
svg text

CSS
path[fill="#ffffff"],
svg rect[fill="white"] {
    fill: ${#ffffff};
}
path[stroke="#CCC"] {
    stroke: #aaa;
}

IGNORE INLINE STYLE
svg *

================================

statusinvest.com.br

INVERT
div.indice-list div.ml-1
div.indice-list div.mt-2
i.ml-1

================================

steamdeck.com

INVERT
section#available-now div.col_9
section#experience div.col_8
section#experience h2
section#topfeature div.col_5

CSS
section#available-now {
    background-color: ${#0f0f0f} !important;
}

IGNORE INLINE STYLE
#header-logo-arc

================================

stevendoesstuffs.dev

INVERT
.post-img-wrapper img

================================

stine.uni-hamburg.de

CSS
.appointment {
    background-color: var(--darkreader-neutral-background) !important;
    background-image: none !important;
}

================================

stm.info

INVERT
.map-OSM

================================

stockbit.com

INVERT
.konvajs-content canvas
a[href$="chartbit"] canvas
footer + section img
footer img
img[alt*="chart"]
img[src$="stockbit.svg"]

CSS
.highlight {
    background-color: var(--darkreader-neutral-background) !important;
}

================================

stolichki.ru

INVERT
.logoBig__img
ymaps[class$="ground-pane"]
ymaps[class$="svg-icon-content"] > ymaps
ymaps[class$="placemark__content-inner"] > ymaps > ymaps

================================

stooq.pl

CSS
a[href="//stooq.pl"] path:not([fill]) {
    fill: var(--darkreader-neutral-text) !important;
}

================================

store.google.*
store.google.*.*

CSS
[style*="background-image"] {
    filter: brightness(50%) sepia(40%) !important;
}

================================

store.playstation.com

INVERT
.psw-brand-text--playstation-store

================================

store.ubi.com

INVERT
div.primary-logo

CSS
.pt_storefront-homepage #main .homepage-slider-wrapper .homepage-custom-slide > a:not(a[href$="/deals"]) .homepage-custom-slide__content .custom-slide-inner h2,
.pt_storefront-homepage #main .homepage-slider-wrapper .homepage-custom-slide > a:not(a[href$="/deals"]) .homepage-custom-slide__content .custom-slide-inner h3,
.pt_storefront-homepage #main .homepage-slider-wrapper .homepage-custom-slide a {
    color: var(--darkreader-neutral-background) !important;
}
.pt_storefront-homepage #main .homepage-slider-wrapper .homepage-custom-slide > a[href$="/deals"] .homepage-custom-slide__content .custom-slide-inner h3 {
    color: var(--darkreader-neutral-text) !important;
}

================================

storyteller.fit

INVERT
img[src*="icon"]

================================

storytellphys.wordpress.com

INVERT
img

================================

straightdope.com

CSS
body {
    background: var(--darkreader-neutral-background) !important;
}

================================

strava.com
*.strava.com

INVERT
.labelGroup
#effort-box
.week.clearfix svg
#compare-graph svg
#compare-graph canvas
.nav-item a::after
.weekly-goal svg .sport-type
footer img[alt="Strava"]
.activity-indicator
.icon-other
#open-global-search-button
.icon-caret-up
.icon-caret-down
.icon-share
.icon-kudo
.icon-comment
.icon-collapse
.icon-star
.icon-caret-right
.btn-icon.remove
.icon-private
.icon-group
text.label
.leaflet-control-zoom-in
.leaflet-control-zoom-out
.follow-action .selection.gear::after
img[src*="gift"]:not(a.btn-primary img)
ul.options span
div[class*="FlyoverSpeedControl_flyoverSpeedControlScrubber"]
.app-icon.icon-rowing

CSS
.base-chart .grid-line,
#athlete-history-chart .vgrid {
    stroke: #555555;
}
#athlete-history-chart #effort-box {
    fill: #3e3e3e;
    stroke: black;
}
#basic-analysis .xaxis-container .background,
#basic-analysis rect.static-info-box,
#basic-analysis rect.static-label-box {
    fill: #2c2c2c;
}
.base-chart rect.simple-bar.segmentbar {
    opacity: 1;
}
.base-chart rect.simple-bar {
    fill: #444444;
    stroke: #252627;
}
.current-week-label {
    fill: black;
}
.sum.no-rest {
    fill: black;
}
.options img {
    filter: invert(40%);
}
#infoBox text {
    color: black;
}
.weekly-goal svg .sport-type {
    opacity: 0.5 !important;
}
svg {
    fill: currentColor;
}
[class*="sauce"]:not(.sauce-invoke) {
    background: transparent !important;
}
[class*="sauce"] input,
.sauce-header {
    color: inherit !important;
}
rect.static-label-box,
.xaxis-container text {
    fill: inherit !important;
}
[class*="sauce"] tr:hover {
    background: inherit !important;
}
#sauce-kudo-all button {
    background-color: ${rgba(199, 198, 199, 0.5)};
}
div[style='background-image: url("https://web-assets.strava.com/assets/react-18/precheckout/9470c6d4fbd5d9f1f0a1.png");'] {
    background-blend-mode: multiply !important;
    background-color: ${rgba(255,255,255,0.5)} !important;
}

IGNORE IMAGE ANALYSIS
.app-icon.icon-fb
.app-icon.icon-rowing
.follow-action .selection.gear::after
.leaflet-control-attribution:after
.leaflet-control-zoom-in
.leaflet-control-zoom-out
.leaflet-popup-close-button
.leaflet-control-layers-toggle
.leaflet-container.dark .map-tooltip .close
.map-tooltip .close
.mapbox-icon

================================

streamable.com

INVERT
img[alt="Streamable Logo"]
.logo
.customer-logos-v2

================================

student.ladok.se

CSS
#sidomeny .middle {
    background: var(--darkreader-neutral-background) !important;
}

================================

studeo.fi

INVERT
.equation

================================

studio.youtube.com

INVERT
paper-radio-button
.ytcp-home-button

================================

studip.uni-hannover.de

CSS
#content-wrapper {
    background: var(--darkreader-neutral-background) !important;
}

================================

studip.uni-passau.de

CSS
#layout_container > div {
    background-image: none;
}

================================

studyflix.de

INVERT
img[title='Rendered by QuickLaTeX.com']

================================

subdivx.com

INVERT
#cabecera img
#contenedor_foro .cita img
#contenedor_foro .datos img[src*="/img/"]
#perfil_izq img[src*="img/"]

CSS
BODY * {
    color: ${#333};
}
A {
    color: ${#0366d6} !important;
}
input[type="text"],
input[type="password"],
input[type="button"],
input[type="submit"] {
    background: ${#bbb};
    border: 1px solid #999;
}
input[type="submit"]:hover {
    background: ${#999};
    border: 1px solid #999;
}
mark {
    background: ${#f00} !important;
    color: ${#fff} !important;
}
#barra a,
#menu_largo a,
#menu_largo_chat a,
#foro_tema_menu a,
#ultimos_foros_renglon .link_foro_tema,
.titulo_menu_izq {
    color: #ddd !important;
}
#wrapper {
    background-image: none !important;
}
#contenedor_gral {
    background: ${#e0e0e0} !important;
    box-shadow: rgba(0, 0, 0, 0.7) 0px 0px 8px;
    display: table;
    height: -webkit-fill-available !important;
    width: fit-content !important;
}
#cabecera {
    background: ${#e4e4e4};
}
#barra,
#menu_top,
#menu_detalle_buscador,
#menu_detalle,
#menu_largo,
#menu_largo_chat,
#prog_menu_detalle,
#primer_msg_voto,
#reg_menu_detalle,
#drdivx_menu_detalle,
#contenedor_foro .fecha,
#perfil_menu,
#foro_tema_menu {
    background: ${rgb(153,173,206)} !important;
    background: linear-gradient(to bottom, ${rgb(153,173,206)} 0%, ${rgb(75,110,171)} 100%) !important;
}
#foro_home,
#foro_home_renglon,
#cuadrados_izq,
#cuadrados_izq_reng,
#chat_reng,
#contenedor_foro,
#contenedor_foro .datos,
#contenedor_foro .cita,
#contenedor_foro .mensaje {
    background: ${#fff} !important;
}
#foro_home_datos,
#cuadrados_izq {
    color: ${#999} !important;
}
#foro_home_datos a {
    color: ${#669} !important;
}

================================

subiektywnieofinansach.pl

INVERT
.logo

================================

submarinecablemap.com

INVERT
#map

================================

subscene.com

CSS
body {
    background-image: none !important;
}

================================

suckless.org

INVERT
[src="dwm.svg"]
[src="st.svg"]
[src="core.svg"]
[src="surf.svg"]
[src="blind.svg"]
[src="farbfeld.svg"]
[src="quark.svg"]
[src="sent-bullets-s.png"]
[src="slstatus.svg"]

================================

sugaroutfitters.com

CSS
.clearfix {
    display: none !important;
}

================================

suggestions.momentumdash.help

CSS
#__next > div {
    --color-bg-body: var(--darkreader-neutral-background) !important;
    --color-bg-default: var(--darkreader-neutral-background) !important;
    --color-bg-emphasize: ${#ccc} !important;
}

================================

suite.smarttech-prod.com

INVERT
.smart-wbp-canvas-layer

================================

suno.com.br

INVERT
#logoSuno > a > svg

================================

super-productivity.com

CSS
.hero-title {
    color: var(--darkreader-neutral-background) !important;
}
html[data-darkreader-scheme="dark"] .intro-gradient-wrapper .logo {
    filter: invert(90%) !important;
}

================================

superbuy.com

INVERT
.header-logo
.logo img

================================

supercoach.heraldsun.com.au

IGNORE INLINE STYLE
svg *

================================

support.arkadium.com

INVERT
img[alt="Logo"]

================================

support.discord.com

INVERT
.logo img
ol.breadcrumbs li:first-child::before

================================

support.eset.com

INVERT
i.table-icon.product

================================

support.heymman.com

INVERT
img[src*="logo.png"]

================================

support.mozilla.org

INVERT
.card--topic .card--icon
img.card--icon-sm
div.sumo-nav--logo
.pencil
.thumbsup

================================

surfboard.com

INVERT
.site-logo

================================

surveymonkey.com

CSS
.is-high-contrast .radio-button-display,
.is-high-contrast .checkbox-button-display {
    opacity: 1 !important;
}
.modern-browser .radio-button-display::after,
.modern-browser .checkbox-button-display::after {
    border-color: var(--darkreader-neutral-text) !important;
}

================================

sverigesradio.se

INVERT
#sprite-check
#sprite-facebook
#sprite-instagram
#sprite-reddit
#sprite-twitter
#sprite-whatsapp
.circle
.cross
.default
.episode-list-item__controls svg
.external-link-with-icon__icon
.gallery-button .icon
.gallery-button svg g
.info-teaser-container__title h2
.link-icon .icon
.local-weather-item__wind-icon
.logo
.menu-icon.icon
.play-icon__pause-symbol
.play-icon__play-symbol
.progress.queue-progress .bar
.sr-link__svg svg
.sr-logo-wrapper
.sound-bars .bar
.support-info__icon svg
[data-require="modules/custom-click-tracking"] svg
[data-require="modules/listen-later"] svg
[data-require="modules/share-button"] svg
button.reset
input[type="range"]::-moz-range-thumb
input[type="range"]::-moz-range-track
input[type="range"]::-webkit-slider-runnable-track
input[type="range"]::-webkit-slider-thumb

CSS
.weather-icon {
    filter: invert(1) hue-rotate(180deg) !important;
}
.live-marker .dot,
.live-label::before,
.active::before {
    background-color: var(--darkreader-neutral-text) !important;
}
.search-page em,
.search-result em,
.info-teaser-container__title {
    color: var(--darkreader-neutral-background) !important;
}
#sprite-home path,
#sprite-news path,
#sprite-podcast path,
#sprite-direct path,
#sprite-profile path {
    fill: var(--darkreader-neutral-text);
}

================================

svgrepo.com

INVERT
div[class^="style_socialLinks"] img
.stylesArray img:not([alt^="Multicolor"]):not([alt^="Flat"]):not([alt^="Bordered"]):not([alt^="Tritone"]):not([alt^="Emoji"]):not([alt^="Logo"]):not([alt^="Gradient"]):not([alt^="Isometric"]):not([alt^="Sticker"]):not([alt^="3D"])

CSS
div[class^="style_NodeImage_"] img,
div[class^="style_CollectionVector_"] img {
    background-color: #fff !important;
}
div,
h1,
h2,
p,
span {
    color: var(--darkreader-neutral-text) !important;
}

================================

svt.se

INVERT
header img[src*=svt]
.nyh_navigation__menu-toggle
[class^="VideoPlayerTheme__play-pause-button-simple"]::before
[class^="_play-pause-button-simple"]::before

CSS
.nyh_breaking__top-prefix,
.nyh_teaser__live-text {
    color: var(--darkreader-neutral-background) !important;
}
button[class^="PaginationButton"],
a[class^="PaginationButton"],
.nyh_screamer,
[class^="_RightNowTeaser__title"],
[class^="_RightNowTeaser__root"] {
    background: var(--darkreader-bg--nyh-color-white) !important;
    border-left-color: var(--darkreader-bg--nyh-color-news);
}
button[class^="PaginationButton"]:hover,
a[class^="PaginationButton"]:hover {
    background: var(--darkreader-border--color-play-white) !important;
}
.flexbox .nyh_teaser.nyh_teaser--group-secondary {
    border-right: none !important;
}
[class*="GroupSecondaryTeasers__container___"],
.nyh_feedbox-item+.nyh_feedbox-item,
.nyh_teaser.nyh_teaser--no-border-top {
    border-top: none !important;
}
.nyh_navigation .nyh_submenu::before {
    border-bottom-color: var(--darkreader-bg--nyh-color-white) !important;
}
.nyh_teaser.nyh_teaser--story-grid,
.nyh_icons_caret--factbox {
    border: none;
}
.nyh_submenu-menucard,
[class*="_Post__contentVisitor___"]::after {
    border-right-color: var(--darkreader-bg--nyh-color-grey-lighter) !important;
}
[class*="CurrentTopics__item___"],
[class*="GroupSecondaryTeasers__showMoreButton___"],
.nyh_mobile-menu__list-item,
.nyh_menu-card__submenu-item,
.nyh_submenu-menucard,
.nyh_submenu {
    border-color: var(--darkreader-border--nyh-color-grey-lighter) !important;
}
.nyh_fact-box {
    border-bottom: 1px solid var(--darkreader-border--nyh-color-grey-lighter);
    border-top: 1px solid var(--darkreader-border--nyh-color-grey-lighter);
}
.nyh_fact-box__body--closed::after {
    background: linear-gradient(to bottom, #1e202180 0%, #1e2021 100%);
}
.nyh_regional-widget-regions {
    background: var(--darkreader-bg--nyh-color-grey-lightest);
}
.nyh_submenu-menucard {
    background-color: var(--darkreader-bg--nyh-color-white);
}

================================

sw.kovidgoyal.net

CSS
.sidebar-drawer,
.sidebar-search,
.toc-drawer {
    background: var(--darkreader-neutral-background) !important;
}
.sidebar-tree a.current,
.sidebar-tree label:hover {
    background: var(--darkreader-selection-background) !important;
}
code {
    background: var(--darkreader-neutral-background) !important;
}

================================

swiatrolnika.info

INVERT
img[alt*="logo"]
img[src*="/images/images2/icons/"]

================================

system76.com

INVERT
svg[class^="sys-logo"]

================================

systemd.io

INVERT
.page-logo img

================================

t-mobile.pl

INVERT
img[src*="quick-redirects"]
.text-base-black ::before

CSS
.preview-image,
.inner-container,
.bg-base-secondary-10 {
    background-image: none !important;
}

================================

t.bilibili.com

CSS
.bg,
.bgc {
    background: var(--darkreader-neutral-background) !important;
}
#limit-mask-wall::after,
#limit-mask-wall::before {
    background: linear-gradient(180deg, rgba(255, 255, 255, 0) 0%, var(--darkreader-bg--bg1) 100%) !important;
}
:root {
    --bg1: var(--darkreader-neutral-background) !important;
    --darkreader-bg--_container-color: transparent !important;
    --darkreader-text--_label-text-color: var(--darkreader-text--text3) !important;
    --graph_bg_thick: var(--darkreader-border--graph_bg_thick) !important;
}

================================

t.me
telegram.me

INVERT
.tgme_logo

================================

tableau.com

INVERT
.feature-list__icon
.mobile-nav-button__icon
.site-logo

CSS
section {
    background-image: none !important;
}

================================

tablesgenerator.com

INVERT
.icon-all-borders.toolbar-icon
.icon-no-borders.toolbar-icon
.icon-edit-borders.toolbar-icon
.icon-merge-cells.toolbar-icon
.icon-split-cells.toolbar-icon
.icon-no-colors.toolbar-icon

IGNORE INLINE STYLE
.sp-thumb-inner
.sp-preview-inner

================================

tabletochki.org

INVERT
.perekaz__list img

================================

tabs.ultimate-guitar.com

INVERT
.ddUoc
.JZg5a

================================

tails.net

INVERT
.blocks .block img
.laptop

CSS
body {
    background-image: none !important;
}
#donate-banner p {
    color: var(--darkreader-neutral-background) !important;
}
#donate-banner u {
    border-bottom-color: var(--darkreader-neutral-background) !important;
}

IGNORE IMAGE ANALYSIS
#donate-banner

================================

tailscale.com/kb/

CSS
main aside .sticky > .absolute.from-white {
    --tw-gradient-from: var(--darkreader-neutral-background) var(--tw-gradient-from-position) !important;
    --tw-gradient-to: rgb(from var(--darkreader-neutral-background) r g b / 0) var(--tw-gradient-from-position) !important;
}

================================

tailwindcss.com

CSS
.bg-white:not(#docsearch),
.bg-gray-100 {
    --bg-opacity: none !important;
}
.text-gray-900,
.hover\:text-gray-900:hover,
h1,
h2,
h3,
h4,
h5,
h6 {
    --text-opacity: none !important;
}
.bg-center {
    background: none !important;
}

================================

tailwindui.com

CSS
html > body > div > div > img {
    opacity: 0 !important;
}

================================

take-a-screenshot.org

INVERT
.switch-window span::before

================================

talishar.net

CSS
._ourTurn_199aw_35 {
    background-image: url("https://talishar.net/assets/turnWidget-Normal-89240b8d.png") !important;
}
._pitchBackground_1574e_15 {
    background-image: url("https://talishar.net/assets/symbol-resource-bca42b67.png") !important;
}

================================

tanstack.com

CSS
.bg-gradient-to-r {
    background-image: linear-gradient(to right,var(--tw-gradient-stops)) !important;
}

================================

taobao.com

INVERT
#J_SearchIcon
.J_MyShopCoupon
.J_BtnEditSKU
.cart-checkbox

CSS
.tbh-member.J_Module {
    background-image: none !important;
}
#q.search-combobox-input {
    background-color: var(--darkreader-neutral-background);
}
.qrcode-img {
    background-color: white !important;
}

================================

tapology.com

INVERT
.logo
ul.feedCats

CSS
ul.feedCats li a:link,
ul.feedCats li a:visited {
    color: var(--darkreader-neutral-background) !important;
}

================================

tarnogorski.info

INVERT
.td-main-logo

================================

tasks.google.com

INVERT
div[role="listitem"] > div > div > div[role="presentation"]

================================

tass.ru

INVERT
div[class^="LogoImage_logo"] > svg > path
button[class^="Footer_icon_app_store"] > svg > g > path:last-of-type

CSS
div[class^="ds_ext_carousel"] {
    background-color: var(--darkreader-neutral-background) !important;
}

================================

tastoid.com/

CSS
.jumbotron.jumbotron-no-bg {
    background: var(--darkreader-neutral-background) !important;
}

================================

tc39.es

CSS
var {
    color: ${#218379} !important;
    mix-blend-mode: normal !important;
}

================================

tcrf.net

CSS
body {
    background-image: none !important;
}

================================

teamtrees.org

CSS
.hypeTemplate_tano {
    background-color: ${white} !important;
}

================================

teamviewer.com

INVERT
img[alt="TeamViewer"]

CSS
.cmp-container--fullwidth {
    background-image: none !important;
}

================================

techmaniak.pl
activemaniak.pl
agdmaniak.pl
appmaniak.pl
blogomaniak.pl
fotomaniak.pl
gizmaniak.pl
gsmmaniak.pl
luxmaniak.pl
mobimaniak.pl
rtvmaniak.pl
tabletmaniak.pl

CSS
body,
#headerNavBlogomaniak,
#header,
#top,
#bottom,
#footer,
#footer_menu,
.wrapper,
#search input.search {
    background-color: var(--darkreader-neutral-background) !important;
    background-image: none !important;
}

================================

technologyreview.com

INVERT
a[class^="headerTemplate__logo"]

================================

techpowerup.com

INVERT
.page-header__logo

================================

techspot.com

INVERT
svg#techspot-logo

================================

telegeography.com

INVERT
.map-tile-loaded
div#globe-start > canvas
div#globe-end > canvas
div.leaflet-map-pane
img.map-banner
div.mapboxgl-map
span.hamburger-box
a > img[src^="https://www2.telegeography.com/hubfs/"]
img[alt="TeleGeography"]

================================

telegram.org

CSS
.tl_main_download_image__android {
    background: url(../img/SiteAndroid.jpg?2) 50% 0 no-repeat;
}
.tl_main_download_image__ios {
    background: url(../img/SiteiOS.jpg?2) 50% 0 no-repeat;
}
.tl_main_download_desktop {
    background: url(../img/SiteDesktop.jpg?2) 50% 19px no-repeat;
}
html[data-darkreader-scheme="dark"] .tl_main_download_desktop,
html[data-darkreader-scheme="dark"] .tl_main_download_image__android,
html[data-darkreader-scheme="dark"] .tl_main_download_image__ios {
    filter: invert(90%) hue-rotate(180deg);
}
html[data-darkreader-scheme="dimmed"] .tl_main_download_desktop,
html[data-darkreader-scheme="dimmed"] .tl_main_download_image__android,
html[data-darkreader-scheme="dimmed"] .tl_main_download_image__ios {
    filter: invert(14%);
}
html[data-darkreader-scheme="dark"] .tl_main_download_desktop a {
    color: ${#3dbeff} !important;
}

================================

teleman.pl

INVERT
.movieRank

================================

telerik.com

INVERT
a.TK-Aside-Menu-Link
a.TK-Aside-Menu-Button
#ContentPlaceholder1_C377_Col00 > img

CSS
a.TK-TLRK-Logo svg path[fill="#7c878e"] {
    --darkreader-inline-fill: ${black} !important;
}
a.TK-TLRK-Logo svg path[fill="#4b4e52"] {
    --darkreader-inline-fill: ${black} !important;
}
a.TK-PRGS-Logo-Footer svg path[fill="#4b4e52"] {
    --darkreader-inline-fill: ${black} !important;
}
#ContentPlaceholder1_C418_Col00 > footer {
    background-image: none !important;
}

================================

teltarif.de

CSS
body,
.ttColBack,
#tthdrbox {
    background: var(--darkreader-neutral-background);
    color: var(--darkreader-neutral-text);
}

================================

temu.com

CSS
._2Fkk_bmp {
    background-color: transparent !important;
}

================================

tenforums.com

CSS
.garhead {
    background-color: var(--darkreader-neutral-background) !important;
    background-image: none !important;
    border-left-color: var(--darkreader-neutral-background) !important;
    border-right-color: var(--darkreader-neutral-background) !important;
}

================================

tenor.com

INVERT
.FlagIcon
.ShareIcon

================================

terazwy.pl

INVERT
img[src*="img/loga"]
img[src*="img/logotr.png"]

================================

terraform.io

IGNORE INLINE STYLE
.text

================================

terraria.wiki.gg

CSS
#mw-head {
    background: var(--theme-navbar-background);
}
#mw-panel .portal h3::after {
    border-color: var(--theme-sidebar-heading-arrow-color) transparent;
}
#mw-panel .portal h3:hover::after {
    border-color: var(--theme-sidebar-heading-arrow-color-hover) transparent;
}
#simpleSearch::before,
#simpleSearch::after {
    border-color: var(--theme-navbar-search-botton-text-color);
}
#simpleSearch:hover::before,
#simpleSearch:hover::after {
    border-color: var(--theme-navbar-search-botton-text-color-active);
}

================================

tesco.com

CSS
.ui-components-library .nav-dropdown .dropdown a.nav-toggle h1,
.ui-components-library .nav-dropdown .dropdown a.nav-toggle h2,
.ui-components-library .nav-dropdown .dropdown a.nav-toggle h3,
.ui-components-library .nav-dropdown .dropdown a.nav-toggle h4,
.ui-components-library .nav-dropdown .dropdown a.nav-toggle h5,
.ui-components-library .nav-dropdown .dropdown a.nav-toggle h6 {
    z-index: 0 !important;
}
.ddsweb-checkbox__visible svg path {
    fill: var(--darkreader-neutral-background);
}

IGNORE INLINE STYLE
.ddsweb-checkbox__visible svg path

================================

tesla.com

INVERT
.tds-modal-close-icon
.tds-menu-header-legacy [id*="tds-menu-header-main--trigger"]:checked ~ [for*="tds-menu-header-main--trigger"] .tds-menu-header-main--cross_hatch

CSS
.tcl-hero-parallax__heading,
.tcl-hero-parallax__subheading a,
.tcl-hero-parallax__additional-link {
    color: ${gray} !important;
}
#block-mainheadernavigation .tds-menu-header-nav--list_link {
    color: var(--darkreader-neutral-background) !important;
}

================================

testudo.umd.edu

CSS
#secondary-side,
#widgetbox_widget_parent_0 {
    background-color: var(--darkreader-neutral-background) !important;
}

================================

thalia.de

CSS
font[color="#000000"] {
    color: ${#000000} !important;
}
.tm-artikelbild-wrapper {
    z-index: 0 !important;
}

================================

the-conjugation.com

CSS
#gauche {
    background-color: var(--darkreader-neutral-background) !important;
}

================================

the-race.com

INVERT
.img-fluid

================================

the5to9.xyz

CSS
:root {
    --wt-text-on-background-color: var(--darkreader-neutral-text) !important;
}

================================

theatlantic.com

INVERT
[class^="NavHamburgerButton_root"]
[class^="NudgeShared_chevron"]
[class^="NonMeteredNudge_desktopTextContainer"]::after

================================

theatlas.com

CSS
.d4 .axis .tick text {
    fill: var(--darkreader-neutral-text) !important;
}
.d4 .axis .tick rect {
    fill: var(--darkreader-neutral-background) !important;
}

================================

thecamels.org

INVERT
.block-tags
.block-client-group-list
.slider-content-list-item-opinion-logo
.slider-testimonials-list-item

CSS
.slider-testimonials-content {
    background-color: var(--darkreader-neutral-background) !important;
    background-image: none !important;
}

================================

thecanadianencyclopedia.ca

INVERT
.edit
.citation
.share
.print
.dot-1.dot
.dot-2.dot
.dot-3.dot
.accordion-toggler.dropdown-toggler.nav-submenu-toggler

================================

thecode.media

INVERT
img[src$="/logo.svg"]
.post-item__arrow
li::before

================================

thedailybeast.com

INVERT
.Logo
.NavSubDesktop__hamburger-bars

================================

thedispatch.com

INVERT
li::before

================================

thefreedictionary.com

INVERT
strong.i.logo
a.i.keyboard-link.mobile-hidden
#regButton::before
ul.social-networks
a.i.icon-notif
div.box > a.i
div.cprh > span.i.A.cpr
a.i.popup-opener
ul.logos-list

================================

thefreelibrary.com

INVERT
div#logo

CSS
div.main_content {
    background-image: none !important;
}

================================

theguardian.com

INVERT
a[data-sponsor="guardian.org"]
a[data-sponsor="open society foundations"]
div[data-link-name="Crosswords"] .crossword__cell-number
div[data-link-name="Crosswords"] .crossword__cell-text
section[data-component="documentaries"] a[href="https://www.theguardian.com/documentaries"] > svg
section[data-component="headlines"] .dcr-d4xwbm > svg
section[data-component="olympic-medal-table"] img[alt="Multi-coloured sand texture"]
section[data-component="paralympic-medal-table"] img[alt="Multi-coloured sand texture"]

CSS
div[data-component="footer"] .dcr-1fespkx,
gu-island[name="SlotBodyEnd"] div[data-testid="epic=buttons"] > div > a,
gu-island[name="SlotBodyEnd"] div[id="slot-body-end"] p > strong > span,
gu-island[name="SlotBodyEnd"] fieldset#P0-0 > div > div > div > div {
    background: rgb(255, 229, 0) !important;
    color: rgb(18, 18, 18) !important;
}
div[data-component="footer"] .dcr-jgzukx {
    color: rgb(255, 229, 0) !important;
}
div[data-component="youtube-atom"] .dcr-1n5sax3 {
    background: linear-gradient( 180deg, rgba(0, 0, 0, 0) 0%, rgba(0, 0, 0, 0.7) 25% ) !important;
}
div[data-component="youtube-atom"] .play-icon {
    background-color: rgba(18, 18, 18, 0.6) !important;
}
div[data-gu-name="media"] .dcr-ctvcrj,
div[data-gu-name="standfirst"] .dcr-rruuos,
main .dcr-1q3os16,
main .dcr-pdifrs {
    background-color: var(--star-rating-background) !important;
}
div[data-link-name="most popular"] .dcr-9rsbaa {
    background-color: var(--age-warning-background) !important;
    color: var(--age-warning-text) !important;
}
gu-island[name="SlotBodyEnd"] div[id="slot-body-end"] div > section {
    border-top-color: rgb(255, 229, 0) !important;
}
gu-island[name="SlotBodyEnd"] label > div:hover > input[type="radio"],
gu-island[name="SlotBodyEnd"] label.dcr-1iljw00 > div > input[type="radio"] {
    border: 2px solid rgb(255, 229, 0) !important;
}
gu-island[name="StickyBottomBanner"] div > div > div > div > div.dcr-1xq78ib {
    background-color: var(--darkreader-neutral-text) !important;
}
gu-island[name="StickyBottomBanner"] div > svg {
    --darkreader-inline-fill: var(--darkreader-neutral-text) !important;
}
gu-island[name="StickyBottomBanner"] div.dcr-bxrjkt > div {
    background-color: ${rgb(5, 41, 98)} !important;
}
header[data-component="header"] a[data-link-name="header : logo"] svg {
    fill: var(--darkreader-text--masthead-nav-link-text) !important;
}
header[data-component="header"] .dcr-1nulcij {
    background: rgb(255, 229, 0) !important;
    color: rgb(5, 41, 98) !important;
}
header[data-component="header"] .dcr-b3mn8w {
    background-color: var(--masthead-veggie-burger-background) !important;
}
main .dcr-1o2pyn8 {
    background-color: var(--pill-background) !important;
    color: var(--pill-text) !important;
}
section[data-component="documentaries"] p {
    border-top: 1px solid #ffffff50 !important;
}
section[data-component="contact-the-guardian"] a {
    color: #121212 !important;
}
section[data-component="contact-the-guardian"] .btn {
    background-color: #fff !important;
}
section[data-component="contact-the-guardian"] .securedrop {
    background-color: #ffe500 !important;
}
section[data-component="contact-the-guardian"] .securedrop__main > .eyes > .eye > .outside > svg > path {
    stroke: rgba(230,207,0,.5) !important;
}
section[data-component="headlines"] .dcr-d4xwbm {
    background-color: var(--darkreader-neutral-text) !important;
}
section[data-component="headlines"] path[fill="#ddd"] {
    fill: #BDBDBD !important;
}
section[data-component="olympic-medal-table"] circle[r="6.6"],
section[data-component="paralympic-medal-table"] circle[r="6.6"] {
    fill: var(--darkreader-bg--section-background) !important;
}
section[data-component="video"] .dcr-18aqf5q[data-link-name="video-container-prev"],
section[data-component="video"] .dcr-pbtc9t[data-link-name="video-container-next"] {
    background-color: var(--carousel-arrow-background) !important;
}
section[data-component="video"] .dcr-18aqf5q[data-link-name="video-container-prev"]:hover,
section[data-component="video"] .dcr-pbtc9t[data-link-name="video-container-next"]:hover {
    background-color: var(--carousel-arrow-background-hover) !important;
}
section[data-component="video"] .dcr-18aqf5q[data-link-name="video-container-prev"] svg,
section[data-component="video"] .dcr-1bvoox2[data-link-name="video-container-prev"] svg,
section[data-component="video"] .dcr-1nrzsks[data-link-name="video-container-next"] svg,
section[data-component="video"] .dcr-pbtc9t[data-link-name="video-container-next"] svg {
    fill: var(--carousel-arrow) !important;
}
section[data-component="video"] .dcr-1tzmmc7::before {
    border-top: 1px solid var(--card-border-top) !important;
}
section[data-component="video"] .dcr-6r6u10[data-link-name^="carousel-small-nav-dot-"] {
    background-color: var(--carousel-dot) !important;
}
section[data-component="video"] .dcr-zxdpfk[data-link-name^="carousel-small-nav-dot-"] {
    background-color: var(--carousel-active-dot) !important;
}
svg[stroke="var(--article-border)"],
svg[stroke="var(--straight-lines)"] {
    stroke: var(--darkreader-border--article-border) !important;
}

IGNORE INLINE STYLE
div[data-component="youtube-atom"] .play-icon path[fill="#FFFFFF"]
header[data-component="header"] .dcr-b3mn8w svg path
nav[data-component="nav2"] a[data-link-name="nav3 : logo"] svg path
section[data-component="contact-the-guardian"] *
section[data-component="documentaries"] path[fill="#121212"]
section[data-component="headlines"] path

================================

theinformation.com

INVERT
.logo

IGNORE IMAGE ANALYSIS
header.locked .logo

================================

theins.ru

INVERT
header > div > a > svg

================================

thejakartapost.com

INVERT
.logo-jakartapost

================================

thelancet.com

INVERT
.journal-logos
.footer__logo

================================

themis.dk

CSS
.content {
    background-image: none !important;
}
.box {
    background-image: none !important;
}

================================

themoscowtimes.com
moscowtimes.ru

INVERT
.site-header__logo
.footer__logo
.contribute-teaser__button

================================

themoviedb.org

INVERT
.glyphicons_v2.link
.glyphicons_v2.facebook
.glyphicons_v2.twitter
.glyphicons_v2.instagram
.glyphicons_v2.keyboard
.glyphicons_v2.speech-bubble-alert
.glyphicons_v2.arrow-thin-right
.glyphicons_v2.arrow-thin-left

CSS
.card {
    background-color: ${#dfe1e2} !important;
}

================================

thenounproject.com

INVERT
div[class^="styles__Image"]
a[class^="styles__HeaderLogoLink"]

================================

theoatmeal.com

INVERT
img.d-inline-block.align-bottom

================================

theonion.com

INVERT
a[href="//www.theonion.com"] .theonion

================================

thepaper.cn

INVERT
.head_logo

================================

thepiratebay.org

INVERT
img[src="https://torrindex.net/images/tpb.jpg"]
img[src="https://torrindex.net/images/tpbsmall_notext.jpg"]

================================

thereader.mitpress.mit.edu

INVERT
#logo

================================

theregister.*
theregister.*.*

INVERT
.row_label.title_rhs_line
.blocksandfiles_logo
.devclass_logo
#sitpub_logo

================================

thetrainline.com

CSS
.ot-sdk-row,
.ot-sdk-twelve,
.ot-sdk-columns {
    background-color: ${#CDD5E2} !important;
}

================================

thetruesize.com

INVERT
map-compass
map-compass :is(circle, g, text)

================================

theverge.com

INVERT
.c-global-header__logo
.c-tab-bar__logo
.c-footer__logo-link

================================

thewindowsclub.com

INVERT
.custom-logo

================================

thomannmusic.com
thomann.*

INVERT
.fx-list__item--circle
.fx-list__item--circle span

CSS
.country-item__flag,
.fx-mix-blend-mode--multiply,
.mix-blend-darken,
.navigator__item,
.navigator__item-image,
.product__image {
    mix-blend-mode: unset !important;
}

================================

thompsonstein.com

INVERT
a.logo

================================

thriftbooks.com

INVERT
.DesktopHeader-logo

================================

thronemaster.net

INVERT
.head-info-wild

================================

thunderbird.net

INVERT
.w-48
div.devices-container > .graphic > picture > *
.page-index .floating-icons
.page-index .planets

CSS
div.mask svg path {
    fill: var(--darkreader-neutral-background) !important;
}
div.page-separator-cover {
    color: black !important;
}
.page-index #masthead,
.page-index header {
    background-image: var(--bg-hero-set), var(--bg-hero-gradient) !important;
}
.page-index .floating-icons,
.page-index .planets {
    z-index: 0 !important;
}

IGNORE INLINE STYLE
a.mozilla-logo *

================================

ti.com

INVERT
.ti_p-responsiveHeader-top-logo

================================

tianocore.org

INVERT
.tcLogoArea

================================

tieba.baidu.com

INVERT
.add-more-forum
.all-wraper
.core_title_btns
.day_rcmd > .class_title
.fengchao-wrap-box span
.focus_btn
img[src*="sign_err.png"]
.save_face_bg
.search_bright .nav_wrap_add_border
.share_btn_wrapper
.sub_nav_wrap
.threadlist_rep_num
.u-f-item

CSS
.card_banner {
    filter: brightness(50%);
}
.class_title,
.content-sec,
.f-d-item,
.left-sec,
.page-container,
.pb_footer,
.sub_nav_wrap,
.tb_footer {
    background-image: none !important;
}
.u-f-item {
    color: var(--darkreader-neutral-background) !important;
}
.tang-pass-qrcode-imgWrapper {
    background-color: white !important;
}

================================

til.jakelazaroff.com

CSS
.wrapper[data-astro-cid-s6tr6vzr] {
    --sidebar-width: min(40vw, 25rem) !important;
}

================================

time.com

INVERT
nav.main .menu-btn .menu-btn-box

================================

timeanddate.com

INVERT
.tad-logo

CSS
#header {
    background: ${#DCD9D8};
}
.analog-clock__hands :not(.analog-clock__hand--seconds):not(.analog-clock__pin-inner) {
    stroke: ${#181F2B};
}

================================

tinder.com

CSS
svg > path[style*="--rewind"] {
    fill: ${black} !important;
}
svg > path[style*="--nope"] {
    fill: ${red} !important;
}
svg > path[style*="--super-like"] {
    fill: ${cyan} !important;
}
svg > path[style*="--like"] {
    fill: ${#22ebc0} !important;
}
svg > path[style*="--boost"] {
    fill: ${purple} !important;
}

================================

tinte.railly.dev

IGNORE INLINE STYLE
.border-t
svg *

================================

tiny.cloud

CSS
.doc,
.doc h1,
.doc h2,
.doc h3,
.doc h4,
.doc h5,
.doc h6,
.nav-menu a,
.toolbar a,
.page-versions,
.version-menu-toggle,
body {
    color: var(--darkreader-neutral-text);
}

================================

tiptap.dev
*.tiptap.dev

IGNORE INLINE STYLE
#app *

================================

titantv.com

INVERT
img[alt="Home"]

================================

tizen.org

INVERT
#header #logo

================================

tjournal.ru

INVERT
mark

CSS
mark a {
    color: ${#346eb8} !important;
}
.main.layout {
    background: var(--darkreader-neutral-background) !important;
}

================================

tns-e.ru

INVERT
img[title*="ТНС энерго"]
img[src="/img/refresh.png"]
img[src="/img/logout-black.png"]

================================

to-do.live.com

INVERT
span[class^="ms-Toggle-thumb"]

CSS
.backgroundLines {
    background-image: linear-gradient(180deg, var(--darkreader-bg--bg-primary), var(--darkreader-bg--bg-primary) 52px, var(--darkreader-bg--bg-separator) 52px, var(--darkreader-bg--bg-separator) 52px) !important;
}

================================

todoist.com

INVERT
.ist_button_apple > img
#td-help-logo_svg__a ~ g:last-of-type

CSS
main > section:first-of-type > div {
    z-index: 1 !important;
}
img[src^="/_next/static/images/"],
[style*="/_next/static/images/"] {
    filter: brightness(50%) sepia(40%) !important;
}
option,
.oT9NU,
footer {
    background-color: var(--darkreader-neutral-background) !important;
}

================================

tokfm.pl

INVERT
.controls span.play svg

CSS
div.top_section_bg,
div.bottom_section_bg {
    background-color: ${#e7e5e4} !important;
}
body.desk #content {
    background-color: var(--darkreader-neutral-background) !important;
}

================================

tombihn.com

INVERT
.hamburger svg:first-of-type
.navigation-logo

================================

tonsky.me

CSS
body {
    background-color: var(--darkreader-neutral-background) !important;
    background-image: none !important;
}

================================

torguard.net

INVERT
img[src$="statusok.gif"]
img[src$="statusfailed.gif"]

================================

tosdr.org

INVERT
img[src*="tosdr-logo-128.svg"]
img[src*="/img/news/"]
img[src*="guidelines.svg"]

================================

totylkoteoria.pl

INVERT
.site-branding
.header__socials

CSS
.hero {
    background-image: none !important;
}

================================

toutatice.fr

INVERT
.img-responsive
.banner

================================

towardsdatascience.com

CSS
article picture > img {
    background-color: ${black} !important;
}

================================

towersemi.com

INVERT
.Logo

================================

towhee.io

INVERT
.logo-wrapper

================================

town-of-salem.fandom.com
breezewiki.com/town-of-salem/
bw.artemislena.eu/town-of-salem/

IGNORE INLINE STYLE
span[style^="text-shadow"]
span[style*="background: linear-gradient"]
a *

================================

tpgi.com

CSS
.hero__module,
.bg-overlay {
    background-image: none !important;
}

================================

trac.ffmpeg.org

INVERT
img[src$="trac_logo_mini.png"]
img[src="/ffmpeg-logo.png"]

CSS
select option {
    background-color: var(--darkreader-neutral-background);
}

================================

tracfone.com

INVERT
.navbar-container nav .navbar-brand

================================

track.toggl.com

CSS
#root,
.content-wrapper > * {
    background-color: var(--darkreader-neutral-background) !important;
}

================================

trailhead.salesforce.com

INVERT
lwc-tds-header

CSS
.search-input__input {
    background-color: var(--darkreader-neutral-background) !important;
}
.user-info__name {
    color: inherit !important;
}
.progress-ring__content {
    background-color: white !important;
}
[data-layout="desktop"] .nav-list-item__link:hover,
[data-layout="desktop"] .nav-list-item__button[aria-expanded="true"] {
    background: inherit !important;
}

================================

training.moodys.com

CSS
body.frameless {
    background-image: none;
}

================================

transifex.com

INVERT
img.close_image

================================

translate.google.*
translate.google.*.*

INVERT
.ttsbutton
.tlid-copy-translation-button
.starbutton
.speech-button
.clear
.swap > .jfk-button-img
.morebutton
.close-button
.ita-kd-icon-button
.ita-kd-menuitem-inputtool-icon
.ita-kd-checkbox
.vk-t-btn
.vk-sf-b
.ita-hwt-backspace-img
.ita-hwt-enter-img
.ita-hwt-grip
.gt-ex-quote

CSS
.trans-verified-button {
    background-size: cover;
}
canvas.ita-hwt-canvas {
    cursor: url(https://icons.iconarchive.com/icons/paomedia/small-n-flat/16/pencil-icon.png) 0 16,auto !important;
}

IGNORE IMAGE ANALYSIS
.ita-kd-img

================================

translate.yandex.*

INVERT
.button.button_tab.state-selected::before
#optionsButton::after
#clearButton::after
#textNativeSpeaker
#textSpeaker
#microphone::after
#keyboardButton::after
#spellerButton::after
.button.button_icon.button_icon_swap::after
#favButton::after
#translatorSpeaker
#translatorNativeSpeaker
#copyButton::after
#shareButton::after
#goodVoteButton::after
#badVoteButton::after
#editorButton::after
.toggler::after
.button.button_icon.button_icon_speaker
.dictionary-example_toggler::after
.dictionary-example_meta__vote-buttons
.icon.button.button_icon.button_icon_sync::after
.message.message_yellow.message_replace
.placeholder
.button.header-button.button_icon.button_icon_clear2::after
#shareCopyLink::after

================================

translate.yandex.*/collections

INVERT
.button.header-button.button_icon.button_icon_clear2::after
.record-line_speaker.button.button_icon.button_icon_speaker::after
.button.button_icon.button_icon_lines::after
.button.button_icon.button_icon_trash::after
#shareCollectionCopy::after

================================

translate.yandex.*/doc

INVERT
.button.button_tab.state-selected::before
.listbox-option::after

================================

translate.yandex.*/ocr

INVERT
.button.button_tab.state-selected::before
.button.button_icon.button_icon_swap::after
.button.button_icon.button_icon_plus::after
.button.button_icon.button_icon_minus::after
.button.button_icon.button_icon_lines::after
.button.button_icon.button_icon_words::after
.button button_icon.button_icon_blocks::after
.button.button_icon.button_icon_blocks::after
.button.button_icon.button_icon_reset::after

================================

translate.yandex.*/translate

INVERT
.button.button_tab.state-selected::before
#shareButton::after
.listbox-option::after
#shareCopyLink::after

================================

translifeline.org

INVERT
nav > ul > li > a > span > svg

================================

transport.orgp.spb.ru

INVERT
#map

================================

transum.org

INVERT
img[src*="Level"]

================================

trello.com

CSS
.checklist-item-checkbox {
    background-color: #2f3234 !important;
}

================================

trendmicro.com

INVERT
.logo

================================

trezor.io

INVERT
.hero-image

================================

tribunemag.co.uk

INVERT
.si-hr-nv__toggle--menu
.si-hr-sm__item

================================

trip101.com

INVERT
.logo
.name
.partner-logo
img.partner-img

================================

tripadvisor.com
tripadvisor.com.tw
*.tripadvisor.com

INVERT
img[alt="Tripadvisor"]

================================

trojmiasto.pl

INVERT
img[alt*="Trojmiasto.pl"]

================================

truestory.pl

INVERT
.tdb-logo-img

================================

truity.com

INVERT
.navbar-btn.logo
.footer-logo.logo

================================

tug.org/FontCatalogue

INVERT
img

================================

turbolab.it

CSS
body,
.main-header,
footer {
    background-blend-mode: multiply !important;
    background-color: ${rgba(255,255,255,0.5)} !important;
}

================================

tutorialspoint.com

INVERT
i.fa
i.fab
i.fal
img.tp-logo
button.slick-prev.slick-arrow::before
button.slick-next.slick-arrow::before

================================

tuwroclaw.com

INVERT
.navigation i[class^="ico"]
.portal-logo
.partners a img
.hamburger-wrapper
img[src*="gfx/ico"]

================================

tuxcare.com

INVERT
.navbar__logo

================================

tuxedocomputers.com

INVERT
#logo

================================

tv.yandex.*

INVERT
.icon_location::after
.icon_location::before
.button_arrow_down::after

IGNORE IMAGE ANALYSIS
.icon_location::after
.icon_location::before
.button_arrow_down::after

================================

tvland.com

CSS
body,
.header-container {
    background-color: var(--darkreader-neutral-background) !important;
}

================================

tvn24.pl

INVERT
.header-menu__more-button
.hamburger-icon
.hamburger__button::before
.account-standard__toggle-button-wrapper::before
.header-menu-go__wrapper--desktop::before

CSS
svg path[d^="M23.8898"],
svg path[d^="M22.9767"],
svg path[d^="M7.66678"] {
    fill: #111 !important;
}

================================

tvp.info

INVERT
.nav__logo
.icon-youtube

================================

tvrain.ru

INVERT
.menu3__logo

================================

tvtropes.org

INVERT
body.darthWiki > i
body.wmgWiki > i
.spi.darthwiki
.spi.sugarwiki
.spi.film
.spi.headscratchers
.spi.laconic-icon
.spi.lightnovel
.spi.manga
.spi.nightmarefuel
.spi.radar
.spi.recap
.spi.shoutout
.spi.webcomic
.spi.wmg
.spi.ymmv
img[src="/img/loading-alt.gif"]

IGNORE IMAGE ANALYSIS
body.sugarWiki #header-spacer-left::after
body.sugarWiki #header-spacer-right::after

================================

tweakers.net
*.tweakers.net

INVERT
.infoBox > .title::before
#userbar li.icon.selected > a

CSS
#logo a {
    background: url("https://tweakers.net/g/if/v3/framework/tweakers_logo_full.svg") no-repeat center !important;
}
@media screen and (max-width: 1000px) {
    #logo a {
        background: url("https://tweakers.net/g/if/v3/framework/menu_icons_responsive_v6.png") no-repeat -8px -220px !important;
    }
}
.ankeiler > a.commentCount {
    background-image: url("https://tweakers.net/g/icons/commentcounter_small_bg.svg") !important;
    text-decoration: none !important;
}
#userbar li.icon a {
    background-image: url("https://tweakers.net/g/if/v3/framework/menu_icons_v2.png") !important;
}
#userbar li.icon.flag.nl::after {
    background-color: #fff !important;
    border-bottom-color: #014a93 !important;
    border-top-color: #e7184c !important;
}
#userbar li.icon.flag.be::after {
    background-color: #ffff1a !important;
    border-left-color: #000 !important;
    border-right-color: #e7184c !important;
}
.thumb.category {
    border: none !important;
}
.ctaButton.play::after {
    background-color: #FFF !important;
}
.relatedContentContainer .relatedContentItems .itemContainer {
    border-bottom-color: ${#d9d9d9} !important;
    border-top-color: ${#d9d9d9} !important;
}
#categoryBrowser li a {
    background-color: initial !important;
    background-image: none !important;
}
#categoryBrowser li.more {
    background-image: url("https://tweakers.net/g/if/categories/arrows.png") !important;
}
#categoryBrowser li.more:not(li.active.more) {
    background-position-y: -17px !important;
}
#categoryBrowser li.more.active {
    background-image: url("https://tweakers.net/g/if/categories/arrows.png"), linear-gradient(rgb(131, 24, 46), rgb(148, 15, 49)) !important;
}
#tracker .fakeTop .toggleVisibility .corner::before,
#tracker .fakeTop .toggleVisibility .corner::after {
    border-color: ${#ccc} !important;
}
@media screen and (max-width: 767px) {
    #userbar li.icon a {
        background-image: url("https://tweakers.net/g/if/v3/framework/menu_icons_responsive_v6.png") !important;
    }
    #categoryBrowser li.more.active {
        background-image: none !important;
        box-shadow: none !important;
    }
}
#contentArea,
#categoryBrowser,
#categoryBrowser .sublist,
#categoryBrowser .mainlist,
#categoryBrowser ul,
#categoryBrowser li {
    border-color: ${#b2b9bd} !important;
}

IGNORE IMAGE ANALYSIS
#categoryBrowser li a
table.highlights .title a.showMoreItems

================================

twistedvoxel.com

INVERT
.penci-logo
.penci-limg
.penci-menuhbg-inner

================================

twit.tv

INVERT
.logo-large

================================

twitch.tv
*.ext-twitch.tv

INVERT
.volume-slider__slider-container
.seekbar-bar
.mention-fragment--recipient
.reply-line--mentioned
.claimable-bonus__icon

CSS
.seekbar-segment {
    background-color: rgb(169, 112, 255) !important;
}
html,
iframe {
    color-scheme: unset !important;
}

================================

twitter.com

INVERT
[role="slider"]
[style^="flex-grow"]

CSS
main,
header {
    background-color: var(--darkreader-neutral-background) !important;
}

================================

twosigma.com

INVERT
.homepage-video-desktop video
.homepage-video-desktop img

================================

tygodnikkrag.pl

INVERT
#header-logo-image

================================

typescriptlang.org

CSS
.dark-theme .markdown pre {
    filter: none !important;
}
:root {
    --darkreader-bg--raised-background-color: #1c1f21 !important;
}

================================

typst.app
staging.typst.app

INVERT
img[src$=".svg"]:not([alt="Typst"])

CSS
svg {
    filter: none !important;
}
[class*="_project_"] [class*="_page_"]:not([class*="_new_"])::after {
    background: #fff4;
}
[class*="_themeSwatch_"][class*="_light_"],
[class*="_themeSwatch_"][class*="_system_"]:not([class*="_systemSecond_"]) {
    background: #eff0f3;
    color: #19181f;
}
[class*="_themeSwatch_"][class*="_light_"] [class*="_tSheet_"],
[class*="_themeSwatch_"][class*="_system_"]:not([class*="_systemSecond_"]) [class*="_tSheet_"] {
    background: #fdfdfd;
}

================================

typst.app/universe
staging.typst.app/universe

INVERT
img[src$=".svg"]:not([alt="Typst"])
#results li
#results .title
#results .description
#results .template-thumbnail
#template-thumbnail
#banner
#banner .title
#banner .description
#banner .featured-label
#banner .featured-label .icon
.carousel
.carousel .top-text
.carousel .title
.carousel .bottom-text
#categories ul li a

CSS
#results li a,
#banner {
    border: 1px solid !important;
    border-color: lightgray !important;
}

================================

ubank.com.au

CSS
.sp-envelope-item {
    background-color: var(--darkreader-neutral-background) !important;
}

================================

ubereats.com

INVERT
img[alt*='Home']
div[class^='c5'] .gm-style
#main-content > h1 + div
#wrapper > div:nth-of-type(2)
#wrapper > div:nth-of-type(2) > header
#wrapper > div:nth-of-type(2) > footer
#wrapper > div:nth-of-type(2) > #main-content > div:first-child

================================

ubisoft.com

INVERT
.menu span

CSS
global-navigation,
.menu {
    background-color: var(--darkreader-neutral-background) !important;
}

================================

ubuntu.com

INVERT
.cls-2
.global-nav__header-logo-anchor

CSS
header[style$="image-background-paper.png);"] {
    background-image: none !important;
}
.chart-key text {
    fill: var(--darkreader-neutral-text) !important;
}

IGNORE INLINE STYLE
g#ubuntu-logo > path

================================

ubuntubudgie.org

INVERT
.custom-logo

================================

udemy.com

IGNORE INLINE STYLE
[data-purpose="star-rating-mask"] > rect

================================

ultimate-guitar.com

INVERT
form[action$="/search.php"] > button
form[action$="/search.php"] > button:not(:hover) > span
canvas[style^="height: 72px; width: 84px;"]
canvas[style^="height: 42px; width: 141px;"]

================================

um.edu.mt
*.um.edu.mt

INVERT
.logo img

CSS
body {
    background-image: none !important;
}

================================

umweltinstitut.org

CSS
.streifenBg {
    background-image: none !important;
}

================================

un.org

INVERT
a.logo[title="United Nations"]
img[src*="UN-text-EN.svg"]

================================

understandingwar.org

CSS
#edit-search-block-form--2,
#nice-menu-1 > li > a {
    color: var(--darkreader-neutral-background) !important;
    text-shadow: none !important;
}
#mainwrap,
.secondarybox,
.content,
.view-filters {
    background-image: none !important;
}
img[src*="ISW\%20LOGO"],
img[src*="ISW\%20Logo"] {
    background-color: white !important;
}
body {
    background-blend-mode: multiply !important;
}

IGNORE IMAGE ANALYSIS
*

================================

unimtx.com

INVERT
.navbar-brand

================================

unipoll.uni-obuda.hu

CSS
textarea {
    background: var(--darkreader-neutral-background) !important;
}

================================

unsplash.com

CSS
li > a[aria-current="page"] {
    box-shadow: ${rgb(25,25,25)} 0px -2px inset;
}

================================

uokik.gov.pl

INVERT
.a-press-office
.abgLong
h1[id="logo"]
p a
p.nav img
span[class="number"]
ul[class="tabs"]

CSS
#subpage,
.sWrapper1,
.sWrapper2,
.tabs,
body#page,
div#right,
div#top,
div.fWrapper,
div[class="b1"],
h2#here {
    background-image: none !important;
}
#footer .active {
    color: #000000 !important;
}

================================

uol.com.br

CSS
.text a {
    text-decoration: underline;
}

================================

ups.com

CSS
#ups-alertsWrap,
#ups-skipNav {
    background: ${#FE9} !important;
}

================================

uptimerobot.com

INVERT
.normal-logo
.socialWrapper > ul > li
.feature-icon
[src$="godaddy-logo.svg"]
[src$="moodys-logo.svg"]
[src$="ibm-logo.svg"]
[src$="expedia-logo.svg"]
[src$="creditcards.svg"]

CSS
.page-head,
.sidebar {
    background-image: none !important;
}

================================

upwork.com

CSS
.profile-completeness-nudges-tiles-alternative .carousel-wrapper .up-icon svg {
    filter: drop-shadow(0 0 0px var(--white)) drop-shadow(0 0 0px var(--white));
}
.up-skill-container .up-btn.up-btn-next::before,
.up-skill-container .up-btn.up-btn-prev::before {
    opacity: 0 !important;
}
.up-tab-scroll-hint::after {
    background: none !important;
}
.up-d-skeleton {
    background-color: var(--darkreader-bg--skeleton-color) !important;
    background-image: linear-gradient(90deg, var(--darkreader-bg--skeleton-color), #24242400, var(--darkreader-bg--skeleton-color)) !important;
    color: transparent !important;
}

================================

urbandecay.com

IGNORE INLINE STYLE
.c-select__icon
.c-swatch

================================

urbandictionary.com

INVERT
a.block.flex

================================

urbint.com

IGNORE INLINE STYLE
.site-header__logo svg *

================================

urpredditodicittadinanza.lavoro.gov.it

CSS
:root {
    --lwc-colorContentAreaBackground: transparent !important;
}

================================

usbank.com

INVERT
.logo

================================

userstyles.world

INVERT
nav .menu-icon .i

================================

usosweb.*.edu.pl
usosweb.*.pl
usosweb.*.*.pl
usos.*.*.pl
web.usos.*.edu.pl

INVERT
.icons-fontcolor
.schedimg
.rejestracja-ikona
#titlebar > #close:hover
usos-module-link-tile-container > usos-module-link-tile > h2
timetable-entry

CSS
:root {
    --background: var(--darkreader-bg--background) !important;
    --background-secondary: var(--darkreader-bg--background-secondary) !important;
    --font-color: var(--darkreader-neutral-text) !important;
}
#page-body {
    background-color: var(--darkreader-bg--background) !important;
}
usos-module-link-tile:hover {
    background-color: var(--darkreader-border--border) !important;
}
#close:hover {
    background-color: var(--darkreader-text--on-primary) !important;
}
#close:focus {
    background-color: #888 !important;
}
#layoutCopyright {
    color: var(--darkreader-neutral-text) !important;
}
div > #icon {
    background: rgb(94, 136, 213) !important;
}
timetable-day {
    background-color: var(--darkreader-neutral-background) !important;
}
timetable-entry {
    color: #111 !important;
}
#titlebar {
    background-color: var(--darkreader-neutral-background) !important;
    color: var(--darkreader-neutral-text) !important;
}
body {
    background: ${#d8d8d8} !important;
}

================================

uspassporthelpguide.com

CSS
body {
    background: none !important;
}

================================

usps.com

INVERT
img[src$="hamburger.svg"]
img[src$="search.svg"]
.nav-utility > .utility-links > .lang-select > #link-lang:before
.nav-utility > .utility-links > #link-customer:before
.nav-utility > .utility-links > #link-locator:before
.nav-utility > .utility-links > #link-myusps:before
ul.nav-list > li.menuheader::after
ul.nav-list > li.qt-nav > div > ul > li > a > img
#usps-logo

CSS
.jumbotron.premium.track-opt p a {
    border: 1px solid var(--darkreader-text-ffffff) !important;
}

================================

utas.hu

INVERT
.mapboxgl-map

================================

uteka.ru

INVERT
img[src$="/static/img/logo.svg?v=12"]
ymaps[class$="ground-pane"]

================================

v.qq.com

INVERT
.page_user_center .link_logo

================================

v2ex.com

CSS
#Wrapper {
    background-image: none !important;
}

================================

vaccines.gov
vacunas.gov

INVERT
.accIcon
.Button
img[src$="/images/bch-logo.svg"]
img[src$="/images/en-US/wcdt.svg"]
img[src$="/images/es-US/wcdt.svg"]
img[src$="/images/hhs-logo.svg"]

================================

vaccines.procon.org

INVERT
#right-sidebar > aside.widget_media_image > a > img

================================

valgrind.org

CSS
p {
    color: var(--darkreader-neutral-text) !important;
}

================================

vandale.nl

INVERT
#content-top.form

================================

vanguard.com

INVERT
.vgn-accordionIcon
.vgn-arrow::after
#vgn-searchToggleButtonButton--long-form
#vgn-searchToggleButtonButton--small-form
input[id^="buysellForm:"]
input[id^="HoldingDetailForm:"]

CSS
.hidePageIfJSdisabled {
    display: block !important;
}

================================

vasp.at

INVERT
.mwe-math-fallback-image-inline
.mwe-math-fallback-image-display

IGNORE IMAGE ANALYSIS
.site_logo

================================

vbulletin.com

CSS
.std {
    background-color: var(--darkreader-neutral-background) !important;
}
.hero-text,
#hometext li,
#hometext h4,
#hometext_buttons div p {
    color: var(--darkreader-neutral-background) !important;
}

================================

vc.ru

INVERT
mark

CSS
.main.layout,
#page_wrapper {
    background: var(--darkreader-neutral-background) !important;
}

================================

vcalc.com

INVERT
.navbar-brand > img

CSS
.features-area {
    background-image: none !important;
}

================================

vcb-s.com

CSS
html {
    background-color: transparent !important;
}

================================

vechevoikolokol.ru

INVERT
.map
.main-page-about .img-responsive
.header-menu__mobile .img-responsive

CSS
.main-page-about,
.main-suggestions,
.i-about,
.issues-page__content {
    background: none !important;
}

================================

vectra.pl

INVERT
.bottom-menu-icons div img
.footer-container_info--contact a img
.ga-offer-data img
.html-widget-wrapper a img
.imgContainer img
.logo
.menu-container-level-one a img
.offerBox_links div img
.pionowe-menu img
.singleRegulationLink img
.widgetGroup div div div img
a.homepage img
span.separator img
span.swiper-pagination-bullet
.TvContainerClick img

================================

vendors.paddle.com

INVERT
svg.datamap

CSS
:host(pui-tabs) {
    background-color: var(--darkreader-neutral-background) !important;
    border-bottom: var(--darkreader-neutral-background) !important;
    color: ${black} !important;
}
:host(pui-tabs) ::slotted(button),
:host(pui-tabs) ::slotted(a) {
    background-color: var(--darkreader-neutral-background) !important;
    color: ${black} !important;
}
#line-chart .tick {
    fill: ${black} !important;
}

================================

venture.com/domains

INVERT
ul.nav
div.domain-header-brand-authority

================================

ventusky.com

CSS
.qo {
    color: ${white} !important;
}

================================

vercel.com

INVERT
[alt="optimized-frameworks"]
[class^="features_logo"]
button[class^="header_logo"]

CSS
:root {
    --geist-foreground: var(--darkreader-neutral-text) !important;
}
div[style="background:var(--accents-1);"] {
    background-color: var(--darkreader-neutral-background) !important;
}
.geist-text-center {
    color: ${#333} !important;
}

================================

verstka.media

INVERT
.wp-block-site-logo

================================

versus.com

INVERT
.searchIcon > span > svg
img[src="/img/amazon-logo.png"]
.catGroups > div:not(div:nth-child(14)) > span > svg
hr

CSS
div[class^="RadarChart"] > svg:nth-child(2) > g > g:nth-child(1) > * {
    fill: #181a1b !important;
    stroke: #999 !important;
}
.langList,
div[class*="Sort__selectWrapper"],
div[class*="Filter__filter"] > *:is(div, ul),
div[class*="Property__helpBoxContainer"],
.catGroupsContainer {
    box-shadow: rgb(22 22 22) 0px 4px 10px !important;
}
div > select {
    background-color: #181a1b !important;
    border-radius: .375rem !important;
}
div[class*="Comments__translateButton"] > button {
    border-color: #1c1e1f !important;
}
div[class*="Login__icons"] > button,
div[class*="SuggestionsBox__element"],
div[class*="Comments__translateButton"] > button:hover {
    border-color: rgb(66, 72, 75) !important;
}
div[class*="Search__inputWrapper"]::before {
    background-color: #303436 !important;
}
.navSearch > input {
    border-radius: .375rem !important;
}
.navSearch > input:focus-visible,
div[class*="Search__inputWrapper"] > input:nth-child(1):focus-visible {
    outline: transparent !important;
}
div[class*="Login__illustration"] {
    background-image: url('https://images.versus.io/login_background.png'),linear-gradient(298deg,#7600e0,#3c59fc) !important;
}

IGNORE INLINE STYLE
.catGroups > div > span > svg > defs > style:nth-child(2)

================================

vfsglobal.cn

INVERT
.covid-icon
.logo

================================

vg24.pl

INVERT
img[alt="VG24.PL logo"]

================================

vice.com

INVERT
img[src*="article-logo"]
div.nav-bar__hamburger-button__hamburger
a.page-footer__logo-vice-link

IGNORE INLINE STYLE
.logo-vice *

================================

videogameschronicle.com

CSS
.vgc-layout {
    background-image: none !important;
}

================================

videolan.org

CSS
ul {
    color: var(--darkreader-neutral-text) !important;
}

================================

videoman.gr

INVERT
#logo-custom span
.logo-single

================================

vijaysales.com

INVERT
img[src*=".svg"]

CSS
#vscontainer-c8c1c1c302,
[style*="Background.jpg"] {
    background-image: none !important;
}
.custom-hamburger .bar {
    background-color: var(--darkreader-neutral-text) !important;
}

================================

vimeo.com

INVERT
svg[alt="Vimeo"]
#header-vimeo-logo
footer > div > div > a > svg > path[d^="M89.05 23.658a12.087 12.087"]

================================

vinted.*

INVERT
.web_ui__Icon__icon

================================

virtualbox.org

CSS
body {
    background-image: none !important;
}

================================

virustotal.com

CSS
:root {
    --darkreader-bg--vt-grey-50: ${#eee} !important;
    --darkreader-bg--vt-grey-700: ${#666} !important;
    --vt-white: var(--darkreader-neutral-background) !important;
}
:host(.filled) .chip {
    --vt-ui-chips-color: var(--darkreader-bg--vt-grey-200) !important;
}
.range-wrapper svg {
    --vt-grey-200: var(--darkreader-bg--vt-grey-200) !important;
}
vt-ui-main-footer {
    --darkreader-bg--vt-grey-700: ${#a0a6b4} !important;
    --vt-grey-25: var(--darkreader-bg--vt-grey-200) !important;
}
.logo {
    z-index: 1 !important;
}
:host > a:not(.item),
:host > span {
    border: var(--vt-ui-button-border, 1px solid black) !important;
    color: var(--vt-ui-button-color-text, var(--darkreader-text--vt-grey-800, #e8e6e3)) !important;
}
:host(vt-ui-text-input) {
    border: var(--vt-ui-text-input-border, 1px solid var(--darkreader-border--vt-grey-200)) !important;
}
.detections[clean],
.detections[clean] svg {
    color: var(--vt-green-500) !important;
    fill: var(--vt-green-500) !important;
}
.detections {
    color: var(--vt-red-500) !important;
}
#detections .detection,
#detections {
    --darkreader-border--vt-grey-100: var(--darkreader-border--vt-grey-200) !important;
}
.avatar-section {
    background: var(--darkreader-border--vt-grey-200) !important;
}

IGNORE INLINE STYLE
.circle-progressbar circle

================================

visa.vfsglobal.com

INVERT
.logo-height

================================

vitaexpress.ru

INVERT
ymaps[class$="ground-pane"]
ymaps[class$="default-cluster"] > ymaps

================================

vivaldi.com

INVERT
.hero-cover
.hero-cover p

================================

vivaldi.net

INVERT
#vlogo

================================

vjudge.net

CSS
body {
    background-image: none !important;
}
#contest-rank-table td.accepted {
    background-color: ${#b8ffb8} !important;
}
#contest-rank-table td.prob.fb {
    background-color: ${#c8ffc8} !important;
}

================================

vk.com

CSS
body[scheme="vkcom_dark"] ._im_dialog_unread_ct {
    background: var(--counter_primary_background) !important;
}

================================

vmware.com

INVERT
h1.banner-title
div.banner

================================

vnexpress.net

INVERT
#vibeji-ham span
.sub-cate img
.swiper-pagination-bullet
img[src*="app_ico"]
img[src*="icon-empty-noti"]
img[src*="logo_sawaco"]
.wrap-slide-raovat > .swiper-button-box

CSS
.wrap-titile-area,
.inner-section-video .item-news-common {
    border-color: rgb(55, 60, 62) !important;
}
#myvne_apple_login {
    border-color: rgb(67, 72, 75) !important;
}
.ads > svg {
    background-image: url(https://s1.vnecdn.net/vnexpress/restruct/c/v1990/v2_2019/images/graphics/icon-eclick.svg) !important;
}

IGNORE INLINE STYLE
symbol#letter-E > *

================================

vod.tvp.pl

INVERT
img[alt="serwisy tvp"]

================================

voice.google.com

CSS
.gb_sd.gb_ld {
    background-color: var(--darkreader-neutral-background) !important;
}

================================

voltalbania.org
voltbelgium.org
voltdanmark.org
voltdeutschland.org
voltespana.org
volteuropa.org
voltfrance.org
voltluxembourg.org
voltmalta.org
voltnederland.org
voltoesterreich.org
voltportugal.org
voltromania.org
voltslovensko.org
voltsverige.org
voltswitzerland.org

CSS
.hidden.lg\:block:not(.w-full):not(.absolute):not(.group):not(.theme-icon):not(.mx-3) {
    display: none;
}

================================

vonatinfo.mav-start.hu

CSS
#right_panel,
#legend_panel {
    background: none !important;
    background-color: var(--darkreader-neutral-background) !important;
}

================================

vote.gov

INVERT
.usa-logo path[d^="M44.6,"]
.usa-logo path[d^="M44.9,"]
.usa-menu-btn::after
.usa-nav__close::after
.usa-nav__primary-item .usa-nav__link span::after
.usa-nav__primary-item .usa-nav__submenu-item a::after
.vote-theme-options__button--scale::before
.vote-theme-options__button--theme::before

CSS
.vote-hero__image img[src*="/Home-3.jpg?"] {
    clip-path: rect(0 100% 100% 16rem) !important;
    width: calc(41.6666666667% + 15rem) !important;
}
.vote-theme-options {
    border-color: var(--darkreader-neutral-background) !important;
}
.vote-theme-options__button {
    border-inline-start: 0 !important;
}
.vote-theme-options__button:hover {
    --darkreader-border--theme-options-button--border: var(--darkreader-neutral-background) !important;
}

================================

votecompass.mzalendo.com

INVERT
.content_wrapper_2
.content_wrapper_2 > *

================================

vowi.fsinf.at

INVERT
.mwe-math-fallback-image-inline
.mwe-math-fallback-image-display

================================

vox.com

INVERT
.c-app-nav__logo
.c-footer__logo-link

================================

vpilot.rosscarlson.dev

CSS
td:not(td[background="/Assets/Images/header.jpg"]) {
    background: none;
}
img[width="1"] {
    opacity: 0.01;
}

================================

vpn.getadblock.com

CSS
body {
    background-image: none !important;
}

================================

vrt.be/vrtnws

INVERT
.vrt-header__logo
.vrt-nav-toggle-btn

================================

vseinstrumenti.ru

CSS
img[data-behavior="cart-product-image"] {
    mix-blend-mode: unset;
}

================================

vshojo.com

CSS
.elementor-section,
.elementor-heading-title {
    background: var(--darkreader-neutral-background) !important;
    color: var(--darkreader-neutral-text) !important;
}

================================

vtimes.io

INVERT
.site-header__logo
.sticky-nav__logo
.article__block__disclaimer__close::after
.article__block__disclaimer__close::before

================================

vultr.com

CSS
.svg-banner-shape {
    fill: var(--darkreader-neutral-background) !important;
}

IGNORE INLINE STYLE
.icon-ui *
.icon-user *
.icon-sm *
.svg-logo *
.svg-illustration *
.svg-product *
.svg-shape *

================================

w.atwiki.jp

CSS
.atwiki-contents-shadow,
.main_wrapper {
    background-color: var(--darkreader-neutral-background) !important;
}
.atwiki-jp-bg2 {
    color: var(--darkreader-neutral-background) !important;
}

================================

w3.org

INVERT
img[alt*="equation" i]

================================

w3champions.com

IGNORE IMAGE ANALYSIS
.race-icon-HUMAN
.race-icon-ORC
.race-icon-NIGHT_ELF
.race-icon-UNDEAD

================================

wacom.com

INVERT
img.full-size-logo
a.logo
div.minicart-wrapper
a.footer-brand

CSS
img,
div.bg-layer,
div.flickity-viewport,
canvas {
    filter: brightness(50%) sepia(40%) !important;
}

================================

wakamaifondue.com

CSS
.upload-button > strong,
.upload-button > span {
    color: ${white} !important;
}

================================

walbrzych24.com

INVERT
a.social-icons__icon img
img.page-header__logo
img.page-footer__img

================================

wallet.myalgo.com

IGNORE INLINE STYLE
.export-qr-code > *

================================

walmart.com

CSS
.intro-banner__container {
    z-index: 0 !important;
}
label.w_cA4b[data-automation-id="pickup-store"] > svg > circle {
    fill: #9ca9cd !important;
}
label[data-automation-id="pickup-store"] > svg > circle {
    fill: #404658 !important;
}

================================

wanikani.com

INVERT
[data-question-type="meaning"]

CSS
.wk-hint,
.wk-hint__title,
.subject-character__meaning {
    text-shadow: None;
}

================================

warframe.com

INVERT
.HeaderNavigationBar-logo

CSS
.wrapper {
    background-image: none !important;
}

================================

warframe.huijiwiki.com

CSS
#wiki-outer-body {
    background-image: none !important;
}

================================

wasd.tv

INVERT
.volume-interaction-area > div
.stream-status-live-badge

================================

washingtonpost.com

INVERT
.hp-masthead
.switch
.switch::after
nav svg[label$='logo']

CSS
.flex * {
    border: none !important;
}
nav[data-qa="secondary-nav"] {
    border-left-color: transparent;
    border-right-color: transparent;
    border-top-color: transparent;
}
span[data-testid="headline"] {
    color: var(--darkreader-neutral-text-color);
}
footer,
div {
    border-left-color: transparent !important;
    border-right-color: transparent !important;
}
div[data-qa="desktop-copyright"] {
    border-bottom-color: transparent !important;
    border-left-color: transparent !important;
    border-right-color: transparent !important;
}
.g-artboard img {
    filter: opacity(0.5) !important;
}

IGNORE INLINE STYLE
.center > svg > path[fill="white"]

================================

wayfarer.nianticlabs.com

INVERT
wf-logo

================================

waze.com

INVERT
.wm-map__leaflet
.leaflet-bottom
.leaflet-popup-content-wrapper

================================

weather.com

INVERT
div[class*="DynamicMap"]
svg[name="arrow-up"]
svg[name="arrow-down"]
text[class*="DonutChart"]

IGNORE INLINE STYLE
[id^="svg-symbol"] *
svg[class*="alerts--"] *
#svg-symbol-sun

================================

weather.com.cn

INVERT
.w_logo
#hourHolder

CSS
.lv1,
.lv2,
.weatherBg01,
.weatherBgAll,
.weatherBgAll01,
.weatherBgAll02,
.weatherBgAll03 {
    background-image: none !important;
}

================================

weather.gov
forecast.weather.gov

INVERT
.header-content > .header-doc
.header-content > .header-nws
#page-header > #header-doc
#page-header > #header-noaa
#page-header > #header-nws

CSS
.center,
.footer,
.footer-legal,
.header,
.header-shadow {
    background: var(--darkreader-neutral-background) !important;
}

================================

web.archive.org

INVERT
.sparkline-canvas
.sparkline-mouse-highlight
.search-toolbar-logo
.ia-wordmark

CSS
.measure {
    z-index: 0 !important;
}

IGNORE IMAGE ANALYSIS
.search-toolbar-logo

================================

web.dev

CSS
.w-aside--gotchas,
.w-aside--key-term {
    color: #b98fff;
}
.w-aside--gotchas::after,
.w-aside--key-term::after {
    background-color: #b98fff;
}

================================

web.fulcrumapp.com

INVERT
.scroll-indicator
.css-x2uwzm
.duplicate
.css-37fxgj svg
a[data-original-title="Edit App"] .icon
a[data-original-title="Import Data"] .icon
a[data-original-title="Export Data"] .icon
a[data-original-title="App Dashboard"] .icon
a[data-original-title="View Records"] .icon
.w14
.css-212r4o
.css-7n901
.css-w98cyk

CSS
.css-1580o8k,
.css-1ew50hl,
.css-zn8522 {
    border-style: solid !important;
    border-width: 1px !important;
}
.css-1ee8v3h,
.css-5mtzen,
.css-16mp2t6,
.css-1o48rld,
.css-cf39a2,
.css-1lkowri,
.css-1gj6av8,
.css-vi0msm,
.icon:is(.edit, .delete),
.css-3o0h5k {
    color: rgb(193, 187, 179) !important;
    fill: rgb(193, 187, 179) !important;
}
.css-13dtodi {
    border-color: rgb(53,58,60) !important;
    border-style: none none solid none !important;
    border-width: 1px !important;
}
.css-1btrp9o:hover,
.css-11bfl1m:hover {
    background-color: rgb(70, 70, 70) !important;
}
.css-1btrp9o:hover span {
    color: rgb(229, 134, 134) !important;
}
.css-1btrp9o[style*="color: rgb(235, 19, 0)"] {
    background-color: rgb(70, 70, 70) !important;
}
.css-1btrp9o[style*="color: rgb(235, 19, 0)"] span {
    color: #ff3d3d !important;
}
.css-1580o8k,
.css-1ew50hl {
    border-style: solid !important;
    border-width: 1px !important;
}
.monaco-editor .cursors-layer .cursor {
    background-color: #aaa !important;
    border-color: #aaa !important;
    color: #fff !important;
}
.monaco-editor .wordHighlightStrong {
    background-color: rgba(0, 73, 114, 0.72) !important;
}
.monaco-editor .selectionHighlight {
    background-color: rgba(173, 214, 255, 0.10) !important;
}
.monaco-editor .view-overlays .current-line {
    border: 2px solid #282828 !important;
}
.rt-td,
.rt-th {
    border-color: rgb(53, 58, 60) !important;
    border-style: none none solid solid !important;
    border-width: 1px !important;
}
mark {
    background-color: rgba(255, 255, 0, 0.5) !important;
}

IGNORE INLINE STYLE
.css-1k0tbw6
.css-13dtodi
.css-6tgf2j

================================

web.microsoftstream.com

INVERT
.vjs-progress-holder
.vjs-volume-bar

================================

web.telegram.org

INVERT
.composer_emoji_tooltip_category
.nano-slider
.divider

CSS
.progress-bar {
    background-color: rgba(255,255,255,.9) !important;
}

================================

web.whatsapp.com

CSS
._akau {
    border: 15px solid white !important;
}
span[data-icon="default-user"] path.primary {
    fill: var(--avatar-placeholder-primary) !important;
}
[data-icon="tail-out"] {
    color: var(--darkreader-bg--outgoing-background) !important;
}
[data-icon="tail-in"] {
    color: var(--darkreader-bg--incoming-background) !important;
}

================================

webaim.org

CSS
body {
    background-image: none !important;
}

================================

webassign.net

INVERT
img

CSS
body {
    color: var(--darkreader-neutral-text);
}
#webAssign {
    background-color: var(--darkreader-neutral-background) !important;
}
#webAssignMain,
#webAssignContent {
    background-color: var(--darkreader-neutral-background) !important;
}
img[alt="seenKey"] {
    background-color: ${black} !important;
    filter: unset !important;
}
#webAssign select {
    background-color: var(--darkreader-neutral-background) !important;
}
.sButton {
    background-image: unset;
}

================================

webbrowsertools.com

CSS
.tile {
    background-color: var(--darkreader-neutral-background);
}

================================

webdav.org

CSS
body {
    background: none !important;
}

================================

webhallen.com

INVERT
span.vote-up
span.vote-down

CSS
.popular-categories-tile li .popular-categories-img {
    background-color: white !important;
}
span.vote {
    color: black !important;
}

================================

webkitgtk.org

CSS
#main_wrapper {
    background-image: none !important;
}

================================

weblate.org

INVERT
h5.list-group-item-heading > svg
img[src="/static/state/lock.svg"]
img[src="/static/state/link.svg"]
img[src="/static/state/source.svg"]
img[src="/static/auth/password.svg"]
img[src="/static/auth/email.svg"]
img[src="/static/auth/github.svg"]
path[d^="M12,4V2A10,10"]
img[src="/static/state/link.svg"]

================================

webmd.com

INVERT
.blogs-webmd-logo-img
.global-nav-logo

================================

webpagetest.org

CSS
.scrollableTable table,
.results-filmstrip-container img,
div:not(.compare_contain_wrap) > div.waterfall-container img,
div.overflow-container > *,
.breakdownFrame_item > div > *,
.experiment_opportunities-resolved ol > *,
.experiments_details_desc > ul li {
    mix-blend-mode: normal !important;
}

================================

webroot.com

INVERT
.logo

================================

webstatus.dev

CSS
.details {
    background-color: var(--darkreader-bg--sl-color-neutral-0) !important;
}
.data-table th {
    background: var(--darkreader-bg--table-header-background) !important;
}

================================

webtoons.com

CSS
.info {
    color: rgb(0,0,0) !important;
}

================================

weddlegame.com

CSS
.bg-sol-yellow {
    --darkreader-bg--tw-bg-opacity: 1;
    background-color: rgb(211 213 76);
}
.bg-sol-green {
    --darkreader-bg--tw-bg-opacity: 1;
    background-color: rgb(78 190 60);
}
.bg-sol-lightGreen {
    --darkreader-bg--tw-bg-opacity: 1;
    background-color: rgb(78 190 60);
}

================================

wegmans.com

INVERT
img[alt="home"]

================================

wego.here.com

INVERT
#map
.route_card_left
.route_tooltip_icon
.btn_directions

================================

weibo.com

INVERT
.CopyRight_aria_1Dnvr
.ProfileHeader_statusCounterLayer_13mzC img
#woo_svg_nav_logo > g > path:nth-child(5)

CSS
#searchapps > div > div[role=navigation] > div.woo-panel-main {
    --darkreader-bg--weibo-top-nav-panel-bgColor: rgb(24, 26, 27);
    --darkreader-border--weibo-top-nav-panel-bd: rgb(52, 56, 58);
}
:root {
    --darkreader-bg--frame-background: var(--darkreader-bg--w-color-light);
    --darkreader-bg--w-b-flat-default-bg: #FFFFFF11;
    --darkreader-bg--w-color-gray-6: #FFFFFF11;
    --darkreader-bg--w-retweet-background: #FFFFFF08;
    --darkreader-border--w-card-border: #FFFFFF00;
    --darkreader-text--weibo-top-nav-line: #FFFFFF19;
}
.Home_split_2r3H7,
.Card_bottomGap_2Xjqi > div > .woo-divider-x,
.ALink_none_1w6rm .woo-divider-main,
.Feed_mar1_E_5ip {
    color: #FFFFFF11;
}
.Nav_panel_YI3-j {
    border-bottom-color: #FFFFFF22 !important;
    border-left: solid !important;
    border-left-color: black !important;
    border-right: solid !important;
    border-right-color: black !important;
    border-top: solid !important;
    border-top-color: black !important;
}
.woo-panel-bottom {
    background-color: #FFFFFF08;
    border: #FFFFFF11, 1px, solid;
}
.Tool_line_GFygz .woo-divider-shadow,
.Aria_box_3ZDlW .woo-divider-shadow {
    color: #FFFFFF19;
}
.Nav_popcon__F1hb .woo-pop-ctrl {
    border-left-color: #FFFFFF11;
}
.Nav_inner_1QCVO {
    background-color: #FFFFFF08;
    border-color: #FFFFFF11 !important;
}
.Feed_normal_12A98,
div > .wbpro-side,
.ALink_none_1w6rm .Card_bottomGap_2Xjqi {
    background-color: #FFFFFF08;
}
.title_wrap_3e__u {
    background-color: #FFFFFF00;
}
.title_titleBox_3bh5X {
    border-bottom-color: #FFFFFF08;
}
.RepostCommentFeed_divider_3xqBq {
    color: #FFFFFF08;
}
.wbpro-scrollbar {
    scrollbar-color: #3a3a3a #FFFFFF11;
}
.Card_wrap_2ibWe .woo-divider-main {
    color: #FFFFFF11;
}
.Card_wrap_2ibWe .woo-divider-main,
.woo-divider-x {
    color: #FFFFFF11 !important;
}
.Viewer_prevList_11Q1N {
    border-top-color: #FFFFFF11;
}
.woo-modal-main {
    border: none;
}
body .wbpro-setup__box .multiselect__tags {
    background-color: #FFFFFF11;
}
.wbpro-setup__box .woo-switch-shadow::after {
    background: #555555;
}
.cardHotSearch_tab_24u_o,
.wbpro-datapicker input,
.IconBox_wrap_W3Oz_ {
    background: #FFFFFF11;
}
.wbpro-side .clf {
    background: #FFFFFF11;
    border-radius: 8px;
}
.card-link_wrap_1ktKS,
.Feed_retweet_JqZJb,
.card-vote_original_2JeMZ {
    background-color: #FFFFFF08;
}
.Bar_mid_2zgCp {
    background-color: #FFFFFF1E;
}
.Detail_detail_3typT>article:first-child {
    background: none;
    border: none;
}
.Side_loading_3FKOe {
    width: 0;
}
.cardHotSearch_tabItem_2GC1B.cardHotSearch_active_24AjL {
    box-shadow: none;
}
.woo-input-wrap {
    background-color: #FFFFFF19;
    border-color: #FFFFFF11;
}
.SearchBar_noDataBox_3DYkR {
    border: #FFFFFF29, solid, 1px;
    border-radius: 8px;
}
.wbpro-layer .woo-panel-main {
    border-left: none;
    border-right: none;
    border-top: none;
}

================================

weightwatchers.com

INVERT
span[class*="NavigationSlice_logo"]

================================

wellandgood.com

INVERT
.nav-trigger
.logo

================================

wellrx.com

INVERT
.logo

================================

welsh-dictionary.ac.uk

CSS
#donateButton {
    background-color: var(--darkreader-neutral-background) !important;
    color: var(--darkreader-neutral-color) !important;
    text-shadow: none !important;
}

================================

wenxuecity.com

INVERT
.logo

================================

wepe.com.cn

INVERT
#u0_img

================================

wesbos.com

CSS
footer > div > div:not(.bottom) {
    background-color: var(--darkreader-neutral-background) !important;
}

================================

westerndigital.com

INVERT
.desktop-brand-logo

================================

westlaw.com
*.westlaw.com
*.*.westlaw.com

CSS
.co_hl.blue,
.highlightBox.blueBox {
    background-color: ${lightblue} !important;
}
.co_hl.purple,
.highlightBox.purpleBox {
    background-color: ${#bd73bd} !important;
}

================================

wetteronline.de

CSS
#searchstring {
    background-color: var(--darkreader-neutral-background) !important;
}

================================

whambam3d.com

INVERT
span.multis-svg
span.svgbg
summary.header__icon
svg.icon-search

CSS
body {
    background-color: var(--darkreader-neutral-background) !important;
}

================================

what-if.xkcd.com

INVERT
.illustration
.archive-image
.logo

================================

whatruns.com

INVERT
img[title="Buffer"]
img[alt*="hatruns"]

================================

whatsapp.com

INVERT
span[data-icon="audio-download"]
.landing-main .invisible-space > span
div.landing-header > span > svg
#wafaq_search_input

CSS
[data-asset-intro-image],
[data-asset-intro-image-light] {
    background-image: url(/img/intro-connection_c98cc75f2aa905314d74375a975d2cf2.jpg) !important;
}
html[dir] .landing-main > :first-child > :nth-child(2) > :first-child {
    border: 16px solid white !important;
}
span[data-icon="tail-in"] {
    color: rgb(30, 36, 39) !important;
}
span[data-icon="tail-out"] {
    color: rgb(4, 57, 51) !important;
}
div#subheader {
    background-image: url(https://static.whatsapp.net/rsrc.php/v1/yQ/r/dPFl9fRFF9u.jpg) !important;
    background-size: 100% !important;
}

IGNORE INLINE STYLE
path[fill="currentColor"]
path[fill="#FFFFFF"]
.landing-main svg path

================================

whitemad.pl

INVERT
#logo
#cb-nav-logo

================================

who.int

INVERT
.background-url-holder > picture > img

================================

whois.arin.net/ui/advanced.jsp

CSS
td,
div#content div#subcontent div.box ul li {
    background-image: none !important;
}

================================

whois.com

INVERT
img[src^="logo.gif"]

================================

wiadomoscihandlowe.pl

INVERT
.dropdown-portal__link
.hamburger__button span
.search__icon

================================

widget.trustpilot.com

INVERT
svg path.tp-logo__text
.tp-stars

IGNORE INLINE STYLE
*

================================

wiemy.to

INVERT
img.site-logo
.content-font__icon
.font-dropdown__item

================================

wiesci24.pl

INVERT
.tdb-logo-img

================================

wiki.facepunch.com

CSS
body {
    background-color: transparent !important;
}
.content {
    background-image: none !important;
}

================================

wiki.mozilla.org

CSS
body {
    background-image: none !important;
}

================================

wiki.teamfortress.com

INVERT
.mw-wiki-logo

CSS
body,
#mw-page-base,
#p-logo,
#content,
#footer {
    background-image: none !important;
}
div.vectorTabs ul li.selected a,
#searchInput::placeholder {
    color: var(--darkreader-neutral-text) !important;
}

================================

wiki.ubuntuusers.de

CSS
table:not([class]),
table[class^="zebra"] {
    background-image: none !important;
}

================================

wiki.unity3d.com

CSS
div#content,
#pt-login,
div.vectorTabs,
div.vectorTabs *,
.portal *,
div.vectorMenu,
div.vectorMenu h5 a,
div#footer,
div#footer * {
    background-image: none !important;
}

================================

wiki.wargaming.net

INVERT
.l-description-img_price
.b-description-img_price

CSS
.b-main {
    background: var(--darkreader-neutral-background) !important;
}

================================

wikimapia.org

INVERT
#map

================================

wikimedia.de
*.wikimedia.de
wikimediastatus.net
*.wikimediastatus.net

INVERT
.logo
.logo-container

================================

wildberries.ru

INVERT
ymaps[class$="ground-pane"]
ymaps[class$="svg-icon-content"] > ymaps

CSS
.popup__close-btn.j-close,
.popup__close-btn.j-btn-close,
.tooltip.tooltip-btn-edit {
    border: 1px solid rgb(59, 64, 66);
}
.popup__close-btn.j-close,
.popup__close-btn.j-btn-close,
.tooltip.tooltip-btn-edit .tooltip__content button {
    color: var(--darkreader-neutral-text);
}
.dropdown-filter__btn {
    color: var(--darkreader-neutral-text);
}
#Item_Text {
    background: #181a1b;
    color: #d1cdc7;
}

================================

willthompson.co.uk

INVERT
body
body > *

================================

windows.php.net

CSS
#content-columns .block,
#page-area .content {
    background-image: none !important;
}
#content-columns .block .corners-top,
#content-columns .block .corners-bottom,
#page-area .content .corners-top,
#page-area .content .corners-bottom {
    filter: invert(91%) !important;
}

IGNORE IMAGE ANALYSIS
#content-columns .block .corners-top
#content-columns .block .corners-bottom
#page-area .content .corners-top
#page-area .content .corners-bottom
#content-columns .block .corners-top span
#content-columns .block .corners-bottom span
#page-area .content .corners-top span
#page-area .content .corners-bottom span
#main-column .innerbox .corners-top
#main-column .innerbox .corners-bottom
#mid-column .innerbox .corners-top
#mid-column .innerbox .corners-bottom
#main-column .innerbox .corners-top span
#main-column .innerbox .corners-bottom span
#mid-column .innerbox .corners-top span
#mid-column .innerbox .corners-bottom span

================================

windscribe.com

CSS
#body_wrap > div.blue-bg.blue-top > div.twinkling-blue {
    background-image: none;
}

================================

winehq.org
*.winehq.org

CSS
.winehq_menu_item .winehq_badge .winehq_badge_inner {
    color: maroon;
}
#whq-logo-glass {
    z-index: 0;
}
div {
    position: relative;
    z-index: 1;
}
body {
    height: auto !important;
}

================================

winzip.com

INVERT
.navbar-brand

================================

wired.co.uk
wired.com

INVERT
body a svg
a[data-testid="Logo"]
.c-nav__open-icon
.c-nav__close-icon
.standard-navigation__logo-image > img

================================

wireshark.org

INVERT
.navbar-brand

================================

wirtualnemedia.pl

INVERT
img[src$="logo-black.gif"]

================================

wmar2news.com

INVERT
.PageLogo-image
.wx-nav > img

================================

wmata.com

CSS
.icon-wmata-logo .path1::before {
    color: #000 !important;
}

IGNORE INLINE STYLE
.goog-te-gadget-simple > span > a > span

================================

womenheart.org

CSS
.et_pb_slider .et_pb_slide_0 {
    background-image: url(https://www.womenheart.org/wp-content/uploads/2024/09/WomenHeart-Communities-1.webp) !important;
}

================================

word-view.officeapps.live.com

INVERT
img.WACPageImg

================================

wordnik.com

INVERT
img[alt="wordnik logo"]
.footer-logo

================================

wordpress.com

INVERT
svg.masterbar__wpcom-wordmark
div.wp-login__footer.wp-login__footer--jetpack > img

CSS
svg.social-icons.social-icons__apple.social-icons--enabled {
    fill: white !important;
}
.stats-card {
    border-color: var(--darkreader-neutral-background) !important;
}
.p2020-sidebar {
    background: var(--darkreader-neutral-background);
    background-image: none !important;
}
.block-editor-rich-text__editable {
    color: var(--darkreader-neutral-text);
}
.block-editor-block-list__layout .block-editor-block-list__block::after {
    box-shadow: none !important;
}

================================

workona.com

INVERT
.style-module--unchecked--208a1

================================

worldcubeassociation.org

CSS
.event-checkbox input[type="checkbox"] + i.cubing-icon,
.event-checkbox input[type="radio"] + i.cubing-icon,
.event-radio input[type="checkbox"] + i.cubing-icon,
.event-radio input[type="radio"] + i.cubing-icon {
    color: rgba(0, 0, 0, 1) !important;
}

IGNORE IMAGE ANALYSIS
.flag-icon-pl
.flag-icon-kr
.flag-icon-fi
.flag-icon-jp
.flag-icon-ru
.flag-icon-si
.flag-icon-co
.flag-icon-lt
.flag-icon-sk
.flag-icon-bg
.flag-icon-ve
.flag-icon-ge
.flag-icon-ec
.flag-icon-pk
.flag-icon-uy
.flag-icon-mg
.flag-icon-pa
.flag-icon-cy
.flag-icon-bh
.flag-icon-mt
.flag-icon-bt
.flag-icon-jm

================================

worldometers.info

INVERT
#coronavirus-cases-log.active .highcharts-background
#coronavirus-deaths-log.active .highcharts-background
#coronavirus-cases-linear.active .highcharts-background
#coronavirus-deaths-linear.active .highcharts-background

================================

worldtimebuddy.com

CSS
body,
.clientarea > :first-child {
    background-image: none !important;
}

================================

wowturkey.com

CSS
body {
    background: none !important;
}
.cevapButton {
    background-image: none !important;
}
span.postdetails span.name a {
    background: transparent !important;
}

IGNORE INLINE STYLE
.cevapButton
span.name a

================================

wprost.pl
*.wprost.pl

INVERT
strong span:not(ul li.bli-tp-default a strong span):not(#header ul li a strong span):not(ul li.bli-cl-red a strong span)
p.l
.section-partners div a img
nav ul li a:not(div.footer-wprost nav ul li a):not(div.header-bar nav ul li a)

================================

wpshout.com

INVERT
a[rel="home"] > img

CSS
.site-title {
    background-color: var(--darkreader-neutral-background) !important;
}

================================

wrestlezone.com

CSS
main,
footer,
body {
    background-color: var(--darkreader-neutral-background) !important;
}

================================

writefreely.org

INVERT
img[src*="writefreely.svg"]
img[src*="icon.svg"]
img[src*="i.snap.as/"]
span

================================

wszystkoconajwazniejsze.pl

CSS
#papier img {
    mix-blend-mode: normal !important;
}

================================

wuffs.org

CSS
.heavyShower {
    background-color: ${#e4b849} !important;
}
.lightShower {
    background-color: ${#ff9} !important;
}
.wday-0,
.wday-6 {
    background: ${#ccc} !important;
}
.wday-0 .mWeekday,
.wday-6 .mWeekday {
    color: ${#000059} !important;
}
select:focus {
    color: var(--darkreader-selection-text) !important;
}

================================

wunderground.com

CSS
.bar-on {
    fill: rgba(0, 0, 0, 0.4) !important;
}

================================

wvpublic.org

INVERT
.Page-header-logo
.chevron

================================

www.123cha.com

INVERT
.logo

================================

www.adjust.com

INVERT
.homepage .a-section:first-child::before

CSS
.a-section.bg-gradient {
    --bg-gradient-end: ${white} !important;
    --bg-gradient-start: var(--darkreader-neutral-background) !important;
}

================================

www.androidauthority.com

INVERT
header > a > svg
header > div > button > svg
footer > div > div > a > svg

CSS
footer {
    background-image: none !important;
}

================================

www.baidu.com

INVERT
.s-ctner-contents .s-loading img
#s_side_wrapper .qrcode-tooltip .qrcode
.float-wrap_giJYT .qrcode_3mmyy
.tang-pass-pop-login .compose-left-container .tang-pass-qrcode .tang-pass-qrcode-imgWrapper img
.op_exactqa_word_how_read
.icon-more_3rjs0
.logo-image_7qphJ
.icon_7FBoR
.footer_3cBPx .open-icon_2jlej
.source_1Vdff .openIcon_19C1c
._ai-ask-back_1hre3_1 ._icon-btn-container_1hre3_135 ._icon_1hre3_117
._ai-ask-back_1hre3_1 ._ai-ask-back-category_1hre3_36 ._category-item-icon_1hre3_102
.praise-wrapper_dsvKk .wrap_DBK48.like_WjauW
.s-weather-wrapper .s-mod-weather .weather-mod .city-wather .show-icon .weather-icon
.living-icon_6Bb3h
._partial-image_zc167_124
.cos-pc .brand-logo_6Lv5s .img-light_7jMUg
.single-card-wrapper_2nlg9 .title-icon_3YCj_
.med-logo_33GA7 span
.title-contanier_RY4Rg .title-icon-row_ktIjk img
.med-logo_5Iirk span
.titlt-prefix-icon_4KdDB
#guaranteePopper.guarantee-pc .popover-content .title .bao-icon-new svg
.exam-tab_1oog6 .exam-title_32Y60 .exam-tit-img_1pVD5
.pc-code-img_11zj5
.privacy-img

CSS
.cos-pc,
:root {
    --cos-color-bg-raised: #000000 !important;
    --darkreader-bg--cos-color-bg: ${#cfcfe9} !important;
    --darkreader-bg--cos-color-bg-dent: ${#d1d1d5} !important;
    --darkreader-bg--cos-color-bg-page: ${#eaeae6} !important;
    --darkreader-bg--cos-color-bg-primary-light: ${#c1c1cf} !important;
    --darkreader-bg--cos-color-bg-raised: ${#c1c1cf} !important;
    --darkreader-bg--cosd-color-bg-primary: #a99af2 !important;
    --darkreader-border--cosd-color-text-primary: #a99af2 !important;
    --darkreader-selection-background: #8ab4f8 !important;
    --darkreader-text--cos-brand-dqa-0: #a99af2 !important;
    --darkreader-text--cos-brand-search-0: #9ac4ff !important;
    --darkreader-text--cos-color-text-link: #8ab4f8 !important;
    --darkreader-text--cos-color-text-primary: #8ab4f8 !important;
    --darkreader-text--cos-dqa-color: #a99af2 !important;
    --darkreader-text--cos-link-color-text-hover: #9ac4ff !important;
    --darkreader-text--cosd-color-text-primary: #a99af2 !important;
}
#head_wrapper #s_lg_img,
#head_wrapper.s-ps-islite #s_lg_img,
.index-logo-src,
index-logo-srcnew {
    display: none !important;
}
.s-p-top .index-logo-aging-tools,
.index-logo-peak {
    display: inline !important;
}
#head_wrapper .s_btn,
.wrapper_new .s_btn_wr .s_btn,
.pftab .pftab_hd .cur .tab-underline {
    background-color: #8ab4f8 !important;
    color: #000000;
}
#head_wrapper #kw,
.wrapper_new .s_ipt_wr {
    border-color: rgb(97 97 97);
}
p.pass-form-logo {
    background-image: url(https://www.baidu.com/img/PCfb_5bf082d29588c07f842ccde3f97243ea.png);
    height: 44.9px;
    margin-left: 20px;
}
.login-type-tab .switch-item.activ::after,
.wrapper_new #s_tab .cur-tab::after,
.s-ctner-menus .s-menu-item-underline,
.indicator-thumb_6Z7pY,
.select_3ZzKD .select-wrapper_17vIt .scroll-wrap_2W76t .scroll-bar_2QbLd,
.nav_3xYGl .tab-li_1-F1N.is-active_2p-0t::after,
.s-skin-layer .choose-page-btn .skin-page-number-btn,
.s-skin-layer .nav-underline,
.definition-item_1CSUm .percentage_5pEV9 .jindu_43UUC .jindu-light_2Z1VG {
    background-color: #8ab4f8 !important;
}
.tang-pass-pop-login-color-blue .pass-button:hover,
.page_2muyV strong,
.c-btn:hover,
.page_2muyV a:hover .page-item_M4MDr,
#page .n:hover,
.new-pmd .c-text-blue，
.btn-primary_2s82F:hover:not([disabled]),
.ask_4pvUb,
.wrapper_new #u .lb,
.new-pmd .c-text-blue,
.sc-tag.sc-caption-new.tag_bxvNe,
.nvl-bookstore-wrap_3AHiL .bookinfo_1k-rc .read-btn_2j2Ar,
.head-container_1ASW4 .head-right_2OyG6 .play-btn_2PbE2,
.active-page-item_wYYY-,
.active-page-item_wYYY-:hover,
.publisher-wrap_x5sK8 .opt-btn_fUCxn,
.wrap_f1met:hover,
.button_1I6J3:hover,
.add-site-ok-btn_3-jRW:hover,
.add-site-ok-btn_3-jRW,
.sc-button.sc-secondary:hover:not([disabled]),
.pag-item_3QXUa.active_3zqTy,
.text-area-box_4e4nT .publish-btn_5BhsJ,
.sc-secondary_4cFZu,
.btn_UbC6G,
.btn_1N-yB:hover,
.calc-oprate_24c8k .calc-key-equal_HothV,
.new-tag_4ozgi .pc-tag_2Nde8,
.tag_377sF,
.soutu-env-new .soutu-layer .soutu-url-btn-new,
.soutu-env-new .soutu-layer .upload-wrap,
.avator-wrap_L2zSM .consulting-btn_dYXy1:hover,
.c-btn-primary,
.offical-tag_1tgnd {
    background-color: #8ab4f8 !important;
    color: #000000 !important;
}
.wrapper_new .iptfocus.s_ipt_wr,
.item__tbGV .dot_30fkr,
#head_wrapper #kw:focus,
.wrapper_new .iptfocus.s_ipt_wr,
.publisher_TpAsB.border_NWmBE:hover,
._operative_shkz3_56,
.wrapper_new .peak-down #u .s-top-img-wrapper,
.wrapper_new.wrapper_s .soutu-env-new .soutu-layer .soutu-url-wrap,
.wrapper_new.wrapper_s .soutu-env-new .soutu-layer #soutu-url-kw,
.s-top-right .s-top-username .s-top-img-wrapper,
.wrapper_new #u .s-top-img-wrapper {
    border-color: #8ab4f8 !important;
}
.a-se-st-single-video-zhanzhang-capsule,
.new-pmd .c-text-blue-border,
.star-wrap_5Zapf .tag_16tnk,
.tag_1vuJL.primary_6QEFO,
.new-pmd .c-gap-right-small,
.cos-color-border-primary-light,
.baozhang-r-tip .opui-honourCard4 .opui-honourCard4-title,
.new-tag_4ozgi .pc-tag_2Nde8 {
    border-color: #8ab4f888 !important;
}
.wrapper_new #form .bdsug-new,
#head_wrapper #form .bdsug-new {
    border-bottom-color: #8ab4f8 !important;
    border-left-color: #8ab4f8 !important;
    border-right-color: #8ab4f8 !important;
}
.tang-pass-pop-login-color-blue .pass-button {
    background-color: ${#dadad4} !important;
    color: #ffffff !important;
}
a {
    color: #8ab4f8;
}
a em,
em {
    color: rgb(255 98 98);
}
a:hover {
    color: #9ac4ff;
}
.opr-toplist1-link_2Ag1v a:hover {
    color: #8ab4f8 !important;
}
.btn-primary_2s82F {
    background-image: none !important;
}
.tag-selected_lD4sS,
.tag-common_8ztfL:not(.tag-selected_lD4sS):hover {
    background-color: ${#cfcfe9} !important;
    color: #8ab4f8 !important;
}
.ask_4pvUb {
    background-color: #a99af2 !important;
    color: #000000 !important;
}
.cos-pc .item-word_2Fvt9:hover,
._ai-ask-back_1hre3_1 ._ai-ask-back-category_1hre3_36 ._category_1hre3_50 ._active_1hre3_110,
._ai-ask-back_1hre3_1 .wd-tag,
._ai-ask-back_1hre3_1 ._icon-btn-container_1hre3_135 ._btn-text_1hre3_190,
.cos-pc .btn-group_4wwGy:hover .exp-icon_1SF8P,
.cos-pc .btn-group_4wwGy:hover .exp-text_4wc20,
.pcStyle_Tm3GW .copy_4xoef:hover,
.pcStyle_Tm3GW .textbox_2W0Tw:hover {
    color: #a99af2 !important;
}
.cu-border._content-border_zc167_4,
.re-box_2CJ9w,
.aladdin_1n6KS,
.cosc-card-shadow,
.pc-container_5bj1N,
.card-shadow_df59z,
.op-ly_ticket_train-main.c-border,
.new-pmd .c-border,
.cu-border._content-border_zc167_4,
.card-pc_flYtA,
.card-pc_Z8Fq0,
.re-box-shadow_1FfgR,
.zuowen-content_2nnxI,
.aladdin_5FSBd,
.cos-pc .songs-content_5ZWPu {
    background-color: ${#eaeae6};
    border: solid, 0px !important;
    border-radius: 16px !important;
}
.cos-pc .is-group_1urbd,
.c-group-wrapper .result-op[id="1"],
.weather-days-wrapper_3LzsB.no-peak_7mtt8 {
    background-color: ${#eaeae6};
    border-top-left-radius: 16px !important;
    border-top-right-radius: 16px !important;
}
.c-group-wrapper .result-op:not(:last-child),
.profession_5Z1LF {
    background-color: ${#eaeae6};
}
.c-group-wrapper .result-op:last-child,
.living_3kOkQ {
    background-color: ${#eaeae6};
    border-bottom-left-radius: 16px !important;
    border-bottom-right-radius: 16px !important;
}
.dqa-markdown_5emil .dqa-code-span {
    background-color: #ffffff0c !important;
    border: #FFFFFF22, solid, 1px !important;
}
.fold_1udxT,
.more_49t85,
.cover-container_1Nem2,
.sc-fold-switch-mask,
.cos-fold-switch-mask,
.more_4JpcZ {
    background-image: linear-gradient(0deg, ${#eaeae6} 0px, ${#eaeae6cc} 30%, ${#eaeae699} 55%, ${#eaeae600} 80%) !important;
}
._vertical-gradient_zc167_197 {
    background-image: linear-gradient(to top, ${#eaeae6}, ${#eaeae600}) !important;
}
.med-wz-desc-wrapper_7tenp {
    background-image: linear-gradient(-90deg, ${#eaeae6} 0px, ${#eaeae6ff} 40%, ${#eaeae600} 100%) !important;
}
.indicator-track_7H9n0,
._sc-divider-horizontal_1rtxp_1::after,
.new-pmd button.c-btn,
.pc-down-pc_1SaAU .pc-down-btn_3ndGY {
    background-color: ${#b0b0bf} !important;
}
.bg_2LxZD,
._tabs-nav-selected_1n2to_52,
.pc_1nx5T .more_Sq0v0 .more-btn_jca8M:hover,
.box-item_6rvVp:hover,
.tabs-wrapper_6xKju .tab_6PkmF.active_1YDbU,
.more_3uhsr .more-btn_iB6t3:hover,
.vote-tab_26NoS ul li.active_76SWb,
.single-card-more-line_336It,
.cos-pc .demo-question_227j3 .demo-list_7oJi2 .demo_4QeQv:hover,
.see-more-wrap_gKBWt .see-more-line_3Q8nJ,
.calc-oprate_24c8k .base-calc_27A59 .calc-key-number_1fqx4,
.head-container_1ASW4 .head-right_2OyG6 .find-lrc-btn_ayH7_,
.inpt_disable_3UETE,
.custdom_input_25IQU,
.time_pop_1-CDl .input_from_1ITZ-,
.inpt_disable_16KeJ,
.exam-tab_1oog6 .select-item_5zPMB,
.tab-wi_2Rp7j,
.pc-query-content-wrapper_9xudv .pc-query-content-box_5dDvI .operate-box_7cLzn .audio-box_2QevP,
.sc-city-header-tab-active,
._ai-ask-back_1hre3_1 ._ai-ask-back-category_1hre3_36 ._category-item_1hre3_74:hover,
#guaranteePopper.guarantee-pc .popover-content .actions .btn:hover {
    background-color: ${#c1c1cf} !important;
}
.content_27h2V,
.rs-link_2DE3Q,
.item_3WKCf,
.wrap_f1met,
._select-entry_9e3yq_48,
.header-btn_68kgy {
    background-color: ${#d4d4df} !important;
}
._tabs-nav_1n2to_4,
.sc-button.sc-sublink,
.sc-button-new.sc-sublink,
.rankWrapPc_1TcEJ,
.content_2YLYk,
.pc_Al2N0 .box-item_4dDrB,
.pc_1nx5T .more_Sq0v0 .more-btn_jca8M,
.box-item_6rvVp,
.pc_1nx5T .list-row_6egLi:hover,
.list-row-detail_GspLu,
.item-selected_3Em1g,
.item-selected_3Em1g .left-circle-bg_4laYb,
.item-selected_3Em1g .right-circle-bg_5w7A6,
.item_2Y7S3:hover,
.more_3uhsr .more-btn_iB6t3,
.op-ly_ticket_train-tabs-nav,
.develop_3ZJsP,
.item_2q0df,
.new-pmd .c-gap-bottom-middle,
.custom-bar_XvJUN .nav-box_3tac9,
.content-list_6tfRu .scard-item_6vzi9 .scard-audio-copy_4I4tP,
.tags_2yHYj,
.tag-item_1yRaQ,
.pag-item_3QXUa,
.tabs-container_2lLWT .c-tabs-nav,
.exam-tab_1oog6,
.fy-star-box_2Bckj .words-record_5zVy0,
.orginal_38HZ2 .orginal-bg_5BENF,
.pc-result-content-box_3u7bx .operate-wrapper_1jO4y,
.select_3ZzKD,
.footer-king-container_1EeMH .king-touch-wrapper_3qk1I .king-item_3qDSp,
.sc-city-header-city-search,
.race-item_1u-Bl:hover,
.rank-list_1Oklt:hover,
.c-song-item_66iAf:hover,
.new-pmd .c-gap-right-large,
#guaranteePopper.guarantee-pc .popover-content .actions .btn,
.button-wrapper_1q1Ke.button-theme_6xA8r {
    background-color: ${#cfcfe9} !important;
}
.button_sx9Ei:hover {
    background-color: ${#b7b7bf} !important;
    color: #8ab4f8 !important;
}
.item_3WKCf:hover,
.rs-link_2DE3Q:hover,
.single-card-more_2npN-:hover,
.btn_1N-yB,
.see-more-wrap_gKBWt:hover,
.see-more-wrap_gKBWt:hover .see-more-content_2Bljh,
.sc-button.sc-sublink:hover,
.sc-button-new.sc-sublink:hover,
.custom-bar_XvJUN .nav-box_3tac9 .nav-item-checked_2-wma,
.tags_2yHYj:hover:not(.touch_2GI_H),
.tag-container_ksKXH .tag-selected_1iG7R,
._more_w7nnv_23:hover,
.pag-item_3QXUa:hover,
.button_sx9Ei,
.sc-city-content-city-item-text:hover,
.sc-city-header-search-word:hover,
.sc-button,
.sc-button-new,
.tag-item_UHf7p:hover {
    background-color: ${#c1c1cf} !important;
    color: #8ab4f8 !important;
}
.nvl-bookstore-wrap_3AHiL .bookinfo_1k-rc .read-btn_2j2Ar:hover,
.zk-header_39T7V .line_26Rhs,
.sc-city-content-active-nav::before {
    background-color: #8ab4f8 !important;
}
.select_3ZzKD .select-wrapper_17vIt .select-board_2vss_ .select-scroll_3h0Ij .select-color_7Q5Mg,
.title_1WDM0 .text-wrap_PR4ro:hover .icon-title_rJo3i,
.tool_3HMbZ:hover,
#user .username:hover,
.a-se-st-single-video-zhanzhang-capsule,
.opr-toplist1-title_2gF7E:hover .icon-title_1swfn,
.opr-toplist1-title_2gF7E:hover .icon-right_2arJu,
.opr-toplist1-update_39A0r .toplist-refresh-btn_2ky31:hover,
.opr-toplist1-update_39A0r .toplist-refresh-btn_2ky31:hover .opr-toplist1-hot-refresh-icon_2B5DX,
.new-pmd .c-text-blue-border,
.hovering_1RCgm:hover,
.more-wrap_1ixZo .more-link_PaaxA:hover,
.s-top-left-new .mnav:hover .s-bri,
.s-top-left-new a:hover,
.wrapper_new #u > a:hover,
.s-mod-setweather .setweather-content .lunar-mod .lunar-sevenday,
.s-mod-setweather .setweather-content .lunar-mod .lunar-setting-btn:hover .lunar-settint-text,
.s-weather-wrapper:hover .show-city-name,
.s-weather-wrapper:hover .show-icon-temp,
.s-top-right .s-top-right-text:hover,
.s-top-right .s-top-username:hover .user-name,
.s-top-userset-menu a:hover,
.s-skin-layer .hover-nav4ie6,
.s-skin-layer .skin-nav:hover,
.s-news-item:hover .s-news-item-title,
.hot-news-wrapper .s-rank-title .title-text:hover,
.hot-news-wrapper .s-rank-title .title-text:hover .arrow,
.dustbin:hover,
.nativead-dustbin:hover,
.play-tts:hover,
.pause-tts:hover,
.hot-news-wrapper .s-rank-title .hot-refresh:hover .hot-refresh-text,
.hot-news-wrapper .s-rank-title .hot-refresh:hover .refresh-icon,
.hot-news-wrapper .s-news-rank-content .title-content:hover,
.wrapper_new #u .bdpfmenu a:hover,
.wrapper_new #u .usermenu a:hover,
.star-wrap_5Zapf .tag_16tnk,
.tag_1vuJL.primary_6QEFO,
.fold-btn-text_3r8hd:hover,
.new-pmd .c-select-item:hover,
.new-pmd .c-select-item-selected,
.selectorContainer_5CicL .selectItem_1bUAj:hover,
.select_7oJYi:not(.disable_3yF3S):hover,
.pc_ZVQ8P .tab_6PkmF:hover,
.pc_5QPD0 .box-item_6rvVp:hover .desc_47O7H,
.load_4cwYw:hover .icon_roUEV,
.header-container_Hgukk .right_1NVQT .img_62hlT .img-wrapper_5LRJT,
._paragraph_lzhxo_2.lg:hover,
._load_15s63_25:hover ._icon_15s63_40,
.card_1FDsA .card-title_3mXrq .more-text_3Oa53:hover,
.hot-item_1473U .item-mid_vrw25:hover,
#head_wrapper #form .bdsug-new .bdsug-store-del:hover,
.soutu-env-new .soutu-layer .soutu-close-new:hover,
#head_wrapper #form .bdsug-new > div span:hover,
#head_wrapper #form .bdsug-new > div a:hover,
._selected_9e3yq_14,
._selectItem_9e3yq_23:not(._disabled_9e3yq_19):hover,
._selectItem_9e3yq_23:not(._disabled_9e3yq_19):active,
.header-btn_68kgy:hover,
.load_3HN2V:hover .icon_11Qc4,
.fold-btn-icon_XSMXB,
.c-group-title a:hover,
.c-group-title a:hover > i,
.c-group-title a:hover + i,
.c-group-title a:hover .c-group-arrow-icon,
.exam-tab_1oog6 .select-item_5zPMB,
.tab-wi_2Rp7j .tab-con_7JHHa .tab-con-top_75xiK .tab-con-head_381pW .tab-count_69vPs,
.sc-search-link,
._search-link_ajims_1:hover ._suffix_ajims_14,
.title_1WDM0 .text-wrap_PR4ro:hover .icon-right_38uzr,
.sc-city-content-nav:hover,
.sc-city-header-tab:hover,
.s-hotsearch-wrapper .s-hotsearch-content .title-content:hover,
.s-hotsearch-wrapper .s-hotsearch-title .title-text:hover,
.s-hotsearch-wrapper .s-hotsearch-title .title-text:hover .arrow,
.s-hotsearch-wrapper .s-hotsearch-title .hot-refresh:hover .c-icon,
.s-hotsearch-wrapper .s-hotsearch-title .hot-refresh:hover .hot-refresh-text,
.new-pmd .c-tools-tip-con .c-tip-menu li a:hover,
.baozhang-r-tip .opui-honourCard4 .opui-honourCard4-title,
.baozhang-r-tip .honourCard4-more-info,
.button_sx9Ei .content_7L4g2 {
    color: #8ab4f8 !important;
}
.cos-pc .box_5nmMD:hover {
    background-color: #BBBBFF22 !important;
}
.selected_3I0vG {
    background-color: #2f54ef !important;
}
.festival_8Y6ks,
.button_sx9Ei:hover {
    background-color: rgb(255 100 100 / 8%) !important;
}
.detail-bg_7nBI0 {
    background-image: linear-gradient(${#cfcfe9}, ${#cfcfe900}) !important;
}
.custom-bar_XvJUN .date-type-right_2eYZr,
.around-page-left_OFyr5 {
    background-image: linear-gradient(90deg, ${#cfcfe9}, ${#cfcfe900}) !important;
}
.select-detail_1rVdi .title_6KsjR .line_Gv0I9 {
    background-color: rgba(26, 50, 150, 0.3);
}
.text-area-box_4e4nT .text-area_5EkLk,
.op-ly_ticket_train-tabs-nav-li.op-ly_ticket_train-tabs-nav-selected,
.tabs-content_3ZTqE,
.see-more-wrap_gKBWt .see-more-content_2Bljh,
.op-map_flight-tabs-nav-li.op-map_flight-tabs-nav-selected,
.desc-common_3sbkZ,
.interaction_66WRZ,
.baike-slink-wrapper_7k8vl,
.baike-wrapper_6AORN,
.wrapper_s .fir-margin_2dpDf,
.wrapper_l .fir-margin_2dpDf,
.tabs-container_2lLWT,
.tabs-container_2lLWT .c-tabs-nav .tab-selected_3LAkk,
.new-pmd .c-input input,
.s-mod-setweather,
.s-top-userset-menu,
.s-top-left-new .s-top-more,
.soutu-env-new .soutu-layer .soutu-state-normal,
.soutu-env-new .soutu-layer .soutu-error,
.soutu-env-new .soutu-layer .soutu-waiting,
.soutu-env-new .soutu-layer .soutu-drop-tip,
.pop_over_svvNd,
.pop_over_AuuUs,
.file_type_16eh4 .file_li_2nywH,
.pop_over_ppVmY,
.time_pop_1-CDl .dis_able_A9pol,
.time_pop_1-CDl .time_li_3_ArK,
#wrapper.wrapper_new .bdpfmenu,
#wrapper.wrapper_new .usermenu,
.wrapper_new #u .bdpfmenu a,
.wrapper_new #u .usermenu a,
.c-tip-con,
#content_left .search-source-wrap .search-source-content:hover .search-source-popup,
#guaranteePopper.guarantee-pc .popover-content .popover-inner,
.sc-city-selector-content,
.sc-city-content-content-wrapper,
.sc-city-content-nav-row,
.item-selected_3Em1g .left-circle_77jIg,
.item-selected_3Em1g .right-circle_1eiAS {
    background-color: ${#eaeae6} !important;
}
.wrapper_new #s_tab .s-tab-item:hover::before {
    color: rgb(224 224 224) !important;
}
.wrapper_new #s_tab .s-tab-item::before {
    color: rgb(178 178 178) !important;
}
.demo-question_227j3 .demo-list_7oJi2 .ai-bgprops_2FVDG {
    background-color: rgb(127 114 253 / 9%) !important;
}
.sc-button,
.sc-button-new {
    background-image: none !important;
}
.head-name-sign_3sFI- {
    background-color: rgb(53 164 233);
}
.calc-oprate_24c8k .calc-key-equal_HothV:hover {
    background-color: #9ac4ff !important;
}
.sc-button.sc-sublink,
.sc-button-new.sc-sublink {
    color: rgb(209, 209, 209) !important;
}
.pc_5KjyO .more_3uhsr .more-btn_iB6t3:hover,
.pc_5QPD0 .box-item_6rvVp:hover .text_UWEZE,
.wrapper_new #form .bdsug-new ul li:hover,
.wrapper_new #form .bdsug-new ul li:hover span,
.wrapper_new #form .bdsug-new ul li:hover b,
.sc-search-link:hover,
.sc-search-link:hover .suffix,
.page-btn_1XR1p:hover,
._search-link_ajims_1:hover,
.cos-pc .sc-fold-switch-text:hover,
#container.sam_newgrid .c-showurl-hover,
.detail-btn_2Ar6f:hover .arrow-icon_49DBU {
    color: #9ac4ff !important;
}
.boiling-all_29kBD .boiling-wrapper_fhywn .boiling-contain_3r2Lv .row-left_1OGNu .boiling-right_3Etl4 .boiling-btn_29fbf:hover {
    background-color: ${#c1c1cf} !important;
    color: rgb(255 126 126) !important;
}
.boiling-all_29kBD .boiling-wrapper_fhywn .boiling-contain_3r2Lv .row-left_1OGNu .boiling-right_3Etl4 .boiling-btn_29fbf {
    background-color: ${#cfcfe9} !important;
    color: rgb(255 100 100) !important;
}
.circle_iCmiK .number_2xOZd {
    color: black !important;
}
.soutu-env-new .soutu-layer .soutu-close-new {
    color: #EEEEEE !important;
}
#container.sam_newgrid .result .c-tools .c-icon,
#container.sam_newgrid .result-op .c-tools .c-icon,
#content_left .search-source-wrap .iconfont {
    color: #ffffff40 !important;
}
._feedback-icon_pbmk1_13 {
    fill: #ffffff66 !important;
}
.pause-icon_7omnL,
.orginal_38HZ2 .orginal-bg_5BENF .orginal-slow-au_50ah1 svg {
    color: #8ab4f8 !important;
    fill: #8ab4f8 !important;
}
.new-pmd .c-text-authoritative {
    background-color: rgb(255 165 91 / 20%) !important;
    color: rgb(239, 161, 103) !important;
}
.tab-wi_2Rp7j {
    border-color: ${#cfcfe9} !important;
}
.exam-tab_1oog6 .select-item_5zPMB::before {
    background-image: radial-gradient(circle at left top, rgba(0, 0, 0, 0) 0.09rem, ${#c1c1cf} 0px) !important;
}
.exam-tab_1oog6 .select-item_5zPMB::after {
    background-image: radial-gradient(circle at right top, rgba(0, 0, 0, 0) 0.09rem, ${#c1c1cf} 0px) !important;
}
.sc-city-content-nav-row {
    margin-right: 0px !important;
}

================================

www.bilibili.com

INVERT
.opus-formula-node

CSS
.login-scan-box {
    background: white !important;
}
.bili-mini-content-wp .login_qrcode_tip {
    height: 173px !important;
    left: 0px !important;
    top: 0px !important;
    width: 173px !important;
}
.qrcode {
    background: white !important;
}
body {
    background: var(--darkreader-neutral-background) !important;
}
:root {
    --bg1: var(--darkreader-neutral-background) !important;
    --bg3: var(--darkreader-bg--bg3) !important;
    --brand_blue_thin: var(--darkreader-bg--brand_blue_thin) !important;
    --darkreader-bg--_container-color: rgba(0, 0, 0, 0) !important;
    --graph_bg_thick: var(--darkreader-border--graph_bg_thick) !important;
    --text1: var(--darkreader-neutral-text) important;
}

================================

www.bromite.org

CSS
body,
#container {
    background-image: none !important;
}

================================

www.dcard.tw

CSS
#__next {
    background-color: var(--color-main-dark) !important;
}
.atm_26_6oh0b4.atm_26_6oh0b4 {
    background-color: var(--darkreader-bg--color-ui-background) !important;
}
.atm_leio7s_1647m0t svg {
    fill: var(--darkreader-text--color-text-semi-light) !important;
}
.atm_2d_1nnff6z.atm_2d_1nnff6z {
    background-color: var(--avatar-color) !important;
}

================================

www.ebay.*
www.ebay.*.*

CSS
html,
body {
    background-image: none !important;
}
.ifh-container button.icon-btn > svg {
    fill: ${#191919} !important;
}
.vim.x-breadcrumb {
    border: none !important;
}
:root {
    --color-foreground-primary: ${#191919} !important;
    --color-neutral-7: ${#191919} !important;
}

================================

www.encyclopedia-titanica.org

CSS
body {
    background-color: var(--darkreader-neutral-background) !important;
    background-image: none !important;
}

================================

www.federica.unina.it

INVERT
img.latex

================================

www.flickr.com

IGNORE INLINE STYLE
#icon-flickr_logo_dots path

================================

www.freepascal.org/docs-html

INVERT
img

================================

www.freeriderhd.com

CSS
#game-container {
    background-color: #cdcdcd !important;
}

================================

www.google.*
www.google.*.*

INVERT
.gb_hc
.gb_ec
.gb_x.gb_Vb
.gb_x.gb_Ub
.gb_0b
#dictionary-modules img[src*="png"]
a.gb_b > div
a[href*="about/products"][title]
.JOmIqc
.hLcKi
#EcMbV
#wrap a[href="/mobile/"]
.vk-sf-b
.vk-t-btn
.ChZgtd div::before
.ChZgtd div::after
.yPHXsc div
.mn-dwn-arw
img.act-icon-dark-gray
.YsGUOb
.tays_show_more_answer_button_hide
.tays_show_more_answer_button_show
#tays_add_more_answers_button_hide
#tays_add_more_answers_button
img[src^="https://www.google.com/maps"]
[data-attrid="formula-image"]
[data-attrid^="variable"] img
[src^="/chrome/static/images/thank-you/"]
[src^="/chrome/static/images/reversible/"]
[src="/chrome/static/images/gpay/slate.png"]
[src^="/chrome/static/images/productivity/"]
[src^="/chrome/static/images/features/phone"]
[src^="/chrome/static/images/features/big_phone"]
[src^="/chrome/static/images/be-more-productive/"]
[src^="/chrome/static/images/search-bar/chrome-ui"]
[src="/chrome/static/images/go-mobile/qr-code.png"]
[src^="/chrome/static/images/download-browser/pixel"]
[src^="/chrome/static/images/browser-by-google/pixel"]
[src^="/chrome/static/images/sync-incognito/chrome-ui"]
[src^="/chrome/static/images/download-browser/big_pixel"]
[src="/chrome/static/images/homepage/homepage_tools.png"]
[src="/chrome/static/images/homepage/homepage_privacy.png"]
[src="/chrome/static/images/google-translate/screen-english.png"]
#shield-ok-fill-shield

CSS
.X6JNf,
.appbar,
.sfbg {
    background: var(--darkreader-neutral-background) !important;
}
.RNNXgb,
.aajZCb {
    box-shadow: 0 0 2px 0 ${rgba(0,0,0,0.16)}, 0 0 0 1px ${rgba(0,0,0,0.08)} !important;
}
.Gor6zc {
    background-color: white !important;
}
img[id^="platop"] {
    background-color: white !important;
}
.chr-full-bleed-hero {
    background-image: none !important;
}
html,
body,
img,
[role="img"],
video,
iframe,
#gb,
a[href^="https://shopping.google.com"][href*="/lists"] > span {
    filter: none !important;
}
.REySof {
    color: rgba(255,255,255,0.1) !important;
}
:root {
    --xhUGwc: var(--darkreader-neutral-background) !important;
}

IGNORE INLINE STYLE
.kdPwrb
.rnt3Ze
.NYcQFd
#shield-ok-fill-shield

================================

www.hapo.org

INVERT
.section__overlap[style*="/new-site/background-swoosh.png"]

================================

www.in.gr
*.in.gr

CSS
.inner-main-article a,
.hover-underline,
.hover-underline h3,
a.author,
span.team-name,
span.team-result,
.shopflix-items a.shopflix-link-title {
    color: var(--darkreader-neutral-text) !important;
}
.article_above_footer ::after {
    filter: invert(0.5) !important;
}

================================

www.inu-manga.com

CSS
.bs .bsx .limit .type.Manhwa,
.listupd .utao.styletwo .uta .imgu .type.Manhwa {
    background-image: url("/wp-content/themes/mangareader/assets/images/manhwa.png") !important;
}
.bs .bsx .limit .type.Manga,
.listupd .utao.styletwo .uta .imgu .type.Manga {
    background-image: url("/wp-content/themes/mangareader/assets/images/manga.png") !important;
}

================================

www.iyingdi.com

CSS
.header-area {
    background-image: linear-gradient(
        180deg,
        transparent,
        color-mix(in srgb, var(--darkreader-neutral-background) 30%, transparent) 25%,
        color-mix(in srgb, var(--darkreader-neutral-background) 60%, transparent) 44%,
        color-mix(in srgb, var(--darkreader-neutral-background) 90%, transparent) 69%,
        var(--darkreader-neutral-background)
    ) !important;
}
.header-area .post-title,
.header-area .post-detail-info {
    color: var(--darkreader-neutral-text) !important;
}
.post-main-content {
    background-color: var(--darkreader-neutral-background) !important;
}
.author-info-bar {
    background-color: var(--darkreader-neutral-background) !important;
}
.author-info-bar .user-name,
.author-info-bar .fans-and-follows .count {
    color: rgb(200, 196, 189) !important;
}

================================

www.jetbrains.com

CSS
span,
[class^="_rs-text-2"],
[data-test="main-submenu-column-title"] {
    color: var(--darkreader-neutral-text);
}

IGNORE INLINE STYLE
linearGradient[id*="svg"] > stop
radialGradient[id*="svg"] > stop
svg[class*="logo"]
#__SVG_SPRITE_NODE__ > symbol > path
#__SVG_SPRITE_NODE__ > symbol > g

================================

www.jiqizhixin.com

INVERT
.header__logo

================================

www.khirevich.com

INVERT
.fig > img

================================

www.kleinanzeigen.de

CSS
.Modal--Content,
.UserBadgesModal--Dialog {
    background-color: var(--darkreader-bg--kds-sema-color-surface) !important;
}

================================

www.linuxcollections.com

INVERT
html
body

CSS
body {
    background-image: none !important;
}

================================

www.liqpay.ua

INVERT
div.qrcode > canvas

================================

www.logitech.com

INVERT
.locale-selector-bg

================================

www.mayoclinic.org

INVERT
.mc-logo
.logo > a > img[alt="Mayo Clinic"]
img[src="/-/media/images/mayologo.png"]
img[src="/styles/img/gbs/logo-mayoclinic-mobile.png"]

CSS
ul#nav.nav > li.no-image > a,
ul#nav.nav > li.current > a {
    background-image: url("/UniversalNav/Styles/img/sprite-globalnavarrows.png") !important;
}

================================

www.menti.com

INVERT
div#__next svg[role="img"] > title ~ g
img[src^="https://images.mentimeter.com/themes/832111/tyett7pf-brand-light.svg"]

================================

www.minecraft.net

INVERT
.feature-details img
.ms-accordion .shade
.ms-accordion td.platform-data
.nav-links__tab-icon

CSS
.ms-accordion td.platform-data {
    background-color: white !important;
}
div[style*="background-image: url("][style*="/background-images/bg-wool-white.png"],
.promo-area .bg-wool-light {
    background-image: none !important;
}

IGNORE IMAGE ANALYSIS
.promo-area .trans-top-dark

================================

www.mozilla.org

INVERT
img.sidebar-icon
h1.c-logo
.c-navigation-logo-image
.m24-c-navigation-logo-image

CSS
div.mzp-c-navigation-logo {
    background: ${black} !important;
}

IGNORE IMAGE ANALYSIS
.c-logo.t-browser-word-hor-white-xs
.c-logo.t-browser-word-hor-xs
.noodle-browser

================================

www.msn.cn

CSS
.heading span,
msft-attribution span {
    color: var(--darkreader-neutral-background) !important;
}
.heading + .abstract {
    color: ${rgb(247, 244, 241)} !important;
}

IGNORE INLINE STYLE
.article
msft-ad-label

================================

www.oschina.net

INVERT
.logo > svg > g > path

================================

www.phoronix.com

INVERT
img[type="image/svg+xml"]

================================

www.photopea.com

CSS
.block .panelhead div .cross {
    background-image: var(--icon_cross);
}
.window .whead .cross {
    background-image: var(--icon_cross);
}
[data-darkreader-inline-fill] {
    fill: ${white} !important;
}
* {
    border-color: var(--darkreader-bg--bg-panel) !important;
}

================================

www.physics.utoronto.ca/~aephraim/aephraim.html

CSS
body {
    --darkreader-inline-bgcolor: var(--darkreader-neutral-background) !important;
}

================================

www.pixivision.net

INVERT
.hdc__logo
.ghdsp__logo
.sidebar-visible-button
._search-field-visible-button

================================

www.pravda.com.ua

INVERT
div.war_img > img
div.footer_social_wrapper > a > img
div.interfax > a > img
div.footer_contacts > div.footer_img > img
div.main_logo > a.main_logo_link > svg
div.post_social > a > img
div.post_statistic > div.post_views > img
span.icon-menu

================================

www.psytec.co.jp

INVERT
[background$="images/square.gif"]
[background$="images/square.gif"] > *
td[background*="images/sep_b"]

================================

www.qr-code-generator.com

IGNORE INLINE STYLE
qrcg-generator-qr-code *

================================

www.qt.io

CSS
.b-background__wrapper .b-background__asset[style^="background-image"] {
    filter: brightness(50%) sepia(40%) !important;
}
div[class*="frontpage"] .scheme--default p {
    color: var(--darkreader-neutral-text) !important;
}

================================

www.rbc.ua

INVERT
.h-inner > .logo

================================

www.realtek.com

CSS
#t3-header,
body > div.t3-wrapper > div > div.section-wrap.bg-wrap1 > div > div > div.custom > div > a {
    background: var(--darkreader-neutral-background) !important;
}
#t3-header > div > div.col-xs-3.visible-xs-block > button.search-toggle,
#t3-header > div > div.col-xs-3.visible-xs-block > button.globe-toggle {
    background-color: inherit !important;
}

================================

www.scien.cx

CSS
body.custom-background {
    background-image: none !important;
}

================================

www.searchenginejournal.com

INVERT
.sej-footer-logo
.sej-mobile-logo
.whitelogo

================================

www.sentienceinstitute.org

CSS
div.parallax-mirror {
    z-index: auto !important;
}

================================

www.soepub.com/discuzx34
www.soepub.net/discuzx34

CSS
.c_l,
.c_r,
.c_yb,
.c_yc,
.c_ycr,
.c_yt {
    background-image: none !important;
}

================================

www.songsterr.com

INVERT
use[href^="#rest"]
use[href^="#dot"]

CSS
#tablature svg text {
    fill: var(--darkreader-neutral-text) !important;
}
#tablature svg path {
    stroke: var(--darkreader-neutral-text) !important;
}
section[role="main"] div[style^="transform"] {
    mix-blend-mode: normal !important;
}

================================

www.sport5.co.il

INVERT
.news-room-placeholder .container-message-in .newsroom-row .newsroom-spitz

================================

www.statshunters.com

INVERT
.logo

CSS
.highcharts-background {
    fill: none !important;
}
.highcharts-text-outline {
    stroke: none !important;
}

================================

www.stern.de

CSS
.page {
    --page-background: var(--darkreader-neutral-background) !important;
}
.slide-navigation {
    background: var(--darkreader-neutral-background) !important;
}

================================

www.storm.mg

INVERT
.footer_logo_img
#logo_img

================================

www.tandfonline.com

INVERT
img.no-mml-formula

================================

www.thisoldhouse.com

INVERT
.c-masthead__main[style^="background-image"]

IGNORE INLINE STYLE
.c-footer__logo-link *

================================

www.thivien.net

CSS
body {
    background-image: none !important;
}

================================

www.tiktok.com

INVERT
.like-container .icon
.logo-link
div[class*="DivSeekBarContainer"]
div[class*="DivVolumeControlCircle"]
div[class*="DivVolumeControlBar"]
div[class*="DivVolumeControlProgress"]
.video-control-container-browser
.volume-control-container-browser
.seek-bar-container
.volume-control-container
svg[class*="StyledLinkLogo"]
svg[class*="SvgPlayIcon"]
#svg-music-note > path

CSS
[data-e2e="like-icon"] svg,
[data-e2e="comment-icon"] svg,
[data-e2e="share-icon"] svg {
    fill: var(--darkreader-neutral-text) !important;
}

================================

www.tinkoff.ru

INVERT
a[title="Tinkoff"]

================================

www.tumblr.com
*.tumblr.com

INVERT
.QnWzN > div
div[role="progressbar"]

CSS
a[data-testid="google-login-button"],
a[data-testid="apple-login-button"] {
    background-color: var(--darkreader-neutral-background) !important;
}
footer[role="contentinfo"] > ul > li > a {
    filter: invert(0%) hue-rotate(180deg) contrast(200%) !important;
}
:root {
    --darkreader-bg--secondary-accent: 31, 32, 34 !important;
    --darkreader-bg--white: 23, 23, 23 !important;
    --darkreader-text--black: 228, 224, 218 !important;
}

================================

www.typingclub.com

CSS
object {
    color-scheme: initial !important;
}

================================

www.vjw.digital.go.jp

INVERT
.logo

CSS
body {
    color: var(--darkreader-neutral-text) !important;
}

================================

www.w3schools.com

IGNORE INLINE STYLE
.colorbox .innerbox

================================

www.webofscience.com

CSS
.hh,
.labl,
mark {
    background-color: gray !important;
    color: var(--darkreader-neutral-text) !important;
}

================================

www.wikihow.com

INVERT
.qa_obscured_answer_overlay :last-child:not(strong *)

================================

www.windy.com

INVERT
.data-table > .forecast-table.progress-bar > canvas

CSS
#plugin-detail {
    text-shadow: rgb(40, 43, 54) 0px 1px 0px !important;
}

================================

www1.flightrising.com

INVERT
#sitewide-effort-details
#sitewide-effort-description
#sitewide-effort-status
#sitewide-effort-current-milestone-title
#sitewide-effort-action
#big-login-form-button
img[src$="button-subtract-35.png"]
img[src$="turn-in-button.png"]
img[src*="effort/banner_overlays"]
img[src$="button_back.png"]
.dragontip div[style^="background-image"]
.dragontip div[style^="background-image"] *
#bbcode-tag-bar
.common-hub-item-button:not([href*="dig-sites"],[href*="database"],[id*="archaeology-muster"])
.common-hub-item-button:not([href*="dig-sites"],[href*="database"],[id*="archaeology-muster"]) .common-hub-item-description
img[src*="edit."]
img[src*="feed."]
#usertab
.tabstat
#namespan
img[src*="down_arrow."]
#energybar
#target
#ltavtr
#element-banner
#statusboxcontext
#status-box-bottom
#lair-action-mode
img[src*="customize"]
img[src*="button-breed."]
img[src*="bond."]
img[src*="switch-familiar"]
img[src*="share"]
img[src*="predict-morphology"]
img[src*="add-35"]
img[src*="edit-bio"]
img[src*="scenic-mode"]
img[src*="pagination-previous."]
img[src*="pagination-next."]
img[src*="add-tabs"]
img[src*="add-slots"]
img[src*="move-to-tab"]
img[src*="move-to-lair"]
img[src*="move-to-den."]
img[src*="exit"]
#dragon-profile-scene[style*="11.jpg"]
#dragon-profile-scene[style*="10.jpg"]
#dragon-profile-scene[style*="9.jpg"]
#dragon-profile-scene[style*="8.jpg"]
#dragon-profile-scene[style*="7.jpg"]
#dragon-profile-scene[style*="6.jpg"]
#dragon-profile-scene[style*="5.jpg"]
#dragon-profile-scene[style*="4.jpg"]
#dragon-profile-scene[style*="3.jpg"]
#dragon-profile-scene[style*="2.jpg"]
#dragon-profile-scene[style*="1.jpg"]
#speech-bubble
#speech-bubble-content
.baldwin-create-instruct
img[src*="baldwincreate."]
img[src*="incubate."]
img[src*="icon_help."]
img[src*="filter"]
img[src*="mode-hoard"]
img[src*="function-vault"]
img[src*="function-ah"]
img[src*="function-sell"]
img[src*="function-convert"]
.hoard-stack-function-toggle-hoard-sell-lock
img[src*="favorite-off"]
img[src*="select-all"]
img[src*="purchase-den"]
.unlock-slots-dialog-button-remaining
#compose
.menu_content
.achievements-nav
.pursuits-nav
.market-actions
#ah-topright-tray
.ah-landing-button
.ah-landing-button p
.ah-search-tab-up
.ah-search-tab-down
img[src*="catalog."]
img[src*="swipptrade."]
#raffle-background
.raffle-winners
img[alt*="Transmute"]
img[alt*="Create New"]
img[src*="dig-sites."]
img[src*="muster-resources."]
.archaeology-dig-site-index-row-image
.archaeology-dig-site-index-row-focus-toggle
img[src*="rugged-work."]
img[src*="precise-work."]
#tradetype
img[src*="attachdragon."]
img[src*="tradedetails."]
.custom-shops-list-item
.custom-shops-list-item-description
.faire-tooltip .header
.faire-tooltip .header h1
#dominance-background-image
img[src*="new_posts."]
#forum-pinglists
#forum-search
#toggle-subscribe
img[src*="icon-alert."]
img[src*="icon-quote."]
.wws-carousel-slide
.wws-carousel-slide-text
.wws-carousel-navigation-previous
.wws-carousel-navigation-next
#toggle_button
#dressing-room-landing-page
img[src*="loadoutfit."]
img[src*="saveoutfit."]
img[src*="importapparel."]
img[src*="clearall."]
#scrybanner > div
#assay-container
#assay-container > div
img[src*="bg_foreseeprogeny."]
img[src*="offspring_preview."]
#load-morphology
#save-morphology
.common-hub-item-button[href*="database"] img
#game-database-search-icon
img[src*="-auction-house."]
img[src*="suggest."]
img[src*="icon-help."]
.btn-restore
#ticker
#ticker > div
#lucky-streak
#lucky-streak > div
#fullscreen
.baldwin-create-instruct
.baldwin-create-instruct > div
.ah-listing-clear-button
.ah-clear-all-btn
.ah-listing-relist-button
div#status-box-mid
div#status-box-mid ol
div#status-box-mid div
.status-row-text img
img[src*="den-slot-unlock."]
.ah-collect-all-btn
img[src*="canceltrade."]
img[src*="newtopic."]
#dragtext
#manntext
#morphtext
img[src*="success_catch."]
.ah-listing-buy-button
#random-dragon
#random-dragon a
#baldwin #plus-button
#divcontrade

CSS
.main:not([style*="familiar/background."],[style*="custom-shop-b"]) {
    background-image: none !important;
}
.swipp-tradebox {
    background-color: var(--darkreader-neutral-background) !important;
}
.lair-supply.lair-supply-meat.common-tooltip {
    background-image: url("/static/layout/icon_meat.png") !important;
}
#trading-post-content {
    background-image: none !important;
}
#crimswap {
    background-image: none !important;
}
#predict-morphology {
    background-image: none !important;
}
#random-dragon {
    color: black !important;
}
.contentcontainer {
    background-color: var(--darkreader-neutral-background) !important;
    background-image: none !important;
}
.scry-image-rear {
    background: url(https://i.imgur.com/1b5mZWZ.png) no-repeat !important;
}
.outfit-image-rear {
    background: url(https://i.imgur.com/FrkDinQ.png) no-repeat !important;
}
img[src*="ss_scavenge."] {
    display: none !important;
}
.itemmeat {
    background-image: url(/static/layout/tooltips/food-meat.png) !important;
}
div#status-box-mid {
    background-image: url(/static/layout/sitestatus_spacer.png) !important;
}
.status-row-text {
    color: black !important;
}
#dragon-profile-likes[data-active="false"] .dragon-profile-likes-icon {
    background-image: url(/static/layout/icon_star_disabled.png) !important;
}
.ah-listing-buy-button {
    background-color: lighten(var(--darkreader-neutral-background), 50%) !important;
}
#baldwin #plus-button {
    background-color: lighten(var(--darkreader-neutral-background), 50%) !important;
}

IGNORE IMAGE ANALYSIS
#gem_pack_1
#gem_pack_1:hover
#gem_pack_2
#gem_pack_2:hover
#gem_pack_3
#gem_pack_3:hover
#ah-topright-buy-button
#ah-topright-sell-button
#usertab
.baldwin-create-instruct
.archaeology-dig-plot-square
.scry-image-rear
.outfit-image-rear
#baldwin-xpbar-fill
.hoard-result-item-use[data-type="baldwin"]::after
.hoard-result-item-use[data-type="den"]::after
#ticker
.itemmeat
li[data-visible="true"] .dr-apparel-visibility
.lair-supply.lair-supply-meat.common-tooltip
.archaeology-supply-pickaxe
.ah-listing-clear-button
.ah-clear-all-btn
#archaeology-muster-resources
.ah-collect-all-btn
.ah-listing-buy-button
#baldwin #plus-button

================================

wx.qq.com
wx2.qq.com

CSS
body {
    background-image: none !important;
}

================================

wxwidgets.org

INVERT
img[src$="header-logo.png"]

================================

wyborcza.pl
wyborcza.biz

INVERT
#wH_username_wrap img
.account-cap--logo
.cap-navigation--back
.cap-vignette--logo-image
.header-cap-holder a img
.nmk_avatar-icon
.partners-list-item
.partners-list-item-text
.podcast-player-control ::after
.podcast-player-time-progress
.return-back img
.wyborcza-logo
a[title="Aplikacja wyborcza.pl"]
img.logo
.button svg
.btn.pull-right.dismiss
.slider_nekrologi p::before
img[src*="WYBORCZA-NEKROLOGI.png"]

================================

wysokieobcasy.pl

INVERT
.vin-img-link-pic.vin-local-img-link-pic

================================

x-kom.pl
*.x-kom.pl

INVERT
a[href="/"] img
a[href="https://x-kom.pl"] img
a[href="https://www.x-kom.pl"] img
a[href="/"] svg
a[href="https://x-kom.pl"] svg
a[href="https://www.x-kom.pl"] svg
div[title*="panel"] svg
img[alt="Menu"]
img[alt*="Logo"]
img[src*="Logo_strefy_marek"]
img[src*="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iM"]
img[src*="data:image/svg+xml;base64,PHN2ZyB4bWxucz0ia"]
.geex a img
a[href="https://geex.x-kom.pl/"] img
img[alt="Geex logotyp"]
div[class*="parts__TabWrapper"] svg
button svg
div[class*="parts__IconContainer"] svg *
div[class*="QRCodeWrapper"] span img
div[class*="BrandWrapper"] a span img
div[class*="Hamburger"] svg
div[class*="TileContainer"] ul li a span svg
div[class*="PriceWrapper"] button
div[class*="LoginMenu"] svg

CSS
[class*="parts__SlideContainer"] picture,
.ePVVIv {
    filter: brightness(0.8);
}

IGNORE INLINE STYLE
div[class*="parts__IconContainer"] svg *

================================

xcite.com

INVERT
li.xc-product-slider-item__actions-bar__express.xcf.xcf--Rocket3-012222
li.xc-product-slider-item__actions-bar__express.xcf.xcf--express-delivery
li.xc-product-slider-item__actions-bar__pickup.xcf.xcf--bag
li.xc-product-slider-item__actions-bar__secret-deal.xcf.xcf--secret-deal
div > a.xc-product-slider-item__name
div.titleFyler > span.weeklyTitle

CSS
div.algolia-instant-results-wrapper {
    background-color: var(--darkreader-neutral-background);
}

================================

xda-developers.com

INVERT
.hb-trigger

CSS
body.tag {
    color: var(--darkreader-neutral-text) !important;
}

================================

xfree86.org

INVERT
img[src*=".png"]

================================

xiph.org

INVERT
img[src$="fish_xiph_org.png"]

================================

y.qq.com

INVERT
.popup_guide__logo
.qqmusic_logo

================================

yadi.sk

INVERT
span.logo.burger-sidebar__logo
span.logo.burger-sidebar__sidebar-logo

================================

yahoo.com

CSS
#atomic .Bg\(\$weatherCardBackground\) {
    background: rgba(var(--rgb-black),.54);
}
body {
    background-color: transparent !important;
}

================================

yamicsoft.com

CSS
.slider-wrapper .slide-secound-detail,
.slider-wrapper .slide-secound-title {
    color: var(--darkreader-neutral-background) !important;
}

================================

yandex.*/internet

INVERT
a[href="/internet"]

================================

yandex.*/maps
yandex.*/web-maps

INVERT
.content-panel-header__logo path[d^="M39.64 22.32"]
.whats-here-preview__control-search-icon
.close-button._color_black._circle
.business-social-links-view__icon
.social-share-view_discovery-small
.social-share-view_discovery-large
.orgpage-social-links-view__icon
.promo-button__promo-image-container
.orgpage-photos-view__empty
.map-container > ymaps > ymaps > canvas

CSS
span[class$="business-reactions-view__icon"],
div[class$="business-reactions-view__counter"],
span[class$="business-reactions-view__icon _dislike"] {
    color: ${#aba8a8} !important;
}

================================

yandex.*/pogoda

INVERT
.maps-widget-nowcast__map-link
.weather-maps__map > ymaps > ymaps > ymaps > ymaps
.color-scale__line
.weather-table__wind-direction > .icon_wind
.icon_color_black

================================

yandex.*/support

INVERT
.header2__logo

================================

yandex.eu/showcaptcha

CSS
.AdvancedCaptcha-SilhouetteTask {
    background-color: teal !important;
}

================================

yandex.ru/blog/narod-karta

INVERT
.y-header_club__logo
.y-header_club__service

================================

yandex.ru/q

INVERT
header a[href="/q/"] svg

================================

yelp.com

INVERT
#logo:not(.homepage-hero_logo)
img[src$="40x40_food_v2.svg"]
.gm-style img[role="presentation"]:not([src*="v="])

================================

yeniakit.com.tr

CSS
.photo-news-detail-cover .article-header > .image {
    z-index: 0 !important;
}
.photo-news-detail-cover .article-header > .black-shadow {
    z-index: 1 !important;
}
.photo-news-detail-cover .article-header > .social-box,
.photo-news-detail-cover .article-header > .category {
    z-index: 2 !important;
}

================================

yettel.rs

INVERT
.header-container

================================

yle.fi

INVERT
[class*="AreenaHeader"]
[class*="TheEndIsDelight__Svg"]

IGNORE IMAGE ANALYSIS
.yle-header figure.yle-header-logo

================================

yougetsignal.com

INVERT
img[src^="img/"]

================================

youla.ru

INVERT
section[data-test-component="HeaderActionMenu"] a > svg > path:nth-child(2n+2)
#map-1 canvas

================================

youmath.it
*.youmath.it

INVERT
.ltximg

================================

youtube.com

INVERT
#tube-mount .b img
#ytd-player + .efyt-control-bar > button

CSS
#search-icon-legacy.ytd-searchbox {
    border: 1px solid var(--ytd-searchbox-legacy-border-color) !important;
}
html:not(.style-scope) {
    --accent-color: ${#ff4081} !important;
    --disabled-text-color: ${#9b9b9b} !important;
    --divider-color: ${#dbdbdb} !important;
    --error-color: ${#dd2c00} !important;
    --primary-background-color: ${#ffffff} !important;
    --primary-color: ${#3f51b5} !important;
    --primary-text-color: ${#212121} !important;
    --yt-alert-background: ${hsla(0, 0%, 93.3%, .4)} !important;
    --yt-app-background: ${hsl(0, 0%, 100%)} !important;
    --yt-border-color: ${hsl(0, 0%, 93.3%)} !important;
    --yt-button-active-color: ${hsl(0, 0%, 6.7%)} !important;
    --yt-channel-header-background: ${hsl(0, 0%, 98%)} !important;
    --yt-chat-bubble-other-background-color: ${#F9F9F9} !important;
    --yt-chat-bubble-other-border-color: ${#CCCCCC} !important;
    --yt-chat-bubble-self-background-color: ${#EDEDED} !important;
    --yt-chat-bubble-self-border-color: ${#CCCCCC} !important;
    --yt-commentbox-border-active: ${hsla(0, 0%, 6.7%, .6)} !important;
    --yt-commentbox-border-inactive: ${hsl(0, 0%, 93.3%)} !important;
    --yt-copyright-text: ${hsla(0, 0%, 6.7%, .6)} !important;
    --yt-dialog-background: ${hsl(0, 0%, 100%)} !important;
    --yt-emoji-picker-search-background-color: ${hsla(0, 0%, 100%, .6)} !important;
    --yt-emoji-picker-search-color: ${hsla(0, 0%, 6.7%, .8)} !important;
    --yt-emoji-picker-search-placeholder-color: ${hsla(0, 0%, 6.7%, .6)} !important;
    --yt-expand-color: ${hsla(0, 0%, 6.7%, .6)} !important;
    --yt-featured-channel-title-text-color: ${hsla(0, 0%, 0%, .54)} !important;
    --yt-formatted-string-deemphasize-color: ${hsl(0, 0%, 53.3%)} !important;
    --yt-guide-background: ${hsl(0, 0%, 96%)} !important;
    --yt-guide-entry-text-color: ${hsla(0, 0%, 6.7%, .8)} !important;
    --yt-hovered-text-color: ${hsla(0, 0%, 6.7%, .8)} !important;
    --yt-icon-active-color: ${hsl(0, 0%, 6.7%)} !important;
    --yt-icon-color: ${hsla(0, 0%, 6.7%, .4)} !important;
    --yt-icon-disabled-color: ${hsla(0, 0%, 6.7%, .6)} !important;
    --yt-icon-hover-color: ${hsla(0, 0%, 6.7%, .8)} !important;
    --yt-item-section-header-color: ${hsla(0, 0%, 6.7%, .6)} !important;
    --yt-live-chat-action-panel-background-color: ${hsla(0, 0%, 93.3%, .4)} !important;
    --yt-live-chat-action-panel-background-color-transparent: ${hsla(0, 0%, 97%, .8)} !important;
    --yt-live-chat-background-color: ${hsl(0, 0%, 100%)} !important;
    --yt-live-chat-disabled-icon-button-color: ${hsla(0, 0%, 6.7%, .2)} !important;
    --yt-live-chat-picker-button-color: ${hsla(0, 0%, 6.7%, .4)} !important;
    --yt-live-chat-primary-text-color: ${hsl(0, 0%, 6.7%)} !important;
    --yt-live-chat-secondary-background-color: ${hsl(0, 0%, 93.3%)} !important;
    --yt-live-chat-secondary-text-color: ${hsla(0, 0%, 6.7%, .6)} !important;
    --yt-live-chat-tertiary-text-color: ${hsla(0, 0%, 6.7%, .4)} !important;
    --yt-live-chat-text-input-field-suggestion-background-color: ${hsl(0, 0%, 100%)} !important;
    --yt-live-chat-text-input-field-suggestion-background-color-hover: ${#eee} !important;
    --yt-live-chat-text-input-field-suggestion-text-color: ${#666} !important;
    --yt-live-chat-text-input-field-suggestion-text-color-hover: ${#333} !important;
    --yt-live-chat-vem-background-color: ${hsl(0, 0, 93.3%)} !important;
    --yt-main-app-background: ${hsl(0, 0%, 98%)} !important;
    --yt-main-app-background-tmp: ${hsl(0, 0%, 100%)} !important;
    --yt-material-searchbox-active: ${hsl(0, 0%, 100%)} !important;
    --yt-material-searchbox-active-shadow: ${hsla(0, 0%, 0%, .26)} !important;
    --yt-material-searchbox-inactive: ${hsla(0, 0%, 93.3%, .6)} !important;
    --yt-material-searchbox-inactive-shadow: ${hsla(0, 0%, 53.3%, .2)} !important;
    --yt-material-searchbox-inset: ${hsla(0, 0%, 0%, .04)} !important;
    --yt-menu-focus-background-color: ${hsla(0, 0%, 6.7%, .2)} !important;
    --yt-menu-hover-backgound-color: ${hsl(0, 0%, 93.3%)} !important;
    --yt-paper-button-ink-color: ${hsl(0, 0%, 53.3%)} !important;
    --yt-placeholder-text: ${hsla(0, 0%, 6.7%, .6)} !important;
    --yt-placeholder-text-color: ${hsla(0, 0%, 6.7%, .6)} !important;
    --yt-playlist-background-header: ${hsl(0, 0%, 93.3%)} !important;
    --yt-playlist-background-item: ${hsla(0, 0%, 93.3%, .6)} !important;
    --yt-playlist-message-text: ${hsla(0, 0%, 6.7%, .6)} !important;
    --yt-playlist-message-text-hover: ${hsl(0, 0%, 6.7%)} !important;
    --yt-playlist-title-text: ${hsl(0, 0%, 6.7%)} !important;
    --yt-primary-color: ${hsl(0, 0%, 6.7%)} !important;
    --yt-primary-disabled-button-text-color: ${hsl(0, 0%, 100%)} !important;
    --yt-primary-text-color: ${hsl(0, 0%, 6.7%)} !important;
    --yt-searchbox-background: ${hsl(0, 0%, 100%)} !important;
    --yt-secondary-text-color: ${hsla(0, 0%, 6.7%, .8)} !important;
    --yt-sidebar-background: ${hsl(0, 0%, 98%)} !important;
    --yt-simple-menu-header-background: ${hsl(0, 0%, 93.3%)} !important;
    --yt-spec-10-percent-layer: ${rgba(0, 0, 0, 0.10)} !important;
    --yt-spec-badge-chip-background: ${rgba(0, 0, 0, 0.05)} !important;
    --yt-spec-brand-background-primary: ${rgba(255, 255, 255, 0.98)} !important;
    --yt-spec-brand-background-secondary: ${rgba(255, 255, 255, 0.95)} !important;
    --yt-spec-brand-background-solid: ${#FFFFFF} !important;
    --yt-spec-brand-icon-active: #{rgb(255, 0, 0)} !important;
    --yt-spec-brand-icon-inactive: ${#606060} !important;
    --yt-spec-brand-subscribe-button-background: ${#FF0000} !important;
    --yt-spec-brand-text-button-focus-outline: ${rgba(204, 0, 0, 0.30)} !important;
    --yt-spec-button-chip-background-hover: ${rgba(0, 0, 0, 0.10)} !important;
    --yt-spec-call-to-action: ${#065FD4} !important;
    --yt-spec-call-to-action-button-focus-outline: ${rgba(6, 95, 212, 0.30)} !important;
    --yt-spec-call-to-action-inverse: ${#3EA6FF} !important;
    --yt-spec-error-background: ${#1F1F1F} !important;
    --yt-spec-feed-background-a: ${#F9F9F9} !important;
    --yt-spec-feed-background-b: ${#F3F3F3} !important;
    --yt-spec-feed-background-c: ${#EDEDED} !important;
    --yt-spec-filled-button-focus-outline: ${rgba(0, 0, 0, 0.60)} !important;
    --yt-spec-filled-button-text: ${#FFFFFF} !important;
    --yt-spec-general-background-a: ${white} !important;
    --yt-spec-general-background-b: ${#f1f1f1} !important;
    --yt-spec-general-background-c: ${#e9e9e9} !important;
    --yt-spec-icon-active-other: ${#606060} !important;
    --yt-spec-icon-disabled: ${#CCCCCC} !important;
    --yt-spec-icon-inactive: ${#909090} !important;
    --yt-spec-inactive-text-button-focus-outline: ${#CCCCCC} !important;
    --yt-spec-selected-nav-text: ${#CC0000} !important;
    --yt-spec-suggested-action: ${#F2F8FF} !important;
    --yt-spec-text-disabled: ${#909090} !important;
    --yt-spec-text-primary: ${#0A0A0A} !important;
    --yt-spec-text-primary-inverse: ${#FFFFFF} !important;
    --yt-spec-text-secondary: ${#606060} !important;
    --yt-spec-themed-blue: ${#065FD4} !important;
    --yt-spec-themed-green: ${#107516} !important;
    --yt-spec-touch-response: ${#000000} !important;
    --yt-spec-wordmark-text: ${#282828} !important;
    --yt-std-body-300: ${hsla(0, 0%, 0%, .54)} !important;
    --yt-std-surface-200: ${hsl(0, 0%, 98%)} !important;
    --yt-std-surface-300: ${hsl(0, 0%, 96%)} !important;
    --yt-std-surface-400: ${hsl(0, 0%, 93%)} !important;
    --yt-swatch-icon-color: ${hsla(0, 0%, 6.7%, .4)} !important;
    --yt-swatch-input-text: ${hsl(0, 0%, 6.7%)} !important;
    --yt-swatch-primary: ${hsl(0, 0%, 100%)} !important;
    --yt-swatch-primary-darker: ${rgb(230, 230, 230)} !important;
    --yt-swatch-text: ${hsla(0, 0%, 6.7%, .4)} !important;
    --yt-swatch-textbox-bg: ${rgb(255, 255, 255)} !important;
    --yt-tertiary-text-color: ${hsla(0, 0%, 6.7%, .6)} !important;
    --yt-thumbnail-placeholder-color: ${hsl(0, 0%, 89%)} !important;
    --yt-transcript-background: ${hsl(0, 0%, 100%)} !important;
    --yt-video-secondary-info-description-background: ${hsla(0, 0%, 93.3%, .6)} !important;
    --ytd-backstage-attachment-background-color: ${hsl(0, 0%, 100%)} !important;
    --ytd-backstage-attachment-icon-hover-color: ${hsla(0, 0%, 0%, .74)} !important;
    --ytd-backstage-cancel-background-color: ${hsl(0, 0%, 100%)} !important;
    --ytd-backstage-cancel-color: ${hsla(0, 0%, 6.7%, .4)} !important;
    --ytd-backstage-creationbox-background-color: ${hsl(0, 0%, 98%)} !important;
    --ytd-backstage-creationbox-background-color-focus: ${hsl(0, 0%, 96%)} !important;
    --ytd-backstage-creationbox-disabled-button-color: ${hsla(0, 0%, 0%, .04)} !important;
    --ytd-backstage-creationbox-disabled-button-text-color: ${hsl(0, 0%, 100%)} !important;
    --ytd-backstage-creationbox-inactive-color: ${hsla(0, 0%, 0%, .26)} !important;
    --ytd-backstage-creationbox-input-text-color: ${hsla(0, 0%, 0%, .87)} !important;
    --ytd-backstage-creationbox-text-color: ${hsla(0, 0%, 0%, .54)} !important;
    --ytd-backstage-image-alert-color: ${hsla(0, 0%, 6.7%, .6)} !important;
    --ytd-backstage-metadata-text-color: ${hsl(0, 0%, 53.3%)} !important;
    --ytd-backstage-video-link-background-color: ${hsla(0, 0%, 93.3%, .4)} !important;
    --ytd-badge-disabled-color: ${hsla(0, 0%, 53.3%, .4)} !important;
    --ytd-collection-badge-color: ${hsla(0, 0%, 6.7%, .8)} !important;
    --ytd-comment-text-color: ${hsl(0, 0%, 6.7%)} !important;
    --ytd-moderation-icon-color: ${hsla(0, 0%, 6.7%, .6)} !important;
    --ytd-moderation-icon-hover-color: ${hsl(0, 0%, 6.7%)} !important;
    --ytd-moderation-panel-background: ${hsla(0, 0%, 93.3%, .6)} !important;
    --ytd-moderation-panel-comment-metadata-text: ${hsla(0, 0%, 6.7%, .6)} !important;
    --ytd-moderation-panel-comment-text: ${hsl(0, 0%, 6.7%)} !important;
    --ytd-moderation-panel-hover: ${hsla(0, 0%, 93.3%, .8)} !important;
    --ytd-offer-background-color: ${hsla(0, 0%, 93.3%, .4)} !important;
    --ytd-owner-badge-color: ${hsla(0, 0%, 6.7%, .4)} !important;
    --ytd-searchbox-border-color: ${hsla(0, 0%, 53.3%, .2)} !important;
    --ytd-searchbox-legacy-border-color: ${#ccc} !important;
    --ytd-searchbox-legacy-border-shadow-color: ${#eee} !important;
    --ytd-searchbox-legacy-button-border-color: ${#d3d3d3} !important;
    --ytd-searchbox-legacy-button-color: ${#f8f8f8} !important;
    --ytd-searchbox-legacy-button-focus-color: ${#e9e9e9} !important;
    --ytd-searchbox-legacy-button-hover-border-color: ${#c6c6c6} !important;
    --ytd-searchbox-legacy-button-hover-color: ${#f0f0f0} !important;
    --ytd-searchbox-legacy-button-icon-color: ${#333} !important;
    --ytd-shopping-product-info: ${hsla(0, 0%, 6.7%, .8)} !important;
    --ytd-simple-badge-color: ${hsla(0, 0%, 6.7%, .6)} !important;
    --ytd-sponsorships-background-color-focus: ${hsla(0, 0%, 93.3%, .4)} !important;
    --ytd-transcript-cue-hover-background-color: ${hsl(0, 0%, 93.3%)} !important;
    --ytd-transcript-toolbar-background-color: ${hsl(0, 0%, 93.3%)} !important;
    --ytd-transcript-toolbar-text: ${hsl(0, 0%, 6.7%)} !important;
    --ytd-vat-notice-text: ${hsla(0, 0%, 6.7%, .6)} !important;
    --ytd-video-game-watch-card-logo-color: ${hsl(0, 0%, 6.7%)} !important;
    --ytd-video-publish-date-color: ${hsla(0, 0%, 6.7%, .6)} !important;
    --ytd-watch-card-album-header-background: ${hsl(0, 0%, 100%)} !important;
    --ytd-watch-card-secondary-text-color: ${hsl(0, 0%, 53.3%)} !important;
    --ytd-watch-split-pane-sidebar-background-color: ${hsl(0, 0%, 98%)} !important;
}
.ytp-hover-progress-light {
    background-color: rgba(255,255,255,.5) !important;
}
.ytp-progress-list {
    background-color: rgba(255,255,255,.2) !important;
}
.ytp-volume-slider-handle {
    background-color: white !important;
}
.ytp-volume-slider-handle::before {
    background-color: white !important;
}
.ytp-volume-slider-handle::after {
    background-color: rgba(255,255,255,.2) !important;
}
button[aria-pressed="true"] > yt-icon:not(#guide-icon.ytd-app):not(#guide-icon.ytd-masthead),
[id$="-replies"].ytd-comment-replies-renderer > .ytd-button-renderer > paper-button,
[id$="-replies"].ytd-comment-replies-renderer > .ytd-button-renderer > paper-button  > yt-icon {
    color: var(--yt-spec-call-to-action) !important;
    fill: var(--yt-spec-call-to-action) !important;
}
.ytp-menuitem-toggle-checkbox {
    background: rgba(255, 255, 255, 0.3) !important;
}
.ytp-menuitem[aria-checked="true"] .ytp-menuitem-toggle-checkbox {
    background: #f00 !important;
}
.ytp-menuitem-toggle-checkbox::after {
    background-color: #bdbdbd !important;
}
.ytp-menuitem[aria-checked="true"] .ytp-menuitem-toggle-checkbox::after {
    background-color: white !important;
}
#date yt-formatted-string.ytd-video-primary-info-renderer,
.yt-view-count-renderer {
    color: var(--yt-spec-text-secondary) !important;
}
.ytp-contextmenu .ytp-menuitem .ytp-menuitem-toggle-checkbox {
    background: none !important;
}
.ytp-contextmenu .ytp-menuitem[aria-checked="true"] .ytp-menuitem-toggle-checkbox {
    background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9 16.2L4.8 12l-1.4 1.4L9 19 21 7l-1.4-1.4L9 16.2z" fill="white"/></svg>') !important;
}
#metadata-line.ytd-video-meta-block span.ytd-video-meta-block {
    color: var(--ytd-metadata-line-color, var(--yt-spec-text-secondary)) !important;
}
yt-formatted-string[has-link-only_]:not([force-default-style]) a.yt-simple-endpoint.yt-formatted-string {
    color: var(--yt-endpoint-color, var(--yt-spec-text-primary)) !important;
}
paper-button.ytd-subscribe-button-renderer[subscribed] {
    background-color: var(--yt-spec-10-percent-layer) !important;
}
.badge-style-type-live-now.ytd-badge-supported-renderer {
    border: 1px solid rgb(255, 78, 69) !important;
}
.ytp-load-progress {
    background: rgba(255,255,255,0.3) !important;
}
yt-chip-cloud-chip-renderer[chip-style="STYLE_DEFAULT"] {
    background-color: rgba(255,255,255,0.05);
}
yt-chip-cloud-chip-renderer[chip-style="STYLE_DEFAULT"].iron-selected {
    background-color: rgba(255,255,255,0.2);
}
paper-item[aria-selected="true"] {
    background-color: rgba(255,255,255,0.2) !important;
}
iron-input.paper-input > input.paper-input,
.input-content.paper-input-container > label,
.input-content.paper-input-container > .paper-input-label {
    color: var(--paper-input-container-shared-input-style_-_color) !important;
}
ytd-compact-autoplay-renderer,
ytd-video-primary-info-renderer,
#sections.ytd-guide-renderer > .ytd-guide-renderer:not(first-child),
ytd-video-secondary-info-renderer,
#placeholder-area.ytd-comment-simplebox-renderer {
    border-bottom-color: var(--yt-spec-10-percent-layer) !important;
}
ytd-guide-collapsible-section-entry-renderer.ytd-guide-section-renderer:not(:first-child),
ytd-metadata-row-header-renderer[has-divider-line] {
    border-top-color: var(--yt-spec-10-percent-layer) !important;
}
ytd-guide-entry-renderer[active] .guide-icon.ytd-guide-entry-renderer {
    fill: ${black} !important;
}
#hearted.ytd-creator-heart-renderer {
    fill: var(--yt-spec-static-brand-red) !important;
}
#hearted-border.ytd-creator-heart-renderer {
    fill: ${white} !important;
}
.guide-entry-badge.ytd-guide-entry-renderer {
    fill: var(--yt-spec-static-brand-red) !important;
}
#endpoint.yt-simple-endpoint.ytd-guide-entry-renderer:hover,
#endpoint.yt-simple-endpoint.ytd-guide-entry-renderer:focus {
    background-color: var(--yt-spec-badge-chip-background) !important;
}
a.yt-simple-endpoint.yt-formatted-string {
    color: var(--yt-endpoint-color, var(--yt-spec-call-to-action)) !important;
}
a.yt-simple-endpoint.yt-formatted-string:hover {
    color: var(--yt-endpoint-hover-color, var(--yt-spec-call-to-action)) !important;
}
.ytp-cards-button-icon .ytp-svg-shadow {
    fill: var(--darkreader-neutral-background) !important;
}
.ytp-doubletap-ui-legacy[data-side="back"] .ytp-doubletap-base-arrow {
    border-right-color: var(--darkreader-neutral-color) !important;
}
.ytp-doubletap-ui-legacy[data-side="forward"] .ytp-doubletap-base-arrow {
    border-left-color: var(--darkreader-neutral-color) !important;
}
.yt-spec-button-shape-next--mono.yt-spec-button-shape-next--tonal {
    background-color: ${lightgray} !important;
}
.page-header-banner-image {
    background-image: var(--yt-channel-banner) !important;
}
tp-yt-paper-menu-button {
    background-color: transparent !important;
}
#paid-comment-background.ytd-comment-view-model {
    background-color: transparent !important;
}
svg[id^="yt-ringo2"] :not([id^="youtube-paths"]) path:nth-child(1) {
    fill: #ff0033 !important;
}
ytd-horizontal-card-list-renderer.ytd-structured-description-content-renderer:not(:first-child),
ytd-metadata-row-container-renderer.ytd-structured-description-content-renderer:not(:first-child),
ytd-structured-description-content-renderer[inline-structured-description] ytd-horizontal-card-list-renderer.ytd-structured-description-content-renderer,
ytd-structured-description-content-renderer[inline-structured-description] ytd-error-corrections-section-renderer.ytd-structured-description-content-renderer,
ytd-structured-description-content-renderer[inline-structured-description] ytd-video-description-infocards-section-renderer.ytd-structured-description-content-renderer {
    border-top: 2px solid #888 !important;
}

IGNORE INLINE STYLE
yt-live-chat-ticker-paid-message-item-renderer *
yt-live-chat-ticker-sponsor-item-renderer *
#ytd-player + .efyt-control-bar > button path

================================

yscec.yonsei.ac.kr

INVERT
iframe
#page-sidebar

================================

yume.wiki

CSS
.spoiler {
    background-color: ${black} !important;
    color: ${black} !important;
}

================================

yuque.com

INVERT
.lake-math-content-preview-img > img
.lake-math-container > img
div[data-lake-card="mindmap"] > div > div > div

================================

zacznijzyc.net

INVERT
.logo_container

================================

zadania.info

INVERT
img.latex__math-inline
img.math
img.math-display

================================

zaid-ajaj.github.io

CSS
:root {
    --main-background: var(--darkreader-neutral-background) !important;
    --sidebar-background: var(--darkreader-neutral-background) !important;
}

================================

zdic.net

INVERT
li a img
.kxtimg
.zipic img
.zx img

CSS
.nr-box-header {
    background-image: none !important;
}

================================

zdw.krakow.pl

CSS
#kw-alert p,
#kw-alert a {
    color: initial !important;
}

================================

zed.dev

CSS
.text-transparent {
    color: var(--tw-gradient-from) !important;
}

================================

zendesk.com

CSS
.zendesk-editor--rich-text-container {
    background-image: none !important;
}

================================

zenn.dev

INVERT
a[class^="AppHeader_homeLink"]

CSS
:root {
    --c-bg-base: var(--darkreader-bg--c-bg-base) !important;
    --c-bg-emoji: var(--darkreader-bg--c-bg-base);
    --c-bg-neutral: var(--darkreader-bg--c-bg-neutral) !important;
    --c-bg-primary-lighter: var(--darkreader-bg--c-bg-primary-lighter) !important;
}

================================

zeptovm.com

INVERT
.logo

================================

zerohedge.com
*.zerohedge.com

INVERT
header img

================================

zerossl.com

INVERT
.logo

================================

zfsbootmenu.org

CSS
body {
    background-image: none !important;
}

================================

zhihu.com

INVERT
img[eeimg="1"]

CSS
div.css-vurnku > div > div.css-1bi2006 {
    background-color: ${darkgray} !important;
}
div.css-vurnku button {
    color: ${darkblue} !important;
}
div.css-vurnku button svg {
    fill: ${darkblue} !important;
}
div.Popover-content .Menu {
    background-color: var(--darkreader-neutral-background) !important;
}

================================

zhihuishu.com

INVERT
img[class="kfformula"]

================================

zhixue.com

INVERT
.analysis_html_new [src]
.hd2
.hd3
.ml15 [src]
.subject-info [src]
.subject-result [src]
div.analysis-content [src]
div.mt5
#sideToolbar

================================

zi.tools

INVERT
button.ant-switch-small
img[src="https://ziphoenicia-1300189285.cos.ap-shanghai.myqcloud.com/home_svg/zi-tools.svg"]
img[src^="https://ziphoenicia-1300189285.cos.ap-shanghai.myqcloud.com/icon_svg/"]
img[src^="https://ziphoenicia-1300189285.cos.ap-shanghai.myqcloud.com/swjz/"]
img[data-v-016f9352]
img[data-v-f8120624]
path[data-v-f8120624]

================================

zillow.com

CSS
#breakdown-panel .pie-chart svg g text {
    fill: var(--darkreader-neutral-text) !important;
}

================================

zippyshare.com

INVERT
img#browse

CSS
.inner_main > table {
    background-image: none !important;
}

================================

zlidc.net

INVERT
#nav-logo

================================

znanium.com

INVERT
.bookreadimgs

================================

zonatmo.com

IGNORE IMAGE ANALYSIS
*

================================

zorin.com

INVERT
.logotype
.social
img[alt="GOG logo"]
img[alt="Windows to Zorin OS"]

================================

zotero.org

INVERT
.brand

================================

zrzutka.pl

INVERT
.navbar-logo
.rounded-circle

================================

zybooks.com
learn.zybooks.com

CSS
.image-content-resource img,
.zyimage {
    background-color: var(--darkreader-neutral-text) !important;
}

```

### config\static-themes.config

```
*

NEUTRAL BG
html
body
:not([style*="background-color:"]):not(iframe)

NEUTRAL TEXT
html
body
:not([style*="color:"])
.sr-reader *:not([class*='sr-pivot'])

RED TEXT
h1:not([style*="color:"])
h2:not([style*="color:"])
h3:not([style*="color:"])
h4:not([style*="color:"])
h5:not([style*="color:"])
h6:not([style*="color:"])

GREEN TEXT
cite:not([style*="color:"])

BLUE BG ACTIVE
input:not([style*="background-color:"])
textarea:not([style*="background-color:"])
button:not([style*="background-color:"])
[role="button"]

BLUE TEXT ACTIVE
a:not([style*="color:"])

BLUE BORDER
:not([style*="border-color:"])
::before
::after

FADE BG
div:empty
.sr-reader *
.sr-backdrop

FADE TEXT
input::placeholder
textarea::placeholder

NO IMAGE
input:not([style*="background-image:"])
textarea:not([style*="background-image:"])

================================

github.com

RED TEXT
.pl-k

GREEN BG ACTIVE
.btn-primary

GREEN TEXT
.pl-c

BLUE TEXT
.pl-s
.pl-pds
.pl-c1

NO IMAGE
.btn
.btn-primary

================================

imdb.com

RED BG
.jw-progress:empty
.jw-knob:empty

FADE BG
.MediaSheetstyles__MediaContainer-sc-1warcg6-0
.MediaSheetstyles__MediaContentContainer-sc-1warcg6-1

TRANSPARENT BG
.ipc-lockup-overlay
.ipc-lockup-overlay__content *
.jw-captions
.jw-controls
.jw-controls *
.jw-controls-backdrop:empty
.jw-overlays
.MediaSheetstyles__MediaContentContainer-sc-1warcg6-1 div
.Slate__VideoPreviewContainer-ss6ccs-3
.styles__MediaViewerTouchHandler-sc-6t1jw8-5

================================

mail.google.com

RED BG ACTIVE
.T-I-KE

NO IMAGE
.T-I-KE

================================

nationstates.net

TRANSPARENT BG
.paperclip

================================

opencollective.com

BLUE BG ACTIVE
.TierCard .action

TRANSPARENT BG
.CollectiveCover .content

================================

reddit.com

RED BG
.reddit-video-player-root .seek-bar-progress
.reddit-video-player-root .volume-slider-progress
.reddit-video-player-root .volume-slider-thumb

BLUE BG
.reddit-video-player-root .seek-bar-buffered
.reddit-video-player-root .volume-slider-track

FADE BG
.reddit-video-player-root .ended-controls
.reddit-video-player-root .playback-controls

TRANSPARENT BG
.reddit-video-player-root video + div
.reddit-video-player-root .ended-controls :not(button)
.reddit-video-seek-bar-root
.reddit-video-player-root .playback-controls .control-button

================================

youtube.com

RED BG
.ytp-swatch-background-color.ytp-swatch-background-color

BLUE BG
.ytp-load-progress:empty

FADE BG
.ytp-chrome-top
.ytp-chrome-bottom
.ytp-pause-overlay

TRANSPARENT BG
#previewbar
.ytp-button.ytp-button
.ytp-chrome-bottom *
.ytp-chrome-top *
.ytp-gradient-bottom:empty
.ytp-gradient-top:empty
.ytp-pause-overlay *
.ytp-progress-bar-padding:empty
.ytp-scrubber-container
.ytp-timed-markers-container:empty
.ytp-tooltip-text-wrapper

```

### config\inversion-fixes.config

```
*

INVERT
img
video
:not(object):not(body)>embed
object
svg image
[style*="background:url"]
[style*="background-image:url"]
[style*="background: url"]
[style*="background-image: url"]
[background]
twitterwidget
.sr-reader
.sr-backdrop
iframe:fullscreen
[class="opinary-iframe"]

NO INVERT
[style*="background:url"] *
[style*="background-image:url"] *
[style*="background: url"] *
[style*="background-image: url"] *
input
[background] *
img[src^="https://s0.wp.com/latex.php"]
img.Wirisformula
twitterwidget .NaturalImage-image

REMOVE BG
.compatibility-with-darkreader-below-4-3-3

CSS
.compatibility-with-darkreader-below-4-3-3 {
    background: white !important;
}

================================

1fichier.com

INVERT
#oby_na
#mkdir
#rename
#rmdir
#share
.file_link
.file_info
.file_at
.file_export
.file_desc
.file_rename
.file_password
.file_acl
.file_ddl
.file_inline
.file_remove

================================

airbnb.com

INVERT
.background-cover
#footer
#photo-modal

NO INVERT
#footer *
#photo-modal *

================================

algassert.com

NO INVERT
img

================================

aliexpress.com

CSS
#j-qrcode-img, #J_QRCodeImg {
    background-color: white !important;
}

================================

amazon.com

INVERT
#navbar
#nav-subnav
#navFooter
.dv-storefront-page
.av-hero-background-size
.av-detail-bottom-bar
.webPlayerContainer
.avu-content
.avu-section-alt
.av-badges
.controlsOverlayTopRight
.pausedOverlay
.nav-flyout
.lists-desktop-rio-icons

NO INVERT
.DigitalVideoWebNodeLists_Item__itemImage
.av-hero-background
.avu-content img
.dv-tile img
.vjs-tech video

CSS
#nav-flyout-ewc {
    margin-right: -220px;
}
.nav-flyout-body {
    height: 100% !important;
}

================================

anankeiot.com

INVERT
#sidebar-left
.page-header
.add-button
.panel-footer

================================

androidpolice.com

INVERT
.ap-nav-wrapper
.footer
.logo

NO INVERT
.ap-nav-wrapper *
.footer *

================================

answers.unity.com

INVERT
.header-wrapper
.navbar

================================

app.snowflake.com

INVERT
[data-testid="avatar-block"]
.cy
.fz

================================

app.tray.io

INVERT
img[alt="user-avatar"]

NO INVERT
img
video
:not(object):not(body) > embed
object
svg image
[style*="background:url"]
[style*="background: url"]
[style*="background-image:url"]
[style*="background-image: url"]
[background]
twitterwidget
.sr-reader
.sr-backdrop
iframe:fullscreen

================================

askubuntu.com

REMOVE BG
body

================================

atlassian.net

INVERT
.EditPage_withPanels_3Hr
.aui-toolbar
.editor
.toolbar-item
.conf-macro.output-inline
.conf-macro.output-display
.latexmath-center.confluenceTd

================================

audible.com

NO INVERT
img.adbl-cp-cursor

================================

avisendanmark.dk

INVERT
.logo

================================

aws.amazon.com

INVERT
#consoleNavHeader
.m-nav-header
.m-nav-panel-wrapper

================================

baike.baidu.com

INVERT
.formula

================================

bart.gov/schedules

NO INVERT
img

================================

basho.com

INVERT
#site-navigation
footer
header
.featured-news-wrapper
:not(.lang):not(#foot-logo)>img

================================

bbc.com

INVERT
div.orb-nav-section.orb-nav-blocks > a > img

================================

berlingske.dk

INVERT
.site-header__logo

================================

bestbuy.com

INVERT
#None > div > section > div.comparison-container.comparison-container-l.legacy-variant
.product-container

================================

betterexplained.com

NO INVERT
img.tex

================================

bilibili.com

REMOVE BG
body:not(.player-mode-full) .bpx-player-video-area
body:not(.player-mode-full) .bpx-player-loading-panel

================================

bit-tech.net
forums.bit-tech.net

INVERT
div#subNav
div#anotherSubNav
.footerContainer
div.footer
#bitFooter
.nodeIcon
li.navTab.forums.selected
li.navTab.xengallery.selected
li.navTab.members.selected

REMOVE BG
#blurBackground
.background-image
#headerMover
#loginBar

================================

bremeneins.de

INVERT
.ardplayer-footer
.page-header

================================

buxfer.com

INVERT
.UIDesktopAppHeader
.UISidebarDrawer
.UISidebar

================================

bytesloader.com

INVERT
.footer-distributed
.navbar-inverse

================================

central.bitdefender.com

INVERT
#left_nav
.top_nav
#user_avatar

NO INVERT
.logo
#left_nav *
.top_nav *

================================

chatgpt.com

INVERT
pre .dark

================================

circleci.com

INVERT
.css-1ibtrcs
.css-1lflngw

================================

claude.ai

INVERT
pre .code-block__code

================================

cloud-catcher.squiddev.cc

INVERT
button[class*="styles_action-button"]

CSS
button[title*="computer off"] svg path {
  fill: green !important;
}

================================

cloud.databricks.com
pages.databricks.com
*.azuredatabricks.net

INVERT
.figure
#sparkui-iframe-body #plan-viz-graph svg g.cluster rect
#sparkui-iframe-body #plan-viz-graph svg g.node rect
.cursor
div.ansiout

CSS
text {
    fill: ${black} !important;
}
.cm-string {
    color: rgb(132, 179, 235) !important;
}
.cm-keyword {
    color: rgb(232, 121, 172) !important;
}
.cm-variable-2 {
    color: rgb(97, 215, 255) !important;
}
li.CodeMirror-hint {
    font-family: Source Code Pro, Menlo, monospace !important;
}
span[role="presentation"] {
    color: ${black} !important;
}
.CodeMirror-cursor {
    border-left-color: ${black} !important;
}
.ansiout {
    color: ${rgb(85, 85, 85)} !important;
}
.rm-modal {
    background: var(--darkreader-neutral-background) !important;
}

================================

cloud.digitalocean.com

INVERT
.aurora-container-left

================================

codebasehq.com

INVERT
a.Project__link

================================

codecombat.com

INVERT
.modal-content
.map-background
.game-controls
.level-content
.modal-backdrop

================================

coursera.org

NO INVERT
.vjs-tech
.js-video

================================

dailymail.co.uk

NO INVERT
.masthead #logo

================================

dash.cloudflare.com

NO INVERT
.c_bt > div:nth-child(1) > svg:nth-child(1)
.c_k

================================

dedication.pl

INVERT
.wwzing

================================

deezer.com

INVERT
.page-sidebar

NO INVERT
.player-cover *

================================

detexify.kirelabs.org

INVERT
.symbol img

================================

dev.to

INVERT
.js-code-highlight

================================

devdocs.io

NO INVERT
._theme-dark

================================

developer.chrome.com

CSS
mark, pre b {
    background-color: ${#fe7} !important;
}

================================

developer.mozilla.org

INVERT
#nav-footer
.highlight-span
.readOnlyInline
#nav-sec
#toc
.socialaccount-providers
.toggle-container .current

================================

developer.playfab.com

INVERT
header

================================

deviantart.com

INVERT
#navbar-menu
#overhead-collect
.text-wrap
.thumb > .info
.mobileMenuWrapper
.tv150-tag
.hero
.hero-thumb
.hero-thumb > .info
.loggedOut
.minibrowse-mobile-paddles-container

NO INVERT
.extra-info .avatar
.tt-crop > .tinythumb

================================

devterms.io

INVERT
.dark .text-gradient

================================

disqus.com/embed/

INVERT
body.dark

NO INVERT
body.dark *

================================

docs.gamesparks.com

INVERT
.side-menu
.home-menu
.hljs

================================

docs.google.com

INVERT
.jfk-palette-colorswatch
[aria-label^="Google Account"]
div[title="Profile"]
.kix-embeddedobject-image

================================

docs.microsoft.com

NO INVERT
.theme-dark
.theme_night

================================

docs.unity3d.com

INVERT
.header
.navbar-inverse

================================

doodle.com

INVERT
.d-footerContentContainer

================================

draw.io

INVERT
text

CSS
body {
    background-color: #151515 !important;
}

================================

drive.google.com

INVERT
[aria-label^="Showing viewer"] > [aria-label^="Displaying"]
[aria-label^="Showing viewer"] > [role="toolbar"]
[aria-label^="Showing viewer"] [role="button"][data-tooltip="Previous"]
[aria-label^="Showing viewer"] [role="button"][data-tooltip="Next"]
[aria-label^="Showing viewer"] [aria-label^="Page"]
[aria-label^="Showing viewer"] [aria-label^="Page"] + div
[aria-label^="No preview available"]
[aria-label^="No preview available"] ~ div
[aria-label^="There was a problem previewing"]
[aria-label^="There was a problem previewing"] ~ div
[aria-label^="Google Account"]
div[title="Profile"]

================================

dsl.sk

NO INVERT
#header img
#title_bar img
#bg > table > tbody > tr:nth-of-type(1) > td:nth-of-type(1)
img[src="images/article_perex.gif"]
img[src="/images/design/feedback_pos.png"]
img[src="/images/design/feedback_neg.png"]

REMOVE BG
#menu
#bg > table > tbody > tr:nth-of-type(1) > td:nth-of-type(1)

================================

duckduckgo.com

INVERT
html:not(.dark-bg) #logo_homepage_link
html:not(.dark-bg) span.header__logo.js-logo-ddg

NO INVERT
html.dark-bg
html.dark-bg *

================================

duolingo.com

CSS
._1xgcT, ._1bkpY {
    color: rgb(109,19,130);
}

================================

ebay.*

INVERT
body[style*="background-image: url"] img
body[style*="background-image: url"] video
body[style*="background-image: url"] [style*="background-image: url"]

NO INVERT
body[style*="background-image: url"]

================================

ecosia.*

INVERT
[class^="image-preview"]

================================

elastic.co

INVERT
path[fill="#000"]

CSS
#navigation_container[fixed][data-component-theme="color"] [class*="Index_navigation_header"] > a svg path:last-child {
    fill: gray !important;
}

================================

electronics-tutorials.ws

REMOVE BG
img

================================

electronjs.org

INVERT
header
.jumbotron-home
.highlight-dark

================================

eman-physics.net

NO INVERT
.middle_area img

================================

exhentai.org
e-hentai.org

INVERT
#gd1
.gdtm > div

================================

facebook.com

INVERT
._3ixn
._2teu
.userContentWrapper canvas
._4lqu
._4lqt
._24ws
._1z0-
._19eb
._5rpb
._5rpu
._3t54
._1-h1
._3pit
._5asn
._1e8c
._2b-0
._2w_u
._4who
._4g9v
._3s6x
._5b-_
._2r86
._2r84 ._62jm
._3ekx
._3uzm
._4-lv
._6m3
._2t_q
._4-lv [role="button"]
._2ph-
._39n
._3u15
.snowliftOverlay
.coverNoImage
.fbTimelineProfilePicSelector
.uiTooltipX
body.UIPage_LoggedOut #blueBarDOMInspector
body.UIPage_LoggedOut #blueBarDOMInspector .inputtext
canvas

NO INVERT
.uiStreamStory video
.inputtext

REMOVE BG
._4d3w .stageWrapper
._4lpe
.stage
.videoStage

CSS
._2s1x ._2s1y {
    background: #9BB5E8 !important;
    border-bottom-color: #92A6CA !important;
    color: black !important;
}
.uiContextualLayerParent {
    box-shadow: none !important;
}

================================

farside.ph.utexas.edu

NO INVERT
img

================================

feedback.unity3d.com

INVERT
.header-wrapper
.navbar
.bg-ud

================================

feedly.com

INVERT
.people .photo
#feedlyUndoSign
#feedlySignPart
.pinContainer
.visual-overlay

CSS
.entry-overlay {
    background-color: rgba(220,220,220,0.5);
}

================================

feynmanlectures.caltech.edu

NO INVERT
img

================================

fontspring.com

NO INVERT
.grid6 .fullwidth

================================

fortune.com

CSS
#content div div p,
#content div div h2 {
    color: var(--darkreader-neutral-text) !important;
}

================================

forum.unity.com

INVERT
.main-navigation
.sub-nav
.unity-logo
.icon
.sub-nav

================================

freenet.de

INVERT
.frn-header
.x-container-frn-head-toolbar

CSS
.frn-header {
    margin: 0px auto 0 0 !important;
}

================================

gadgety.co.il

INVERT
iframe[src^="https://www.youtube.com/embed"]

================================

gamesparks.com

INVERT
.main_header
.block_compatibility
.grid_overlay
.block_insights
.main_footer
.docs-hero

================================

genk.vn

INVERT
.ghw-bottom-header
.ghw-top-header

================================

gigaom.com

INVERT
.bg

================================

github.com

INVERT
.jumbotron-codelines
.bg-gray-dark
.bg-gray-dark .form-group
.js-project-header
.header-logo-invertocat
.notification-indicator
.label
.label-color
.tooltipped:not(.notification-indicator)::before
.tooltipped:not(.notification-indicator)::after
.HeaderNavlink [data-ga-click*="(Logged out)"]

CSS
header {
    background-color: #dae1e7 !important;
}
.markdown-body img {
    background-color: transparent !important;
}
.Header .header-search-wrapper {
    background-color: rgba(0, 0, 0, 0.125) !important;
}
.js-selected-navigation-item {
    color: rgba(0, 0, 0, 0.75) !important;
}
header,
.HeaderNavlink,
.Header .header-search-input,
.Header .header-search-input::placeholder {
    color: rgba(0, 0, 0, 0.75) !important;
}
.Header .header-search-scope {
    border-right-color: #ccd7e1 !important;
    color: rgba(0, 0, 0, 0.75) !important;
}
.select-menu-item.navigation-focus,
.select-menu-item.navigation-focus.selected,
.select-menu-item.navigation-focus.select-menu-action,
.select-menu-item.navigation-focus .description-inline {
    background: #93c6ff !important;
    color: black !important;
}
.HeaderMenu-link,
.select-menu-item.navigation-focus > .octicon,
.select-menu-item.navigation-focus.selected > .octicon,
.select-menu-item.navigation-focus.select-menu-action > .octicon,
.select-menu-item.navigation-focus .description-inline > .octicon {
    color: black !important;
}

================================

gitlab.*

INVERT
gl-emoji
.navbar
.code.dark
.code.dark .notes_holder
.code.solarized-dark
.code.solarized-dark .notes_holder
.code.monokai
.code.monokai .notes_holder
.blame-commit

NO INVERT
.ui_light .navbar

CSS
#build-trace {
    background: rgba(255, 255, 255, 0.7) !important;
}
pre code {
    color: #777777 !important;
}

================================

gls-pakete.de

CSS
.tracking--status .status-box::before, .tracking--status .status-box::after {
    z-index: 0 !important;
}
.tracking--status .status-box.status--complete.status--lastcomplete .status-box--tooltip, .tracking--status .status-box.status--current .status-box--tooltip {
    transform: none !important;
    position: absolute !important;
    margin-bottom: 0px !important;
    margin-top: -10px !important;
    bottom: 0 !important;
}

================================

google.*
google.*.*

INVERT
.gb_2
.gb_M
.gsri_a
.gbii
.gbip
.azp
.aLF-aPX-KP
.irc_bg
.RY3tic
canvas.circle
#app-container.vasquette.app-imagery-mode .widget-scene-canvas
#app-container.vasquette.app-globe-mode .widget-scene-canvas

NO INVERT
.irc_mi
.irc_rii
.irc_mut
.act-icon-dark-gray
.amI
.amJ
.adk
.adj
[src*="ic_"]
[src*="black"]
.mL
.ajT
.hB
.hA
.mK
.mI
input[style*="data:image"]
img[src*="/books/content?"]

CSS
.pI {
    background: rgba(255, 255, 255, 0.7) !important;
}
.eB {
    background: rgba(255, 255, 255, 0.4) !important;
}

================================

granttree.co.uk

INVERT
img
video
embed
.photo

================================

habitica.com

INVERT
nav.navbar
#app-header
.header
.quest-boss
.character-sprites
.item-content
.drawer-container .item
.npc_matt
.npc
.seasonal .background
.image
.habitica-emoji
.daniel_front
.world-boss
.dropdown-menu
.dropdown-menu .notification
.fade.show
.modal-content
.drawer-container

NO INVERT
#app-header .character-sprites
.seasonal .background .npc

================================

habr.com

NO INVERT
img[src*="//tex.s2cms.ru/"]

================================

hangouts.google.com

INVERT
.g-Ue-ad
.g-Ue-v0h5Oe
.bdXzDb .pTh3n
.gb_Hc
.Ik
.gbii
.vm
.Ce1Y1c
.mUbCce

NO INVERT
#gbq1

REMOVE BG
.g-Qx-eb

CSS
.kFx1Ae-xdwExf-eb-m,
.g-Qx-r4m2rf-wZVHld {
    display: none;
}

================================

hardwaretester.com

INVERT
.css-18zdsro.en092cd1
.css-1yi8w9s.ex43mx610
.css-2n3ua2.ex43mx611
.css-13i6n5b.en092cd9 div canvas
.css-1jxoetp.eezel420 svg g text

CSS
.css-13i6n5b, .css-1gmvfms, .css-oi07q0 {
    box-shadow: rgba(251, 229, 208, 0.1) 0px 2px 5px;
}
.css-oi07q0 {
    box-shadow: rgba(255, 255, 255, 0.2) 0px 5px 10px;
}

================================

homestuck.com

INVERT
.read-link
body.scratch
body.sweet
body:not(.scratch):not(.sweet) #animation_container
body:not(.scratch):not(.sweet) .nav-btn--center
body:not(.scratch):not(.sweet) #nav-container
body:not(.scratch):not(.sweet) #game_overlay
body.scratch #overlay
body.sweet #overlay
body.sweet #gamenav-container
body.scratch #site-search
body.sweet #site-search
body.scratch .o_chat-log-btn

NO INVERT
body.scratch img
body.sweet img

REMOVE BG
body:not(.scratch):not(.sweet)
body:not(.scratch):not(.sweet) .o_site-footer

================================

hooktail.sub.jp
hooktail.org

NO INVERT
#box img
.box img

================================

html5rocks.com

INVERT
.prettyprint

================================

hysterical-amusement.surge.sh

INVERT
body
.instructionsContainer
#liveOutput

================================

ign.com

INVERT
.video_embed_content-poster
.video_embed_content-poster-play-button

REMOVE BG
#review-promo

================================

imdb.com

INVERT
#nb20 > div
#navbar-suggestionsearch
.caption_overlay
.vital
.slate_wrapper > .poster
.slate
.slate_fade_top
.slate_fade_bottom
.ab_hero
.ab_hero .ninja_image
.sub_nav
.app-links
#navMenuPro img
#proAd
.rec_default_image
#photo-container
#video-container

NO INVERT
#navMenuPro
#photo-container img
#video-container img
#video-container video

REMOVE BG
#nb20

================================

immutables.github.io

INVERT
.illustration
.documentation .highlight

================================

instagram.com

INVERT
._mli86
._cqw45._2pnef

CSS
[role="dialog"] {
    background-color: rgba(255, 255, 255, 0.5) !important;
}
._sxolz {
    background-color: #fff !important;
}

================================

io9.com

CSS
html {
    height: auto !important;
}

================================

iopscience.iop.org

NO INVERT
img[alt*="Equation"]

================================

jappy.com
jappy.de

INVERT
[class^="header"]
[class^="counter"]
[class^="parts"]
.rankBadge > span:nth-child(2)
.genericBackendLayer
.layerContent

CSS
.collectableUser .parts {
    position: relative; !important;
}
.emosToRedeem .entry .button {
    margin-top: inherit; !important;
}
.tickerLayer .zoom {
    position: relative; !important;
}

================================

java.com

INVERT
html #jvc0v2.bg1 .jvc0w1
html #jvc0v2.bg2 .jvc0w1
html #jvc0v2.bg3 .jvc0w1
html #jvc0v2.bg4 .jvc0w1
html #jvc0v2.bg5 .jvc0w1

================================

javarepl.com

INVERT
.terminal-content

REMOVE BG
body

================================

jcrew.com

CSS
.c-filters__refinement--label .refinement--label__checkbox svg path {
    fill: transparent !important
}
.c-filters__refinement--label.is-selected .refinement--label__checkbox svg path {
    fill: #fff !important
}

================================

jeremykun.com

NO INVERT
img[src*=".gif"]
img[src*=".png"]

================================

jira.*
jira.*.*

INVERT
.chart img
#logo

================================

journalisten.dk

INVERT
.top-logo

================================

juejin.im

NO INVERT
.equation

================================

jyllands-posten.dk

INVERT
.c-icon:not(.c-icon--fill-white)

================================

khanacademy.org

INVERT
.task-container .modal-backdrop

================================

kickstarter.com

CSS
::selection, ::-moz-selection {
    background-color: #06E584 !important;
}

================================

kinopoisk.ru

INVERT
#GOWrapper
#external_header_wrapper
.header-fresh-search-partial-component_theme_default
.header-fresh-partial-component_theme_light
.footer-v2-partial-component__navigation-wrapper
.footer-v2-partial-component__bottom-navigation
.header-fresh-partial-component_theme_default .header-fresh-partial-component__dropdown
.info_title .gradient
.info_title .gradient_director
.movie-ticket-button
.movie-trailer-button
.randomMovie .name
.picAndNums
.promo-special
.flag
.main_info__quote
.feedback_img
.main_slider_arrow
#top_3banners
.yearsBox
.bottom_bg
.insert
.trailer_descr
.arrow
.play
.kp2-authapi-overlay
.kp2-authapi-paranja
.app__sticky-header
.search-suggest__content
.video-snippet__inner:after
.video-snippet__content
.tabs__tab_selected

NO INVERT
.right-slider p
#top_3banners img
.zod img
.peopleInfo table img
.date img
.rating img

REMOVE BG
#content_block
.box_block table table *

CSS
.discovery-trailers-overlay {
    background: rgba(255, 255, 255, 0.8) !important;
}
#popup_info_wrapper * {
    color: #bbb !important;
}

================================

kort.foroyakort.fo

INVERT
.header-section > a:first-child
.container-section > .icon-node

================================

kubernetes.io

INVERT
section.header-hero
footer

================================

last.fm

INVERT
div.masthead-logo
ul.navlist-items
div.navlist-more-wrap
div.header-title-label-wrap
div.grid-items-cover-image-image::after
div.grid-items-item-details
div.featured-item-details
div.top-bar
div.features-footer-cover-image::after
p.features-footer-content
button.btn-primary
a.btn-primary
footer

================================

launchpad.net

INVERT
body

NO INVERT
html
#launchpad-logo-and-name

================================

lazada.com.my

INVERT
.lzd-logo-content

================================

learningsuite.byu.edu

INVERT
.sidebarCalendar
.calendarEmpty
.white

================================

libretexts.org

NO INVERT
img

================================

lifehacker.com

INVERT
.videoCube a .thumbBlock

CSS
html {
    height: auto !important;
}

================================

lightning.force.com
*.lightning.force.com

INVERT
div.verticalNavContainer
.verticalNavHeader::before
.flexipageEditorHeader

================================

linerad.io

INVERT
.header h1 img

================================

linkedin.com

INVERT
#top-header
#responsive-nav-scrollable

NO INVERT
#top-header *
#responsive-nav-scrollable *

================================

linternaute.fr

INVERT
.dico_liste.grid_line > li

CSS
.dico_liste_greyandwhite .dico_liste li a {
    color: var(--darkreader-neutral-background);
}

================================

mail.google.com

CSS
form#aso_search_form_anchor td > div > input {
    background: none !important;
    filter: none !important;
}

================================

mail.live.com

INVERT
img:not([src="https://a.gfx.ms/rte_metro2.png"])
video
object
.ComposeContent

REMOVE BG
.ComposeContent

================================

mail.protonmail.com

CSS
.angular-squire-iframe body,
.angular-squire-iframe body div {
    background: #0D0E12 !important;
    color: #fff !important;
}

================================

mailchimp.com

INVERT
svg

NO INVERT
.cke_button_icon

================================

mathpages.com

NO INVERT
img

================================

mathprofi.ru
mathprofi.net

NO INVERT
p img

================================

mathworld.wolfram.com

NO INVERT
img

================================

matsci.org

NO INVERT
.d-header #site-logo

CSS
.category-logo.aspect-image img {
  background-color: white !important;
}

================================

mediawiki.org
*.mediawiki.org
wikibooks.org
*.wikibooks.org
wikidata.org
*.wikidata.org
wikiless.org
*.wikiless.org
wikimedia.org
*.wikimedia.org
wikimediafoundation.org
*.wikimediafoundation.org
wikinews.org
*.wikinews.org
wikipedia.org
*.wikipedia.org
wikiquote.org
*.wikiquote.org
wikisource.org
*.wikisource.org
wikiversity.org
*.wikiversity.org
wikivoyage.org
*.wikivoyage.org
wikiwand.com
*.wikiwand.com

INVERT
#Vorlage_Infobox_Chemikalie > tbody > tr:nth-child(2) > td > a
.mw-ext-score
.mw-mmv-overlay
.mwe-popups-discreet > svg

NO INVERT
.mwe-math-fallback-image-display
.mwe-math-fallback-image-inline
.mwe-popups image
img[alt^="Skeletal" i]
img[alt^="Structural" i]
img[src*="svg.png"]
img[src^="https://wikimedia.org/api/rest_v1/media/math/render/svg"]

================================

medium.com

NO INVERT
.canvas-renderer

================================

meduza.io

INVERT
.Header-root
.Footer-root

================================

messenger.com

INVERT
._4tsk

================================

minhaclaro.claro.com.br

INVERT
.header-black
.header-red-desktop-logada
#txt-busca-header-desktop

================================

mixtape.moe/$

INVERT
body
.top > .menu
#upload-filelist
.file-url

================================

mspaintadventures.ru

INVERT
.row
.row img
.row object
.mspa_content_inner > .mspa_page_pictures
.adv_content_inner > .adv_page_pictures
.sidebar
.content
.footer
.copyright
.row:nth-of-type(1) > .header
.row:nth-of-type(1) > .header > .banner
.row:nth-of-type(1)[style*='width:940px'] div:not(.nav)

NO INVERT
.nav img
#page > .content
.row > .row
.content > .content
.mspa_content_inner > .mspa_page_text img
.adv_content_inner > .adv_page_text img

CSS
body {
    background-color: #fff !important;
}
.sidebar {
    border-color: #fff !important;
}
html,
.banner,
.row:nth-of-type(2),
.row:nth-of-type(4) {
    background-color: #000 !important;
}

================================

mullvad.net

INVERT
#Logo

================================

musescore.com

INVERT
img[src*="https://musescore.com/static/musescore/scoredata/"]
img[src*="https://s3.ultimate-guitar.com/musescore.scoredata/"]

================================

my.mail.ru/(music|mail|vk|ok|bk|list|gmail.com|inbox)

INVERT
.b-head-layer_music
.b-head__menu__logo
.b-head__portal-navigation-wrapper
.b-history-event__videoevent-name
.b-music__genre__header__info
.b-music__playlists--tile__item__controls
.b-music__playlists--tile__item__stats
.b-music__section__content
.b-music__section__footer
.b-music__section__row
.b-music__top-artists__item__cover
.b-music__top-artists__item__info
.b-music__user-header__content
.b-music__user-header__controls
.b-music__user-header__title
.b-popup__fade
.btn-import
.filed-images
.l-music__menu-main
.l-music__portal-navigation
.l-music__search-form
.l-music__sidebar__playlist-playing > .cover
.playlists-block
.smiles
.songs-table__row__col__cover
.ui-button-main

NO INVERT
html
.b-music__artist-header__content
.b-music__artist-header__cover
.b-music__section__cell
.fixed-menu > .b-music__section__footer
.l-mm__avatar
.l-music__player__song__cover
.playlists-block

REMOVE BG
.b-music__user-header__bg--no-profile-cover

CSS
.l-music {
    background: #111;
}

================================

myaccounts.capitalone.com

INVERT
c1-ease-core-features-hero-bar

================================

mydealz.de

INVERT
.nav
.search
.threadTempBadge-icon
.emoji
.comment-image
.avatar
#footer
#thread-comments
.cept-action-user-profile
.popover--mainNav
.supportImage
.profileHeader
.cept-thread-image-link
.cept-thread-image-clickout

NO INVERT
.cept-userProfile-avatar
.imgFrame-img

CSS
.cept-dealBtn, .btn--facebook{
    letter-spacing: 0.5px;
}
.twitter-share-button{
    letter-spacing: 1.5px;
}
.text--color-red, .vote-temp--hot, .vote-temp--burn, .icon--plus{
    color: #ff3d00;
}

================================

myfitnesspal.com

INVERT
#fancybox-overlay

================================

nagatabi-p.jimdofree.com

NO INVERT
.cc-imagewrapper > img

================================

neopets.com

INVERT
#ban
#header

================================

nodejs.org

INVERT
#column2
footer
header

CSS
#column2.interior {
    background: #212121;
}
#column2 ul {
    background-color: #212121;
}

================================

nvidia.com

INVERT
.sub-brand-nav
.brandLink

================================

onedrive.live.com
*.*.live.com
sharepoint.com
*.sharepoint.com

NO INVERT
svg[style*="left: 0px"][style*="top: 0px"] image

================================

onliner.by

INVERT
.b-tile-main
.b-teasers-2__teaser
.news-tiles__subtitle
.b-opinions-main-2__tile
.news-header__top > .news-header__title
.b-tile-grad

NO INVERT
.b-opinions-main-2__tile *
.b-teasers-2__teaser-i

================================

op.gg

INVERT
.__sprite

================================

openclassrooms.com

INVERT
code.ace

NO INVERT
[class*=ace] *

================================

opencollective.com

INVERT
.CollectiveCover
.Footer
.MailChimpInputSection
.PublicFooter

NO INVERT
.CollectiveCover *
.Footer *
.MailChimpInputSection *
.PublicFooter *

================================

otakumode.com

INVERT
.c-slick-image-viewer__main-image img

================================

outlook.live.com

INVERT
#O365_NavHeader
span.ms-Pivot-text
span.ms-Pivot-icon
.ms-FocusZone.ms-CommandBar

================================

pagerduty.com

REMOVE BG
body

================================

pandora.com

INVERT
#body
.contentbox
#detailContainer
#mainContent
.slidesBackground
.slidesForeground

CSS
.skinContainer,
.slidesBackground,
.slidesForeground,
#trackDetail,
.track_detail_close {
    background-color: black !important;
}
.fxCol-cont-1,
.jspContainer,
#trackInfoButtons {
    background-color: white !important;
}
#brandingBar,
.contentnav,
.top {
    background-color: #3d4043 !important;
}
#playerBar {
    background-color: #0d0d0d !important;
}

================================

paper.dropbox.com

INVERT
.attrcomment.attrcomment

================================

perforce.com

INVERT
.title-bar
.sidenav-wrapper

================================

photos.google.com

INVERT
.DwJIde .QtDoYb svg

CSS
.ZSTBVb, .DwJIde .NRbSyd {
    background: white !important;
}

================================

play.afreecatv.com

INVERT
#afreecatv_player

================================

playfab.com

INVERT
.hero

================================

poeaffix.net

INVERT
#header

NO INVERT
img

================================

politiken.dk

INVERT
.pol-logo

================================

practice.geeksforgeeks.org

INVERT
.ace_dark

================================

prntscr.com
prnt.sc

INVERT
.header

================================

producthunt.com

INVERT
.backgroundImage_1hK9M
.v-image

NO INVERT
.backgroundImage_1hK9M *
.v-image *

CSS
.post-detail--body--gallery-fullscreen--image {
    background-color: black;
}

================================

python.org

INVERT
nav ul li > a
nav .tier-2
#site-navigation
header
.featured-news-wrapper
:not(.lang):not(#foot-logo) > img

NO INVERT
:not(.lang):not(#foot-logo) > img
#content > div > section > div

================================

quora.com

INVERT
.section_photo

================================

reactjs.org

INVERT
.gatsby-highlight
.css-mlkfzr
.css-17t02fm

================================

readthedocs.io

INVERT
.wy-nav-side
.rst-versions
li.current

================================

reddit.com/r/(homestuck|Undertale)

INVERT
#header
#header-bottom-right
#sr-header-area
.md h4

NO INVERT
#header-img

REMOVE BG
body

================================

reddit.com/r/europe

INVERT
.flair

================================

reddit.com/r/firefox

INVERT
#header
#header-bottom-right

================================

reddit.com/r/GlobalOffensive

INVERT
#header
.side

NO INVERT
#header *
.side *

CSS
#mail::before {
    display: none !important;
}

================================

reddit.com/r/grandorder

INVERT
#header
.flair

================================

reddit.com/r/Paranormal

INVERT
#header
#sr-header-area
#header-bottom-right

================================

reddit.com/r/skyrimmods

INVERT
#header
.infobar

================================

reference.wolfram.com

NO INVERT
img

================================

regexr.com

INVERT
canvas.highlights

================================

rijnijssel.elo.education-online.nl

NO INVERT
.app-left-sidebar

================================

roblox.com

INVERT
.thumbnail-span
.color-dot
.avatar-back

NO INVERT
.thumbnail-span *
.avatar-back *

CSS
.avatar-thumbnail .enable-three-dee {
     background-color: #000000;
     color: #FFFFFF;
}

================================

ruby.sketchup.com
rubydoc.info

INVERT
#navbar

NO INVERT
#navbar a > img
#nav

================================

scotch.io

INVERT
.language-js
.language-javascript

================================

script.google.com

INVERT
.docs-icon-img-container

================================

sellercentral.amazon.com

CSS
.sc-header {
   background: #5c00ff !important;
}
.small,.account-switch-icon {
   fill: black !important;
}
.locale-icon-wrapper {
    color: black !important;
}
.logo-container {
    filter: brightness(0%) !important;
}

================================

semlar.com

INVERT
.thumbnail
.col-sm-2
.img-rounded
#alert-list
.background-texture

NO INVERT
img

================================

shadertoy.com

INVERT
canvas#demogl

================================

shiyanlou.com

INVERT
#display

================================

shop.ubi.com

INVERT
#topNavbar
#UplayHeader

================================

signin.aws.amazon.com/saml

INVERT
body

NO INVERT
html

================================

slack.com

INVERT
.client_channels_list_container
figure
.member_preview_link.member_image

NO INVERT
.client_channels_list_container *
figure *

CSS
.emoji {
    background-color: white;
}

================================

slushpool.com

INVERT
.siteHeader
.contentHeader
.contentSlider

================================

spotify.com

INVERT
img
video
embed
.hero
.header-main
.search-bar
#bg-wrap
#main

================================

stackexchange.com
*.stackexchange.com
askubuntu.com
mathoverflow.net
serverfault.com
stackapps.com
superuser.com

INVERT
.top-bar
button[class^="js-vote"]

CSS
body,
#content {
    background-image: none !important;
    background-color: var(--darkreader-neutral-background) !important;
    border-color: var(--darkreader-bg--theme-primary-custom) !important;
}
button[class^="js-vote"] {
    border-color: var(--darkreader-dark-background) !important;
}

================================

stackexchange.com
askubuntu.com
mathoverflow.com
serverfault.com
stackapps.com
stackoverflow.com
superuser.com

CSS
#hlogo a {
    text-indent: -256em !important;
}

================================

stash.*.*

INVERT
#logo

================================

statlect.com

NO INVERT
span.displayed > img
span.inm > img
#lensDIV img
.gs-image-box img.gs-image
img[alt="Table of Contents"]

================================

stiften.dk

INVERT
.logo

================================

storytellphys.wordpress.com

NO INVERT
img

================================

studio.restlet.com
cloud.rest-let.com

INVERT
.left-panel
.header
.editor-ace

NO INVERT
.avatar

================================

subscene.com

INVERT
#logo

================================

subscription.packtpub.com

INVERT
.sidebar
.navbar
.cover-info-overlay

================================

symfony.com

INVERT
#sln
.header__top :not(img)
.highlighttable

NO INVERT
[class^="sln-visible-"] > img:first-child

================================

systemuicons.com

INVERT
img

================================

tagesschau.de

INVERT
.header__logo__wortmarke svg

================================

techpowerup.com

CSS
.page-is-loading {
    display: none !important;
}

================================

teddit.net
teddit.ggc-project.de
teddit.kavin.rocks

INVERT
.preview

================================

terraform.io

INVERT
.mega-nav-banner

================================

terrytao.wordpress.com

NO INVERT
img

================================

theguardian.com

CSS
gu-island li div {
    background-color: ${white} !important;
}
aside,
section,
article,
article gu-island li div,
section gu-island li div {
    background-color: ${white} !important;
}

================================

theverge.com

CSS
.\[\&_a\]\:shadow-underline-black a {
    --darkreader-bg--tw-shadow: inset 0 -1px 0 0 #E7E6E2;
}

================================

thomann.de
thomann.ae
thomannmusic.ch
thomannmusic.com
thomannmusic.no

CSS
.fx-mix-blend-mode--multiply,
.product__image,
.fx-ranked-product__image-wrapper,
.navigator__item-image,
.navigator__item,
.mythomann-order-teaser__item-image,
.order-item__image-wrapper {
    mix-blend-mode: normal !important;
}
.fx-content-category .category-header {
    background-size: 100% 100%;
}

================================

tianchi.aliyun.com

NO INVERT
img

================================

tn.gov

INVERT
img[src$="tn-seal.png"]

================================

toggl.com

INVERT
.left-nav

================================

tpondemand.com

INVERT
.tau-cover-view__overlay
.tau-app-secondary-pane
.app-header
.uv-popover-content

NO INVERT
.tau-app-secondary-pane *
.app-header *

================================

tproger.ru

INVERT
.top-duft-punk
#colophon

NO INVERT
.text_logo img
.tmenu_icon

================================

translate.yandex.ru

CSS
.application.state-new .container_main,
.application.state-new .container_main[style],
.application.state-new .header {
    border-bottom-color: transparent;
}

================================

travis-ci.org

INVERT
.job-log

================================

trip101.com

INVERT
#homeaway-searchbox-searchtext
.footer
.hero-full-screen
.hero-section
.name
.tabs
.tabs-content

NO INVERT
.banner-img *
.logo *
.partners *
.partner-logo *
.tab-carrental *
.tab-hotel *
.tab-pa *
.tab-skyscanner *

================================

tvtime.com

NO INVERT
.page-sidebar *
.page-left *

================================

tweakers.net

INVERT
#menubar
#bottom
#tracker
#imageOverlay
#thumbContainer
.button
.hr

NO INVERT
#thumbContainer *
#bottom .button

================================

twitch.tv

INVERT
#site_footer
#carousel_background::after
#left_col
.player
.badge
.social-column
.top-nav
.anon-front__featured-section
.side-nav
.footer

NO INVERT
.player *
.social-column *
.top-nav *
.anon-front__featured-section *
.side-nav *
.footer *

REMOVE BG
#carousel
.chat-container
.conversations-list-header
.dark_wrapper ul
html
.nav
.js-conversations-list
.js-conversations-list-bottom-bar
.rightcol-content > .top

CSS
.chat_text_input,
.colon,
.dark_wrapper *,
.message,
.room-title,
.selected > a {
    color:black !important;
}
.chat_text_input {
    border: 1px solid black !important;
}

================================

twitter.com

INVERT
.tcu-textEllipse--multiline
.GalleryTweet .tweet
.Gallery-media
.DashboardProfileCard-bg
.SummaryCard-content

NO INVERT
.Gallery-media *

CSS
.gallery-overlay,
#permalink-overlay {
    background: rgba(255, 255, 255, 0.7) !important;
}

================================

ubi.com

REMOVE BG
html
body

================================

unicode.org

INVERT
.chars

================================

unicodelookup.com

CSS
body {
    background-color: #FFF !important;
}

================================

unity3d.com

INVERT
.main-navigation
.sub-nav
.wrapper
.unity-logo
.icon
.main-footer

================================

unity3d.com/learn

INVERT
.main-navigation
.sub-nav
.wrapper
.unity-logo
.bg-instructors
.hero
.bg-workflow

================================

unityhacks.com

INVERT
#unityhacks_sidebar
#exposeMask
#logoBlock
#navigation
#moderatorBar
.xenOverlay .sectionMain .heading overlayOnly
.banner_owner
.banner_staff
.banner_supportleader
.banner_supporter
.banner_partner
.banner_designer
.banner_promoter
.banner_honorable
.banner_premium
.messageHeading
.subHeading
.ToggleTrigger
.prefix
.PopupOpen
.categoryStrip
.secondaryContent h3
.LTR
.callToAction
.xenOverlay .section .heading
.xenTooltip
.redactor_dropdown
.errorOverlay
.sectionHeaders
.button
[title="Unread messages"]
footer

NO INVERT
#logo *
#taigachat_toolbar *
.listItemText h3
.pollBlock .pollResult div
.pollBlock .pollResult h3

================================

vergil.chemistry.gatech.edu/notes

NO INVERT
img

================================

virtua.speedtestcustom.com

NO INVERT
.branding

================================

vk.com

INVERT
.videoplayer
.videoplayer_media
.videoplayer_timeline_preview
.mv_chat
.mv_playlist
.mv_playlist_controls
#VideoLayerInfo__topControls
.page_album_title
.article_snippet__fade
.article_snippet__info
.article_snippet__read_btn
#layer_bg
#box_layer_bg
#pv_more_acts_tt
.login_app_devices
.friends_import_icon
.articleSnippet__inner
.articleSnippet_button
#z_photoview
.vv_summary
.thumb_map:after
.input_back_wrap[style*=none] ~ #ts_input
.audio_page_player_play .icon
.page_video_play_icon
.apps_featured_thumb_content
[class^=apps_featured]:before
.apps_frtt_photo
.apps_frtt_level
.settings_separated_row_iconed:before
.owner_photo_bubble_wrap
.tt_black
.tt_w.tt_black
.box_title
.box_layer_wrap
#box_loader
.chat_tab_close
#notifiers_wrap
.notifier_image_wrap
.doc_ext
.doc_title
.like_tt::after
.audio_row__cover_back
.poster__text
.emoji_smiles_row
.Reaction

NO INVERT
.mv_chat *
.mv_playlist *
#z_photoview img
.box_grey .box_title

REMOVE BG
.mv_layer_bg
.pv_bottom_info
.pv_img_area_wrap
.vv_body
.like_tt

CSS
.pv_bottom_info *,
.like_tt {
    color: #000 !important;
}
#pv_more_acts_tt * {
    color: #eee !important;
}
#top_notify_wrap,
#audio_layer_tt {
    box-shadow: none;
}
.chat_onl_inner {
    background-color: #dae1e8 !important;
}
.chat_tab_wrap:hover {
    background-color: #ccd5de !important;
}
.photos_row {
    background-color: #000 !important;
    border-color: #000 !important;
}

================================

vocabolario.sns.it

INVERT
img[src]

NO INVERT
body[background]

================================

vuejs.org

INVERT
.content
pre
h3
p

NO INVERT
img

================================

w3schools.com

INVERT
#topnav

================================

wallet.trezor.io

INVERT
.page-header
.qr-code

REMOVE BG
.qr-code

================================

web.telegram.org

INVERT
.im_dialog_unread
.icon-message-status
.dropdown-toggle
.icon-tg-title

================================

web.whatsapp.com

INVERT
.qrcode .icon-logo

CSS
.qrcode {
    border: 8px solid black;
}

================================

wikiwand.com

REMOVE BG
img

================================

wolfram.com

NO INVERT
.numberedequation
.displayformula
.inlineformula

================================

wolframalpha.com

NO INVERT
img

================================

wolfy.net

NO INVERT
.Skin_avatarPreviewBox__nCPmC
.Categories_skin__in1J0
.MenuElement_skin__pUf6L

================================

xfree86.org

NO INVERT
img[src*=".png"]

================================

yandex.*

INVERT
body.b-page_theme_pure_night
[class*="icon_moon_"]
.favicon
.weather__icon
.traffic__icon
.dist-popup__image
.footer_distro_yes
.serp-footer
.distro__icon
.services-big__item_icon
.services-all__icon
.popup2:before
html.i-ua_swipe_yes .informers7__icon
html.i-ua_swipe_yes .zen__item-domain
html.i-ua_swipe_yes .zen__item-title
html.i-ua_swipe_yes .teaser__service-bg
html.i-ua_swipe_yes .stream-intro
html.i-ua_swipe_yes .edadeal
html.i-ua_swipe_yes .afisha
html.i-ua_swipe_yes .services__icon
html.i-ua_swipe_yes .menu2__list

NO INVERT
body.b-page_theme_pure_night *
html.i-ua_swipe_yes .stream-intro__vod-preview
html.i-ua_swipe_yes .edadeal__item-img
html.i-ua_swipe_yes .afisha__film-image

REMOVE BG
html.i-ua_swipe_yes .mini-suggest__popup-spacer
html.i-ua_swipe_yes .menu2__container

================================

youtube.com

INVERT
html[dark=true] #scrim
.html5-video-player
.has-custom-banner
#theater-background
#watch-appbar-playlist
html:not([dark=true]) #header > #background
html:not([dark=true]) #links-holder yt-formatted-string
html:not([dark=true]) #subscribe-button
ytd-thumbnail-overlay-time-status-renderer
ytd-thumbnail-overlay-toggle-button-renderer
paper-toast
ytd-masthead[dark]
html:not([dark=true]) ytd-masthead[dark] #avatar-btn

NO INVERT
html[dark=true]
html[dark=true] *
.html5-video-player *
.has-custom-banner *
#watch-appbar-playlist *

CSS
#scrim.app-drawer {
    background: rgba(255, 255, 255, 0.5);
}
#player-theater-container {
    background: none !important;
}

================================

yscec.yonsei.ac.kr

INVERT
iframe
#page-sidebar

```

### generators\utils\parse.ts

```
import {parseArray} from '../../utils/text';
import {isFullyQualifiedDomain, isFullyQualifiedDomainWildcard, fullyQualifiedDomainMatchesWildcard, isURLInList, isURLMatched} from '../../utils/url';

declare const __TEST__: boolean;

const INDEX_CACHE_CLEANUP_INTERVAL_IN_MS = 60000;

// TODO: remove cast once types are updated
declare function clearTimeout(id: ReturnType<typeof setTimeout> | null | undefined): void;

interface SitePropsMut {
    url: readonly string[];
}

type SiteProps = Readonly<SitePropsMut>;

export interface SitePropsIndex<SiteFix extends SiteProps> {
    offsets: Readonly<string>;
    domains: Readonly<{[domain: string]: readonly number[]}>;
    domainLabels: Readonly<{[domainLabel: string]: readonly number[]}>;
    nonstandard: readonly number[];
    cacheSiteFix: {[offsetId: number]: Readonly<SiteFix>};
    cacheDomainIndex: {[domain: string]: readonly number[]};
    cacheCleanupTimer: ReturnType<typeof setTimeout> | null;
}

interface ConfigIndex {
    domains: Readonly<{[domain: string]: readonly number[]}>;
    domainLabels: Readonly<{[domainLabel: string]: readonly number[]}>;
    nonstandard: Readonly<number[] | null>;
}

export interface SiteListIndex {
    urls: readonly string[];
    domains: Readonly<{[domain: string]: number[]}>;
    domainLabels: Readonly<{[domainLabel: string]: readonly number[]}>;
    nonstandard: readonly number[];
}

export interface SitesFixesParserOptions<T> {
    commands: readonly string[];
    getCommandPropName: (command: string) => keyof T;
    parseCommandValue: (command: string, value: string) => any;
}

export function parseSitesFixesConfig<T extends SiteProps>(text: string, options: SitesFixesParserOptions<T>): T[] {
    const sites: T[] = [];

    const blocks = text.replace(/\r/g, '').split(/^\s*={2,}\s*$/gm);
    blocks.forEach((block) => {
        const lines = block.split('\n');
        const commandIndices: number[] = [];
        lines.forEach((ln, i) => {
            if (ln.match(/^[A-Z]+(\s[A-Z]+){0,2}$/)) {
                commandIndices.push(i);
            }
        });

        if (commandIndices.length === 0) {
            return;
        }

        const siteFix = {
            url: parseArray(lines.slice(0, commandIndices[0]).join('\n')) as readonly string[],
        } as T;

        commandIndices.forEach((commandIndex, i) => {
            const command = lines[commandIndex].trim();
            const valueText = lines.slice(commandIndex + 1, i === commandIndices.length - 1 ? lines.length : commandIndices[i + 1]).join('\n');
            const prop = options.getCommandPropName(command);
            if (!prop) {
                return;
            }
            const value = options.parseCommandValue(command, valueText);
            siteFix[prop] = value;
        });

        sites.push(siteFix);
    });

    return sites;
}

// URL patterns are guaranteed to not have protocol and leading '/'
export function getDomain(url: string): string {
    try {
        return (new URL(url)).hostname.toLowerCase();
    } catch (error) {
        return url.split('/')[0].toLowerCase();
    }
}

/*
 * Encode all offsets into a string, where each record is 7 bytes long:
 *  - 4 bytes for start offset
 *  - 3 bytes for record length (end offset - start offset)
 * Both values are stored in base 36 (radix 36) notation.
 * Maximum supported numbers:
 *  - start offset must be no more than parseInt('zzzz', 36) = 1679615
 *  - length must be no more than parseInt('zzz', 36) = 46655
 *
 * We have to encode offsets into a string to be able to save them in
 * chrome.storage.local for use in non-persistent background contexts.
 */
function encodeOffsets(offsets: Array<[number, number]>): string {
    return offsets.map(([offset, length]) => {
        const stringOffset = offset.toString(36);
        const stringLength = length.toString(36);
        return '0'.repeat(4 - stringOffset.length) + stringOffset + '0'.repeat(3 - stringLength.length) + stringLength;
    }).join('');
}

function decodeOffset(offsets: string, index: number): [number, number] {
    const base = (4 + 3) * index;
    const offset = parseInt(offsets.substring(base + 0, base + 4), 36);
    const length = parseInt(offsets.substring(base + 4, base + 4 + 3), 36);
    return [
        offset,
        offset + length,
    ];
}

function addLabel(set: { [label: string]: number[] }, label: string, index: number) {
    if (!set[label]) {
        set[label] = [index];
    } else if (!(set[label].includes(index))) {
        set[label].push(index);
    }
}

function extractDomainLabelsFromFullyQualifiedDomainWildcard(fullyQualifiedDomainWildcard: string): string[] {
    const postfixStart = fullyQualifiedDomainWildcard.lastIndexOf('*');
    const postfix = fullyQualifiedDomainWildcard.substring(postfixStart + 2);
    if (postfixStart < 0 || postfix.length === 0) {
        return fullyQualifiedDomainWildcard.split('.');
    }
    const labels = [postfix];
    const prefix = fullyQualifiedDomainWildcard.substring(0, postfixStart);
    prefix.split('.').filter(Boolean).forEach((l) => labels.concat(l));
    return labels;
}

function indexConfigURLs(urls: string[][]): {domains: { [domain: string]: number[] }; domainLabels: { [domainLabel: string]: number[] }; nonstandard: number[]} {
    const domains: { [domain: string]: number[] } = {};
    const domainLabels: { [domainLabel: string]: number[] } = {};
    const nonstandard: number[] = [];

    const domainLabelFrequencies: { [domainLabel: string]: number } = {};
    const domainLabelMembers: Array<{ labels: string[]; index: number }> = [];

    for (let index = 0; index < urls.length; index++) {
        const block = urls[index];
        const blockDomainLabels = new Set<string>();
        for (const url of block) {
            const domain = getDomain(url);
            if (isFullyQualifiedDomain(domain)) {
                addLabel(domains, domain, index);
            } else if (isFullyQualifiedDomainWildcard(domain)) {
                const labels = extractDomainLabelsFromFullyQualifiedDomainWildcard(domain);
                domainLabelMembers.push({labels, index});
                labels.forEach((l) => blockDomainLabels.add(l));
            } else {
                // Sitefix parser encountered non-standard URL
                nonstandard.push(index);
                break;
            }
        }

        // Compute domain label frequencies, counting each label within each fix only once
        for (const label of blockDomainLabels) {
            if (domainLabelFrequencies[label]) {
                domainLabelFrequencies[label]++;
            } else {
                domainLabelFrequencies[label] = 1;
            }
        }
    }

    // For each domain name, find the most specific label
    for (const {labels, index} of domainLabelMembers) {
        let label = labels[0];
        for (const currLabel of labels) {
            if (domainLabelFrequencies[currLabel] < domainLabelFrequencies[label]) {
                label = currLabel;
            }
        }
        addLabel(domainLabels, label, index);
    }

    return {domains, domainLabels, nonstandard};
}

function processSiteFixesConfigBlock(text: string, offsets: Array<[number, number]>, recordStart: number, recordEnd: number, urls: Array<readonly string[]>) {
    // TODO: more formal definition of URLs and delimiters
    const block = text.substring(recordStart, recordEnd);
    const lines = block.split('\n');
    const commandIndices: number[] = [];
    lines.forEach((ln, i) => {
        if (ln.match(/^[A-Z]+(\s[A-Z]+){0,2}$/)) {
            commandIndices.push(i);
        }
    });

    if (commandIndices.length === 0) {
        return;
    }

    offsets.push([recordStart, recordEnd - recordStart]);

    const urls_ = parseArray(lines.slice(0, commandIndices[0]).join('\n'));
    urls.push(urls_);
}

function extractURLsFromSiteFixesConfig(text: string): {urls: string[][]; offsets: Array<[number, number]>} {
    const urls: string[][] = [];
    // Array of tuples, where first number is an offset of record start and second number is record length.
    const offsets: Array<[number, number]> = [];

    let recordStart = 0;
    // Delimiter between two blocks
    const delimiterRegex = /^\s*={2,}\s*$/gm;
    let delimiter: RegExpMatchArray | null;
    while ((delimiter = delimiterRegex.exec(text))) {
        const nextDelimiterStart = delimiter.index!;
        const nextDelimiterEnd = delimiter.index! + delimiter[0].length;
        processSiteFixesConfigBlock(text, offsets, recordStart, nextDelimiterStart, urls);
        recordStart = nextDelimiterEnd;
    }
    processSiteFixesConfigBlock(text, offsets, recordStart, text.length, urls);

    return {urls, offsets};
}

export function indexSitesFixesConfig<T extends SiteProps>(text: string): SitePropsIndex<T> {
    const {urls, offsets} = extractURLsFromSiteFixesConfig(text);
    const {domains, domainLabels, nonstandard} = indexConfigURLs(urls);
    return {offsets: encodeOffsets(offsets), domains, domainLabels, nonstandard, cacheDomainIndex: {}, cacheSiteFix: {}, cacheCleanupTimer: null};
}

function lookupConfigURLsInDomainLabels(domain: string, recordIds: number[], currRecordIds: readonly number[], getAllRecordURLs: (id: number) => readonly string[]) {
    for (const recordId of currRecordIds) {
        const recordURLs = getAllRecordURLs(recordId);
        for (const ruleUrl of recordURLs) {
            const wildcard = getDomain(ruleUrl);
            if (isFullyQualifiedDomainWildcard(wildcard) && fullyQualifiedDomainMatchesWildcard(wildcard, domain)) {
                recordIds.push(recordId);
            } else {
                // Skip this rule, since the label match must have come from a different URL
            }
        }
    }
}

function lookupConfigURLs(domain: string, index: ConfigIndex, getAllRecordURLs: (id: number) => readonly string[]): number[] {
    const labels = domain.split('.');
    let recordIds: number[] = [];

    // Common fix
    if (index.domainLabels.hasOwnProperty('*')) {
        recordIds = recordIds.concat(index.domainLabels['*']);
    }

    // Wildcard fixes
    for (const label of labels) {
        // We need to use in operator because ids are 0-based and 0 is falsy
        if (index.domainLabels.hasOwnProperty(label)) {
            const currRecordIds = index.domainLabels[label];
            lookupConfigURLsInDomainLabels(domain, recordIds, currRecordIds, getAllRecordURLs);
        }
    }

    for (let i = 0; i < labels.length; i++) {
        const substring = labels.slice(i).join('.');
        if (index.domains.hasOwnProperty(substring)) {
            recordIds = recordIds.concat(index.domains[substring]);
        }
        if (index.domainLabels.hasOwnProperty(substring)) {
            const currRecordIds = index.domainLabels[substring];
            lookupConfigURLsInDomainLabels(domain, recordIds, currRecordIds, getAllRecordURLs);
        }
    }

    // Backwards compatibility: check for nonssend over nonstandard patterns, which will be filtered out
    // via regex in content script
    if (index.nonstandard) {
        for (const currRecordId of index.nonstandard) {
            const urls = getAllRecordURLs(currRecordId);
            if (urls.some((url) => isURLMatched(domain, getDomain(url)))) {
                recordIds.push(currRecordId);
                continue;
            }
        }
    }

    // Deduplicate array elements
    recordIds = Array.from(new Set(recordIds));

    return recordIds;
}

/**
 * Extracts a single site fix and parses it (cached)
 * @param text the fix file
 * @param index site fix index
 * @param options fix parsing options
 * @param id numeric index of the fix
 * @returns a single fix
 */
function getSiteFix<T extends SiteProps>(text: string, index: SitePropsIndex<T>, options: SitesFixesParserOptions<T>, id: number): Readonly<T> {
    if (index.cacheSiteFix.hasOwnProperty(id)) {
        return index.cacheSiteFix[id];
    }

    const [blockStart, blockEnd] = decodeOffset(index.offsets, id);
    const block = text.substring(blockStart, blockEnd);
    const fix = parseSitesFixesConfig<T>(block, options)[0];
    index.cacheSiteFix[id] = fix;
    return fix;
}

/**
 * This function uses setTimeout instead of Alarms API so that background context can
 * go incative (resulting in cleanup of all context variables) and then not be awoken
 * by the alarm.
 * @param index
 */
function scheduleCacheCleanup<T extends SiteProps>(index: SitePropsIndex<T>) {
    if (__TEST__) {
        return;
    }
    clearTimeout(index.cacheCleanupTimer);
    index.cacheCleanupTimer = setTimeout(() => {
        index.cacheCleanupTimer = null;
        index.cacheDomainIndex = {};
        index.cacheSiteFix = {};
    }, INDEX_CACHE_CLEANUP_INTERVAL_IN_MS);
}

/**
 * Given a URL, raw fixes, and an index, finds the applicable fixes.
 * Note that dependents assume that the first returned fix is a generic fix (has URL pattern '*').
 *
 * This method uses two levels of caching:
 *  - caching the site fixes keyed by a numeric id (to avoid re-parsing the site fixes)
 *  - caching the numeric ids keyed by domain (to avoid re-computing lists of site fixes for the same site,
 *    which is useful if user has multiple tabs of the same site and toggles Dark Reader on)
 */
export function getSitesFixesFor<T extends SiteProps>(url: string, text: string, index: SitePropsIndex<T>, options: SitesFixesParserOptions<T>): Array<Readonly<T>> {
    const records: T[] = [];
    const domain = getDomain(url);

    if (!index.cacheDomainIndex[domain]) {
        index.cacheDomainIndex[domain] = lookupConfigURLs(domain, index, (recordId) => getSiteFix<T>(text, index, options, recordId).url);
    }

    const recordIds = index.cacheDomainIndex[domain];
    for (const recordId of recordIds) {
        const fix = getSiteFix<T>(text, index, options, recordId);
        records.push(fix);
    }

    scheduleCacheCleanup(index);
    return records;
}

export function indexSiteListConfig(text: string): SiteListIndex {
    const urls = parseArray(text);
    const urls2D = urls.map((u) => [u]);
    const {domains, domainLabels, nonstandard} = indexConfigURLs(urls2D);
    return {domains, domainLabels, nonstandard, urls};
}

function getSiteListFor(url: string, index: SiteListIndex): string[] {
    const domain = getDomain(url);
    const recordIds = lookupConfigURLs(domain, index, (recordId) => [index.urls[recordId]]);
    const result: string[] = [];
    for (const recordId of recordIds) {
        result.push(index.urls[recordId]);
    }
    return result;
}

export function isURLInSiteList(url: string, index: SiteListIndex | null): boolean {
    if (index === null) {
        return false;
    }
    const urls = getSiteListFor(url, index);
    return isURLInList(url, urls);
}

```

### generators\utils\matrix.ts

```
import type {Theme} from '../../definitions';
import {clamp, multiplyMatrices} from '../../utils/math';
import type {Matrix5x1, Matrix5x5} from '../../utils/math';


export function createFilterMatrix(config: Theme): Matrix5x5 {
    let m: Matrix5x5 = Matrix.identity();
    if (config.sepia !== 0) {
        m = multiplyMatrices(m, Matrix.sepia(config.sepia / 100));
    }
    if (config.grayscale !== 0) {
        m = multiplyMatrices(m, Matrix.grayscale(config.grayscale / 100));
    }
    if (config.contrast !== 100) {
        m = multiplyMatrices(m, Matrix.contrast(config.contrast / 100));
    }
    if (config.brightness !== 100) {
        m = multiplyMatrices(m, Matrix.brightness(config.brightness / 100));
    }
    if (config.mode === 1) {
        m = multiplyMatrices(m, Matrix.invertNHue());
    }
    return m;
}

export function applyColorMatrix([r, g, b]: [number, number, number], matrix: Matrix5x5): [number, number, number] {
    const rgb: Matrix5x1 = [[r / 255], [g / 255], [b / 255], [1], [1]];
    const result = multiplyMatrices<Matrix5x1>(matrix, rgb);
    return [0, 1, 2].map((i) => clamp(Math.round(result[i][0] * 255), 0, 255)) as [number, number, number];
}

export const Matrix = {

    identity(): Matrix5x5 {
        return [
            [1, 0, 0, 0, 0],
            [0, 1, 0, 0, 0],
            [0, 0, 1, 0, 0],
            [0, 0, 0, 1, 0],
            [0, 0, 0, 0, 1],
        ];
    },

    invertNHue(): Matrix5x5 {
        return [
            [0.333, -0.667, -0.667, 0, 1],
            [-0.667, 0.333, -0.667, 0, 1],
            [-0.667, -0.667, 0.333, 0, 1],
            [0, 0, 0, 1, 0],
            [0, 0, 0, 0, 1],
        ];
    },

    brightness(v: number): Matrix5x5 {
        return [
            [v, 0, 0, 0, 0],
            [0, v, 0, 0, 0],
            [0, 0, v, 0, 0],
            [0, 0, 0, 1, 0],
            [0, 0, 0, 0, 1],
        ];
    },

    contrast(v: number): Matrix5x5 {
        const t = (1 - v) / 2;
        return [
            [v, 0, 0, 0, t],
            [0, v, 0, 0, t],
            [0, 0, v, 0, t],
            [0, 0, 0, 1, 0],
            [0, 0, 0, 0, 1],
        ];
    },

    sepia(v: number): Matrix5x5 {
        return [
            [(0.393 + 0.607 * (1 - v)), (0.769 - 0.769 * (1 - v)), (0.189 - 0.189 * (1 - v)), 0, 0],
            [(0.349 - 0.349 * (1 - v)), (0.686 + 0.314 * (1 - v)), (0.168 - 0.168 * (1 - v)), 0, 0],
            [(0.272 - 0.272 * (1 - v)), (0.534 - 0.534 * (1 - v)), (0.131 + 0.869 * (1 - v)), 0, 0],
            [0, 0, 0, 1, 0],
            [0, 0, 0, 0, 1],
        ];
    },

    grayscale(v: number): Matrix5x5 {
        return [
            [(0.2126 + 0.7874 * (1 - v)), (0.7152 - 0.7152 * (1 - v)), (0.0722 - 0.0722 * (1 - v)), 0, 0],
            [(0.2126 - 0.2126 * (1 - v)), (0.7152 + 0.2848 * (1 - v)), (0.0722 - 0.0722 * (1 - v)), 0, 0],
            [(0.2126 - 0.2126 * (1 - v)), (0.7152 - 0.7152 * (1 - v)), (0.0722 + 0.9278 * (1 - v)), 0, 0],
            [0, 0, 0, 1, 0],
            [0, 0, 0, 0, 1],
        ];
    },
};

```

### generators\utils\format.ts

```
import {push} from '../../utils/array';

interface SiteFix {
    url: string[];
    [prop: string]: any;
}

interface SitesFixesFormatOptions {
    props: string[];
    getPropCommandName: (prop: string) => string;
    formatPropValue: (prop: string, value: string | string[]) => string;
    shouldIgnoreProp: (prop: string, value: string | string[]) => boolean;
}

export function formatSitesFixesConfig(fixes: SiteFix[], options: SitesFixesFormatOptions): string {
    const lines: string[] = [];

    fixes.forEach((fix, i) => {
        push(lines, fix.url);
        options.props.forEach((prop) => {
            const command = options.getPropCommandName(prop);
            const value = fix[prop];
            if (options.shouldIgnoreProp(prop, value)) {
                return;
            }
            lines.push('');
            lines.push(command);
            const formattedValue = options.formatPropValue(prop, value);
            if (formattedValue) {
                lines.push(formattedValue);
            }
        });
        if (i < fixes.length - 1) {
            lines.push('');
            lines.push('='.repeat(32));
            lines.push('');
        }
    });

    lines.push('');
    return lines.join('\n');
}

```

### generators\theme-engines.ts

```
export enum ThemeEngine {
    cssFilter = 'cssFilter',
    svgFilter = 'svgFilter',
    staticTheme = 'staticTheme',
    dynamicTheme = 'dynamicTheme'
}

```

### generators\text-style.ts

```
import type {Theme} from '../definitions';

// Exclude font libraries to preserve icons
const excludedSelectors = [
    'pre', 'pre *', 'code',
    '[aria-hidden="true"]',

    // Font Awesome
    '[class*="fa-"]',
    '.fa', '.fab', '.fad', '.fal', '.far', '.fas', '.fass', '.fasr', '.fat',

    // Generic matches for icon/symbol fonts
    '.icofont', '[style*="font-"]',
    '[class*="icon"]', '[class*="Icon"]',
    '[class*="symbol"]', '[class*="Symbol"]',

    // Glyph Icons
    '.glyphicon',

    // Material Design
    '[class*="material-symbol"]', '[class*="material-icon"]',

    // MUI
    'mu', '[class*="mu-"]',

    // Typicons
    '.typcn',

    // Videojs font
    '[class*="vjs-"]',
];

export function createTextStyle(config: Theme): string {
    const lines: string[] = [];
    lines.push(`*:not(${excludedSelectors.join(', ')}) {`);

    if (config.useFont && config.fontFamily) {
        lines.push(`  font-family: ${config.fontFamily} !important;`);
    }

    if (config.textStroke > 0) {
        lines.push(`  -webkit-text-stroke: ${config.textStroke}px !important;`);
        lines.push(`  text-stroke: ${config.textStroke}px !important;`);
    }

    lines.push('}');

    return lines.join('\n');
}

```

### generators\svg-filter.ts

```
import type {Theme, InversionFix} from '../definitions';
import {isFirefox} from '../utils/platform';

import {cssFilterStyleSheetTemplate} from './css-filter';
import {createFilterMatrix, Matrix} from './utils/matrix';
import type {SitePropsIndex} from './utils/parse';

export function createSVGFilterStylesheet(config: Theme, url: string, isTopFrame: boolean, fixes: string, index: SitePropsIndex<InversionFix>): string {
    let filterValue: string;
    let reverseFilterValue: string;
    if (isFirefox) {
        filterValue = getEmbeddedSVGFilterValue(getSVGFilterMatrixValue(config));
        reverseFilterValue = getEmbeddedSVGFilterValue(getSVGReverseFilterMatrixValue());
    } else {
        // Chrome fails with "Unsafe attempt to load URL ... Domains, protocols and ports must match.
        filterValue = 'url(#dark-reader-filter)';
        reverseFilterValue = 'url(#dark-reader-reverse-filter)';
    }
    const filterRoot = isFirefox ? 'body' : 'html';
    return cssFilterStyleSheetTemplate(filterRoot, filterValue, reverseFilterValue, config, url, isTopFrame, fixes, index);
}

function getEmbeddedSVGFilterValue(matrixValue: string): string {
    const id = 'dark-reader-filter';
    const svg = [
        '<svg xmlns="http://www.w3.org/2000/svg">',
        `<filter id="${id}" style="color-interpolation-filters: sRGB;">`,
        `<feColorMatrix type="matrix" values="${matrixValue}" />`,
        '</filter>',
        '</svg>',
    ].join('');
    return `url(data:image/svg+xml;base64,${btoa(svg)}#${id})`;
}

function toSVGMatrix(matrix: number[][]): string {
    return matrix.slice(0, 4).map((m) => m.map((m) => m.toFixed(3)).join(' ')).join(' ');
}

export function getSVGFilterMatrixValue(config: Theme): string {
    return toSVGMatrix(createFilterMatrix(config));
}

export function getSVGReverseFilterMatrixValue(): string {
    return toSVGMatrix(Matrix.invertNHue());
}

```

### generators\static-theme.ts

```
import type {Theme, StaticTheme} from '../definitions';
import {parseArray, formatArray} from '../utils/text';
import {compareURLPatterns, isURLInList} from '../utils/url';

import {createTextStyle} from './text-style';
import {formatSitesFixesConfig} from './utils/format';
import {applyColorMatrix, createFilterMatrix} from './utils/matrix';
import {parseSitesFixesConfig, getSitesFixesFor} from './utils/parse';
import type {SitePropsIndex} from './utils/parse';

interface ThemeColors {
    [prop: string]: number[];
    neutralBg: number[];
    neutralText: number[];
    redBg: number[];
    redText: number[];
    greenBg: number[];
    greenText: number[];
    blueBg: number[];
    blueText: number[];
    fadeBg: number[];
    fadeText: number[];
}

const darkTheme: ThemeColors = {
    neutralBg: [16, 20, 23],
    neutralText: [167, 158, 139],
    redBg: [64, 12, 32],
    redText: [247, 142, 102],
    greenBg: [32, 64, 48],
    greenText: [128, 204, 148],
    blueBg: [32, 48, 64],
    blueText: [128, 182, 204],
    fadeBg: [16, 20, 23, 0.5],
    fadeText: [167, 158, 139, 0.5],
};

const lightTheme: ThemeColors = {
    neutralBg: [255, 242, 228],
    neutralText: [0, 0, 0],
    redBg: [255, 85, 170],
    redText: [140, 14, 48],
    greenBg: [192, 255, 170],
    greenText: [0, 128, 0],
    blueBg: [173, 215, 229],
    blueText: [28, 16, 171],
    fadeBg: [0, 0, 0, 0.5],
    fadeText: [0, 0, 0, 0.5],
};

function rgb([r, g, b, a]: number[]): string {
    if (typeof a === 'number') {
        return `rgba(${r}, ${g}, ${b}, ${a})`;
    }
    return `rgb(${r}, ${g}, ${b})`;
}

function mix(color1: number[], color2: number[], t: number): number[] {
    return color1.map((c, i) => Math.round(c * (1 - t) + color2[i] * t));
}

export default function createStaticStylesheet(config: Theme, url: string, isTopFrame: boolean, staticThemes: string, staticThemesIndex: SitePropsIndex<StaticTheme>): string {
    const srcTheme = config.mode === 1 ? darkTheme : lightTheme;
    const theme = Object.entries(srcTheme).reduce((t, [prop, color]) => {
        const [r, g, b, a] = color;
        t[prop] = applyColorMatrix([r, g, b], createFilterMatrix({...config, mode: 0}));
        if (a !== undefined) {
            t[prop].push(a);
        }
        return t;
    }, {} as ThemeColors);

    const commonTheme = getCommonTheme(staticThemes, staticThemesIndex);
    const siteTheme = getThemeFor(url, staticThemes, staticThemesIndex);

    const lines: string[] = [];

    if (!siteTheme || !siteTheme.noCommon) {
        lines.push('/* Common theme */');
        lines.push(...ruleGenerators.map((gen) => gen(commonTheme, theme)!));
    }

    if (siteTheme) {
        lines.push(`/* Theme for ${siteTheme.url.join(' ')} */`);
        lines.push(...ruleGenerators.map((gen) => gen(siteTheme, theme)!));
    }

    if (config.useFont || config.textStroke > 0) {
        lines.push('/* Font */');
        lines.push(createTextStyle(config));
    }

    return lines
        .filter((ln) => ln)
        .join('\n');
}

function createRuleGen(getSelectors: (siteTheme: StaticTheme) => string[] | undefined, generateDeclarations: (theme: ThemeColors) => string[], modifySelector: ((s: string) => string) = (s) => s) {
    return (siteTheme: StaticTheme, themeColors: ThemeColors) => {
        const selectors = getSelectors(siteTheme);
        if (selectors == null || selectors.length === 0) {
            return null;
        }
        const lines: string[] = [];
        selectors.forEach((s, i) => {
            let ln = modifySelector(s);
            if (i < selectors.length - 1) {
                ln += ',';
            } else {
                ln += ' {';
            }
            lines.push(ln);
        });
        const declarations = generateDeclarations(themeColors);
        declarations.forEach((d) => lines.push(`    ${d} !important;`));
        lines.push('}');
        return lines.join('\n');
    };
}

const mx = {
    bg: {
        hover: 0.075,
        active: 0.1,
    },
    fg: {
        hover: 0.25,
        active: 0.5,
    },
    border: 0.5,
};

const ruleGenerators = [
    createRuleGen((t) => t.neutralBg, (t) => [`background-color: ${rgb(t.neutralBg)}`]),
    createRuleGen((t) => t.neutralBgActive, (t) => [`background-color: ${rgb(t.neutralBg)}`]),
    createRuleGen((t) => t.neutralBgActive, (t) => [`background-color: ${rgb(mix(t.neutralBg, [255, 255, 255], mx.bg.hover))}`], (s) => `${s}:hover`),
    createRuleGen((t) => t.neutralBgActive, (t) => [`background-color: ${rgb(mix(t.neutralBg, [255, 255, 255], mx.bg.active))}`], (s) => `${s}:active, ${s}:focus`),
    createRuleGen((t) => t.neutralText, (t) => [`color: ${rgb(t.neutralText)}`]),
    createRuleGen((t) => t.neutralTextActive, (t) => [`color: ${rgb(t.neutralText)}`]),
    createRuleGen((t) => t.neutralTextActive, (t) => [`color: ${rgb(mix(t.neutralText, [255, 255, 255], mx.fg.hover))}`], (s) => `${s}:hover`),
    createRuleGen((t) => t.neutralTextActive, (t) => [`color: ${rgb(mix(t.neutralText, [255, 255, 255], mx.fg.active))}`], (s) => `${s}:active, ${s}:focus`),
    createRuleGen((t) => t.neutralBorder, (t) => [`border-color: ${rgb(mix(t.neutralBg, t.neutralText, mx.border))}`]),

    createRuleGen((t) => t.redBg, (t) => [`background-color: ${rgb(t.redBg)}`]),
    createRuleGen((t) => t.redBgActive, (t) => [`background-color: ${rgb(t.redBg)}`]),
    createRuleGen((t) => t.redBgActive, (t) => [`background-color: ${rgb(mix(t.redBg, [255, 0, 64], mx.bg.hover))}`], (s) => `${s}:hover`),
    createRuleGen((t) => t.redBgActive, (t) => [`background-color: ${rgb(mix(t.redBg, [255, 0, 64], mx.bg.active))}`], (s) => `${s}:active, ${s}:focus`),
    createRuleGen((t) => t.redText, (t) => [`color: ${rgb(t.redText)}`]),
    createRuleGen((t) => t.redTextActive, (t) => [`color: ${rgb(t.redText)}`]),
    createRuleGen((t) => t.redTextActive, (t) => [`color: ${rgb(mix(t.redText, [255, 255, 0], mx.fg.hover))}`], (s) => `${s}:hover`),
    createRuleGen((t) => t.redTextActive, (t) => [`color: ${rgb(mix(t.redText, [255, 255, 0], mx.fg.active))}`], (s) => `${s}:active, ${s}:focus`),
    createRuleGen((t) => t.redBorder, (t) => [`border-color: ${rgb(mix(t.redBg, t.redText, mx.border))}`]),

    createRuleGen((t) => t.greenBg, (t) => [`background-color: ${rgb(t.greenBg)}`]),
    createRuleGen((t) => t.greenBgActive, (t) => [`background-color: ${rgb(t.greenBg)}`]),
    createRuleGen((t) => t.greenBgActive, (t) => [`background-color: ${rgb(mix(t.greenBg, [128, 255, 182], mx.bg.hover))}`], (s) => `${s}:hover`),
    createRuleGen((t) => t.greenBgActive, (t) => [`background-color: ${rgb(mix(t.greenBg, [128, 255, 182], mx.bg.active))}`], (s) => `${s}:active, ${s}:focus`),
    createRuleGen((t) => t.greenText, (t) => [`color: ${rgb(t.greenText)}`]),
    createRuleGen((t) => t.greenTextActive, (t) => [`color: ${rgb(t.greenText)}`]),
    createRuleGen((t) => t.greenTextActive, (t) => [`color: ${rgb(mix(t.greenText, [182, 255, 224], mx.fg.hover))}`], (s) => `${s}:hover`),
    createRuleGen((t) => t.greenTextActive, (t) => [`color: ${rgb(mix(t.greenText, [182, 255, 224], mx.fg.active))}`], (s) => `${s}:active, ${s}:focus`),
    createRuleGen((t) => t.greenBorder, (t) => [`border-color: ${rgb(mix(t.greenBg, t.greenText, mx.border))}`]),

    createRuleGen((t) => t.blueBg, (t) => [`background-color: ${rgb(t.blueBg)}`]),
    createRuleGen((t) => t.blueBgActive, (t) => [`background-color: ${rgb(t.blueBg)}`]),
    createRuleGen((t) => t.blueBgActive, (t) => [`background-color: ${rgb(mix(t.blueBg, [0, 128, 255], mx.bg.hover))}`], (s) => `${s}:hover`),
    createRuleGen((t) => t.blueBgActive, (t) => [`background-color: ${rgb(mix(t.blueBg, [0, 128, 255], mx.bg.active))}`], (s) => `${s}:active, ${s}:focus`),
    createRuleGen((t) => t.blueText, (t) => [`color: ${rgb(t.blueText)}`]),
    createRuleGen((t) => t.blueTextActive, (t) => [`color: ${rgb(t.blueText)}`]),
    createRuleGen((t) => t.blueTextActive, (t) => [`color: ${rgb(mix(t.blueText, [182, 224, 255], mx.fg.hover))}`], (s) => `${s}:hover`),
    createRuleGen((t) => t.blueTextActive, (t) => [`color: ${rgb(mix(t.blueText, [182, 224, 255], mx.fg.active))}`], (s) => `${s}:active, ${s}:focus`),
    createRuleGen((t) => t.blueBorder, (t) => [`border-color: ${rgb(mix(t.blueBg, t.blueText, mx.border))}`]),

    createRuleGen((t) => t.fadeBg, (t) => [`background-color: ${rgb(t.fadeBg)}`]),
    createRuleGen((t) => t.fadeText, (t) => [`color: ${rgb(t.fadeText)}`]),
    createRuleGen((t) => t.transparentBg, () => ['background-color: transparent']),
    createRuleGen((t) => t.noImage, () => ['background-image: none']),
    createRuleGen((t) => t.invert, () => ['filter: invert(100%) hue-rotate(180deg)']),
];

const staticThemeCommands: { [key: string]: keyof StaticTheme } = {
    'NO COMMON': 'noCommon',

    'NEUTRAL BG': 'neutralBg',
    'NEUTRAL BG ACTIVE': 'neutralBgActive',
    'NEUTRAL TEXT': 'neutralText',
    'NEUTRAL TEXT ACTIVE': 'neutralTextActive',
    'NEUTRAL BORDER': 'neutralBorder',

    'RED BG': 'redBg',
    'RED BG ACTIVE': 'redBgActive',
    'RED TEXT': 'redText',
    'RED TEXT ACTIVE': 'redTextActive',
    'RED BORDER': 'redBorder',

    'GREEN BG': 'greenBg',
    'GREEN BG ACTIVE': 'greenBgActive',
    'GREEN TEXT': 'greenText',
    'GREEN TEXT ACTIVE': 'greenTextActive',
    'GREEN BORDER': 'greenBorder',

    'BLUE BG': 'blueBg',
    'BLUE BG ACTIVE': 'blueBgActive',
    'BLUE TEXT': 'blueText',
    'BLUE TEXT ACTIVE': 'blueTextActive',
    'BLUE BORDER': 'blueBorder',

    'FADE BG': 'fadeBg',
    'FADE TEXT': 'fadeText',
    'TRANSPARENT BG': 'transparentBg',

    'NO IMAGE': 'noImage',
    'INVERT': 'invert',
};

export function parseStaticThemes($themes: string): StaticTheme[] {
    return parseSitesFixesConfig<StaticTheme>($themes, {
        commands: Object.keys(staticThemeCommands),
        getCommandPropName: (command) => staticThemeCommands[command],
        parseCommandValue: (command, value) => {
            if (command === 'NO COMMON') {
                return true;
            }
            return parseArray(value);
        },
    });
}

function camelCaseToUpperCase(text: string): string {
    return text.replace(/([a-z])([A-Z])/g, '$1 $2').toUpperCase();
}

export function formatStaticThemes(staticThemes: StaticTheme[]): string {
    const themes = staticThemes.slice().sort((a, b) => compareURLPatterns(a.url[0], b.url[0]));

    return formatSitesFixesConfig(themes, {
        props: Object.values(staticThemeCommands),
        getPropCommandName: camelCaseToUpperCase,
        formatPropValue: (prop, value) => {
            if (prop === 'noCommon') {
                return '';
            }
            return formatArray(value as string[]).trim();
        },
        shouldIgnoreProp: (prop, value) => {
            if (prop === 'noCommon') {
                return !value;
            }
            return !(Array.isArray(value) && value.length > 0);
        },
    });
}

function getCommonTheme(staticThemes: string, staticThemesIndex: SitePropsIndex<StaticTheme>): StaticTheme {
    const length = parseInt(staticThemesIndex.offsets.substring(4, 4 + 3), 36);
    const staticThemeText = staticThemes.substring(0, length);
    return parseStaticThemes(staticThemeText)[0];
}

function getThemeFor(url: string, staticThemes: string, staticThemesIndex: SitePropsIndex<StaticTheme>): Readonly<StaticTheme> | null {
    const themes = getSitesFixesFor<StaticTheme>(url, staticThemes, staticThemesIndex, {
        commands: Object.keys(staticThemeCommands),
        getCommandPropName: (command) => staticThemeCommands[command],
        parseCommandValue: (command, value) => {
            if (command === 'NO COMMON') {
                return true;
            }
            return parseArray(value);
        },
    });
    const sortedBySpecificity = themes
        .slice(1)
        .map((theme) => {
            return {
                specificity: isURLInList(url, theme.url) ? theme.url[0].length : 0,
                theme,
            };
        })
        .filter(({specificity}) => specificity > 0)
        .sort((a, b) => b.specificity - a.specificity);

    if (sortedBySpecificity.length === 0) {
        return null;
    }

    return sortedBySpecificity[0].theme;
}

```

### generators\dynamic-theme.ts

```
import type {DynamicThemeFix} from '../definitions';
import {formatCSS} from '../utils/css-text/format-css';
import {parseArray, formatArray} from '../utils/text';
import {compareURLPatterns} from '../utils/url';

import {formatSitesFixesConfig} from './utils/format';
import {parseSitesFixesConfig, getSitesFixesFor, getDomain} from './utils/parse';
import type {SitePropsIndex} from './utils/parse';

declare const __CHROMIUM_MV2__: boolean;
declare const __CHROMIUM_MV3__: boolean;

const dynamicThemeFixesCommands: { [key: string]: keyof DynamicThemeFix } = {
    'INVERT': 'invert',
    'CSS': 'css',
    'IGNORE INLINE STYLE': 'ignoreInlineStyle',
    'IGNORE IMAGE ANALYSIS': 'ignoreImageAnalysis',
};

export function parseDynamicThemeFixes(text: string): DynamicThemeFix[] {
    return parseSitesFixesConfig<DynamicThemeFix>(text, {
        commands: Object.keys(dynamicThemeFixesCommands),
        getCommandPropName: (command) => dynamicThemeFixesCommands[command],
        parseCommandValue: (command, value) => {
            if (command === 'CSS') {
                return value.trim();
            }
            return parseArray(value);
        },
    });
}

export function formatDynamicThemeFixes(dynamicThemeFixes: DynamicThemeFix[]): string {
    const fixes = dynamicThemeFixes.slice().sort((a, b) => compareURLPatterns(a.url[0], b.url[0]));

    return formatSitesFixesConfig(fixes, {
        props: Object.values(dynamicThemeFixesCommands),
        getPropCommandName: (prop) => Object.entries(dynamicThemeFixesCommands).find(([, p]) => p === prop)![0],
        formatPropValue: (prop, value) => {
            if (prop === 'css') {
                return formatCSS(value as string);
            }
            return formatArray(value as string[]).trim();
        },
        shouldIgnoreProp: (prop, value) => {
            if (prop === 'css') {
                return !value;
            }
            return !(Array.isArray(value) && value.length > 0);
        },
    });
}

export function getDynamicThemeFixesFor(url: string, isTopFrame: boolean, text: string, index: SitePropsIndex<DynamicThemeFix>, enabledForPDF: boolean): DynamicThemeFix[] | null {
    const fixes = getSitesFixesFor(url, text, index, {
        commands: Object.keys(dynamicThemeFixesCommands),
        getCommandPropName: (command) => dynamicThemeFixesCommands[command],
        parseCommandValue: (command, value) => {
            if (command === 'CSS') {
                return value.trim();
            }
            return parseArray(value);
        },
    });

    if (fixes.length === 0 || fixes[0].url[0] !== '*') {
        return null;
    }

    if (enabledForPDF) {
        // Copy part of fixes which will be mutated
        const commonFix = {
            ...fixes[0],
            css: fixes[0].css,
            invert: [...fixes[0].invert],
        };
        const pdfFixes: DynamicThemeFix[] = [
            commonFix,
            ...fixes.slice(1),
        ];

        const inversionFix = __CHROMIUM_MV2__ || __CHROMIUM_MV3__ ?
            '\nembed[type="application/pdf"][src="about:blank"] { filter: invert(100%) contrast(90%); }' :
            '\nembed[type="application/pdf"] { filter: invert(100%) contrast(90%); }';
        if (!commonFix.css.endsWith(inversionFix)) {
            commonFix.css += inversionFix;
        }

        if (['drive.google.com', 'mail.google.com'].includes(getDomain(url))) {
            const nestedInversionFix = 'div[role="dialog"] div[role="document"]';
            if (commonFix.invert.at(-1) !== nestedInversionFix) {
                commonFix.invert.push(nestedInversionFix);
            }
        }

        return pdfFixes;
    }

    return fixes;
}

```

### generators\detector-hints.ts

```
import type {DetectorHint} from '../definitions';
import {parseArray, formatArray} from '../utils/text';
import {compareURLPatterns} from '../utils/url';

import {formatSitesFixesConfig} from './utils/format';
import {parseSitesFixesConfig, getSitesFixesFor} from './utils/parse';
import type {SitePropsIndex, SitesFixesParserOptions} from './utils/parse';

const detectorHintsCommands: { [key: string]: keyof DetectorHint } = {
    'TARGET': 'target',
    'MATCH': 'match',
    'NO DARK THEME': 'noDarkTheme',
    'SYSTEM THEME': 'systemTheme',
    'IFRAME': 'iframe',
};

const detectorParserOptions: SitesFixesParserOptions<DetectorHint> = {
    commands: Object.keys(detectorHintsCommands),
    getCommandPropName: (command) => detectorHintsCommands[command],
    parseCommandValue: (command, value) => {
        if (command === 'TARGET') {
            return value.trim();
        }
        if (command === 'NO DARK THEME' || command === 'SYSTEM THEME') {
            return true;
        }
        return parseArray(value);
    },
};

export function parseDetectorHints(text: string): DetectorHint[] {
    return parseSitesFixesConfig<DetectorHint>(text, detectorParserOptions);
}

export function formatDetectorHints(detectorHints: DetectorHint[]): string {
    const fixes = detectorHints.slice().sort((a, b) => compareURLPatterns(a.url[0], b.url[0]));

    return formatSitesFixesConfig(fixes, {
        props: Object.values(detectorHintsCommands),
        getPropCommandName: (prop) => Object.entries(detectorHintsCommands).find(([, p]) => p === prop)![0],
        formatPropValue: (prop: keyof DetectorHint, value) => {
            if (Array.isArray(value)) {
                return formatArray(value).trim();
            }
            if (prop === 'noDarkTheme' || prop === 'systemTheme') {
                return '';
            }
            return String(value).trim();
        },
        shouldIgnoreProp: (_prop, value) => {
            return !value;
        },
    });
}

export function getDetectorHintsFor(url: string, text: string, index: SitePropsIndex<DetectorHint>): DetectorHint[] | null {
    const fixes = getSitesFixesFor(url, text, index, detectorParserOptions);

    if (fixes.length === 0) {
        return null;
    }

    return fixes;
}

```

### generators\css-filter.ts

```
import type {Theme, InversionFix} from '../definitions';
import {compareChromeVersions, chromiumVersion, isFirefox, firefoxVersion} from '../utils/platform';
import {parseArray, formatArray} from '../utils/text';
import {compareURLPatterns, isURLInList} from '../utils/url';

import {createTextStyle} from './text-style';
import {formatSitesFixesConfig} from './utils/format';
import {applyColorMatrix, createFilterMatrix} from './utils/matrix';
import {parseSitesFixesConfig, getSitesFixesFor} from './utils/parse';
import type {SitePropsIndex} from './utils/parse';


declare const __CHROMIUM_MV2__: boolean;
declare const __CHROMIUM_MV3__: boolean;

export enum FilterMode {
    light = 0,
    dark = 1
}

/**
 * This checks if the current chromium version has the patch in it.
 * As of Chromium v81.0.4035.0 this has been the situation
 *
 * Bug report: https://bugs.chromium.org/p/chromium/issues/detail?id=501582
 * Patch: https://chromium-review.googlesource.com/c/chromium/src/+/1979258
 */
export function hasPatchForChromiumIssue501582(): boolean {
    return __CHROMIUM_MV3__ || Boolean(
        __CHROMIUM_MV2__ &&
        compareChromeVersions(chromiumVersion, '81.0.4035.0') >= 0
    );
}

/**
 * Since Firefox v102.0, they have changed to the new root behavior.
 * This was already the case for Chromium v81.0.4035.0 and Firefox now
 * switched over as well.
 */
export function hasFirefoxNewRootBehavior(): boolean {
    return Boolean(
        isFirefox &&
        compareChromeVersions(firefoxVersion, '102.0') >= 0
    );
}

export default function createCSSFilterStyleSheet(config: Theme, url: string, isTopFrame: boolean, fixes: string, index: SitePropsIndex<InversionFix>): string {
    const filterValue = getCSSFilterValue(config)!;
    const reverseFilterValue = 'invert(100%) hue-rotate(180deg)';
    return cssFilterStyleSheetTemplate('html', filterValue, reverseFilterValue, config, url, isTopFrame, fixes, index);
}

export function cssFilterStyleSheetTemplate(filterRoot: string, filterValue: string, reverseFilterValue: string, config: Theme, url: string, isTopFrame: boolean, fixes: string, index: SitePropsIndex<InversionFix>): string {
    const fix = getInversionFixesFor(url, fixes, index);

    const lines: string[] = [];

    lines.push('@media screen {');

    // Add leading rule
    if (filterValue && isTopFrame) {
        lines.push('');
        lines.push('/* Leading rule */');
        lines.push(createLeadingRule(filterRoot, filterValue));
    }

    if (config.mode === FilterMode.dark) {
        // Add reverse rule
        lines.push('');
        lines.push('/* Reverse rule */');
        lines.push(createReverseRule(reverseFilterValue, fix));
    }

    if (config.useFont || config.textStroke > 0) {
        // Add text rule
        lines.push('');
        lines.push('/* Font */');
        lines.push(createTextStyle(config));
    }

    // Fix bad font hinting after inversion
    lines.push('');
    lines.push('/* Text contrast */');
    lines.push('html {');
    lines.push('  text-shadow: 0 0 0 !important;');
    lines.push('}');

    // Full screen fix
    lines.push('');
    lines.push('/* Full screen */');
    [':-webkit-full-screen', ':-moz-full-screen', ':fullscreen'].forEach((fullScreen) => {
        lines.push(`${fullScreen}, ${fullScreen} * {`);
        lines.push('  -webkit-filter: none !important;');
        lines.push('  filter: none !important;');
        lines.push('}');
    });

    if (isTopFrame) {
        const light: [number, number, number] = [255, 255, 255];
        // If browser affected by Chromium Issue 501582, set dark background on html
        // Or if browser is Firefox v102+
        const bgColor = (!hasPatchForChromiumIssue501582() && !hasFirefoxNewRootBehavior()) && config.mode === FilterMode.dark ?
            applyColorMatrix(light, createFilterMatrix(config)).map(Math.round) :
            light;
        lines.push('');
        lines.push('/* Page background */');
        lines.push('html {');
        lines.push(`  background: rgb(${bgColor.join(',')}) !important;`);
        lines.push('}');
    }

    if (fix.css && fix.css.length > 0 && config.mode === FilterMode.dark) {
        lines.push('');
        lines.push('/* Custom rules */');
        lines.push(fix.css);
    }

    lines.push('');
    lines.push('}');

    return lines.join('\n');
}

export function getCSSFilterValue(config: Theme): string | null {
    const filters: string[] = [];

    if (config.mode === FilterMode.dark) {
        filters.push('invert(100%) hue-rotate(180deg)');
    }
    if (config.brightness !== 100) {
        filters.push(`brightness(${config.brightness}%)`);
    }
    if (config.contrast !== 100) {
        filters.push(`contrast(${config.contrast}%)`);
    }
    if (config.grayscale !== 0) {
        filters.push(`grayscale(${config.grayscale}%)`);
    }
    if (config.sepia !== 0) {
        filters.push(`sepia(${config.sepia}%)`);
    }

    if (filters.length === 0) {
        return null;
    }

    return filters.join(' ');
}

function createLeadingRule(filterRoot: string, filterValue: string): string {
    return [
        `${filterRoot} {`,
        `  -webkit-filter: ${filterValue} !important;`,
        `  filter: ${filterValue} !important;`,
        '}',
    ].join('\n');
}

function joinSelectors(selectors: string[]): string {
    return selectors.map((s) => s.replace(/\,$/, '')).join(',\n');
}

function createReverseRule(reverseFilterValue: string, fix: InversionFix): string {
    const lines: string[] = [];

    if (fix.invert.length > 0) {
        lines.push(`${joinSelectors(fix.invert)} {`);
        lines.push(`  -webkit-filter: ${reverseFilterValue} !important;`);
        lines.push(`  filter: ${reverseFilterValue} !important;`);
        lines.push('}');
    }

    if (fix.noinvert.length > 0) {
        lines.push(`${joinSelectors(fix.noinvert)} {`);
        lines.push('  -webkit-filter: none !important;');
        lines.push('  filter: none !important;');
        lines.push('}');
    }

    if (fix.removebg.length > 0) {
        lines.push(`${joinSelectors(fix.removebg)} {`);
        lines.push('  background: white !important;');
        lines.push('}');
    }

    return lines.join('\n');
}

/**
* Returns fixes for a given URL.
* If no matches found, common fixes will be returned.
* @param url Site URL.
* @param inversionFixes List of inversion fixes.
*/
export function getInversionFixesFor(url: string, fixes: string, index: SitePropsIndex<InversionFix>): InversionFix {
    const inversionFixes = getSitesFixesFor<InversionFix>(url, fixes, index, {
        commands: Object.keys(inversionFixesCommands),
        getCommandPropName: (command) => inversionFixesCommands[command],
        parseCommandValue: (command, value) => {
            if (command === 'CSS') {
                return value.trim();
            }
            return parseArray(value);
        },
    });

    const common = {
        url: inversionFixes[0].url,
        invert: inversionFixes[0].invert || [],
        noinvert: inversionFixes[0].noinvert || [],
        removebg: inversionFixes[0].removebg || [],
        css: inversionFixes[0].css || '',
    };

    if (url) {
        // Search for match with given URL
        const matches = inversionFixes
            .slice(1)
            .filter((s) => isURLInList(url, s.url))
            .sort((a, b) => b.url[0].length - a.url[0].length);
        if (matches.length > 0) {
            const found = matches[0];
            return {
                url: found.url,
                invert: common.invert.concat(found.invert || []),
                noinvert: common.noinvert.concat(found.noinvert || []),
                removebg: common.removebg.concat(found.removebg || []),
                css: [common.css, found.css].filter((s) => s).join('\n'),
            };
        }
    }
    return common;
}

const inversionFixesCommands: { [key: string]: keyof InversionFix } = {
    'INVERT': 'invert',
    'NO INVERT': 'noinvert',
    'REMOVE BG': 'removebg',
    'CSS': 'css',
};

export function parseInversionFixes(text: string): InversionFix[] {
    return parseSitesFixesConfig<InversionFix>(text, {
        commands: Object.keys(inversionFixesCommands),
        getCommandPropName: (command) => inversionFixesCommands[command],
        parseCommandValue: (command, value) => {
            if (command === 'CSS') {
                return value.trim();
            }
            return parseArray(value);
        },
    });
}

export function formatInversionFixes(inversionFixes: InversionFix[]): string {
    const fixes = inversionFixes.slice().sort((a, b) => compareURLPatterns(a.url[0], b.url[0]));

    return formatSitesFixesConfig(fixes, {
        props: Object.values(inversionFixesCommands),
        getPropCommandName: (prop) => Object.entries(inversionFixesCommands).find(([, p]) => p === prop)![0],
        formatPropValue: (prop, value) => {
            if (prop === 'css') {
                return (value as string).trim().replace(/\n+/g, '\n');
            }
            return formatArray(value as string[]).trim();
        },
        shouldIgnoreProp: (prop, value) => {
            if (prop === 'css') {
                return !value;
            }
            return !(Array.isArray(value) && value.length > 0);
        },
    });
}

```

### inject\dynamic-theme\watch\style-position.ts

```
import {push} from '../../../utils/array';
import type {ElementsTreeOperations} from '../../utils/dom';
import {iterateShadowHosts, createOptimizedTreeObserver} from '../../utils/dom';
import {checkImageSelectors} from '../modify-css';
import type {StyleElement} from '../style-manager';
import {shouldManageStyle, getManageableStyles} from '../style-manager';

import {collectUndefinedElements, handleIsDefined, isCustomElement, recordUndefinedElement, unsubscribeFromDefineCustomElements, watchWhenCustomElementsDefined} from './custom-elements';

const observers: Array<{disconnect(): void}> = [];
let observedRoots: WeakSet<Node>;
let handledShadowHosts: WeakSet<Node>;

interface ChangedStyles {
    created: StyleElement[];
    updated: StyleElement[];
    removed: StyleElement[];
    moved: StyleElement[];
}

export function watchForStylePositions(
    currentStyles: StyleElement[],
    update: (styles: ChangedStyles) => void,
    shadowRootDiscovered: (root: ShadowRoot) => void
): void {
    stopWatchingForStylePositions();

    const prevStylesByRoot = new WeakMap<Node, Set<StyleElement>>();
    const getPrevStyles = (root: Node) => {
        if (!prevStylesByRoot.has(root)) {
            prevStylesByRoot.set(root, new Set());
        }
        return prevStylesByRoot.get(root)!;
    };
    currentStyles.forEach((node) => {
        let root: Node | null = node;
        while ((root = root.parentNode)) {
            if (root === document || root.nodeType === Node.DOCUMENT_FRAGMENT_NODE) {
                const prevStyles = getPrevStyles(root);
                prevStyles.add(node);
                break;
            }
        }
    });
    const prevStyleSiblings = new WeakMap<Element, Element>();
    const nextStyleSiblings = new WeakMap<Element, Element>();

    function saveStylePosition(style: StyleElement) {
        prevStyleSiblings.set(style, style.previousElementSibling!);
        nextStyleSiblings.set(style, style.nextElementSibling!);
    }

    function forgetStylePosition(style: StyleElement) {
        prevStyleSiblings.delete(style);
        nextStyleSiblings.delete(style);
    }

    function didStylePositionChange(style: StyleElement) {
        return (
            style.previousElementSibling !== prevStyleSiblings.get(style) ||
            style.nextElementSibling !== nextStyleSiblings.get(style)
        );
    }

    currentStyles.forEach(saveStylePosition);

    function handleStyleOperations(root: Document | ShadowRoot, operations: {createdStyles: Set<StyleElement>; movedStyles: Set<StyleElement>; removedStyles: Set<StyleElement>}) {
        const {createdStyles, removedStyles, movedStyles} = operations;

        createdStyles.forEach((s) => saveStylePosition(s));
        movedStyles.forEach((s) => saveStylePosition(s));
        removedStyles.forEach((s) => forgetStylePosition(s));

        const prevStyles = getPrevStyles(root);
        createdStyles.forEach((s) => prevStyles.add(s));
        removedStyles.forEach((s) => prevStyles.delete(s));

        if (createdStyles.size + removedStyles.size + movedStyles.size > 0) {
            update({
                created: Array.from(createdStyles),
                removed: Array.from(removedStyles),
                moved: Array.from(movedStyles),
                updated: [],
            });
        }
    }

    function handleMinorTreeMutations(root: Document | ShadowRoot, {additions, moves, deletions}: ElementsTreeOperations) {
        const createdStyles = new Set<StyleElement>();
        const removedStyles = new Set<StyleElement>();
        const movedStyles = new Set<StyleElement>();

        additions.forEach((node) => getManageableStyles(node).forEach((style) => createdStyles.add(style)));
        deletions.forEach((node) => getManageableStyles(node).forEach((style) => removedStyles.add(style)));
        moves.forEach((node) => getManageableStyles(node).forEach((style) => movedStyles.add(style)));

        handleStyleOperations(root, {createdStyles, removedStyles, movedStyles});

        additions.forEach((n) => {
            deepObserve(n);
            collectUndefinedElements(n);
        });

        // Firefox occasionally fails to reflect existence of a node in both CSS's view of the DOM (':not(:defined)'),
        // and in DOM walker's view of the DOM. So instead we also check these mutations just in case.
        // In practice, at least one place reflects appearance of the node.
        // URL for testing: https://chromestatus.com/roadmap
        additions.forEach((node) => isCustomElement(node) && recordUndefinedElement(node));

        additions.forEach((node) => checkImageSelectors(node));
    }

    function handleHugeTreeMutations(root: Document | ShadowRoot) {
        const styles = new Set(getManageableStyles(root));

        const createdStyles = new Set<StyleElement>();
        const removedStyles = new Set<StyleElement>();
        const movedStyles = new Set<StyleElement>();
        const prevStyles = getPrevStyles(root);
        styles.forEach((s) => {
            if (!prevStyles.has(s)) {
                createdStyles.add(s);
            }
        });
        prevStyles.forEach((s) => {
            if (!styles.has(s)) {
                removedStyles.add(s);
            }
        });
        styles.forEach((s) => {
            if (!createdStyles.has(s) && !removedStyles.has(s) && didStylePositionChange(s)) {
                movedStyles.add(s);
            }
        });

        handleStyleOperations(root, {createdStyles, removedStyles, movedStyles});

        deepObserve(root);
        collectUndefinedElements(root);

        checkImageSelectors(root);
    }

    function handleAttributeMutations(mutations: MutationRecord[]) {
        const updatedStyles = new Set<StyleElement>();
        const removedStyles = new Set<StyleElement>();
        mutations.forEach((m) => {
            const {target} = m;
            if (target.isConnected) {
                if (shouldManageStyle(target)) {
                    updatedStyles.add(target as StyleElement);
                } else if (target instanceof HTMLLinkElement && target.disabled) {
                    removedStyles.add(target as StyleElement);
                }
            }
        });
        if (updatedStyles.size + removedStyles.size > 0) {
            update({
                updated: Array.from(updatedStyles),
                created: [],
                removed: Array.from(removedStyles),
                moved: [],
            });
        }
    }

    function observe(root: Document | ShadowRoot) {
        if (observedRoots.has(root)) {
            return;
        }
        const treeObserver = createOptimizedTreeObserver(root, {
            onMinorMutations: handleMinorTreeMutations,
            onHugeMutations: handleHugeTreeMutations,
        });
        const attrObserver = new MutationObserver(handleAttributeMutations);
        attrObserver.observe(root, {attributeFilter: ['rel', 'disabled', 'media', 'href'], subtree: true});
        observers.push(treeObserver, attrObserver);
        observedRoots.add(root);
    }

    function subscribeForShadowRootChanges(node: Element) {
        const {shadowRoot} = node;
        if (shadowRoot == null || observedRoots.has(shadowRoot)) {
            return;
        }
        observe(shadowRoot);
        shadowRootDiscovered(shadowRoot);
    }

    function deepObserve(node: Node) {
        iterateShadowHosts(node, subscribeForShadowRootChanges);
    }

    observe(document);
    deepObserve(document.documentElement);

    watchWhenCustomElementsDefined((hosts) => {
        hosts = hosts.filter((node) => !handledShadowHosts.has(node));
        const newStyles: StyleElement[] = [];
        hosts.forEach((host) => push(newStyles, getManageableStyles(host.shadowRoot)));
        update({created: newStyles, updated: [], removed: [], moved: []});
        hosts.forEach((host) => {
            const {shadowRoot} = host;
            if (shadowRoot == null) {
                return;
            }
            subscribeForShadowRootChanges(host);
            deepObserve(shadowRoot);
            collectUndefinedElements(shadowRoot);
        });
        hosts.forEach((node) => handledShadowHosts.add(node));
    });
    document.addEventListener('__darkreader__isDefined', handleIsDefined);
    collectUndefinedElements(document);
}

function resetObservers() {
    observers.forEach((o) => o.disconnect());
    observers.splice(0, observers.length);
    observedRoots = new WeakSet();
    handledShadowHosts = new WeakSet();
}

export function stopWatchingForStylePositions(): void {
    resetObservers();
    unsubscribeFromDefineCustomElements();
}

```

### inject\dynamic-theme\watch\sheet-changes.ts

```
declare const __THUNDERBIRD__: boolean;

interface SheetWatcher {
    start(): void;
    stop(): void;
}

let canUseSheetProxy = false;
document.addEventListener('__darkreader__inlineScriptsAllowed', () => canUseSheetProxy = true, {once: true});

export function createSheetWatcher(
    element: HTMLLinkElement | HTMLStyleElement,
    safeGetSheetRules: () => CSSRuleList | null,
    callback: () => void,
    isCancelled: () => boolean,
): SheetWatcher {
    let rafSheetWatcher: SheetWatcher | null = null;

    function watchForSheetChanges() {
        watchForSheetChangesUsingProxy();
        // Sometimes sheet can be null in Firefox and Safari
        // So need to watch for it using rAF
        if (!__THUNDERBIRD__ && !(canUseSheetProxy && element.sheet)) {
            rafSheetWatcher = createRAFSheetWatcher(element, safeGetSheetRules, callback, isCancelled);
            rafSheetWatcher.start();
        }
    }

    let areSheetChangesPending = false;

    function onSheetChange() {
        canUseSheetProxy = true;
        rafSheetWatcher?.stop();
        if (areSheetChangesPending) {
            return;
        }

        function handleSheetChanges() {
            areSheetChangesPending = false;
            if (isCancelled()) {
                return;
            }
            callback();
        }

        areSheetChangesPending = true;
        queueMicrotask(handleSheetChanges);
    }

    function watchForSheetChangesUsingProxy() {
        element.addEventListener('__darkreader__updateSheet', onSheetChange);
    }

    function stopWatchingForSheetChangesUsingProxy() {
        element.removeEventListener('__darkreader__updateSheet', onSheetChange);
    }

    function stopWatchingForSheetChanges() {
        stopWatchingForSheetChangesUsingProxy();
        rafSheetWatcher?.stop();
    }

    return {
        start: watchForSheetChanges,
        stop: stopWatchingForSheetChanges,
    };
}

function createRAFSheetWatcher(
    element: HTMLLinkElement | HTMLStyleElement,
    safeGetSheetRules: () => CSSRuleList | null,
    callback: () => void,
    isCancelled: () => boolean,
): SheetWatcher {
    let rulesChangeKey: number | null = null;
    let rulesCheckFrameId: number | null = null;

    function getRulesChangeKey() {
        const rules = safeGetSheetRules();
        return rules ? rules.length : null;
    }

    function didRulesKeyChange() {
        return getRulesChangeKey() !== rulesChangeKey;
    }

    function watchForSheetChangesUsingRAF() {
        rulesChangeKey = getRulesChangeKey();
        stopWatchingForSheetChangesUsingRAF();
        const checkForUpdate = () => {
            const cancelled = isCancelled();
            if (!cancelled && didRulesKeyChange()) {
                rulesChangeKey = getRulesChangeKey();
                callback();
            }
            if (cancelled || canUseSheetProxy && element.sheet) {
                stopWatchingForSheetChangesUsingRAF();
                return;
            }
            rulesCheckFrameId = requestAnimationFrame(checkForUpdate);
        };

        checkForUpdate();
    }

    function stopWatchingForSheetChangesUsingRAF() {
        rulesCheckFrameId && cancelAnimationFrame(rulesCheckFrameId);
    }

    return {
        start: watchForSheetChangesUsingRAF,
        stop: stopWatchingForSheetChangesUsingRAF,
    };
}

```

### inject\dynamic-theme\watch\index.ts

```
import type {StyleElement} from '../style-manager';

import {stopWatchingForStylePositions, watchForStylePositions} from './style-position';

interface ChangedStyles {
    created: StyleElement[];
    updated: StyleElement[];
    removed: StyleElement[];
    moved: StyleElement[];
}

export function watchForStyleChanges(
    currentStyles: StyleElement[],
    update: (styles: ChangedStyles) => void,
    shadowRootDiscovered: (root: ShadowRoot) => void
): void {
    watchForStylePositions(currentStyles, update, shadowRootDiscovered);
}

export function stopWatchingForStyleChanges(): void {
    stopWatchingForStylePositions();
}

```

### inject\dynamic-theme\watch\custom-elements.ts

```
import {forEach} from '../../../utils/array';
import {isDefinedSelectorSupported} from '../../../utils/platform';
import {ASSERT} from '../../utils/log';

// Set of lower-case custom element names which were already defined
const definedCustomElements = new Set<string>();
const undefinedGroups = new Map<string, Set<Element>>();
let elementsDefinitionCallback: ((elements: Element[]) => void) | null;

export function isCustomElement(element: Element): boolean {
    if (element.tagName.includes('-') || element.getAttribute('is')) {
        return true;
    }
    return false;
}

export function recordUndefinedElement(element: Element): void {
    let tag = element.tagName.toLowerCase();
    if (!tag.includes('-')) {
        const extendedTag = element.getAttribute('is');
        if (extendedTag) {
            tag = extendedTag;
        } else {
            // Happens for <template> on YouTube
            return;
        }
    }
    if (!undefinedGroups.has(tag)) {
        undefinedGroups.set(tag, new Set());
        customElementsWhenDefined(tag).then(() => {
            if (elementsDefinitionCallback) {
                const elements = undefinedGroups.get(tag);
                ASSERT('recordUndefinedElement() undefined groups should not be empty', elements);
                undefinedGroups.delete(tag);
                elementsDefinitionCallback(Array.from(elements!));
            }
        });
    }
    undefinedGroups.get(tag)!.add(element);
}

export function collectUndefinedElements(root: ParentNode): void {
    if (!isDefinedSelectorSupported) {
        return;
    }
    forEach(root.querySelectorAll(':not(:defined)'), recordUndefinedElement);
}

let canOptimizeUsingProxy = false;
document.addEventListener('__darkreader__inlineScriptsAllowed', () => {
    canOptimizeUsingProxy = true;
}, {once: true, passive: true});

const unhandledShadowHosts = new Set<Element>();

document.addEventListener('__darkreader__shadowDomAttaching', (e: CustomEvent) => {
    const host = (e.target as HTMLElement);
    if (unhandledShadowHosts.size === 0) {
        queueMicrotask(() => {
            const hosts = [...unhandledShadowHosts].filter((el) => el.shadowRoot);
            elementsDefinitionCallback?.(hosts);
            unhandledShadowHosts.clear();
        });
    }
    unhandledShadowHosts.add(host);
});

const resolvers = new Map<string, Array<() => void>>();

export function handleIsDefined(e: CustomEvent<{tag: string}>): void {
    canOptimizeUsingProxy = true;
    const tag = e.detail.tag;
    ASSERT('handleIsDefined() expects lower-case node names', () => tag.toLowerCase() === tag);
    definedCustomElements.add(tag);
    if (resolvers.has(tag)) {
        const r = resolvers.get(tag)!;
        resolvers.delete(tag);
        r.forEach((r) => r());
    }
}

async function customElementsWhenDefined(tag: string): Promise<void> {
    ASSERT('customElementsWhenDefined() expects lower-case node names', () => tag.toLowerCase() === tag);
    // Custom element is already defined
    if (definedCustomElements.has(tag)) {
        return;
    }
    // We need to await for element to be defined
    return new Promise<void>((resolve) => {
        // `customElements.whenDefined` is not available in extensions
        // https://bugs.chromium.org/p/chromium/issues/detail?id=390807
        if (window.customElements && typeof customElements.whenDefined === 'function') {
            customElements.whenDefined(tag).then(() => resolve());
        } else if (canOptimizeUsingProxy) {
            if (resolvers.has(tag)) {
                resolvers.get(tag)!.push(resolve);
            } else {
                resolvers.set(tag, [resolve]);
            }
            document.dispatchEvent(new CustomEvent('__darkreader__addUndefinedResolver', {detail: {tag}}));
        } else {
            const checkIfDefined = () => {
                const elements = undefinedGroups.get(tag);
                if (elements && elements.size > 0) {
                    if (elements.values().next().value.matches(':defined')) {
                        resolve();
                    } else {
                        requestAnimationFrame(checkIfDefined);
                    }
                }
            };

            requestAnimationFrame(checkIfDefined);
        }
    });
}

export function watchWhenCustomElementsDefined(callback: (elements: Element[]) => void): void {
    elementsDefinitionCallback = callback;
}

export function unsubscribeFromDefineCustomElements(): void {
    elementsDefinitionCallback = null;
    undefinedGroups.clear();
    document.removeEventListener('__darkreader__isDefined', handleIsDefined);
}

```

### inject\dynamic-theme\adopted-style-manger.ts

```
import type {Theme} from '../../definitions';

import {iterateCSSRules} from './css-rules';
import {defineSheetScope} from './style-scope';
import type {CSSBuilder} from './stylesheet-modifier';
import {createStyleSheetModifier} from './stylesheet-modifier';

let canUseSheetProxy = false;
document.addEventListener('__darkreader__inlineScriptsAllowed', () => canUseSheetProxy = true, {once: true});

const overrides = new WeakSet<CSSStyleSheet>();
const overridesBySource = new WeakMap<CSSStyleSheet, CSSStyleSheet>();

export interface AdoptedStyleSheetManager {
    render(theme: Theme, ignoreImageAnalysis: string[]): void;
    destroy(): void;
    watch(callback: (sheets: CSSStyleSheet[]) => void): void;
}

export function canHaveAdoptedStyleSheets(node: Document | ShadowRoot): boolean {
    return Array.isArray(node.adoptedStyleSheets);
}

export function createAdoptedStyleSheetOverride(node: Document | ShadowRoot): AdoptedStyleSheetManager {
    let cancelAsyncOperations = false;

    function iterateSourceSheets(iterator: (sheet: CSSStyleSheet) => void) {
        node.adoptedStyleSheets.forEach((sheet) => {
            if (!overrides.has(sheet)) {
                iterator(sheet);
            }
            defineSheetScope(sheet, node);
        });
    }

    function injectSheet(sheet: CSSStyleSheet, override: CSSStyleSheet) {
        const newSheets = [...node.adoptedStyleSheets];
        const sheetIndex = newSheets.indexOf(sheet);
        const overrideIndex = newSheets.indexOf(override);
        if (overrideIndex >= 0) {
            newSheets.splice(overrideIndex, 1);
        }
        newSheets.splice(sheetIndex + 1, 0, override);
        node.adoptedStyleSheets = newSheets;
    }

    function clear() {
        const newSheets = [...node.adoptedStyleSheets];
        for (let i = newSheets.length - 1; i >= 0; i--) {
            const sheet = newSheets[i];
            if (overrides.has(sheet)) {
                newSheets.splice(i, 1);
            }
        }
        if (node.adoptedStyleSheets.length !== newSheets.length) {
            node.adoptedStyleSheets = newSheets;
        }
        sourceSheets = new WeakSet();
        sourceDeclarations = new WeakSet();
    }

    const cleaners: Array<() => void> = [];

    function destroy() {
        cleaners.forEach((c) => c());
        cleaners.splice(0);
        cancelAsyncOperations = true;
        clear();
        if (frameId) {
            cancelAnimationFrame(frameId);
            frameId = null;
        }
    }

    let rulesChangeKey = 0;

    function getRulesChangeKey() {
        let count = 0;
        iterateSourceSheets((sheet) => {
            count += sheet.cssRules.length;
        });
        if (count === 1) {
            // MS Copilot issue, where there is an empty `:root {}` style at the beginning.
            // Counting all the rules for all the shadow DOM elements can be expensive.
            const rule = node.adoptedStyleSheets[0].cssRules[0];
            return rule instanceof CSSStyleRule ? rule.style.length : count;
        }
        return count;
    }

    let sourceSheets = new WeakSet<CSSStyleSheet>();
    let sourceDeclarations = new WeakSet<CSSStyleDeclaration>();

    function render(theme: Theme, ignoreImageAnalysis: string[]) {
        clear();

        for (let i = node.adoptedStyleSheets.length - 1; i >= 0; i--) {
            const sheet = node.adoptedStyleSheets[i];
            if (overrides.has(sheet)) {
                continue;
            }

            sourceSheets.add(sheet);
            const readyOverride = overridesBySource.get(sheet);
            if (readyOverride) {
                rulesChangeKey = getRulesChangeKey();
                injectSheet(sheet, readyOverride);
                continue;
            }

            const rules = sheet.cssRules;
            const override = new CSSStyleSheet();
            overridesBySource.set(sheet, override);
            iterateCSSRules(rules, (rule) => sourceDeclarations.add(rule.style));

            const prepareSheet = () => {
                for (let i = override.cssRules.length - 1; i >= 0; i--) {
                    override.deleteRule(i);
                }
                override.insertRule('#__darkreader__adoptedOverride {}');
                injectSheet(sheet, override);
                overrides.add(override);
                return override;
            };

            const sheetModifier = createStyleSheetModifier();
            sheetModifier.modifySheet({
                prepareSheet,
                sourceCSSRules: rules,
                theme,
                ignoreImageAnalysis,
                force: false,
                isAsyncCancelled: () => cancelAsyncOperations,
            });
        }

        rulesChangeKey = getRulesChangeKey();
    }

    let callbackRequested = false;

    function handleArrayChange(callback: (sheets: CSSStyleSheet[]) => void) {
        if (callbackRequested) {
            return;
        }
        callbackRequested = true;
        queueMicrotask(() => {
            callbackRequested = false;
            const sheets = node.adoptedStyleSheets.filter((s) => !overrides.has(s));
            sheets.forEach((sheet) => overridesBySource.delete(sheet));
            callback(sheets);
        });
    }

    function checkForUpdates() {
        return getRulesChangeKey() !== rulesChangeKey;
    }

    let frameId: number | null = null;

    function watchUsingRAF(callback: (sheets: CSSStyleSheet[]) => void) {
        frameId = requestAnimationFrame(() => {
            if (canUseSheetProxy) {
                return;
            }
            if (checkForUpdates()) {
                handleArrayChange(callback);
            }
            watchUsingRAF(callback);
        });
    }

    function addSheetChangeEventListener(type: string, listener: (e: CustomEvent) => void) {
        node.addEventListener(type, listener);
        cleaners.push(() => node.removeEventListener(type, listener));
    }

    function watch(callback: (sheets: CSSStyleSheet[]) => void) {
        const onAdoptedSheetsChange = () => {
            canUseSheetProxy = true;
            handleArrayChange(callback);
        };
        addSheetChangeEventListener('__darkreader__adoptedStyleSheetsChange', onAdoptedSheetsChange);
        addSheetChangeEventListener('__darkreader__adoptedStyleSheetChange', onAdoptedSheetsChange);
        addSheetChangeEventListener('__darkreader__adoptedStyleDeclarationChange', onAdoptedSheetsChange);

        if (canUseSheetProxy) {
            return;
        }
        watchUsingRAF(callback);
    }

    return {
        render,
        destroy,
        watch,
    };
}

export interface AdoptedStyleSheetFallback {
    render(options: {
        theme: Theme;
        ignoreImageAnalysis: string[];
        cssRules: CSSRule[] | CSSRuleList;
    }): void;
    commands(): DeepStyleSheetCommand[];
    destroy(): void;
}

interface StyleSheetInsertCommand {
    type: 'insert';
    index: number;
    cssText: string;
}

interface StyleSheetDeleteCommand {
    type: 'delete';
    index: number;
}

interface StyleSheetReplaceCommand {
    type: 'replace';
    cssText: string;
}

type StyleSheetCommand = StyleSheetInsertCommand | StyleSheetDeleteCommand | StyleSheetReplaceCommand;

interface DeepStyleSheetCommand {
    type: 'insert' | 'delete' | 'replace';
    path: number[];
    cssText?: string;
}

class StyleSheetCommandBuilder implements CSSBuilder {
    cssRules: StyleSheetCommandBuilder[] = [];

    private commands: StyleSheetCommand[] = [];

    insertRule(cssText: string, index = 0): number {
        this.commands.push({type: 'insert', index, cssText});
        this.cssRules.splice(index, 0, new StyleSheetCommandBuilder());
        return index;
    }

    deleteRule(index: number): void {
        this.commands.push({type: 'delete', index});
        this.cssRules.splice(index, 1);
    }

    replaceSync(cssText: string) {
        this.commands.splice(0);
        this.commands.push({type: 'replace', cssText});
        if (cssText === '') {
            this.cssRules.splice(0);
        } else {
            throw new Error('StyleSheetCommandBuilder.replaceSync() is not fully supported');
        }
    }

    getDeepCSSCommands() {
        const deep: DeepStyleSheetCommand[] = [];
        this.commands.forEach((command) => {
            deep.push({
                type: command.type,
                cssText: command.type !== 'delete' ? command.cssText : '',
                path: command.type === 'replace' ? [] : [command.index],
            });
        });
        this.cssRules.forEach((rule, i) => {
            const childCommands = rule.getDeepCSSCommands();
            childCommands.forEach((c) => c.path.unshift(i));
        });
        return deep;
    }

    clearDeepCSSCommands() {
        this.commands.splice(0);
        this.cssRules.forEach((rule) => rule.clearDeepCSSCommands());
    }
}

export function createAdoptedStyleSheetFallback(): AdoptedStyleSheetFallback {
    let cancelAsyncOperations = false;

    const builder = new StyleSheetCommandBuilder();

    function render(options: {
        theme: Theme;
        ignoreImageAnalysis: string[];
        cssRules: CSSRuleList | CSSRule[];
    }) {
        const prepareSheet = () => {
            builder.replaceSync('');
            return builder;
        };

        const sheetModifier = createStyleSheetModifier();
        sheetModifier.modifySheet({
            prepareSheet,
            sourceCSSRules: options.cssRules,
            theme: options.theme,
            ignoreImageAnalysis: options.ignoreImageAnalysis,
            force: false,
            isAsyncCancelled: () => cancelAsyncOperations,
        });
    }

    function commands() {
        const commands = builder.getDeepCSSCommands();
        builder.clearDeepCSSCommands();
        return commands;
    }

    function destroy() {
        cancelAsyncOperations = true;
    }

    return {render, destroy, commands};
}

```

### inject\dynamic-theme\variables.ts

```
import type {Theme} from '../../definitions';
import type {RGBA} from '../../utils/color';
import {parseColorWithCache} from '../../utils/color';
import {getParenthesesRange} from '../../utils/text';

import {iterateCSSRules, iterateCSSDeclarations} from './css-rules';
import {modifyBackgroundColor, modifyBorderColor, modifyForegroundColor} from './modify-colors';
import {getBgImageModifier, getShadowModifierWithInfo} from './modify-css';
import type {CSSValueModifier} from './modify-css';

export interface ModifiedVarDeclaration {
    property: string;
    value: string | Promise<string | null>;
}

export type CSSVariableModifier = (theme: Theme) => {
    declarations: ModifiedVarDeclaration[];
    onTypeChange: {
        addListener: (callback: (declarations: ModifiedVarDeclaration[]) => void) => void;
        removeListeners: () => void;
    };
};

const VAR_TYPE_BG_COLOR = 1 << 0;
const VAR_TYPE_TEXT_COLOR = 1 << 1;
const VAR_TYPE_BORDER_COLOR = 1 << 2;
const VAR_TYPE_BG_IMG = 1 << 3;

export class VariablesStore {
    private readonly varTypes = new Map<string, number>();
    private readonly rulesQueue = new Set<CSSRuleList | CSSRule[]>();
    private readonly inlineStyleQueue: CSSStyleDeclaration[] = [];
    private readonly definedVars = new Set<string>();
    private readonly varRefs = new Map<string, Set<string>>();
    private readonly unknownColorVars = new Set<string>();
    private readonly unknownBgVars = new Set<string>();
    private readonly undefinedVars = new Set<string>();
    private readonly initialVarTypes = new Map<string, number>();
    private readonly changedTypeVars = new Set<string>();
    private readonly typeChangeSubscriptions = new Map<string, Set<() => void>>();
    private readonly unstableVarValues = new Map<string, string>();
    private onRootVariableDefined: () => void;

    clear(): void {
        this.varTypes.clear();
        this.rulesQueue.clear();
        this.inlineStyleQueue.splice(0);
        this.definedVars.clear();
        this.varRefs.clear();
        this.unknownColorVars.clear();
        this.unknownBgVars.clear();
        this.undefinedVars.clear();
        this.initialVarTypes.clear();
        this.changedTypeVars.clear();
        this.typeChangeSubscriptions.clear();
        this.unstableVarValues.clear();
    }

    private isVarType(varName: string, typeNum: number) {
        return (
            this.varTypes.has(varName) &&
            (this.varTypes.get(varName)! & typeNum) > 0
        );
    }

    addRulesForMatching(rules: CSSRuleList | CSSRule[]): void {
        this.rulesQueue.add(rules);
    }

    addInlineStyleForMatching(style: CSSStyleDeclaration): void {
        this.inlineStyleQueue.push(style);
    }

    matchVariablesAndDependents(): void {
        if (this.rulesQueue.size === 0 && this.inlineStyleQueue.length === 0) {
            return;
        }
        this.changedTypeVars.clear();
        this.initialVarTypes = new Map(this.varTypes);
        this.collectRootVariables();
        this.collectVariablesAndVarDep();
        this.collectRootVarDependents();

        this.varRefs.forEach((refs, v) => {
            refs.forEach((r) => {
                if (this.varTypes.has(v)) {
                    this.resolveVariableType(r, this.varTypes.get(v)!);
                }
            });
        });

        this.unknownColorVars.forEach((v) => {
            if (this.unknownBgVars.has(v)) {
                this.unknownColorVars.delete(v);
                this.unknownBgVars.delete(v);
                this.resolveVariableType(v, VAR_TYPE_BG_COLOR);
            } else if (this.isVarType(v, VAR_TYPE_BG_COLOR | VAR_TYPE_TEXT_COLOR | VAR_TYPE_BORDER_COLOR)) {
                this.unknownColorVars.delete(v);
            } else {
                this.undefinedVars.add(v);
            }
        });

        this.unknownBgVars.forEach((v) => {
            const hasColor = this.findVarRef(v, (ref) => {
                return (
                    this.unknownColorVars.has(ref) ||
                    this.isVarType(ref, VAR_TYPE_BG_COLOR | VAR_TYPE_TEXT_COLOR | VAR_TYPE_BORDER_COLOR)
                );
            }) != null;
            if (hasColor) {
                this.iterateVarRefs(v, (ref) => {
                    this.resolveVariableType(ref, VAR_TYPE_BG_COLOR);
                });
            } else if (this.isVarType(v, VAR_TYPE_BG_COLOR | VAR_TYPE_BG_IMG)) {
                this.unknownBgVars.delete(v);
            } else {
                this.undefinedVars.add(v);
            }
        });

        this.changedTypeVars.forEach((varName) => {
            if (this.typeChangeSubscriptions.has(varName)) {
                this.typeChangeSubscriptions
                    .get(varName)!
                    .forEach((callback) => {
                        callback();
                    });
            }
        });
        this.changedTypeVars.clear();
    }

    getModifierForVariable(options: {
        varName: string;
        sourceValue: string;
        rule: CSSStyleRule;
        ignoredImgSelectors: string[];
        isCancelled: () => boolean;
    }): CSSVariableModifier {
        return (theme) => {
            const {varName, sourceValue, rule, ignoredImgSelectors, isCancelled} = options;

            const getDeclarations = () => {
                const declarations: ModifiedVarDeclaration[] = [];

                const addModifiedValue = (
                    typeNum: number,
                    varNameWrapper: (name: string) => string,
                    colorModifier: (c: string, t: Theme) => string,
                ) => {
                    if (!this.isVarType(varName, typeNum)) {
                        return;
                    }
                    const property = varNameWrapper(varName);
                    let modifiedValue: string;
                    if (isVarDependant(sourceValue)) {
                        if (isConstructedColorVar(sourceValue)) {
                            let value = insertVarValues(sourceValue, this.unstableVarValues);
                            if (!value) {
                                value = typeNum === VAR_TYPE_BG_COLOR ? '#ffffff' : '#000000';
                            }
                            modifiedValue = colorModifier(value, theme);
                        } else {
                            modifiedValue = replaceCSSVariablesNames(
                                sourceValue,
                                (v) => varNameWrapper(v),
                                (fallback) => colorModifier(fallback, theme),
                            );
                        }
                    } else {
                        modifiedValue = colorModifier(sourceValue, theme);
                    }
                    declarations.push({
                        property,
                        value: modifiedValue,
                    });
                };

                addModifiedValue(VAR_TYPE_BG_COLOR, wrapBgColorVariableName, tryModifyBgColor);
                addModifiedValue(VAR_TYPE_TEXT_COLOR, wrapTextColorVariableName, tryModifyTextColor);
                addModifiedValue(VAR_TYPE_BORDER_COLOR, wrapBorderColorVariableName, tryModifyBorderColor);
                if (this.isVarType(varName, VAR_TYPE_BG_IMG)) {
                    const property = wrapBgImgVariableName(varName);
                    let modifiedValue: string | Promise<string | null> = sourceValue;
                    if (isVarDependant(sourceValue)) {
                        modifiedValue = replaceCSSVariablesNames(
                            sourceValue,
                            (v) => wrapBgColorVariableName(v),
                            (fallback) => tryModifyBgColor(fallback, theme),
                        );
                    }
                    const bgModifier = getBgImageModifier(modifiedValue, rule, ignoredImgSelectors, isCancelled);
                    modifiedValue = typeof bgModifier === 'function' ? bgModifier(theme) : bgModifier!;
                    declarations.push({
                        property,
                        value: modifiedValue,
                    });
                }

                return declarations;
            };

            const callbacks = new Set<() => void>();

            const addListener = (onTypeChange: (decs: ModifiedVarDeclaration[]) => void) => {
                const callback = () => {
                    const decs = getDeclarations();
                    onTypeChange(decs);
                };

                callbacks.add(callback);
                this.subscribeForVarTypeChange(varName, callback);
            };

            const removeListeners = () => {
                callbacks.forEach((callback) => {
                    this.unsubscribeFromVariableTypeChanges(varName, callback);
                });
            };

            return {
                declarations: getDeclarations(),
                onTypeChange: {addListener, removeListeners},
            };
        };
    }

    getModifierForVarDependant(property: string, sourceValue: string): CSSValueModifier | null {
        const isConstructedColor = /^\s*(rgb|hsl)a?\(/.exec(sourceValue);
        const isSimpleConstructedColor = /^rgba?\(var\(--[-_A-Za-z0-9]+\)(\s*,?\/?\s*0?\.\d+)?\)$/.exec(sourceValue);
        if (isConstructedColor && !isSimpleConstructedColor) {
            const isBg = property.startsWith('background');
            const isText = isTextColorProperty(property);
            return (theme) => {
                let value = insertVarValues(sourceValue, this.unstableVarValues);
                value ??= isBg ? '#ffffff' : '#000000';
                let modifier;
                if (isBg) {
                    modifier = tryModifyBgColor;
                } else if (isText) {
                    modifier = tryModifyTextColor;
                } else {
                    modifier = tryModifyBorderColor;
                }
                return modifier(value, theme);
            };
        }
        if (property === 'background-color' || (isSimpleConstructedColor && property === 'background')) {
            return (theme) => {
                const defaultFallback = tryModifyBgColor(isConstructedColor ? '255, 255, 255' : '#ffffff', theme);
                return replaceCSSVariablesNames(
                    sourceValue,
                    (v) => wrapBgColorVariableName(v),
                    (fallback) => tryModifyBgColor(fallback, theme),
                    defaultFallback,
                );
            };
        }
        if (isTextColorProperty(property)) {
            return (theme) => {
                const defaultFallback = tryModifyTextColor(isConstructedColor ? '0, 0, 0' : '#000000', theme);
                return replaceCSSVariablesNames(
                    sourceValue,
                    (v) => wrapTextColorVariableName(v),
                    (fallback) => tryModifyTextColor(fallback, theme),
                    defaultFallback,
                );
            };
        }
        if (property === 'background' || property === 'background-image' || property === 'box-shadow') {
            return (theme) => {
                const unknownVars = new Set<string>();
                const modify = () => {
                    const variableReplaced = replaceCSSVariablesNames(
                        sourceValue,
                        (v) => {
                            if (this.isVarType(v, VAR_TYPE_BG_COLOR)) {
                                return wrapBgColorVariableName(v);
                            }
                            if (this.isVarType(v, VAR_TYPE_BG_IMG)) {
                                return wrapBgImgVariableName(v);
                            }
                            unknownVars.add(v);
                            return v;
                        },
                        (fallback) => tryModifyBgColor(fallback, theme),
                    );
                    // Check if the property is box-shadow and if so, do a pass-through to modify the shadow.
                    if (property === 'box-shadow') {
                        const shadowModifier = getShadowModifierWithInfo(variableReplaced)!;
                        const modifiedShadow = shadowModifier(theme);
                        if (typeof modifiedShadow === 'object' && 'unparsableMatchesLength' in modifiedShadow && 'matchesLength' in modifiedShadow && 'result' in modifiedShadow) {
                            if (modifiedShadow.unparsableMatchesLength !== modifiedShadow.matchesLength) {
                                return modifiedShadow.result;
                            }
                        }
                    }
                    return variableReplaced;
                };

                const modified = modify() as string;
                if (unknownVars.size > 0) {
                    // web.dev and voice.google.com issue where the variable is never defined, but the fallback is.
                    // Return a fallback value along with a way to subscribe for a change.
                    const isFallbackResolved = modified.match(/^var\(.*?, (var\(--darkreader-bg--.*\))|(#[0-9A-Fa-f]+)|([a-z]+)|(rgba?\(.+\))|(hsla?\(.+\))\)$/);
                    if (isFallbackResolved) {
                        return modified;
                    }
                    return new Promise<string>((resolve) => {
                        for (const unknownVar of unknownVars.values()) {
                            const callback = () => {
                                this.unsubscribeFromVariableTypeChanges(unknownVar, callback);
                                const newValue = modify() as string;
                                resolve(newValue);
                            };
                            this.subscribeForVarTypeChange(unknownVar, callback);
                        }
                    });
                }

                return modified;
            };
        }
        if (property.startsWith('border') || property.startsWith('outline')) {
            return (theme) => {
                return replaceCSSVariablesNames(
                    sourceValue,
                    (v) => wrapBorderColorVariableName(v),
                    (fallback) => tryModifyBorderColor(fallback, theme),
                );
            };
        }
        return null;
    }

    private subscribeForVarTypeChange(varName: string, callback: () => void) {
        if (!this.typeChangeSubscriptions.has(varName)) {
            this.typeChangeSubscriptions.set(varName, new Set());
        }
        const rootStore = this.typeChangeSubscriptions.get(varName)!;
        if (!rootStore.has(callback)) {
            rootStore.add(callback);
        }
    }

    private unsubscribeFromVariableTypeChanges(varName: string, callback: () => void) {
        if (this.typeChangeSubscriptions.has(varName)) {
            this.typeChangeSubscriptions.get(varName)!.delete(callback);
        }
    }

    private collectVariablesAndVarDep() {
        this.rulesQueue.forEach((rules) => {
            iterateCSSRules(rules, (rule) => {
                if (rule.style) {
                    this.collectVarsFromCSSDeclarations(rule.style);
                }
            });
        });
        this.inlineStyleQueue.forEach((style) => {
            this.collectVarsFromCSSDeclarations(style);
        });
        this.rulesQueue.clear();
        this.inlineStyleQueue.splice(0);
    }

    private collectVarsFromCSSDeclarations(style: CSSStyleDeclaration) {
        iterateCSSDeclarations(style, (property, value) => {
            if (isVariable(property)) {
                this.inspectVariable(property, value);
            }
            if (isVarDependant(value)) {
                this.inspectVarDependant(property, value);
            }
        });
    }

    private shouldProcessRootVariables() {
        return (
            this.rulesQueue.size > 0 &&
            document.documentElement.getAttribute('style')?.includes('--')
        );
    }

    private collectRootVariables() {
        if (!this.shouldProcessRootVariables()) {
            return;
        }
        iterateCSSDeclarations(document.documentElement.style, (property, value) => {
            if (isVariable(property)) {
                this.inspectVariable(property, value);
            }
        });
    }

    private inspectVariable(varName: string, value: string) {
        this.unstableVarValues.set(varName, value);

        if (isVarDependant(value) && isConstructedColorVar(value)) {
            this.unknownColorVars.add(varName);
            this.definedVars.add(varName);
        }
        if (this.definedVars.has(varName)) {
            return;
        }
        this.definedVars.add(varName);

        // Check if the value is either a raw value or a value that can be parsed
        // e.g. rgb, hsl.
        const isColor = Boolean(
            rawRGBSpaceRegex.exec(value) ||
            rawRGBCommaRegex.exec(value) ||
            parseColorWithCache(value)
        );
        if (isColor) {
            this.unknownColorVars.add(varName);
        } else if (
            value.includes('url(') ||
            value.includes('linear-gradient(') ||
            value.includes('radial-gradient(')
        ) {
            this.resolveVariableType(varName, VAR_TYPE_BG_IMG);
        }
    }

    private resolveVariableType(varName: string, typeNum: number) {
        const initialType = this.initialVarTypes.get(varName) ?? 0;
        const currentType = this.varTypes.get(varName) ?? 0;
        const newType = currentType | typeNum;
        this.varTypes.set(varName, newType);
        if (newType !== initialType || this.undefinedVars.has(varName)) {
            this.changedTypeVars.add(varName);
            this.undefinedVars.delete(varName);
        }
        this.unknownColorVars.delete(varName);
        this.unknownBgVars.delete(varName);
    }

    private collectRootVarDependents() {
        if (!this.shouldProcessRootVariables()) {
            return;
        }
        iterateCSSDeclarations(document.documentElement.style, (property, value) => {
            if (isVarDependant(value)) {
                this.inspectVarDependant(property, value);
            }
        });
    }

    private inspectVarDependant(property: string, value: string) {
        if (isVariable(property)) {
            this.iterateVarDeps(value, (ref) => {
                if (!this.varRefs.has(property)) {
                    this.varRefs.set(property, new Set());
                }
                this.varRefs.get(property)!.add(ref);
            });
        } else if (property === 'background-color' || property === 'box-shadow') {
            this.iterateVarDeps(value, (v) => this.resolveVariableType(v, VAR_TYPE_BG_COLOR));
        } else if (isTextColorProperty(property)) {
            this.iterateVarDeps(value, (v) => this.resolveVariableType(v, VAR_TYPE_TEXT_COLOR));
        } else if (property.startsWith('border') || property.startsWith('outline')) {
            this.iterateVarDeps(value, (v) => this.resolveVariableType(v, VAR_TYPE_BORDER_COLOR));
        } else if (property === 'background' || property === 'background-image') {
            this.iterateVarDeps(value, (v) => {
                if (this.isVarType(v, VAR_TYPE_BG_COLOR | VAR_TYPE_BG_IMG)) {
                    return;
                }
                const isBgColor = this.findVarRef(v, (ref) => {
                    return (
                        this.unknownColorVars.has(ref) ||
                        this.isVarType(ref, VAR_TYPE_BG_COLOR | VAR_TYPE_TEXT_COLOR | VAR_TYPE_BORDER_COLOR)
                    );
                }) != null;
                this.iterateVarRefs(v, (ref) => {
                    if (isBgColor) {
                        this.resolveVariableType(ref, VAR_TYPE_BG_COLOR);
                    } else {
                        this.unknownBgVars.add(ref);
                    }
                });
            });
        }
    }

    private iterateVarDeps(
        value: string,
        iterator: (varDep: string) => void,
    ) {
        const varDeps = new Set<string>();
        iterateVarDependencies(value, (v) => varDeps.add(v));
        varDeps.forEach((v) => iterator(v));
    }

    private findVarRef(varName: string, iterator: (v: string) => boolean, stack = new Set<string>()): string | null {
        if (stack.has(varName)) {
            return null;
        }
        stack.add(varName);
        const result = iterator(varName);
        if (result) {
            return varName;
        }
        const refs = this.varRefs.get(varName);
        if (!refs || refs.size === 0) {
            return null;
        }
        for (const ref of refs) {
            const found = this.findVarRef(ref, iterator, stack);
            if (found) {
                return found;
            }
        }
        return null;
    }

    private iterateVarRefs(varName: string, iterator: (v: string) => void) {
        this.findVarRef(varName, (ref) => {
            iterator(ref);
            return false;
        });
    }

    setOnRootVariableChange(callback: () => void): void {
        this.onRootVariableDefined = callback;
    }

    putRootVars(styleElement: HTMLStyleElement, theme: Theme): void {
        const sheet = styleElement.sheet!;
        if (sheet.cssRules.length > 0) {
            sheet.deleteRule(0);
        }
        const declarations = new Map<string, string>();
        iterateCSSDeclarations(document.documentElement.style, (property, value) => {
            if (isVariable(property)) {
                if (this.isVarType(property, VAR_TYPE_BG_COLOR)) {
                    declarations.set(wrapBgColorVariableName(property), tryModifyBgColor(value, theme));
                }
                if (this.isVarType(property, VAR_TYPE_TEXT_COLOR)) {
                    declarations.set(wrapTextColorVariableName(property), tryModifyTextColor(value, theme));
                }
                if (this.isVarType(property, VAR_TYPE_BORDER_COLOR)) {
                    declarations.set(wrapBorderColorVariableName(property), tryModifyBorderColor(value, theme));
                }
                this.subscribeForVarTypeChange(property, this.onRootVariableDefined);
            }
        });
        const cssLines: string[] = [];
        cssLines.push(':root {');
        for (const [property, value] of declarations) {
            cssLines.push(`    ${property}: ${value};`);
        }
        cssLines.push('}');
        const cssText = cssLines.join('\n');
        sheet.insertRule(cssText);
    }
}

export const variablesStore = new VariablesStore();

interface Range {
    start: number;
    end: number;
}

interface VariableMatch extends Range {
    value: string;
}

function getVariableRange(input: string, searchStart = 0): Range | null {
    const start = input.indexOf('var(', searchStart);
    if (start >= 0) {
        const range = getParenthesesRange(input, start + 3);
        if (range) {
            return {start, end: range.end};
        }
    }
    return null;
}

function getVariablesMatches(input: string): VariableMatch[] {
    const ranges: VariableMatch[] = [];
    let i = 0;
    let range: Range | null;
    while ((range = getVariableRange(input, i))) {
        const {start, end} = range;
        ranges.push({start, end, value: input.substring(start, end)});
        i = range.end + 1;
    }
    return ranges;
}

function replaceVariablesMatches(input: string, replacer: (match: string, count: number) => string | null) {
    const matches = getVariablesMatches(input);
    const matchesCount = matches.length;
    if (matchesCount === 0) {
        return input;
    }

    const inputLength = input.length;
    const replacements = matches.map((m) => replacer(m.value, matches.length));
    const parts: Array<string | null> = [];
    parts.push(input.substring(0, matches[0].start));
    for (let i = 0; i < matchesCount; i++) {
        parts.push(replacements[i]);
        const start = matches[i].end;
        const end = i < matchesCount - 1 ? matches[i + 1].start : inputLength;
        parts.push(input.substring(start, end));
    }
    return parts.join('');
}

function getVariableNameAndFallback(match: string) {
    const commaIndex = match.indexOf(',');
    let name: string;
    let fallback: string;
    if (commaIndex >= 0) {
        name = match.substring(4, commaIndex).trim();
        fallback = match.substring(commaIndex + 1, match.length - 1).trim();
    } else {
        name = match.substring(4, match.length - 1).trim();
        fallback = '';
    }
    return {name, fallback};
}

export function replaceCSSVariablesNames(
    value: string,
    nameReplacer: (varName: string) => string,
    fallbackReplacer?: (fallbackValue: string) => string,
    finalFallback?: string,
): string {
    const matchReplacer = (match: string) => {
        const {name, fallback} = getVariableNameAndFallback(match);
        const newName = nameReplacer(name);
        if (!fallback) {
            if (finalFallback) {
                return `var(${newName}, ${finalFallback})`;
            }
            return `var(${newName})`;
        }

        let newFallback: string;
        if (isVarDependant(fallback)) {
            newFallback = replaceCSSVariablesNames(fallback, nameReplacer, fallbackReplacer);
        } else if (fallbackReplacer) {
            newFallback = fallbackReplacer(fallback);
        } else {
            newFallback = fallback;
        }
        return `var(${newName}, ${newFallback})`;
    };

    return replaceVariablesMatches(value, matchReplacer);
}

function iterateVarDependencies(value: string, iterator: (varName: string) => void) {
    replaceCSSVariablesNames(value, (varName) => {
        iterator(varName);
        return varName;
    });
}

function wrapBgColorVariableName(name: string) {
    return `--darkreader-bg${name}`;
}

function wrapTextColorVariableName(name: string) {
    return `--darkreader-text${name}`;
}

function wrapBorderColorVariableName(name: string) {
    return `--darkreader-border${name}`;
}

function wrapBgImgVariableName(name: string) {
    return `--darkreader-bgimg${name}`;
}

function isVariable(property: string) {
    return property.startsWith('--');
}

function isVarDependant(value: string) {
    return value.includes('var(');
}

function isConstructedColorVar(value: string) {
    return (
        value.match(/^\s*(rgb|hsl)a?\(/) ||
        value.match(/^(((\d{1,3})|(var\([\-_A-Za-z0-9]+\))),?\s*?){3}$/)
    );
}

const textColorProps = [
    'color',
    'caret-color',
    '-webkit-text-fill-color',
    'fill',
    'stroke',
];

function isTextColorProperty(property: string) {
    return textColorProps.includes(property);
}

// [number] [number] [number]
const rawRGBSpaceRegex = /^(\d{1,3})\s+(\d{1,3})\s+(\d{1,3})$/;
// [number], [number], [number]
const rawRGBCommaRegex = /^(\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3})$/;

function parseRawColorValue(input: string) {
    const match = rawRGBSpaceRegex.exec(input) ?? rawRGBCommaRegex.exec(input);
    if (match) {
        const color = `rgb(${match[1]}, ${match[2]}, ${match[3]})`;
        return {isRaw: true, color};
    }
    return {isRaw: false, color: input};
}

function handleRawColorValue(
    input: string,
    theme: Theme,
    modifyFunction: (rgb: RGBA, theme: Theme, useRegisteredVarColor?: boolean) => string,
) {
    const {isRaw, color} = parseRawColorValue(input);

    const rgb = parseColorWithCache(color);
    if (rgb) {
        const outputColor = modifyFunction(rgb, theme, !isRaw);

        // If it's raw, we need to convert it back to the "raw" format.
        if (isRaw) {
            // This should technically never fail(returning an empty string),
            // but just to be safe, we will return outputColor.
            const outputInRGB = parseColorWithCache(outputColor);
            return outputInRGB ? `${outputInRGB.r}, ${outputInRGB.g}, ${outputInRGB.b}` : outputColor;
        }
        return outputColor;
    }
    return color;
}

function tryModifyBgColor(color: string, theme: Theme) {
    return handleRawColorValue(color, theme, modifyBackgroundColor);
}

function tryModifyTextColor(color: string, theme: Theme) {
    return handleRawColorValue(color, theme, modifyForegroundColor);
}

function tryModifyBorderColor(color: string, theme: Theme) {
    return handleRawColorValue(color, theme, modifyBorderColor);
}

function insertVarValues(source: string, varValues: Map<string, string>, fullStack = new Set<string>()) {
    let containsUnresolvedVar = false;
    const matchReplacer = (match: string, count: number) => {
        const {name, fallback} = getVariableNameAndFallback(match);
        const stack = count > 1 ? new Set(fullStack) : fullStack;
        if (stack.has(name)) {
            containsUnresolvedVar = true;
            return null;
        }
        stack.add(name);
        const varValue = varValues.get(name) || fallback;
        let inserted: string | null = null;
        if (varValue) {
            if (isVarDependant(varValue)) {
                inserted = insertVarValues(varValue, varValues, stack);
            } else {
                inserted = varValue;
            }
        }
        if (!inserted) {
            containsUnresolvedVar = true;
            return null;
        }
        return inserted;
    };

    const replaced = replaceVariablesMatches(source, matchReplacer);
    if (containsUnresolvedVar) {
        return null;
    }
    return replaced;
}

```

### inject\dynamic-theme\stylesheet-proxy.ts

```
declare const __FIREFOX_MV2__: boolean;
declare const __THUNDERBIRD__: boolean;

type OverrideFactory<T, P extends keyof T> = (native: T[P] & ((...args: any[]) => any)) => (this: T, ...args: Parameters<typeof native>) => ReturnType<typeof native>;

export function injectProxy(enableStyleSheetsProxy: boolean, enableCustomElementRegistryProxy: boolean): void {
    document.dispatchEvent(new CustomEvent('__darkreader__inlineScriptsAllowed'));

    const cleaners: Array<() => void> = [];

    function cleanUp() {
        cleaners.forEach((clean) => clean());
        cleaners.splice(0);
    }

    function documentEventListener(type: string, listener: (e: CustomEvent) => void, options?: AddEventListenerOptions) {
        document.addEventListener(type, listener, options);
        cleaners.push(() => document.removeEventListener(type, listener));
    }

    function disableConflictingPlugins() {
        const disableWPDarkMode = () => {
            if ((window as any)?.WPDarkMode?.deactivate) {
                (window as any).WPDarkMode.deactivate();
            }
        };
        disableWPDarkMode();
    }

    documentEventListener('__darkreader__cleanUp', cleanUp);
    documentEventListener('__darkreader__disableConflictingPlugins', disableConflictingPlugins);

    function overrideProperty<T, P extends keyof T>(cls: {prototype: T}, prop: P, overrides: Record<string, OverrideFactory<T, P>>) {
        const proto = cls.prototype;
        const oldDescriptor = Object.getOwnPropertyDescriptor(proto, prop);
        if (!oldDescriptor) {
            return;
        }
        const newDescriptor: PropertyDescriptor = {...oldDescriptor};
        Object.keys(overrides).forEach((key: keyof PropertyDescriptor) => {
            const factory = overrides[key];
            newDescriptor[key] = factory(oldDescriptor[key]);
        });
        Object.defineProperty(proto, prop, newDescriptor);
        cleaners.push(() => Object.defineProperty(proto, prop, oldDescriptor));
    }

    function override<T, P extends keyof T>(cls: {prototype: T}, prop: P, factory: OverrideFactory<T, P>) {
        overrideProperty(cls, prop, {value: factory});
    }

    function isDRElement(element?: Element) {
        return element?.classList?.contains('darkreader');
    }

    function isDRSheet(sheet: CSSStyleSheet) {
        return isDRElement(sheet.ownerNode as Element);
    }

    const updateSheetEvent = new CustomEvent('__darkreader__updateSheet');
    const adoptedSheetChangeEvent = new CustomEvent('__darkreader__adoptedStyleSheetChange');
    const shadowDomAttachingEvent = new CustomEvent('__darkreader__shadowDomAttaching', {bubbles: true});
    const adoptedSheetOwners = new WeakMap<CSSStyleSheet, Set<Document | ShadowRoot>>();
    const adoptedDeclarationSheets = new WeakMap<CSSStyleDeclaration, CSSStyleSheet>();
    let onFFSheetChange: (sheet: CSSStyleSheet) => void;

    function onAdoptedSheetChange(sheet: CSSStyleSheet) {
        const owners = adoptedSheetOwners.get(sheet);
        owners?.forEach((node) => {
            if (node.isConnected) {
                node.dispatchEvent(adoptedSheetChangeEvent);
            } else {
                owners.delete(node);
            }
        });
    }

    function reportSheetChange(sheet: CSSStyleSheet) {
        if (sheet.ownerNode && !isDRSheet(sheet)) {
            sheet.ownerNode.dispatchEvent(updateSheetEvent);
        }
        if (__FIREFOX_MV2__ || __THUNDERBIRD__) {
            onFFSheetChange(sheet);
        } else if (adoptedSheetOwners.has(sheet)) {
            onAdoptedSheetChange(sheet);
        }
    }

    function reportSheetChangeAsync(sheet: CSSStyleSheet, promise: Promise<any>) {
        const {ownerNode} = sheet;
        if (ownerNode && !isDRSheet(sheet) && promise && promise instanceof Promise) {
            promise.then(() => ownerNode.dispatchEvent(updateSheetEvent));
        }
        if (__FIREFOX_MV2__ || __THUNDERBIRD__) {
            if (promise && promise instanceof Promise) {
                promise.then(() => onFFSheetChange(sheet));
            }
        } else if (adoptedSheetOwners.has(sheet)) {
            if (promise && promise instanceof Promise) {
                promise.then(() => onAdoptedSheetChange(sheet));
            }
        }
    }

    override(CSSStyleSheet, 'addRule', (native) => function (selector?: string, style?: string, index?: number) {
        native.call(this, selector, style, index);
        reportSheetChange(this);
        // Should always returns -1 https://developer.mozilla.org/en-US/docs/Web/API/CSSStyleSheet/addRule#Return_value.
        return -1;
    });

    override(CSSStyleSheet, 'insertRule', (native) => function (rule: string, index?: number) {
        const returnValue = native.call(this, rule, index) as number;
        reportSheetChange(this);
        return returnValue;
    });

    override(CSSStyleSheet, 'deleteRule', (native) => function (index: number) {
        native.call(this, index);
        reportSheetChange(this);
    });

    override(CSSStyleSheet, 'removeRule', (native) => function (index?: number) {
        native.call(this, index);
        reportSheetChange(this);
    });

    override(CSSStyleSheet, 'replace', (native) => function (cssText: string) {
        const returnValue = native.call(this, cssText);
        reportSheetChangeAsync(this, returnValue);
        return returnValue;
    });

    override(CSSStyleSheet, 'replaceSync', (native) => function (cssText: string) {
        native.call(this, cssText);
        reportSheetChange(this);
    });

    override(Element, 'attachShadow', (native) => function (options: any) {
        this.dispatchEvent(shadowDomAttachingEvent);
        return native.call(this, options);
    });

    // Reference:
    // https://github.com/darkreader/darkreader/issues/6480#issuecomment-897696175
    const shouldWrapHTMLElement = location.hostname === 'baidu.com' || location.hostname.endsWith('.baidu.com');
    if (shouldWrapHTMLElement) {
        override(Element, 'getElementsByTagName', (native) => function (tagName: string): NodeListOf<HTMLElement> {
            if (tagName !== 'style') {
                return native.call(this, tagName);
            }

            const getCurrentElementValue = () => {
                const elements: NodeListOf<HTMLElement> = native.call(this, tagName);

                return Object.setPrototypeOf([...elements].filter((element: HTMLElement) =>
                    element && !isDRElement(element)
                ), NodeList.prototype);
            };

            let elements = getCurrentElementValue();
            const nodeListBehavior: ProxyHandler<NodeListOf<HTMLElement>> = {
                get: function (_: NodeListOf<HTMLElement>, property: string) {
                    return getCurrentElementValue()[Number(property) || property];
                },
            };
            elements = new Proxy(elements, nodeListBehavior);
            return elements;
        });
    }

    // Reference:
    // https://github.com/darkreader/darkreader/issues/10300#issuecomment-1317445632
    const shouldProxyChildNodes = [
        'brilliant.org',
        'www.vy.no',
    ].includes(location.hostname);
    if (shouldProxyChildNodes) {
        overrideProperty(Node, 'childNodes', {
            get: (native) => function (): NodeListOf<ChildNode> {
                const childNodes: NodeListOf<ChildNode> = native.call(this);
                return Object.setPrototypeOf([...childNodes].filter((element: ChildNode) => {
                    return !isDRElement(element as Element);
                }), NodeList.prototype);
            },
        });
    }

    function resolveCustomElement(tag: string) {
        customElements.whenDefined(tag).then(() => {
            document.dispatchEvent(new CustomEvent('__darkreader__isDefined', {detail: {tag}}));
        });
    }

    documentEventListener('__darkreader__addUndefinedResolver', (e: CustomEvent<{tag: string}>) => resolveCustomElement(e.detail.tag));

    if (enableCustomElementRegistryProxy) {
        override(CustomElementRegistry, 'define', (native) => function (name: string, constructor: any, options: any) {
            resolveCustomElement(name);
            native.call(this, name, constructor, options);
        });
    }

    let blobURLAllowed: boolean | null = null;

    function checkBlobURLSupport() {
        if (blobURLAllowed != null) {
            document.dispatchEvent(new CustomEvent('__darkreader__blobURLCheckResponse', {detail: {blobURLAllowed}}));
            return;
        }

        const svg = '<svg xmlns="http://www.w3.org/2000/svg" width="1" height="1"><rect width="1" height="1" fill="transparent"/></svg>';
        const bytes = new Uint8Array(svg.length);
        for (let i = 0; i < svg.length; i++) {
            bytes[i] = svg.charCodeAt(i);
        }
        const blob = new Blob([bytes], {type: 'image/svg+xml'});
        const objectURL = URL.createObjectURL(blob);
        const image = new Image();
        image.onload = () => {
            blobURLAllowed = true;
            sendBlobURLCheckResponse();
        };
        image.onerror = () => {
            blobURLAllowed = false;
            sendBlobURLCheckResponse();
        };
        image.src = objectURL;
    }

    function sendBlobURLCheckResponse() {
        document.dispatchEvent(new CustomEvent('__darkreader__blobURLCheckResponse', {detail: {blobURLAllowed}}));
    }

    documentEventListener('__darkreader__blobURLCheckRequest', checkBlobURLSupport);

    if (enableStyleSheetsProxy) {
        overrideProperty(Document, 'styleSheets', {
            get: (native) => function () {
                const getCurrentValue = () => {
                    const docSheets: StyleSheetList = native.call(this);
                    const filteredSheets = [...docSheets].filter((styleSheet) => styleSheet.ownerNode && !isDRSheet(styleSheet));
                    (filteredSheets as unknown as StyleSheetList).item = (item: number) => filteredSheets[item];
                    return Object.setPrototypeOf(filteredSheets, StyleSheetList.prototype);
                };

                let elements = getCurrentValue();
                const styleSheetListBehavior: ProxyHandler<StyleSheetList> = {
                    get: function (_: StyleSheetList, property: string) {
                        return getCurrentValue()[property];
                    },
                };
                elements = new Proxy(elements, styleSheetListBehavior);
                return elements;
            },
        });
    }

    if (!(__FIREFOX_MV2__ || __THUNDERBIRD__)) {
        const adoptedSheetsSourceProxies = new WeakMap<CSSStyleSheet[], CSSStyleSheet[]>();
        const adoptedSheetsProxySources = new WeakMap<CSSStyleSheet[], CSSStyleSheet[]>();
        const adoptedSheetsChangeEvent = new CustomEvent('__darkreader__adoptedStyleSheetsChange');
        const adoptedSheetOverrideCache = new WeakSet<CSSStyleSheet>();
        const adoptedSheetsSnapshots = new WeakMap<Document | ShadowRoot, CSSStyleSheet[]>();

        const isDRAdoptedSheetOverride = (sheet: CSSStyleSheet) => {
            if (!sheet || !sheet.cssRules) {
                return false;
            }
            if (adoptedSheetOverrideCache.has(sheet)) {
                return true;
            }
            if (sheet.cssRules.length > 0 && sheet.cssRules[0].cssText.startsWith('#__darkreader__adoptedOverride')) {
                adoptedSheetOverrideCache.add(sheet);
                return true;
            }
            return false;
        };

        const areArraysEqual = (a: any[], b: any[]) => {
            return a.length === b.length && a.every((x, i) => x === b[i]);
        };

        const onAdoptedSheetsChange = (node: Document | ShadowRoot) => {
            const prev = adoptedSheetsSnapshots.get(node);
            const curr = (node.adoptedStyleSheets || []).filter((s) => !isDRAdoptedSheetOverride(s));
            adoptedSheetsSnapshots.set(node, curr);
            if (!prev || !areArraysEqual(prev, curr)) {
                curr.forEach((sheet) => {
                    if (!adoptedSheetOwners.has(sheet)) {
                        adoptedSheetOwners.set(sheet, new Set());
                    }
                    adoptedSheetOwners.get(sheet)!.add(node);
                    for (const rule of sheet.cssRules) {
                        const declaration = (rule as CSSStyleRule).style;
                        if (declaration) {
                            adoptedDeclarationSheets.set(declaration, sheet);
                        }
                    }
                });
                node.dispatchEvent(adoptedSheetsChangeEvent);
            }
        };

        const proxyAdoptedSheetsArray = (node: Document | ShadowRoot, source: CSSStyleSheet[]) => {
            if (adoptedSheetsProxySources.has(source)) {
                return source;
            }
            if (adoptedSheetsSourceProxies.has(source)) {
                return adoptedSheetsSourceProxies.get(source)!;
            }
            const proxy = new Proxy(source, {
                deleteProperty(target, property) {
                    delete target[property as any];
                    return true;
                },
                set(target, property, value) {
                    target[property as any] = value;
                    if (property === 'length') {
                        onAdoptedSheetsChange(node);
                    }
                    return true;
                },
            });
            adoptedSheetsSourceProxies.set(source, proxy);
            adoptedSheetsProxySources.set(proxy, source);
            return proxy;
        };

        [Document, ShadowRoot].forEach((ctor: {prototype: Document | ShadowRoot}) => {
            overrideProperty(ctor, 'adoptedStyleSheets', {
                get: (native) => function () {
                    const source = native.call(this) as CSSStyleSheet[];
                    return proxyAdoptedSheetsArray(this, source);
                },
                set: (native) => function (source) {
                    if (adoptedSheetsProxySources.has(source)) {
                        source = adoptedSheetsProxySources.get(source);
                    }
                    native.call(this, source);
                    onAdoptedSheetsChange(this);
                },
            });
        });

        const adoptedDeclarationChangeEvent = new CustomEvent('__darkreader__adoptedStyleDeclarationChange');
        (['setProperty', 'removeProperty'] as Array<keyof CSSStyleDeclaration>).forEach((key) => {
            override(CSSStyleDeclaration, key, (native) => {
                return function (...args: any[]) {
                    const returnValue = native.apply(this, args);
                    const sheet = adoptedDeclarationSheets.get(this);
                    if (sheet) {
                        const owners = adoptedSheetOwners.get(sheet);
                        if (owners) {
                            owners.forEach((node) => {
                                node.dispatchEvent(adoptedDeclarationChangeEvent);
                            });
                        }
                    }
                    return returnValue;
                };
            });
        });
    }

    if (__FIREFOX_MV2__ || __THUNDERBIRD__) {
        type StyleSheetCommand = {
            type: 'insert' | 'delete' | 'replace';
            path: number[];
            cssText?: string;
        };
        type NodeSheet = {
            sheetId: number;
            sheet: CSSStyleSheet;
        };

        const targetNodes = new Set<Document | ShadowRoot>();
        const sourceSheets = new WeakSet<CSSStyleSheet>();
        const sourceSheetNodes = new WeakMap<CSSStyleSheet, Set<Document | ShadowRoot>>();
        const overrideSheetsByNode = new WeakMap<Document | ShadowRoot, Set<CSSStyleSheet>>();
        const overrideSheets = new WeakMap<CSSStyleSheet, CSSStyleSheet>();
        const relevantOverrides = new WeakSet<CSSStyleSheet>();

        let observableStyleDeclarations = new WeakMap<CSSStyleDeclaration, CSSStyleSheet>();
        cleaners.push(() => observableStyleDeclarations = new WeakMap());

        let executing = false;

        let nodeCounter = 0;
        const nodeIds = new WeakMap<Document | ShadowRoot, number>();
        const nodesById = new Map<number, Document | ShadowRoot>();
        const getNodeId = (node: Document | ShadowRoot) => {
            if (nodeIds.has(node)) {
                return nodeIds.get(node)!;
            }
            const id = ++nodeCounter;
            nodeIds.set(node, id);
            nodesById.set(id, node);
            return id;
        };

        let sheetCounter = 0;
        const sheetIds = new WeakMap<CSSStyleSheet, number>();
        const sheetsById = new Map<number, CSSStyleSheet>();
        const getSheetId = (sheet: CSSStyleSheet) => {
            if (sheetIds.has(sheet)) {
                return sheetIds.get(sheet)!;
            }
            const id = ++sheetCounter;
            sheetIds.set(sheet, id);
            sheetsById.set(id, sheet);
            return id;
        };

        const cleanNode = (node: Document | ShadowRoot) => {
            targetNodes.delete(node);
            nodesById.delete(getNodeId(node));
            iterateSourceSheets(node, (sheet) => {
                sourceSheetNodes.get(sheet)?.delete(node);
                if (sourceSheetNodes.get(sheet)?.size === 0) {
                    sourceSheetNodes.delete(sheet);
                }
            });
            const overrides = overrideSheetsByNode.get(node);
            if (overrides && Array.isArray(node.adoptedStyleSheets)) {
                overrides.forEach((override) => {
                    const index = node.adoptedStyleSheets.indexOf(override);
                    if (index >= 0) {
                        node.adoptedStyleSheets.splice(index, 1);
                    }
                });
            }
            overrideSheetsByNode.delete(node);
        };

        const iterateSourceSheets = (node: Document | ShadowRoot, iterator: (sheet: CSSStyleSheet) => void) => {
            if (Array.isArray(node.adoptedStyleSheets)) {
                const overrides = overrideSheetsByNode.get(node);
                node.adoptedStyleSheets.forEach((sheet) => {
                    if (!overrides || !overrides.has(sheet)) {
                        if (!sourceSheets.has(sheet)) {
                            sourceSheets.add(sheet);
                        }
                        if (!sourceSheetNodes.has(sheet)) {
                            sourceSheetNodes.set(sheet, new Set());
                        }
                        sourceSheetNodes.get(sheet)!.add(node);
                        iterator(sheet);
                    }
                });
            }
        };

        const getSourceSheets = (node: Document | ShadowRoot) => {
            const allRules: NodeSheet[] = [];
            iterateSourceSheets(node, (sheet) => {
                const sheetId = getSheetId(sheet);
                for (let i = 0; i < sheet.cssRules.length; i++) {
                    const rule = sheet.cssRules[i];
                    if ((rule as CSSStyleRule).style) {
                        observableStyleDeclarations.set((rule as CSSStyleRule).style, sheet);
                    }
                }
                allRules.push({sheetId, sheet});
            });
            return allRules;
        };

        const walkNodesWithAdoptedStyles = (root: Document | ShadowRoot, iterator: (host: Document | ShadowRoot) => void) => {
            iterator(root);
            const acceptNode = (node: Node) => (node as Element).shadowRoot == null ? NodeFilter.FILTER_SKIP : NodeFilter.FILTER_ACCEPT;
            const walker = document.createTreeWalker(root, NodeFilter.SHOW_ELEMENT, {acceptNode});
            const start = root === document ? walker.nextNode() : root;
            for (let node = start; node != null; node = walker.nextNode() as Element) {
                const shadowRoot = (node as Element).shadowRoot;
                if (shadowRoot) {
                    walkNodesWithAdoptedStyles(shadowRoot, iterator);
                }
            }
        };

        const queuedSheetChanges = new Set<CSSStyleSheet>();

        const handleSheetChangeForNode = (node: Document | ShadowRoot) => {
            if (!node.isConnected) {
                cleanNode(node);
                return;
            }
            if (!targetNodes.has(node)) {
                targetNodes.add(node);
            }
            const sheets = getSourceSheets(node);
            if (sheets.every(({sheet}) => queuedSheetChanges.has(sheet))) {
                return;
            }
            const unqueuedSheets: NodeSheet[] = [];
            unqueuedSheets.forEach(({sheetId, sheet}) => {
                if (queuedSheetChanges.has(sheet)) {
                    return;
                }
                const override = overrideSheets.get(sheet);
                if (override && relevantOverrides.has(override)) {
                    putOverride(node, override);
                } else {
                    queuedSheetChanges.add(sheet);
                    unqueuedSheets.push({sheetId, sheet});
                }
            });
            if (unqueuedSheets.length > 0) {
                queueMicrotask(() => {
                    unqueuedSheets.forEach(({sheet}) => queuedSheetChanges.delete(sheet));
                    sendSourceStyles(sheets);
                });
            }
        };

        const handleSheetChange = (sheet: CSSStyleSheet) => {
            if (queuedSheetChanges.has(sheet)) {
                return;
            }
            const sheetId = getSheetId(sheet);
            queueMicrotask(() => {
                const override = overrideSheets.get(sheet);
                if (override) {
                    relevantOverrides.delete(override);
                }
                sendSourceStyles([{sheetId, sheet}]);
            });
        };

        const executeCommands = (sheet: CSSStyleSheet, commands: StyleSheetCommand[]) => {
            executing = true;

            let override: CSSStyleSheet;
            if (overrideSheets.has(sheet)) {
                override = overrideSheets.get(sheet)!;
            } else {
                override = new CSSStyleSheet();
                overrideSheets.set(sheet, override);
            }

            commands.forEach((c) => {
                const {type, path, cssText} = c;
                let target: CSSStyleSheet | CSSGroupingRule = override;
                const pathLength = path.length - (type === 'replace' ? 0 : 1);
                for (let i = 0; i < pathLength; i++) {
                    target = target.cssRules[path[i]] as CSSGroupingRule;
                }
                const index = path.at(-1)!;
                if (type === 'insert') {
                    const cssText = c.cssText!;
                    target.insertRule(cssText, index);
                } else if (type === 'delete') {
                    target.deleteRule(index);
                } else if (type === 'replace') {
                    (target as CSSStyleSheet).replaceSync(cssText!);
                }
            });

            const nodes = sourceSheetNodes.get(sheet) ?? [];
            nodes.forEach((node) => putOverride(node, override));
            relevantOverrides.add(override);

            executing = false;
        };

        const putOverride = (node: Document | ShadowRoot, override: CSSStyleSheet) => {
            const wasExecuting = executing;
            executing = true;

            if (!node.isConnected) {
                cleanNode(node);
                return;
            }
            const overrideIndex = node.adoptedStyleSheets.indexOf(override);
            if (overrideIndex < 0) {
                node.adoptedStyleSheets.push(override);
            } else if (overrideIndex !== node.adoptedStyleSheets.length - 1) {
                node.adoptedStyleSheets.splice(overrideIndex, 1);
                node.adoptedStyleSheets.push(override);
            }

            if (!wasExecuting) {
                executing = false;
            }
        };

        const adoptedSheetsSourceProxies = new WeakMap<CSSStyleSheet[], CSSStyleSheet[]>();
        const adoptedSheetsProxySources = new WeakMap<CSSStyleSheet[], CSSStyleSheet[]>();

        const proxyArray = (node: Document | ShadowRoot, source: CSSStyleSheet[]) => {
            if (adoptedSheetsProxySources.has(source)) {
                return source;
            }
            if (adoptedSheetsSourceProxies.has(source)) {
                return adoptedSheetsSourceProxies.get(source)!;
            }
            const proxy = new Proxy(source, {
                deleteProperty(target, property) {
                    delete target[property as any];
                    return true;
                },
                set(target, property, value) {
                    target[property as any] = value;
                    if (property === 'length' && !executing) {
                        handleSheetChangeForNode(node);
                    }
                    return true;
                },
            });
            adoptedSheetsSourceProxies.set(source, proxy);
            adoptedSheetsProxySources.set(proxy, source);
            return proxy;
        };

        const proxyAdoptedStyleSheets = () => [Document, ShadowRoot].forEach((ctor: {prototype: Document | ShadowRoot}) => {
            overrideProperty(ctor, 'adoptedStyleSheets', {
                get: (native) => function () {
                    const source = native.call(this) as CSSStyleSheet[];
                    return proxyArray(this, source);
                },
                set: (native) => function (source) {
                    if (adoptedSheetsProxySources.has(source)) {
                        source = adoptedSheetsProxySources.get(source);
                    }
                    native.call(this, source);
                    handleSheetChangeForNode(this);
                },
            });
        });

        const proxyStyleDeclaration = () => (['setProperty', 'removeProperty'] as Array<keyof CSSStyleDeclaration>).forEach((key) => {
            override(CSSStyleDeclaration, key, (native) => {
                return function (...args: any[]) {
                    const returnValue = native.apply(this, args);
                    if (observableStyleDeclarations.has(this)) {
                        const sheet = observableStyleDeclarations.get(this)!;
                        handleSheetChange(sheet);
                    }
                    return returnValue;
                };
            });
        });

        const sendSourceStyles = (sheets: NodeSheet[]) => {
            const data = {detail: {sheets}};
            const event = new CustomEvent('__darkreader__adoptedStyleSheetsChange', data);
            document.dispatchEvent(event);
        };

        const commandsListener = (e: CustomEvent) => {
            const response = JSON.parse(e.detail) as Array<{sheetId: number; commands: StyleSheetCommand[]}>;
            response.forEach(({sheetId, commands}) => {
                const sheet = sheetsById.get(sheetId);
                if (sheet) {
                    executeCommands(sheet, commands);
                }
            });
        };

        onFFSheetChange = (sheet) => {
            if (sourceSheets.has(sheet)) {
                handleSheetChange(sheet);
            }
        };

        documentEventListener('__darkreader__startAdoptedStyleSheetsWatcher', () => {
            proxyAdoptedStyleSheets();
            proxyStyleDeclaration();

            documentEventListener('__darkreader__adoptedStyleSheetCommands', commandsListener);

            walkNodesWithAdoptedStyles(document, (node) => targetNodes.add(node));
            cleaners.push(() => targetNodes.forEach((node) => cleanNode(node)));

            const allSheets: NodeSheet[] = [];
            const addedSheetIds = new Set<number>();
            targetNodes.forEach((node) => {
                const sheets = getSourceSheets(node);
                const filtered = sheets.filter(({sheetId}) => !addedSheetIds.has(sheetId));
                allSheets.push(...filtered);
                filtered.forEach(({sheetId}) => addedSheetIds.add(sheetId));
            });
            sendSourceStyles(allSheets);
        });
    }
}

```

### inject\dynamic-theme\stylesheet-modifier.ts

```
import type {Theme} from '../../definitions';
import {isChromium} from '../../utils/platform';
import {getHashCode} from '../../utils/text';
import {createAsyncTasksQueue} from '../../utils/throttle';

import {iterateCSSRules, iterateCSSDeclarations, isMediaRule, isLayerRule, isStyleRule} from './css-rules';
import {themeCacheKeys} from './modify-colors';
import type {ModifiableCSSDeclaration, ModifiableCSSRule} from './modify-css';
import {getModifiableCSSDeclaration} from './modify-css';
import {variablesStore} from './variables';
import type {CSSVariableModifier} from './variables';

function getThemeKey(theme: Theme) {
    let resultKey = '';
    themeCacheKeys.forEach((key) => {
        resultKey += `${key}:${theme[key]};`;
    });
    return resultKey;
}

const asyncQueue = createAsyncTasksQueue();

interface ModifySheetOptions {
    sourceCSSRules: CSSRuleList | CSSRule[];
    theme: Theme;
    ignoreImageAnalysis: string[];
    force: boolean;
    prepareSheet: () => CSSBuilder;
    isAsyncCancelled: () => boolean;
}

interface StyleSheetModifier {
    modifySheet: (options: ModifySheetOptions) => void;
    shouldRebuildStyle: () => boolean;
}

export interface CSSBuilder {
    deleteRule(index: number): void;
    insertRule(rule: string, index?: number): number;
    cssRules: {
        readonly length: number;
        [index: number]: CSSBuilder | object;
    };
}

export function createStyleSheetModifier(): StyleSheetModifier {
    let renderId = 0;

    function getStyleRuleHash(rule: CSSStyleRule) {
        let cssText = rule.cssText;
        if (isMediaRule(rule.parentRule)) {
            cssText = `${rule.parentRule.media.mediaText} { ${cssText} }`;
        }
        return getHashCode(cssText);
    }

    const rulesTextCache = new Set<number>();
    const rulesModCache = new Map<number, ModifiableCSSRule>();
    const varTypeChangeCleaners = new Set<() => void>();
    let prevFilterKey: string | null = null;
    let hasNonLoadedLink = false;
    let wasRebuilt = false;
    function shouldRebuildStyle() {
        return hasNonLoadedLink && !wasRebuilt;
    }

    function modifySheet(options: ModifySheetOptions) {
        const rules = options.sourceCSSRules;
        const {theme, ignoreImageAnalysis, force, prepareSheet, isAsyncCancelled} = options;

        let rulesChanged = (rulesModCache.size === 0);
        const notFoundCacheKeys = new Set(rulesModCache.keys());
        const themeKey = getThemeKey(theme);
        const themeChanged = (themeKey !== prevFilterKey);

        if (hasNonLoadedLink) {
            wasRebuilt = true;
        }

        const modRules: ModifiableCSSRule[] = [];
        iterateCSSRules(rules, (rule) => {
            const hash = getStyleRuleHash(rule);
            let textDiffersFromPrev = false;

            notFoundCacheKeys.delete(hash);
            if (!rulesTextCache.has(hash)) {
                rulesTextCache.add(hash);
                textDiffersFromPrev = true;
            }

            if (textDiffersFromPrev) {
                rulesChanged = true;
            } else {
                modRules.push(rulesModCache.get(hash)!);
                return;
            }

            // A very specific case to skip. This causes a lot of calls to `getModifiableCSSDeclaration`
            // and currently contributes nothing in real-world case.
            // TODO: Allow `setRule` to throw a exception when we're modifying SVGs namespace styles.
            if (rule.style.all === 'revert') {
                return;
            }

            const modDecs: ModifiableCSSDeclaration[] = [];
            rule.style && iterateCSSDeclarations(rule.style, (property, value) => {
                const mod = getModifiableCSSDeclaration(property, value, rule, variablesStore, ignoreImageAnalysis, isAsyncCancelled);
                if (mod) {
                    modDecs.push(mod);
                }
            });

            let modRule: ModifiableCSSRule | null = null;
            if (modDecs.length > 0) {
                const parentRule = rule.parentRule!;
                modRule = {selector: rule.selectorText, declarations: modDecs, parentRule};
                modRules.push(modRule);
            }
            rulesModCache.set(hash, modRule!);
        }, () => {
            hasNonLoadedLink = true;
        });

        notFoundCacheKeys.forEach((key) => {
            rulesTextCache.delete(key);
            rulesModCache.delete(key);
        });
        prevFilterKey = themeKey;

        if (!force && !rulesChanged && !themeChanged) {
            return;
        }

        renderId++;

        interface ReadyGroup {
            isGroup: true;
            rule: CSSRule | null;
            rules: Array<ReadyGroup | ReadyStyleRule>;
        }

        interface ReadyStyleRule {
            isGroup: false;
            selector: string;
            declarations: ReadyDeclaration[];
        }

        interface ReadyDeclaration {
            property: string;
            value: string | Array<{property: string; value: string}> | null;
            important: boolean;
            sourceValue: string;
            asyncKey?: number;
            varKey?: number;
        }

        function setRule(target: CSSBuilder, index: number, rule: ReadyStyleRule) {
            const {selector, declarations} = rule;

            let selectorText = selector;
            // Empty :is() and :where() selectors or
            // selectors like :is(:where(:-unknown))
            // break Chrome 119 when calling deleteRule()
            const emptyIsWhereSelector = isChromium && selector.startsWith(':is(') && (
                selector.includes(':is()') ||
                selector.includes(':where()') ||
                (selector.includes(':where(') && selector.includes(':-moz'))
            );
            const viewTransitionSelector = selector.includes('::view-transition-');
            if (emptyIsWhereSelector || viewTransitionSelector) {
                selectorText = '.darkreader-unsupported-selector';
            }

            let ruleText = `${selectorText} {`;
            for (const dec of declarations) {
                const {property, value, important} = dec;
                if (value) {
                    ruleText += ` ${property}: ${value}${important ? ' !important' : ''};`;
                }
            }
            ruleText += ' }';

            target.insertRule(ruleText, index);
        }

        interface RuleInfo {
            rule: ReadyStyleRule;
            target: CSSBuilder;
            index: number;
        }

        const asyncDeclarations = new Map<number, RuleInfo>();
        const varDeclarations = new Map<number, RuleInfo>();
        let asyncDeclarationCounter = 0;
        let varDeclarationCounter = 0;

        const rootReadyGroup: ReadyGroup = {rule: null, rules: [], isGroup: true};
        const groupRefs = new WeakMap<CSSRule, ReadyGroup>();

        function getGroup(rule: CSSRule): ReadyGroup {
            if (rule == null) {
                return rootReadyGroup;
            }

            if (groupRefs.has(rule)) {
                return groupRefs.get(rule)!;
            }

            const group: ReadyGroup = {rule, rules: [], isGroup: true};
            groupRefs.set(rule, group);

            const parentGroup = getGroup(rule.parentRule!);
            parentGroup.rules.push(group);

            return group;
        }

        varTypeChangeCleaners.forEach((clear) => clear());
        varTypeChangeCleaners.clear();

        modRules.filter((r) => r).forEach(({selector, declarations, parentRule}) => {
            const group = getGroup(parentRule);
            const readyStyleRule: ReadyStyleRule = {selector, declarations: [], isGroup: false};
            const readyDeclarations = readyStyleRule.declarations;
            group.rules.push(readyStyleRule);

            function handleAsyncDeclaration(property: string, modified: Promise<string | null>, important: boolean, sourceValue: string) {
                const asyncKey = ++asyncDeclarationCounter;
                const asyncDeclaration: ReadyDeclaration = {property, value: null, important, asyncKey, sourceValue};
                readyDeclarations.push(asyncDeclaration);
                const currentRenderId = renderId;
                modified.then((asyncValue) => {
                    if (!asyncValue || isAsyncCancelled() || currentRenderId !== renderId) {
                        return;
                    }
                    asyncDeclaration.value = asyncValue;
                    asyncQueue.add(() => {
                        if (isAsyncCancelled() || currentRenderId !== renderId) {
                            return;
                        }
                        rebuildAsyncRule(asyncKey);
                    });
                });
            }

            function handleVarDeclarations(property: string, modified: ReturnType<CSSVariableModifier>, important: boolean, sourceValue: string) {
                const {declarations: varDecs, onTypeChange} = modified;
                const varKey = ++varDeclarationCounter;
                const currentRenderId = renderId;
                const initialIndex = readyDeclarations.length;
                let oldDecs: ReadyDeclaration[] = [];
                if (varDecs.length === 0) {
                    const tempDec = {property, value: sourceValue, important, sourceValue, varKey};
                    readyDeclarations.push(tempDec);
                    oldDecs = [tempDec];
                }
                varDecs.forEach((mod) => {
                    if (mod.value instanceof Promise) {
                        handleAsyncDeclaration(mod.property, mod.value, important, sourceValue);
                    } else {
                        const readyDec = {property: mod.property, value: mod.value, important, sourceValue, varKey};
                        readyDeclarations.push(readyDec);
                        oldDecs.push(readyDec);
                    }
                });
                onTypeChange.addListener((newDecs) => {
                    if (isAsyncCancelled() || currentRenderId !== renderId) {
                        return;
                    }
                    const readyVarDecs = newDecs.map((mod) => {
                        return {property: mod.property, value: mod.value as string, important, sourceValue, varKey};
                    });
                    // TODO: Don't search for index, store some way or use Linked List.
                    const index = readyDeclarations.indexOf(oldDecs[0], initialIndex);
                    readyDeclarations.splice(index, oldDecs.length, ...readyVarDecs);
                    oldDecs = readyVarDecs;
                    rebuildVarRule(varKey);
                });
                varTypeChangeCleaners.add(() => onTypeChange.removeListeners());
            }

            declarations.forEach(({property, value, important, sourceValue}) => {
                if (typeof value === 'function') {
                    const modified = value(theme);
                    if (modified instanceof Promise) {
                        handleAsyncDeclaration(property, modified, important, sourceValue);
                    } else if (property.startsWith('--')) {
                        handleVarDeclarations(property, modified as any, important, sourceValue);
                    } else {
                        readyDeclarations.push({property, value: modified as string, important, sourceValue});
                    }
                } else {
                    readyDeclarations.push({property, value, important, sourceValue});
                }
            });
        });

        const sheet = prepareSheet();

        function buildStyleSheet() {
            function createTarget(group: ReadyGroup, parent: CSSBuilder): CSSBuilder {
                const {rule} = group;
                if (isStyleRule(rule)) {
                    const {selectorText} = rule;
                    const index = parent.cssRules.length;
                    parent.insertRule(`${selectorText} {}`, index);
                    return parent.cssRules[index] as CSSBuilder;
                }
                if (isMediaRule(rule)) {
                    const {media} = rule;
                    const index = parent.cssRules.length;
                    parent.insertRule(`@media ${media.mediaText} {}`, index);
                    return parent.cssRules[index] as CSSBuilder;
                }
                if (isLayerRule(rule)) {
                    const {name} = rule;
                    const index = parent.cssRules.length;
                    parent.insertRule(`@layer ${name} {}`, index);
                    return parent.cssRules[index] as CSSBuilder;
                }
                return parent;
            }

            function iterateReadyRules(
                group: ReadyGroup,
                target: CSSBuilder,
                styleIterator: (s: ReadyStyleRule, t: CSSBuilder) => void,
            ) {
                group.rules.forEach((r) => {
                    if (r.isGroup) {
                        const t = createTarget(r, target);
                        iterateReadyRules(r, t, styleIterator);
                    } else {
                        styleIterator(r as ReadyStyleRule, target);
                    }
                });
            }

            iterateReadyRules(rootReadyGroup, sheet, (rule, target) => {
                const index = target.cssRules.length;
                rule.declarations.forEach(({asyncKey, varKey}) => {
                    if (asyncKey != null) {
                        asyncDeclarations.set(asyncKey, {rule, target, index});
                    }
                    if (varKey != null) {
                        varDeclarations.set(varKey, {rule, target, index});
                    }
                });
                setRule(target, index, rule);
            });
        }

        function rebuildAsyncRule(key: number) {
            const {rule, target, index} = asyncDeclarations.get(key)!;
            target.deleteRule(index);
            setRule(target, index, rule);
            asyncDeclarations.delete(key);
        }

        function rebuildVarRule(key: number) {
            const {rule, target, index} = varDeclarations.get(key)!;
            target.deleteRule(index);
            setRule(target, index, rule);
        }

        buildStyleSheet();
    }

    return {modifySheet, shouldRebuildStyle};
}

```

### inject\dynamic-theme\style-scope.ts

```
const sheetsScopes = new WeakMap<CSSStyleSheet, Document | ShadowRoot>();

export function defineSheetScope(sheet: CSSStyleSheet, node: Document | ShadowRoot): void {
    sheetsScopes.set(sheet, node);
}

export function getSheetScope(sheet: CSSStyleSheet): Document | ShadowRoot | null {
    if (!sheet.ownerNode) {
        return null;
    }
    if (sheetsScopes.has(sheet)) {
        return sheetsScopes.get(sheet)!;
    }
    let node: Node | null = sheet.ownerNode;
    while (node) {
        if (node instanceof ShadowRoot || node instanceof Document) {
            defineSheetScope(sheet, node);
            return node;
        }
        node = node.parentNode;
    }
    return null;
}

```

### inject\dynamic-theme\style-manager.ts

```
import { createCORSCopy } from '../../utils/cors';
import { injectStyleAway } from '../../utils/dom';

let corsCopy: HTMLStyleElement | null = null;
const fullCSSText: string = '/* Your CSS content here */';
const inMode: string = 'next'; // or 'default'
const element: HTMLElement = document.createElement('div');

// Add the element to the DOM
document.body.appendChild(element);

if (!corsCopy) {
    corsCopy = createCORSCopy(
        fullCSSText,
        inMode === 'next' ? (cc: HTMLStyleElement) => element.parentNode!.insertBefore(cc, element.nextSibling) : injectStyleAway,
    );
    if (corsCopy) {
        element.parentNode!.insertBefore(corsCopy, element.nextSibling);
    }
}

```

### inject\dynamic-theme\palette.ts

```
import {parseColorWithCache, rgbToHexString, type RGBA} from '../../utils/color';

interface RegisteredColor {
    parsed: RGBA;
    background?: {
        value: string;
        variable: string;
    };
    text?: {
        value: string;
        variable: string;
    };
    border?: {
        value: string;
        variable: string;
    };
}

type ColorType = 'background' | 'border' | 'text';

interface ColorPalette {
    background: RGBA[];
    border: RGBA[];
    text: RGBA[];
}

let variablesSheet: CSSStyleSheet | null;

const registeredColors = new Map<string, RegisteredColor>();

export function registerVariablesSheet(sheet: CSSStyleSheet): void {
    variablesSheet = sheet;
    const types: ColorType[] = ['background', 'text', 'border'];
    registeredColors.forEach((registered) => {
        types.forEach((type) => {
            if (registered[type]) {
                const {variable, value} = registered[type];
                (variablesSheet?.cssRules[0] as CSSStyleRule).style.setProperty(variable, value);
            }
        });
    });
}

export function releaseVariablesSheet(): void {
    variablesSheet = null;
    clearColorPalette();
}

function getRegisteredVariableValue(type: ColorType, registered: RegisteredColor) {
    return `var(${registered[type]!.variable}, ${registered[type]!.value})`;
}

export function getRegisteredColor(type: ColorType, parsed: RGBA): string | null {
    const hex = rgbToHexString(parsed);
    const registered = registeredColors.get(hex);
    if (registered?.[type]) {
        return getRegisteredVariableValue(type, registered);
    }
    return null;
}

export function registerColor(type: ColorType, parsed: RGBA, value: string): string {
    const hex = rgbToHexString(parsed);

    let registered: RegisteredColor;
    if (registeredColors.has(hex)) {
        registered = registeredColors.get(hex)!;
    } else {
        const parsed = parseColorWithCache(hex)!;
        registered = {parsed};
        registeredColors.set(hex, registered);
    }

    const variable = `--darkreader-${type}-${hex.replace('#', '')}`;
    registered[type] = {variable, value};
    if ((variablesSheet?.cssRules[0] as CSSStyleRule)?.style) {
        (variablesSheet?.cssRules[0] as CSSStyleRule).style.setProperty(variable, value);
    }

    return getRegisteredVariableValue(type, registered);
}

export function getColorPalette(): ColorPalette {
    const background: RGBA[] = [];
    const border: RGBA[] = [];
    const text: RGBA[] = [];

    registeredColors.forEach((registered) => {
        if (registered.background) {
            background.push(registered.parsed);
        }
        if (registered.border) {
            border.push(registered.parsed);
        }
        if (registered.text) {
            text.push(registered.parsed);
        }
    });

    return {background, border, text};
}

export function clearColorPalette(): void {
    registeredColors.clear();
}

```

### inject\dynamic-theme\network.ts

```
import type {MessageBGtoCS, MessageCStoBG} from '../../definitions';
import {MessageTypeBGtoCS, MessageTypeCStoBG} from '../../utils/message';
import {generateUID} from '../../utils/uid';

interface FetchRequest {
    url: string;
    responseType: 'data-url' | 'text';
    mimeType?: string;
    origin?: string;
}

const resolvers = new Map<string, (data: string) => void>();
const rejectors = new Map<string, (reason?: any) => void>();

export async function bgFetch(request: FetchRequest): Promise<string> {
    if ((window as any).DarkReader?.Plugins?.fetch) {
        return (window as any).DarkReader.Plugins.fetch(request);
    }
    return new Promise<string>((resolve, reject) => {
        const id = generateUID();
        resolvers.set(id, resolve);
        rejectors.set(id, reject);
        chrome.runtime.sendMessage<MessageCStoBG>({type: MessageTypeCStoBG.FETCH, data: request, id});
    });
}

chrome.runtime.onMessage.addListener(({type, data, error, id}: MessageBGtoCS) => {
    if (type === MessageTypeBGtoCS.FETCH_RESPONSE) {
        const resolve = resolvers.get(id!);
        const reject = rejectors.get(id!);
        resolvers.delete(id!);
        rejectors.delete(id!);
        if (error) {
            reject && reject(error);
        } else {
            resolve && resolve(data);
        }
    }
});

```

### inject\dynamic-theme\mv3-proxy.ts

```
import {logInfo} from '../utils/log';

import {injectProxy} from './stylesheet-proxy';

document.currentScript && document.currentScript.remove();

const key = 'darkreaderProxyInjected';
const EVENT_DONE = '__darkreader__stylesheetProxy__done';
const EVENT_ARG = '__darkreader__stylesheetProxy__arg';

const registeredScriptPath = !document.currentScript;

function injectProxyAndCleanup(args: {enableStyleSheetsProxy: boolean; enableCustomElementRegistryProxy: boolean}) {
    injectProxy(args.enableStyleSheetsProxy, args.enableCustomElementRegistryProxy);
    doneReceiver();
    document.dispatchEvent(new CustomEvent(EVENT_DONE));
}

function regularPath() {
    const argString = document.currentScript!.dataset.arg;
    if (argString !== undefined) {
        document.documentElement.dataset[key] = 'true';
        const args: {enableStyleSheetsProxy: boolean; enableCustomElementRegistryProxy: boolean} = JSON.parse(argString);
        logInfo(`MV3 proxy injector: regular path runs injectProxy(${argString}).`);
        injectProxyAndCleanup(args);
    }
}

function dataReceiver(e: any) {
    document.removeEventListener(EVENT_ARG, dataReceiver);
    if (document.documentElement.dataset[key] !== undefined) {
        logInfo(`MV3 proxy injector: ${registeredScriptPath ? 'registered' : 'dedicated'} path exits because everything is done.`);
        return;
    }
    document.documentElement.dataset[key] = 'true';
    logInfo(`MV3 proxy injector: ${registeredScriptPath ? 'registered' : 'dedicated'} path runs injectProxy(${e.detail}).`);
    injectProxyAndCleanup(e.detail);
}

function doneReceiver() {
    document.removeEventListener(EVENT_ARG, dataReceiver);
    document.removeEventListener(EVENT_DONE, doneReceiver);
}

function dedicatedPath() {
    logInfo(`MV3 proxy injector: ${registeredScriptPath ? 'registered' : 'dedicated'} path setup...`);
    // TODO: use EventListenerOptions class once it is updated
    // Note: make sure capture is not set
    const listenerOptions: any = {
        passive: true,
        once: true,
    };
    document.addEventListener(EVENT_ARG, dataReceiver, listenerOptions);
    document.addEventListener(EVENT_DONE, doneReceiver, listenerOptions);
}

function inject() {
    if (document.documentElement.dataset[key] !== undefined) {
        logInfo('MV3 proxy injector: proxy exits because everything is done.');
        return;
    }
    logInfo('MV3 proxy injector: proxy attempts to inject...');
    document.currentScript && regularPath();
    dedicatedPath();
}

inject();

```

### inject\dynamic-theme\modify-css.ts

```
import type {Theme} from '../../definitions';
import {parseColorWithCache} from '../../utils/color';
import {parseGradient} from '../../utils/css-text/parse-gradient';
import {getAbsoluteURL} from '../../utils/url';
import {logWarn, logInfo} from '../utils/log';

import {cssURLRegex, getCSSURLValue} from './css-rules';
import {cleanImageProcessingCache} from './image';
import {modifyBackgroundColor, modifyBorderColor, modifyForegroundColor, modifyGradientColor, modifyShadowColor, clearColorModificationCache} from './modify-colors';
import type {VariablesStore} from './variables';

// Type definitions
export interface ModifiableCSSDeclaration {
    property: string;
    value: string;
    important?: boolean;
    sourceValue: string;
    modifier?: CSSValueModifier | null;
}

export interface ModifiableCSSRule extends CSSStyleRule {
    parentStyleSheet: CSSStyleSheet | null;
}

export type CSSValueModifier = (theme: Theme) => string | Promise<string | null>;

// Cache management
const modificationCache = new Map<string, any>();
const shadowCache = new Map<string, CSSValueModifier>();
const gradientCache = new Map<string, CSSValueModifier>();

export function cleanModificationCache(): void {
    modificationCache.clear();
    shadowCache.clear();
    gradientCache.clear();
    clearColorModificationCache();
    cleanImageProcessingCache();
}

// Background image property checks
const backgroundImageProperties = [
    'background-image',
    'background',
    'border-image',
    'border-image-source',
    'content',
    'cursor',
    'list-style-image',
    '-webkit-mask-image',
    'mask-image',
];

const backgroundProperties = [
    'background',
    'background-color',
    'background-image',
    'background-position',
    'background-size',
    'background-repeat',
    'background-attachment',
    'background-origin',
    'background-clip',
];

const borderProperties = [
    'border',
    'border-color',
    'border-top',
    'border-right',
    'border-bottom',
    'border-left',
    'border-top-color',
    'border-right-color',
    'border-bottom-color',
    'border-left-color',
    'outline',
    'outline-color',
];

const textColorProperties = [
    'color',
    'caret-color',
    'fill',
    'stroke',
    '-webkit-text-fill-color',
    '-webkit-text-stroke-color',
];

const shadowProperties = [
    'box-shadow',
    'text-shadow',
    '-webkit-box-shadow',
];

// Property type checking functions
function isColorProperty(property: string): boolean {
    return textColorProperties.includes(property);
}

function isBackgroundProperty(property: string): boolean {
    return backgroundProperties.includes(property);
}

function isBorderProperty(property: string): boolean {
    return borderProperties.includes(property);
}

function isShadowProperty(property: string): boolean {
    return shadowProperties.includes(property);
}

function isImageProperty(property: string): boolean {
    return backgroundImageProperties.includes(property);
}

// Value parsing helpers
function hasColor(value: string): boolean {
    return parseColorWithCache(value) != null;
}

function hasURL(value: string): boolean {
    return /url\s*\(/i.test(value);
}

function hasGradient(value: string): boolean {
    return /(linear|radial|conic)-gradient\s*\(/i.test(value);
}

function hasVar(value: string): boolean {
    return /var\s*\(/i.test(value);
}

// Core modification function
export function getModifiableCSSDeclaration(
    property: string,
    value: string,
    rule?: ModifiableCSSRule,
    variablesStore?: VariablesStore | null,
    ignoreImageAnalysis: string[] = [],
    isAsyncCancelled?: () => boolean
): ModifiableCSSDeclaration | null {
    if (!value || value === 'inherit' || value === 'initial' || value === 'unset') {
        return null;
    }

    const sourceValue = value;
    let modifier: CSSValueModifier | null = null;

    // Handle CSS variables first
    if (hasVar(value) && variablesStore) {
        modifier = variablesStore.getModifierForVarDependant(property, value);
        if (modifier) {
            return {
                property,
                value,
                sourceValue,
                modifier,
            };
        }
    }

    // Handle different property types
    if (isColorProperty(property) && hasColor(value)) {
        modifier = (theme: Theme) => modifyForegroundColor(parseColorWithCache(value)!, theme);
    } else if (property === 'background-color' && hasColor(value)) {
        modifier = (theme: Theme) => modifyBackgroundColor(parseColorWithCache(value)!, theme);
    } else if (isBorderProperty(property) && hasColor(value)) {
        modifier = (theme: Theme) => modifyBorderColor(parseColorWithCache(value)!, theme);
    } else if (isShadowProperty(property)) {
        const shadowModifier = getShadowModifierWithInfo(value);
        if (shadowModifier) {
            modifier = shadowModifier;
        }
    } else if (isBackgroundProperty(property) && (hasURL(value) || hasGradient(value))) {
        const bgModifier = getBgImageModifier(value, rule, ignoreImageAnalysis, isAsyncCancelled);
        modifier = typeof bgModifier === 'function' ? bgModifier : null;
    } else if (isImageProperty(property) && hasURL(value)) {
        const bgModifier = getBgImageModifier(value, rule, ignoreImageAnalysis, isAsyncCancelled);
        modifier = typeof bgModifier === 'function' ? bgModifier : null;
    }

    if (modifier) {
        return {
            property,
            value,
            sourceValue,
            modifier,
        };
    }

    return null;
}

// Background image modification
export function getBgImageModifier(
    value: string | Promise<string | null>,
    rule?: ModifiableCSSRule,
    ignoredImageAnalysisSelectors: string[] = [],
    isCancelled?: () => boolean
): CSSValueModifier | string | null {
    if (typeof value === 'object' && value && 'then' in value) {
        // Handle Promise<string | null>
        return async (theme: Theme) => {
            const resolvedValue = await value;
            if (!resolvedValue) {
                return null;
            }
            const modifier = getBgImageModifier(resolvedValue, rule, ignoredImageAnalysisSelectors, isCancelled);
            if (typeof modifier === 'function') {
                return modifier(theme);
            }
            return modifier;
        };
    }

    const stringValue = value as string;
    const cacheKey = `bg:${stringValue}`;

    if (gradientCache.has(cacheKey)) {
        return gradientCache.get(cacheKey)!;
    }

    // Handle gradients
    if (hasGradient(stringValue)) {
        const gradientModifier = (theme: Theme) => {
            return stringValue.replace(/(linear|radial|conic)-gradient\s*\([^)]+\)/gi, (match) => {
                try {
                    const gradients = parseGradient(match);
                    if (gradients && gradients.length > 0) {
                        return modifyGradient(gradients[0], theme);
                    }
                    return match;
                } catch (err) {
                    logWarn('Failed to parse gradient:', match, err);
                    return match;
                }
            });
        };
        gradientCache.set(cacheKey, gradientModifier);
        return gradientModifier;
    }

    // Handle URLs (images)
    if (hasURL(stringValue)) {
        const urlModifier = (_theme: Theme) => {
            return stringValue.replace(cssURLRegex, (match) => {
                try {
                    const url = getCSSURLValue(match);
                    if (url.startsWith('data:')) {
                        return match; // Skip data URLs for now
                    }

                    getAbsoluteURL(rule?.parentStyleSheet?.href || location.href, url);

                    // Check if image analysis should be ignored
                    if (rule && ignoredImageAnalysisSelectors.some((selector) =>
                        rule.selectorText && rule.selectorText.includes(selector))) {
                        return match;
                    }

                    // For now, return the original match
                    // Image processing would be async and complex
                    return match;
                } catch (err) {
                    logWarn('Failed to process URL:', match, err);
                    return match;
                }
            });
        };
        return urlModifier;
    }

    // Handle solid colors in background shorthand
    const color = parseColorWithCache(stringValue);
    if (color) {
        return (theme: Theme) => modifyBackgroundColor(color, theme);
    }

    return null;
}

// Gradient modification helper
function modifyGradient(gradient: any, theme: Theme): string {
    // Simple gradient color replacement for now
    // This is a simplified implementation
    const gradientString = gradient.match || gradient.toString();

    return gradientString.replace(/(#[0-9a-fA-F]{3,8}|rgba?\([^)]+\)|hsla?\([^)]+\))/g, (colorMatch: string) => {
        const color = parseColorWithCache(colorMatch);
        if (color) {
            return modifyGradientColor(color, theme);
        }
        return colorMatch;
    });
}

// Shadow modification
export function getShadowModifierWithInfo(value: string): CSSValueModifier | null {
    const cacheKey = `shadow:${value}`;

    if (shadowCache.has(cacheKey)) {
        return shadowCache.get(cacheKey)!;
    }

    if (!value || value === 'none') {
        return null;
    }

    const shadowModifier = (theme: Theme): string => {
        // Simple shadow parsing - split by comma for multiple shadows
        const shadows = value.split(',').map((shadow) => shadow.trim());

        const modifiedShadows = shadows.map((shadow) => {
            // Extract color from shadow
            const colorMatch = shadow.match(/(rgba?\([^)]+\)|hsla?\([^)]+\)|#[0-9a-fA-F]+|\b(?:red|blue|green|yellow|black|white|gray|grey|transparent)\b)/);

            if (colorMatch) {
                const color = parseColorWithCache(colorMatch[0]);
                if (color) {
                    const modifiedColor = modifyShadowColor(color, theme);
                    return shadow.replace(colorMatch[0], modifiedColor);
                }
            }

            return shadow;
        });

        return modifiedShadows.join(', ');
    };

    shadowCache.set(cacheKey, shadowModifier);
    return shadowModifier;
}

// User agent style generation
export function getModifiedUserAgentStyle(theme: Theme, isIFrame: boolean, styleSystemControls: boolean): string {
    const lines: string[] = [];

    lines.push('html {');
    lines.push(`    background: ${modifyBackgroundColor(parseColorWithCache('#ffffff')!, theme)} !important;`);
    lines.push('}');

    if (isIFrame) {
        lines.push('');
        lines.push('html, body {');
        lines.push(`    border-color: ${modifyBorderColor(parseColorWithCache('#999999')!, theme)} !important;`);
        lines.push('}');
    }

    if (styleSystemControls) {
        lines.push('');
        lines.push('input, textarea, select, button {');
        lines.push(`    background-color: ${modifyBackgroundColor(parseColorWithCache('#ffffff')!, theme)} !important;`);
        lines.push(`    border-color: ${modifyBorderColor(parseColorWithCache('#999999')!, theme)} !important;`);
        lines.push(`    color: ${modifyForegroundColor(parseColorWithCache('#000000')!, theme)} !important;`);
        lines.push('}');

        lines.push('');
        lines.push('input[type="range"] {');
        lines.push(`    background-color: ${modifyBackgroundColor(parseColorWithCache('#dddddd')!, theme)} !important;`);
        lines.push('}');
    }

    return lines.join('\n');
}

// Fallback style generation
export function getModifiedFallbackStyle(theme: Theme, options: {strict: boolean}): string {
    const lines: string[] = [];

    const bgColor = modifyBackgroundColor(parseColorWithCache('#ffffff')!, theme);
    const textColor = modifyForegroundColor(parseColorWithCache('#000000')!, theme);
    const borderColor = modifyBorderColor(parseColorWithCache('#999999')!, theme);

    if (options.strict) {
        lines.push('html, body {');
        lines.push(`    background: ${bgColor} !important;`);
        lines.push(`    color: ${textColor} !important;`);
        lines.push('}');
    } else {
        lines.push('html {');
        lines.push(`    background: ${bgColor} !important;`);
        lines.push('}');
        lines.push('');
        lines.push('body {');
        lines.push(`    color: ${textColor} !important;`);
        lines.push('}');
    }

    lines.push('');
    lines.push('input, textarea, select, button {');
    lines.push(`    background: ${bgColor} !important;`);
    lines.push(`    color: ${textColor} !important;`);
    lines.push(`    border-color: ${borderColor} !important;`);
    lines.push('}');

    return lines.join('\n');
}

// Selection color generation
export function getSelectionColor(theme: Theme): {backgroundColorSelection: string; foregroundColorSelection: string} {
    const selectionBg = theme.selectionColor || '#005a9c';
    const selectionText = '#ffffff';

    return {
        backgroundColorSelection: modifyBackgroundColor(parseColorWithCache(selectionBg)!, theme),
        foregroundColorSelection: modifyForegroundColor(parseColorWithCache(selectionText)!, theme),
    };
}

// Image selector checking
export function checkImageSelectors(node: Node): void {
    if (node.nodeType !== Node.ELEMENT_NODE) {
        return;
    }

    const element = node as Element;

    // Check for background images in inline styles
    if (element instanceof HTMLElement && element.style) {
        const bgImage = element.style.backgroundImage;
        if (bgImage && hasURL(bgImage)) {
            // Trigger image processing if needed
            logInfo('Found background image in inline style:', bgImage);
        }
    }

    // Check img elements
    if (element.tagName === 'IMG') {
        const img = element as HTMLImageElement;
        if (img.src) {
            logInfo('Found img element:', img.src);
        }
    }

    // Recursively check child nodes
    const children = element.children;
    for (let i = 0; i < children.length; i++) {
        checkImageSelectors(children[i]);
    }
}

// Factory function for creating fallback handlers
export function createFallbackFactory(): () => string {
    return () => {
        return `
            html { background: #111 !important; }
            body { color: #e8e6e3 !important; }
        `;
    };
}

```

### inject\dynamic-theme\modify-colors.ts

```
import {extendThemeCacheKeys, getBackgroundPoles, getTextPoles, modifyBgColorExtended, modifyFgColorExtended, modifyLightSchemeColorExtended} from '@plus/utils/theme';
import type {Theme} from '../../definitions';
import {applyColorMatrix, createFilterMatrix} from '../../generators/utils/matrix';
import {getRegisteredColor, registerColor} from '../../inject/dynamic-theme/palette';
import type {RGBA, HSLA} from '../../utils/color';
import {parseToHSLWithCache, rgbToHSL, hslToRGB, rgbToString, rgbToHexString} from '../../utils/color';
import {scale} from '../../utils/math';

type ColorFunction = (hsl: HSLA) => HSLA;

declare const __PLUS__: boolean;

function getBgPole(theme: Theme) {
    const isDarkScheme = theme.mode === 1;
    const prop: keyof Theme = isDarkScheme ? 'darkSchemeBackgroundColor' : 'lightSchemeBackgroundColor';
    return theme[prop];
}

function getFgPole(theme: Theme) {
    const isDarkScheme = theme.mode === 1;
    const prop: keyof Theme = isDarkScheme ? 'darkSchemeTextColor' : 'lightSchemeTextColor';
    return theme[prop];
}

const colorModificationCache = new Map<ColorFunction, Map<string, string>>();

export function clearColorModificationCache(): void {
    colorModificationCache.clear();
}

const rgbCacheKeys: Array<keyof RGBA> = ['r', 'g', 'b', 'a'];

export const themeCacheKeys: Array<keyof Theme> = [
    'mode',
    'brightness',
    'contrast',
    'grayscale',
    'sepia',
    'darkSchemeBackgroundColor',
    'darkSchemeTextColor',
    'lightSchemeBackgroundColor',
    'lightSchemeTextColor',
];
extendThemeCacheKeys(themeCacheKeys);

function getCacheId(rgb: RGBA, theme: Theme): string {
    let resultId = '';
    rgbCacheKeys.forEach((key) => {
        resultId += `${rgb[key]};`;
    });
    themeCacheKeys.forEach((key) => {
        resultId += `${theme[key]};`;
    });
    return resultId;
}

function modifyColorWithCache(rgb: RGBA, theme: Theme, modifyHSL: (hsl: HSLA, pole?: HSLA | null, anotherPole?: HSLA | null) => HSLA, poleColor?: string, anotherPoleColor?: string): string {
    let fnCache: Map<string, string>;
    if (colorModificationCache.has(modifyHSL)) {
        fnCache = colorModificationCache.get(modifyHSL)!;
    } else {
        fnCache = new Map();
        colorModificationCache.set(modifyHSL, fnCache);
    }
    const id = getCacheId(rgb, theme);
    if (fnCache.has(id)) {
        return fnCache.get(id)!;
    }

    const hsl = rgbToHSL(rgb);
    const pole = poleColor == null ? null : parseToHSLWithCache(poleColor);
    const anotherPole = anotherPoleColor == null ? null : parseToHSLWithCache(anotherPoleColor);
    const modified = modifyHSL(hsl, pole, anotherPole);
    const {r, g, b, a} = hslToRGB(modified);
    const matrix = createFilterMatrix({...theme, mode: 0});
    const [rf, gf, bf] = applyColorMatrix([r, g, b], matrix);

    const color = (a === 1 ?
        rgbToHexString({r: rf, g: gf, b: bf}) :
        rgbToString({r: rf, g: gf, b: bf, a}));

    fnCache.set(id, color);
    return color;
}

function noopHSL(hsl: HSLA): HSLA {
    return hsl;
}

export function modifyColor(rgb: RGBA, theme: Theme): string {
    return modifyColorWithCache(rgb, theme, noopHSL);
}

function modifyAndRegisterColor(
    type: 'background' | 'text' | 'border',
    rgb: RGBA,
    theme: Theme,
    modifier: (rgb: RGBA, theme: Theme) => string,
) {
    const registered = getRegisteredColor(type, rgb);
    if (registered) {
        return registered;
    }
    const value = modifier(rgb, theme);
    return registerColor(type, rgb, value);
}

function modifyLightSchemeColor(rgb: RGBA, theme: Theme): string {
    const poleBg = getBgPole(theme);
    const poleFg = getFgPole(theme);
    return modifyColorWithCache(rgb, theme, modifyLightModeHSL, poleFg, poleBg);
}

function modifyLightModeHSL({h, s, l, a}: HSLA, poleFg: HSLA, poleBg: HSLA): HSLA {
    const isDark = l < 0.5;
    let isNeutral: boolean;
    if (isDark) {
        isNeutral = l < 0.2 || s < 0.12;
    } else {
        const isBlue = h > 200 && h < 280;
        isNeutral = s < 0.24 || (l > 0.8 && isBlue);
    }

    let hx = h;
    let sx = s;
    if (isNeutral) {
        if (isDark) {
            hx = poleFg.h;
            sx = poleFg.s;
        } else {
            hx = poleBg.h;
            sx = poleBg.s;
        }
    }

    const lx = scale(l, 0, 1, poleFg.l, poleBg.l);

    return {h: hx, s: sx, l: lx, a};
}

const MAX_BG_LIGHTNESS = 0.4;

function modifyBgHSL({h, s, l, a}: HSLA, pole: HSLA): HSLA {
    const isDark = l < 0.5;
    const isBlue = h > 200 && h < 280;
    const isNeutral = s < 0.12 || (l > 0.8 && isBlue);
    if (isDark) {
        const lx = scale(l, 0, 0.5, 0, MAX_BG_LIGHTNESS);
        if (isNeutral) {
            const hx = pole.h;
            const sx = pole.s;
            return {h: hx, s: sx, l: lx, a};
        }
        return {h, s, l: lx, a};
    }

    let lx = scale(l, 0.5, 1, MAX_BG_LIGHTNESS, pole.l);

    if (isNeutral) {
        const hx = pole.h;
        const sx = pole.s;
        return {h: hx, s: sx, l: lx, a};
    }

    let hx = h;
    const isYellow = h > 60 && h < 180;
    if (isYellow) {
        const isCloserToGreen = h > 120;
        if (isCloserToGreen) {
            hx = scale(h, 120, 180, 135, 180);
        } else {
            hx = scale(h, 60, 120, 60, 105);
        }
    }

    // Lower the lightness, if the resulting
    // hue is in lower yellow spectrum.
    if (hx > 40 && hx < 80) {
        lx *= 0.75;
    }

    return {h: hx, s, l: lx, a};
}

function _modifyBackgroundColor(rgb: RGBA, theme: Theme) {
    if (theme.mode === 0) {
        if (__PLUS__) {
            const poles = getBackgroundPoles(theme);
            return modifyColorWithCache(rgb, theme, modifyLightSchemeColorExtended, poles[0], poles[1]);
        }
        return modifyLightSchemeColor(rgb, theme);
    }
    if (__PLUS__) {
        const poles = getBackgroundPoles(theme);
        return modifyColorWithCache(rgb, theme, modifyBgColorExtended, poles[0], poles[1]);
    }
    const pole = getBgPole(theme);
    return modifyColorWithCache(rgb, theme, modifyBgHSL, pole);
}

export function modifyBackgroundColor(rgb: RGBA, theme: Theme, shouldRegisterColorVariable = true): string {
    if (!shouldRegisterColorVariable) {
        return _modifyBackgroundColor(rgb, theme);
    }
    return modifyAndRegisterColor('background', rgb, theme, _modifyBackgroundColor);
}

const MIN_FG_LIGHTNESS = 0.55;

function modifyBlueFgHue(hue: number): number {
    return scale(hue, 205, 245, 205, 220);
}

function modifyFgHSL({h, s, l, a}: HSLA, pole: HSLA): HSLA {
    const isLight = l > 0.5;
    const isNeutral = l < 0.2 || s < 0.24;
    const isBlue = !isNeutral && h > 205 && h < 245;
    if (isLight) {
        const lx = scale(l, 0.5, 1, MIN_FG_LIGHTNESS, pole.l);
        if (isNeutral) {
            const hx = pole.h;
            const sx = pole.s;
            return {h: hx, s: sx, l: lx, a};
        }
        let hx = h;
        if (isBlue) {
            hx = modifyBlueFgHue(h);
        }
        return {h: hx, s, l: lx, a};
    }

    if (isNeutral) {
        const hx = pole.h;
        const sx = pole.s;
        const lx = scale(l, 0, 0.5, pole.l, MIN_FG_LIGHTNESS);
        return {h: hx, s: sx, l: lx, a};
    }

    let hx = h;
    let lx: number;
    if (isBlue) {
        hx = modifyBlueFgHue(h);
        lx = scale(l, 0, 0.5, pole.l, Math.min(1, MIN_FG_LIGHTNESS + 0.05));
    } else {
        lx = scale(l, 0, 0.5, pole.l, MIN_FG_LIGHTNESS);
    }

    return {h: hx, s, l: lx, a};
}

function _modifyForegroundColor(rgb: RGBA, theme: Theme) {
    if (theme.mode === 0) {
        if (__PLUS__) {
            const poles = getTextPoles(theme);
            return modifyColorWithCache(rgb, theme, modifyLightSchemeColorExtended, poles[0], poles[1]);
        }
        return modifyLightSchemeColor(rgb, theme);
    }
    if (__PLUS__) {
        const poles = getTextPoles(theme);
        return modifyColorWithCache(rgb, theme, modifyFgColorExtended, poles[0], poles[1]);
    }
    const pole = getFgPole(theme);
    return modifyColorWithCache(rgb, theme, modifyFgHSL, pole);
}

export function modifyForegroundColor(rgb: RGBA, theme: Theme, shouldRegisterColorVariable = true): string {
    if (!shouldRegisterColorVariable) {
        return _modifyForegroundColor(rgb, theme);
    }
    return modifyAndRegisterColor('text', rgb, theme, _modifyForegroundColor);
}

function modifyBorderHSL({h, s, l, a}: HSLA, poleFg: HSLA, poleBg: HSLA): HSLA {
    const isDark = l < 0.5;
    const isNeutral = l < 0.2 || s < 0.24;

    let hx = h;
    let sx = s;

    if (isNeutral) {
        if (isDark) {
            hx = poleFg.h;
            sx = poleFg.s;
        } else {
            hx = poleBg.h;
            sx = poleBg.s;
        }
    }

    const lx = scale(l, 0, 1, 0.5, 0.2);

    return {h: hx, s: sx, l: lx, a};
}

function _modifyBorderColor(rgb: RGBA, theme: Theme) {
    if (theme.mode === 0) {
        return modifyLightSchemeColor(rgb, theme);
    }
    const poleFg = getFgPole(theme);
    const poleBg = getBgPole(theme);
    return modifyColorWithCache(rgb, theme, modifyBorderHSL, poleFg, poleBg);
}

export function modifyBorderColor(rgb: RGBA, theme: Theme, shouldRegisterColorVariable = true): string {
    if (!shouldRegisterColorVariable) {
        return _modifyBorderColor(rgb, theme);
    }
    return modifyAndRegisterColor('border', rgb, theme, _modifyBorderColor);
}

export function modifyShadowColor(rgb: RGBA, theme: Theme): string {
    return modifyBackgroundColor(rgb, theme);
}

export function modifyGradientColor(rgb: RGBA, theme: Theme): string {
    return modifyBackgroundColor(rgb, theme);
}

```

### inject\dynamic-theme\meta-theme-color.ts

```
import type {Theme} from '../../definitions';
import {parseColorWithCache} from '../../utils/color';
import {logWarn} from '../utils/log';

import {modifyBackgroundColor} from './modify-colors';

const metaThemeColorName = 'theme-color';
const metaThemeColorSelector = `meta[name="${metaThemeColorName}"]`;
let srcMetaThemeColor: string | null = null;
let observer: MutationObserver | null = null;

function changeMetaThemeColor(meta: HTMLMetaElement, theme: Theme) {
    srcMetaThemeColor = srcMetaThemeColor ?? meta.content;
    const color = parseColorWithCache(srcMetaThemeColor);
    if (!color) {
        logWarn('Invalid meta color', color);
        return;
    }
    meta.content = modifyBackgroundColor(color, theme, false);
}

export function changeMetaThemeColorWhenAvailable(theme: Theme): void {
    const meta: HTMLMetaElement = document.querySelector(metaThemeColorSelector)!;
    if (meta) {
        changeMetaThemeColor(meta, theme);
    } else {
        if (observer) {
            observer.disconnect();
        }
        observer = new MutationObserver((mutations) => {
            for (const mutation of mutations) {
                const {addedNodes} = mutation;
                for (const node of addedNodes) {
                    if (node instanceof HTMLMetaElement && node.name === metaThemeColorName) {
                        observer!.disconnect();
                        observer = null;
                        changeMetaThemeColor(node, theme);
                        return;
                    }
                }
            }
        });
        observer.observe(document.head, {childList: true});
    }
}

export function restoreMetaThemeColor(): void {
    if (observer) {
        observer.disconnect();
        observer = null;
    }
    const meta = document.querySelector(metaThemeColorSelector) as HTMLMetaElement;
    if (meta && srcMetaThemeColor) {
        meta.content = srcMetaThemeColor;
    }
}

```

### inject\dynamic-theme\inline-style.ts

```
import type {Theme} from '../../definitions';
import {forEach, push} from '../../utils/array';
import {isShadowDomSupported} from '../../utils/platform';
import {throttle} from '../../utils/throttle';
import {getDuration} from '../../utils/time';
import {getAbsoluteURL} from '../../utils/url';
import {iterateShadowHosts, createOptimizedTreeObserver, isReadyStateComplete, addReadyStateCompleteListener, addDOMReadyListener, isDOMReady} from '../utils/dom';

import {iterateCSSDeclarations} from './css-rules';
import {getImageDetails} from './image';
import {getModifiableCSSDeclaration} from './modify-css';
import type {CSSVariableModifier, ModifiedVarDeclaration} from './variables';
import {variablesStore} from './variables';


interface Overrides {
    [cssProp: string]: {
        customProp: string;
        cssProp: string;
        dataAttr: string;
    };
}

const overrides: Overrides = {
    'background-color': {
        customProp: '--darkreader-inline-bgcolor',
        cssProp: 'background-color',
        dataAttr: 'data-darkreader-inline-bgcolor',
    },
    'background-image': {
        customProp: '--darkreader-inline-bgimage',
        cssProp: 'background-image',
        dataAttr: 'data-darkreader-inline-bgimage',
    },
    'border-color': {
        customProp: '--darkreader-inline-border',
        cssProp: 'border-color',
        dataAttr: 'data-darkreader-inline-border',
    },
    'border-bottom-color': {
        customProp: '--darkreader-inline-border-bottom',
        cssProp: 'border-bottom-color',
        dataAttr: 'data-darkreader-inline-border-bottom',
    },
    'border-left-color': {
        customProp: '--darkreader-inline-border-left',
        cssProp: 'border-left-color',
        dataAttr: 'data-darkreader-inline-border-left',
    },
    'border-right-color': {
        customProp: '--darkreader-inline-border-right',
        cssProp: 'border-right-color',
        dataAttr: 'data-darkreader-inline-border-right',
    },
    'border-top-color': {
        customProp: '--darkreader-inline-border-top',
        cssProp: 'border-top-color',
        dataAttr: 'data-darkreader-inline-border-top',
    },
    'box-shadow': {
        customProp: '--darkreader-inline-boxshadow',
        cssProp: 'box-shadow',
        dataAttr: 'data-darkreader-inline-boxshadow',
    },
    'color': {
        customProp: '--darkreader-inline-color',
        cssProp: 'color',
        dataAttr: 'data-darkreader-inline-color',
    },
    'fill': {
        customProp: '--darkreader-inline-fill',
        cssProp: 'fill',
        dataAttr: 'data-darkreader-inline-fill',
    },
    'stroke': {
        customProp: '--darkreader-inline-stroke',
        cssProp: 'stroke',
        dataAttr: 'data-darkreader-inline-stroke',
    },
    'outline-color': {
        customProp: '--darkreader-inline-outline',
        cssProp: 'outline-color',
        dataAttr: 'data-darkreader-inline-outline',
    },
    'stop-color': {
        customProp: '--darkreader-inline-stopcolor',
        cssProp: 'stop-color',
        dataAttr: 'data-darkreader-inline-stopcolor',
    },
};

const shorthandOverrides: Overrides = {
    'background': {
        customProp: '--darkreader-inline-bg',
        cssProp: 'background',
        dataAttr: 'data-darkreader-inline-bg',
    },
    'border': {
        customProp: '--darkreader-inline-border-short',
        cssProp: 'border',
        dataAttr: 'data-darkreader-inline-border-short',
    },
    'border-bottom': {
        customProp: '--darkreader-inline-border-bottom-short',
        cssProp: 'border-bottom',
        dataAttr: 'data-darkreader-inline-border-bottom-short',
    },
    'border-left': {
        customProp: '--darkreader-inline-border-left-short',
        cssProp: 'border-left',
        dataAttr: 'data-darkreader-inline-border-left-short',
    },
    'border-right': {
        customProp: '--darkreader-inline-border-right-short',
        cssProp: 'border-right',
        dataAttr: 'data-darkreader-inline-border-right-short',
    },
    'border-top': {
        customProp: '--darkreader-inline-border-top-short',
        cssProp: 'border-top',
        dataAttr: 'data-darkreader-inline-border-top-short',
    },
};

const overridesList = Object.values(overrides);
const normalizedPropList: Record<string, string> = {};
overridesList.forEach(({cssProp, customProp}) => normalizedPropList[customProp] = cssProp);

const INLINE_STYLE_ATTRS = ['style', 'fill', 'stop-color', 'stroke', 'bgcolor', 'color', 'background'];
export const INLINE_STYLE_SELECTOR = INLINE_STYLE_ATTRS.map((attr) => `[${attr}]`).join(', ');

export function getInlineOverrideStyle(): string {
    const allOverrides = overridesList.concat(Object.values(shorthandOverrides));
    return allOverrides.map(({dataAttr, customProp, cssProp}) => {
        return [
            `[${dataAttr}] {`,
            `  ${cssProp}: var(${customProp}) !important;`,
            '}',
        ].join('\n');
    }).concat([
        '[data-darkreader-inline-invert] {',
        '    filter: invert(100%) hue-rotate(180deg);',
        '}',
    ]).join('\n');
}

function getInlineStyleElements(root: Node) {
    const results: Element[] = [];
    if (root instanceof Element && root.matches(INLINE_STYLE_SELECTOR)) {
        results.push(root);
    }
    if (root instanceof Element || (isShadowDomSupported && root instanceof ShadowRoot) || root instanceof Document) {
        push(results, root.querySelectorAll(INLINE_STYLE_SELECTOR));
    }
    return results;
}

const treeObservers = new Map<Node, {disconnect(): void}>();
const attrObservers = new Map<Node, MutationObserver>();

export function watchForInlineStyles(
    elementStyleDidChange: (element: HTMLElement) => void,
    shadowRootDiscovered: (root: ShadowRoot) => void,
): void {
    deepWatchForInlineStyles(document, elementStyleDidChange, shadowRootDiscovered);
    iterateShadowHosts(document.documentElement, (host) => {
        deepWatchForInlineStyles(host.shadowRoot!, elementStyleDidChange, shadowRootDiscovered);
    });
}

function deepWatchForInlineStyles(
    root: Document | ShadowRoot,
    elementStyleDidChange: (element: HTMLElement) => void,
    shadowRootDiscovered: (root: ShadowRoot) => void,
): void {
    if (treeObservers.has(root)) {
        treeObservers.get(root)!.disconnect();
        attrObservers.get(root)!.disconnect();
    }

    const discoveredNodes = new WeakSet<Node>();

    function discoverNodes(node: Node) {
        getInlineStyleElements(node).forEach((el: HTMLElement) => {
            if (discoveredNodes.has(el)) {
                return;
            }
            discoveredNodes.add(el);
            elementStyleDidChange(el);
        });
        iterateShadowHosts(node, (n) => {
            if (discoveredNodes.has(node)) {
                return;
            }
            discoveredNodes.add(node);
            shadowRootDiscovered(n.shadowRoot!);
            deepWatchForInlineStyles(n.shadowRoot!, elementStyleDidChange, shadowRootDiscovered);
        });
        variablesStore.matchVariablesAndDependents();
    }

    const treeObserver = createOptimizedTreeObserver(root, {
        onMinorMutations: (_root, {additions}) => {
            additions.forEach((added) => discoverNodes(added));
        },
        onHugeMutations: () => {
            discoverNodes(root);
        },
    });
    treeObservers.set(root, treeObserver);

    let attemptCount = 0;
    let start: number | null = null;
    const ATTEMPTS_INTERVAL = getDuration({seconds: 10});
    const RETRY_TIMEOUT = getDuration({seconds: 2});
    const MAX_ATTEMPTS_COUNT = 50;
    let cache: MutationRecord[] = [];
    let timeoutId: ReturnType<typeof setTimeout> | null = null;

    const handleAttributeMutations = throttle((mutations: MutationRecord[]) => {
        const handledTargets = new Set<Node>();
        mutations.forEach((m) => {
            const target = m.target as HTMLElement;
            if (handledTargets.has(target)) {
                return;
            }
            if (INLINE_STYLE_ATTRS.includes(m.attributeName!)) {
                handledTargets.add(target);
                elementStyleDidChange(target);
            }
        });
        variablesStore.matchVariablesAndDependents();
    });
    const attrObserver = new MutationObserver((mutations) => {
        if (timeoutId) {
            cache.push(...mutations);
            return;
        }
        attemptCount++;
        const now = Date.now();
        if (start == null) {
            start = now;
        } else if (attemptCount >= MAX_ATTEMPTS_COUNT) {
            if (now - start < ATTEMPTS_INTERVAL) {
                timeoutId = setTimeout(() => {
                    start = null;
                    attemptCount = 0;
                    timeoutId = null;
                    const attributeCache = cache;
                    cache = [];
                    handleAttributeMutations(attributeCache);
                }, RETRY_TIMEOUT);
                cache.push(...mutations);
                return;
            }
            start = now;
            attemptCount = 1;
        }
        handleAttributeMutations(mutations);
    });
    attrObserver.observe(root, {
        attributes: true,
        attributeFilter: INLINE_STYLE_ATTRS.concat(overridesList.map(({dataAttr}) => dataAttr)),
        subtree: true,
    });
    attrObservers.set(root, attrObserver);
}

export function stopWatchingForInlineStyles(): void {
    treeObservers.forEach((o) => o.disconnect());
    attrObservers.forEach((o) => o.disconnect());
    treeObservers.clear();
    attrObservers.clear();
}

const inlineStyleCache = new WeakMap<HTMLElement, string>();
const svgInversionCache = new WeakSet<SVGSVGElement>();
const svgAnalysisConditionCache = new WeakMap<SVGSVGElement, boolean>();
const themeProps: Array<keyof Theme> = ['brightness', 'contrast', 'grayscale', 'sepia', 'mode'];

function shouldAnalyzeSVGAsImage(svg: SVGSVGElement) {
    if (svgAnalysisConditionCache.has(svg)) {
        return svgAnalysisConditionCache.get(svg);
    }
    const shouldAnalyze = Boolean(
        svg && (
            svg.getAttribute('class')?.includes('logo') ||
            svg.parentElement?.getAttribute('class')?.includes('logo')
        )
    );
    svgAnalysisConditionCache.set(svg, shouldAnalyze);
    return shouldAnalyze;
}

function getInlineStyleCacheKey(el: HTMLElement, theme: Theme): string {
    return INLINE_STYLE_ATTRS
        .map((attr) => `${attr}="${el.getAttribute(attr)}"`)
        .concat(themeProps.map((prop) => `${prop}="${theme[prop]}"`))
        .join(' ');
}

function shouldIgnoreInlineStyle(element: HTMLElement, selectors: string[]): boolean {
    for (let i = 0, len = selectors.length; i < len; i++) {
        const ingnoredSelector = selectors[i];
        if (element.matches(ingnoredSelector)) {
            return true;
        }
    }
    return false;
}

export function overrideInlineStyle(element: HTMLElement, theme: Theme, ignoreInlineSelectors: string[], ignoreImageSelectors: string[]): void {
    const cacheKey = getInlineStyleCacheKey(element, theme);
    if (cacheKey === inlineStyleCache.get(element)) {
        return;
    }

    const unsetProps = new Set(Object.keys(overrides));

    function setCustomProp(targetCSSProp: string, modifierCSSProp: string, cssVal: string) {
        const mod = getModifiableCSSDeclaration(
            modifierCSSProp,
            cssVal,
            {style: element.style} as CSSStyleRule,
            variablesStore,
            ignoreImageSelectors,
            null,
        );
        if (!mod) {
            return;
        }

        function setStaticValue(value: string) {
            const {customProp, dataAttr} = overrides[targetCSSProp] ?? shorthandOverrides[targetCSSProp];
            element.style.setProperty(customProp, value);
            if (!element.hasAttribute(dataAttr)) {
                element.setAttribute(dataAttr, '');
            }
            unsetProps.delete(targetCSSProp);
        }

        function setVarDeclaration(mod: ReturnType<CSSVariableModifier>) {
            let prevDeclarations: ModifiedVarDeclaration[] = [];

            function setProps(declarations: ModifiedVarDeclaration[]) {
                prevDeclarations.forEach(({property}) => {
                    element.style.removeProperty(property);
                });
                declarations.forEach(({property, value}) => {
                    if (!(value instanceof Promise)) {
                        element.style.setProperty(property, value);
                    }
                });
                prevDeclarations = declarations;
            }

            setProps(mod.declarations);
            mod.onTypeChange.addListener(setProps);
        }

        function setAsyncValue(promise: Promise<string | null>, sourceValue: string) {
            promise.then((value) => {
                if (value && targetCSSProp === 'background' && value.startsWith('var(--darkreader-bg--')) {
                    setStaticValue(value);
                }
                if (value && targetCSSProp === 'background-image') {
                    if ((element === document.documentElement || element === document.body) && value === sourceValue) {
                        // Remove big bright backgrounds from root or body
                        value = 'none';
                    }
                    setStaticValue(value);
                }
                inlineStyleCache.set(element, getInlineStyleCacheKey(element, theme));
            });
        }

        const value = typeof mod.value === 'function' ? mod.value(theme) : mod.value;
        if (typeof value === 'string') {
            setStaticValue(value);
        } else if (value instanceof Promise) {
            setAsyncValue(value, cssVal);
        } else if (typeof value === 'object') {
            setVarDeclaration(value);
        }
    }

    if (ignoreInlineSelectors.length > 0) {
        if (shouldIgnoreInlineStyle(element, ignoreInlineSelectors)) {
            unsetProps.forEach((cssProp) => {
                element.removeAttribute(overrides[cssProp].dataAttr);
            });
            return;
        }
    }

    const isSVGElement = element instanceof SVGElement;
    const svg = isSVGElement ? element.ownerSVGElement ?? (element instanceof SVGSVGElement ? element : null) : null;
    if (isSVGElement && theme.mode === 1 && svg) {
        if (svgInversionCache.has(svg)) {
            return;
        }
        if (shouldAnalyzeSVGAsImage(svg)) {
            svgInversionCache.add(svg);
            const analyzeSVGAsImage = () => {
                let svgString = svg.outerHTML;
                svgString = svgString.replaceAll('<style class="darkreader darkreader--sync" media="screen"></style>', '');
                const dataURL = `data:image/svg+xml;base64,${btoa(svgString)}`;
                getImageDetails(dataURL).then((details) => {
                    if (
                        (details.isDark && details.isTransparent) ||
                        (details.isLarge && details.isLight && !details.isTransparent)
                    ) {
                        svg.setAttribute('data-darkreader-inline-invert', '');
                    } else {
                        svg.removeAttribute('data-darkreader-inline-invert');
                    }
                });
            };
            analyzeSVGAsImage();
            if (!isDOMReady()) {
                addDOMReadyListener(analyzeSVGAsImage);
            }
            return;
        }
    }

    if (element.hasAttribute('bgcolor')) {
        let value = element.getAttribute('bgcolor')!;
        if (value.match(/^[0-9a-f]{3}$/i) || value.match(/^[0-9a-f]{6}$/i)) {
            value = `#${value}`;
        }
        setCustomProp('background-color', 'background-color', value);
    }

    if ((element === document.documentElement || element === document.body) && element.hasAttribute('background')) {
        const url = getAbsoluteURL(location.href, element.getAttribute('background') ?? '');
        const value = `url("${url}")`;
        setCustomProp('background-image', 'background-image', value);
    }

    // We can catch some link elements here, that are from `<link rel="mask-icon" color="#000000">`.
    // It's valid HTML code according to the specs, https://html.spec.whatwg.org/#attr-link-color
    // We don't want to touch such links, as it cause weird browser behavior (silent DOMException).
    if (element.hasAttribute('color') && (element as HTMLLinkElement).rel !== 'mask-icon') {
        let value = element.getAttribute('color')!;
        if (value.match(/^[0-9a-f]{3}$/i) || value.match(/^[0-9a-f]{6}$/i)) {
            value = `#${value}`;
        }
        setCustomProp('color', 'color', value);
    }

    if (isSVGElement) {
        if (element.hasAttribute('fill')) {
            const SMALL_SVG_LIMIT = 32;
            const value = element.getAttribute('fill')!;
            if (value !== 'none') {
                if (!(element instanceof SVGTextElement)) {
                    // getBoundingClientRect forces a layout change. And when it happens and
                    // the DOM is not in the `complete` readystate, it will cause the layout to be drawn
                    // and it will cause a layout of unstyled content which results in white flashes.
                    // Therefore, check if the DOM is at the `complete` readystate.
                    const handleSVGElement = () => {
                        const {width, height} = element.getBoundingClientRect();
                        const isBg = (width > SMALL_SVG_LIMIT || height > SMALL_SVG_LIMIT);
                        setCustomProp('fill', isBg ? 'background-color' : 'color', value);
                    };

                    if (isReadyStateComplete()) {
                        handleSVGElement();
                    } else {
                        addReadyStateCompleteListener(handleSVGElement);
                    }
                } else {
                    setCustomProp('fill', 'color', value);
                }
            }
        }
        if (element.hasAttribute('stop-color')) {
            setCustomProp('stop-color', 'background-color', element.getAttribute('stop-color')!);
        }
    }

    if (element.hasAttribute('stroke')) {
        const value = element.getAttribute('stroke')!;
        setCustomProp('stroke', element instanceof SVGLineElement || element instanceof SVGTextElement ? 'border-color' : 'color', value);
    }

    element.style && iterateCSSDeclarations(element.style, (property, value) => {
        // Temporarily ignore background images due to the possible performance
        // issues and complexity of handling async requests.
        if (property === 'background-image' && value.includes('url')) {
            if (element === document.documentElement || element === document.body) {
                setCustomProp(property, property, value);
            }
            return;
        }
        if (overrides.hasOwnProperty(property) || (property.startsWith('--') && !normalizedPropList[property])) {
            setCustomProp(property, property, value);
        } else if (shorthandOverrides[property] && value.includes('var(')) {
            setCustomProp(property, property, value);
        } else {
            const overriddenProp = normalizedPropList[property];
            if (overriddenProp &&
                (!element.style.getPropertyValue(overriddenProp) && !element.hasAttribute(overriddenProp))) {
                if (overriddenProp === 'background-color' && element.hasAttribute('bgcolor')) {
                    return;
                }
                element.style.setProperty(property, '');
            }
        }
    });

    if (element.style && element instanceof SVGTextElement && element.style.fill) {
        setCustomProp('fill', 'color', element.style.getPropertyValue('fill'));
    }

    if (element.getAttribute('style')?.includes('--')) {
        variablesStore.addInlineStyleForMatching(element.style);
    }

    forEach(unsetProps, (cssProp) => {
        element.removeAttribute(overrides[cssProp].dataAttr);
    });
    inlineStyleCache.set(element, getInlineStyleCacheKey(element, theme));
}

```

### inject\dynamic-theme\injection.ts

```
const hostsBreakingOnStylePosition = [
    'www.diffusioneshop.com',
    'zhale.me',
];

const mode = hostsBreakingOnStylePosition.includes(location.hostname) ? 'away' : 'next';

export function getStyleInjectionMode() {
    return mode;
}

export function injectStyleAway(styleElement: HTMLStyleElement | SVGStyleElement) {
    let container: HTMLElement | null = document.body.querySelector('.darkreader-style-container');
    if (!container) {
        container = document.createElement('div');
        container.classList.add('darkreader');
        container.classList.add('darkreader-style-container');
        container.style.display = 'none';
        document.body.append(container);
    }
    container.append(styleElement);
}

```

### inject\dynamic-theme\index.ts

```
import type {Theme, DynamicThemeFix} from '../../definitions';
import {getCSSFilterValue} from '../../generators/css-filter';
import {createTextStyle} from '../../generators/text-style';
import {forEach, push, toArray} from '../../utils/array';
import {clearColorCache, getSRGBLightness, parseColorWithCache} from '../../utils/color';
import {clamp} from '../../utils/math';
import {isFirefox} from '../../utils/platform';
import {requestAnimationFrameOnce, throttle} from '../../utils/throttle';
import {generateUID} from '../../utils/uid';
import {parsedURLCache} from '../../utils/url';
import {setDocumentVisibilityListener, documentIsVisible, removeDocumentVisibilityListener} from '../../utils/visibility';
import {removeNode, watchForNodePosition, iterateShadowHosts, isDOMReady, removeDOMReadyListener, cleanReadyStateCompleteListeners, addDOMReadyListener, setIsDOMReady} from '../utils/dom';
import {logInfo, logWarn} from '../utils/log';

import type {AdoptedStyleSheetManager, AdoptedStyleSheetFallback} from './adopted-style-manger';
import {createAdoptedStyleSheetOverride, createAdoptedStyleSheetFallback, canHaveAdoptedStyleSheets} from './adopted-style-manger';
import {combineFixes, findRelevantFix} from './fixes';
import {getStyleInjectionMode, injectStyleAway} from './injection';
import {overrideInlineStyle, getInlineOverrideStyle, watchForInlineStyles, stopWatchingForInlineStyles, INLINE_STYLE_SELECTOR} from './inline-style';
import {changeMetaThemeColorWhenAvailable, restoreMetaThemeColor} from './meta-theme-color';
import {modifyBackgroundColor, modifyBorderColor, modifyForegroundColor} from './modify-colors';
import {getModifiedUserAgentStyle, getModifiedFallbackStyle, cleanModificationCache, getSelectionColor} from './modify-css';
import {clearColorPalette, getColorPalette, registerVariablesSheet, releaseVariablesSheet} from './palette';
import type {StyleElement, StyleManager} from './style-manager';
import {manageStyle, getManageableStyles, cleanLoadingLinks} from './style-manager';
import {injectProxy} from './stylesheet-proxy';
import {variablesStore} from './variables';
import {watchForStyleChanges, stopWatchingForStyleChanges} from './watch';

export {createFallbackFactory} from './modify-css';

declare const __TEST__: boolean;
declare const __CHROMIUM_MV3__: boolean;
const INSTANCE_ID = generateUID();
const styleManagers = new Map<StyleElement, StyleManager>();
const adoptedStyleManagers: AdoptedStyleSheetManager[] = [];
const adoptedStyleFallbacks = new Map<CSSStyleSheet, AdoptedStyleSheetFallback>();
const adoptedStyleChangeTokens = new WeakMap<CSSStyleSheet, symbol>();
let theme: Theme | null = null;
let fixes: DynamicThemeFix | null = null;
let isIFrame: boolean | null = null;
let ignoredImageAnalysisSelectors: string[] = [];
let ignoredInlineSelectors: string[] = [];

let staticStyleMap = new WeakMap<ParentNode, Map<string, HTMLStyleElement>>();

function createOrUpdateStyle(className: string, root: ParentNode = document.head || document): HTMLStyleElement {
    let element: HTMLStyleElement | null = root.querySelector(`.${className}`);
    if (!staticStyleMap.has(root)) {
        staticStyleMap.set(root, new Map());
    }
    const classMap = staticStyleMap.get(root)!;
    if (element) {
        classMap.set(className, element);
    } else if (classMap.has(className)) {
        element = classMap.get(className)!;
    } else {
        element = document.createElement('style');
        element.classList.add('darkreader');
        element.classList.add(className);
        element.media = 'screen';
        element.textContent = '';
        classMap.set(className, element);
    }
    return element;
}

/**
 * Note: This function is used only with MV2.
 */
function createOrUpdateScript(className: string, root: ParentNode = document.head || document): HTMLScriptElement {
    let element: HTMLScriptElement | null = root.querySelector(`.${className}`);
    if (!element) {
        element = document.createElement('script');
        element.classList.add('darkreader');
        element.classList.add(className);
    }
    return element;
}

const nodePositionWatchers = new Map<string, ReturnType<typeof watchForNodePosition>>();

function setupNodePositionWatcher(node: Node, alias: string, callback?: () => void) {
    nodePositionWatchers.has(alias) && nodePositionWatchers.get(alias)!.stop();
    nodePositionWatchers.set(alias, watchForNodePosition(node, 'head', callback));
}

function stopStylePositionWatchers() {
    forEach(nodePositionWatchers.values(), (watcher) => watcher.stop());
    nodePositionWatchers.clear();
}

function injectStaticStyle(style: HTMLStyleElement, prevNode: Node | null, watchAlias: string, callback?: () => void) {
    const mode = getStyleInjectionMode();
    if (mode === 'next') {
        document.head.insertBefore(style, prevNode ? prevNode.nextSibling : document.head.firstChild);
        setupNodePositionWatcher(style, watchAlias, callback);
    } else if (mode === 'away') {
        injectStyleAway(style);
    }
}

function createStaticStyleOverrides() {
    const fallbackStyle = createOrUpdateStyle('darkreader--fallback', document);
    fallbackStyle.textContent = getModifiedFallbackStyle(theme!, {strict: true});
    injectStaticStyle(fallbackStyle, null, 'fallback');

    const userAgentStyle = createOrUpdateStyle('darkreader--user-agent');
    userAgentStyle.textContent = getModifiedUserAgentStyle(theme!, isIFrame!, theme!.styleSystemControls);
    injectStaticStyle(userAgentStyle, fallbackStyle, 'user-agent');

    const textStyle = createOrUpdateStyle('darkreader--text');
    if (theme!.useFont || theme!.textStroke > 0) {
        textStyle.textContent = createTextStyle(theme!);
    } else {
        textStyle.textContent = '';
    }
    injectStaticStyle(textStyle, userAgentStyle, 'text');

    const invertStyle = createOrUpdateStyle('darkreader--invert');
    if (fixes && Array.isArray(fixes.invert) && fixes.invert.length > 0) {
        invertStyle.textContent = [
            `${fixes.invert.join(', ')} {`,
            `    filter: ${getCSSFilterValue({
                ...theme!,
                contrast: theme!.mode === 0 ? theme!.contrast : clamp(theme!.contrast - 10, 0, 100),
            })} !important;`,
            '}',
        ].join('\n');
    } else {
        invertStyle.textContent = '';
    }
    injectStaticStyle(invertStyle, textStyle, 'invert');

    const inlineStyle = createOrUpdateStyle('darkreader--inline');
    inlineStyle.textContent = getInlineOverrideStyle();
    injectStaticStyle(inlineStyle, invertStyle, 'inline');

    const variableStyle = createOrUpdateStyle('darkreader--variables');
    const selectionColors = theme?.selectionColor ? getSelectionColor(theme) : null;
    const neutralBackgroundColor = modifyBackgroundColor(parseColorWithCache('#ffffff')!, theme!);
    const neutralTextColor = modifyForegroundColor(parseColorWithCache('#000000')!, theme!);
    variableStyle.textContent = [
        `:root {`,
        `   --darkreader-neutral-background: ${neutralBackgroundColor};`,
        `   --darkreader-neutral-text: ${neutralTextColor};`,
        `   --darkreader-selection-background: ${selectionColors?.backgroundColorSelection ?? 'initial'};`,
        `   --darkreader-selection-text: ${selectionColors?.foregroundColorSelection ?? 'initial'};`,
        `}`,
    ].join('\n');
    injectStaticStyle(variableStyle, inlineStyle, 'variables', () => registerVariablesSheet(variableStyle.sheet!));
    registerVariablesSheet(variableStyle.sheet!);

    const rootVarsStyle = createOrUpdateStyle('darkreader--root-vars');
    injectStaticStyle(rootVarsStyle, variableStyle, 'root-vars');

    const enableStyleSheetsProxy = !(fixes && fixes.disableStyleSheetsProxy);
    const enableCustomElementRegistryProxy = !(fixes && fixes.disableCustomElementRegistryProxy);
    document.dispatchEvent(new CustomEvent('__darkreader__cleanUp'));
    if (__CHROMIUM_MV3__) {
        // Notify the dedicated injector of the data.
        document.dispatchEvent(new CustomEvent('__darkreader__stylesheetProxy__arg', {detail: {enableStyleSheetsProxy, enableCustomElementRegistryProxy}}));
    } else {
        const proxyScript = createOrUpdateScript('darkreader--proxy');
        proxyScript.append(`(${injectProxy})(${enableStyleSheetsProxy}, ${enableCustomElementRegistryProxy})`);
        document.head.insertBefore(proxyScript, rootVarsStyle.nextSibling);
        proxyScript.remove();
    }

    const overrideStyle = createOrUpdateStyle('darkreader--override');
    overrideStyle.textContent = fixes && fixes.css ? replaceCSSTemplates(fixes.css) : '';
    injectStaticStyle(overrideStyle, document.head.lastChild, 'override');
}

const shadowRootsWithOverrides = new Set<ShadowRoot>();

function createShadowStaticStyleOverridesInner(root: ShadowRoot) {
    const inlineStyle = createOrUpdateStyle('darkreader--inline', root);
    inlineStyle.textContent = getInlineOverrideStyle();
    root.insertBefore(inlineStyle, root.firstChild);
    const overrideStyle = createOrUpdateStyle('darkreader--override', root);
    overrideStyle.textContent = fixes && fixes.css ? replaceCSSTemplates(fixes.css) : '';
    root.insertBefore(overrideStyle, inlineStyle.nextSibling);

    const invertStyle = createOrUpdateStyle('darkreader--invert', root);
    if (fixes && Array.isArray(fixes.invert) && fixes.invert.length > 0) {
        invertStyle.textContent = [
            `${fixes.invert.join(', ')} {`,
            `    filter: ${getCSSFilterValue({
                ...theme!,
                contrast: theme!.mode === 0 ? theme!.contrast : clamp(theme!.contrast - 10, 0, 100),
            })} !important;`,
            '}',
        ].join('\n');
    } else {
        invertStyle.textContent = '';
    }
    root.insertBefore(invertStyle, overrideStyle.nextSibling);
    shadowRootsWithOverrides.add(root);
}

function delayedCreateShadowStaticStyleOverrides(root: ShadowRoot): void {
    const observer = new MutationObserver((mutations, observer) => {
        // Disconnect observer immediately before making any other changes
        observer.disconnect();

        // Do not make any changes unless Dark Reader's fixes have been removed
        for (const {type, removedNodes} of mutations) {
            if (type === 'childList') {
                for (const {nodeName, className} of removedNodes as any) {
                    if (nodeName === 'STYLE' && ['darkreader darkreader--inline', 'darkreader darkreader--override', 'darkreader darkreader--invert'].includes(className)) {
                        createShadowStaticStyleOverridesInner(root);
                        return;
                    }
                }
            }
        }
    });
    observer.observe(root, {childList: true});
}

function createShadowStaticStyleOverrides(root: ShadowRoot) {
    // The shadow DOM may not be populated yet and the custom element implementation
    // may assume that unpopulated shadow root is empty and inadvertently remove
    // Dark Reader's overrides
    const delayed = root.firstChild === null;
    createShadowStaticStyleOverridesInner(root);
    if (delayed) {
        delayedCreateShadowStaticStyleOverrides(root);
    }
}

function replaceCSSTemplates($cssText: string) {
    return $cssText.replace(/\${(.+?)}/g, (_, $color) => {
        const color = parseColorWithCache($color);
        if (color) {
            const lightness = getSRGBLightness(color.r, color.g, color.b);
            if (lightness > 0.5) {
                return modifyBackgroundColor(color, theme!);
            }
            return modifyForegroundColor(color, theme!);
        }
        logWarn("Couldn't parse CSSTemplate's color.");
        return $color;
    });
}

function cleanFallbackStyle() {
    const fallback = (
        staticStyleMap.get(document.head)?.get('darkreader--fallback') ||
        staticStyleMap.get(document)?.get('darkreader--fallback') ||
        document.querySelector('.darkreader--fallback')
    );
    if (fallback) {
        fallback.textContent = '';
    }
}

function createDynamicStyleOverrides() {
    cancelRendering();

    const allStyles = getManageableStyles(document);

    const newManagers = allStyles
        .filter((style) => !styleManagers.has(style))
        .map((style) => createManager(style));
    newManagers
        .map((manager) => manager.details({secondRound: false}))
        .filter((detail) => detail && detail.rules.length > 0)
        .forEach((detail) => {
            variablesStore.addRulesForMatching(detail!.rules);
        });

    variablesStore.matchVariablesAndDependents();
    variablesStore.setOnRootVariableChange(() => {
        const rootVarsStyle = createOrUpdateStyle('darkreader--root-vars');
        variablesStore.putRootVars(rootVarsStyle, theme!);
    });
    const rootVarsStyle = createOrUpdateStyle('darkreader--root-vars');
    variablesStore.putRootVars(rootVarsStyle, theme!);

    styleManagers.forEach((manager) => manager.render(theme!, ignoredImageAnalysisSelectors!));
    if (loadingStyles.size === 0) {
        cleanFallbackStyle();
    }
    newManagers.forEach((manager) => manager.watch());

    const inlineStyleElements = toArray(document.querySelectorAll(INLINE_STYLE_SELECTOR));
    iterateShadowHosts(document.documentElement, (host) => {
        createShadowStaticStyleOverrides(host.shadowRoot!);
        const elements = host.shadowRoot!.querySelectorAll(INLINE_STYLE_SELECTOR);
        if (elements.length > 0) {
            push(inlineStyleElements, elements);
        }
    });
    inlineStyleElements.forEach((el: HTMLElement) => overrideInlineStyle(el, theme!, ignoredInlineSelectors, ignoredImageAnalysisSelectors));
    handleAdoptedStyleSheets(document);
    variablesStore.matchVariablesAndDependents();

    if (isFirefox) {
        type NodeSheet = {
            sheetId: number;
            sheet: CSSStyleSheet;
        };

        const onAdoptedCssChange = (e: CustomEvent) => {
            const {sheets} = e.detail;
            if (!Array.isArray(sheets) || sheets.length === 0) {
                return;
            }
            sheets.forEach(({sheet}: NodeSheet) => {
                const {cssRules} = sheet;
                variablesStore.addRulesForMatching(cssRules);
            });
            variablesStore.matchVariablesAndDependents();
            const response: Array<{sheetId: number; commands: any}> = [];
            sheets.forEach(({sheetId, sheet}: NodeSheet) => {
                const fallback = getAdoptedStyleSheetFallback(sheet);
                const cssRules = sheet.cssRules;
                fallback.render({
                    theme: theme!,
                    ignoreImageAnalysis: ignoredImageAnalysisSelectors!,
                    cssRules,
                });
                const commands = fallback.commands();
                response.push({sheetId, commands});
            });

            requestAnimationFrameOnce(getAdoptedStyleChangeToken(sheets[0].sheet), () => {
                document.dispatchEvent(new CustomEvent('__darkreader__adoptedStyleSheetCommands', {detail: JSON.stringify(response)}));
            });
        };

        document.addEventListener('__darkreader__adoptedStyleSheetsChange', onAdoptedCssChange);
        cleaners.push(() => document.removeEventListener('__darkreader__adoptedStyleSheetsChange', onAdoptedCssChange));

        document.dispatchEvent(new CustomEvent('__darkreader__startAdoptedStyleSheetsWatcher'));
    }
}

let loadingStylesCounter = 0;
const loadingStyles = new Set<number>();

function createManager(element: StyleElement) {
    const loadingStyleId = ++loadingStylesCounter;
    logInfo(`New manager for element, with loadingStyleID ${loadingStyleId}`, element);
    function loadingStart() {
        if (!isDOMReady() || !documentIsVisible()) {
            loadingStyles.add(loadingStyleId);
            logInfo(`Current amount of styles loading: ${loadingStyles.size}`);

            const fallbackStyle = createOrUpdateStyle('darkreader--fallback');
            if (!fallbackStyle.textContent) {
                fallbackStyle.textContent = getModifiedFallbackStyle(theme!, {strict: false});
            }
        }
    }

    function loadingEnd() {
        loadingStyles.delete(loadingStyleId);
        logInfo(`Removed loadingStyle ${loadingStyleId}, now awaiting: ${loadingStyles.size}`);
        logInfo(`To-do to be loaded`, loadingStyles);
        if (loadingStyles.size === 0 && isDOMReady()) {
            cleanFallbackStyle();
        }
    }

    function update() {
        const details = manager.details({secondRound: true});
        if (!details) {
            return;
        }
        variablesStore.addRulesForMatching(details.rules);
        variablesStore.matchVariablesAndDependents();
        manager.render(theme!, ignoredImageAnalysisSelectors);
        if (__TEST__) {
            document.dispatchEvent(new CustomEvent('__darkreader__test__dynamicUpdateComplete'));
        }
    }

    const manager = manageStyle(element, {update, loadingStart, loadingEnd});
    styleManagers.set(element, manager);

    return manager;
}

function removeManager(element: StyleElement) {
    const manager = styleManagers.get(element);
    if (manager) {
        manager.destroy();
        styleManagers.delete(element);
    }
}

const throttledRenderAllStyles = throttle((callback?: () => void) => {
    styleManagers.forEach((manager) => manager.render(theme!, ignoredImageAnalysisSelectors));
    adoptedStyleManagers.forEach((manager) => manager.render(theme!, ignoredImageAnalysisSelectors));
    callback && callback();
});

const cancelRendering = function () {
    throttledRenderAllStyles.cancel();
};

function onDOMReady() {
    if (loadingStyles.size === 0) {
        cleanFallbackStyle();
        return;
    }
    logWarn(`DOM is ready, but still have styles being loaded.`, loadingStyles);
}

function runDynamicStyle() {
    createDynamicStyleOverrides();
    watchForUpdates();
}

function createThemeAndWatchForUpdates() {
    createStaticStyleOverrides();

    if (!documentIsVisible() && !theme!.immediateModify) {
        setDocumentVisibilityListener(runDynamicStyle);
    } else {
        runDynamicStyle();
    }

    changeMetaThemeColorWhenAvailable(theme!);
}

function handleAdoptedStyleSheets(node: ShadowRoot | Document) {
    if (isFirefox) {
        return;
    }

    if (canHaveAdoptedStyleSheets(node)) {
        node.adoptedStyleSheets.forEach((s) => {
            variablesStore.addRulesForMatching(s.cssRules);
        });
        const newManger = createAdoptedStyleSheetOverride(node);
        adoptedStyleManagers.push(newManger);
        newManger.render(theme!, ignoredImageAnalysisSelectors);
        newManger.watch((sheets) => {
            sheets.forEach((s) => {
                variablesStore.addRulesForMatching(s.cssRules);
            });
            variablesStore.matchVariablesAndDependents();
            newManger.render(theme!, ignoredImageAnalysisSelectors);
        });
    }
}

function getAdoptedStyleChangeToken(sheet: CSSStyleSheet) {
    if (adoptedStyleChangeTokens.has(sheet)) {
        return adoptedStyleChangeTokens.get(sheet)!;
    }
    const token = Symbol();
    adoptedStyleChangeTokens.set(sheet, token);
    return token;
}

function getAdoptedStyleSheetFallback(sheet: CSSStyleSheet) {
    let fallback = adoptedStyleFallbacks.get(sheet);
    if (!fallback) {
        fallback = createAdoptedStyleSheetFallback();
        adoptedStyleFallbacks.set(sheet, fallback);
    }
    return fallback;
}

function watchForUpdates() {
    const managedStyles = Array.from(styleManagers.keys());
    watchForStyleChanges(managedStyles, ({created, updated, removed, moved}) => {
        const stylesToRemove = removed;
        const stylesToManage = created.concat(updated).concat(moved)
            .filter((style) => !styleManagers.has(style));
        const stylesToRestore = moved
            .filter((style) => styleManagers.has(style));
        logInfo(`Styles to be removed:`, stylesToRemove);
        stylesToRemove.forEach((style) => removeManager(style));
        const newManagers = stylesToManage
            .map((style) => createManager(style));
        newManagers
            .map((manager) => manager.details({secondRound: false}))
            .filter((detail) => detail && detail.rules.length > 0)
            .forEach((detail) => {
                variablesStore.addRulesForMatching(detail!.rules);
            });
        variablesStore.matchVariablesAndDependents();
        newManagers.forEach((manager) => manager.render(theme!, ignoredImageAnalysisSelectors));
        newManagers.forEach((manager) => manager.watch());
        stylesToRestore.forEach((style) => styleManagers.get(style)!.restore());
    }, (shadowRoot) => {
        createShadowStaticStyleOverrides(shadowRoot);
        handleAdoptedStyleSheets(shadowRoot);
    });

    watchForInlineStyles((element) => {
        overrideInlineStyle(element, theme!, ignoredInlineSelectors, ignoredImageAnalysisSelectors);
        if (element === document.documentElement) {
            const styleAttr = element.getAttribute('style') || '';
            if (styleAttr.includes('--')) {
                variablesStore.matchVariablesAndDependents();
                const rootVarsStyle = createOrUpdateStyle('darkreader--root-vars');
                variablesStore.putRootVars(rootVarsStyle, theme!);
            }
        }
    }, (root) => {
        createShadowStaticStyleOverrides(root);
        const inlineStyleElements = root.querySelectorAll(INLINE_STYLE_SELECTOR);
        if (inlineStyleElements.length > 0) {
            forEach(inlineStyleElements, (el: HTMLElement) => overrideInlineStyle(el, theme!, ignoredInlineSelectors, ignoredImageAnalysisSelectors));
        }
    });

    addDOMReadyListener(onDOMReady);
}

function stopWatchingForUpdates() {
    styleManagers.forEach((manager) => manager.pause());
    stopStylePositionWatchers();
    stopWatchingForStyleChanges();
    stopWatchingForInlineStyles();
    removeDOMReadyListener(onDOMReady);
    cleanReadyStateCompleteListeners();
}

let metaObserver: MutationObserver;
let headObserver: MutationObserver | null = null;

function addMetaListener() {
    metaObserver = new MutationObserver(() => {
        if (document.querySelector('meta[name="darkreader-lock"]')) {
            metaObserver.disconnect();
            removeDynamicTheme();
        }
    });
    metaObserver.observe(document.head, {childList: true, subtree: true});
}

function createDarkReaderInstanceMarker() {
    const metaElement: HTMLMetaElement = document.createElement('meta');
    metaElement.name = 'darkreader';
    metaElement.content = INSTANCE_ID;
    document.head.appendChild(metaElement);
}

function isDRLocked() {
    return document.querySelector('meta[name="darkreader-lock"]') != null;
}

function isAnotherDarkReaderInstanceActive() {
    const meta: HTMLMetaElement | null = document.querySelector('meta[name="darkreader"]');
    if (meta) {
        if (meta.content !== INSTANCE_ID) {
            return true;
        }
        return false;
    }
    createDarkReaderInstanceMarker();
    addMetaListener();
    return false;
}

// Give them a second chance,
// but never a third
let interceptorAttempts = 2;

function interceptOldScript({success, failure}: {success: () => void; failure: () => void}) {
    if (--interceptorAttempts <= 0) {
        failure();
        return;
    }

    const oldMeta = document.head.querySelector('meta[name="darkreader"]') as HTMLMetaElement | null;
    if (!oldMeta || oldMeta.content === INSTANCE_ID) {
        return;
    }

    const lock = document.createElement('meta');
    lock.name = 'darkreader-lock';
    document.head.append(lock);
    queueMicrotask(() => {
        lock.remove();
        success();
    });
}

function disableConflictingPlugins() {
    if (document.documentElement.hasAttribute('data-wp-dark-mode-preset')) {
        const disableWPDarkMode = () => {
            document.dispatchEvent(new CustomEvent('__darkreader__disableConflictingPlugins'));
            document.documentElement.classList.remove('wp-dark-mode-active');
            document.documentElement.removeAttribute('data-wp-dark-mode-active');
        };
        disableWPDarkMode();
        const observer = new MutationObserver(() => {
            if (
                document.documentElement.classList.contains('wp-dark-mode-active') ||
                document.documentElement.hasAttribute('data-wp-dark-mode-active')
            ) {
                disableWPDarkMode();
            }
        });
        observer.observe(document.documentElement, {
            attributes: true,
            attributeFilter: ['class', 'data-wp-dark-mode-active'],
        });
    }
}

function selectRelevantFix(documentURL: string, fixes: DynamicThemeFix[]): DynamicThemeFix | null {
    if (!fixes) {
        return null;
    }
    if (fixes.length === 0 || fixes[0].url[0] !== '*') {
        logWarn('selectRelevantFix() failed to construct a single fix', documentURL, fixes);
        return null;
    }

    const relevantFixIndex = findRelevantFix(documentURL, fixes);
    return relevantFixIndex ? combineFixes([fixes[0], fixes[relevantFixIndex]]) : fixes[0];
}

/**
 * TODO: expose this function to API builds via src/api function enable()
 */
export function createOrUpdateDynamicTheme(theme: Theme, dynamicThemeFixes: DynamicThemeFix[], iframe: boolean): void {
    const dynamicThemeFix = selectRelevantFix(document.location.href, dynamicThemeFixes);

    // Most websites will have only the generic fix applied ('*'), some will have generic fix and one site-specific fix (two in total),
    // and very few will have multiple site-specific fixes
    // TODO: add a navigation listener here for this case

    createOrUpdateDynamicThemeInternal(theme, dynamicThemeFix, iframe);
}

let prevTheme: Theme | null = null;
let prevFixes: DynamicThemeFix | null = null;

/**
 * Note: This function should be directly used only in API builds, it is exported by this fle
 * only for use in src/api/enable() for backwards compatibility,
 * extension should use only createOrUpdateDynamicTheme()
 */
export function createOrUpdateDynamicThemeInternal(themeConfig: Theme, dynamicThemeFixes: DynamicThemeFix | null, iframe: boolean): void {
    theme = themeConfig;
    fixes = dynamicThemeFixes;

    const colorAffectingKeys: Array<keyof Theme> = [
        'brightness',
        'contrast',
        'darkSchemeBackgroundColor',
        'darkSchemeTextColor',
        'grayscale',
        'lightSchemeBackgroundColor',
        'lightSchemeTextColor',
        'sepia',
    ];

    if (prevTheme && prevFixes) {
        const themeKeys = new Set<keyof Theme>([
            ...(Object.keys(theme) as Array<keyof Theme>),
            ...(Object.keys(prevTheme) as Array<keyof Theme>),
        ]);

        let onlyColorsChanged = true;
        for (const key of themeKeys) {
            if (theme[key] !== prevTheme[key] && !colorAffectingKeys.includes(key)) {
                onlyColorsChanged = false;
                break;
            }
        }

        if (onlyColorsChanged && JSON.stringify(fixes) !== JSON.stringify(prevFixes)) {
            onlyColorsChanged = false;
        }

        if (onlyColorsChanged) {
            const palette = getColorPalette();
            clearColorPalette();
            palette.background.forEach((color) => modifyBackgroundColor(color, theme!));
            palette.text.forEach((color) => modifyForegroundColor(color, theme!));
            palette.border.forEach((color) => modifyBorderColor(color, theme!));
            return;
        }

        clearColorPalette();
    }

    if (fixes) {
        ignoredImageAnalysisSelectors = Array.isArray(fixes.ignoreImageAnalysis) ? fixes.ignoreImageAnalysis : [];
        ignoredInlineSelectors = Array.isArray(fixes.ignoreInlineStyle) ? fixes.ignoreInlineStyle : [];
    } else {
        ignoredImageAnalysisSelectors = [];
        ignoredInlineSelectors = [];
    }

    if (theme.immediateModify) {
        setIsDOMReady(() => {
            return true;
        });
    }

    isIFrame = iframe;

    const ready = () => {
        const success = () => {
            disableConflictingPlugins();
            document.documentElement.setAttribute('data-darkreader-mode', 'dynamic');
            document.documentElement.setAttribute('data-darkreader-scheme', theme!.mode ? 'dark' : 'dimmed');
            createThemeAndWatchForUpdates();
        };

        const failure = () => {
            removeDynamicTheme();
        };

        if (isDRLocked()) {
            removeNode(document.querySelector('.darkreader--fallback'));
        } else if (isAnotherDarkReaderInstanceActive()) {
            interceptOldScript({
                success,
                failure,
            });
        } else {
            success();
        }
    };

    if (document.head) {
        ready();
    } else {
        if (!isFirefox) {
            const fallbackStyle = createOrUpdateStyle('darkreader--fallback');
            document.documentElement.appendChild(fallbackStyle);
            fallbackStyle.textContent = getModifiedFallbackStyle(theme, {strict: true});
        }

        headObserver?.disconnect();
        headObserver = new MutationObserver(() => {
            if (document.head) {
                headObserver?.disconnect();
                ready();
            }
        });
        cleaners.push(() => {
            headObserver?.disconnect();
            headObserver = null;
        });
        headObserver.observe(document, {childList: true, subtree: true});
    }

    prevTheme = theme;
    prevFixes = fixes;
}

function removeProxy() {
    document.dispatchEvent(new CustomEvent('__darkreader__cleanUp'));
    removeNode(document.head.querySelector('.darkreader--proxy'));
}

const cleaners: Array<() => void> = [];

export function removeDynamicTheme(): void {
    document.documentElement.removeAttribute(`data-darkreader-mode`);
    document.documentElement.removeAttribute(`data-darkreader-scheme`);
    cleanDynamicThemeCache();
    removeNode(document.querySelector('.darkreader--fallback'));
    if (document.head) {
        const selectors = [
            '.darkreader--user-agent',
            '.darkreader--text',
            '.darkreader--invert',
            '.darkreader--inline',
            '.darkreader--override',
            '.darkreader--variables',
            '.darkreader--root-vars',
            'meta[name="darkreader"]',
        ];

        restoreMetaThemeColor();
        selectors.forEach((selector) => removeNode(document.head.querySelector(selector)));
        staticStyleMap = new WeakMap();
        removeProxy();
    }
    shadowRootsWithOverrides.forEach((root) => {
        removeNode(root.querySelector('.darkreader--inline'));
        removeNode(root.querySelector('.darkreader--override'));
    });
    shadowRootsWithOverrides.clear();
    forEach(styleManagers.keys(), (el) => removeManager(el));
    loadingStyles.clear();
    cleanLoadingLinks();
    forEach(document.querySelectorAll('.darkreader'), removeNode);

    adoptedStyleManagers.forEach((manager) => manager.destroy());
    adoptedStyleManagers.splice(0);
    adoptedStyleFallbacks.forEach((fallback) => fallback.destroy());
    adoptedStyleFallbacks.clear();

    metaObserver && metaObserver.disconnect();

    cleaners.forEach((clean) => clean());
    cleaners.splice(0);
}

export function cleanDynamicThemeCache(): void {
    variablesStore.clear();
    parsedURLCache.clear();
    removeDocumentVisibilityListener();
    cancelRendering();
    stopWatchingForUpdates();
    cleanModificationCache();
    clearColorCache();
    releaseVariablesSheet();
    prevTheme = null;
    prevFixes = null;
}

```

### inject\dynamic-theme\image.ts

```
import type {Theme} from '../../definitions';
import {getSVGFilterMatrixValue} from '../../generators/svg-filter';
import AsyncQueue from '../../utils/async-queue';
import {getSRGBLightness} from '../../utils/color';
import {loadAsBlob, loadAsDataURL} from '../../utils/network';
import {getHashCode} from '../../utils/text';
import {addReadyStateCompleteListener, isReadyStateComplete} from '../utils/dom';
import {logWarn} from '../utils/log';

import {bgFetch} from './network';

export interface ImageDetails {
    src: string;
    dataURL: string;
    width: number;
    height: number;
    isDark: boolean;
    isLight: boolean;
    isTransparent: boolean;
    isLarge: boolean;
}

const imageManager = new AsyncQueue();

export async function getImageDetails(url: string): Promise<ImageDetails> {
    // eslint-disable-next-line no-async-promise-executor
    return new Promise<ImageDetails>(async (resolve, reject) => {
        try {
            const dataURL = url.startsWith('data:') ? url : await getDataURL(url);
            const blob = tryConvertDataURLToBlobSync(dataURL) ?? await loadAsBlob(url);
            let image: ImageBitmap | HTMLImageElement;
            if (dataURL.startsWith('data:image/svg+xml')) {
                image = await loadImage(dataURL);
            } else {
                image = await tryCreateImageBitmap(blob) ?? await loadImage(dataURL);
            }
            imageManager.addTask(() => {
                const analysis = analyzeImage(image);
                resolve({
                    src: url,
                    dataURL: analysis.isLarge ? '' : dataURL,
                    width: image.width,
                    height: image.height,
                    ...analysis,
                });
            });
        } catch (error) {
            reject(error);
        }
    });
}

async function getDataURL(url: string): Promise<string> {
    const parsedURL = new URL(url);
    if (parsedURL.origin === location.origin) {
        return await loadAsDataURL(url);
    }
    return await bgFetch({url, responseType: 'data-url'});
}

async function tryCreateImageBitmap(blob: Blob) {
    try {
        return await createImageBitmap(blob);
    } catch (err) {
        logWarn(`Unable to create image bitmap for type ${blob.type}: ${String(err)}`);
        return null;
    }
}

const INCOMPLETE_DOC_LOADING_IMAGE_LIMIT = 256;
let loadingImagesCount = 0;

async function loadImage(url: string): Promise<HTMLImageElement> {
    return new Promise<HTMLImageElement>((resolve, reject) => {
        const image = new Image();
        image.onload = () => resolve(image);
        image.onerror = () => reject(`Unable to load image ${url}`);
        if (++loadingImagesCount <= INCOMPLETE_DOC_LOADING_IMAGE_LIMIT || isReadyStateComplete()) {
            image.src = url;
        } else {
            addReadyStateCompleteListener(() => image.src = url);
        }
    });
}

const MAX_ANALYSIS_PIXELS_COUNT = 32 * 32;
let canvas: HTMLCanvasElement | OffscreenCanvas | null;
let context: CanvasRenderingContext2D | OffscreenCanvasRenderingContext2D | null;

function createCanvas() {
    const maxWidth = MAX_ANALYSIS_PIXELS_COUNT;
    const maxHeight = MAX_ANALYSIS_PIXELS_COUNT;
    canvas = document.createElement('canvas');
    canvas.width = maxWidth;
    canvas.height = maxHeight;
    context = canvas.getContext('2d', {willReadFrequently: true})!;
    context.imageSmoothingEnabled = false;
}

function removeCanvas() {
    canvas = null;
    context = null;
}

const LARGE_IMAGE_PIXELS_COUNT = 512 * 512;

function analyzeImage(image: ImageBitmap | HTMLImageElement) {
    if (!canvas) {
        createCanvas();
    }

    let sw: number;
    let sh: number;
    if (image instanceof HTMLImageElement) {
        sw = image.naturalWidth;
        sh = image.naturalHeight;
    } else {
        sw = image.width;
        sh = image.height;
    }

    if (sw === 0 || sh === 0) {
        logWarn('Image is empty');
        return {
            isDark: false,
            isLight: false,
            isTransparent: false,
            isLarge: false,
        };
    }

    const isLarge = sw * sh > LARGE_IMAGE_PIXELS_COUNT;

    const sourcePixelsCount = sw * sh;
    const k = Math.min(1, Math.sqrt(MAX_ANALYSIS_PIXELS_COUNT / sourcePixelsCount));
    const width = Math.ceil(sw * k);
    const height = Math.ceil(sh * k);
    context!.clearRect(0, 0, width, height);

    context!.drawImage(image, 0, 0, sw, sh, 0, 0, width, height);
    const imageData = context!.getImageData(0, 0, width, height);
    const d = imageData.data;

    const TRANSPARENT_ALPHA_THRESHOLD = 0.05;
    const DARK_LIGHTNESS_THRESHOLD = 0.4;
    const LIGHT_LIGHTNESS_THRESHOLD = 0.7;

    let transparentPixelsCount = 0;
    let darkPixelsCount = 0;
    let lightPixelsCount = 0;

    let i: number, x: number, y: number;
    let r: number, g: number, b: number, a: number;
    let l: number;
    for (y = 0; y < height; y++) {
        for (x = 0; x < width; x++) {
            i = 4 * (y * width + x);
            r = d[i + 0];
            g = d[i + 1];
            b = d[i + 2];
            a = d[i + 3];

            if (a / 255 < TRANSPARENT_ALPHA_THRESHOLD) {
                transparentPixelsCount++;
            } else {
                l = getSRGBLightness(r, g, b);
                if (l < DARK_LIGHTNESS_THRESHOLD) {
                    darkPixelsCount++;
                }
                if (l > LIGHT_LIGHTNESS_THRESHOLD) {
                    lightPixelsCount++;
                }
            }
        }
    }

    const totalPixelsCount = width * height;
    const opaquePixelsCount = totalPixelsCount - transparentPixelsCount;

    const DARK_IMAGE_THRESHOLD = 0.7;
    const LIGHT_IMAGE_THRESHOLD = 0.7;
    const TRANSPARENT_IMAGE_THRESHOLD = 0.1;

    return {
        isDark: ((darkPixelsCount / opaquePixelsCount) >= DARK_IMAGE_THRESHOLD),
        isLight: ((lightPixelsCount / opaquePixelsCount) >= LIGHT_IMAGE_THRESHOLD),
        isTransparent: ((transparentPixelsCount / totalPixelsCount) >= TRANSPARENT_IMAGE_THRESHOLD),
        isLarge,
    };
}

let isBlobURLSupported: boolean | null = null;

let canUseProxy = false;
let blobURLCheckRequested = false;
const blobURLCheckAwaiters: Array<() => void> = [];
document.addEventListener('__darkreader__inlineScriptsAllowed', () => canUseProxy = true, {once: true});

export async function requestBlobURLCheck(): Promise<void> {
    if (!canUseProxy) {
        return;
    }
    if (blobURLCheckRequested) {
        return await new Promise<void>((resolve) => blobURLCheckAwaiters.push(resolve));
    }
    blobURLCheckRequested = true;

    await new Promise<void>((resolve) => {
        document.addEventListener('__darkreader__blobURLCheckResponse', (e: CustomEvent) => {
            isBlobURLSupported = e.detail.blobURLAllowed;
            resolve();
            blobURLCheckAwaiters.forEach((r) => r());
            blobURLCheckAwaiters.splice(0);
        }, {once: true});
        document.dispatchEvent(new CustomEvent('__darkreader__blobURLCheckRequest'));
    });
}

export function isBlobURLCheckResultReady(): boolean {
    return isBlobURLSupported != null || !canUseProxy;
}

function onCSPError(err: SecurityPolicyViolationEvent) {
    if (err.blockedURI === 'blob') {
        isBlobURLSupported = false;
        document.removeEventListener('securitypolicyviolation', onCSPError);
    }
}

document.addEventListener('securitypolicyviolation', onCSPError);

const objectURLs = new Set<string>();

export function getFilteredImageURL({dataURL, width, height}: ImageDetails, theme: Theme): string {
    if (dataURL.startsWith('data:image/svg+xml')) {
        dataURL = escapeXML(dataURL);
    }
    const matrix = getSVGFilterMatrixValue(theme);
    const svg = [
        `<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="${width}" height="${height}">`,
        '<defs>',
        '<filter id="darkreader-image-filter">',
        `<feColorMatrix type="matrix" values="${matrix}" />`,
        '</filter>',
        '</defs>',
        `<image width="${width}" height="${height}" filter="url(#darkreader-image-filter)" xlink:href="${dataURL}" />`,
        '</svg>',
    ].join('');

    if (!isBlobURLSupported) {
        return `data:image/svg+xml;base64,${btoa(svg)}`;
    }

    const bytes = new Uint8Array(svg.length);
    for (let i = 0; i < svg.length; i++) {
        bytes[i] = svg.charCodeAt(i);
    }
    const blob = new Blob([bytes], {type: 'image/svg+xml'});
    const objectURL = URL.createObjectURL(blob);
    objectURLs.add(objectURL);
    return objectURL;
}

const xmlEscapeChars: Record<string, string> = {
    '<': '&lt;',
    '>': '&gt;',
    '&': '&amp;',
    '\'': '&apos;',
    '"': '&quot;',
};

function escapeXML(str: string): string {
    return str.replace(/[<>&'"]/g, (c: string) => xmlEscapeChars[c] ?? c);
}

const dataURLBlobURLs = new Map<number, string>();

function tryConvertDataURLToBlobSync(dataURL: string): Blob | null {
    const colonIndex = dataURL.indexOf(':');
    const semicolonIndex = dataURL.indexOf(';', colonIndex + 1);
    const commaIndex = dataURL.indexOf(',', semicolonIndex + 1);
    const encoding = dataURL.substring(semicolonIndex + 1, commaIndex).toLocaleLowerCase();
    const mediaType = dataURL.substring(colonIndex + 1, semicolonIndex);

    // It should be possible to easily convert UTF-8,
    // though it is unclear if decodeURIComponent will be necessary
    // and if it will be performant enough for big Data URLs
    if (encoding !== 'base64' || !mediaType) {
        return null;
    }
    const characters = atob(dataURL.substring(commaIndex + 1));
    const bytes = new Uint8Array(characters.length);
    for (let i = 0; i < characters.length; i++) {
        bytes[i] = characters.charCodeAt(i);
    }
    return new Blob([bytes], {type: mediaType});
}

export async function tryConvertDataURLToBlobURL(dataURL: string): Promise<string | null> {
    if (!isBlobURLSupported) {
        return null;
    }
    const hash = getHashCode(dataURL);
    let blobURL = dataURLBlobURLs.get(hash);
    if (blobURL) {
        return blobURL;
    }

    let blob = tryConvertDataURLToBlobSync(dataURL);
    if (!blob) {
        const response = await fetch(dataURL);
        blob = await response.blob();
    }

    blobURL = URL.createObjectURL(blob);
    dataURLBlobURLs.set(hash, blobURL);
    return blobURL;
}

export function cleanImageProcessingCache(): void {
    imageManager && imageManager.stop();
    removeCanvas();
    objectURLs.forEach((u) => URL.revokeObjectURL(u));
    objectURLs.clear();
    dataURLBlobURLs.forEach((u) => URL.revokeObjectURL(u));
    dataURLBlobURLs.clear();
}

```

### inject\dynamic-theme\fixes.ts

```
import type {DynamicThemeFix} from '../../definitions';
import {isURLInList} from '../../utils/url';
import {logWarn} from '../utils/log';

/**
 * Note: This function's behavior is identical to what we had for a long time, but it's slightly odd:
 *  - it selects only one fix besides the default one
 *  - it equates specificity with the length of the first(!) pattern
 * @param documentURL The URL of the current document
 * @param fixes The array of the fixes that could apply to this document: the generic fix
 *        and fixes matching the document origin
 * @returns A single fix constructed from the generic fix and a single most relevant other fix
 */
export function findRelevantFix(documentURL: string, fixes: DynamicThemeFix[]): number | null {
    if (!Array.isArray(fixes) || fixes.length === 0 || fixes[0].url[0] !== '*') {
        logWarn('selectRelevantFix() failed to construct a single fix', documentURL, fixes);
        return null;
    }

    let maxSpecificity = 0;
    let maxSpecificityIndex: number | null = null;
    for (let i = 1; i < fixes.length; i++) {
        if (isURLInList(documentURL, fixes[i].url)) {
            // Note: this is legacy logic, a bit odd
            const specificity = fixes[i].url[0].length;
            if (maxSpecificityIndex === null || maxSpecificity < specificity) {
                maxSpecificity = specificity;
                maxSpecificityIndex = i;
            }
        }
    }

    return maxSpecificityIndex;
}

/**
 * Constructs a single fix out of multiple fixes, without modifying the original fixes
 * @param fixes The original fixes
 * @returns The combined fix
 */
export function combineFixes(fixes: DynamicThemeFix[]): DynamicThemeFix | null {
    if (fixes.length === 0 || fixes[0].url[0] !== '*') {
        logWarn('combineFixes() failed to construct a single fix', fixes);
        return null;
    }

    function combineArrays(arrays: string[][]): string[] {
        return arrays.filter(Boolean).flat();
    }

    return {
        url: [],
        invert: combineArrays(fixes.map((fix) => fix.invert)),
        css: fixes.map((fix) => fix.css).filter(Boolean).join('\n'),
        ignoreInlineStyle: combineArrays(fixes.map((fix) => fix.ignoreInlineStyle)),
        ignoreImageAnalysis: combineArrays(fixes.map((fix) => fix.ignoreImageAnalysis)),
        disableStyleSheetsProxy: fixes.some((fix) => fix.disableStyleSheetsProxy),
        disableCustomElementRegistryProxy: fixes.some((fix) => fix.disableCustomElementRegistryProxy),
    };
}

```

### inject\dynamic-theme\css-rules.ts

```
import {forEach} from '../../utils/array';
import {isLayerRuleSupported, isSafari} from '../../utils/platform';
import {escapeRegExpSpecialChars} from '../../utils/text';
import {parseURL, getAbsoluteURL} from '../../utils/url';
import {logInfo, logWarn} from '../utils/log';

export function iterateCSSRules(rules: CSSRuleList | CSSRule[] | Set<CSSRule>, iterate: (rule: CSSStyleRule) => void, onImportError?: () => void): void {
    forEach(rules, (rule) => {
        if (isStyleRule(rule)) {
            iterate(rule);
            if (rule.cssRules?.length > 0) {
                iterateCSSRules(rule.cssRules, iterate);
            }
        } else if (isImportRule(rule)) {
            try {
                iterateCSSRules(rule.styleSheet!.cssRules, iterate, onImportError);
            } catch (err) {
                logInfo(`Found a non-loaded link.`);
                onImportError?.();
            }
        } else if (isMediaRule(rule)) {
            const media = Array.from(rule.media);
            const isScreenOrAllOrQuery = media.some((m) => m.startsWith('screen') || m.startsWith('all') || m.startsWith('('));
            const isPrintOrSpeech = media.some((m) => m.startsWith('print') || m.startsWith('speech'));

            if (isScreenOrAllOrQuery || !isPrintOrSpeech) {
                iterateCSSRules(rule.cssRules, iterate, onImportError);
            }
        } else if (isSupportsRule(rule)) {
            if (CSS.supports(rule.conditionText)) {
                iterateCSSRules(rule.cssRules, iterate, onImportError);
            }
        } else if (isLayerRule(rule)) {
            iterateCSSRules(rule.cssRules, iterate, onImportError);
        } else {
            logWarn(`CSSRule type not supported`, rule);
        }
    });
}

// These properties are not iterable
// when they depend on variables
const shorthandVarDependantProperties = [
    'background',
    'border',
    'border-color',
    'border-bottom',
    'border-left',
    'border-right',
    'border-top',
    'outline',
    'outline-color',
];

const shorthandVarDepPropRegexps = isSafari ? shorthandVarDependantProperties.map((prop) => {
    const regexp = new RegExp(`${prop}:\\s*(.*?)\\s*;`);
    return [prop, regexp] as [string, RegExp];
}) : null;

export function iterateCSSDeclarations(style: CSSStyleDeclaration, iterate: (property: string, value: string) => void): void {
    forEach(style, (property) => {
        const value = style.getPropertyValue(property).trim();
        if (!value) {
            return;
        }
        iterate(property, value);
    });

    // Bigger sites like gmail.com and google.com will love this optimization.
    // As a side-effect, styles with a lot of `var(` will notice a maximum slowdown of ~50ms.
    // Against the bigger sites that saves around ~150ms+ it's a good win.
    const { cssText } = style;
    if (cssText.includes('var(')) {
        if (isSafari) {
            // Safari doesn't show shorthand properties' values
            shorthandVarDepPropRegexps!.forEach(([prop, regexp]) => {
                const match = regexp.exec(cssText);
                if (match?.[1]) {
                    const val = match[1].trim();
                    iterate(prop, val);
                }
            });
        } else {
            shorthandVarDependantProperties.forEach((prop) => {
                const val = style.getPropertyValue(prop);
                if (val?.includes('var(')) {
                    iterate(prop, val);
                }
            });
        }
    }

    if (cssText.includes('background-color: ;') && !style.getPropertyValue('background')) {
        handleEmptyShorthand('background', style, iterate);
    }
    if (cssText.includes('border-') && cssText.includes('-color: ;') && !style.getPropertyValue('border')) {
        handleEmptyShorthand('border', style, iterate);
    }
}

// `rule.cssText` fails when the rule has both
// `background: var()` and `background-*`.
// This fix retrieves the source value from CSS text,
// but will only work for <style> elements and
// there is a chance of multiple matches.
// https://issues.chromium.org/issues/40252592
function handleEmptyShorthand(shorthand: string, style: CSSStyleDeclaration, iterate: (property: string, value: string) => void) {
    const parentRule = style.parentRule;
    if (isStyleRule(parentRule)) {
        const sourceCSSText = parentRule.parentStyleSheet?.ownerNode?.textContent;
        if (sourceCSSText) {
            let escapedSelector = escapeRegExpSpecialChars(parentRule.selectorText);
            escapedSelector = escapedSelector.replaceAll(/\s+/g, '\\s*'); // Space count can differ
            escapedSelector = escapedSelector.replaceAll(/::/g, '::?'); // ::before can be :before
            const regexp = new RegExp(`${escapedSelector}\\s*{[^}]*${shorthand}:\\s*([^;}]+)`);
            const match = sourceCSSText.match(regexp);
            if (match) {
                iterate(shorthand, match[1]);
            }
        } else if (shorthand === 'background') {
            iterate('background-color', '#ffffff');
        }
    }
}

export const cssURLRegex = /url\((('.*?')|(".*?")|([^)]*?))\)/g;
export const cssImportRegex = /@import\s*(url\()?(('.+?')|(".+?")|([^)]*?))\)? ?(screen)?;?/gi;

// First try to extract the CSS URL value. Then do some post fixes, like unescaping
// backslashes in the URL. (Chromium don't handle this natively). Remove all newlines
// beforehand, otherwise `.` will fail matching the content within the url, as it
// doesn't match any linebreaks.
export function getCSSURLValue(cssURL: string): string {
    return cssURL.trim().replace(/[\n\r\\]+/g, '').replace(/^url\((.*)\)$/, '$1').trim().replace(/^"(.*)"$/, '$1').replace(/^'(.*)'$/, '$1').replace(/(?:\\(.))/g, '$1');
}

export function getCSSBasePath(url: string): string {
    const cssURL = parseURL(url);
    return `${cssURL.origin}${cssURL.pathname.replace(/\?.*$/, '').replace(/(?:[^/]+)$/i, '$1')}`;
}

export function replaceCSSRelativeURLsWithAbsolute($css: string, cssBasePath: string): string {
    return $css.replace(cssURLRegex, (match) => {
        try {
            const url = getCSSURLValue(match);
            const absoluteURL = getAbsoluteURL(cssBasePath, url);
            const escapedURL = absoluteURL.replaceAll('\'', '\\\'');
            return `url('${escapedURL}')`;
        } catch {
            logWarn('Not able to replace relative URL with Absolute URL, skipping');
            return match;
        }
    });
}

const fontFaceRegex = /@font-face\s*{[^}]*}/g;

export function replaceCSSFontFace($css: string): string {
    return $css.replace(fontFaceRegex, '');
}

const styleRules = new WeakSet<CSSRule>();
const importRules = new WeakSet<CSSRule>();
const mediaRules = new WeakSet<CSSRule>();
const supportsRules = new WeakSet<CSSRule>();
const layerRules = new WeakSet<CSSRule>();

export function isStyleRule(rule: CSSRule | null): rule is CSSStyleRule {
    if (!rule) {
        return false;
    }
    if (styleRules.has(rule)) {
        return true;
    }
    // Duck typing is faster than instanceof
    // https://jsben.ch/B0eLa
    if ((rule as CSSStyleRule).selectorText) {
        styleRules.add(rule);
        return true;
    }
    return false;
}

export function isImportRule(rule: CSSRule | null): rule is CSSImportRule {
    if (!rule) {
        return false;
    }
    if (styleRules.has(rule)) {
        return false;
    }
    if (importRules.has(rule)) {
        return true;
    }
    if ((rule as CSSImportRule).href) {
        importRules.add(rule);
        return true;
    }
    return false;
}

export function isMediaRule(rule: CSSRule | null): rule is CSSMediaRule {
    if (!rule) {
        return false;
    }
    if (styleRules.has(rule)) {
        return false;
    }
    if (mediaRules.has(rule)) {
        return true;
    }
    if ((rule as CSSMediaRule).media) {
        mediaRules.add(rule);
        return true;
    }
    return false;
}

export function isSupportsRule(rule: CSSRule | null): rule is CSSSupportsRule {
    if (!rule) {
        return false;
    }
    if (styleRules.has(rule)) {
        return false;
    }
    if (supportsRules.has(rule)) {
        return true;
    }
    if (rule instanceof CSSSupportsRule) {
        supportsRules.add(rule);
        return true;
    }
    return false;
}

export function isLayerRule(rule: CSSRule | null): rule is CSSLayerBlockRule {
    if (!rule) {
        return false;
    }
    if (styleRules.has(rule)) {
        return false;
    }
    if (layerRules.has(rule)) {
        return true;
    }
    if (isLayerRuleSupported && rule instanceof CSSLayerBlockRule) {
        layerRules.add(rule);
        return true;
    }
    return false;
}

```

### inject\dynamic-theme\css-collection.ts

```
import {forEach} from '../../utils/array';
import {formatCSS} from '../../utils/css-text/format-css';
import {loadAsDataURL} from '../../utils/network';
import {getMatches} from '../../utils/text';

const blobRegex = /url\(\"(blob\:.*?)\"\)/g;

async function replaceBlobs(text: string) {
    const promises: Array<Promise<string>> = [];
    getMatches(blobRegex, text, 1).forEach((url) => {
        const promise = loadAsDataURL(url);
        promises.push(promise);
    });
    const data = await Promise.all(promises);
    return text.replace(blobRegex, () => `url("${data.shift()}")`);
}

const banner = `/*
                        _______
                       /       \\
                      .==.    .==.
                     ((  ))==((  ))
                    / "=="    "=="\\
                   /____|| || ||___\\
       ________     ____    ________  ___    ___
       |  ___  \\   /    \\   |  ___  \\ |  |  /  /
       |  |  \\  \\ /  /\\  \\  |  |  \\  \\|  |_/  /
       |  |   )  /  /__\\  \\ |  |__/  /|  ___  \\
       |  |__/  /  ______  \\|  ____  \\|  |  \\  \\
_______|_______/__/ ____ \\__\\__|___\\__\\__|___\\__\\____
|  ___  \\ |  ____/ /    \\   |  ___  \\ |  ____|  ___  \\
|  |  \\  \\|  |___ /  /\\  \\  |  |  \\  \\|  |___|  |  \\  \\
|  |__/  /|  ____/  /__\\  \\ |  |   )  |  ____|  |__/  /
|  ____  \\|  |__/  ______  \\|  |__/  /|  |___|  ____  \\
|__|   \\__\\____/__/      \\__\\_______/ |______|__|   \\__\\
                https://darkreader.org
*/

/*! Dark reader generated CSS | Licensed under MIT https://github.com/darkreader/darkreader/blob/main/LICENSE */
`;

export async function collectCSS(): Promise<string> {
    const css = [banner];

    function addStaticCSS(selector: string, comment: string) {
        const staticStyle = document.querySelector(selector);
        if (staticStyle && staticStyle.textContent) {
            css.push(`/* ${comment} */`);
            css.push(staticStyle.textContent);
            css.push('');
        }
    }

    addStaticCSS('.darkreader--fallback', 'Fallback Style');
    addStaticCSS('.darkreader--user-agent', 'User-Agent Style');
    addStaticCSS('.darkreader--text', 'Text Style');
    addStaticCSS('.darkreader--invert', 'Invert Style');
    addStaticCSS('.darkreader--variables', 'Variables Style');

    const modifiedCSS: string[] = [];
    document.querySelectorAll('.darkreader--sync').forEach((element: HTMLStyleElement) => {
        forEach(element.sheet!.cssRules, (rule) => {
            rule && rule.cssText && modifiedCSS.push(rule.cssText);
        });
    });

    if (modifiedCSS.length) {
        const formattedCSS = formatCSS(modifiedCSS.join('\n'));
        css.push('/* Modified CSS */');
        css.push(await replaceBlobs(formattedCSS));
        css.push('');
    }

    addStaticCSS('.darkreader--override', 'Override Style');

    return css.join('\n');
}

```

### inject\utils\log.ts

```
import type {DebugMessageCStoBG} from '../../definitions';
import {DebugMessageTypeCStoBG} from '../../utils/message';

declare const __DEBUG__: boolean;
declare const __TEST__: boolean;
declare const __WATCH__: boolean;
declare const __LOG__: 'info' | 'warn';

function sendLogToBG(level: 'info' | 'warn' | 'assert', ...args: any[]) {
    if (__WATCH__ && __LOG__ && (__LOG__ === 'info' || level === 'warn')) {
        // No need to generate contextId since we do not expect a response
        chrome.runtime.sendMessage<DebugMessageCStoBG>({type: DebugMessageTypeCStoBG.LOG, data: {level, log: args}});
    }
}

export function logInfo(...args: any[]): void {
    if (__DEBUG__) {
        console.info('DARK READER', ...args);
        sendLogToBG('info', ...args);
    }
}

export function logWarn(...args: any[]): void {
    if (__DEBUG__) {
        // console.warn is slow in Chrome
        // console.warn(...args);
        console.log('DARK READER', ...args);
        sendLogToBG('warn', ...args);
    }
}

export function logInfoCollapsed(title: string, ...args: any[]): void {
    if (__DEBUG__) {
        console.groupCollapsed(`DARK READER ${title}`);
        console.log(...args);
        console.groupEnd();
    }
}

function logAssert(...args: any[]): void {
    if ((__TEST__ || __DEBUG__)) {
        console.assert(false, 'DARK READER', ...args);
        sendLogToBG('assert', ...args);
    }
}

export function ASSERT(description: string, condition: (() => boolean) | any): void {
    if ((__TEST__ || __DEBUG__) && (typeof condition === 'function' && !condition()) || !condition) {
        logAssert(description);
        if (__TEST__) {
            throw new Error(`Assertion failed: ${description}`);
        }
    }
}

```

### inject\utils\dom.ts

```
import {forEach} from '../../utils/array';
import {throttle} from '../../utils/throttle';
import {getDuration} from '../../utils/time';
import {logWarn} from '../utils/log';

interface CreateNodeAsapParams {
    selectNode: () => HTMLElement;
    createNode: (target: HTMLElement) => void;
    updateNode: (existing: HTMLElement) => void;
    selectTarget: () => HTMLElement;
    createTarget: () => HTMLElement;
    isTargetMutation: (mutation: MutationRecord) => boolean;
}

interface NodePosetionWatcher {
    run: () => void;
    stop: () => void;
    skip: () => void;
}

export function createNodeAsap({
    selectNode,
    createNode,
    updateNode,
    selectTarget,
    createTarget,
    isTargetMutation,
}: CreateNodeAsapParams): void {
    const target = selectTarget();
    if (target) {
        const prev = selectNode();
        if (prev) {
            updateNode(prev);
        } else {
            createNode(target);
        }
    } else {
        const observer = new MutationObserver((mutations) => {
            const mutation = mutations.find(isTargetMutation);
            if (mutation) {
                unsubscribe();
                const target = selectTarget();
                selectNode() || createNode(target);
            }
        });

        const ready = () => {
            if (document.readyState !== 'complete') {
                return;
            }

            unsubscribe();
            const target = selectTarget() || createTarget();
            selectNode() || createNode(target);
        };

        const unsubscribe = () => {
            document.removeEventListener('readystatechange', ready);
            observer.disconnect();
        };

        if (document.readyState === 'complete') {
            ready();
        } else {
            // readystatechange event is not cancellable and does not bubble
            document.addEventListener('readystatechange', ready);
            observer.observe(document, {childList: true, subtree: true});
        }
    }
}

export function removeNode(node: Node | null): void {
    node && node.parentNode && node.parentNode.removeChild(node);
}

export function watchForNodePosition<T extends Node>(
    node: T,
    mode: 'head' | 'prev-sibling',
    onRestore = Function.prototype,
): NodePosetionWatcher {
    const MAX_ATTEMPTS_COUNT = 10;
    const RETRY_TIMEOUT = getDuration({seconds: 2});
    const ATTEMPTS_INTERVAL = getDuration({seconds: 10});
    let prevSibling = node.previousSibling;
    let parent = node.parentNode;
    if (!parent) {
        throw new Error('Unable to watch for node position: parent element not found');
    }
    if (mode === 'prev-sibling' && !prevSibling) {
        throw new Error('Unable to watch for node position: there is no previous sibling');
    }
    let attempts = 0;
    let start: number | null = null;
    let timeoutId: ReturnType<typeof setTimeout> | null = null;
    const restore = throttle(() => {
        if (timeoutId) {
            return;
        }
        attempts++;
        const now = Date.now();
        if (start == null) {
            start = now;
        } else if (attempts >= MAX_ATTEMPTS_COUNT) {
            if (now - start < ATTEMPTS_INTERVAL) {
                logWarn(`Node position watcher paused: retry in ${RETRY_TIMEOUT}ms`, node, prevSibling);
                timeoutId = setTimeout(() => {
                    start = null;
                    attempts = 0;
                    timeoutId = null;
                    restore();
                }, RETRY_TIMEOUT);
                return;
            }
            start = now;
            attempts = 1;
        }

        if (mode === 'head') {
            if (prevSibling && prevSibling.parentNode !== parent) {
                logWarn('Sibling moved, moving node to the head end', node, prevSibling, parent);
                prevSibling = document.head.lastChild;
            }
        }

        if (mode === 'prev-sibling') {
            if (prevSibling!.parentNode == null) {
                logWarn('Unable to restore node position: sibling was removed', node, prevSibling, parent);
                stop();
                return;
            }
            if (prevSibling!.parentNode !== parent) {
                logWarn('Style was moved to another parent', node, prevSibling, parent);
                updateParent(prevSibling!.parentNode);
            }
        }

        // If parent becomes disconnected from the DOM, fetches the new head and
        // save that as parent. Do this only for the head mode, as those are
        // important nodes to keep.
        if (mode === 'head' && !parent!.isConnected) {
            parent = document.head;
            // TODO: Set correct prevSibling, which needs to be the last `.darkreader` in <head> that isn't .darkeader--sync or .darkreader--cors.
        }

        logWarn('Restoring node position', node, prevSibling, parent);
        parent!.insertBefore(node, prevSibling && prevSibling.isConnected ? prevSibling.nextSibling : parent!.firstChild);
        observer.takeRecords();
        onRestore && onRestore();
    });
    const observer = new MutationObserver(() => {
        if (
            (mode === 'head' && (node.parentNode !== parent || !node.parentNode!.isConnected)) ||
            (mode === 'prev-sibling' && node.previousSibling !== prevSibling)
        ) {
            restore();
        }
    });
    const run = () => {
        // TODO: remove type cast after dependency update
        observer.observe(parent!, {childList: true});
    };

    const stop = () => {
        // TODO: remove type cast after dependency update
        clearTimeout(timeoutId!);
        observer.disconnect();
        restore.cancel();
    };

    const skip = () => {
        observer.takeRecords();
    };

    const updateParent = (parentNode: Node & ParentNode | null) => {
        parent = parentNode;
        stop();
        run();
    };

    run();
    return {run, stop, skip};
}

export function iterateShadowHosts(root: Node | null, iterator: (host: Element) => void): void {
    if (root == null) {
        return;
    }
    const walker = document.createTreeWalker(
        root,
        NodeFilter.SHOW_ELEMENT,
        {
            acceptNode(node) {
                return (node as Element).shadowRoot == null ? NodeFilter.FILTER_SKIP : NodeFilter.FILTER_ACCEPT;
            },
        },
    );
    for (
        let node = ((root as Element).shadowRoot ? walker.currentNode : walker.nextNode()) as Element;
        node != null;
        node = walker.nextNode() as Element
    ) {
        if (node.classList.contains('surfingkeys_hints_host')) {
            continue;
        }

        iterator(node);
        iterateShadowHosts(node.shadowRoot, iterator);
    }
}

export let isDOMReady: () => boolean = () => {
    return document.readyState === 'complete' || document.readyState === 'interactive';
};

export function setIsDOMReady(newFunc: () => boolean): void {
    isDOMReady = newFunc;
}

const readyStateListeners = new Set<() => void>();

export function addDOMReadyListener(listener: () => void): void {
    isDOMReady() ? listener() : readyStateListeners.add(listener);
}

export function removeDOMReadyListener(listener: () => void): void {
    readyStateListeners.delete(listener);
}

// `interactive` can and will be fired when their are still stylesheets loading.
// We use certain actions that can cause a forced layout change, which is bad.
export function isReadyStateComplete(): boolean {
    return document.readyState === 'complete';
}

const readyStateCompleteListeners = new Set<() => void>();

export function addReadyStateCompleteListener(listener: () => void): void {
    isReadyStateComplete() ? listener() : readyStateCompleteListeners.add(listener);
}

export function cleanReadyStateCompleteListeners(): void {
    readyStateCompleteListeners.clear();
}

if (!isDOMReady()) {
    const onReadyStateChange = () => {
        if (isDOMReady()) {
            readyStateListeners.forEach((listener) => listener());
            readyStateListeners.clear();
            if (isReadyStateComplete()) {
                document.removeEventListener('readystatechange', onReadyStateChange);
                readyStateCompleteListeners.forEach((listener) => listener());
                readyStateCompleteListeners.clear();
            }
        }
    };

    // readystatechange event is not cancellable and does not bubble
    document.addEventListener('readystatechange', onReadyStateChange);
}

const HUGE_MUTATIONS_COUNT = 1000;

function isHugeMutation(mutations: MutationRecord[]) {
    if (mutations.length > HUGE_MUTATIONS_COUNT) {
        return true;
    }

    let addedNodesCount = 0;
    for (let i = 0; i < mutations.length; i++) {
        addedNodesCount += mutations[i].addedNodes.length;
        if (addedNodesCount > HUGE_MUTATIONS_COUNT) {
            return true;
        }
    }

    return false;
}

export interface ElementsTreeOperations {
    additions: Set<Element>;
    moves: Set<Element>;
    deletions: Set<Element>;
}

function getElementsTreeOperations(mutations: MutationRecord[]): ElementsTreeOperations {
    const additions = new Set<Element>();
    const deletions = new Set<Element>();
    const moves = new Set<Element>();
    mutations.forEach((m) => {
        forEach(m.addedNodes, (n) => {
            if (n instanceof Element && n.isConnected) {
                additions.add(n);
            }
        });
        forEach(m.removedNodes, (n) => {
            if (n instanceof Element) {
                if (n.isConnected) {
                    moves.add(n);
                    additions.delete(n);
                } else {
                    deletions.add(n);
                }
            }
        });
    });

    const duplicateAdditions: Element[] = [];
    const duplicateDeletions: Element[] = [];
    additions.forEach((node) => {
        if (additions.has(node.parentElement as HTMLElement)) {
            duplicateAdditions.push(node);
        }
    });
    deletions.forEach((node) => {
        if (deletions.has(node.parentElement as HTMLElement)) {
            duplicateDeletions.push(node);
        }
    });
    duplicateAdditions.forEach((node) => additions.delete(node));
    duplicateDeletions.forEach((node) => deletions.delete(node));

    return {additions, moves, deletions};
}

interface OptimizedTreeObserverCallbacks {
    onMinorMutations: (root: Document | ShadowRoot, operations: ElementsTreeOperations) => void;
    onHugeMutations: (root: Document | ShadowRoot) => void;
}

const optimizedTreeObservers = new Map<Node, MutationObserver>();
const optimizedTreeCallbacks = new WeakMap<MutationObserver, Set<OptimizedTreeObserverCallbacks>>();

// TODO: Use a single function to observe all shadow roots.
export function createOptimizedTreeObserver(root: Document | ShadowRoot, callbacks: OptimizedTreeObserverCallbacks): {disconnect: () => void} {
    let observer: MutationObserver;
    let observerCallbacks: Set<OptimizedTreeObserverCallbacks>;
    let domReadyListener: () => void;

    if (optimizedTreeObservers.has(root)) {
        observer = optimizedTreeObservers.get(root)!;
        observerCallbacks = optimizedTreeCallbacks.get(observer)!;
    } else {
        let hadHugeMutationsBefore = false;
        let subscribedForReadyState = false;

        observer = new MutationObserver((mutations: MutationRecord[]) => {
            if (isHugeMutation(mutations)) {
                if (!hadHugeMutationsBefore || isDOMReady()) {
                    observerCallbacks.forEach(({onHugeMutations}) => onHugeMutations(root));
                } else if (!subscribedForReadyState) {
                    domReadyListener = () => observerCallbacks.forEach(({onHugeMutations}) => onHugeMutations(root));
                    addDOMReadyListener(domReadyListener);
                    subscribedForReadyState = true;
                }
                hadHugeMutationsBefore = true;
            } else {
                const elementsOperations = getElementsTreeOperations(mutations);
                observerCallbacks.forEach(({onMinorMutations}) => onMinorMutations(root, elementsOperations));
            }
        });
        observer.observe(root, {childList: true, subtree: true});
        optimizedTreeObservers.set(root, observer);
        observerCallbacks = new Set();
        optimizedTreeCallbacks.set(observer, observerCallbacks);
    }

    observerCallbacks.add(callbacks);

    return {
        disconnect() {
            observerCallbacks.delete(callbacks);
            if (domReadyListener) {
                removeDOMReadyListener(domReadyListener);
            }
            if (observerCallbacks.size === 0) {
                observer.disconnect();
                optimizedTreeCallbacks.delete(observer);
                optimizedTreeObservers.delete(root);
            }
        },
    };
}

```

### inject\detector.ts

```
import type {DetectorHint} from '../definitions';
import {getSRGBLightness, parseColorWithCache} from '../utils/color';
import {isSystemDarkModeEnabled} from '../utils/media-query';

const COLOR_SCHEME_META_SELECTOR = 'meta[name="color-scheme"]';

function hasBuiltInDarkTheme() {
    const rootStyle = getComputedStyle(document.documentElement);
    if (rootStyle.filter.includes('invert(1)')) {
        return true;
    }

    const CELL_SIZE = 256;
    const MAX_ROW_COUNT = 4;
    const winWidth = innerWidth;
    const winHeight = innerHeight;
    const stepX = Math.floor(winWidth / Math.min(MAX_ROW_COUNT, Math.ceil(winWidth / CELL_SIZE)));
    const stepY = Math.floor(winHeight / Math.min(MAX_ROW_COUNT, Math.ceil(winHeight / CELL_SIZE)));

    const processedElements = new Set<Element>();

    for (let y = Math.floor(stepY / 2); y < winHeight; y += stepY) {
        for (let x = Math.floor(stepX / 2); x < winWidth; x += stepX) {
            const element = document.elementFromPoint(x, y);
            if (!element || processedElements.has(element)) {
                continue;
            }
            processedElements.add(element);
            const style = element === document.documentElement ? rootStyle : getComputedStyle(element);
            const bgColor = parseColorWithCache(style.backgroundColor);
            if (!bgColor) {
                return false;
            }
            if (bgColor.r === 24 && bgColor.g === 26 && bgColor.b === 27) {
                // For some websites changes to CSSStyleSheet.disabled and HTMLStyleElement.textContent
                // are not being applied synchronously. For example https://zorin.com/
                // Probably a browser bug. Treat as not having a dark theme.
                return false;
            }
            if (bgColor.a === 1) {
                const bgLightness = getSRGBLightness(bgColor.r, bgColor.g, bgColor.b);
                if (bgLightness > 0.5) {
                    return false;
                }
            } else {
                const textColor = parseColorWithCache(style.color);
                if (!textColor) {
                    return false;
                }
                const textLightness = getSRGBLightness(textColor.r, textColor.g, textColor.b);
                if (textLightness < 0.5) {
                    return false;
                }
            }
        }
    }

    const rootColor = parseColorWithCache(rootStyle.backgroundColor);
    if (!rootColor) {
        return false;
    }
    const bodyColor = document.body ? parseColorWithCache(getComputedStyle(document.body).backgroundColor) : {r: 0, g: 0, b: 0, a: 0};
    if (!bodyColor) {
        return false;
    }
    const rootLightness = (1 - rootColor.a!) + rootColor.a! * getSRGBLightness(rootColor.r, rootColor.g, rootColor.b);
    const finalLightness = (1 - bodyColor.a!) * rootLightness + bodyColor.a! * getSRGBLightness(bodyColor.r, bodyColor.g, bodyColor.b);
    return finalLightness < 0.5;
}

function runCheck(callback: (hasDarkTheme: boolean) => void) {
    const colorSchemeMeta = document.querySelector(COLOR_SCHEME_META_SELECTOR) as HTMLMetaElement;
    if (colorSchemeMeta) {
        const isMetaDark = colorSchemeMeta.content === 'dark' || (colorSchemeMeta.content.includes('dark') && isSystemDarkModeEnabled());
        callback(isMetaDark);
        return;
    }

    const drSheets = Array.from(document.styleSheets).filter((s) => (s.ownerNode as HTMLElement)?.classList.contains('darkreader'));
    drSheets.forEach((sheet) => sheet.disabled = true);

    const darkThemeDetected = hasBuiltInDarkTheme();

    drSheets.forEach((sheet) => sheet.disabled = false);
    callback(darkThemeDetected);
}

function hasSomeStyle() {
    if (document.querySelector(COLOR_SCHEME_META_SELECTOR) != null) {
        return true;
    }
    if (document.documentElement.style.backgroundColor || (document.body && document.body.style.backgroundColor)) {
        return true;
    }
    for (const style of document.styleSheets) {
        if (style && style.ownerNode && !((style.ownerNode as HTMLElement).classList && (style.ownerNode as HTMLElement).classList.contains('darkreader'))) {
            return true;
        }
    }
    return false;
}

let observer: MutationObserver | null;
let readyStateListener: (() => void) | null;

function canCheckForStyle() {
    if (!(
        document.body &&
        document.body.scrollHeight > 0 &&
        document.body.clientHeight > 0 &&
        document.body.childElementCount > 0 &&
        hasSomeStyle()
    )) {
        return false;
    }
    for (const child of document.body.children) {
        if (child.tagName !== 'SCRIPT' && child.tagName !== 'STYLE' && child.tagName !== 'LINK') {
            return true;
        }
    }
    return false;
}

export function runDarkThemeDetector(callback: (hasDarkTheme: boolean) => void, hints: DetectorHint[]): void {
    stopDarkThemeDetector();
    if (hints && hints.length > 0) {
        const hint = hints[0];
        if (hint.noDarkTheme) {
            callback(false);
            return;
        }
        if (hint.systemTheme && isSystemDarkModeEnabled()) {
            callback(true);
            return;
        }
        detectUsingHint(hint, () => callback(true));
        return;
    }

    if (canCheckForStyle()) {
        runCheck(callback);
        return;
    }

    observer = new MutationObserver(() => {
        if (canCheckForStyle()) {
            stopDarkThemeDetector();
            runCheck(callback);
        }
    });
    observer.observe(document.documentElement, {childList: true});

    if (document.readyState !== 'complete') {
        readyStateListener = () => {
            if (document.readyState === 'complete') {
                stopDarkThemeDetector();
                runCheck(callback);
            }
        };
        // readystatechange event is not cancellable and does not bubble
        document.addEventListener('readystatechange', readyStateListener);
    }
}

export function stopDarkThemeDetector(): void {
    if (observer) {
        observer.disconnect();
        observer = null;
    }
    if (readyStateListener) {
        document.removeEventListener('readystatechange', readyStateListener);
        readyStateListener = null;
    }
    stopDetectingUsingHint();
}

let hintTargetObserver: MutationObserver;
let hintMatchObserver: MutationObserver;

function detectUsingHint(hint: DetectorHint, success: () => void) {
    stopDetectingUsingHint();

    const matchSelector = (hint.match || []).join(', ');

    function checkMatch(target: Element) {
        if (target.matches?.(matchSelector)) {
            stopDetectingUsingHint();
            success();
            return true;
        }
        return false;
    }

    function setupMatchObserver(target: Element) {
        hintMatchObserver?.disconnect();
        if (checkMatch(target)) {
            return;
        }
        hintMatchObserver = new MutationObserver(() => checkMatch(target));
        hintMatchObserver.observe(target, {attributes: true});
    }

    const target = document.querySelector(hint.target);
    if (target) {
        setupMatchObserver(target);
    } else {
        hintTargetObserver = new MutationObserver((mutations) => {
            const handledTargets = new Set<Node>();
            for (const mutation of mutations) {
                if (handledTargets.has(mutation.target)) {
                    continue;
                }
                handledTargets.add(mutation.target);
                if (mutation.target instanceof Element) {
                    const target = mutation.target.querySelector(hint.target);
                    if (target) {
                        hintTargetObserver.disconnect();
                        setupMatchObserver(target);
                        break;
                    }
                }
            }
        });
        hintTargetObserver.observe(document.documentElement, {childList: true, subtree: true});
    }
}

function stopDetectingUsingHint() {
    hintTargetObserver?.disconnect();
    hintMatchObserver?.disconnect();
}

```

### inject\color-scheme-watcher.ts

```
import type {MessageBGtoCS, MessageCStoBG} from '../definitions';
import {isSystemDarkModeEnabled, runColorSchemeChangeDetector, stopColorSchemeChangeDetector} from '../utils/media-query';
import {MessageTypeCStoBG} from '../utils/message';
import {setDocumentVisibilityListener, documentIsVisible, removeDocumentVisibilityListener} from '../utils/visibility';

function cleanup() {
    stopColorSchemeChangeDetector();
    removeDocumentVisibilityListener();
}

function sendMessage(message: MessageCStoBG): void {
    const responseHandler = (response: MessageBGtoCS | 'unsupportedSender' | undefined) => {
        // Vivaldi bug workaround. See TabManager for details.
        if (response === 'unsupportedSender') {
            cleanup();
        }
    };

    try {
        const promise = chrome.runtime.sendMessage<MessageCStoBG, MessageBGtoCS | 'unsupportedSender'>(message);
        promise.then(responseHandler).catch(cleanup);
    } catch (error) {
        /*
         * We get here if Background context is unreachable which occurs when:
         *  - extension was disabled
         *  - extension was uninstalled
         *  - extension was updated and this is the old instance of content script
         *
         * Any async operations can be ignored here, but sync ones should run to completion.
         *
         * Regular message passing errors are returned via rejected promise or runtime.lastError.
         */
        if (error.message === 'Extension context invalidated.') {
            console.log('Dark Reader: instance of old CS detected, cleaning up.');
            cleanup();
        } else {
            console.log('Dark Reader: unexpected error during message passing.');
        }
    }
}

function notifyOfColorScheme(isDark: boolean): void {
    sendMessage({type: MessageTypeCStoBG.COLOR_SCHEME_CHANGE, data: {isDark}});
}

function updateEventListeners(): void {
    notifyOfColorScheme(isSystemDarkModeEnabled());
    if (documentIsVisible()) {
        runColorSchemeChangeDetector(notifyOfColorScheme);
    } else {
        stopColorSchemeChangeDetector();
    }
}

setDocumentVisibilityListener(updateEventListeners);
updateEventListeners();

```

### inject\cache.ts

```
import type {ImageDetails} from './dynamic-theme/image';

const STORAGE_KEY_WAS_ENABLED_FOR_HOST = '__darkreader__wasEnabledForHost';
const STORAGE_KEY_IMAGE_DETAILS_LIST = '__darkreader__imageDetails_v2_list';
const STORAGE_KEY_IMAGE_DETAILS_PREFIX = '__darkreader__imageDetails_v2_';
const STORAGE_KEY_CSS_FETCH_PREFIX = '__darkreader__cssFetch_';

export function wasEnabledForHost(): boolean | null {
    try {
        const value = sessionStorage.getItem(STORAGE_KEY_WAS_ENABLED_FOR_HOST);
        if (value === 'true') {
            return true;
        }
        if (value === 'false') {
            return false;
        }
    } catch (err) {
    }
    return null;
}

export function writeEnabledForHost(value: boolean): void {
    try {
        sessionStorage.setItem(STORAGE_KEY_WAS_ENABLED_FOR_HOST, value ? 'true' : 'false');
    } catch (err) {
    }
}

let imageCacheTimeout: number = 0;
const imageDetailsCacheQueue = new Map<string, ImageDetails>();
const cachedImageUrls: string[] = [];

function writeImageDetailsQueue() {
    imageDetailsCacheQueue.forEach((details, url) => {
        if (url && url.startsWith('https://')) {
            try {
                const json = JSON.stringify(details);
                sessionStorage.setItem(`${STORAGE_KEY_IMAGE_DETAILS_PREFIX}${url}`, json);
                cachedImageUrls.push(url);
            } catch (err) {
            }
        }
    });
    imageDetailsCacheQueue.clear();
    sessionStorage.setItem(STORAGE_KEY_IMAGE_DETAILS_LIST, JSON.stringify(cachedImageUrls));
}

export function writeImageDetailsCache(url: string, imageDetails: ImageDetails): void {
    if (!url || !url.startsWith('https://')) {
        return;
    }
    imageDetailsCacheQueue.set(url, imageDetails);
    clearTimeout(imageCacheTimeout);
    imageCacheTimeout = setTimeout(writeImageDetailsQueue, 1000);
}

export function readImageDetailsCache(targetMap: Map<string, ImageDetails>): void {
    try {
        const jsonList = sessionStorage.getItem(STORAGE_KEY_IMAGE_DETAILS_LIST);
        if (!jsonList) {
            return;
        }
        const list: string[] = JSON.parse(jsonList);
        list.forEach((url) => {
            const json = sessionStorage.getItem(`${STORAGE_KEY_IMAGE_DETAILS_PREFIX}${url}`);
            if (json) {
                const details = JSON.parse(json);
                targetMap.set(url, details);
            }
        });
    } catch (err) {
    }
}

export function writeCSSFetchCache(url: string, cssText: string): void {
    const key = `${STORAGE_KEY_CSS_FETCH_PREFIX}${url}`;
    try {
        sessionStorage.setItem(key, cssText);
    } catch (err) {
    }
}

export function readCSSFetchCache(url: string): string | null {
    const key = `${STORAGE_KEY_CSS_FETCH_PREFIX}${url}`;
    try {
        return sessionStorage.getItem(key) ?? null;
    } catch (err) {
    }
    return null;
}

```

### inject\svg-filter.ts

```
import {createNodeAsap, removeNode} from './utils/dom';

export function createOrUpdateSVGFilter(svgMatrix: string, svgReverseMatrix: string): void {
    createNodeAsap({
        selectNode: () => document.getElementById('dark-reader-svg')!,
        createNode: (target) => {
            const SVG_NS = 'http://www.w3.org/2000/svg';
            const createMatrixFilter = (id: string, matrix: string) => {
                const filter = document.createElementNS(SVG_NS, 'filter');
                filter.id = id;
                filter.style.colorInterpolationFilters = 'sRGB';

                // Fix displaying dynamic content https://bugs.chromium.org/p/chromium/issues/detail?id=647437
                filter.setAttribute('x', '0');
                filter.setAttribute('y', '0');
                filter.setAttribute('width', '99999');
                filter.setAttribute('height', '99999');

                filter.appendChild(createColorMatrix(matrix));
                return filter;
            };

            const createColorMatrix = (matrix: string) => {
                const colorMatrix = document.createElementNS(SVG_NS, 'feColorMatrix');
                colorMatrix.setAttribute('type', 'matrix');
                colorMatrix.setAttribute('values', matrix);
                return colorMatrix;
            };

            const svg = document.createElementNS(SVG_NS, 'svg');
            svg.id = 'dark-reader-svg';
            svg.style.height = '0';
            svg.style.width = '0';
            svg.appendChild(createMatrixFilter('dark-reader-filter', svgMatrix));
            svg.appendChild(createMatrixFilter('dark-reader-reverse-filter', svgReverseMatrix));
            target.appendChild(svg);
        },
        updateNode: (existing) => {
            const existingMatrix = existing.firstChild!.firstChild as SVGFEColorMatrixElement;
            if (existingMatrix.getAttribute('values') !== svgMatrix) {
                existingMatrix.setAttribute('values', svgMatrix);

                // Fix not triggering repaint
                const style = document.getElementById('dark-reader-style')!;
                const css = style.textContent;
                style.textContent = '';
                style.textContent = css;
            }
        },
        selectTarget: () => document.head,
        createTarget: () => {
            const head = document.createElement('head');
            document.documentElement.insertBefore(head, document.documentElement.firstElementChild);
            return head;
        },
        isTargetMutation: (mutation) => mutation.target.nodeName.toLowerCase() === 'head',
    });
}

export function removeSVGFilter(): void {
    removeNode(document.getElementById('dark-reader-svg'));
}

```

### inject\style.ts

```
import {createNodeAsap, removeNode} from './utils/dom';

export function createOrUpdateStyle(css: string, type: string): void {
    createNodeAsap({
        selectNode: () => document.getElementById('dark-reader-style')!,
        createNode: (target) => {
            document.documentElement.setAttribute('data-darkreader-mode', type);
            const style = document.createElement('style');
            style.id = 'dark-reader-style';
            style.classList.add('darkreader');
            style.type = 'text/css';
            style.textContent = css;
            target.appendChild(style);
        },
        updateNode: (existing) => {
            if (css.replace(/^\s+/gm, '') !== existing.textContent!.replace(/^\s+/gm, '')) {
                existing.textContent = css;
            }
        },
        selectTarget: () => document.head,
        createTarget: () => {
            const head = document.createElement('head');
            document.documentElement.insertBefore(head, document.documentElement.firstElementChild);
            return head;
        },
        isTargetMutation: (mutation) => mutation.target.nodeName.toLowerCase() === 'head',
    });
}

export function removeStyle(): void {
    removeNode(document.getElementById('dark-reader-style'));
    document.documentElement.removeAttribute('data-darkreader-mode');
}

```

### inject\index.ts

```
import type {DebugMessageBGtoCS, MessageBGtoCS, MessageCStoBG, MessageCStoUI, MessageUItoCS} from '../definitions';
import {isSystemDarkModeEnabled, runColorSchemeChangeDetector, stopColorSchemeChangeDetector, emulateColorScheme} from '../utils/media-query';
import {DebugMessageTypeBGtoCS, MessageTypeBGtoCS, MessageTypeCStoBG, MessageTypeCStoUI, MessageTypeUItoCS} from '../utils/message';
import {generateUID} from '../utils/uid';

import {writeEnabledForHost} from './cache';
import {runDarkThemeDetector, stopDarkThemeDetector} from './detector';
import {createOrUpdateDynamicTheme, removeDynamicTheme, cleanDynamicThemeCache} from './dynamic-theme';
import {collectCSS} from './dynamic-theme/css-collection';
import {createOrUpdateStyle, removeStyle} from './style';
import {createOrUpdateSVGFilter, removeSVGFilter} from './svg-filter';
import {logWarn, logInfoCollapsed} from './utils/log';

declare const __DEBUG__: boolean;
declare const __TEST__: boolean;

let unloaded = false;

let darkReaderDynamicThemeStateForTesting: 'loading' | 'ready' = 'loading';

declare const __CHROMIUM_MV2__: boolean;
declare const __CHROMIUM_MV3__: boolean;
declare const __THUNDERBIRD__: boolean;
declare const __FIREFOX_MV2__: boolean;

// Identifier for this particular script instance. It is used as an alternative to chrome.runtime.MessageSender.documentId
const scriptId = generateUID();

function cleanup() {
    unloaded = true;
    removeEventListener('pagehide', onPageHide);
    removeEventListener('freeze', onFreeze);
    removeEventListener('resume', onResume);
    cleanDynamicThemeCache();
    stopDarkThemeDetector();
    stopColorSchemeChangeDetector();
}

function sendMessageForTesting(uuid: string) {
    document.dispatchEvent(new CustomEvent('test-message', {detail: uuid}));
}

function sendMessage(message: MessageCStoBG | MessageCStoUI): true | undefined {
    if (unloaded) {
        return;
    }
    const responseHandler = (response: MessageBGtoCS | 'unsupportedSender' | undefined) => {
        // Vivaldi bug workaround. See TabManager for details.
        if (response === 'unsupportedSender' || response?.type === MessageTypeBGtoCS.UNSUPPORTED_SENDER) {
            removeStyle();
            removeSVGFilter();
            removeDynamicTheme();
            cleanup();
        }
    };

    try {
        if (__CHROMIUM_MV3__) {
            const promise = chrome.runtime.sendMessage<MessageCStoBG | MessageCStoUI, MessageBGtoCS | 'unsupportedSender'>(message);
            promise.then(responseHandler).catch(cleanup);
        } else {
            chrome.runtime.sendMessage<MessageCStoBG | MessageCStoUI, 'unsupportedSender' | undefined>(message, responseHandler);
        }
    } catch (error) {
        /*
         * We get here if Background context is unreachable which occurs when:
         *  - extension was disabled
         *  - extension was uninstalled
         *  - extension was updated and this is the old instance of content script
         *
         * Any async operations can be ignored here, but sync ones should run to completion.
         *
         * Regular message passing errors are returned via rejected promise or runtime.lastError.
         */
        if (error.message === 'Extension context invalidated.') {
            console.log('Dark Reader: instance of old CS detected, cleaning up.');
            cleanup();
        } else {
            console.log('Dark Reader: unexpected error during message passing.');
        }
    }
}

function onMessage(message: MessageBGtoCS | MessageUItoCS | DebugMessageBGtoCS) {
    if (__DEBUG__ && message.type === DebugMessageTypeBGtoCS.RELOAD) {
        logWarn('Cleaning up before update');
        cleanup();
        return;
    }

    if ((message as MessageBGtoCS).scriptId !== scriptId && message.type !== MessageTypeUItoCS.EXPORT_CSS) {
        return;
    }

    logInfoCollapsed(`onMessage[${message.type}]`, message);
    switch (message.type) {
        case MessageTypeBGtoCS.ADD_CSS_FILTER:
        case MessageTypeBGtoCS.ADD_STATIC_THEME: {
            const {css, detectDarkTheme, detectorHints} = message.data;
            removeDynamicTheme();
            createOrUpdateStyle(css, message.type === MessageTypeBGtoCS.ADD_STATIC_THEME ? 'static' : 'filter');
            writeEnabledForHost(true);
            if (detectDarkTheme) {
                runDarkThemeDetector((hasDarkTheme) => {
                    if (hasDarkTheme) {
                        removeStyle();
                        onDarkThemeDetected();
                    }
                }, detectorHints);
            }
            break;
        }
        case MessageTypeBGtoCS.ADD_SVG_FILTER: {
            const {css, svgMatrix, svgReverseMatrix, detectDarkTheme, detectorHints} = message.data;
            removeDynamicTheme();
            createOrUpdateSVGFilter(svgMatrix, svgReverseMatrix);
            createOrUpdateStyle(css, 'filter');
            writeEnabledForHost(true);
            if (detectDarkTheme) {
                runDarkThemeDetector((hasDarkTheme) => {
                    if (hasDarkTheme) {
                        removeStyle();
                        removeSVGFilter();
                        onDarkThemeDetected();
                    }
                }, detectorHints);
            }
            break;
        }
        case MessageTypeBGtoCS.ADD_DYNAMIC_THEME: {
            const {theme, fixes, isIFrame, detectDarkTheme, detectorHints} = message.data;
            removeStyle();
            createOrUpdateDynamicTheme(theme, fixes, isIFrame);
            writeEnabledForHost(true);
            if (detectDarkTheme) {
                runDarkThemeDetector((hasDarkTheme) => {
                    if (hasDarkTheme) {
                        removeDynamicTheme();
                        onDarkThemeDetected();
                    }
                }, detectorHints);
            }
            if (__TEST__) {
                darkReaderDynamicThemeStateForTesting = 'ready';
                sendMessageForTesting('darkreader-dynamic-theme-ready');
                sendMessageForTesting(`darkreader-dynamic-theme-ready-${document.location.pathname}`);
            }
            break;
        }
        case MessageTypeUItoCS.EXPORT_CSS:
            collectCSS().then((collectedCSS) => sendMessage({type: MessageTypeCStoUI.EXPORT_CSS_RESPONSE, data: collectedCSS}));
            break;
        case MessageTypeBGtoCS.UNSUPPORTED_SENDER:
        case MessageTypeBGtoCS.CLEAN_UP:
            removeStyle();
            removeSVGFilter();
            removeDynamicTheme();
            stopDarkThemeDetector();
            writeEnabledForHost(false);
            break;
        default:
            break;
    }
}

function sendConnectionOrResumeMessage(type: MessageTypeCStoBG.DOCUMENT_CONNECT | MessageTypeCStoBG.DOCUMENT_RESUME) {
    sendMessage(
        {
            type,
            scriptId,
            data: (__CHROMIUM_MV2__ || __CHROMIUM_MV3__) ? {
                isDark: isSystemDarkModeEnabled(),
                isTopFrame: window === window.top,
            } : {
                isDark: isSystemDarkModeEnabled(),
            },
        });
}

runColorSchemeChangeDetector((isDark) =>
    sendMessage({type: MessageTypeCStoBG.COLOR_SCHEME_CHANGE, data: {isDark}})
);

chrome.runtime.onMessage.addListener(onMessage);
sendConnectionOrResumeMessage(MessageTypeCStoBG.DOCUMENT_CONNECT);

function onPageHide(e: PageTransitionEvent) {
    if (e.persisted === false) {
        sendMessage({type: MessageTypeCStoBG.DOCUMENT_FORGET, scriptId});
    }
}

function onFreeze() {
    sendMessage({type: MessageTypeCStoBG.DOCUMENT_FREEZE});
}

function onResume() {
    sendConnectionOrResumeMessage(MessageTypeCStoBG.DOCUMENT_RESUME);
}

function onDarkThemeDetected() {
    writeEnabledForHost(false);
    sendMessage({type: MessageTypeCStoBG.DARK_THEME_DETECTED});
}

// Thunderbird does not have "tabs", and emails aren't 'frozen' or 'cached'.
// And will currently error: `Promise rejected after context unloaded: Actor 'Conduits' destroyed before query 'RuntimeMessage' was resolved`
if (!__THUNDERBIRD__) {
    addEventListener('pagehide', onPageHide, {passive: true});
    addEventListener('freeze', onFreeze, {passive: true});
    addEventListener('resume', onResume, {passive: true});
}

if (__TEST__) {
    async function awaitDOMContentLoaded() {
        if (document.readyState === 'loading') {
            return new Promise<void>((resolve) => {
                addEventListener('DOMContentLoaded', () => resolve(), {passive: true});
            });
        }
    }

    async function awaitDarkReaderReady() {
        if (darkReaderDynamicThemeStateForTesting !== 'ready') {
            return new Promise<void>((resolve) => {
                document.addEventListener('test-message', (event: CustomEvent) => {
                    const message = event.detail;
                    if (message === 'darkreader-dynamic-theme-ready' && darkReaderDynamicThemeStateForTesting === 'ready') {
                        resolve();
                    }
                }, {passive: true});
            });
        }
    }

    const socket = new WebSocket(`ws://localhost:8894`);
    socket.onopen = async () => {
        document.addEventListener('test-message', (e: CustomEvent) => {
            socket.send(JSON.stringify({
                data: {
                    type: 'page',
                    uuid: e.detail,
                },
                id: null,
            }));
        }, {passive: true});

        // Wait for DOM to be complete
        // Note that here we wait only for DOM parsing and not for sub-resource load
        await awaitDOMContentLoaded();
        await awaitDarkReaderReady();
        socket.send(JSON.stringify({
            data: {
                type: 'page',
                message: 'page-ready',
                uuid: `ready-${document.location.pathname}`,
            },
            id: null,
        }));
    };

    // TODO(anton): remove this once Firefox supports tab.eval() via WebDriver BiDi
    if (__FIREFOX_MV2__) {
        function expectPageStyles(data: any) {
            const checkOne = (expectation: any) => {
                const [selector, cssAttributeName, expectedValue] = expectation;
                const selector_ = Array.isArray(selector) ? selector : [selector];
                let element = document as any;
                for (const part of selector_) {
                    if (element instanceof HTMLIFrameElement) {
                        element = element.contentDocument;
                    }
                    if (element.shadowRoot instanceof ShadowRoot) {
                        element = element.shadowRoot;
                    }
                    if (part === 'document') {
                        element = element.documentElement;
                    } else {
                        element = element.querySelector(part);
                    }
                    if (!element) {
                        return `Could not find element ${part}`;
                    }
                }
                const style = getComputedStyle(element);
                if (style[cssAttributeName] !== expectedValue) {
                    return `Got ${style[cssAttributeName]}`;
                }
            };

            const errors: Array<[number, string]> = [];
            const expectations = Array.isArray(data[0]) ? data : [data];
            for (let i = 0; i < expectations.length; i++) {
                const error = checkOne(expectations[i]);
                if (error) {
                    errors.push([i, error]);
                }
            }
            return errors;
        }

        socket.onmessage = (e) => {
            function respond(data: any) {
                socket.send(JSON.stringify({id, data}));
            }

            const {id, data, type} = JSON.parse(e.data);
            switch (type) {
                case 'firefox-eval': {
                    const result = eval(data);
                    if (result instanceof Promise) {
                        result.then(respond);
                    } else {
                        respond(result);
                    }
                    break;
                }
                case 'firefox-expectPageStyles': {
                    // Styles may not have been applied to the document yet,
                    // so we check once immediately and then on an interval.
                    function checkPageStylesNow() {
                        const errors = expectPageStyles(data);
                        if (errors.length === 0) {
                            respond([]);
                            interval && clearInterval(interval);
                        }
                    }

                    const interval: number = setInterval(checkPageStylesNow, 200);
                    checkPageStylesNow();
                    break;
                }
                case 'firefox-getColorScheme': {
                    respond(isSystemDarkModeEnabled() ? 'dark' : 'light');
                    break;
                }
                case 'firefox-emulateColorScheme': {
                    emulateColorScheme(data);
                    respond(undefined);
                    break;
                }
            }
        };
    }
}

```

### inject\fallback.ts

```
import {wasEnabledForHost} from './cache';

if (
    document.documentElement instanceof HTMLHtmlElement &&
    matchMedia('(prefers-color-scheme: dark)').matches &&
    wasEnabledForHost() !== false &&
    !document.querySelector('.darkreader--fallback') &&
    !document.querySelector('.darkreader')
) {
    const css = [
        'html, body, body :not(iframe) {',
        '    background-color: #181a1b !important;',
        '    border-color: #776e62 !important;',
        '    color: #e8e6e3 !important;',
        '}',
        'html, body {',
        '    opacity: 1 !important;',
        '    transition: none !important;',
        '}',
        // MS Learn High Contrast issue
        // https://github.com/darkreader/darkreader/issues/3618
        'div[style*="background-color: rgb(135, 135, 135)"] {',
        '    background-color: #878787 !important;',
        '}',
    ].join('\n');
    const fallback = document.createElement('style');
    fallback.classList.add('darkreader');
    fallback.classList.add('darkreader--fallback');
    fallback.media = 'screen';
    fallback.textContent = css;

    if (document.head) {
        document.head.append(fallback);
    } else {
        const root = document.documentElement;
        root.append(fallback);
        const observer = new MutationObserver(() => {
            if (document.head) {
                observer.disconnect();
                if (fallback.isConnected) {
                    document.head.append(fallback);
                }
            }
        });
        observer.observe(root, {childList: true});
    }
}

declare const __FIREFOX_MV2__: boolean;

if (__FIREFOX_MV2__ && (location.host === 'teams.live.com' || location.host === 'teams.microsoft.com')) {
    // Microsoft Teams calls sheet.cssRules on extension styles and that
    // causes "Not allowed to access cross-origin stylesheet" in Firefox
    (() => {
        const descriptor = Object.getOwnPropertyDescriptor(CSSStyleSheet.prototype, 'cssRules')!;
        Object.defineProperty(CSSStyleSheet.prototype, 'cssRules', {
            ...descriptor,
            get: function () {
                if (this.ownerNode?.classList?.contains('darkreader')) {
                    return [];
                }
                return descriptor.get!.call(this) as CSSStyleSheet[];
            },
        });
    })();
}

```

### stubs\popup\plus-body.tsx

```
import {m} from 'malevic';

export function PlusBody(): Malevic.Child {
    return <body></body>;
}

```

### stubs\utils\theme.ts

```
import type {Theme} from 'definitions';
import type {HSLA} from 'utils/color';

export function getBackgroundPoles(_theme: Theme): [string, string] {
    return ['', ''];
}

export function getTextPoles(_theme: Theme): [string, string] {
    return ['', ''];
}

export function modifyBgColorExtended({h, s, l, a}: HSLA, _pole1: HSLA, _pole2: HSLA): HSLA {
    return {h, s, l, a};
}

export function modifyFgColorExtended({h, s, l, a}: HSLA, _pole1: HSLA, _pole2: HSLA): HSLA {
    return {h, s, l, a};
}

export function modifyLightSchemeColorExtended({h, s, l, a}: HSLA, _pole1: HSLA, _pole2: HSLA): HSLA {
    return {h, s, l, a};
}

export function extendThemeCacheKeys(_keys: Array<keyof Theme>) {
}

```

### stubs\defaults.ts

```
import type {Theme} from '../definitions';

export function extendThemeDefaults(_defaultTheme: Theme): void {
}

```

### ui\assets\fonts\LICENSE.txt

```

                                 Apache License
                           Version 2.0, January 2004
                        http://www.apache.org/licenses/

   TERMS AND CONDITIONS FOR USE, REPRODUCTION, AND DISTRIBUTION

   1. Definitions.

      "License" shall mean the terms and conditions for use, reproduction,
      and distribution as defined by Sections 1 through 9 of this document.

      "Licensor" shall mean the copyright owner or entity authorized by
      the copyright owner that is granting the License.

      "Legal Entity" shall mean the union of the acting entity and all
      other entities that control, are controlled by, or are under common
      control with that entity. For the purposes of this definition,
      "control" means (i) the power, direct or indirect, to cause the
      direction or management of such entity, whether by contract or
      otherwise, or (ii) ownership of fifty percent (50%) or more of the
      outstanding shares, or (iii) beneficial ownership of such entity.

      "You" (or "Your") shall mean an individual or Legal Entity
      exercising permissions granted by this License.

      "Source" form shall mean the preferred form for making modifications,
      including but not limited to software source code, documentation
      source, and configuration files.

      "Object" form shall mean any form resulting from mechanical
      transformation or translation of a Source form, including but
      not limited to compiled object code, generated documentation,
      and conversions to other media types.

      "Work" shall mean the work of authorship, whether in Source or
      Object form, made available under the License, as indicated by a
      copyright notice that is included in or attached to the work
      (an example is provided in the Appendix below).

      "Derivative Works" shall mean any work, whether in Source or Object
      form, that is based on (or derived from) the Work and for which the
      editorial revisions, annotations, elaborations, or other modifications
      represent, as a whole, an original work of authorship. For the purposes
      of this License, Derivative Works shall not include works that remain
      separable from, or merely link (or bind by name) to the interfaces of,
      the Work and Derivative Works thereof.

      "Contribution" shall mean any work of authorship, including
      the original version of the Work and any modifications or additions
      to that Work or Derivative Works thereof, that is intentionally
      submitted to Licensor for inclusion in the Work by the copyright owner
      or by an individual or Legal Entity authorized to submit on behalf of
      the copyright owner. For the purposes of this definition, "submitted"
      means any form of electronic, verbal, or written communication sent
      to the Licensor or its representatives, including but not limited to
      communication on electronic mailing lists, source code control systems,
      and issue tracking systems that are managed by, or on behalf of, the
      Licensor for the purpose of discussing and improving the Work, but
      excluding communication that is conspicuously marked or otherwise
      designated in writing by the copyright owner as "Not a Contribution."

      "Contributor" shall mean Licensor and any individual or Legal Entity
      on behalf of whom a Contribution has been received by Licensor and
      subsequently incorporated within the Work.

   2. Grant of Copyright License. Subject to the terms and conditions of
      this License, each Contributor hereby grants to You a perpetual,
      worldwide, non-exclusive, no-charge, royalty-free, irrevocable
      copyright license to reproduce, prepare Derivative Works of,
      publicly display, publicly perform, sublicense, and distribute the
      Work and such Derivative Works in Source or Object form.

   3. Grant of Patent License. Subject to the terms and conditions of
      this License, each Contributor hereby grants to You a perpetual,
      worldwide, non-exclusive, no-charge, royalty-free, irrevocable
      (except as stated in this section) patent license to make, have made,
      use, offer to sell, sell, import, and otherwise transfer the Work,
      where such license applies only to those patent claims licensable
      by such Contributor that are necessarily infringed by their
      Contribution(s) alone or by combination of their Contribution(s)
      with the Work to which such Contribution(s) was submitted. If You
      institute patent litigation against any entity (including a
      cross-claim or counterclaim in a lawsuit) alleging that the Work
      or a Contribution incorporated within the Work constitutes direct
      or contributory patent infringement, then any patent licenses
      granted to You under this License for that Work shall terminate
      as of the date such litigation is filed.

   4. Redistribution. You may reproduce and distribute copies of the
      Work or Derivative Works thereof in any medium, with or without
      modifications, and in Source or Object form, provided that You
      meet the following conditions:

      (a) You must give any other recipients of the Work or
          Derivative Works a copy of this License; and

      (b) You must cause any modified files to carry prominent notices
          stating that You changed the files; and

      (c) You must retain, in the Source form of any Derivative Works
          that You distribute, all copyright, patent, trademark, and
          attribution notices from the Source form of the Work,
          excluding those notices that do not pertain to any part of
          the Derivative Works; and

      (d) If the Work includes a "NOTICE" text file as part of its
          distribution, then any Derivative Works that You distribute must
          include a readable copy of the attribution notices contained
          within such NOTICE file, excluding those notices that do not
          pertain to any part of the Derivative Works, in at least one
          of the following places: within a NOTICE text file distributed
          as part of the Derivative Works; within the Source form or
          documentation, if provided along with the Derivative Works; or,
          within a display generated by the Derivative Works, if and
          wherever such third-party notices normally appear. The contents
          of the NOTICE file are for informational purposes only and
          do not modify the License. You may add Your own attribution
          notices within Derivative Works that You distribute, alongside
          or as an addendum to the NOTICE text from the Work, provided
          that such additional attribution notices cannot be construed
          as modifying the License.

      You may add Your own copyright statement to Your modifications and
      may provide additional or different license terms and conditions
      for use, reproduction, or distribution of Your modifications, or
      for any such Derivative Works as a whole, provided Your use,
      reproduction, and distribution of the Work otherwise complies with
      the conditions stated in this License.

   5. Submission of Contributions. Unless You explicitly state otherwise,
      any Contribution intentionally submitted for inclusion in the Work
      by You to the Licensor shall be under the terms and conditions of
      this License, without any additional terms or conditions.
      Notwithstanding the above, nothing herein shall supersede or modify
      the terms of any separate license agreement you may have executed
      with Licensor regarding such Contributions.

   6. Trademarks. This License does not grant permission to use the trade
      names, trademarks, service marks, or product names of the Licensor,
      except as required for reasonable and customary use in describing the
      origin of the Work and reproducing the content of the NOTICE file.

   7. Disclaimer of Warranty. Unless required by applicable law or
      agreed to in writing, Licensor provides the Work (and each
      Contributor provides its Contributions) on an "AS IS" BASIS,
      WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or
      implied, including, without limitation, any warranties or conditions
      of TITLE, NON-INFRINGEMENT, MERCHANTABILITY, or FITNESS FOR A
      PARTICULAR PURPOSE. You are solely responsible for determining the
      appropriateness of using or redistributing the Work and assume any
      risks associated with Your exercise of permissions under this License.

   8. Limitation of Liability. In no event and under no legal theory,
      whether in tort (including negligence), contract, or otherwise,
      unless required by applicable law (such as deliberate and grossly
      negligent acts) or agreed to in writing, shall any Contributor be
      liable to You for damages, including any direct, indirect, special,
      incidental, or consequential damages of any character arising as a
      result of this License or out of the use or inability to use the
      Work (including but not limited to damages for loss of goodwill,
      work stoppage, computer failure or malfunction, or any and all
      other commercial damages or losses), even if such Contributor
      has been advised of the possibility of such damages.

   9. Accepting Warranty or Additional Liability. While redistributing
      the Work or Derivative Works thereof, You may choose to offer,
      and charge a fee for, acceptance of support, warranty, indemnity,
      or other liability obligations and/or rights consistent with this
      License. However, in accepting such obligations, You may act only
      on Your own behalf and on Your sole responsibility, not on behalf
      of any other Contributor, and only if You agree to indemnify,
      defend, and hold each Contributor harmless for any liability
      incurred by, or claims asserted against, such Contributor by reason
      of your accepting any such warranty or additional liability.

   END OF TERMS AND CONDITIONS

   APPENDIX: How to apply the Apache License to your work.

      To apply the Apache License to your work, attach the following
      boilerplate notice, with the fields enclosed by brackets "[]"
      replaced with your own identifying information. (Don't include
      the brackets!)  The text should be enclosed in the appropriate
      comment syntax for the file format. We also recommend that a
      file or class name and description of purpose be included on the
      same "printed page" as the copyright notice for easier
      identification within third-party archives.

   Copyright [yyyy] [name of copyright owner]

   Licensed under the Apache License, Version 2.0 (the "License");
   you may not use this file except in compliance with the License.
   You may obtain a copy of the License at

       http://www.apache.org/licenses/LICENSE-2.0

   Unless required by applicable law or agreed to in writing, software
   distributed under the License is distributed on an "AS IS" BASIS,
   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   See the License for the specific language governing permissions and
   limitations under the License.

```

### ui\assets\images\mode-light-32.svg

```
<svg viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg"><defs><linearGradient x1="7.5789" y1="13.4737" x2="7.4331" y2="20.8984" id="gradient8402" gradientUnits="userSpaceOnUse"><stop offset="0%" stop-color="rgb(20,30,36)"/><stop offset="100%" stop-color="rgb(225,160,121)"/></linearGradient><linearGradient x1="7.5789" y1="13.4737" x2="7.5495" y2="17.6962" id="gradient8403" gradientUnits="userSpaceOnUse"><stop offset="0%" stop-color="rgb(20,30,36)"/><stop offset="100%" stop-color="rgb(225,160,121)"/></linearGradient><linearGradient x1="24.4079" y1="13.476" x2="24.5537" y2="20.9008" id="gradient8404" gradientUnits="userSpaceOnUse"><stop offset="0%" stop-color="rgb(20,30,36)"/><stop offset="100%" stop-color="rgb(225,160,121)"/></linearGradient><linearGradient x1="24.4079" y1="13.476" x2="24.4373" y2="17.6985" id="gradient8405" gradientUnits="userSpaceOnUse"><stop offset="0%" stop-color="rgb(20,30,36)"/><stop offset="100%" stop-color="rgb(225,160,121)"/></linearGradient><linearGradient x1="7.5789" y1="13.6579" x2="7.4395" y2="20.7578" id="gradient8409" gradientUnits="userSpaceOnUse"><stop offset="0%" stop-color="rgb(20,30,36)"/><stop offset="100%" stop-color="rgb(139,188,199)"/></linearGradient><linearGradient x1="7.5789" y1="13.6579" x2="7.5508" y2="17.6956" id="gradient8410" gradientUnits="userSpaceOnUse"><stop offset="0%" stop-color="rgb(20,30,36)"/><stop offset="100%" stop-color="rgb(139,188,199)"/></linearGradient><linearGradient x1="24.4079" y1="13.6602" x2="24.5474" y2="20.7602" id="gradient8411" gradientUnits="userSpaceOnUse"><stop offset="0%" stop-color="rgb(20,30,36)"/><stop offset="100%" stop-color="rgb(139,188,199)"/></linearGradient><linearGradient x1="24.4079" y1="13.6602" x2="24.436" y2="17.698" id="gradient8412" gradientUnits="userSpaceOnUse"><stop offset="0%" stop-color="rgb(20,30,36)"/><stop offset="100%" stop-color="rgb(139,188,199)"/></linearGradient></defs><g><path d="M3.3684,26.9474 C6.4215,26.3498 9.2961,25.2549 11.7895,23.5789 C13.7722,22.2463 15.5027,20.5598 16.8421,18.5263 C17.6715,20.4056 18.8287,22.0877 20.2105,23.5789 C22.0993,25.6172 24.4134,27.2825 26.9474,28.6316 C27.4781,25.6776 27.6141,22.6771 26.9474,20.2105 C26.6067,18.95 26.0808,17.82 25.2632,16.8421 C25.8179,16.7106 26.375,16.7263 26.9474,16.8421 C28.0674,17.0687 29.2404,17.7232 30.3158,18.5263 C29.9257,16.7807 29.3536,15.0976 28.6316,13.4737 C27.4151,10.7378 25.8791,8.2067 23.5789,6.7368 C21.2275,5.2342 18.2143,4.8773 15.1579,5.0526 C12.7823,5.1889 10.4557,5.6183 8.4211,6.7368 C5.3928,8.4015 3.1277,11.4855 1.6842,15.1579 L5.0526,13.4737 C4.2132,15.0611 3.6799,16.762 3.3684,18.5263 C2.8901,21.236 2.9644,24.1007 3.3684,26.9474 Z" fill="rgb(163,138,98)" opacity="1"/><path d="M28.6316,16.8421 C29.7889,23.0397 23.9512,30.3024 16,30.3158 C7.9822,30.3293 2.2704,23.1481 3.3684,16.8421 C5.6444,3.7709 26.4143,3.705 28.6316,16.8421 Z" fill="rgb(177,106,78)" opacity="1"/><path d="M26.9474,16.8421 C26.9756,24.2981 22.0463,30.3146 16,30.3158 C9.9442,30.317 5.0526,24.2947 5.0526,16.8421 C5.0526,9.3895 9.9442,3.3672 16,3.3684 C22.0463,3.3697 26.9756,9.3861 26.9474,16.8421 Z" fill="rgb(225,160,121)" opacity="1"/><path d="M20.2105,6.7368 C17.8957,7.7276 15.6396,8.8412 13.4737,10.1053 C11.7245,11.1261 10.0338,12.2433 8.4211,13.4737 C8.6634,11.6691 9.2278,9.9635 10.1053,8.4211 C10.95,6.9361 12.0324,5.6253 13.4737,5.0526 C15.5466,4.2289 18.0919,4.9058 20.2105,6.7368 Z" fill="rgb(177,106,78)" opacity="1"/><path d="M11.7895,25.2632 L20.2105,25.2632 C18.9983,26.3533 17.5404,26.9474 16,26.9474 C14.4596,26.9474 13.0017,26.3533 11.7895,25.2632 Z" fill="rgb(177,106,78)" opacity="1"/><path d="M28.6316,16.8421 C26.6486,16.1578 24.9404,14.9847 23.5789,13.4737 C21.9083,11.6195 20.7984,9.295 20.2105,6.7368 C17.1659,7.2959 14.3213,8.4421 11.7895,10.1053 C9.1324,11.8507 6.863,14.1366 5.0526,16.8421 L5.0526,13.4737 L1.6842,15.1579 C1.7903,11.9326 3.0329,9.0321 5.0526,6.7368 C7.8409,3.5681 11.8054,1.7472 15.9912,1.6842 C20.337,1.6188 24.4548,3.4038 26.9474,6.7368 C29.048,9.5458 29.7692,13.196 28.6316,16.8421 Z" fill="rgb(163,138,98)" opacity="1"/><path d="M0,0 L32,0 L32,32 L0,32 L0,0 Z" fill="transparent" opacity="1"/></g><g><path d="M11.7895,15.6303 C13.0177,14.5867 14.4724,14.0218 15.9996,14.0217 C17.527,14.0216 18.982,14.5867 20.2105,15.6303 L20.2105,19.3684 C18.9702,18.3599 17.5176,17.8166 15.9996,17.8166 C14.4818,17.8167 13.0295,18.36 11.7895,19.3684 L11.7895,15.6303 Z" fill="rgb(139,188,199)" opacity="0.25"/><path d="M11.7895,16.1677 C13.0177,15.1241 14.4724,14.5591 15.9996,14.559 C17.527,14.559 18.982,15.124 20.2105,16.1677 L20.2105,18.8974 C18.9702,17.8889 17.5176,17.3455 15.9996,17.3456 C14.4818,17.3457 13.0295,17.889 11.7895,18.8974 L11.7895,16.1677 Z" fill="rgb(139,188,199)" opacity="0.25"/><path d="M0,17.6842 C-0.0061,13.4901 3.3754,10.1007 7.579,10.1053 C11.7718,10.1099 15.1579,13.4921 15.1579,17.6842 C15.1579,21.8763 11.7718,25.2586 7.579,25.2632 C3.3754,25.2678 -0.0061,21.8783 0,17.6842 Z" fill="rgb(139,188,199)" opacity="0.25"/><path d="M0.8106,17.6713 C0.8052,13.9329 3.8193,10.9118 7.5661,10.9159 C11.3033,10.92 14.3215,13.9347 14.3215,17.6713 C14.3215,21.408 11.3033,24.4227 7.5661,24.4268 C3.8193,24.4309 0.8052,21.4098 0.8106,17.6713 Z" fill="rgb(139,188,199)" opacity="0.25"/><path d="M16.8421,17.6842 C16.836,13.4901 20.2175,10.1007 24.4211,10.1053 C28.6139,10.1099 32,13.4921 32,17.6842 C32,21.8763 28.6139,25.2586 24.4211,25.2632 C20.2175,25.2678 16.836,21.8783 16.8421,17.6842 Z" fill="rgb(139,188,199)" opacity="0.25"/><path d="M17.6529,17.6884 C17.6474,13.9406 20.6691,10.9119 24.4253,10.9161 C28.1718,10.9202 31.1976,13.9425 31.1976,17.6884 C31.1976,21.4344 28.1718,24.4567 24.4253,24.4608 C20.6691,24.4649 17.6474,21.4362 17.6529,17.6884 Z" fill="rgb(139,188,199)" opacity="0.25"/></g><g><path d="M3.3684,17.6842 C3.365,15.3541 5.2436,13.4711 7.5789,13.4737 C9.9083,13.4762 11.7895,15.3553 11.7895,17.6842 C11.7895,20.0132 9.9083,21.8922 7.5789,21.8947 C5.2436,21.8973 3.365,20.0143 3.3684,17.6842 Z" fill="url(#gradient8402)" opacity="1"/><path d="M11.7895,17.6842 C11.7689,18.8663 11.3058,19.9267 10.5205,20.6986 C9.7316,21.4741 8.6704,21.9135 7.5789,21.8947 C6.2141,21.8713 4.933,21.1275 3.9665,19.9122 C4.5203,17.711 5.8388,16.1239 7.7575,15.8009 C9.3434,15.5339 10.8079,16.2352 11.7895,17.6842 Z" fill="url(#gradient8403)" opacity="1"/><path d="M28.6184,17.6865 C28.6218,15.3565 26.7432,13.4735 24.4079,13.476 C22.0785,13.4786 20.1973,15.3576 20.1973,17.6865 C20.1973,20.0155 22.0785,21.8945 24.4079,21.8971 C26.7432,21.8996 28.6218,20.0166 28.6184,17.6865 Z" fill="url(#gradient8404)" opacity="1"/><path d="M20.1973,17.6865 C20.2179,18.8686 20.681,19.929 21.4663,20.7009 C22.2552,21.4764 23.3164,21.9158 24.4079,21.8971 C25.7727,21.8736 27.0538,21.1298 28.0203,19.9145 C27.5995,17.8066 26.3959,16.2603 24.5306,15.8547 C22.8604,15.4915 21.2982,16.1926 20.1973,17.6865 Z" fill="url(#gradient8405)" opacity="1"/><path d="M11.7895,16.6748 C12.9924,15.6357 14.4272,15.0732 15.9325,15.0625 C17.4781,15.0514 18.9566,15.6216 20.2105,16.6748 L20.2105,18.6375 C19.0071,17.4884 17.5358,16.8573 15.9714,16.8624 C14.4238,16.8674 12.971,17.4951 11.7895,18.6375 L11.7895,16.6748 Z" fill="rgb(255,255,255)" opacity="1"/><path d="M1.6842,17.6842 C1.6795,14.4221 4.3095,11.7859 7.579,11.7895 C10.84,11.7931 13.4737,14.4237 13.4737,17.6842 C13.4737,20.9447 10.84,23.5754 7.579,23.5789 C4.3095,23.5825 1.6795,20.9463 1.6842,17.6842 Z" fill="rgb(255,255,255)" opacity="1"/><path d="M18.5263,17.6842 C18.5216,14.4221 21.1516,11.7859 24.4211,11.7895 C27.6821,11.7931 30.3158,14.4237 30.3158,17.6842 C30.3158,20.9447 27.6821,23.5754 24.4211,23.5789 C21.1516,23.5825 18.5216,20.9463 18.5263,17.6842 Z" fill="rgb(255,255,255)" opacity="1"/><path d="M3.5526,17.6842 C3.5494,15.4561 5.3458,13.6554 7.5789,13.6579 C9.8064,13.6603 11.6053,15.4572 11.6053,17.6842 C11.6053,19.9113 9.8064,21.7081 7.5789,21.7106 C5.3458,21.713 3.5494,19.9124 3.5526,17.6842 Z" fill="url(#gradient8409)" opacity="1"/><path d="M11.6053,17.6842 C11.5856,18.8146 11.1428,19.8286 10.3918,20.5667 C9.6374,21.3083 8.6227,21.7285 7.5789,21.7106 C6.2738,21.6882 5.0488,20.9769 4.1246,19.8147 C4.6541,17.7098 5.915,16.1922 7.7497,15.8833 C9.2662,15.628 10.6667,16.2986 11.6053,17.6842 Z" fill="url(#gradient8410)" opacity="1"/><path d="M28.4342,17.6866 C28.4375,15.4584 26.641,13.6578 24.4079,13.6602 C22.1804,13.6627 20.3816,15.4595 20.3816,17.6866 C20.3816,19.9136 22.1804,21.7104 24.4079,21.7129 C26.641,21.7153 28.4375,19.9147 28.4342,17.6866 Z" fill="url(#gradient8411)" opacity="1"/><path d="M20.3816,17.6866 C20.4012,18.8169 20.8441,19.8309 21.595,20.5691 C22.3494,21.3106 23.3641,21.7308 24.4079,21.7129 C25.713,21.6905 26.9381,20.9792 27.8623,19.8171 C27.4599,17.8014 26.309,16.3227 24.5252,15.9348 C22.9281,15.5875 21.4342,16.258 20.3816,17.6866 Z" fill="url(#gradient8412)" opacity="1"/></g><g><path d="M8.4211,15.1579 C9.3531,15.1565 10.1063,15.908 10.1053,16.8421 C10.1042,17.7738 9.3526,18.5263 8.4211,18.5263 C7.4895,18.5263 6.7379,17.7738 6.7368,16.8421 C6.7358,15.908 7.489,15.1565 8.4211,15.1579 Z" fill="rgb(20,30,36)" opacity="0.1"/><path d="M23.5789,15.1579 C24.511,15.1565 25.2642,15.908 25.2632,16.8421 C25.2621,17.7738 24.5105,18.5263 23.5789,18.5263 C22.6474,18.5263 21.8958,17.7738 21.8947,16.8421 C21.8937,15.908 22.6469,15.1565 23.5789,15.1579 Z" fill="rgb(20,30,36)" opacity="0.1"/></g></svg>
```

### ui\assets\images\mode-dark-32.svg

```
<svg viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg"><defs><linearGradient x1="7.5789" y1="13.4737" x2="7.4331" y2="20.8984" id="gradient6390" gradientUnits="userSpaceOnUse"><stop offset="0%" stop-color="rgb(20,30,36)"/><stop offset="100%" stop-color="rgb(233,108,76)"/></linearGradient><linearGradient x1="7.5789" y1="13.4737" x2="7.5495" y2="17.6962" id="gradient6391" gradientUnits="userSpaceOnUse"><stop offset="0%" stop-color="rgb(20,30,36)"/><stop offset="100%" stop-color="rgb(233,108,76)"/></linearGradient><linearGradient x1="24.4079" y1="13.476" x2="24.5537" y2="20.9008" id="gradient6392" gradientUnits="userSpaceOnUse"><stop offset="0%" stop-color="rgb(20,30,36)"/><stop offset="100%" stop-color="rgb(233,108,76)"/></linearGradient><linearGradient x1="24.4079" y1="13.476" x2="24.4373" y2="17.6985" id="gradient6393" gradientUnits="userSpaceOnUse"><stop offset="0%" stop-color="rgb(20,30,36)"/><stop offset="100%" stop-color="rgb(233,108,76)"/></linearGradient><linearGradient x1="7.5789" y1="13.6579" x2="7.4395" y2="20.7578" id="gradient6397" gradientUnits="userSpaceOnUse"><stop offset="0%" stop-color="rgb(20,30,36)"/><stop offset="100%" stop-color="rgb(233,108,76)"/></linearGradient><linearGradient x1="7.5789" y1="13.6579" x2="7.5508" y2="17.6956" id="gradient6398" gradientUnits="userSpaceOnUse"><stop offset="0%" stop-color="rgb(20,30,36)"/><stop offset="100%" stop-color="rgb(233,108,76)"/></linearGradient><linearGradient x1="24.4079" y1="13.6602" x2="24.5474" y2="20.7602" id="gradient6399" gradientUnits="userSpaceOnUse"><stop offset="0%" stop-color="rgb(20,30,36)"/><stop offset="100%" stop-color="rgb(233,108,76)"/></linearGradient><linearGradient x1="24.4079" y1="13.6602" x2="24.436" y2="17.698" id="gradient6400" gradientUnits="userSpaceOnUse"><stop offset="0%" stop-color="rgb(20,30,36)"/><stop offset="100%" stop-color="rgb(233,108,76)"/></linearGradient></defs><g><path d="M0,0 L32,0 L32,32 L0,32 L0,0 Z" fill="transparent" opacity="1"/></g><g><path d="M3.3684,30.3158 L3.3684,13.4737 C3.3684,6.6724 8.5985,2.0905 15.1579,1.6842 C22.5596,1.2258 28.6316,6.0712 28.6316,13.4737 L28.6316,30.3158 L3.3684,30.3158 Z" fill="rgb(49,110,125)" opacity="1"/><path d="M5.0526,30.3158 L5.0526,13.4737 C5.0526,10.4222 6.3833,7.7114 8.5963,5.8071 C10.3867,4.2664 12.6554,3.3729 15.1579,3.3684 C13.4661,3.8254 12.0442,4.7839 10.9436,6.0738 C9.2686,8.0367 8.4211,10.6567 8.4211,13.4737 L8.4211,20.2105 C10.4769,18.579 12.7566,17.3494 15.1579,16.8421 C16.8305,16.4888 18.5379,16.4888 20.2105,16.8421 C22.6118,17.3494 24.8915,18.579 26.9474,20.2105 L26.9474,30.3158 L5.0526,30.3158 Z" fill="rgb(20,30,36)" opacity="1"/><path d="M10.1053,28.0702 C10.1053,27.3994 10.5842,26.9474 11.177,26.9474 C11.7699,26.9474 12.2488,27.3994 12.2488,28.0702 L12.2488,29.193 C12.2488,29.8637 11.7699,30.3158 11.177,30.3158 C10.5842,30.3158 10.1053,29.8637 10.1053,29.193 L10.1053,28.0702 Z" fill="rgb(139,188,199)" opacity="1"/><path d="M13.3206,28.0702 C13.3206,27.3994 13.7995,26.9474 14.3923,26.9474 C14.9852,26.9474 15.4641,27.3994 15.4641,28.0702 L15.4641,29.193 C15.4641,29.8637 14.9852,30.3158 14.3923,30.3158 C13.7995,30.3158 13.3206,29.8637 13.3206,29.193 L13.3206,28.0702 Z" fill="rgb(139,188,199)" opacity="1"/><path d="M16.5359,28.0702 C16.5359,27.3994 17.0148,26.9474 17.6077,26.9474 C18.2005,26.9474 18.6794,27.3994 18.6794,28.0702 L18.6794,29.193 C18.6794,29.8637 18.2005,30.3158 17.6077,30.3158 C17.0148,30.3158 16.5359,29.8637 16.5359,29.193 L16.5359,28.0702 Z" fill="rgb(139,188,199)" opacity="1"/><path d="M19.7512,28.0702 C19.7512,27.3994 20.2301,26.9474 20.823,26.9474 C21.4158,26.9474 21.8947,27.3994 21.8947,28.0702 L21.8947,29.193 C21.8947,29.8637 21.4158,30.3158 20.823,30.3158 C20.2301,30.3158 19.7512,29.8637 19.7512,29.193 L19.7512,28.0702 Z" fill="rgb(139,188,199)" opacity="1"/></g><g><path d="M11.7895,15.6303 C13.0177,14.5867 14.4724,14.0218 15.9996,14.0217 C17.527,14.0216 18.982,14.5867 20.2105,15.6303 L20.2105,19.3684 C18.9702,18.3599 17.5176,17.8166 15.9996,17.8166 C14.4818,17.8167 13.0295,18.36 11.7895,19.3684 L11.7895,15.6303 Z" fill="rgb(233,108,76)" opacity="0.25"/><path d="M11.7895,16.1677 C13.0177,15.1241 14.4724,14.5591 15.9996,14.559 C17.527,14.559 18.982,15.124 20.2105,16.1677 L20.2105,18.8974 C18.9702,17.8889 17.5176,17.3455 15.9996,17.3456 C14.4818,17.3457 13.0295,17.889 11.7895,18.8974 L11.7895,16.1677 Z" fill="rgb(233,108,76)" opacity="0.25"/><path d="M0,17.6842 C-0.0061,13.4901 3.3754,10.1007 7.579,10.1053 C11.7718,10.1099 15.1579,13.4921 15.1579,17.6842 C15.1579,21.8763 11.7718,25.2586 7.579,25.2632 C3.3754,25.2678 -0.0061,21.8783 0,17.6842 Z" fill="rgb(233,108,76)" opacity="0.25"/><path d="M0.8106,17.6713 C0.8052,13.9329 3.8193,10.9118 7.5661,10.9159 C11.3033,10.92 14.3215,13.9347 14.3215,17.6713 C14.3215,21.408 11.3033,24.4227 7.5661,24.4268 C3.8193,24.4309 0.8052,21.4098 0.8106,17.6713 Z" fill="rgb(233,108,76)" opacity="0.25"/><path d="M16.8421,17.6842 C16.836,13.4901 20.2175,10.1007 24.4211,10.1053 C28.6139,10.1099 32,13.4921 32,17.6842 C32,21.8763 28.6139,25.2586 24.4211,25.2632 C20.2175,25.2678 16.836,21.8783 16.8421,17.6842 Z" fill="rgb(233,108,76)" opacity="0.25"/><path d="M17.6529,17.6884 C17.6474,13.9406 20.6691,10.9119 24.4253,10.9161 C28.1718,10.9202 31.1976,13.9425 31.1976,17.6884 C31.1976,21.4344 28.1718,24.4567 24.4253,24.4608 C20.6691,24.4649 17.6474,21.4362 17.6529,17.6884 Z" fill="rgb(233,108,76)" opacity="0.25"/></g><g><path d="M3.3684,17.6842 C3.365,15.3541 5.2436,13.4711 7.5789,13.4737 C9.9083,13.4762 11.7895,15.3553 11.7895,17.6842 C11.7895,20.0132 9.9083,21.8922 7.5789,21.8947 C5.2436,21.8973 3.365,20.0143 3.3684,17.6842 Z" fill="url(#gradient6390)" opacity="1"/><path d="M11.7895,17.6842 C11.7689,18.8663 11.3058,19.9267 10.5205,20.6986 C9.7316,21.4741 8.6704,21.9135 7.5789,21.8947 C6.2141,21.8713 4.933,21.1275 3.9665,19.9122 C4.5203,17.711 5.8388,16.1239 7.7575,15.8009 C9.3434,15.5339 10.8079,16.2352 11.7895,17.6842 Z" fill="url(#gradient6391)" opacity="1"/><path d="M28.6184,17.6865 C28.6218,15.3565 26.7432,13.4735 24.4079,13.476 C22.0785,13.4786 20.1973,15.3576 20.1973,17.6865 C20.1973,20.0155 22.0785,21.8945 24.4079,21.8971 C26.7432,21.8996 28.6218,20.0166 28.6184,17.6865 Z" fill="url(#gradient6392)" opacity="1"/><path d="M20.1973,17.6865 C20.2179,18.8686 20.681,19.929 21.4663,20.7009 C22.2552,21.4764 23.3164,21.9158 24.4079,21.8971 C25.7727,21.8736 27.0538,21.1298 28.0203,19.9145 C27.5995,17.8066 26.3959,16.2603 24.5306,15.8547 C22.8604,15.4915 21.2982,16.1926 20.1973,17.6865 Z" fill="url(#gradient6393)" opacity="1"/><path d="M11.7895,16.6748 C12.9924,15.6357 14.4272,15.0732 15.9325,15.0625 C17.4781,15.0514 18.9566,15.6216 20.2105,16.6748 L20.2105,18.6375 C19.0071,17.4884 17.5358,16.8573 15.9714,16.8624 C14.4238,16.8674 12.971,17.4951 11.7895,18.6375 L11.7895,16.6748 Z" fill="rgb(255,255,255)" opacity="1"/><path d="M1.6842,17.6842 C1.6795,14.4221 4.3095,11.7859 7.579,11.7895 C10.84,11.7931 13.4737,14.4237 13.4737,17.6842 C13.4737,20.9447 10.84,23.5754 7.579,23.5789 C4.3095,23.5825 1.6795,20.9463 1.6842,17.6842 Z" fill="rgb(255,255,255)" opacity="1"/><path d="M18.5263,17.6842 C18.5216,14.4221 21.1516,11.7859 24.4211,11.7895 C27.6821,11.7931 30.3158,14.4237 30.3158,17.6842 C30.3158,20.9447 27.6821,23.5754 24.4211,23.5789 C21.1516,23.5825 18.5216,20.9463 18.5263,17.6842 Z" fill="rgb(255,255,255)" opacity="1"/><path d="M3.5526,17.6842 C3.5494,15.4561 5.3458,13.6554 7.5789,13.6579 C9.8064,13.6603 11.6053,15.4572 11.6053,17.6842 C11.6053,19.9113 9.8064,21.7081 7.5789,21.7106 C5.3458,21.713 3.5494,19.9124 3.5526,17.6842 Z" fill="url(#gradient6397)" opacity="1"/><path d="M11.6053,17.6842 C11.5856,18.8146 11.1428,19.8286 10.3918,20.5667 C9.6374,21.3083 8.6227,21.7285 7.5789,21.7106 C6.2738,21.6882 5.0488,20.9769 4.1246,19.8147 C4.6541,17.7098 5.915,16.1922 7.7497,15.8833 C9.2662,15.628 10.6667,16.2986 11.6053,17.6842 Z" fill="url(#gradient6398)" opacity="1"/><path d="M28.4342,17.6866 C28.4375,15.4584 26.641,13.6578 24.4079,13.6602 C22.1804,13.6627 20.3816,15.4595 20.3816,17.6866 C20.3816,19.9136 22.1804,21.7104 24.4079,21.7129 C26.641,21.7153 28.4375,19.9147 28.4342,17.6866 Z" fill="url(#gradient6399)" opacity="1"/><path d="M20.3816,17.6866 C20.4012,18.8169 20.8441,19.8309 21.595,20.5691 C22.3494,21.3106 23.3641,21.7308 24.4079,21.7129 C25.713,21.6905 26.9381,20.9792 27.8623,19.8171 C27.4599,17.8014 26.309,16.3227 24.5252,15.9348 C22.9281,15.5875 21.4342,16.258 20.3816,17.6866 Z" fill="url(#gradient6400)" opacity="1"/></g><g><path d="M8.4211,15.1579 C9.3531,15.1565 10.1063,15.908 10.1053,16.8421 C10.1042,17.7738 9.3526,18.5263 8.4211,18.5263 C7.4895,18.5263 6.7379,17.7738 6.7368,16.8421 C6.7358,15.908 7.489,15.1565 8.4211,15.1579 Z" fill="rgb(20,30,36)" opacity="0.1"/><path d="M23.5789,15.1579 C24.511,15.1565 25.2642,15.908 25.2632,16.8421 C25.2621,17.7738 24.5105,18.5263 23.5789,18.5263 C22.6474,18.5263 21.8958,17.7738 21.8947,16.8421 C21.8937,15.908 22.6469,15.1565 23.5789,15.1579 Z" fill="rgb(20,30,36)" opacity="0.1"/></g></svg>
```

### ui\assets\images\mobile-icon-40x64.svg

```
<svg viewBox="0 0 40 64" xmlns="http://www.w3.org/2000/svg"><defs><linearGradient x1="25" y1="0" x2="25" y2="64" id="gradient690" gradientUnits="userSpaceOnUse"><stop offset="0%" stop-color="rgb(139,188,199)"/><stop offset="100%" stop-color="rgb(49,110,125)"/></linearGradient><linearGradient x1="25" y1="4" x2="25" y2="60" id="gradient692" gradientUnits="userSpaceOnUse"><stop offset="0%" stop-color="rgb(49,110,125)"/><stop offset="100%" stop-color="rgb(0,0,0)"/></linearGradient><linearGradient x1="16.5789" y1="27.8194" x2="16.4331" y2="35.2442" id="gradient707" gradientUnits="userSpaceOnUse"><stop offset="0%" stop-color="rgb(20,30,36)"/><stop offset="100%" stop-color="rgb(233,108,76)"/></linearGradient><linearGradient x1="16.5789" y1="27.8194" x2="16.5495" y2="32.0419" id="gradient708" gradientUnits="userSpaceOnUse"><stop offset="0%" stop-color="rgb(20,30,36)"/><stop offset="100%" stop-color="rgb(233,108,76)"/></linearGradient><linearGradient x1="33.4079" y1="27.8217" x2="33.5537" y2="35.2465" id="gradient709" gradientUnits="userSpaceOnUse"><stop offset="0%" stop-color="rgb(20,30,36)"/><stop offset="100%" stop-color="rgb(233,108,76)"/></linearGradient><linearGradient x1="33.4079" y1="27.8217" x2="33.4373" y2="32.0442" id="gradient710" gradientUnits="userSpaceOnUse"><stop offset="0%" stop-color="rgb(20,30,36)"/><stop offset="100%" stop-color="rgb(233,108,76)"/></linearGradient><linearGradient x1="16.5789" y1="28.0036" x2="16.4395" y2="35.1036" id="gradient714" gradientUnits="userSpaceOnUse"><stop offset="0%" stop-color="rgb(20,30,36)"/><stop offset="100%" stop-color="rgb(233,108,76)"/></linearGradient><linearGradient x1="16.5789" y1="28.0036" x2="16.5508" y2="32.0414" id="gradient715" gradientUnits="userSpaceOnUse"><stop offset="0%" stop-color="rgb(20,30,36)"/><stop offset="100%" stop-color="rgb(233,108,76)"/></linearGradient><linearGradient x1="33.4079" y1="28.006" x2="33.5474" y2="35.1059" id="gradient716" gradientUnits="userSpaceOnUse"><stop offset="0%" stop-color="rgb(20,30,36)"/><stop offset="100%" stop-color="rgb(233,108,76)"/></linearGradient><linearGradient x1="33.4079" y1="28.006" x2="33.436" y2="32.0437" id="gradient717" gradientUnits="userSpaceOnUse"><stop offset="0%" stop-color="rgb(20,30,36)"/><stop offset="100%" stop-color="rgb(233,108,76)"/></linearGradient></defs><g><path d="M10,4.4365e-15 L30,5.9153e-15 C35.9667,6.3565e-15 40,4.0333 40,10 L40,54 C40,59.9667 35.9667,64 30,64 L10,64 C4.0333,64 1.3657e-14,59.9667 1.1831e-14,54 L0,10 C-1.0961e-15,4.0333 4.0333,5.1672e-15 10,4.4365e-15 Z" fill="url(#gradient690)" opacity="1"/><path d="M10,2 L30,2 C34.7733,2 38,5.2267 38,10 L38,54 C38,58.7733 34.7733,62 30,62 L10,62 C5.2267,62 2,58.7733 2,54 L2,10 C2,5.2267 5.2267,2 10,2 Z" fill="rgb(0,0,0)" opacity="1"/><path d="M10,4 L30,4 C33.58,4 36,6.42 36,10 L36,54 C36,57.58 33.58,60 30,60 L10,60 C6.42,60 4,57.58 4,54 L4,10 C4,6.42 6.42,4 10,4 Z" fill="url(#gradient692)" opacity="1"/><path d="M16,6 L24,6 C25.9649,6 25.9649,9 24,9 L16,9 C14.0351,9 14.0351,6 16,6 Z" fill="rgb(0,0,0)" opacity="1"/></g><g><g><path d="M7.3684,44.6615 L7.3684,27.8194 C7.3684,21.0181 12.5985,16.4362 19.1579,16.0299 C26.5596,15.5715 32.6316,20.417 32.6316,27.8194 L32.6316,44.6615 L7.3684,44.6615 Z" fill="rgb(49,110,125)" opacity="1"/><path d="M9.0526,44.6615 L9.0526,27.8194 C9.0526,24.7679 10.3833,22.0571 12.5963,20.1528 C14.3867,18.6122 16.6554,17.7186 19.1579,17.7142 C17.4661,18.1712 16.0442,19.1297 14.9436,20.4195 C13.2686,22.3825 12.4211,25.0024 12.4211,27.8194 L12.4211,34.5563 C14.4769,32.9247 16.7566,31.6951 19.1579,31.1878 C20.8305,30.8345 22.5379,30.8345 24.2105,31.1878 C26.6118,31.6951 28.8915,32.9247 30.9474,34.5563 L30.9474,44.6615 L9.0526,44.6615 Z" fill="rgb(20,30,36)" opacity="1"/><path d="M14.1053,42.4159 C14.1053,41.7451 14.5842,41.2931 15.177,41.2931 C15.7699,41.2931 16.2488,41.7451 16.2488,42.4159 L16.2488,43.5387 C16.2488,44.2095 15.7699,44.6615 15.177,44.6615 C14.5842,44.6615 14.1053,44.2095 14.1053,43.5387 L14.1053,42.4159 Z" fill="rgb(139,188,199)" opacity="1"/><path d="M17.3206,42.4159 C17.3206,41.7451 17.7995,41.2931 18.3923,41.2931 C18.9852,41.2931 19.4641,41.7451 19.4641,42.4159 L19.4641,43.5387 C19.4641,44.2095 18.9852,44.6615 18.3923,44.6615 C17.7995,44.6615 17.3206,44.2095 17.3206,43.5387 L17.3206,42.4159 Z" fill="rgb(139,188,199)" opacity="1"/><path d="M20.5359,42.4159 C20.5359,41.7451 21.0148,41.2931 21.6077,41.2931 C22.2005,41.2931 22.6794,41.7451 22.6794,42.4159 L22.6794,43.5387 C22.6794,44.2095 22.2005,44.6615 21.6077,44.6615 C21.0148,44.6615 20.5359,44.2095 20.5359,43.5387 L20.5359,42.4159 Z" fill="rgb(139,188,199)" opacity="1"/><path d="M23.7512,42.4159 C23.7512,41.7451 24.2301,41.2931 24.823,41.2931 C25.4158,41.2931 25.8947,41.7451 25.8947,42.4159 L25.8947,43.5387 C25.8947,44.2095 25.4158,44.6615 24.823,44.6615 C24.2301,44.6615 23.7512,44.2095 23.7512,43.5387 L23.7512,42.4159 Z" fill="rgb(139,188,199)" opacity="1"/><path d="M15.7895,29.9761 C17.0177,28.9325 18.4724,28.3675 19.9996,28.3674 C21.527,28.3674 22.982,28.9324 24.2105,29.9761 L24.2105,33.7142 C22.9702,32.7056 21.5176,32.1623 19.9996,32.1624 C18.4818,32.1624 17.0295,32.7057 15.7895,33.7142 L15.7895,29.9761 Z" fill="rgb(233,108,76)" opacity="0.25"/><path d="M15.7895,30.5134 C17.0177,29.4698 18.4724,28.9048 19.9996,28.9048 C21.527,28.9047 22.982,29.4697 24.2105,30.5134 L24.2105,33.2431 C22.9702,32.2346 21.5176,31.6913 19.9996,31.6913 C18.4818,31.6914 17.0295,32.2347 15.7895,33.2431 L15.7895,30.5134 Z" fill="rgb(233,108,76)" opacity="0.25"/><path d="M4,32.0299 C3.9939,27.8358 7.3754,24.4464 11.579,24.451 C15.7718,24.4556 19.1579,27.8378 19.1579,32.0299 C19.1579,36.222 15.7718,39.6043 11.579,39.6089 C7.3754,39.6135 3.9939,36.2241 4,32.0299 Z" fill="rgb(233,108,76)" opacity="0.25"/><path d="M4.8106,32.0171 C4.8052,28.2787 7.8193,25.2575 11.5661,25.2616 C15.3033,25.2657 18.3215,28.2805 18.3215,32.0171 C18.3215,35.7537 15.3033,38.7684 11.5661,38.7725 C7.8193,38.7766 4.8052,35.7555 4.8106,32.0171 Z" fill="rgb(233,108,76)" opacity="0.25"/><path d="M20.8421,32.0299 C20.836,27.8358 24.2175,24.4464 28.4211,24.451 C32.6139,24.4556 36,27.8378 36,32.0299 C36,36.222 32.6139,39.6043 28.4211,39.6089 C24.2175,39.6135 20.836,36.2241 20.8421,32.0299 Z" fill="rgb(233,108,76)" opacity="0.25"/><path d="M21.6529,32.0341 C21.6474,28.2864 24.6691,25.2577 28.4253,25.2618 C32.1718,25.2659 35.1976,28.2882 35.1976,32.0341 C35.1976,35.7801 32.1718,38.8024 28.4253,38.8065 C24.6691,38.8106 21.6474,35.7819 21.6529,32.0341 Z" fill="rgb(233,108,76)" opacity="0.25"/><path d="M7.3684,32.0299 C7.365,29.6999 9.2436,27.8169 11.5789,27.8194 C13.9083,27.822 15.7895,29.701 15.7895,32.0299 C15.7895,34.3589 13.9083,36.2379 11.5789,36.2405 C9.2436,36.243 7.365,34.36 7.3684,32.0299 Z" fill="url(#gradient707)" opacity="1"/><path d="M15.7895,32.0299 C15.7689,33.212 15.3058,34.2724 14.5205,35.0443 C13.7316,35.8198 12.6704,36.2592 11.5789,36.2405 C10.2141,36.217 8.933,35.4733 7.9665,34.2579 C8.5203,32.0567 9.8388,30.4696 11.7575,30.1466 C13.3434,29.8796 14.8079,30.5809 15.7895,32.0299 Z" fill="url(#gradient708)" opacity="1"/><path d="M32.6184,32.0323 C32.6218,29.7022 30.7432,27.8192 28.4079,27.8218 C26.0785,27.8243 24.1973,29.7033 24.1973,32.0323 C24.1973,34.3612 26.0785,36.2402 28.4079,36.2428 C30.7432,36.2454 32.6218,34.3623 32.6184,32.0323 Z" fill="url(#gradient709)" opacity="1"/><path d="M24.1973,32.0323 C24.2179,33.2144 24.681,34.2748 25.4663,35.0466 C26.2552,35.8221 27.3164,36.2615 28.4079,36.2428 C29.7727,36.2194 31.0538,35.4756 32.0203,34.2602 C31.5995,32.1524 30.3959,30.606 28.5306,30.2004 C26.8604,29.8372 25.2982,30.5383 24.1973,32.0323 Z" fill="url(#gradient710)" opacity="1"/><path d="M15.7895,31.0206 C16.9924,29.9814 18.4272,29.419 19.9325,29.4082 C21.4781,29.3971 22.9566,29.9674 24.2105,31.0206 L24.2105,32.9833 C23.0071,31.8341 21.5358,31.203 19.9714,31.2081 C18.4238,31.2131 16.971,31.8408 15.7895,32.9833 L15.7895,31.0206 Z" fill="rgb(255,255,255)" opacity="1"/><path d="M5.6842,32.0299 C5.6795,28.7679 8.3095,26.1316 11.579,26.1352 C14.84,26.1388 17.4737,28.7694 17.4737,32.0299 C17.4737,35.2905 14.84,37.9211 11.579,37.9247 C8.3095,37.9283 5.6795,35.292 5.6842,32.0299 Z" fill="rgb(255,255,255)" opacity="1"/><path d="M22.5263,32.0299 C22.5216,28.7679 25.1516,26.1316 28.4211,26.1352 C31.6821,26.1388 34.3158,28.7694 34.3158,32.0299 C34.3158,35.2905 31.6821,37.9211 28.4211,37.9247 C25.1516,37.9283 22.5216,35.292 22.5263,32.0299 Z" fill="rgb(255,255,255)" opacity="1"/><path d="M7.5526,32.03 C7.5494,29.8018 9.3458,28.0012 11.5789,28.0036 C13.8064,28.0061 15.6053,29.8029 15.6053,32.03 C15.6053,34.257 13.8064,36.0539 11.5789,36.0563 C9.3458,36.0587 7.5494,34.2581 7.5526,32.03 Z" fill="url(#gradient714)" opacity="1"/><path d="M15.6053,32.03 C15.5856,33.1603 15.1428,34.1743 14.3918,34.9125 C13.6374,35.654 12.6227,36.0742 11.5789,36.0563 C10.2738,36.0339 9.0488,35.3226 8.1246,34.1605 C8.6541,32.0556 9.915,30.5379 11.7497,30.229 C13.2662,29.9737 14.6667,30.6443 15.6053,32.03 Z" fill="url(#gradient715)" opacity="1"/><path d="M32.4342,32.0323 C32.4375,29.8042 30.641,28.0035 28.4079,28.006 C26.1804,28.0084 24.3816,29.8052 24.3816,32.0323 C24.3816,34.2594 26.1804,36.0562 28.4079,36.0586 C30.641,36.0611 32.4375,34.2604 32.4342,32.0323 Z" fill="url(#gradient716)" opacity="1"/><path d="M24.3816,32.0323 C24.4012,33.1627 24.8441,34.1767 25.595,34.9148 C26.3494,35.6564 27.3641,36.0765 28.4079,36.0586 C29.713,36.0362 30.9381,35.325 31.8623,34.1628 C31.4599,32.1471 30.309,30.6684 28.5252,30.2805 C26.9281,29.9332 25.4342,30.6037 24.3816,32.0323 Z" fill="url(#gradient717)" opacity="1"/><path d="M12.4211,29.5036 C13.3531,29.5023 14.1063,30.2537 14.1053,31.1878 C14.1042,32.1196 13.3526,32.8721 12.4211,32.8721 C11.4895,32.8721 10.7379,32.1196 10.7368,31.1878 C10.7358,30.2537 11.489,29.5023 12.4211,29.5036 Z" fill="rgb(20,30,36)" opacity="0.1"/><path d="M27.5789,29.5036 C28.511,29.5023 29.2642,30.2537 29.2632,31.1878 C29.2621,32.1196 28.5105,32.8721 27.5789,32.8721 C26.6474,32.8721 25.8958,32.1196 25.8947,31.1878 C25.8937,30.2537 26.6469,29.5023 27.5789,29.5036 Z" fill="rgb(20,30,36)" opacity="0.1"/></g></g></svg>
```

### ui\assets\images\icon-apple-white.svg

```
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 842.3 1000.0" width="842.3" height="1000.0">
  <path fill="white" d="m 824.6,779.3 c -15.1,34.9 -33.0,67.0 -53.7,96.6 -28.2,40.3 -51.4,68.2 -69.2,83.7 -27.6,25.4 -57.2,38.4 -89.0,39.1 -22.7,0 -50.2,-6.4 -82.2,-19.6 -32.0,-13.0 -61.5,-19.5 -88.5,-19.5 -28.2,0 -58.5,6.4 -91.0,19.5 -32.4,13.1 -58.6,19.9 -78.6,20.6 -30.4,1.2 -60.7,-12.0 -91.0,-40.2 -19.3,-16.8 -43.4,-45.7 -72.4,-86.6 C 77.7,829.3 52.1,778.6 32.1,720.8 10.7,658.4 0,598.0 0,539.5 0,472.4 14.4,414.6 43.4,366.2 66.2,327.3 96.6,296.6 134.5,274.1 c 37.9,-22.5 78.9,-34.0 123.1,-34.7 24.1,0 55.8,7.4 95.2,22.1 39.2,14.7 64.4,22.2 75.5,22.2 8.2,0 36.2,-8.7 83.7,-26.1 44.9,-16.1 82.8,-22.8 113.8,-20.2 84.1,6.7 147.3,39.9 189.3,99.7 -75.2,45.5 -112.4,109.4 -111.7,191.3 0.6,63.8 23.8,116.9 69.3,159.0 20.6,19.5 43.6,34.6 69.2,45.4 -5.5,16.1 -11.4,31.5 -17.6,46.3 z M 631.7,20.0 c 0,50.0 -18.2,96.7 -54.6,139.9 -43.9,51.3 -97.1,81.0 -154.7,76.3 -0.7,-5.9 -1.1,-12.3 -1.1,-18.9 0,-48.0 20.9,-99.3 58.0,-141.4 C 497.6,54.6 521.2,37.0 549.7,22.9 578.3,9.0 605.2,1.3 630.6,0 c 0.7,6.6 1.0,13.3 1.0,20.0 z"/>
</svg>
```

### ui\assets\images\icon-android-dark.svg

```
<?xml version="1.0"?>
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="-147 -70 294 345">
<g fill="#a4c639">
<use stroke-width="14.4" xlink:href="#b" stroke="#000"/>
<use xlink:href="#a" transform="scale(-1,1)"/>
<g id="a" stroke="#000" stroke-width="7.2">
<rect rx="6.5" transform="rotate(29)" height="86" width="13" y="-86" x="14"/>
<rect id="c" rx="24" height="133" width="48" y="41" x="-143"/>
<use y="97" x="85" xlink:href="#c"/>
</g>
<g id="b">
<ellipse cy="41" rx="91" ry="84"/>
<rect rx="22" height="182" width="182" y="20" x="-91"/>
</g>
</g>
<g stroke="#000" stroke-width="7.2" fill="#000">
<path d="m-95 44.5h190"/><circle cx="-42" r="4"/><circle cx="42" r="4"/>
</g>
</svg>
```

### ui\assets\images\darkreader-type.svg

```
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1280 128"><g><path fill="#E96C4C" d="M0,0 L0,128 L53.2078,128 C72.3462,128 89.444,120.9515 101,108 C111.6887,96.0205 116.8942,79.7806 117,63 C117.1072,45.9986 112.0159,29.5347 101,18 C89.3172,5.767 71.7953,-4.7985e-15 52.2039,0 L0,0 Z M36,30 L52,30 C69.2284,30 80.5256,44.7128 81,63 C81.5012,82.3198 69.9123,98 52,98 L36,98 L36,30 Z" opacity="1"/><path fill="#E96C4C" d="M159,-2.4425e-15 L117,128 L156,128 L162,108 L210,108 L216,128 L254,128 L211,-2.4425e-15 L159,-2.4425e-15 Z M184,28 L187,28 L202,82 L170,82 L184,28 Z" opacity="1"/><path fill="#E96C4C" d="M265,0 L265,128 L301,128 L301.0314,90 L316,90 L335,128 L374.4275,128 L349,82 C354.0131,77.7882 357.9613,72.6552 361,67 C366.3816,56.9845 368.9223,45.8756 367.4,35 C366.3062,27.1856 363.2544,19.8198 358,14 C349.6636,4.7667 336.51,-3.5539e-15 322,0 L265,0 Z M301,27 L318,27 C323.2425,27 327.8843,29.2327 331,33 C333.9644,36.5843 335.3323,41.2953 335,46 C334.5594,52.2377 331.272,57.8447 326,61 C322.3296,63.1967 317.8529,64 313,64 L300.9961,64 L301,27 Z" opacity="1"/><path fill="#E96C4C" d="M389,0 L389,128 L422.4824,128 L422.4824,77 L435.4824,77 L465.4824,128 L505.4549,128 L463.4824,61 L501.4392,0 L464.4824,0 L433.4824,49 L422.4824,49 L422.4824,0 L389,0 Z" opacity="1"/><path fill="#E96C4C" d="M688,0 L688,128 L772,128 L772,98 L722,98 L722,79 L767,79 L767,49 L722,49 L722,30 L768.9882,30 L768.9882,0 L688,0 Z" opacity="1"/><path fill="#E96C4C" d="M1171,-6.9944e-15 L1171,128 L1207,128 L1207.0314,90 L1222,90 L1241,128 L1280.4275,128 L1255,82 C1260.0131,77.7882 1263.9613,72.6552 1267,67 C1272.3816,56.9845 1274.9223,45.8756 1273.4,35 C1272.3062,27.1856 1269.2544,19.8198 1264,14 C1255.6636,4.7667 1242.51,-1.0548e-14 1228,-6.9944e-15 L1171,-6.9944e-15 Z M1207,27 L1224,27 C1229.2425,27 1233.8843,29.2327 1237,33 C1239.9644,36.5843 1241.3323,41.2953 1241,46 C1240.5594,52.2377 1237.272,57.8447 1232,61 C1228.3296,63.1967 1223.8529,64 1219,64 L1206.9961,64 L1207,27 Z" opacity="1"/><path fill="#E96C4C" d="M565,1.1102e-15 L565,128 L601,128 L601.0314,90 L616,90 L635,128 L674.4275,128 L649,82 C654.0131,77.7882 657.9613,72.6552 661,67 C666.3816,56.9845 668.9223,45.8756 667.4,35 C666.3062,27.1856 663.2544,19.8198 658,14 C649.6636,4.7667 636.51,-2.4437e-15 622,1.1102e-15 L565,1.1102e-15 Z M601,27 L618,27 C623.2425,27 627.8843,29.2327 631,33 C633.9644,36.5843 635.3323,41.2953 635,46 C634.5594,52.2377 631.272,57.8447 626,61 C622.3296,63.1967 617.8529,64 613,64 L600.9961,64 L601,27 Z" opacity="1"/><path fill="#E96C4C" d="M822,3.3307e-15 L780,128 L819,128 L825,108 L873,108 L879,128 L917,128 L874,3.3307e-15 L822,3.3307e-15 Z M847,28 L850,28 L865,82 L833,82 L847,28 Z" opacity="1"/><path fill="#E96C4C" d="M930,5.4401e-15 L930,128 L983.2078,128 C1002.3462,128 1019.444,120.9515 1031,108 C1041.6887,96.0205 1046.8942,79.7806 1047,63 C1047.1072,45.9986 1042.0159,29.5347 1031,18 C1019.3172,5.767 1001.7953,6.416e-16 982.2039,5.4401e-15 L930,5.4401e-15 Z M966,30 L982,30 C999.2284,30 1010.5256,44.7128 1011,63 C1011.5012,82.3198 999.9123,98 982,98 L966,98 L966,30 Z" opacity="1"/><path fill="#E96C4C" d="M1066,2.2204e-16 L1066,128 L1150,128 L1150,98 L1100,98 L1100,79 L1145,79 L1145,49 L1100,49 L1100,30 L1146.9882,30 L1146.9882,2.2204e-16 L1066,2.2204e-16 Z" opacity="1"/></g></svg>
```

### ui\assets\images\birthday-icon.svg

```
<svg viewBox="0 0 256 256" xmlns="http://www.w3.org/2000/svg"><defs><linearGradient x1="539" y1="92" x2="6.2002" y2="199.6476" id="gradient1" gradientUnits="userSpaceOnUse"><stop offset="0%" stop-color="rgb(205, 151, 125)"/><stop offset="100%" stop-color="rgb(36, 23, 20)"/></linearGradient><linearGradient x1="338" y1="198" x2="22.0772" y2="204.7779" id="gradient2" gradientUnits="userSpaceOnUse"><stop offset="0%" stop-color="rgb(223, 196, 183)"/><stop offset="100%" stop-color="rgb(183, 105, 138)"/></linearGradient><linearGradient x1="246.5332" y1="147.2878" x2="-15.7599" y2="153.2643" id="gradient3" gradientUnits="userSpaceOnUse"><stop offset="0%" stop-color="rgb(223, 196, 183)"/><stop offset="100%" stop-color="rgb(183, 105, 138)"/></linearGradient><linearGradient x1="134.7558" y1="77.7098" x2="0" y2="201" id="gradient4" gradientUnits="userSpaceOnUse"><stop offset="0%" stop-color="rgb(223, 196, 183)"/><stop offset="100%" stop-color="rgb(183, 105, 138)"/></linearGradient></defs><g id="Layer_1"><path d="M9.2181,230.177 C6.7355,227.1983 5.8019,222.9922 5.1091,218.6716 C4.0773,212.2367 3.6869,205.6586 3.4654,198.9481 C2.8785,181.1664 3.3612,162.2332 3.4654,143.8866 C3.5376,131.1979 3.3365,118.7387 8.3963,109.3704 C12.0015,102.6952 17.8203,98.0357 24.9765,98.0357 L229.7526,98.0357 C237.2933,98.0357 243.2324,103.6433 247.1417,111.2446 C252.702,122.0559 253.1621,135.8245 253.3724,149.8268 C253.6063,165.3971 253.4444,180.9155 253.2969,196.4826 C253.1961,207.1183 253.0855,217.7327 249.1878,225.2461 C246.9609,229.5388 243.6585,232.7888 239.326,235.1079 C231.5408,239.2752 220.6966,240.1968 209.7407,240.8606 C181.4621,242.5738 152.1128,243.1084 123.2042,242.9824 C102.0915,242.8904 80.8438,242.2519 59.9353,241.249 C47.0862,240.6327 33.6506,239.5914 22.3672,236.7515 C16.997,235.3999 12.1584,233.7048 9.2181,230.177 Z" class="Curve" fill="url(#gradient1)"/><path d="M4,194 C46.8006,195.8315 89.6251,196.7605 132.4506,196.7161 C172.3737,196.6748 212.2937,195.7892 252.1878,194 L252.1878,207.149 C212.7706,209.2205 172.8423,210.7781 134.184,210.5833 C116.7026,210.4951 99.2178,210.0549 84,211 C80.9131,211.1917 77.9231,211.4242 75,212 C68.3064,213.3184 62.0279,216.4572 56,216 C50.9766,215.619 46.1753,212.7628 41,211 C35.5967,209.1595 29.8002,208.472 24,208 C17.6275,207.4815 11.2296,207.1664 4.8218,207.149 L4,194 Z" class="Curve" fill="url(#gradient2)"/><path d="M4,146 C45.2965,147.7332 86.6156,148.6001 127.9376,148.6001 C169.2595,148.6001 210.5787,147.7332 251.8751,146 L251.8751,159.0004 C241.2566,159.7947 230.6441,160.6181 220,161 C209.6465,161.3715 199.2451,161.6124 190,164 C184.4263,165.4394 179.2778,167.7062 174,168 C168.1573,168.3252 162.1929,166.2427 156,165 C147.3192,163.258 138.1629,163.1539 129,163 C103.4995,162.5718 77.8326,162.2994 52.0538,161.4125 C36.0269,160.8612 20.0032,160.0954 4,159.0004 L4,146 Z" class="Curve" fill="url(#gradient3)"/><path d="M24.9765,90.4439 L232.0278,90.4439 C244.9886,90.4439 253.7285,98.9429 254.7807,109.4234 C256.3494,125.0481 243.7193,136.3744 232.0278,132.1989 C224.7952,129.6158 220.18,119.2298 211.5502,114.1683 C204.0833,109.7888 194.4759,109.5927 186.5221,113.2193 C173.122,119.3292 165.9282,136.227 156.1386,138.1122 C143.2616,140.5918 128.1371,117.1349 109.1622,117.0152 C98.6017,116.9486 87.1906,124.3427 75.0329,130.3009 C62.6,136.394 49.9319,140.4989 40.9035,135.9948 C33.3561,132.2295 28.7525,122.2354 21.5636,119.8622 C17.2494,118.438 12.2799,119.6963 8.4683,118.1781 C0.4269,114.9754 -1.7227,103.9989 5.0015,96.5107 C8.9284,92.1377 16.0006,90.4439 24.9765,90.4439 Z" class="Curve" fill="url(#gradient4)"/><path d="M65.1355,62.7096 L87.6696,62.7096 L87.6696,90.4439 L65.1355,90.4439 L65.1355,62.7096 Z" class="Curve" fill="rgb(183, 105, 138)"/><path d="M117.1373,62.7096 L139.6714,62.7096 L139.6714,90.4439 L117.1373,90.4439 L117.1373,62.7096 Z" class="Curve" fill="rgb(205, 151, 125)"/><path d="M169.1391,62.7096 L191.6732,62.7096 L191.6732,90.4439 L169.1391,90.4439 L169.1391,62.7096 Z" class="Curve" fill="rgb(183, 105, 138)"/><path d="M41.2689,46.9125 C41.2391,26.4472 57.7392,9.9084 78.2505,9.9309 C98.7094,9.9533 115.2321,26.4571 115.2321,46.9125 C115.2321,67.368 98.7094,83.8717 78.2505,83.8941 C57.7392,83.9166 41.2391,67.3778 41.2689,46.9125 Z" class="Curve" fill="rgb(233,108,76)" opacity="0.2"/><path d="M143.9957,44.4471 C143.9658,23.9818 160.466,7.443 180.9773,7.4655 C201.4361,7.4879 217.9589,23.9916 217.9589,44.4471 C217.9589,64.9025 201.4361,81.4062 180.9773,81.4287 C160.466,81.4512 143.9658,64.9124 143.9957,44.4471 Z" class="Curve" fill="rgb(233,108,76)" opacity="0.2"/><path d="M89.7559,41.9816 C89.7261,21.5163 106.2262,4.9775 126.7376,5 C147.1964,5.0225 163.7192,21.5262 163.7192,41.9816 C163.7192,62.4371 147.1964,78.9408 126.7376,78.9632 C106.2262,78.9857 89.7261,62.4469 89.7559,41.9816 Z" class="Curve" fill="rgb(233,108,76)" opacity="0.3"/><path d="M128.4043,11.5745 C124.8117,18.0439 121.6114,24.6584 118.8707,31.5085 C115.7166,39.3919 112.9797,47.0642 115.4039,53.1759 C117.6205,58.7643 123.2753,62.2893 129.271,61.8429 C135.8421,61.3537 140.9816,56.5201 141.4048,50.5758 C141.8566,44.2284 135.5785,37.7973 131.8711,29.7751 C129.2755,24.1585 127.9783,17.9178 128.4043,11.5745 Z" class="Curve" fill="rgb(233,108,76)"/><path d="M129.6219,59.0623 C126.4689,58.9573 123.5591,55.9477 122.2063,51.6467 C119.9929,44.6096 122.9356,35.6444 128.8803,27.175 C128.5394,31.0913 129.3786,34.9704 131.105,38.2985 C132.7807,41.5287 135.3664,44.1578 136.296,47.1973 C138.2567,53.6086 134.6324,59.2292 129.6219,59.0623 Z" class="Curve" fill="rgb(245, 196, 80)"/><path d="M179.161,19.8211 C182.1647,25.2299 184.8404,30.7601 187.1319,36.4874 C189.7689,43.0784 192.0571,49.4931 190.0303,54.6029 C188.1771,59.2752 183.4493,62.2223 178.4364,61.8491 C172.9425,61.4401 168.6455,57.3989 168.2917,52.429 C167.9139,47.1221 173.1629,41.7453 176.2625,35.0381 C178.4327,30.3422 179.5172,25.1245 179.161,19.8211 Z" class="Curve" fill="rgb(233,108,76)"/><path d="M76.3975,21.9749 C79.265,27.1387 81.8195,32.4183 84.0071,37.886 C86.5247,44.1784 88.7092,50.3023 86.7743,55.1806 C85.005,59.6413 80.4914,62.4548 75.7057,62.0985 C70.4607,61.708 66.3584,57.8499 66.0207,53.1053 C65.66,48.0388 70.6712,42.9056 73.6303,36.5024 C75.7021,32.0192 76.7375,27.038 76.3975,21.9749 Z" class="Curve" fill="rgb(233,108,76)"/><path d="M178.4364,59.6753 C181.5173,59.5726 184.3607,56.6318 185.6826,52.429 C187.8454,45.5528 184.9699,36.7924 179.161,28.5165 C179.4941,32.3433 178.6741,36.1337 176.9872,39.3858 C175.3498,42.5423 172.8231,45.1113 171.9148,48.0813 C169.9989,54.3461 173.5404,59.8383 178.4364,59.6753 Z" class="Curve" fill="rgb(245, 196, 80)"/><path d="M76.6261,59.8103 C78.996,59.7313 81.1832,57.4691 82.2001,54.2362 C83.8638,48.9468 81.6519,42.208 77.1835,35.842 C77.4397,38.7857 76.8089,41.7014 75.5113,44.203 C74.2518,46.6311 72.3082,48.6072 71.6095,50.8918 C70.1357,55.7109 72.8599,59.9357 76.6261,59.8103 Z" class="Curve" fill="rgb(245, 196, 80)"/><path d="M191.6732,93.9106 L235.008,94.7773 C242.3983,94.9252 247.9717,99.9265 249.7418,106.9111 C251.126,112.3727 249.7568,118.1349 245.4083,122.5116 C244.8897,116.5409 241.8961,111.3723 237.6081,107.7778 C232.5678,103.5527 225.5762,101.7445 218.5407,99.9775 C209.6424,97.7427 200.6926,95.7007 191.6732,93.9106 Z" class="Curve" fill="rgb(223, 196, 183)"/><path d="M53.5879,94.7773 L19.7867,94.7773 C13.1091,94.7773 7.7519,98.6333 5.9196,104.311 C4.7909,107.8085 5.2524,111.5669 7.653,114.7114 C9.4777,110.6362 12.5854,107.4577 16.3199,105.1777 C21.6768,101.9074 28.5531,100.5017 35.3873,99.1108 C41.5069,97.8654 47.5097,96.1624 53.5879,94.7773 Z" class="Curve" fill="rgb(223, 196, 183)"/></g></svg>
```

### ui\connect\mock.ts

```
import type {ExtensionData, Theme, UserSettings} from '../../definitions';
import {ThemeEngine} from '../../generators/theme-engines';

export function getMockData(override = {} as Partial<ExtensionData>): ExtensionData {
    return Object.assign({
        isEnabled: true,
        isReady: true,
        isAllowedFileSchemeAccess: false,
        settings: {
            schemeVersion: 2,
            enabled: true,
            fetchNews: true,
            presets: [],
            theme: {
                mode: 1,
                brightness: 110,
                contrast: 90,
                grayscale: 20,
                sepia: 10,
                useFont: false,
                fontFamily: 'Segoe UI',
                textStroke: 0,
                engine: ThemeEngine.cssFilter,
                stylesheet: '',
                scrollbarColor: 'auto',
                styleSystemControls: true,
            } as Theme,
            customThemes: [],
            enabledFor: [],
            disabledFor: [],
            syncSitesFixes: false,
            enableContextMenus: false,
            enabledByDefault: true,
            changeBrowserTheme: false,
            enableForPDF: true,
            enableForProtectedPages: false,
            syncSettings: true,
            automation: {
                enabled: false,
                behavior: 'OnOff',
                mode: '',
            },
            previewNewDesign: false,
            previewNewestDesign: false,
            time: {
                activation: '18:00',
                deactivation: '9:00',
            },
            location: {
                latitude: 52.4237178,
                longitude: 31.021786,
            },
            detectDarkTheme: false,
        } as UserSettings,
        fonts: [
            'serif',
            'sans-serif',
            'monospace',
            'cursive',
            'fantasy',
            'system-ui',
        ],
        news: [],
        shortcuts: {
            'addSite': 'Alt+Shift+A',
            'toggle': 'Alt+Shift+D',
        },
        devtools: {
            dynamicFixesText: '',
            filterFixesText: '',
            staticThemesText: '',
        },
        colorScheme: {
            dark: {
                Default: {
                    backgroundColor: '#1e1e1e',
                    textColor: '#d4d4d4',
                },
            },
            light: {
                Default: {
                    backgroundColor: '#ffffff',
                    textColor: '#000000',
                },
            },
        },
        forcedScheme: null,
        activeTab: {
            id: 1,
            documentId: 'id',
            url: 'https://darkreader.org/',
            isProtected: false,
            isInDarkList: false,
            isInjected: true,
            isDarkThemeDetected: false,
        },
        uiHighlights: [],
    } as ExtensionData, override);
}

```

### ui\connect\connector.ts

```
import type {ExtensionData, ExtensionActions, Theme, UserSettings, DevToolsData, MessageUItoBG, MessageBGtoUI} from '../../definitions';
import {MessageTypeBGtoUI, MessageTypeUItoBG} from '../../utils/message';
import {isFirefox} from '../../utils/platform';

declare const browser: {
    commands: {
        update({name, shortcut}: chrome.commands.Command): Promise<void>;
        getAll(): Promise<chrome.commands.Command[]>;
    };
};

export default class Connector implements ExtensionActions {
    private changeSubscribers: Set<(data: ExtensionData) => void>;

    constructor() {
        this.changeSubscribers = new Set();
    }

    private async sendRequest<T>(type: MessageTypeUItoBG, data?: string): Promise<T> {
        return new Promise<T>((resolve, reject) => {
            chrome.runtime.sendMessage<MessageUItoBG>({type, data}, ({data, error}: MessageUItoBG) => {
                if (error) {
                    reject(error);
                } else {
                    resolve(data);
                }
            });
        });
    }

    private async firefoxSendRequestWithResponse<T>(type: MessageTypeUItoBG, data?: string): Promise<T> {
        return new Promise<T>((resolve, reject) => {
            const dataPort = chrome.runtime.connect({name: type});
            dataPort.onDisconnect.addListener(() => reject());
            dataPort.onMessage.addListener(({data, error}) => {
                if (error) {
                    reject(error);
                } else {
                    resolve(data);
                }
                dataPort.disconnect();
            });
            data && dataPort.postMessage({data});
        });
    }

    async getData(): Promise<ExtensionData> {
        if (isFirefox) {
            return await this.firefoxSendRequestWithResponse<ExtensionData>(MessageTypeUItoBG.GET_DATA);
        }
        return await this.sendRequest<ExtensionData>(MessageTypeUItoBG.GET_DATA);
    }

    async getDevToolsData(): Promise<DevToolsData> {
        if (isFirefox) {
            return await this.firefoxSendRequestWithResponse<DevToolsData>(MessageTypeUItoBG.GET_DEVTOOLS_DATA);
        }
        return await this.sendRequest<DevToolsData>(MessageTypeUItoBG.GET_DEVTOOLS_DATA);
    }

    private onChangesReceived = ({type, data}: MessageBGtoUI) => {
        if (type === MessageTypeBGtoUI.CHANGES) {
            this.changeSubscribers.forEach((callback) => callback(data));
        }
    };

    subscribeToChanges(callback: (data: ExtensionData) => void): void {
        this.changeSubscribers.add(callback);
        if (this.changeSubscribers.size === 1) {
            chrome.runtime.onMessage.addListener(this.onChangesReceived);
            chrome.runtime.sendMessage<MessageUItoBG>({type: MessageTypeUItoBG.SUBSCRIBE_TO_CHANGES});
        }
    }

    /**
     *
     * @param command The command to be updated
     * @param shortcut The new shortcut pattern after the operation completes
     */
    async setShortcut(command: string, shortcut: string): Promise<string | null> {
        if (isFirefox && typeof browser !== 'undefined' && browser.commands && browser.commands.update && browser.commands.getAll) {
            try {
                await browser.commands.update({name: command, shortcut});
            } catch {
                // Ignore this error
            }
            // Query the real shortcut to get the exact value displayed by Firefox on about:addons
            // or in case user has non-standard keyboard layout
            const commands = await browser.commands.getAll();
            const cmd = commands.find((cmd) => cmd.name === command);
            return cmd && cmd.shortcut || null;
        }
        return null;
    }

    changeSettings(settings: Partial<UserSettings>): void {
        chrome.runtime.sendMessage<MessageUItoBG>({type: MessageTypeUItoBG.CHANGE_SETTINGS, data: settings});
    }

    setTheme(theme: Partial<Theme>): void {
        chrome.runtime.sendMessage<MessageUItoBG>({type: MessageTypeUItoBG.SET_THEME, data: theme});
    }

    toggleActiveTab(): void {
        chrome.runtime.sendMessage<MessageUItoBG>({type: MessageTypeUItoBG.TOGGLE_ACTIVE_TAB, data: {}});
    }

    markNewsAsRead(ids: string[]): void {
        chrome.runtime.sendMessage<MessageUItoBG>({type: MessageTypeUItoBG.MARK_NEWS_AS_READ, data: ids});
    }

    markNewsAsDisplayed(ids: string[]): void {
        chrome.runtime.sendMessage<MessageUItoBG>({type: MessageTypeUItoBG.MARK_NEWS_AS_DISPLAYED, data: ids});
    }

    loadConfig(options: {local: boolean}): void {
        chrome.runtime.sendMessage<MessageUItoBG>({type: MessageTypeUItoBG.LOAD_CONFIG, data: options});
    }

    async applyDevDynamicThemeFixes(text: string): Promise<void> {
        if (isFirefox) {
            return await this.firefoxSendRequestWithResponse<void>(MessageTypeUItoBG.APPLY_DEV_DYNAMIC_THEME_FIXES, text);
        }
        return await this.sendRequest<void>(MessageTypeUItoBG.APPLY_DEV_DYNAMIC_THEME_FIXES, text);
    }

    resetDevDynamicThemeFixes(): void {
        chrome.runtime.sendMessage<MessageUItoBG>({type: MessageTypeUItoBG.RESET_DEV_DYNAMIC_THEME_FIXES});
    }

    async applyDevInversionFixes(text: string): Promise<void> {
        if (isFirefox) {
            return await this.firefoxSendRequestWithResponse<void>(MessageTypeUItoBG.APPLY_DEV_INVERSION_FIXES, text);
        }
        return await this.sendRequest<void>(MessageTypeUItoBG.APPLY_DEV_INVERSION_FIXES, text);
    }

    resetDevInversionFixes(): void {
        chrome.runtime.sendMessage<MessageUItoBG>({type: MessageTypeUItoBG.RESET_DEV_INVERSION_FIXES});
    }

    async applyDevStaticThemes(text: string): Promise<void> {
        if (isFirefox) {
            return await this.firefoxSendRequestWithResponse<void>(MessageTypeUItoBG.APPLY_DEV_STATIC_THEMES, text);
        }
        return await this.sendRequest<void>(MessageTypeUItoBG.APPLY_DEV_STATIC_THEMES, text);
    }

    resetDevStaticThemes(): void {
        chrome.runtime.sendMessage<MessageUItoBG>({type: MessageTypeUItoBG.RESET_DEV_STATIC_THEMES});
    }

    async hideHighlights(ids: string[]): Promise<void> {
        chrome.runtime.sendMessage<MessageUItoBG>({type: MessageTypeUItoBG.HIDE_HIGHLIGHTS, data: ids});
    }

    disconnect(): void {
        if (this.changeSubscribers.size > 0) {
            this.changeSubscribers.clear();
            chrome.runtime.onMessage.removeListener(this.onChangesReceived);
            chrome.runtime.sendMessage<MessageUItoBG>({type: MessageTypeUItoBG.UNSUBSCRIBE_FROM_CHANGES});
        }
    }
}

```

### ui\controls\button\style.less

```
@import "../../theme";

.button {
    background-color: @color-control-back;
    border: @size-border solid @color-border;
    box-sizing: content-box;
    color: @color-control-fore;
    cursor: pointer;
    display: inline-block;
    height: @size-control-inner;
    line-height: @size-text-normal;
    min-width: @size-control-inner;
    outline: none;
    overflow: hidden;
    padding: 0;
    text-align: center;
    transition: background-color @time-slow;
    -moz-user-select: none;
    user-select: none;

    &:hover {
        background-color: @color-control-hover;
        transition: background-color @time-fast;
    }

    &:active {
        background-color: @color-control-active;
    }

    &__wrapper {
        height: 100%;
        width: 100%;
    }
}

```

### ui\controls\button\index.tsx

```
import {m} from 'malevic';

import {mergeClass, omitAttrs} from '../utils';

export default function Button(props: Malevic.NodeAttrs, ...children: Malevic.Child[]) {
    const cls = mergeClass('button', props.class);
    const attrs = omitAttrs(['class'], props);

    return (
        <button class={cls} {...attrs}>
            <span class="button__wrapper">
                {...children}
            </span>
        </button>
    );
}

```

### ui\controls\check-button\check-button.tsx

```
import {m} from 'malevic';

import CheckBox from '../checkbox';
import ControlGroup from '../control-group/control-group';

export default function CheckButton(props: {checked: boolean; label: string; description: string; onChange: (checked: boolean) => void}) {
    return (
        <ControlGroup class="check-button">
            <ControlGroup.Control>
                <CheckBox
                    class="check-button__checkbox"
                    checked={props.checked}
                    onchange={(e: {target: HTMLInputElement}) => props.onChange(e.target.checked)}
                >
                    {props.label}
                </CheckBox>
            </ControlGroup.Control>
            <ControlGroup.Description class="check-button__description">
                {props.description}
            </ControlGroup.Description>
        </ControlGroup>
    );
}

```

### ui\controls\check-button\check-button.less

```
@import "../../theme.less";

.check-button {
    .checkbox {
        width: calc(100% - 2 * @size-border);

        &__checkmark {
            background-color: @color-control-active;

            &::before,
            &::after {
                display: none;
            }
        }

        &__content {
            align-items: center;
            display: flex;
            flex: auto;
            height: @size-control-inner;
            justify-content: center;
            -moz-user-select: none;
            user-select: none;
        }

        &__input:checked ~ * {
            color: @color-control-fore;
        }

        &__input:checked ~ .checkbox__checkmark {
            background-image: @icon-check;
            background-position: center;
            background-repeat: no-repeat;
            background-size: 1rem;
        }
    }

    &__description {
        display: inline-block;
        font-size: @size-text-small;
        line-height: @size-text-small-height;
        text-align: center;
        -moz-user-select: none;
        user-select: none;
        width: 100%;
    }
}

```

### ui\controls\checkbox\style.less

```
@import "../../theme";

.checkbox {
    align-items: stretch;
    background-color: @color-control-back;
    border: @size-border solid @color-border;
    cursor: pointer;
    display: inline-flex;
    flex: none;
    flex-direction: row;
    height: @size-control-inner;
    transition: background-color @time-slow;
    width: @size-control-inner;

    &:hover {
        background-color: @color-control-hover;
        transition: background-color @time-fast;
    }

    &__input {
        display: none;
    }

    &__checkmark {
        display: inline-block;
        height: 100%;
        position: relative;
        width: @size-control-inner;

        &::before,
        &::after {
            background-color: @color-control-fore-inactive;
            content: "";
            display: inline-block;
            height: @size-control-inner * 0.125;
            left: @size-control-inner * 0.125;
            position: absolute;
            top: @size-control-inner * 0.425;
            transition: all @time-fast;
            width: @size-control-inner * 0.75;
        }

        &::before {
            transform: skewY(45deg);
        }

        &::after {
            transform: skewY(-45deg);
        }
    }

    &__input:checked + &__checkmark {
        &::before,
        &::after {
            background-color: @color-control-fore;
        }

        &::before {
            top: @size-control-inner * 0.55;
            width: @size-control-inner * 0.25;
        }

        &::after {
            left: @size-control-inner * 0.375;
            width: @size-control-inner * 0.5;
        }
    }
}

```

### ui\controls\checkbox\index.tsx

```
import {m} from 'malevic';

import {mergeClass, omitAttrs} from '../utils';

export default function CheckBox(props: Malevic.NodeAttrs, ...children: Malevic.Child[]) {
    const cls = mergeClass('checkbox', props.class);
    const attrs = omitAttrs(['class', 'checked', 'onchange'], props);
    const check = (domNode: HTMLInputElement) => domNode.checked = Boolean(props.checked);

    return (
        <label class={cls} {...attrs}>
            <input
                class="checkbox__input"
                type="checkbox"
                checked={props.checked}
                onchange={props.onchange}
                onrender={check}
            />
            <span class="checkbox__checkmark"></span>
            <span class="checkbox__content">{children}</span>
        </label>
    );
}

```

### ui\controls\color-dropdown\style.less

```
@color-dropdown-height: 1.5rem;
@color-dropdown-item-height: 1.25rem;
@color-dropdown-item-active-height: 1.5rem;

.color-dropdown {
    height: @color-dropdown-height;
    position: relative;
    width: 100%;

    &__options {
        width: 100%;
    }

    &__picker {
        height: 100%;
        position: absolute;
        right: 0;
        top: 0;
        width: 100%;

        &--hidden {
            display: none;
        }
    }
}

```

### ui\controls\color-dropdown\index.tsx

```
import {m} from 'malevic';
import {getContext} from 'malevic/dom';

import {parseColorWithCache} from '../../../utils/color';
import ColorPicker from '../color-picker';
import DropDown from '../dropdown';

interface ColorDropDownProps {
    class?: string;
    value: string;
    colorSuggestion: string;
    hasDefaultOption?: boolean;
    hasAutoOption?: boolean;
    onChange: (value: string) => void;
    onReset: () => void;
}

interface ColorDropDownStore {
    isOpen: boolean;
    listNode: HTMLElement;
    selectedNode: HTMLElement;
}

export default function ColorDropDown(props: ColorDropDownProps) {
    const context = getContext();
    const store: ColorDropDownStore = context.store;

    const labels = {
        DEFAULT: 'Default',
        AUTO: 'Auto',
        CUSTOM: 'Custom',
    };

    const dropDownOptions = [
        props.hasDefaultOption ? {id: 'default', content: labels.DEFAULT} : null,
        props.hasAutoOption ? {id: 'auto', content: labels.AUTO} : null,
        {id: 'custom', content: labels.CUSTOM},
    ].filter((v) => v) as Array<{id: string; content: string}>;

    const selectedDropDownValue = (
        props.value === '' ? 'default' :
            props.value === 'auto' ? 'auto' :
                'custom'
    );

    function onDropDownChange(value: 'default' | 'auto' | 'custom') {
        const result = {
            default: '',
            auto: 'auto',
            custom: props.colorSuggestion,
        }[value];
        props.onChange(result);
    }

    const isPickerVisible = Boolean(parseColorWithCache(props.value));

    const prevValue = context.prev ? context.prev.props.value : null;
    const shouldFocusOnPicker = (
        (props.value !== '' && props.value !== 'auto') &&
        prevValue != null &&
        (prevValue === '' || prevValue === 'auto')
    );

    function onRootRender(root: Element) {
        if (shouldFocusOnPicker) {
            const pickerNode = root.querySelector('.color-dropdown__picker')!;
            ColorPicker.focus(pickerNode);
        }
    }

    return (
        <span
            class={{
                'color-dropdown': true,
                'color-dropdown--open': store.isOpen,
                [props.class!]: Boolean(props.class),
            }}
            onrender={onRootRender}
        >
            <DropDown class="color-dropdown__options"
                options={dropDownOptions}
                selected={selectedDropDownValue}
                onChange={onDropDownChange}
            />
            <ColorPicker
                class={{
                    'color-dropdown__picker': true,
                    'color-dropdown__picker--hidden': !isPickerVisible,
                }}
                color={props.value}
                onChange={props.onChange}
                canReset={true}
                onReset={props.onReset}
            />
        </span>
    );
}

```

### ui\controls\color-picker\index.tsx

```
import {m} from 'malevic';
import {getContext} from 'malevic/dom';

import {parseColorWithCache} from '../../../utils/color';
import TextBox from '../textbox';

import HSBPicker from './hsb-picker';

interface ColorPickerProps {
    class?: any;
    color: string;
    onChange: (color: string) => void;
    canReset: boolean;
    onReset: () => void;
}

interface ColorPickerStore {
    isFocused: boolean;
    textBoxNode: HTMLInputElement;
    previewNode: HTMLElement;
}

function isValidColor(color: string) {
    return Boolean(parseColorWithCache(color));
}

const colorPickerFocuses = new WeakMap<Node, () => void>();

function focusColorPicker(node: Node) {
    const focus = colorPickerFocuses.get(node)!;
    focus();
}

function ColorPicker(props: ColorPickerProps) {
    const context = getContext();
    context.onRender((node) => colorPickerFocuses.set(node, focus));
    const store: ColorPickerStore = context.store;

    const isColorValid = isValidColor(props.color);

    function onColorPreview(previewColor: string) {
        store.previewNode.style.backgroundColor = previewColor;
        store.textBoxNode.value = previewColor;
        store.textBoxNode.blur();
    }

    function onColorChange(rawValue: string) {
        const value = rawValue.trim();
        if (isValidColor(value)) {
            props.onChange(value);
        } else {
            props.onChange(props.color);
        }
    }

    function focus() {
        if (store.isFocused) {
            return;
        }
        store.isFocused = true;
        context.refresh();
        window.addEventListener('mousedown', onOuterClick, {passive: true});
    }

    function blur() {
        if (!store.isFocused) {
            return;
        }
        window.removeEventListener('mousedown', onOuterClick);
        store.isFocused = false;
        context.refresh();
    }

    function toggleFocus() {
        if (store.isFocused) {
            blur();
        } else {
            focus();
        }
    }

    function onOuterClick(e: MouseEvent) {
        if (!e.composedPath().some((el) => el === context.node)) {
            blur();
        }
    }

    const textBox = (
        <TextBox
            class="color-picker__input"
            onrender={(el) => {
                store.textBoxNode = el as HTMLInputElement;
                store.textBoxNode.value = isColorValid ? props.color : '';
            }}
            onkeypress={(e) => {
                const input = e.target as HTMLInputElement;
                if (e.key === 'Enter') {
                    const {value} = input;
                    onColorChange(value);
                    blur();
                    onColorPreview(value);
                }
            }}
            onfocus={focus}
        />
    );

    const previewElement = (
        <span
            class="color-picker__preview"
            onclick={toggleFocus}
            onrender={(el: HTMLElement) => {
                store.previewNode = el;
                el.style.backgroundColor = isColorValid ? props.color : 'transparent';
            }}
        ></span>
    );

    const resetButton = props.canReset ? (
        <span
            role="button"
            class="color-picker__reset"
            onclick={() => {
                props.onReset();
                blur();
            }}
        ></span>
    ) : null;

    const textBoxLine = (
        <span class="color-picker__textbox-line">
            {textBox}
            {previewElement}
            {resetButton}
        </span>
    );

    const hsbLine = isColorValid ? (
        <span class="color-picker__hsb-line">
            <HSBPicker
                color={props.color}
                onChange={onColorChange}
                onColorPreview={onColorPreview}
            />
        </span>
    ) : null;

    return (
        <span class={['color-picker', store.isFocused && 'color-picker--focused', props.class]}>
            <span class="color-picker__wrapper">
                {textBoxLine}
                {hsbLine}
            </span>
        </span>
    );
}

export default Object.assign(ColorPicker, {focus: focusColorPicker});

```

### ui\controls\color-picker\hsb-picker.tsx

```
import {m} from 'malevic';
import {getContext} from 'malevic/dom';

import type {RGBA} from '../../../utils/color';
import {parseColorWithCache, rgbToHSL, hslToString, rgbToHexString} from '../../../utils/color';
import {clamp, scale} from '../../../utils/math';
import {createSwipeHandler} from '../../utils';
import {isElementHidden} from '../utils';

interface HSB {
    h: number;
    s: number;
    b: number;
}

interface HSBPickerProps {
    color: string;
    onChange: (color: string) => void;
    onColorPreview: (color: string) => void;
}

interface HSBPickerState {
    wasPrevHidden: boolean;
    hueCanvasRendered: boolean;
    activeHSB: HSB | null;
    activeChangeHandler: ((color: string) => void) | null;
    hueTouchStartHandler: ((e: TouchEvent) => void) | null;
    sbTouchStartHandler: ((e: TouchEvent) => void) | null;
}

const hsbPickerDefaults: HSBPickerState = {
    wasPrevHidden: true,
    hueCanvasRendered: false,
    activeHSB: null,
    activeChangeHandler: null,
    hueTouchStartHandler: null,
    sbTouchStartHandler: null,
};

function rgbToHSB({r, g, b}: RGBA) {
    const min = Math.min(r, g, b);
    const max = Math.max(r, g, b);
    return {
        h: rgbToHSL({r, g, b}).h,
        s: max === 0 ? 0 : (1 - (min / max)),
        b: max / 255,
    };
}

function hsbToRGB({h: hue, s: sat, b: br}: HSB): RGBA {
    let c: [number, number, number];
    if (hue < 60) {
        c = [1, hue / 60, 0];
    } else if (hue < 120) {
        c = [(120 - hue) / 60, 1, 0];
    } else if (hue < 180) {
        c = [0, 1, (hue - 120) / 60];
    } else if (hue < 240) {
        c = [0, (240 - hue) / 60, 1];
    } else if (hue < 300) {
        c = [(hue - 240) / 60, 0, 1];
    } else {
        c = [1, 0, (360 - hue) / 60];
    }

    const max = Math.max(...c);
    const [r, g, b] = c
        .map((v) => v + (max - v) * (1 - sat))
        .map((v) => v * br)
        .map((v) => Math.round(v * 255));

    return {r, g, b, a: 1};
}

function hsbToString(hsb: HSB) {
    const rgb = hsbToRGB(hsb);
    return rgbToHexString(rgb);
}

function render(canvas: HTMLCanvasElement, getPixel: (x: number, y: number) => Uint8ClampedArray) {
    const {width, height} = canvas;
    const context = canvas.getContext('2d')!;
    const imageData = context.getImageData(0, 0, width, height);
    const d = imageData.data;
    for (let y = 0; y < height; y++) {
        for (let x = 0; x < width; x++) {
            const i = 4 * (y * width + x);
            const c = getPixel(x, y);
            for (let j = 0; j < 4; j++) {
                d[i + j] = c[j];
            }
        }
    }
    context.putImageData(imageData, 0, 0);
}

function renderHue(canvas: HTMLCanvasElement) {
    const {height} = canvas;
    render(canvas, (_, y) => {
        const hue = scale(y, 0, height, 0, 360);
        const {r, g, b} = hsbToRGB({h: hue, s: 1, b: 1});
        return new Uint8ClampedArray([r, g, b, 255]);
    });
}

function renderSB(hue: number, canvas: HTMLCanvasElement) {
    const {width, height} = canvas;
    render(canvas, (x, y) => {
        const sat = scale(x, 0, width - 1, 0, 1);
        const br = scale(y, 0, height - 1, 1, 0);
        const {r, g, b} = hsbToRGB({h: hue, s: sat, b: br});
        return new Uint8ClampedArray([r, g, b, 255]);
    });
}

export default function HSBPicker(props: HSBPickerProps) {
    const context = getContext();
    const store = context.getStore(hsbPickerDefaults);
    store.activeChangeHandler = props.onChange;

    const prevColor = context.prev && context.prev.props.color;
    const prevActiveColor = store.activeHSB ? hsbToString(store.activeHSB) : null;
    const didColorChange = props.color !== prevColor && props.color !== prevActiveColor;
    let activeHSB: HSB;
    if (didColorChange) {
        const rgb = parseColorWithCache(props.color)!;
        activeHSB = rgbToHSB(rgb);
        store.activeHSB = activeHSB;
    } else {
        activeHSB = store.activeHSB!;
    }

    function onSBCanvasRender(canvas: HTMLCanvasElement) {
        if (isElementHidden(canvas)) {
            return;
        }
        const hue = activeHSB!.h;
        const prevHue = prevColor && rgbToHSB(parseColorWithCache(prevColor)!).h;
        if (store.wasPrevHidden || hue !== prevHue) {
            renderSB(hue, canvas);
        }
        store.wasPrevHidden = false;
    }

    function onHueCanvasRender(canvas: HTMLCanvasElement) {
        if (store.hueCanvasRendered || isElementHidden(canvas)) {
            return;
        }
        store.hueCanvasRendered = true;
        renderHue(canvas);
    }

    function createHSBSwipeHandler(getEventHSB: (e: {clientX: number; clientY: number; rect: ClientRect}) => HSB) {
        return createSwipeHandler((startEvt, startNativeEvt) => {
            type SwipeEvent = typeof startEvt;

            const rect = (startNativeEvt.currentTarget as HTMLElement).getBoundingClientRect();

            function onPointerMove(e: SwipeEvent) {
                store.activeHSB = getEventHSB({...e, rect});
                props.onColorPreview(hsbToString(store.activeHSB));
                context.refresh();
            }

            function onPointerUp(e: SwipeEvent) {
                const hsb = getEventHSB({...e, rect});
                store.activeHSB = hsb;
                props.onChange(hsbToString(hsb));
            }

            store.activeHSB = getEventHSB({...startEvt, rect});
            context.refresh();

            return {
                move: onPointerMove,
                up: onPointerUp,
            };
        });
    }

    const onSBPointerDown = createHSBSwipeHandler(({clientX, clientY, rect}) => {
        const sat = clamp((clientX - rect.left) / rect.width, 0, 1);
        const br = clamp(1 - (clientY - rect.top) / rect.height, 0, 1);
        return {...activeHSB, s: sat, b: br};
    });

    const onHuePointerDown = createHSBSwipeHandler(({clientY, rect}) => {
        const hue = clamp((clientY - rect.top) / rect.height, 0, 1) * 360;
        return {...activeHSB, h: hue};
    });

    const hueCursorStyle = {
        'background-color': hslToString({h: activeHSB.h, s: 1, l: 0.5, a: 1}),
        'left': '0%',
        'top': `${activeHSB.h / 360 * 100}%`,
    };
    const sbCursorStyle = {
        'background-color': rgbToHexString(hsbToRGB(activeHSB)),
        'left': `${activeHSB.s * 100}%`,
        'top': `${(1 - activeHSB.b) * 100}%`,
    };

    return (
        <span class="hsb-picker">
            <span
                class="hsb-picker__sb-container"
                onmousedown={onSBPointerDown}
                onupdate={(el: HTMLElement) => {
                    if (store.sbTouchStartHandler) {
                        el.removeEventListener('touchstart', store.sbTouchStartHandler);
                    }
                    el.addEventListener('touchstart', onSBPointerDown, {passive: true});
                    store.sbTouchStartHandler = onSBPointerDown;
                }}
            >
                <canvas class="hsb-picker__sb-canvas" onrender={onSBCanvasRender} />
                <span class="hsb-picker__sb-cursor" style={sbCursorStyle}></span>
            </span>
            <span
                class="hsb-picker__hue-container"
                onmousedown={onHuePointerDown}
                onupdate={(el: HTMLElement) => {
                    if (store.hueTouchStartHandler) {
                        el.removeEventListener('touchstart', store.hueTouchStartHandler);
                    }
                    el.addEventListener('touchstart', onHuePointerDown, {passive: true});
                    store.hueTouchStartHandler = onHuePointerDown;
                }}
            >
                <canvas class="hsb-picker__hue-canvas" onrender={onHueCanvasRender} />
                <span class="hsb-picker__hue-cursor" style={hueCursorStyle}></span>
            </span>
        </span>
    );
}

```

### ui\controls\color-picker\hsb-picker.less

```
@import "../../theme";

@hsb-full-width: 10rem;
@hsb-hue-width: 0.75rem;
@hsb-canvas-size: @hsb-full-width - 3 * @indent-small - @hsb-hue-width - 2 * @size-border;
@hsb-width: @hsb-canvas-size;
@hsb-height: @hsb-canvas-size;
@hsb-cursor-size: 0.75rem;

.hsb-picker {
    display: flex;
    flex-direction: row;
    padding: @indent-small;
    touch-action: none;

    &__sb-container {
        cursor: pointer;
        height: @hsb-height;
        position: relative;
        -webkit-tap-highlight-color: transparent;
        width: @hsb-width;
    }

    &__hue-container {
        cursor: pointer;
        height: @hsb-height;
        margin-left: @indent-small;
        position: relative;
        -webkit-tap-highlight-color: transparent;
        width: @hsb-hue-width;
    }

    &__sb-canvas {
        height: 100%;
        width: 100%;
    }

    &__hue-canvas {
        height: 100%;
        width: 100%;
    }

    &__hue-cursor,
    &__sb-cursor {
        border-radius: 50%;
        box-shadow: 0 0 0 @size-border @color-control-fore;
        display: inline-block;
        height: @hsb-cursor-size;
        margin-top: -@hsb-cursor-size / 2;
        position: absolute;
        width: @hsb-cursor-size;
        z-index: 2;
    }

    &__sb-cursor {
        margin-left: -@hsb-cursor-size / 2;
    }
}

```

### ui\controls\color-picker\style.less

```
@import "../../theme.less";
@import "./hsb-picker";

@colorpicker-control-height: 1.5rem;
@colorpicker-input-height: 1.25rem;
@colorpicker-icon-size: 1rem;

.color-picker {
    height: @colorpicker-control-height;
    position: relative;
    width: 100%;

    &__wrapper {
        background-color: @color-back;
        display: inline-flex;
        flex-direction: column;
        left: 0;
        overflow: hidden;
        position: absolute;
        top: 0;
        width: 100%;
    }

    &--focused &__wrapper {
        border: @size-border solid @color-border;
        box-sizing: border-box;
        z-index: 1;
    }

    &__input {
        background-color: @color-control-active;
        border: none;
        box-sizing: border-box;
        color: @color-control-fore;
        height: @colorpicker-input-height;
        margin-top: @size-border;
        text-align: center;
        width: 100%;
    }

    &--focused &__input {
        margin-top: 0;
    }

    &__preview {
        cursor: pointer;
        display: inline-block;
        height: @colorpicker-icon-size;
        left: (@colorpicker-control-height - @colorpicker-icon-size) / 2;
        position: absolute;
        top: (@colorpicker-control-height - @colorpicker-icon-size) / 2;
        width: @colorpicker-icon-size;
    }

    &--focused &__preview {
        left: (@colorpicker-control-height - @colorpicker-icon-size) / 2 - @size-border;
        top: (@colorpicker-control-height - @colorpicker-icon-size) / 2 - @size-border;
    }

    &__reset {
        background-image: @icon-reset;
        background-position: 0 0;
        background-repeat: no-repeat;
        background-size: @colorpicker-icon-size;
        cursor: pointer;
        display: inline-block;
        height: @colorpicker-icon-size;
        position: absolute;
        right: (@colorpicker-control-height - @colorpicker-icon-size) / 2;
        top: (@colorpicker-control-height - @colorpicker-icon-size) / 2;
        width: @colorpicker-icon-size;
    }

    &--focused &__reset {
        right: (@colorpicker-control-height - @colorpicker-icon-size) / 2 - @size-border;
        top: (@colorpicker-control-height - @colorpicker-icon-size) / 2 - @size-border;
    }

    &__textbox-line {
        width: 100%;
    }

    &__hsb-line {
        display: none;
        width: 100%;
    }

    &--focused &__hsb-line {
        border-color: @color-border;
        display: block;
    }
}

```

### ui\controls\control-group\control-group.tsx

```
import {m} from 'malevic';

function ControlGroup(
    props: {class?: string},
    control: Malevic.Spec,
    description: Malevic.Spec,
) {
    return (
        <span class={['control-group', props.class]}>
            {control}
            {description}
        </span>
    );
}

function Control(props: {class?: string}, ...content: Malevic.Child[]) {
    return (
        <span class={['control-group__control', props.class]} >
            {...content}
        </span>
    );
}

function Description(props: {class?: string}, ...content: Malevic.Child[]) {
    return (
        <span class={['control-group__description', props.class]}>
            {...content}
        </span>
    );
}

export default Object.assign(ControlGroup, {Control, Description});

```

### ui\controls\control-group\control-group.less

```
@import "../../theme.less";

.control-group {
    align-items: stretch;
    display: inline-flex;
    flex-direction: column;
    width: 100%;

    &__control {
        height: 2 * @size-border + @size-control-inner;
    }

    &__description {
        font-size: @size-text-small;
        line-height: @size-text-small-height;
        text-align: center;
        -moz-user-select: none;
        user-select: none;
    }
}

```

### ui\controls\dropdown\style.less

```
@dropdown-height: 1.5rem;
@dropdown-item-height: 1.25rem;
@dropdown-item-active-height: 1.5rem;

.dropdown {
    display: inline-block;
    height: @dropdown-height;
    position: relative;
    -moz-user-select: none;
    user-select: none;
    width: 100%;

    &__selected {
        align-items: center;
        background-color: @color-control-active;
        background-image: @icon-down;
        background-position: center right 0.25rem;
        background-repeat: no-repeat;
        background-size: 1rem;
        color: @color-control-fore;
        display: inline-flex;
        height: @dropdown-item-height;
        justify-content: center;
        line-height: @dropdown-item-height;
        margin-top: (@dropdown-height - @dropdown-item-height) / 2;
        position: absolute;
        text-align: center;
        width: 100%;

        &__text {
            display: inline-block;
            max-width: calc(100% - 2.5rem);
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
    }

    &__list {
        background-color: @color-control-back;
        border: @size-border solid @color-border;
        border-top: none;
        box-shadow: 0 0 0.25rem black;
        box-sizing: border-box;
        display: none;
        margin-top: (@dropdown-height - @dropdown-item-height) / 2;
        overflow: hidden;
        position: absolute;
        width: 100%;

        &__item {
            align-items: center;
            background-color: @color-control-back;
            color: @color-control-fore;
            display: inline-flex;
            justify-content: center;
            min-height: @dropdown-item-height;
            text-align: center;
            width: 100%;
            
            &:hover {
                background-color: @color-control-hover;
                transition: background-color @time-fast;
            }

            &--selected {
                overflow: hidden;
                visibility: hidden;
                white-space: nowrap;
            }
        }
    }

    &--open &__list {
        display: inline-block;
        margin-top: (@dropdown-height - @dropdown-item-active-height) / 2;
        z-index: 1;

        &__item {
            min-height: @dropdown-item-active-height;
        }
    }

    &--open &__selected {
        height: @dropdown-item-active-height;
        margin-top: (@dropdown-height - @dropdown-item-active-height) / 2;
        z-index: 2;
    }
}

.preview .dropdown {
    cursor: pointer;
}

```

### ui\controls\dropdown\index.tsx

```
import {m} from 'malevic';
import {getContext} from 'malevic/dom';

export type DropDownOption<T> = {id: T; content: Malevic.Child};

interface DropDownProps<T> {
    class?: string;
    selected: T;
    options: Array<DropDownOption<T>>;
    onChange: (value: T) => void;
}

interface DropDownStore {
    isOpen: boolean;
    listNode: HTMLElement;
    selectedNode: HTMLElement;
}

export default function DropDown<T>(props: DropDownProps<T>) {
    const context = getContext();
    const store: DropDownStore = context.store;

    if (context.prev) {
        const currOptions = props.options.map((o) => o.id);
        const prevOptions = (context.prev.props.options as Array<DropDownOption<T>>).map((o) => o.id);
        if (currOptions.length !== prevOptions.length || currOptions.some((o, i) => o !== prevOptions[i])) {
            store.isOpen = false;
        }
    }

    function saveListNode(el: HTMLElement) {
        store.listNode = el;
    }

    function saveSelectedNode(el: HTMLElement) {
        store.selectedNode = el;
    }

    function onSelectedClick() {
        store.isOpen = !store.isOpen;
        context.refresh();

        if (store.isOpen) {
            const onOuterClick = (e: MouseEvent) => {
                window.removeEventListener('mousedown', onOuterClick);

                const listRect = store.listNode.getBoundingClientRect();
                const ex = e.clientX;
                const ey = e.clientY;
                if (
                    ex < listRect.left ||
                    ex > listRect.right ||
                    ey < listRect.top ||
                    ey > listRect.bottom
                ) {
                    store.isOpen = false;
                    context.refresh();
                }
            };

            window.addEventListener('mousedown', onOuterClick, {passive: true});
        }
    }

    function createListItem(value: DropDownOption<T>) {
        return (
            <span
                class={{
                    'dropdown__list__item': true,
                    'dropdown__list__item--selected': value.id === props.selected,
                    [props.class!]: Boolean(props.class),
                }}
                onclick={() => {
                    store.isOpen = false;
                    context.refresh();
                    props.onChange(value.id);
                }}
            >
                {value.content}
            </span>
        );
    }

    const selectedContent = props.options.find((value) => value.id === props.selected)!.content;

    return (
        <span
            class={{
                'dropdown': true,
                'dropdown--open': store.isOpen,
                [props.class!]: Boolean(props.class),
            }}
        >
            <span
                class="dropdown__list"
                oncreate={saveListNode}
            >
                {props.options
                    .slice()
                    .sort((a, b) => a.id === props.selected ? -1 : b.id === props.selected ? 1 : 0)
                    .map(createListItem)}
            </span>
            <span
                class="dropdown__selected"
                oncreate={saveSelectedNode}
                onclick={onSelectedClick}
            >
                <span class="dropdown__selected__text">
                    {selectedContent}
                </span>
            </span>
        </span >
    );
}

```

### ui\controls\message-box\style.less

```
@import "../../theme.less";

.message-box {
    background-color: @color-back;
    border-bottom: @size-border solid @color-border;
    border-top: @size-border solid @color-border;
    display: flex;
    flex-direction: column;
    padding: @indent-large;

    &__caption {
        text-align: center;
    }

    &__buttons {
        display: flex;
        flex-direction: row;
        justify-content: center;
        margin-top: @indent-small;
    }

    &__button {
        min-width: 4rem;

        &:not(:first-child) {
            margin-left: @indent-small;
        }
    }

    &__button-ok {
        border-color: gray;
    }
}

```

### ui\controls\message-box\index.tsx

```
import {m} from 'malevic';

import Button from '../button';
import Overlay from '../overlay';

interface MessageBoxProps {
    caption: string;
    onOK?: () => void;
    onCancel?: () => void;
    hideCancel?: boolean;
    portalKey?: any;
}

export default function MessageBox(props: MessageBoxProps) {
    return (
        <Overlay.Portal key={props.portalKey} onOuterClick={props.onCancel}>
            <div class="message-box">
                <label class="message-box__caption">
                    {props.caption}
                </label>
                <div class="message-box__buttons">
                    <Button class="message-box__button message-box__button-ok" onclick={props.onOK}>
                        OK
                    </Button>
                    {props.hideCancel ? null :
                        <Button class="message-box__button message-box__button-cancel" onclick={props.onCancel}>
                            Cancel
                        </Button>
                    }
                </div>
            </div>
        </Overlay.Portal>
    );
}

```

### ui\controls\multi-switch\index.tsx

```
import {m} from 'malevic';

interface MultiSwitchProps {
    class?: string;
    options: string[];
    value: string;
    onChange: (value: string) => void;
}

export default function MultiSwitch(props: MultiSwitchProps, ...children: Malevic.Child[]) {
    return (
        <span class={['multi-switch', props.class]}>
            <span
                class="multi-switch__highlight"
                style={{
                    'left': `${props.options.indexOf(props.value) / props.options.length * 100}%`,
                    'width': `${1 / props.options.length * 100}%`,
                }}
            />
            {props.options.map((option) => (
                <span
                    class={{
                        'multi-switch__option': true,
                        'multi-switch__option--selected': option === props.value,
                    }}
                    onclick={() => option !== props.value && props.onChange(option)}
                >
                    {option}
                </span>
            ))}
            {...children}
        </span>
    );
}

```

### ui\controls\multi-switch\style.less

```
@import "../../theme";

.multi-switch {
    background-color: @color-control-back;
    border: @size-border solid @color-border;
    box-sizing: content-box;
    color: @color-control-fore;
    display: inline-flex;
    height: @size-control-inner;
    position: relative;
    -moz-user-select: none;
    user-select: none;

    &__option {
        align-items: center;
        cursor: pointer;
        display: inline-flex;
        justify-content: center;
        height: 100%;
        overflow: hidden;
        position: relative;
        transition: background-color @time-slow;
        white-space: nowrap;
        width: 50%;

        &:hover:not(&--selected) {
            background-color: @color-control-hover;
        }
    }

    &__highlight {
        background-color: @color-control-active;
        display: inline-block;
        height: 100%;
        left: 0;
        position: absolute;
        top: 0;
        transition: left @time-fast, width @time-fast;
        width: 0;
    }
}

```

### ui\controls\nav-button\style.less

```
@import "../../theme.less";

.nav-button {
    background-image: @icon-right;
    background-position: center right 0.25rem;
    background-repeat: no-repeat;
    background-size: 1rem;
    width: calc(100% - 2 * @size-border);

    &__content {
        align-items: center;
        display: inline-flex;
        flex-direction: row;
        height: 100%;
    }
}

```

### ui\controls\nav-button\index.tsx

```
import {m} from 'malevic';

import Button from '../button';

interface NavButtonProps {
    class?: any;
    onClick: () => void;
}

export default function ResetButton(props: NavButtonProps, ...content: Malevic.Child[]) {
    return (
        <Button
            class={['nav-button', props.class]}
            onclick={props.onClick}
        >
            <span class="nav-button__content">
                {...content}
            </span>
        </Button>
    );
}

```

### ui\controls\overlay\style.less

```
@import "../../theme.less";

.overlay {
    align-items: center;
    background-color: fade(@color-back, 50%);
    flex-direction: column;
    display: inline-flex;
    height: 100%;
    justify-content: center;
    left: 0;
    position: fixed;
    top: 0;
    width: 100%;
    z-index: 2;

    &:empty {
        display: none;
    }
}

```

### ui\controls\overlay\index.ts

```
import {getContext, render} from 'malevic/dom';
import {isStringifying} from 'malevic/string';

const DEFAULT_OVERLAY_KEY = Symbol();
const overlayNodes = new Map<any, HTMLElement>();
const clickListeners = new WeakMap<HTMLElement, () => void>();

function getOverlayDOMNode(key: any) {
    if (key == null) {
        key = DEFAULT_OVERLAY_KEY;
    }

    if (!overlayNodes.has(key)) {
        const node = document.createElement('div');
        node.classList.add('overlay');
        node.addEventListener('click', (e) => {
            if (clickListeners.has(node) && e.currentTarget === node) {
                const listener = clickListeners.get(node)!;
                listener();
            }
        }, {passive: true});
        overlayNodes.set(key, node);
    }
    return overlayNodes.get(key);
}

interface OverlayProps {
    key?: any;
}

function Overlay(props: OverlayProps) {
    if (isStringifying()) {
        return null;
    }
    return getOverlayDOMNode(props.key);
}

interface OverlayPortalProps {
    key?: any;
    onOuterClick?: () => void;
}

function Portal(props: OverlayPortalProps, ...content: Malevic.Child[]): void {
    const context = getContext();

    context.onRender(() => {
        const node = getOverlayDOMNode(props.key)!;
        if (props.onOuterClick) {
            clickListeners.set(node, props.onOuterClick);
        } else {
            clickListeners.delete(node);
        }
        render(node, content);
    });

    context.onRemove(() => {
        const container = getOverlayDOMNode(props.key)!;
        render(container, null);
    });

    return context.leave();
}

export default Object.assign(Overlay, {Portal});

```

### ui\controls\reset-button\style.less

```
@import "../../theme.less";

.reset-button {
    width: calc(100% - 2 * @size-border);

    &__content {
        align-items: center;
        display: inline-flex;
        flex-direction: row;
        height: 100%;
    }

    &__icon {
        background-image: @icon-reset;
        background-position: 0 0;
        background-size: 1rem;
        display: inline-block;
        height: 1rem;
        margin-right: 0.125rem;
        width: 1rem;
    }
}

```

### ui\controls\reset-button\index.tsx

```
import {m} from 'malevic';

import Button from '../button';

interface ResetButtonProps {
    onClick: () => void;
}

export default function ResetButton(props: ResetButtonProps, ...content: Malevic.Child[]) {
    return (
        <Button
            class="reset-button"
            onclick={props.onClick}
        >
            <span class="reset-button__content">
                <span class="reset-button__icon"></span>
                {...content}
            </span>
        </Button>
    );
}

```

### ui\controls\select\style.less

```
@import "../../theme";

.select {
    display: inline-flex;
    flex-direction: column;
    position: relative;

    &__line {
        display: inline-flex;
        flex-direction: row;
    }

    &__textbox.textbox {
        border-right: none;
        flex: auto;
        width: 100%;
    }

    &__expand {
        border-left: none;
        flex: none;

        &__icon {
            display: inline-block;
            height: 100%;
            position: relative;
            width: 100%;

            &::before,
            &::after {
                background-color: @color-control-fore;
                content: "";
                display: inline-block;
                height: @size-control-inner * 0.125;
                position: absolute;
                top: @size-control-inner * 0.5;
                width: @size-control-inner * 0.375;
                z-index: 1;
            }

            &::before {
                left: @size-control-inner * 0.125;
                transform: skewY(45deg);
            }

            &::after {
                left: @size-control-inner * 0.5;
                transform: skewY(-45deg);
            }
        }
    }

    &__list {
        background-color: @color-back;
        border-bottom: @size-border solid @color-border;
        border-left: @size-border solid @color-border;
        border-right: @size-border solid @color-border;
        box-sizing: border-box;
        left: 0;
        max-height: 0;
        overflow-x: hidden;
        overflow-y: auto;
        position: absolute;
        top: ~"calc(100% - @{size-border})";
        transition: max-height @time-fast;
        width: 100%;
        z-index: 999;

        &--expanded {
            max-height: 12rem;
            transition: max-height @time-slow * 2;
        }

        &--short {
            overflow: hidden;
        }
    }

    &__option {
        align-items: center;
        background-color: @color-control-back;
        cursor: pointer;
        display: flex;
        flex: none;
        height: @size-control-inner;
        flex-direction: row;
        padding-left: @size-control-inner / 2 - @size-text-normal / 2;

        &:hover {
            background-color: @color-control-hover;
        }
    }
}

```

### ui\controls\select\index.tsx

```
import {m} from 'malevic';
import {getContext} from 'malevic/dom';
import {withState, useState} from 'malevic/state';

import Button from '../button';
import TextBox from '../textbox';
import VirtualScroll from '../virtual-scroll';

interface SelectProps {
    class?: any;
    value: string;
    options: {
        [value: string]: Malevic.Child;
    };
    onChange: (value: string) => void;
}

interface SelectState {
    isExpanded: boolean;
    focusedIndex: number | null;
}

function Select(props: SelectProps) {
    const {state, setState} = useState<SelectState>({isExpanded: false, focusedIndex: null});
    const values = Object.keys(props.options);

    const {store} = getContext();
    const valueNodes: Map<string, Element> = store.valueNodes || (store.valueNodes = new Map());
    const nodesValues: WeakMap<Element, string> = store.nodesValues || (store.nodesValues = new WeakMap());

    function onRender(node: Element) {
        store.rootNode = node;
    }

    function onOuterClick(e: MouseEvent) {
        const r = (store.rootNode as Element).getBoundingClientRect();
        if (e.clientX < r.left || e.clientX > r.right || e.clientY < r.top || e.clientY > r.bottom) {
            window.removeEventListener('click', onOuterClick);
            collapseList();
        }
    }

    function onTextInput(e: Event) {
        const text = (e.target as HTMLInputElement)
            .value
            .toLowerCase()
            .trim();

        expandList();

        values.some((value) => {
            if (value.toLowerCase().indexOf(text) === 0) {
                scrollToValue(value);
                return true;
            }
        });
    }

    function onKeyPress(e: KeyboardEvent) {
        const input = e.target as HTMLInputElement;
        if (e.key === 'Enter') {
            const value = input.value;
            input.blur();
            collapseList();
            props.onChange(value);
        }
    }

    function scrollToValue(value: string) {
        setState({focusedIndex: values.indexOf(value)});
    }

    function onExpandClick() {
        if (state.isExpanded) {
            collapseList();
        } else {
            expandList();
        }
    }

    function expandList() {
        setState({isExpanded: true});
        scrollToValue(props.value);
        window.addEventListener('click', onOuterClick, {passive: true});
    }

    function collapseList() {
        setState({isExpanded: false});
    }

    function onSelectOption(e: MouseEvent) {
        let current = e.target as HTMLElement;
        while (current && !nodesValues.has(current)) {
            current = current.parentElement!;
        }

        if (current) {
            const value = nodesValues.get(current)!;
            props.onChange(value);
        }

        collapseList();
    }

    function saveValueNode(value: string, domNode: Element) {
        valueNodes.set(value, domNode);
        nodesValues.set(domNode, value);
    }

    function removeValueNode(value: string) {
        const el = valueNodes.get(value);
        valueNodes.delete(value);
        nodesValues.delete(el!);
    }

    return (
        <span
            class={[
                'select',
                state.isExpanded && 'select--expanded',
                props.class,
            ]}
            onrender={onRender}
        >
            <span class="select__line">
                <TextBox
                    class="select__textbox"
                    value={props.value}
                    oninput={onTextInput}
                    onkeypress={onKeyPress}
                />
                <Button
                    class="select__expand"
                    onclick={onExpandClick}
                >
                    <span class="select__expand__icon"></span>
                </Button>
            </span>
            <VirtualScroll
                root={<span
                    class={{
                        'select__list': true,
                        'select__list--expanded': state.isExpanded,
                        'select__list--short': Object.keys(props.options).length <= 7,
                    }}
                    onclick={onSelectOption}
                />}
                items={Object.entries(props.options).map(([value, content]) => (
                    <span
                        class="select__option"
                        data={value}
                        onrender={(domNode) => saveValueNode(value, domNode)}
                        onremove={() => removeValueNode(value)}
                    >
                        {content}
                    </span>
                ))}
                scrollToIndex={state.focusedIndex}
            />
        </span>
    );
}

export default withState(Select);

```

### ui\controls\shortcut\style.less

```
@import "../../theme";

.shortcut {
    color: @color-fore;
    cursor: pointer;
    display: inline-block;
    font-size: @size-text-small;
    line-height: @size-text-small-height;
    outline: none;
    text-align: center;
    text-decoration: none;
    white-space: pre;

    &:hover {
        text-decoration: underline;
    }

    &--edit {
        color: @color-input-fore-active;
    }

    &::before {
        content: "✎";
        direction: rtl;
        display: inline-block;
        line-height: @size-text-small-height;
        visibility: hidden;
        width: 0;
    }

    &:hover,
    &--edit {
        &::before {
            visibility: visible;
        }
    }
}

```

### ui\controls\shortcut\index.tsx

```
import {m} from 'malevic';

import type {Shortcuts} from '../../../definitions';
import {isFirefox, isEdge} from '../../../utils/platform';
import {mergeClass} from '../utils';

interface ShortcutLinkProps {
    class?: string | {[cls: string]: any};
    commandName: string;
    shortcuts: Shortcuts;
    textTemplate: (shortcut: string | null) => string;
    onSetShortcut: (shortcut: string) => Promise<string | null>;
}

/**
 * Displays a shortcut and navigates
 * to Chrome Commands page on click.
 */
export default function ShortcutLink(props: ShortcutLinkProps) {
    const shortcut = props.shortcuts[props.commandName];
    const shortcutMessage = props.textTemplate(shortcut);
    const cls = mergeClass('shortcut', [shortcut ? 'shortcut--set' : null, props.class]);

    let enteringShortcutInProgress = false;

    function startEnteringShortcut(node: HTMLAnchorElement) {
        if (enteringShortcutInProgress) {
            return;
        }
        enteringShortcutInProgress = true;

        const initialText = node.textContent;
        node.textContent = '...⌨';

        // Note: these variables are function-global to be able to update shortcut display,
        // but they are overwritten right before shortcut is set.
        let ctrl = false, alt = false, command = false, shift = false, key: string | null = null;

        function updateShortcut() {
            if (!enteringShortcutInProgress) {
                return;
            }
            const shortcut = `${ctrl ? 'Ctrl+' : ''}${alt ? 'Alt+' : command ? 'Command+' : ''}${shift ? 'Shift+' : ''}${key ? key : ''}`;
            node.textContent = shortcut;
        }

        function onKeyDown(e: KeyboardEvent) {
            e.preventDefault();
            ctrl = e.ctrlKey;
            alt = e.altKey;
            command = e.metaKey;
            shift = e.shiftKey;

            key = null;
            if (e.key === '.') {
                key = 'Period';
            } else if (e.key === ',') {
                key = 'Comma';
            } else if (/^Digit[0-9]$/.test(e.code)) {
                // This is a digit key
                // e.key can be inaccurate if Shift is also pressed
                key = e.code.substring(5, 6);
            } else if (/^Key[A-Z]$/.test(e.code)) {
                // This is a letter key
                if (/^[A-Za-z]$/.test(e.key)) {
                    // This is a letter key, on a Latin-like layout, and has no accents
                    // It can be used as a shortcut, but e.code does not have to match e.key
                    // e.key matches what Firefox displays on about:addons and it represents the software
                    // interpretation of the key considering the active keyboard layout
                    // e.code represents the physical location of the key, ignoring the keyboard layout
                    // Therefore we use the e.key converted to upper case.
                    key = e.key.toUpperCase();
                } else if (e.keyCode !== 0) {
                    // This is a letter key on a non-latin layout or on Latin layout with accents,
                    // but it is internally reproducible by Firefox
                    // This check relies on deprecated e.keyCode because it actually represents the internal
                    // implementation-dependent value. The actual key comes from non-deprecated e.code
                    // For details see https://developer.mozilla.org/docs/Web/API/KeyboardEvent/keyCode
                    key = e.code.substring(3);
                }
                // This letter is not well-represented by Firefox, probably because it is a Latin-like
                // key with accent. This key will not work, even if set via about:addons
            }

            updateShortcut();

            if ((ctrl || alt || command || shift) && key) {
                removeListeners();
                node.blur();
                const shortcut = `${ctrl ? 'Ctrl+' : ''}${alt ? 'Alt+' : command ? 'Command+' : ''}${shift ? 'Shift+' : ''}${key ? key : ''}`;
                props.onSetShortcut(shortcut).then((shortcut) => {
                    enteringShortcutInProgress = false;
                    node.classList.remove('shortcut--edit');
                    node.textContent = props.textTemplate(shortcut);
                });
            }
        }

        // Note: technically, there are left and right keys for all of these,
        // but most people won't click two identical keys at once
        function onKeyUp(e: KeyboardEvent) {
            if (e.key === 'Control') {
                ctrl = false;
            } else if (e.key === 'Alt') {
                alt = false;
            } else if (e.key === 'Command') {
                command = false;
            } else if (e.key === 'Shift') {
                shift = false;
            } else {
                key = null;
            }
            updateShortcut();
        }

        function onBlur() {
            removeListeners();
            node.classList.remove('shortcut--edit');
            if (enteringShortcutInProgress) {
                node.textContent = initialText;
            }
            enteringShortcutInProgress = false;
        }

        function removeListeners() {
            window.removeEventListener('keydown', onKeyDown, {capture: true, passive: false, once: false} as EventListenerOptions);
            window.removeEventListener('keyup', onKeyUp, {capture: true, passive: false, once: false} as EventListenerOptions);
            window.removeEventListener('blur', onBlur, {capture: true, once: true} as EventListenerOptions);
        }

        window.addEventListener('keydown', onKeyDown, {capture: true, passive: false, once: false});
        window.addEventListener('keyup', onKeyUp, {capture: true, passive: false, once: false});
        window.addEventListener('blur', onBlur, {capture: true, once: true});
        node.classList.add('shortcut--edit');
    }

    function onClick(e: Event) {
        e.preventDefault();
        if (isFirefox) {
            startEnteringShortcut(e.target as HTMLAnchorElement);
            return;
        }
        if (isEdge) {
            chrome.tabs.create({
                url: `edge://extensions/shortcuts`,
                active: true,
            });
            return;
        }
        chrome.tabs.create({
            url: `chrome://extensions/configureCommands#command-${chrome.runtime.id}-${props.commandName}`,
            active: true,
        });
    }

    function onRender(node: HTMLAnchorElement) {
        node.textContent = shortcutMessage;
    }

    return (
        <a
            class={cls}
            href="#"
            onclick={onClick}
            oncreate={onRender}
        ></a>
    );
}

```

### ui\controls\slider\style.less

```
@slider-height: 1.5rem;
@slider-track-height: 0.625rem;
@slider-track-active-height: 0.75rem;
@slider-thumb-size: 1.25rem;
@slider-thumb-active-size: 1.5rem;
@slider-thumb-width: 0.5rem;
@slider-track-color: @color-control-hover;
@slider-track-fill-color: @color-control-active;
@slider-thumb-color: @color-control-fore;

.slider {
    display: inline-block;
    height: @slider-height;
    position: relative;
    touch-action: none;
    width: 100%;

    &__track {
        background-color: @slider-track-color;
        display: inline-block;
        height: @slider-track-height;
        margin-left: @slider-thumb-width / 2;
        margin-top: (@slider-height - @slider-track-height) / 2;
        position: absolute;
        width: calc(100% - @slider-thumb-width);

        &__fill {
            background-color: @slider-track-fill-color;
            display: inline-block;
            height: 100%;
            position: absolute;

            &::before {
                background-color: @slider-track-fill-color;
                content: "";
                height: 100%;
                position: absolute;
                right: 100%;
                width: @slider-thumb-width / 2;
            }
        }

        &::before,
        &::after {
            background-color: @slider-track-color;
            content: "";
            height: 100%;
            position: absolute;
            width: @slider-thumb-width / 2;
        }

        &::before {
            right: 100%;
        }

        &::after {
            left: 100%;
        }
    }

    &__thumb-wrapper {
        margin-left: @slider-thumb-width / 2;
        position: absolute;
        width: calc(100% - @slider-thumb-width);
    }

    &__thumb {
        background-color: @slider-thumb-color;
        cursor: pointer;
        display: inline-block;
        height: @slider-thumb-size;
        margin-left: -@slider-thumb-width / 2;
        margin-top: (@slider-height - @slider-thumb-size) / 2;
        position: absolute;
        width: @slider-thumb-width;

        &__value {
            color: @color-control-fore;
            cursor: default;
            left: calc(100% + @size-text-normal / 2);
            line-height: @slider-thumb-size;
            position: absolute;
            -moz-user-select: none;
            user-select: none;

            &--flip {
                left: initial;
                right: calc(100% + @size-text-normal / 2);
            }
        }
    }

    &--active &__thumb {
        box-shadow: 0 0 0.25rem black;
        height: @slider-thumb-active-size;
        margin-top: (@slider-height - @slider-thumb-active-size) / 2;

        &__value {
            line-height: @slider-thumb-active-size;
        }
    }

    &--active &__track {
        height: @slider-track-active-height;
        margin-top: (@slider-height - @slider-track-active-height) / 2;
    }

    &__value {
        display: none;
    }
}

```

### ui\controls\slider\index.tsx

```
import {m} from 'malevic';
import {getContext} from 'malevic/dom';

import {scale, clamp} from '../../../utils/math';
import {throttle} from '../../../utils/throttle';

interface SliderProps {
    value: number;
    min: number;
    max: number;
    step: number;
    formatValue: (value: number) => string;
    onChange: (value: number) => void;
    onPreview?: (value: number) => void;
}

interface SliderStore {
    isActive: boolean;
    activeValue: number | null;
    activeProps: SliderProps;
    trackNode: HTMLElement;
    thumbNode: HTMLElement;
    wheelTimeoutId: number;
    wheelValue: number | null;
}

function stickToStep(x: number, step: number) {
    const s = Math.round(x / step) * step;
    const exp = Math.floor(Math.log10(step));
    if (exp >= 0) {
        const m = 10 ** exp;
        return Math.round(s / m) * m;
    }
    const m = 10 ** -exp;
    return Math.round(s * m) / m;
}

export default function Slider(props: SliderProps) {
    const context = getContext();
    const store: SliderStore = context.store;

    store.activeProps = props;

    function onRootCreate(rootNode: HTMLElement) {
        rootNode.addEventListener('touchstart', onPointerDown, {passive: true});
        rootNode.addEventListener('wheel', onWheel, {passive: false});
    }

    function saveTrackNode(el: HTMLElement) {
        store.trackNode = el;
    }

    function getTrackNode() {
        return store.trackNode as HTMLElement;
    }

    function saveThumbNode(el: HTMLElement) {
        store.thumbNode = el;
    }

    function getThumbNode() {
        return store.thumbNode as HTMLElement;
    }

    function onPointerDown(startEvt: MouseEvent | TouchEvent) {
        if (store.isActive) {
            return;
        }

        const {
            getClientX,
            pointerMoveEvent,
            pointerUpEvent,
        } = (() => {
            const isTouchEvent =
                typeof TouchEvent !== 'undefined' &&
                startEvt instanceof TouchEvent;
            const touchId = isTouchEvent
                ? (startEvt as TouchEvent).changedTouches[0].identifier
                : null;

            function getTouch(e: TouchEvent) {
                const find = (touches: TouchList) => Array.from(touches).find((t) => t.identifier === touchId)!;
                return find(e.changedTouches) || find(e.touches);
            }

            function getClientX(e: MouseEvent | TouchEvent) {
                const {clientX} = isTouchEvent
                    ? getTouch(e as TouchEvent)
                    : e as MouseEvent;
                return clientX;
            }

            const pointerMoveEvent = isTouchEvent ? 'touchmove' : 'mousemove';
            const pointerUpEvent = isTouchEvent ? 'touchend' : 'mouseup';

            return {getClientX, pointerMoveEvent, pointerUpEvent};
        })();

        const dx = (() => {
            const thumbRect = getThumbNode().getBoundingClientRect();
            const startClientX = getClientX(startEvt);
            const isThumbPressed = startClientX >= thumbRect.left && startClientX <= thumbRect.right;
            return isThumbPressed ? (thumbRect.left + thumbRect.width / 2 - startClientX) : 0;
        })();

        function getEventValue(e: MouseEvent | TouchEvent) {
            const {min, max} = store.activeProps;
            const clientX = getClientX(e);
            const rect = getTrackNode().getBoundingClientRect();
            const scaled = scale(clientX + dx, rect.left, rect.right, min, max);
            const clamped = clamp(scaled, min, max);
            return clamped;
        }

        function onPointerMove(e: MouseEvent | TouchEvent) {
            const value = getEventValue(e);
            store.activeValue = value;
            context.refresh();

            const {onPreview} = store.activeProps;
            onPreview?.(value);
        }

        function onPointerUp(e: MouseEvent | TouchEvent) {
            unsubscribe();
            const value = getEventValue(e);
            store.isActive = false;
            context.refresh();
            store.activeValue = null;

            const {onChange, step} = store.activeProps;
            onChange(stickToStep(value, step));
        }

        function onKeyPress(e: KeyboardEvent) {
            if (e.key === 'Escape') {
                unsubscribe();
                store.isActive = false;
                store.activeValue = null;
                context.refresh();
            }
        }

        function subscribe() {
            window.addEventListener(pointerMoveEvent, onPointerMove, {passive: true});
            window.addEventListener(pointerUpEvent, onPointerUp, {passive: true});
            window.addEventListener('keypress', onKeyPress, {passive: true});
        }

        function unsubscribe() {
            window.removeEventListener(pointerMoveEvent, onPointerMove);
            window.removeEventListener(pointerUpEvent, onPointerUp);
            window.removeEventListener('keypress', onKeyPress);
        }

        subscribe();
        store.isActive = true;
        store.activeValue = getEventValue(startEvt);
        context.refresh();
    }

    function getValue() {
        return store.activeValue == null ? props.value : store.activeValue;
    }

    const percent = scale(getValue(), props.min, props.max, 0, 100);
    const thumbPositionStyleValue = `${percent}%`;
    const shouldFlipText = percent > 75;
    const formattedValue = props.formatValue(
        stickToStep(getValue(), props.step)
    );

    function scaleWheelDelta(delta: number) {
        return scale(delta, 0, -1000, 0, props.max - props.min);
    }

    const refreshOnWheel = throttle(() => {
        store.activeValue = stickToStep(store.wheelValue!, props.step);
        store.wheelTimeoutId = setTimeout(() => {
            if (store.activeValue != null) {
                const {onChange} = store.activeProps;
                onChange(store.activeValue);
            }
            store.isActive = false;
            store.activeValue = null;
            store.wheelValue = null;
        }, 400);
        context.refresh();
    });

    function onWheel(event: WheelEvent) {
        if (store.wheelValue == null) {
            store.wheelValue = getValue();
        }
        store.isActive = true;
        clearTimeout(store.wheelTimeoutId);
        event.preventDefault();
        const accumulatedValue = store.wheelValue + scaleWheelDelta(event.deltaY);
        store.wheelValue = clamp(accumulatedValue, props.min, props.max);
        refreshOnWheel();
    }

    return (
        <span
            class={{'slider': true, 'slider--active': store.isActive}}
            oncreate={onRootCreate}
            onmousedown={onPointerDown}
        >
            <span
                class="slider__track"
                oncreate={saveTrackNode}
            >
                <span
                    class="slider__track__fill"
                    style={{width: thumbPositionStyleValue}}
                ></span>
            </span>
            <span class="slider__thumb-wrapper">
                <span
                    class="slider__thumb"
                    oncreate={saveThumbNode}
                    style={{left: thumbPositionStyleValue}}
                >
                    <span
                        class={{
                            'slider__thumb__value': true,
                            'slider__thumb__value--flip': shouldFlipText,
                        }}
                    >
                        {formattedValue}
                    </span>
                </span>
            </span>
            <span class="slider__value">
                {formattedValue}
            </span>
        </span>
    );
}

```

### ui\controls\tab-panel\tab.tsx

```
import {m} from 'malevic';

interface TabProps {
    isActive: boolean;
}

export default function Tab({isActive}: TabProps, ...children: Malevic.Child[]) {
    const tabCls = {
        'tab-panel__tab': true,
        'tab-panel__tab--active': isActive,
    };

    return (
        <div class={tabCls}>
            {children}
        </div>
    );
}

```

### ui\controls\tab-panel\style.less

```
@import "../../theme";

.tab-panel {
    align-items: stretch;
    display: flex;
    flex-direction: column;
    min-height: 0;

    &__button {
        border-bottom: @size-border solid @color-border;
        border-left: none;
        border-right: none;
        border-top: none;
        box-sizing: border-box;
        color: @color-control-fore-inactive;
        font-size: @size-text-large;
        font-weight: bold;
        height: @size-control-inner + @size-border;
        padding: 0 @indent-small + @size-border;
        white-space: pre;

        &:hover {
            color: @color-fore;
        }

        &:active {
            background-color: @color-control-hover;
        }

        &--active {
            border-bottom: none;
            border-left: @size-border solid @color-border;
            border-right: @size-border solid @color-border;
            border-top: @size-border solid @color-border;
            color: @color-heading;
            padding: 0 @indent-small;

            &:hover {
                color: @color-heading;
            }
        }
    }

    &__buttons {
        display: flex;
        flex: none;
        flex-direction: row;
        justify-content: center;

        &::before,
        &::after {
            border-bottom: @size-border solid @color-border;
            content: "";
            flex: auto;
        }
    }

    &__tabs {
        display: flex;
        flex: auto;
        flex-direction: row;
        margin-top: @indent-large;
        min-height: 0;
    }

    &__tab {
        background-color: @color-back;
        display: flex;
        opacity: 0;
        overflow: hidden;
        pointer-events: none;
        transition: width @time-slow, opacity @time-fast;
        width: 0;

        &--active {
            opacity: 1;
            pointer-events: all;
            transition: width @time-slow, opacity @time-slow;
            width: 100%;
        }
    }
}

```

### ui\controls\tab-panel\index.tsx

```
import {m} from 'malevic';

import Button from '../button';

import Tab from './tab';

interface TabPanelProps {
    tabs: {
        [name: string]: Malevic.Child;
    };
    tabLabels: {
        [name: string]: string;
    };
    activeTab: string;
    onSwitchTab: (name: string) => void;
}

export default function TabPanel(props: TabPanelProps) {
    const tabsNames = Object.keys(props.tabs);

    function isActiveTab(name: string, index: number) {
        return (name == null
            ? index === 0
            : name === props.activeTab
        );
    }

    const buttons = tabsNames.map((name, i) => {
        const btnCls = {
            'tab-panel__button': true,
            'tab-panel__button--active': isActiveTab(name, i),
        };
        return (
            <Button
                class={btnCls}
                onclick={() => props.onSwitchTab(name)}
            >{props.tabLabels[name]}</Button>
        );
    });

    const tabs = tabsNames.map((name, i) => (
        <Tab isActive={isActiveTab(name, i)}>
            {props.tabs[name]}
        </Tab>
    ));

    return (
        <div class="tab-panel">
            <div class="tab-panel__buttons">
                {buttons}
            </div>
            <div class="tab-panel__tabs">
                {tabs}
            </div>
        </div>
    );
}

```

### ui\controls\text-list\index.tsx

```
import {m} from 'malevic';
import {getContext} from 'malevic/dom';

import TextBox from '../textbox';
import VirtualScroll from '../virtual-scroll';

interface TextListProps {
    values: string[];
    placeholder: string;
    isFocused?: boolean;
    class?: string;
    onChange: (values: string[]) => void;
}

export default function TextList(props: TextListProps) {
    const context = getContext();
    context.store.indices = context.store.indices || new WeakMap();

    function onTextChange(e: {target: HTMLInputElement}) {
        const index = context.store.indices.get(e.target);
        const values = props.values.slice();
        const value = e.target.value.trim();
        if (values.includes(value)) {
            return;
        }

        if (!value) {
            values.splice(index, 1);
        } else if (index === values.length) {
            values.push(value);
        } else {
            values.splice(index, 1, value);
        }

        props.onChange(values);
    }

    function createTextBox(text: string, index: number) {
        const saveIndex = (node: Element) => context.store.indices.set(node, index);
        return (
            <TextBox
                class="text-list__textbox"
                value={text}
                onrender={saveIndex}
                placeholder={props.placeholder}
            />
        );
    }

    let shouldFocus = false;

    const node = context.node;
    const prevProps: TextListProps | null = context.prev ? context.prev.props : null;
    if (node && props.isFocused && (
        !prevProps ||
        !prevProps.isFocused ||
        prevProps.values.length < props.values.length
    )) {
        focusLastNode();
    }

    function didMount(node: Element) {
        context.store.node = node;
        if (props.isFocused) {
            focusLastNode();
        }
    }

    function focusLastNode() {
        const node = context.store.node as Element;
        shouldFocus = true;
        requestAnimationFrame(() => {
            const inputs = node.querySelectorAll('.text-list__textbox');
            const last = inputs.item(inputs.length - 1) as HTMLInputElement;
            last.focus();
        });
    }

    return (
        <VirtualScroll
            root={(
                <div
                    class={['text-list', props.class]}
                    onchange={onTextChange}
                    oncreate={didMount}
                />
            )}
            items={props.values
                .map(createTextBox)
                .concat(createTextBox('', props.values.length))}
            scrollToIndex={shouldFocus ? props.values.length : -1}
        />
    );
}

```

### ui\controls\text-list\style.less

```
@import "../../theme";

.text-list {
    border-top: @size-border solid @color-border;
    margin-bottom: @size-border - @size-border-inner;
    min-width: @size-scrollbar-thickness + @indent-small + 2 * @size-border; // Fix scrollTop when animation starts, without this it becomes 0 after focus()
    overflow-x: hidden;
    overflow-y: auto;

    &__textbox.textbox {
        border-bottom: @size-border-inner solid @color-border;
        border-left: @size-border solid @color-border;
        border-right: @size-border solid @color-border;
        border-top: none;
        box-sizing: border-box;
        flex: none;
        height: @size-control-inner + @size-border-inner;
        width: 100%;

        &:last-child {
            border-bottom: @size-border solid @color-border;
        }
    }

    &::-webkit-scrollbar {
        width: @size-scrollbar-thickness + @indent-small;

        &-thumb {
            border-left: @indent-small solid @color-back;
        }
    }
}

```

### ui\controls\textbox\style.less

```
@import "../../theme";

.textbox {
    background-color: @color-input-back;
    border: @size-border solid @color-border;
    box-sizing: content-box;
    color: @color-input-fore;
    height: @size-control-inner;
    line-height: @size-control-inner;
    outline: none;
    overflow: hidden;
    padding: 0;
    text-indent: @size-control-inner / 2 - @size-text-normal / 2;
    transition: background-color @time-slow;

    &:hover,
    &:focus {
        background-color: @color-input-hover;
        transition: background-color @time-fast;
    }

    &:focus {
        color: @color-input-fore-active;
    }

    &::placeholder {
        color: @color-input-fore-placeholder;
    }
}

input[type="time"]::-webkit-calendar-picker-indicator {
    // This magic values were generated by hex-to-filter converter:
    // https://codepen.io/sosuke/pen/Pjoqqp
    filter: invert(54%) sepia(3%) saturate(3931%) hue-rotate(153deg) brightness(115%) contrast(75%);
}

```

### ui\controls\textbox\index.tsx

```
import {m} from 'malevic';

import {mergeClass, omitAttrs} from '../utils';

interface TextBoxProps extends Malevic.NodeAttrs {
    type?: 'text' | 'time';
    oninput?: (e: Event & {target: HTMLInputElement}) => void;
    onchange?: (e: Event & {target: HTMLInputElement}) => void;
}

export default function TextBox(props: TextBoxProps) {
    const cls = mergeClass('textbox', props.class);
    const attrs = omitAttrs(['class', 'type'], props);
    const type = props.type || 'text';

    return (
        <input class={cls} type={type} spellcheck="false" {...attrs} />
    );
}

```

### ui\controls\time-range-picker\index.tsx

```
import {m} from 'malevic';

import {parseTime} from '../../../utils/time';
import TextBox from '../textbox';

interface TimePickerProps {
    startTime: string;
    endTime: string;
    onChange: ([start, end]: [string, string]) => void;
}

function toLong24HTime($time: string) {
    const [hours, minutes] = parseTime($time);
    const hh = `${hours < 10 ? '0' : ''}${hours}`;
    const mm = `${minutes < 10 ? '0' : ''}${minutes}`;
    return `${hh}:${mm}`;
}

function to24HTime($time: string) {
    const [hours, minutes] = parseTime($time);
    const mm = `${minutes < 10 ? '0' : ''}${minutes}`;
    return `${hours}:${mm}`;
}

export default function TimeRangePicker(props: TimePickerProps) {
    function onStartTimeChange($startTime: string) {
        props.onChange([to24HTime($startTime), props.endTime]);
    }

    function onEndTimeChange($endTime: string) {
        props.onChange([props.startTime, to24HTime($endTime)]);
    }

    function setStartTime(node: HTMLInputElement) {
        node.value = toLong24HTime(props.startTime);
    }

    function setEndTime(node: HTMLInputElement) {
        node.value = toLong24HTime(props.endTime);
    }

    return (
        <span class="time-range-picker">
            <TextBox
                class="time-range-picker__input time-range-picker__input--start"
                type="time"
                placeholder="18:00"
                onrender={setStartTime}
                onchange={(e) => onStartTimeChange((e.target as HTMLInputElement).value)}
                onkeypress={(e) => {
                    if (e.key === 'Enter') {
                        const input = e.target as HTMLInputElement;
                        input.blur();
                        onStartTimeChange(input.value);
                    }
                }}

            />
            <TextBox
                class="time-range-picker__input time-range-picker__input--end"
                type="time"
                placeholder="09:00"
                onrender={setEndTime}
                onchange={(e) => onEndTimeChange((e.target as HTMLInputElement).value)}
                onkeypress={(e) => {
                    if (e.key === 'Enter') {
                        const input = e.target as HTMLInputElement;
                        input.blur();
                        onEndTimeChange(input.value);
                    }
                }}
            />
        </span>
    );
}

```

### ui\controls\time-range-picker\style.less

```
@import "../../theme";

.time-range-picker {
    display: inline-flex;
    flex: auto;

    &__input {
        text-align: center;
        text-indent: 0;
        width: 100%;
        background-color: @color-input-back;
    }

    &__input--start {
        border-right: none;
    }

    &__input--end {
        border-left: @size-border-inner solid @color-border;
    }
}

```

### ui\controls\toggle\index.tsx

```
import type {Child} from 'malevic';
import {m} from 'malevic';

interface ToggleProps {
    checked: boolean;
    class?: string;
    labelOn: Child;
    labelOff: Child;
    onChange: (checked: boolean) => void;
}

export default function Toggle(props: ToggleProps) {
    const {checked, onChange} = props;

    const cls = [
        'toggle',
        checked ? 'toggle--checked' : null,
        props.class,
    ];

    const clsOn = {
        'toggle__btn': true,
        'toggle__on': true,
        'toggle__btn--active': checked,
    };

    const clsOff = {
        'toggle__btn': true,
        'toggle__off': true,
        'toggle__btn--active': !checked,
    };

    return (
        <span class={cls}>
            <span
                class={clsOn}
                onclick={onChange ? () => !checked && onChange(true) : undefined}
            >
                {props.labelOn}
            </span>
            <span
                class={clsOff}
                onclick={onChange ? () => checked && onChange(false) : undefined}
            >
                {props.labelOff}
            </span>
        </span>
    );
}

```

### ui\controls\toggle\style.less

```
@import "../../theme";

.toggle {
    background-color: @color-control-back;
    border: @size-border solid @color-border;
    box-sizing: content-box;
    color: @color-control-fore;
    display: inline-flex;
    height: @size-control-inner;
    position: relative;
    -moz-user-select: none;
    user-select: none;

    &__btn {
        align-items: center;
        cursor: pointer;
        display: inline-flex;
        justify-content: center;
        height: 100%;
        overflow: hidden;
        position: relative;
        transition: background-color @time-slow;
        white-space: nowrap;
        width: 50%;

        &:hover:not(&--active) {
            background-color: @color-control-hover;
        }
    }

    &::before {
        background-color: @color-control-active;
        content: "";
        display: inline-block;
        height: 100%;
        left: 50%;
        position: absolute;
        top: 0;
        transition: left @time-fast;
        width: 50%;
    }

    &--checked {
        &::before {
            left: 0;
        }
    }
}

```

### ui\controls\updown\index.tsx

```
import {m} from 'malevic';

import {getLocalMessage} from '../../../utils/locales';
import Button from '../button';

import Track from './track';

interface UpDownProps {
    value: number;
    min: number;
    max: number;
    step: number;
    default: number;
    name: string;
    onChange: (value: number) => void;
}

export default function UpDown(props: UpDownProps) {
    const buttonDownCls = {
        'updown__button': true,
        'updown__button--disabled': props.value === props.min,
    };

    const buttonUpCls = {
        'updown__button': true,
        'updown__button--disabled': props.value === props.max,
    };

    function normalize(x: number) {
        const s = Math.round(x / props.step) * props.step;
        const exp = Math.floor(Math.log10(props.step));
        if (exp >= 0) {
            const m = 10 ** exp;
            return Math.round(s / m) * m;
        }
        const m = 10 ** -exp;
        return Math.round(s * m) / m;
    }

    function clamp(x: number) {
        return Math.max(props.min, Math.min(props.max, x));
    }

    function onButtonDownClick() {
        props.onChange(clamp(normalize(props.value - props.step)));
    }

    function onButtonUpClick() {
        props.onChange(clamp(normalize(props.value + props.step)));
    }

    function onTrackValueChange(trackValue: number) {
        props.onChange(clamp(normalize(trackValue * (props.max - props.min) + props.min)));
    }

    const trackValue = (props.value - props.min) / (props.max - props.min);
    const valueText = (props.value === props.default
        ? getLocalMessage('off').toLocaleLowerCase()
        : props.value > props.default
            ? `+${normalize(props.value - props.default)}`
            : `-${normalize(props.default - props.value)}`
    );

    return (
        <div class="updown">
            <div class="updown__line">
                <Button class={buttonDownCls} onclick={onButtonDownClick} >
                    <span class="updown__icon updown__icon-down"></span>
                </Button>
                <Track
                    value={trackValue}
                    label={props.name}
                    onChange={onTrackValueChange}
                />
                <Button class={buttonUpCls} onclick={onButtonUpClick} >
                    <span class="updown__icon updown__icon-up"></span>
                </Button>
            </div>
            <label class="updown__value-text">
                {valueText}
            </label>
        </div>
    );
}

```

### ui\controls\updown\style.less

```
@import "../../theme";

.updown {
    align-items: stretch;
    display: flex;
    flex-direction: column;
    -moz-user-select: none;
    user-select: none;

    &__line {
        display: flex;
        flex-direction: row;

        > :not(:first-child) {
            margin-left: @indent-small;
        }
    }

    &__icon {
        display: inline-block;
        height: 100%;
        position: relative;
        width: 100%;

        &::before,
        &::after {
            background-color: @color-control-fore;
            content: "";
            display: inline-block;
            height: @size-control-inner * 0.375;
            position: absolute;
            width: @size-control-inner * 0.125;
        }

        &::before {
            top: @size-control-inner * 0.125;
        }

        &::after {
            top: @size-control-inner * 0.5;
        }
    }

    &__icon-up {
        &::before {
            left: @size-control-inner * 0.5;
            transform: skewX(45deg);
        }
        &::after {
            left: @size-control-inner * 0.5;
            transform: skewX(-45deg);
        }
    }

    &__icon-down {
        &::before {
            left: @size-control-inner * 0.375;
            transform: skewX(-45deg);
        }
        &::after {
            left: @size-control-inner * 0.375;
            transform: skewX(45deg);
        }
    }

    &__button--disabled {
        pointer-events: none;

        &:hover,
        &:active {
            background-color: @color-control-back;
        }
    }

    &__button--disabled &__icon {
        &::before,
        &::after {
            background-color: @color-control-fore-inactive;
        }
    }

    &__value-text {
        font-size: @size-text-small;
        line-height: @size-text-small-height;
        text-align: center;
        white-space: nowrap;
    }
}

.track {
    align-items: center;
    background-color: @color-control-back;
    border: @size-border solid @color-border;
    box-sizing: content-box;
    display: inline-flex;
    flex: auto;
    flex-direction: row;
    height: @size-control-inner;
    justify-content: center;
    overflow: hidden;
    position: relative;
    transition: background-color @time-slow;
    -moz-user-select: none;
    user-select: none;

    &:hover {
        background-color: @color-control-hover;
        transition: background-color @time-fast;
    }

    &--clickable {
        cursor: pointer;
    }

    &__value {
        background-color: @color-control-active;
        height: 100%;
        left: 0;
        position: absolute;
        top: 0;
        transition: width @time-fast;
    }

    &__label {
        color: @color-control-fore;
        display: inline-block;
        line-height: @size-text-normal;
        pointer-events: none;
        position: relative;
        white-space: nowrap;
        z-index: 1;
    }
}

```

### ui\controls\updown\track.tsx

```
import {m} from 'malevic';

interface TrackProps {
    value: number;
    label: string;
    onChange?: (value: number) => void;
}

export default function Track(props: TrackProps) {
    const valueStyle = {'width': `${props.value * 100}%`};
    const isClickable = Boolean(props.onChange);

    function onMouseDown(e: MouseEvent) {
        const targetNode = e.currentTarget as HTMLElement;
        const valueNode = targetNode.firstElementChild as HTMLElement;
        targetNode.classList.add('track--active');

        function getValue(clientX: number) {
            const rect = targetNode.getBoundingClientRect();
            return (clientX - rect.left) / rect.width;
        }

        function setWidth(value: number) {
            valueNode.style.width = `${value * 100}%`;
        }

        function onMouseMove(e: MouseEvent) {
            const value = getValue(e.clientX);
            setWidth(value);
        }

        function onMouseUp(e: MouseEvent) {
            const value = getValue(e.clientX);
            props.onChange!(value);
            cleanup();
        }

        function onKeyPress(e: KeyboardEvent) {
            if (e.key === 'Escape') {
                setWidth(props.value);
                cleanup();
            }
        }

        function cleanup() {
            window.removeEventListener('mousemove', onMouseMove);
            window.removeEventListener('mouseup', onMouseUp);
            window.removeEventListener('keypress', onKeyPress);
            targetNode.classList.remove('track--active');
        }

        window.addEventListener('mousemove', onMouseMove, {passive: true});
        window.addEventListener('mouseup', onMouseUp, {passive: true});
        window.addEventListener('keypress', onKeyPress, {passive: true});

        const value = getValue(e.clientX);
        setWidth(value);
    }

    return (
        <span
            class={{
                'track': true,
                'track--clickable': Boolean(props.onChange),
            }}
            onmousedown={isClickable ? onMouseDown : undefined}
        >
            <span class="track__value" style={valueStyle}></span>
            <label class="track__label">
                {props.label}
            </label>
        </span >
    );
}

```

### ui\controls\virtual-scroll\index.tsx

```
import {m} from 'malevic';
import {render, getContext} from 'malevic/dom';

interface VirtualScrollProps {
    root: Malevic.Spec;
    items: Malevic.Spec[];
    scrollToIndex?: number | null | undefined;
}

export default function VirtualScroll(props: VirtualScrollProps) {
    if (props.items.length === 0) {
        return props.root;
    }

    const {store} = getContext();

    function renderContent(root: Element, scrollToIndex: number) {
        if (root.clientWidth === 0) {
            return;
        }

        if (store.itemHeight == null) {
            const tempItem = {
                ...props.items[0],
                props: {
                    ...props.items[0].props,
                    oncreate: null,
                    onupdate: null,
                    onrender: null,
                },
            };
            const tempNode = render(root, tempItem).firstElementChild!;
            store.itemHeight = tempNode.getBoundingClientRect().height;
        }
        const {itemHeight} = store;

        const wrapper = render(root, (
            <div
                style={{
                    'flex': 'none',
                    'height': `${props.items.length * itemHeight}px`,
                    'overflow': 'hidden',
                    'position': 'relative',
                }}
            />
        )).firstElementChild;

        if (scrollToIndex >= 0) {
            root.scrollTop = scrollToIndex * itemHeight;
        }
        const containerHeight = document.documentElement.clientHeight - root.getBoundingClientRect().top; // Use this height as a fix for animated height

        // Prevent removing focused element
        let focusedIndex = -1;
        if (document.activeElement) {
            let current = document.activeElement;
            while (current && current.parentElement !== wrapper) {
                current = current.parentElement!;
            }
            if (current) {
                focusedIndex = store.nodesIndices.get(current);
            }
        }

        store.nodesIndices = store.nodesIndices || new WeakMap();
        const saveNodeIndex = (node: Element, index: number) => store.nodesIndices.set(node, index);

        const items = props.items
            .map((item, index) => {
                return {item, index};
            })
            .filter(({index}) => {
                const eTop = index * itemHeight;
                const eBottom = (index + 1) * itemHeight;
                const rTop = root.scrollTop;
                const rBottom = root.scrollTop + containerHeight;
                const isTopBoundVisible = eTop >= rTop && eTop <= rBottom;
                const isBottomBoundVisible = eBottom >= rTop && eBottom <= rBottom;
                return isTopBoundVisible || isBottomBoundVisible || focusedIndex === index;
            })
            .map(({item, index}) => (
                <div
                    key={index}
                    onrender={(node) => saveNodeIndex(node, index)}
                    style={{
                        'left': '0',
                        'position': 'absolute',
                        'top': `${index * itemHeight}px`,
                        'width': '100%',
                    }}
                >
                    {item}
                </div>
            ));

        render(wrapper!, items);
    }

    let rootNode: Element;
    let prevScrollTop: number;
    const rootDidMount = props.root.props.oncreate;
    const rootDidUpdate = props.root.props.onupdate;
    const rootDidRender = props.root.props.onrender;

    return {
        ...props.root,
        props: {
            ...props.root.props,
            oncreate: rootDidMount,
            onupdate: rootDidUpdate,
            onrender: (node) => {
                rootNode = node;
                rootDidRender && rootDidRender(rootNode);
                // TODO: remove type cast after dependency update
                renderContent(rootNode, isNaN(props.scrollToIndex!) ? -1 : props.scrollToIndex!);
            },
            onscroll: () => {
                if (rootNode.scrollTop === prevScrollTop) {
                    return;
                }
                prevScrollTop = rootNode.scrollTop;
                renderContent(rootNode, -1);
            },
        },
        children: [],
    } as Malevic.Spec;
}

```

### ui\controls\utils.ts

```
import {classes} from '../utils';

function toArray<T>(x: T | T[]): T[] {
    return Array.isArray(x) ? x : [x];
}

export function mergeClass(
    cls: string | {[cls: string]: any} | Array<string | {[cls: string]: any}>,
    propsCls: string | {[cls: string]: any} | Array<string | {[cls: string]: any}> | undefined
): string {
    const normalized = toArray(cls).concat(toArray(propsCls));
    return classes(...normalized);
}

export function omitAttrs(omit: string[], attrs: Malevic.NodeAttrs): Malevic.NodeAttrs<Element, Element> {
    const result: Malevic.NodeAttrs = {};
    Object.keys(attrs).forEach((key) => {
        if (omit.indexOf(key) < 0) {
            result[key] = attrs[key];
        }
    });
    return result;
}

export function isElementHidden(element: HTMLElement): boolean {
    return element.offsetParent === null;
}

```

### ui\controls\style.less

```
@import "./button/style";
@import "./check-button/check-button";
@import "./checkbox/style";
@import "./control-group/control-group";
@import "./dropdown/style";
@import "./message-box/style";
@import "./multi-switch/style";
@import "./overlay/style";
@import "./shortcut/style";
@import "./tab-panel/style";
@import "./select/style";
@import "./slider/style";
@import "./text-list/style";
@import "./textbox/style";
@import "./time-range-picker/style";
@import "./toggle/style";
@import "./updown/style";

@import "./color-picker/style";
@import "./color-dropdown/style";
@import "./nav-button/style";
@import "./reset-button/style";


```

### ui\controls\index.ts

```
import Button from './button';
import CheckButton from './check-button/check-button';
import CheckBox from './checkbox';
import ColorDropDown from './color-dropdown';
import ColorPicker from './color-picker';
import ControlGroup from './control-group/control-group';
import DropDown from './dropdown';
import MessageBox from './message-box';
import MultiSwitch from './multi-switch';
import NavButton from './nav-button';
import Overlay from './overlay';
import ResetButton from './reset-button';
import Select from './select';
import Shortcut from './shortcut';
import Slider from './slider';
import TabPanel from './tab-panel';
import TextList from './text-list';
import TextBox from './textbox';
import TimeRangePicker from './time-range-picker';
import Toggle from './toggle';
import UpDown from './updown';

export {
    Button,
    CheckBox,
    CheckButton,
    ColorDropDown,
    ColorPicker,
    ControlGroup,
    DropDown,
    MessageBox,
    MultiSwitch,
    NavButton,
    Overlay,
    ResetButton,
    Select,
    Shortcut,
    Slider,
    TabPanel,
    TextBox,
    TextList,
    TimeRangePicker,
    Toggle,
    UpDown,
};

```

### ui\devtools\components\body.tsx

```
import {m} from 'malevic';
import {getContext} from 'malevic/dom';

import {ThemeEngine} from '../../../generators/theme-engines';
import {isMobile} from '../../../utils/platform';
import {Button, Overlay} from '../../controls';
import TabPanel from '../../options/tab-panel/tab-panel';
import {getCurrentThemePreset} from '../../popup/theme/utils';
import type {DevtoolsProps} from '../types';

import {ConfigEditor} from './config-editor';
import {DynamicModeEditor} from './dynamic-mode-editor';

declare const __PLUS__: boolean;

export default function Body(props: DevtoolsProps): Malevic.Child {
    const {data, actions, devtools} = props;
    const context = getContext();
    const {theme} = getCurrentThemePreset({data, actions});
    const defaultTabId: string = {
        [ThemeEngine.dynamicTheme]: 'dynamic-editor',
        [ThemeEngine.staticTheme]: 'static-editor',
        [ThemeEngine.cssFilter]: 'filter-editor',
        [ThemeEngine.svgFilter]: 'filter-editor',
    }[theme.engine];
    const store = context.getStore({errorText: '', activeTabId: defaultTabId});

    function onTabChange(tabId: string) {
        store.activeTabId = tabId;
        context.refresh();
    }

    const previewButtonText = data.settings.previewNewDesign ? 'Switch to old design' : 'Preview new design';
    const previewNewestButtonText = data.settings.previewNewestDesign ? 'Switch to desktop design' : 'Preview new mobile design';

    function toggleDesign(): void {
        actions.changeSettings({previewNewDesign: !data.settings.previewNewDesign, previewNewestDesign: false});
    }

    function toggleNewestDesign(): void {
        actions.changeSettings({previewNewestDesign: !data.settings.previewNewestDesign, previewNewDesign: false});
    }

    return (
        <body>
            <header>
                <img id="logo" src="../assets/images/darkreader-type.svg" alt="Dark Reader" />
                <h1 id="title">Developer Tools</h1>
            </header>
            <TabPanel activeTabId={store.activeTabId} onTabChange={onTabChange}>
                <TabPanel.Tab id="dynamic-editor" label="Dynamic Theme Editor">
                    <DynamicModeEditor {...props} />
                </TabPanel.Tab>
                <TabPanel.Tab id="static-editor" label="Static Theme Editor">
                    <ConfigEditor
                        header="Static Theme Editor"
                        text={devtools.staticThemesText}
                        apply={(text) => actions.applyDevStaticThemes(text)}
                        reset={() => actions.resetDevStaticThemes()}
                    />
                </TabPanel.Tab>
                <TabPanel.Tab id="filter-editor" label="Inversion Fix Editor">
                    <ConfigEditor
                        header="Inversion Fix Editor"
                        text={devtools.filterFixesText}
                        apply={(text) => actions.applyDevInversionFixes(text)}
                        reset={() => actions.resetDevInversionFixes()}
                    />
                </TabPanel.Tab>
                <TabPanel.Tab id="advanced" label="Advanced">
                    <div class="buttons">
                        {isMobile || (__PLUS__ && !data.settings.previewNewDesign) ? null : <Button class="preview-design-button" onclick={toggleDesign}>{previewButtonText}</Button>}
                        {__PLUS__ ? <Button class="preview-design-button" onclick={toggleNewestDesign}>{previewNewestButtonText}</Button> : null}
                    </div>
                </TabPanel.Tab>
            </TabPanel>
            <Overlay />
        </body>
    );
}

```

### ui\devtools\components\dynamic-per-site.tsx

```
import {m} from 'malevic';
import {getContext} from 'malevic/dom';

import type {DynamicThemeFix} from '../../../definitions';
import {parseDynamicThemeFixes, formatDynamicThemeFixes} from '../../../generators/dynamic-theme';
import {Button, TextBox} from '../../controls';
import type {DevtoolsProps} from '../types';

import {ConfigEditor} from './config-editor';

export function DynamicPerSiteEditor(props: DevtoolsProps): Malevic.Child {
    const context = getContext();
    const store = context.getStore({
        errorText: '',
        fixes: [] as DynamicThemeFix[],
        fixesLength: 0,
        search: '',
        currentFix: null as (DynamicThemeFix | null),
    });

    const fixesText = props.devtools.dynamicFixesText;
    const didFixesChange = store.fixesLength !== fixesText.length;
    if (didFixesChange) {
        store.fixes = parseDynamicThemeFixes(fixesText);
        store.fixesLength = fixesText.length;
    }

    if (store.currentFix && !store.fixes.includes(store.currentFix)) {
        const u1 = store.currentFix.url;
        const sameURLFix = store.fixes.find((f) => {
            const u2 = f.url;
            return u1.length === u2.length && u1.every((u, i) => u === u2[i]);
        });
        if (sameURLFix) {
            store.currentFix = sameURLFix;
        } else {
            store.currentFix = null;
        }
    }

    function onSearchInput(e: Event) {
        const element = e.target as HTMLInputElement;
        store.search = element.value;
        store.currentFix = null;
        context.refresh();
    }

    async function apply(text: string) {
        const [change] = parseDynamicThemeFixes(text);
        const index = store.fixes.indexOf(store.currentFix!);
        store.fixes[index] = change;
        store.currentFix = change;
        const config = formatDynamicThemeFixes(store.fixes);
        await props.actions.applyDevDynamicThemeFixes(config);
    }

    function addNewFix() {
        const newFixURL = store.search;
        if (!newFixURL) {
            ((context.node as Element).querySelector('.js-search') as HTMLInputElement).focus();
            return;
        }
        const newFix: DynamicThemeFix = {
            url: [newFixURL],
            invert: [],
            css: '',
            ignoreImageAnalysis: [],
            ignoreInlineStyle: [],
            disableStyleSheetsProxy: false,
            disableCustomElementRegistryProxy: false,
        };
        store.fixes.push(newFix);
        store.currentFix = newFix;
        const config = formatDynamicThemeFixes(store.fixes);
        props.actions.applyDevDynamicThemeFixes(config);
    }

    const fixText = store.currentFix ? formatDynamicThemeFixes([store.currentFix]) : '';
    const filteredFixes = store.search ? store.fixes.filter(({url}) => url.some((u) => u.includes(store.search))) : store.fixes;

    return (
        <div class="dynamic-per-site">
            <div class="dynamic-per-site__search-wrapper">
                <TextBox class="dynamic-per-site__search-input js-search" type="text" oninput={onSearchInput} placeholder="Search by URL" />
            </div>
            <list class="dynamic-per-site__urls">
                {filteredFixes.map((fix) => {
                    const text = fix.url.join(' ');
                    return <li>
                        <Button
                            class={{
                                'dynamic-per-site__url': true,
                                'dynamic-per-site__url--active': fix === store.currentFix,
                            }}
                            onclick={() => {
                                store.currentFix = fix === store.currentFix ? null : fix;
                                context.refresh();
                            }}
                        >
                            {text}
                        </Button>
                    </li>;
                })}
            </list>
            {store.currentFix ? (
                <ConfigEditor
                    text={fixText}
                    apply={apply}
                    reset={() => {
                        props.actions.resetDevDynamicThemeFixes();
                    }}
                    delete={async () => {
                        const index = store.fixes.indexOf(store.currentFix!);
                        store.fixes.splice(index, 1);
                        store.currentFix = null;
                        const config = formatDynamicThemeFixes(store.fixes);
                        await props.actions.applyDevDynamicThemeFixes(config);
                    }}
                />
            ) : (
                <div class="dynamic-per-site__add-fix">
                    <Button onclick={addNewFix} class="dynamic-per-site__add-fix__button">
                        Create new fix
                    </Button>
                    <p class="dynamic-per-site__add-fix__description">
                        Search for an <strong>existing fix</strong> or enter a <strong>domain name</strong><br />for a new fix and click <strong>Create</strong>
                    </p>
                </div>
            )}
        </div>
    );
}

```

### ui\devtools\components\config-editor.tsx

```
import {m} from 'malevic';
import {getContext} from 'malevic/dom';

import {DEVTOOLS_DOCS_URL} from '../../../utils/links';
import {isFirefox} from '../../../utils/platform';
import {Button, MessageBox} from '../../controls';

interface ConfigEditorProps {
    header?: string;
    text: string;
    apply?: (text: string) => Promise<void>;
    reset?: () => void;
    delete?: () => void;
}

export function ConfigEditor(props: ConfigEditorProps): Malevic.Child {
    const context = getContext();
    const store = context.getStore({
        dialogMessage: '',
        dialogAction: null as (() => void) | null,
        errorText: '',
    });

    let textNode: HTMLTextAreaElement;

    function onTextRender(node: HTMLTextAreaElement) {
        textNode = node;

        if (!store.errorText) {
            textNode.value = props.text;
        }

        node.addEventListener('keydown', ({key, preventDefault}) => {
            if (key === 'Tab') {
                preventDefault();
                const indent = ' '.repeat(4);
                if (isFirefox) {
                    // https://bugzilla.mozilla.org/show_bug.cgi?id=1220696
                    const start = node.selectionStart;
                    const end = node.selectionEnd;
                    const before = node.value.substring(0, start);
                    const after = node.value.substring(end);
                    node.focus();
                    node.value = `${before}${indent}${after}`;
                    const cursorPos = start + indent.length;
                    node.setSelectionRange(cursorPos, cursorPos);
                } else {
                    document.execCommand('insertText', false, indent);
                }
            }
        });
    }

    async function apply(): Promise<void> {
        const text = textNode.value;
        try {
            await props.apply!(text);
            store.errorText = '';
        } catch (err) {
            store.errorText = String(err);
        }
        context.refresh();
    }

    function showDialog(message: string, action: () => void): void {
        store.dialogMessage = message;
        store.dialogAction = action;
        context.refresh();
    }

    function reset(): void {
        store.dialogMessage = '';
        store.dialogAction = null;
        store.errorText = '';
        props.reset!();
        context.refresh();
    }

    function showResetDialog() {
        showDialog(
            'Are you sure you want to remove the current changes? You cannot restore them later.',
            reset,
        );
    }

    function showDeleteDialog() {
        showDialog(
            'Are you sure you want to delete the fix?',
            props.delete!,
        );
    }

    function hideDialog(): void {
        store.dialogMessage = '';
        store.dialogAction = null;
        context.refresh();
    }

    const dialog = store.dialogMessage && store.dialogAction ? (
        <MessageBox
            caption={store.dialogMessage}
            onOK={store.dialogAction}
            onCancel={hideDialog}
        />
    ) : null;

    return (
        <div class="config-editor">
            {props.header ? <h3 class="sub-title">{props.header}</h3> : null}
            <textarea
                class="editor"
                onrender={onTextRender}
                spellcheck="false"
                autocorrect="off"
                autocomplete="off"
                autocapitalize="off"
            />
            <label class="error-text">{store.errorText}</label>
            <div class="buttons">
                {props.delete ? <Button onclick={showDeleteDialog}>Delete</Button> : null}
                {props.reset ? <Button onclick={showResetDialog}>Reset changes</Button> : null}
                {props.apply ? <Button onclick={apply}>Apply</Button> : null}
            </div>
            <p class="description">
                Read about this tool <strong><a href={DEVTOOLS_DOCS_URL} target="_blank" rel="noopener noreferrer">here</a></strong>.
                If a <strong>popular</strong> website looks incorrect
                e-mail to <strong>support@darkreader.org</strong>
            </p>
            {dialog}
        </div>
    );
}

```

### ui\devtools\components\dynamic-mode-editor.tsx

```
import {m} from 'malevic';
import {getContext} from 'malevic/dom';

import TabPanel from '../../options/tab-panel/tab-panel';
import type {DevtoolsProps} from '../types';

import {ConfigEditor} from './config-editor';
import {DynamicPerSiteEditor} from './dynamic-per-site';

export function DynamicModeEditor(props: DevtoolsProps): Malevic.Child {
    const context = getContext();
    const store = context.getStore({activeTabId: 'full-editor'});

    function onTabChange(tabId: string) {
        store.activeTabId = tabId;
        context.refresh();
    }

    return (
        <div class="dynamic-mode-editor">
            <TabPanel isVertical activeTabId={store.activeTabId} onTabChange={onTabChange}>
                <TabPanel.Tab id="full-editor" label="Full Editor">
                    <ConfigEditor
                        text={props.devtools.dynamicFixesText}
                        apply={(text) => props.actions.applyDevDynamicThemeFixes(text)}
                        reset={() => props.actions.resetDevDynamicThemeFixes()}
                    />
                </TabPanel.Tab>
                <TabPanel.Tab id="per-site-editor" label="Per Site Editor">
                    <DynamicPerSiteEditor {...props} />
                </TabPanel.Tab>
            </TabPanel>
        </div>
    );
}

```

### ui\devtools\style.less

```
@import "../theme";
@import "../shared";
@import "../options/tab-panel/tab-panel.less";

@editor-active-back: mix(@color-input-back, @color-input-active, 75%);
@editor-active-fore: mix(@color-input-fore, @color-input-fore-active, 75%);

html {
    height: 100%;
    margin: 0;
}

body {
    align-items: flex-start;
    box-sizing: border-box;
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
    height: 100%;
    margin: 0;
    padding: 1rem;
}

header {
    align-items: stretch;
    box-sizing: content-box;
    display: flex;
    flex: none;
    flex-direction: row;
    flex-wrap: nowrap;
    justify-content: flex-start;
}

#logo {
    display: inline-block;
    font-size: @size-text-large;
    height: @size-control-inner;
    width: 15rem;
}

#title {
    align-items: stretch;
    display: inline-flex;
    flex-direction: row;
    font-size: @size-control-inner * 4 / 3;
    font-weight: 100;
    line-height: @size-control-inner;
    height: @size-control-inner;
    margin: 0 0 0 @indent-small;
    text-transform: uppercase;
    transform: translateY(-0.0625rem);
}

.config-editor {
    display: flex;
    flex-direction: column;
    height: 100%;
}

.sub-title {
    flex: none;
    font-size: @size-text-normal;
    font-weight: normal;
    margin: 0.3rem 0 @indent-large 0;
    text-transform: uppercase;
}

.editor {
    background-color: @color-input-back;
    border: @size-border solid @color-border;
    box-sizing: border-box;
    color: @color-input-fore;
    flex: auto;
    font-family: monospace;
    font-size: @size-text-normal;
    min-width: 9rem;
    outline: none;
    padding: @size-control-inner / 2 - @size-text-normal / 2;
    resize: none;
    white-space: pre;
    width: 100%;

    &::placeholder {
        color: @color-input-fore-placeholder;
    }

    &:hover {
        background-color: @editor-active-back;

        &::-webkit-scrollbar,
        &::-webkit-scrollbar-corner {
            background-color: @editor-active-back;
        }
    }

    &:focus {
        background-color: @editor-active-back;
        color: @editor-active-fore;

        &::-webkit-scrollbar,
        &::-webkit-scrollbar-corner {
            background-color: @editor-active-back;
        }
    }
}

.error-text {
    color: @color-error;
    flex: none;
    font-family: monospace;
    white-space: pre;
}

.buttons {
    display: flex;
    flex: none;
    flex-direction: row;
    justify-content: flex-start;
    margin-top: @indent-small;
    width: 100%;

    > :not(:first-child) {
        margin-left: @indent-small;
    }

    .button {
        min-width: 3rem;
        max-width: 6rem;
        width: 100%;
    }
}

.description {
    flex: none;
    margin: @indent-large 0 0 0;
    text-align: left;
    white-space: wrap;

    a {
        color: @color-fore;
    }
}

@media screen and (max-width: 36rem) {
    #title {
        display: none;
    }
}

@media screen and (max-height: 33rem) {
    header,
    .description {
        display: none;
    }

    .sub-title {
        margin-top: @indent-small;
    }
}

.message-box {
    border: @size-border solid @color-border;
}

.preview-design-button {
    padding: 0 0.5rem;
}

.settings-tab-panel {
    height: 100%;
    overflow: hidden;
    width: 100%;

    &__tab {
        height: 100%;
    }

    &__button__icon {
        display: none;
    }

    &--vertical {
        gap: 0;
    }
}

.dynamic-mode-editor {
    height: 100%;
}

.dynamic-per-site {
    display: grid;
    gap: 0.5rem;
    grid: "search editor" @size-control-inner + 2 * @size-border
          "list   editor" auto
          / 10rem auto;
    height: 100%;
    overflow: hidden;

    &__search-wrapper {
        grid-area: search;
    }

    &__search-input {
        width: calc(100% - 2 * @size-border);
    }

    &__urls {
        grid-area: list;
        overflow: auto;

        li {
            list-style-type: none;
        }
    }

    &__url {
        border: none;
        color: @color-fore;
        height: @size-control-inner;
        text-align: left;
        width: 100%;

        &--active {
            color: @color-heading;
            font-weight: bold;
        }
    }

    .config-editor {
        grid-area: editor;
    }

    &__add-fix {
        &__button {
            padding: 0 0.5rem;
        }

        &__description {
            margin: 0.5rem 0 0 0;
        }
    }
}

```

### ui\devtools\types.d.ts

```
import type {DevToolsData, ExtWrapper} from '../../definitions';

export type DevtoolsProps = ExtWrapper & {devtools: DevToolsData};

```

### ui\devtools\index.tsx

```
import {m} from 'malevic';
import {sync} from 'malevic/dom';

import type {DevToolsData, ExtensionData} from '../../definitions';
import Connector from '../connect/connector';

import Body from './components/body';

declare const __CHROMIUM_MV3__: boolean;

function renderBody(data: ExtensionData, devToolsData: DevToolsData, actions: Connector) {
    sync(document.body, <Body data={data} devtools={devToolsData} actions={actions} />);
}

async function start(): Promise<void> {
    const connector = new Connector();
    window.addEventListener('unload', () => connector.disconnect(), {passive: true});

    let [data, devToolsData] = await Promise.all([
        connector.getData(),
        connector.getDevToolsData(),
    ]);
    renderBody(data, devToolsData, connector);
    connector.subscribeToChanges(async (data_) => {
        data = data_;
        devToolsData = await connector.getDevToolsData();
        renderBody(data, devToolsData, connector);
    });
}

start();

declare const __TEST__: boolean;
if (__TEST__) {
    const socket = new WebSocket(`ws://localhost:8894`);
    socket.onopen = async () => {
        socket.send(JSON.stringify({
            data: {
                type: 'devtools',
                uuid: `ready-${document.location.pathname}`,
            },
            id: null,
        }));
    };
    socket.onmessage = (e) => {
        const respond = (message: {id: number; data?: string | boolean; error?: string}) => socket.send(JSON.stringify(message));
        const message: {type: string; id: number; data: string} = JSON.parse(e.data);
        const {type, id, data} = message;
        try {
            const textarea: HTMLTextAreaElement = document.querySelector('.config-editor textarea.editor')!;
            const [buttonReset, buttonApply] = document.querySelectorAll('.config-editor .buttons button');
            switch (type) {
                case 'devtools-click': {
                    let attempts = 4;
                    const click = () => {
                        const element: HTMLElement | null = document.querySelector(data);
                        if (element) {
                            element.click();
                            respond({id, data: true});
                        } else if (attempts === 0) {
                            respond({id, data: false});
                        } else {
                            attempts--;
                            requestIdleCallback(click, {timeout: 500});
                        }
                    };

                    click();
                    break;
                }
                case 'devtools-exists': {
                    // The required element may not exist yet
                    let attempts = 4;
                    const check = () => {
                        const element: HTMLElement | null = document.querySelector(data);
                        if (element) {
                            respond({id, data: true});
                        } else if (attempts === 0) {
                            respond({id, data: false});
                        } else {
                            attempts--;
                            requestIdleCallback(check, {timeout: 500});
                        }
                    };

                    check();
                    break;
                }
                case 'devtools-paste':
                    textarea.value = data;
                    (buttonApply as HTMLButtonElement).click();
                    respond({id});
                    break;
                case 'devtools-reset':
                    respond({id});
                    (buttonReset as HTMLButtonElement).click();
                    (document.querySelector('button.message-box__button-ok') as HTMLButtonElement).click();
                    break;
            }
        } catch (err) {
            respond({id, error: String(err)});
        }
    };
}

if (__CHROMIUM_MV3__) {
    // See getExtensionPageTabMV3() for explanation of what it is
    chrome.runtime.onMessage.addListener((message, _, sendResponse) => {
        if (message === 'getExtensionPageTabMV3_ping') {
            sendResponse('getExtensionPageTabMV3_pong');
        }
    });
}

```

### ui\icons\help-icon.tsx

```
import {m} from 'malevic';

export function HelpIcon(): Malevic.Child {
    return (
        <svg viewBox="0 0 16 16">
            <circle fill="none" stroke="currentColor" stroke-width="1" cx="8" cy="8" r="7" />
            <text fill="currentColor" x="8" y="12" text-anchor="middle" font-size="12" font-weight="bold">
                ?
            </text>
        </svg>
    );
}

```

### ui\icons\delete-icon.tsx

```
import {m} from 'malevic';

export function DeleteIcon(): Malevic.Child {
    return (
        <svg viewBox="0 0 16 16">
            <path fill="currentColor" d="M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0V6z" />
            <path fill="currentColor" fill-rule="evenodd" d="M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1v1zM4.118 4 4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4H4.118zM2.5 3V2h11v1h-11z" />
        </svg>
    );
}

```

### ui\icons\advanced-icon.tsx

```
import {m} from 'malevic';

export function AdvancedIcon(): Malevic.Child {
    return (
        <svg viewBox="0 0 16 16">
            <defs>
                <path id="cog" d="M-1.25,-6.5 h2.5 l1,3 h-4.5 z" />
                <g id="cogwheel">
                    <path d="M0,-5 a5,5 0 0 1 0,10 a5,5 0 0 1 0,-10 z M0,-3 a3,3 0 0 0 0,6 a3,3 0 0 0 0,-6 z" />
                    <use href="#cog" />
                    <use href="#cog" transform="rotate(60)" />
                    <use href="#cog" transform="rotate(120)" />
                    <use href="#cog" transform="rotate(180)" />
                    <use href="#cog" transform="rotate(240)" />
                    <use href="#cog" transform="rotate(300)" />
                </g>
            </defs>
            <g fill="currentColor">
                <use href="#cogwheel" transform="translate(8 4) scale(0.5)" />
                <use href="#cogwheel" transform="translate(4 11) scale(0.5)" />
                <use href="#cogwheel" transform="translate(12 11) scale(0.5)" />
            </g>
        </svg>
    );
}

```

### ui\icons\icons.less

```
@icon-escaped-color: escape(@color-control-fore-inactive);
@icon-check: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 8 8"><path fill="white" d="M0,4 l2,2 l5,-5 v1.5 l-5,5 l-2,-2 z"/></svg>');
@icon-close: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 8 8"><path fill="none" stroke="white" stroke-width="1" d="M1,1 l6,6 M1,7 l6,-6"/></svg>');
@icon-close-inactive: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 8 8"><path fill="none" stroke="@{icon-escaped-color}" stroke-width="1" d="M1,1 l6,6 M1,7 l6,-6"/></svg>');
@icon-cross: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 8 8"><path fill="@{icon-escaped-color}" d="M1,0.5 l6,6 v1.5 l-6,-6 Z M1,6.5 l6,-6 v1.5 l-6,6 z"/></svg>');
@icon-down: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 8 8"><path fill="white" d="M1,2 l3,3 l3,-3 v1.5 l-3,3 l-3,-3 z"/></svg>');
@icon-left: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 8 8"><path fill="white" d="M6,1 h-1.5 l-3,3 l3,3 h1.5 l-3,-3 z"/></svg>');
@icon-list: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 8 8"><path fill="white" d="M0,0 h1 v1 h-1 z m2,0 h6 v1 h-6 z m-2,3.25 h1 v1 h-1 z m2,0 h6 v1 h-6 z m-2,3.25 h1 v1 h-1 z m2,0 h6 v1 h-6 z"/></svg>');
@icon-minus: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 8 8"><path fill="white" d="M0,3 h8 v2 h-8 z"/></svg>');
@icon-plus: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 8 8"><path fill="white" d="M3,0 h2 v3 h3 v2 h-3 v3 h-2 v-3 h-3 v-2 h3 z"/></svg>');
@icon-reset: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 8 8"><path fill="white" d="M4,1 v-1 l1.5,1.5 l-1.5,1.5 v-1 a2,2 0 1 0 2,2 h1 a3,3 0 1 1 -3,-3 z"/></svg>');
@icon-right: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 8 8"><path fill="white" d="M2,1 h1.5 l3,3 l-3,3 h-1.5 l3,-3 z"/></svg>');
@icon-settings: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 16 16"><defs><path id="cog" d="M-1.25,-6.5 h2.5 l1,3 h-4.5 z" /></defs><g transform="translate(8 8)" fill="white"><path d="M0,-5 a5,5 0 0 1 0,10 a5,5 0 0 1 0,-10 z M0,-3 a3,3 0 0 0 0,6 a3,3 0 0 0 0,-6 z"></path><use xlink:href="%23cog" /><use xlink:href="%23cog" transform="rotate(60)" /><use xlink:href="%23cog" transform="rotate(120)" /><use xlink:href="%23cog" transform="rotate(180)" /><use xlink:href="%23cog" transform="rotate(240)" /><use xlink:href="%23cog" transform="rotate(300)" /></g></svg>');
@icon-delete: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"> <path fill="rgb(83, 161, 179)" d="M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0V6z"></path> <path fill="rgb(83, 161, 179)" fill-rule="evenodd" d="M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1v1zM4.118 4 4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4H4.118zM2.5 3V2h11v1h-11z"></path></svg>');
@icon-delete-hover: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"> <path fill="white" d="M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0V6z"></path> <path fill="white" fill-rule="evenodd" d="M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1v1zM4.118 4 4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4H4.118zM2.5 3V2h11v1h-11z"></path></svg>');

```

### ui\icons\phone-icon.tsx

```
import {m} from 'malevic';

export function PhoneIcon(): Malevic.Child {
    return <svg viewBox="0 0 16 16">
        <g stroke="currentcolor" stroke-width="1.5" fill="none">
            <rect x="3" y="1" width="10" height="14" rx="2" ry="2" />
            <line x1="6" y1="13" x2="10" y2="13" stroke-width="1" />
        </g>
    </svg>;
}

```

### ui\icons\index.tsx

```
import {AdvancedIcon} from './advanced-icon';
import {DeleteIcon} from './delete-icon';
import {HelpIcon} from './help-icon';
import {KeyboardIcon} from './keyboard-icon';
import {ListIcon} from './list-icon';
import {SettingsIcon} from './settings-icon';
import {SunMoonIcon} from './sun-moon-icon';
import {SystemIcon} from './system-icon';
import {WatchIcon} from './watch-icon';

export {
    AdvancedIcon,
    DeleteIcon,
    HelpIcon,
    KeyboardIcon,
    ListIcon,
    SettingsIcon,
    SunMoonIcon,
    SystemIcon,
    WatchIcon,
};

```

### ui\icons\watch-icon.tsx

```
import {m} from 'malevic';

interface WatchIconProps {
    color?: string;
    hours: number;
    minutes: number;
}

export function WatchIcon(props: WatchIconProps): Malevic.Child {
    const {hours, minutes, color = 'white'} = props;
    const cx = 8;
    const cy = 8.5;
    const lenHour = 3;
    const lenMinute = 4;
    const clockR = 5.5;
    const btnSize = 2;
    const btnPad = 1.5;
    const ah = ((hours > 11 ? hours - 12 : hours) + minutes / 60) / 12 * Math.PI * 2;
    const am = minutes / 60 * Math.PI * 2;
    const hx = cx + lenHour * Math.sin(ah);
    const hy = cy - lenHour * Math.cos(ah);
    const mx = cx + lenMinute * Math.sin(am);
    const my = cy - lenMinute * Math.cos(am);

    return (
        <svg viewBox="0 0 16 16">
            <circle fill="none" stroke={color} stroke-width="1.5" cx={cx} cy={cy} r={clockR} />
            <line stroke={color} stroke-width="1.5" x1={cx} y1={cy} x2={hx} y2={hy} />
            <line stroke={color} stroke-width="1.5" opacity="0.67" x1={cx} y1={cy} x2={mx} y2={my} />
            {[30, -30].map((angle) => {
                return (
                    <path
                        fill={color}
                        transform={`rotate(${angle})`}
                        transform-origin={`${cx} ${cy}`}
                        d={`M${cx - btnSize},${cy - clockR - btnPad} a${btnSize},${btnSize} 0 0 1 ${2 * btnSize},0 z`} />
                );
            })}
        </svg>
    );
}

```

### ui\icons\system-icon.tsx

```
import {m} from 'malevic';

export function SystemIcon(): Malevic.Child {
    return (
        <svg viewBox="0 0 16 16">
            <path
                fill="white"
                stroke="none"
                d="M3,3 h10 v7 h-3 v2 h1 v1 h-6 v-1 h1 v-2 h-3 z M4.5,4.5 v4 h7 v-4 z"
            />
        </svg>
    );
}

```

### ui\icons\list-icon.tsx

```
import {m} from 'malevic';

export function ListIcon(): Malevic.Child {
    return <svg viewBox="-1 -1 10 10">
        <path d="M0,0 h1 v1 h-1 z m2,0 h6 v1 h-6 z m-2,3.25 h1 v1 h-1 z m2,0 h6 v1 h-6 z m-2,3.25 h1 v1 h-1 z m2,0 h6 v1 h-6 z" fill="currentColor" />
    </svg>;
}

```

### ui\icons\sun-moon-icon.tsx

```
import {m} from 'malevic';

import {isNightAtLocation} from '../../utils/time';

interface SunMoonIconProps {
    date: Date;
    latitude: number;
    longitude: number;
}

export function SunMoonIcon({date, latitude, longitude}: SunMoonIconProps): Malevic.Child {
    if (latitude == null || longitude == null) {
        // question mark icon
        return (
            <svg viewBox="0 0 16 16">
                <text
                    fill="white"
                    font-size="16"
                    font-weight="bold"
                    text-anchor="middle"
                    x="8"
                    y="14"
                >?</text>
            </svg>
        );
    }

    if (isNightAtLocation(latitude, longitude, date)) {
        // moon icon
        return (
            <svg viewBox="0 0 16 16">
                <path fill="white" stroke="none" d="M 6 3 Q 10 8 6 13 Q 12 13 12 8 Q 12 3 6 3" />
            </svg>
        );
    }

    // sun icon
    return (
        <svg viewBox="0 0 16 16">
            <circle fill="white" stroke="none" cx="8" cy="8" r="3" />
            <g fill="none" stroke="white" stroke-linecap="round" stroke-width="1.5">
                {...(Array.from({length: 8}).map((_, i) => {
                    const cx = 8;
                    const cy = 8;
                    const angle = i * Math.PI / 4 + Math.PI / 8;
                    const pt = [5, 6].map((l) => [
                        cx + l * Math.cos(angle),
                        cy + l * Math.sin(angle),
                    ]);
                    return (
                        <line
                            x1={pt[0][0]}
                            y1={pt[0][1]}
                            x2={pt[1][0]}
                            y2={pt[1][1]}
                        />
                    );
                }))}
            </g>
        </svg>
    );
}

```

### ui\icons\settings-icon.tsx

```
import {m} from 'malevic';

interface SettingsIconProps {
    class?: string;
    color?: string;
}

export function SettingsIcon(props: SettingsIconProps): Malevic.Child {
    return (
        <svg viewBox="0 0 16 16" class={props.class}>
            <defs>
                <path id="cog" d="M-1.25,-6.5 h2.5 l1,3 h-4.5 z" />
            </defs>
            <g transform="translate(8 8)" fill={props.color ?? 'currentColor'}>
                <path d="M0,-5 a5,5 0 0 1 0,10 a5,5 0 0 1 0,-10 z M0,-3 a3,3 0 0 0 0,6 a3,3 0 0 0 0,-6 z" />
                <use href="#cog" />
                <use href="#cog" transform="rotate(60)" />
                <use href="#cog" transform="rotate(120)" />
                <use href="#cog" transform="rotate(180)" />
                <use href="#cog" transform="rotate(240)" />
                <use href="#cog" transform="rotate(300)" />
            </g>
        </svg>
    );
}

```

### ui\icons\keyboard-icon.tsx

```
import {m} from 'malevic';

export function KeyboardIcon(): Malevic.Child {
    return (
        <svg viewBox="0 0 16 16">
            <rect fill="none" stroke="var(--icon-color, currentColor)" stroke-width="1" x="2" y="4" width="12" height="8" />
            <g stroke="var(--icon-color, currentColor)" stroke-width="1">
                <line x1="4" y1="10" x2="12" y2="10" />
                <line x1="4" y1="6" x2="6" y2="6" />
                <line x1="7" y1="6" x2="9" y2="6" />
                <line x1="10" y1="6" x2="12" y2="6" />
                <line x1="5.5" y1="8" x2="7.5" y2="8" />
                <line x1="8.5" y1="8" x2="10.5" y2="8" />
            </g>
        </svg>
    );
}

```

### ui\options\about\version.tsx

```
import {m} from 'malevic';

import {getLocalMessage} from '../../../utils/locales';

let appVersion: string;

export function AppVersion(): Malevic.Child {
    if (!appVersion) {
        appVersion = chrome.runtime.getManifest().version;
    }
    return (
        <label class="darkreader-version">{getLocalMessage('version')} {appVersion}</label>
    );
}

```

### ui\options\about\about-tab.tsx

```
import {m} from 'malevic';

import type {ViewProps} from '../../../definitions';
import {DONATE_URL, HOMEPAGE_URL, MOBILE_URL, PRIVACY_URL, getHelpURL} from '../../../utils/links';
import {getLocalMessage} from '../../../utils/locales';
import {isMobile} from '../../../utils/platform';

import {AppVersion} from './version';

interface AboutTabProps {
    plus?: boolean;
}

export function AboutTab(props: ViewProps & AboutTabProps): Malevic.Child {
    return <div class="settings-tab about-tab">
        <AppVersion />
        <div>
            <a href={PRIVACY_URL} target="_blank" rel="noopener noreferrer">
                Privacy Policy
            </a>
        </div>
        <div>
            <a href={`${HOMEPAGE_URL}/terms/`} target="_blank" rel="noopener noreferrer">
                Terms of Use
            </a>
        </div>
        {isMobile ? null : (
            <div>
                <a href={MOBILE_URL} target="_blank" rel="noopener noreferrer">{getLocalMessage('mobile')}</a>
            </div>
        )}
        <div>
            <a href={getHelpURL()} target="_blank" rel="noopener noreferrer">{getLocalMessage('help')}</a>
        </div>
        {props.plus ? null : isMobile ? (
            <div>
                <a href={`${HOMEPAGE_URL}/plus/`} target="_blank" rel="noopener noreferrer">{getLocalMessage('pay_for_using')}</a>
            </div>
        ) : (
            <div>
                <a href={DONATE_URL} target="_blank" rel="noopener noreferrer">{getLocalMessage('pay_for_using')}</a>
            </div>
        )}
    </div>;
}

```

### ui\options\about\about.less

```
.about-tab {
    .darkreader-version {
        color: @color-control-fore;
    }

    a {
        color: @color-fore;
    }
}

```

### ui\options\advanced\advanced-tab.tsx

```
import {m} from 'malevic';

import type {ViewProps} from '../../../definitions';

import {ContextMenus} from './context-menus';
import {DevTools} from './devtools';
import {EnableForProtectedPages} from './enable-for-protected-pages';
import {ExportSettings} from './export-settings';
import {ImportSettings} from './import-settings';
import {ResetSettings} from './reset-settings';
import {SyncConfig} from './sync-config';
import {SyncSettings} from './sync-settings';

export function AdvancedTab(props: ViewProps): Malevic.Child {
    return <div class="settings-tab">
        <SyncSettings {...props} />
        <SyncConfig {...props} />
        <EnableForProtectedPages {...props} />
        <ContextMenus {...props} />
        <ImportSettings {...props} />
        <ExportSettings {...props} />
        <ResetSettings {...props} />
        <DevTools />
    </div>;
}

```

### ui\options\advanced\advanced.less

```
.advanced {
    &__export-settings-button {
        box-sizing: border-box;
        width: 100%;
    }

    &__import-settings-button {
        box-sizing: border-box;
        width: 100%;
    }
}

```

### ui\options\advanced\import-settings.tsx

```
import {m} from 'malevic';
import {getContext} from 'malevic/dom';

import type {UserSettings, ViewProps} from '../../../definitions';
import {validateSettings} from '../../../utils/validation';
import {Button, ControlGroup, MessageBox} from '../../controls';
import {openFile} from '../../utils';

export function ImportSettings(props: ViewProps): Malevic.Child {
    const context = getContext();

    function showDialog(caption: string) {
        context.store.caption = caption;
        context.store.isDialogVisible = true;
        context.refresh();
    }

    function hideDialog() {
        context.store.isDialogVisible = false;
        context.refresh();
    }

    const dialog = context && context.store.isDialogVisible ? (
        <MessageBox
            caption={context.store.caption}
            onOK={hideDialog}
            onCancel={hideDialog}
            hideCancel={true}
        />
    ) : null;

    function showWarningDialog() {
        context.store.isWarningDialogVisible = true;
        context.refresh();
    }

    function hideWarningDialog() {
        context.store.isWarningDialogVisible = false;
        context.refresh();
    }

    const warningDialog = context.store.isWarningDialogVisible ? (
        <MessageBox
            caption="Warning! Your current settings will be overwritten. Click OK to proceed."
            onOK={importSettings}
            onCancel={hideWarningDialog}
        />
    ) : null;

    function importSettings() {
        openFile({extensions: ['json']}, (result: string) => {
            try {
                const content: UserSettings = JSON.parse(result);
                const {settings, errors} = validateSettings(content);
                const count = errors.length;
                if (count) {
                    console.error('Could not validate imported settings', errors, result, content);
                    showDialog(`The given file has incorrect JSON: ${count > 1 ? `${count} errors, including ${errors[0]}` : errors[0]}`);
                    return;
                }
                props.actions.changeSettings(settings);
                showDialog('Settings imported');
            } catch (err) {
                console.error(err);
                showDialog('Failed to read file');
            }
        });
    }

    return (
        <ControlGroup>
            <ControlGroup.Control>
                <Button
                    onclick={showWarningDialog}
                    class="advanced__import-settings-button"
                >
                    Import Settings
                    {dialog}
                    {warningDialog}
                </Button>
            </ControlGroup.Control>
            <ControlGroup.Description>
                Open settings from a JSON file
            </ControlGroup.Description>
        </ControlGroup>
    );
}

```

### ui\options\advanced\fetch-news.tsx

```
import {m} from 'malevic';

import type {ViewProps} from '../../../definitions';
import {CheckButton} from '../../controls';

export function FetchNews(props: ViewProps): Malevic.Child {
    function onFetchNewsChange(checked: boolean) {
        props.actions.changeSettings({fetchNews: checked});
    }

    return (
        <CheckButton
            checked={props.data.settings.fetchNews}
            label="Notify of news"
            description={props.data.settings.fetchNews ?
                "Notifying of Dark Reader's news" :
                "Not Notifying of Dark Reader's news"}
            onChange={onFetchNewsChange}
        />
    );
}

```

### ui\options\advanced\sync-config.tsx

```
import {m} from 'malevic';

import type {ViewProps} from '../../../definitions';
import {CheckButton} from '../../controls';

export function SyncConfig(props: ViewProps): Malevic.Child {
    function syncConfig(syncSitesFixes: boolean) {
        props.actions.changeSettings({syncSitesFixes});
        props.actions.loadConfig({local: !syncSitesFixes});
    }

    return (
        <CheckButton
            checked={props.data.settings.syncSitesFixes}
            label="Synchronize sites fixes"
            description="Load the latest sites fixes from a remote server"
            onChange={syncConfig} />
    );
}

```

### ui\options\advanced\sync-settings.tsx

```
import {m} from 'malevic';

import type {ViewProps} from '../../../definitions';
import {CheckButton} from '../../controls';

export function SyncSettings(props: ViewProps): Malevic.Child {
    function onSyncSettingsChange(checked: boolean) {
        props.actions.changeSettings({syncSettings: checked});
    }

    return (
        <CheckButton
            checked={props.data.settings.syncSettings}
            label="Enable settings sync"
            description={props.data.settings.syncSettings ?
                'Synchronized across devices' :
                'Not synchronized across devices'}
            onChange={onSyncSettingsChange}
        />
    );
}

```

### ui\options\advanced\export-settings.tsx

```
import {m} from 'malevic';

import type {ViewProps} from '../../../definitions';
import {Button, ControlGroup} from '../../controls';
import {saveFile} from '../../utils';

export function ExportSettings(props: ViewProps): Malevic.Child {
    function exportSettings() {
        saveFile('Dark-Reader-Settings.json', JSON.stringify(props.data.settings, null, 4));
    }

    return (
        <ControlGroup>
            <ControlGroup.Control>
                <Button
                    onclick={exportSettings}
                    class="advanced__export-settings-button"
                >
                    Export Settings
                </Button>
            </ControlGroup.Control>
            <ControlGroup.Description>
                Save settings to a JSON file
            </ControlGroup.Description>
        </ControlGroup>
    );
}

```

### ui\options\advanced\enable-for-protected-pages.tsx

```
import {m} from 'malevic';

import type {ViewProps} from '../../../definitions';
import {CheckButton} from '../../controls';

export function EnableForProtectedPages(props: ViewProps): Malevic.Child {
    function onEnableForProtectedPages(value: boolean) {
        props.actions.changeSettings({enableForProtectedPages: value});
    }

    return (
        <CheckButton
            checked={props.data.settings.enableForProtectedPages}
            onChange={onEnableForProtectedPages}
            label={'Enable on restricted pages'}
            description={props.data.settings.enableForProtectedPages ?
                'You should enable it in browser flags too' :
                'Disabled for web store and other pages'}
        />
    );
}

```

### ui\options\advanced\reset-settings.tsx

```
import {m} from 'malevic';
import {getContext} from 'malevic/dom';

import {DEFAULT_SETTINGS} from '../../../defaults';
import type {ViewProps} from '../../../definitions';
import {ControlGroup, MessageBox, ResetButton} from '../../controls';

export function ResetSettings(props: ViewProps): Malevic.Child {
    const context = getContext();

    function showDialog() {
        context.store.isDialogVisible = true;
        context.refresh();
    }

    function hideDialog() {
        context.store.isDialogVisible = false;
        context.refresh();
    }

    function reset() {
        context.store.isDialogVisible = false;
        props.actions.changeSettings(DEFAULT_SETTINGS);
    }

    const dialog = context.store.isDialogVisible ? (
        <MessageBox
            caption="Are you sure you want to remove all your settings? You cannot restore them later"
            onOK={reset}
            onCancel={hideDialog}
        />
    ) : null;

    return (
        <ControlGroup>
            <ControlGroup.Control>
                <ResetButton onClick={showDialog}>
                    Reset settings
                    {dialog}
                </ResetButton>
            </ControlGroup.Control>
            <ControlGroup.Description>
                Restore settings to defaults
            </ControlGroup.Description>
        </ControlGroup>
    );
}

```

### ui\options\advanced\context-menus.tsx

```
import {m} from 'malevic';

import type {ViewProps} from '../../../definitions';
import {isFirefox, isMobile} from '../../../utils/platform';
import {CheckButton} from '../../controls';

export function ContextMenus(props: ViewProps): Malevic.Child {
    function onContextMenusChange(checked: boolean) {
        if (checked) {
            if (isFirefox) {
                props.actions.changeSettings({enableContextMenus: true});
                return;
            }
            // We have to request permissions in foreground context in response to user action.
            // 'contextMenus' permission is granted automatically without any permission prompts.
            chrome.permissions.request({permissions: ['contextMenus']}, (hasPermission: boolean) => {
                if (hasPermission) {
                    props.actions.changeSettings({enableContextMenus: true});
                } else {
                    // This branch is never actually taken.
                    // Permission request was declined, we can not use context menus
                    // TODO: toggle back off
                    console.warn('User declined contextMenus permission prompt.');
                }
            });
        } else {
            props.actions.changeSettings({enableContextMenus: false});
        }
    }

    return isMobile ? null : (
        <CheckButton
            checked={props.data.settings.enableContextMenus}
            label="Use context menus"
            description={props.data.settings.enableContextMenus ?
                'Context menu integration is enabled' :
                'Context menu integration is disabled'}
            onChange={onContextMenusChange}
        />
    );
}

```

### ui\options\advanced\devtools.tsx

```
import {m} from 'malevic';

import {getLocalMessage} from '../../../utils/locales';
import {ControlGroup, NavButton} from '../../controls';
import {openExtensionPage} from '../../utils';

async function openDevTools() {
    await openExtensionPage('devtools');
}

export function DevTools(): Malevic.Child {
    return (
        <ControlGroup>
            <ControlGroup.Control>
                <NavButton onClick={openDevTools} class="advanced__dev-tools-button">
                    🛠 {getLocalMessage('open_dev_tools')}
                </NavButton>
            </ControlGroup.Control>
            <ControlGroup.Description>
                Make a fix for a website
            </ControlGroup.Description>
        </ControlGroup>
    );
}

```

### ui\options\automation\automation-tab.tsx

```
import {m} from 'malevic';

import type {Automation, MessageUItoBG, ViewProps} from '../../../definitions';
import {AutomationMode} from '../../../utils/automation';
import {getLocalMessage} from '../../../utils/locales';
import {MessageTypeUItoBG} from '../../../utils/message';
import {isMatchMediaChangeEventListenerBuggy} from '../../../utils/platform';
import {Button, CheckBox, ControlGroup, DropDown, TextBox, TimeRangePicker} from '../../controls';

declare const __CHROMIUM_MV3__: boolean;

export function AutomationTab(props: ViewProps): Malevic.Child {
    const isSystemAutomation = props.data.settings.automation.mode === AutomationMode.SYSTEM && props.data.settings.automation.enabled;
    const locationSettings = props.data.settings.location;
    const values = {
        'latitude': {
            min: -90,
            max: 90,
        },
        'longitude': {
            min: -180,
            max: 180,
        },
    };

    function getLocationString(location: number) {
        if (location == null) {
            return '';
        }

        return `${location}°`;
    }

    function locationChanged(inputElement: HTMLInputElement, newValue: string, type: 'latitude' | 'longitude') {
        if (newValue.trim() === '') {
            inputElement.value = '';

            props.actions.changeSettings({
                location: {
                    ...locationSettings,
                    [type]: null,
                },
            });

            return;
        }

        const min: number = values[type].min;
        const max: number = values[type].max;

        newValue = newValue.replace(',', '.').replace('°', '');

        let num = Number(newValue);
        if (isNaN(num)) {
            num = 0;
        } else if (num > max) {
            num = max;
        } else if (num < min) {
            num = min;
        }

        inputElement.value = getLocationString(num);

        props.actions.changeSettings({
            location: {
                ...locationSettings,
                [type]: num,
            },
        });
    }

    function changeAutomationMode(mode: Automation['mode']) {
        props.actions.changeSettings({automation: {...props.data.settings.automation, ...{mode, enabled: Boolean(mode)}}});
    }

    function changeAutomationBehavior(behavior: Automation['behavior']) {
        props.actions.changeSettings({automation: {...props.data.settings.automation, ...{behavior}}});
    }

    return <div class="settings-tab">
        <ControlGroup>
            <ControlGroup.Control class="automation__time-picker-control">
                <CheckBox
                    checked={props.data.settings.automation.mode === AutomationMode.TIME}
                    onchange={(e: {target: {checked: boolean}}) => changeAutomationMode(e.target.checked ? AutomationMode.TIME : AutomationMode.NONE)}
                />
                <TimeRangePicker
                    startTime={props.data.settings.time.activation}
                    endTime={props.data.settings.time.deactivation}
                    onChange={([start, end]) => props.actions.changeSettings({time: {activation: start, deactivation: end}})}
                />
            </ControlGroup.Control>
            <ControlGroup.Description>
                {getLocalMessage('set_active_hours')}
            </ControlGroup.Description>
        </ControlGroup>
        <ControlGroup>
            <ControlGroup.Control class="automation__location-control">
                <CheckBox
                    checked={props.data.settings.automation.mode === AutomationMode.LOCATION}
                    onchange={(e: {target: {checked: boolean}}) => changeAutomationMode(e.target.checked ? AutomationMode.LOCATION : AutomationMode.NONE)}
                />
                <TextBox
                    class="automation__location-control__latitude"
                    placeholder={getLocalMessage('latitude')}
                    onchange={(e: {target: HTMLInputElement}) => locationChanged(e.target, e.target.value, 'latitude')}
                    oncreate={(node: HTMLInputElement) => node.value = getLocationString(locationSettings.latitude!)}
                    onkeypress={(e) => {
                        if (e.key === 'Enter') {
                            (e.target as HTMLInputElement).blur();
                        }
                    }}
                />
                <TextBox
                    class="automation__location-control__longitude"
                    placeholder={getLocalMessage('longitude')}
                    onchange={(e: {target: HTMLInputElement}) => locationChanged(e.target, e.target.value, 'longitude')}
                    oncreate={(node: HTMLInputElement) => node.value = getLocationString(locationSettings.longitude!)}
                    onkeypress={(e) => {
                        if (e.key === 'Enter') {
                            (e.target as HTMLInputElement).blur();
                        }
                    }}
                />
            </ControlGroup.Control>
            <ControlGroup.Description>
                {getLocalMessage('set_location')}
            </ControlGroup.Description>
        </ControlGroup>
        <ControlGroup>
            <ControlGroup.Control class="automation__system-control">
                <CheckBox
                    class="automation__system-control__checkbox"
                    checked={isSystemAutomation}
                    onchange={(e: {target: {checked: boolean}}) => changeAutomationMode(e.target.checked ? AutomationMode.SYSTEM : AutomationMode.NONE)} />
                <Button
                    class={{
                        'automation__system-control__button': true,
                        'automation__system-control__button--active': isSystemAutomation,
                    }}
                    onclick={() => {
                        if (__CHROMIUM_MV3__) {
                            chrome.runtime.sendMessage<MessageUItoBG>({
                                type: MessageTypeUItoBG.COLOR_SCHEME_CHANGE,
                                data: {isDark: matchMedia('(prefers-color-scheme: dark)').matches},
                            });
                        }
                        changeAutomationMode(isSystemAutomation ? AutomationMode.NONE : AutomationMode.SYSTEM);
                    }}
                >{getLocalMessage('system_dark_mode')}</Button>
            </ControlGroup.Control>
            <ControlGroup.Description>
                {getLocalMessage('system_dark_mode_description')}
                {!isMatchMediaChangeEventListenerBuggy ? null :
                    [<br />, getLocalMessage('system_dark_mode_chromium_warning')]
                }
            </ControlGroup.Description>
        </ControlGroup>
        <ControlGroup>
            <ControlGroup.Control class="automation__behavior">
                <DropDown
                    onChange={(selected: any) => changeAutomationBehavior(selected)}
                    selected={props.data.settings.automation.behavior}
                    options={[
                        {id: 'OnOff', content: 'Toggle on/off'},
                        {id: 'Scheme', content: 'Toggle dark/light'},
                    ]}
                />
            </ControlGroup.Control>
            <ControlGroup.Description>
                Automation behavior
            </ControlGroup.Description>
        </ControlGroup>
    </div>;
}

```

### ui\options\automation\automation.less

```
.automation {
    &__time-picker-control {
        display: flex;
        flex-direction: row;

        .checkbox {
            border-right: none;
            flex: none;
        }

        .time-range-picker .time-range-picker__input--start {
            border-left: @size-border-inner solid @color-border;
        }
    }

    &__location-control {
        display: flex;
        flex-direction: row;

        .checkbox {
            border-right: none;
            flex: none;
        }

        &__latitude,
        &__longitude {
            flex: auto;
            text-align: center;
            text-indent: 0;
            width: 100%;
        }

        &__latitude {
            border-left: @size-border-inner solid @color-border;
            border-right: none;
        }

        &__longitude {
            border-left: @size-border-inner solid @color-border;
        }
    }

    &__system-control {
        display: flex;
        flex-direction: row;

        &__checkbox {
            flex: none;
            border-right: none;
        }

        &__button {
            border-left-width: @size-border-inner;
            flex: auto;

            &:not(&--active) {
                color: @color-input-fore;
            }
        }

        &:hover &__button,
        &:hover &__checkbox {
            background-color: @color-control-hover;
        }
    }

    &__behavior {
        .dropdown {
            background-color: transparent;
            box-shadow: inset 0 0 0 @size-border @color-border;
            cursor: pointer;
            height: @size-control-inner + 2 * @size-border;
            margin-bottom: @size-control-inner + @size-border;
            width: 100%;
    
            &__selected {
                background-color: transparent;
                background-position: center right 0.25rem + @size-border;
                height: @size-control-inner;
                margin-left: @size-border;
                margin-top: @size-border;
                transition: background-color @time-fast;
                width: calc(100% - 2 * @size-border);

                &:hover {
                    background-color: @color-control-hover;
                }
            }
    
            &--open .dropdown__list {
                border: @size-border solid @color-border;
                margin-top: 0;
                padding-top: @size-border;
            }
    
            &__list__item {
                height: @size-control-inner;
            }
        }
    }
}

```

### ui\options\body\body.tsx

```
import {m} from 'malevic';
import {getContext} from 'malevic/dom';

import type {ViewProps} from '../../../definitions';
import {Overlay} from '../../controls';
import {AdvancedIcon, HelpIcon, KeyboardIcon, ListIcon, SettingsIcon, WatchIcon} from '../../icons';
import {AboutTab} from '../about/about-tab';
import {AdvancedTab} from '../advanced/advanced-tab';
import {AutomationTab} from '../automation/automation-tab';
import {GeneralTab} from '../general/general-tab';
import {HotkeysTab} from '../hotkeys/hotkeys-tab';
import {SiteListTab} from '../site-list/site-list-tab';
import TabPanel from '../tab-panel/tab-panel';

type BodyProps = ViewProps;

export default function Body(props: BodyProps): Malevic.Child {
    const context = getContext();
    const store = context.getStore({activeTabId: 'general'});

    function onSettingsTabChange(tabId: string) {
        store.activeTabId = tabId;
        context.refresh();
    }

    const now = new Date();
    const autoIcon = <WatchIcon hours={now.getHours()} minutes={now.getMinutes()} color="currentColor" />;

    return (
        <body>
            <header>
                <img id="logo" src="../assets/images/darkreader-type.svg" alt="Dark Reader" />
                <h1 id="title">Settings</h1>
            </header>
            <TabPanel activeTabId={store.activeTabId} onTabChange={onSettingsTabChange}>
                <TabPanel.Tab id="general" label="General" icon={<SettingsIcon />} iconClass="settings-icon-general">
                    <GeneralTab {...props} />
                </TabPanel.Tab>
                <TabPanel.Tab id="site-list" label="Site List" icon={<ListIcon />} iconClass="settings-icon-list">
                    <SiteListTab {...props} />
                </TabPanel.Tab>
                <TabPanel.Tab id="automation" label="Automation" icon={autoIcon} iconClass="settings-icon-auto">
                    <AutomationTab {...props} />
                </TabPanel.Tab>
                <TabPanel.Tab id="hotkeys" label="Hotkeys" icon={<KeyboardIcon />} iconClass="settings-icon-hotkeys">
                    <HotkeysTab {...props} />
                </TabPanel.Tab>
                <TabPanel.Tab id="advanced" label="Advanced" icon={<AdvancedIcon />} iconClass="settings-icon-advanced">
                    <AdvancedTab {...props} />
                </TabPanel.Tab>
                <TabPanel.Tab id="about" label="About" icon={<HelpIcon />} iconClass="settings-icon-about">
                    <AboutTab {...props} />
                </TabPanel.Tab>
            </TabPanel>
            <Overlay />
        </body>
    );
}

```

### ui\options\general\change-browser-theme.tsx

```
import {m} from 'malevic';

import type {ViewProps} from '../../../definitions';
import {CheckButton} from '../../controls';

export function ChangeBrowserTheme(props: ViewProps): Malevic.Child {
    function onBrowserThemeChange(checked: boolean) {
        props.actions.changeSettings({changeBrowserTheme: checked});
    }

    return (
        <CheckButton
            checked={props.data.settings.changeBrowserTheme}
            label="Change browser theme"
            description={props.data.settings.changeBrowserTheme ?
                'Custom browser theme is active' :
                'Default browser theme is active'}
            onChange={onBrowserThemeChange}
        />
    );
}

```

### ui\options\general\general-tab.tsx

```
import {m} from 'malevic';

import type {ViewProps} from '../../../definitions';
import {isFirefox} from '../../../utils/platform';

import {ChangeBrowserTheme} from './change-browser-theme';
import {DetectDarkTheme} from './detect-dark-theme';
import {EnabledByDefault} from './enabled-by-default';
import {EnableForPDF} from './enabled-for-pdf';

export function GeneralTab(props: ViewProps): Malevic.Child {
    return <div class="settings-tab">
        <EnabledByDefault {...props} />
        <DetectDarkTheme {...props} />
        {isFirefox ? null : <EnableForPDF {...props} />}
        {isFirefox ? <ChangeBrowserTheme {...props} /> : null}
    </div>;
}

```

### ui\options\general\enabled-for-pdf.tsx

```
import {m} from 'malevic';

import type {ViewProps} from '../../../definitions';
import {CheckButton} from '../../controls';

export function EnableForPDF(props: ViewProps): Malevic.Child {
    function onInvertPDFChange(checked: boolean) {
        props.actions.changeSettings({enableForPDF: checked});
    }

    return (
        <CheckButton
            checked={props.data.settings.enableForPDF}
            label="Enable for PDF files"
            description={props.data.settings.enableForPDF ?
                'Enabled for PDF documents' :
                'Disabled for PDF documents'}
            onChange={onInvertPDFChange}
        />
    );
}

```

### ui\options\general\detect-dark-theme.tsx

```
import {m} from 'malevic';

import type {ViewProps} from '../../../definitions';
import {CheckButton} from '../../controls';

export function DetectDarkTheme(props: ViewProps): Malevic.Child {
    function onDetectDarkThemeChange(checked: boolean) {
        props.actions.changeSettings({detectDarkTheme: checked});
    }

    return (
        <CheckButton
            checked={props.data.settings.detectDarkTheme}
            label="Detect dark theme"
            description={props.data.settings.detectDarkTheme ?
                `Will not override website's dark theme` :
                `Will override website's dark theme`}
            onChange={onDetectDarkThemeChange}
        />
    );
}

```

### ui\options\general\enabled-by-default.tsx

```
import {m} from 'malevic';

import type {ViewProps} from '../../../definitions';
import {CheckButton} from '../../controls';

export function EnabledByDefault(props: ViewProps): Malevic.Child {
    function onEnabledByDefaultChange(checked: boolean) {
        props.actions.changeSettings({enabledByDefault: checked});
    }

    return (
        <CheckButton
            checked={props.data.settings.enabledByDefault}
            label="Enable by default"
            description={props.data.settings.enabledByDefault ?
                'Enabled on all websites by default' :
                'Disabled on all websites by default'}
            onChange={onEnabledByDefaultChange}
        />
    );
}

```

### ui\options\hotkeys\hotkeys-tab.tsx

```
import {m} from 'malevic';

import type {ViewProps} from '../../../definitions';
import {getLocalMessage} from '../../../utils/locales';
import {ControlGroup, Shortcut} from '../../controls';

export function HotkeysTab(props: ViewProps): Malevic.Child {
    const {data, actions} = props;
    return <div class="settings-tab">
        <ControlGroup>
            <ControlGroup.Control>
                <Shortcut
                    class="hotkeys__control"
                    commandName="toggle"
                    shortcuts={data.shortcuts}
                    textTemplate={(hotkey) => (hotkey
                        ? hotkey
                        : getLocalMessage('click_to_set_shortcut')
                    )}
                    onSetShortcut={(shortcut) => actions.setShortcut('toggle', shortcut)}
                />
            </ControlGroup.Control>
            <ControlGroup.Description>
                Enable/disable the extension
            </ControlGroup.Description>
        </ControlGroup>
        <ControlGroup>
            <ControlGroup.Control>
                <Shortcut
                    class="hotkeys__control"
                    commandName="addSite"
                    shortcuts={data.shortcuts}
                    textTemplate={(hotkey) => (hotkey
                        ? hotkey
                        : getLocalMessage('click_to_set_shortcut')
                    )}
                    onSetShortcut={(shortcut) => actions.setShortcut('addSite', shortcut)}
                />
            </ControlGroup.Control>
            <ControlGroup.Description>
                Toggle the current website
            </ControlGroup.Description>
        </ControlGroup>
    </div>;
}

```

### ui\options\hotkeys\hotkeys.less

```
.hotkeys {
    &__control {
        align-items: center;
        border: @size-border solid @color-border;
        display: inline-flex;
        flex-direction: row;
        font-size: @size-text-normal;
        height: @size-control-inner;
        justify-content: center;
        text-decoration: none;
        transition: background-color @time-fast;
        width: calc(100% - 2 * @size-border);

        &.shortcut--set {
            color: @color-control-fore;
        }

        &:hover {
            background-color: @color-control-hover;
            text-decoration: none;

            &:not(.shortcut--edit)::before {
                display: none;
            }
        }
    }
}

```

### ui\options\site-list\site-list.tsx

```
import {m} from 'malevic';
import {getContext} from 'malevic/dom';

import {ControlGroup, TextBox} from '../../controls';
import VirtualScroll from '../../controls/virtual-scroll';

interface SiteListProps {
    siteList: string[];
    onChange: (sites: string[]) => void;
}

interface SiteListStore {
    indices: WeakMap<Node, number>;
    shouldFocusAtIndex: number;
    wasVisible: boolean;
}

export function SiteList(props: SiteListProps): Malevic.Child {
    const context = getContext();
    const store: SiteListStore = context.store;
    if (!context.prev) {
        store.indices = new WeakMap();
        store.shouldFocusAtIndex = -1;
        store.wasVisible = false;
    }

    context.onRender((node: HTMLElement) => {
        const isVisible = node.clientWidth > 0;
        const {wasVisible} = store;
        store.wasVisible = isVisible;
        if (!wasVisible && isVisible) {
            store.shouldFocusAtIndex = props.siteList.length;
            context.refresh();
        }
    });

    function onTextChange(e: Event & {target: HTMLInputElement}) {
        const index = store.indices.get(e.target)!;
        const values = props.siteList.slice();
        const value = e.target.value.trim();
        if (values.includes(value)) {
            return;
        }

        if (!value) {
            values.splice(index, 1);
            store.shouldFocusAtIndex = index;
        } else if (index === values.length) {
            values.push(value);
            store.shouldFocusAtIndex = index + 1;
        } else {
            values.splice(index, 1, value);
            store.shouldFocusAtIndex = index + 1;
        }

        props.onChange(values);
    }

    function removeValue(event: MouseEvent) {
        const previousSibling = ((event.target as HTMLInputElement).previousSibling as HTMLInputElement);
        const index = store.indices.get(previousSibling)!;
        const filtered = props.siteList.slice();
        filtered.splice(index, 1);
        store.shouldFocusAtIndex = index;
        props.onChange(filtered);
    }

    function createTextBox(text: string, index: number) {
        const onRender = (node: HTMLInputElement) => {
            store.indices.set(node, index);
            if (store.shouldFocusAtIndex === index) {
                store.shouldFocusAtIndex = -1;
                node.focus();
            }
        };

        return (
            <div class="site-list__item">
                <TextBox
                    class="site-list__textbox"
                    value={text}
                    onrender={onRender}
                    placeholder="google.com/maps"
                />
                {text ? <span
                    class="site-list__item__remove"
                    role="button"
                    onclick={removeValue}
                /> : null}
            </div>
        );
    }

    const virtualScroll = <VirtualScroll
        root={(
            <div
                class="site-list__v-scroll-root"
                onchange={onTextChange}
            />
        )}
        items={props.siteList
            .map((site, index) => createTextBox(site, index))
            .concat(createTextBox('', props.siteList.length))}
        scrollToIndex={store.shouldFocusAtIndex}
    />;

    return (
        <ControlGroup class="site-list-group">
            <ControlGroup.Control class="site-list-group__control">
                <div class="site-list">
                    {virtualScroll}
                </div>
            </ControlGroup.Control>
            <ControlGroup.Description class="site-list-group__description">
                Type in the domain name and press Enter
            </ControlGroup.Description>
        </ControlGroup>
    );
}

```

### ui\options\site-list\site-list.less

```
@import "../../theme.less";
@import "../../icons/icons.less";

.site-list {
    align-items: stretch;
    border: @size-border solid @color-border;
    border-radius: @size-border;
    display: flex;
    flex-direction: column;
    justify-content: flex-start;
    max-height: 15rem;
    overflow: hidden;
    width: calc(100% - 2 * @size-border);

    &__v-scroll-root {
        overflow-x: hidden;
        overflow-y: auto;

        &::-webkit-scrollbar {
            width: @size-scrollbar-thickness;
        }
    }

    &__textbox {
        border: none;
        position: relative;
        width: 100%;

        &:focus {
            box-shadow: 0 0 0 @size-border @color-border;
            z-index: 1;
        }
    }

    &__item {
        position: relative;

        &__remove {
            background-color: transparent;
            background-image: @icon-close-inactive;
            background-position: center;
            background-repeat: no-repeat;
            background-size: 0.75rem;
            border-radius: 50%;
            cursor: pointer;
            display: none;
            height: 1.25rem;
            position: absolute;
            right: 0.125rem;
            top: 0.125rem;
            width: 1.25rem;
            z-index: 1;

            &:hover {
                background-color: @color-control-active;
                background-image: @icon-close;
            }
        }

        &:hover .site-list__item__remove {
            display: inline-block;
        }
    }
}

.site-list-tab {
    &__label {
        color: @color-control-fore;
        display: inline-block;
        width: 100%;
    }
}

.site-list-group {
    &__control {
        height: auto;
    }
}

.clear-site-list-button {
    box-sizing: border-box;
    height: 100%;
    width: 100%;

    &__content {
        align-items: center;
        display: flex;
        flex-direction: row;
        justify-content: center;
    }
    &__icon {
        align-items: center;
        display: flex;
        height: 1rem;
        justify-content: center;
        margin-right: 0.25rem;
        width: 1rem;

        > svg {
            display: inline-block;
            height: 85%;
            width: 85%;
        }
    }
}

```

### ui\options\site-list\clear-site-list.tsx

```
import {m} from 'malevic';
import {getContext} from 'malevic/dom';

import type {ViewProps} from '../../../definitions';
import {Button, ControlGroup, MessageBox} from '../../controls';
import {DeleteIcon} from '../../icons';

export function ClearSiteList(props: ViewProps): Malevic.Child {
    const context = getContext();
    const store = context.getStore({isDialogVisible: false});

    function showDialog() {
        store.isDialogVisible = true;
        context.refresh();
    }

    function hideDialog() {
        store.isDialogVisible = false;
        context.refresh();
    }

    function reset() {
        store.isDialogVisible = false;
        props.actions.changeSettings({enabledFor: [], disabledFor: []});
    }

    const dialog = store.isDialogVisible ? (
        <MessageBox
            caption="Are you sure you want to remove all your sites from the list? You cannot restore them later"
            onOK={reset}
            onCancel={hideDialog}
        />
    ) : null;

    return (
        <ControlGroup>
            <ControlGroup.Control>
                <Button onclick={showDialog} class="clear-site-list-button">
                    <span class="clear-site-list-button__content">
                        <span class="clear-site-list-button__icon">
                            <DeleteIcon />
                        </span>
                        Clear site list
                    </span>
                    {dialog}
                </Button>
            </ControlGroup.Control>
            <ControlGroup.Description>
                Remove all sites from the list
            </ControlGroup.Description>
        </ControlGroup>
    );
}

```

### ui\options\site-list\site-list-tab.tsx

```
import {m} from 'malevic';

import type {ViewProps} from '../../../definitions';

import {ClearSiteList} from './clear-site-list';
import {SiteList} from './site-list';

export function SiteListTab(props: ViewProps): Malevic.Child {
    const {settings} = props.data;
    const {enabledByDefault} = settings;

    function onSiteListChange(sites: string[]) {
        const changes = enabledByDefault
            ? {disabledFor: sites}
            : {enabledFor: sites};
        props.actions.changeSettings(changes);
    }

    const label = enabledByDefault ?
        'Disable on these websites' :
        'Enable on these websites';

    const sites = enabledByDefault
        ? settings.disabledFor
        : settings.enabledFor;
    return <div class="settings-tab site-list-tab">
        <label class="site-list-tab__label">{label}</label>
        <SiteList
            siteList={sites}
            onChange={onSiteListChange}
        />
        <ClearSiteList {...props} />
    </div>;
}

```

### ui\options\tab-panel\tab-panel.tsx

```
import {m} from 'malevic';

import {Button} from '../../controls';

interface TabPanelProps {
    activeTabId: string;
    isVertical?: boolean;
    onTabChange: (tabId: string) => void;
}

interface TabProps {
    id: string;
    label: string;
    isActive?: boolean;
    icon?: Malevic.Child;
    iconClass?: string;
    onClick?: () => void;
}

function TabPanel(props: TabPanelProps, ...children: Array<Malevic.ComponentSpec<TabProps>>) {
    const {activeTabId} = props;

    function createTabButton(tabSpec: Malevic.ComponentSpec<TabProps>) {
        const {id, label, icon, iconClass = ''} = tabSpec.props;

        function onClick() {
            props.onTabChange(id);
        }

        return <Button
            class={{
                'settings-tab-panel__button': true,
                'settings-tab-panel__button--active': activeTabId === id,
            }}
            onclick={tabSpec.props.onClick ?? onClick}
        >
            <span class={{
                'settings-tab-panel__button__icon': true,
                [iconClass]: Boolean(iconClass),
            }}>
                {icon}
            </span>
            {label}
        </Button>;
    }

    return (
        <div class={{'settings-tab-panel': true, 'settings-tab-panel--vertical': props.isVertical}}>
            <div class="settings-tab-panel__buttons">
                {...children.map(createTabButton)}
            </div>
            <div class="settings-tab-panel__tabs">
                {...children.map((child) => {
                    const {id} = child.props;
                    const spec: Malevic.ComponentSpec<TabProps> = {
                        ...child,
                        props: {
                            ...child.props,
                            isActive: id === activeTabId,
                        },
                    };
                    return spec;
                })}
            </div>
        </div>
    );
}

function Tab(props: TabProps, ...children: Malevic.Child[]) {
    return (
        <div
            class={{
                'settings-tab-panel__tab': true,
                'settings-tab-panel__tab--active': props.isActive,
            }}
        >
            {props.isActive ? children : null}
        </div>
    );
}

export default Object.assign(TabPanel, {Tab});

```

### ui\options\tab-panel\tab-panel.less

```
.settings-tab-panel {
    display: flex;
    flex-direction: row;
    gap: 1rem;
    height: 100%;

    &__buttons {
        display: flex;
        flex-direction: column;
        flex: none;
        min-width: 10rem;
    }

    &__button {
        border: none;
        box-shadow: none;
        color: @color-fore;
        height: @size-control-inner + 2 * @size-border;
        text-align: left;

        &--active {
            color: @color-heading;
            font-weight: bold;
        }

        &__icon {
            align-items: center;
            display: inline-flex;
            height: 1rem;
            justify-content: center;
            margin-right: 0.5rem;
            width: 1rem;

            svg {
                display: inline-block;
                height: 100%;
                width: 100%;
            }
        }

        .button__wrapper {
            align-items: center;
            display: flex;
            flex-direction: row;
        }
    }

    &__tabs {
        flex: auto;
        overflow: hidden;
    }

    &__tab {
        display: none;

        &--active {
            display: block;
        }
    }

    &--vertical {
        flex-direction: column;
    }

    &--vertical &__buttons {
        column-gap: 0.5rem;
        display: flex;
        flex-direction: row;
        flex-wrap: wrap;
        max-width: 16rem;
    }

    &--vertical &__button__icon {
        display: none;
    }
}

@media screen and (max-width: 30rem) {
    .settings-tab-panel {
        flex-direction: column;
    }

    .settings-tab-panel__buttons {
        column-gap: 0.5rem;
        display: flex;
        flex-direction: row;
        flex-wrap: wrap;
        max-width: 16rem;
    }

    .settings-tab-panel__button__icon {
        display: none;
    }
}

```

### ui\options\style.less

```
@import "../theme";
@import "../shared";

@import "./tab-panel/tab-panel";
@import "./about/about";
@import "./advanced/advanced";
@import "./automation/automation";
@import "./hotkeys/hotkeys";
@import "./site-list/site-list";

html {
    margin: 0;
    padding: 0;
}

#logo {
    display: inline-block;
    font-size: @size-text-large;
    height: @size-control-inner;
    width: 15rem;
}

#title {
    align-items: stretch;
    display: inline-flex;
    flex-direction: row;
    font-size: @size-control-inner * 4 / 3;
    font-weight: 100;
    line-height: @size-control-inner;
    height: @size-control-inner;
    margin: 0 0 0 @indent-small;
    text-transform: uppercase;
    transform: translateY(-0.0625rem);
}

body {
    box-sizing: content-box;
    display: flex;
    flex-direction: column;
    gap: @indent-small;
    margin: 0;
    padding: 1rem;
}

main {
    flex: none;
}

.settings-tab-panel {
    flex: auto;
}

.settings-tab {
    max-width: 16rem;
}

.settings-tab > :not(:first-child) {
    margin-top: @indent-small;
}

.settings-icon-list {
    svg {
        fill: currentColor;
        height: 75%;
        width: 75%;
    }
}

@media screen and (max-width: 30rem) {
    #title {
        display: none;
    }

    body {
        margin: 0 auto;
        width: 15rem;
    }
}

@media screen and (min-width: 21.25rem) {
    .mobile {
        font-size: 20px;
    }
}

@media screen and (min-width: 25.5rem) {
    .mobile {
        font-size: 24px;
    }
}

@media screen and (min-width: 29.75rem) {
    .mobile {
        font-size: 28px;
    }
}

```

### ui\options\index.tsx

```
import {m} from 'malevic';
import {sync} from 'malevic/dom';

import type {ExtensionData, DebugMessageBGtoCS, DebugMessageBGtoUI} from '../../definitions';
import {DebugMessageTypeBGtoUI} from '../../utils/message';
import {isFirefox, isMobile} from '../../utils/platform';
import Connector from '../connect/connector';

import Body from './body/body';

declare const __CHROMIUM_MV3__: boolean;

function renderBody(data: ExtensionData, actions: Connector) {
    sync(document.body, <Body data={data} actions={actions} />);
}

async function start(): Promise<void> {
    const connector = new Connector();
    window.addEventListener('unload', () => connector.disconnect(), {passive: true});

    const data = await connector.getData();
    renderBody(data, connector);
    connector.subscribeToChanges(async (newData) => {
        renderBody(newData, connector);
    });
}

document.documentElement.classList.toggle('mobile', isMobile);
document.documentElement.classList.toggle('firefox', isFirefox);

start();

declare const __DEBUG__: boolean;
if (__DEBUG__) {
    chrome.runtime.onMessage.addListener(({type}: DebugMessageBGtoCS | DebugMessageBGtoUI) => {
        if (type === DebugMessageTypeBGtoUI.CSS_UPDATE) {
            document.querySelectorAll('link[rel="stylesheet"]').forEach((link: HTMLLinkElement) => {
                const url = link.href;
                link.disabled = true;
                const newLink = document.createElement('link');
                newLink.rel = 'stylesheet';
                newLink.href = url.replace(/\?.*$/, `?nocache=${Date.now()}`);
                link.parentElement!.insertBefore(newLink, link);
                link.remove();
            });
        }

        if (type === DebugMessageTypeBGtoUI.UPDATE) {
            location.reload();
        }
    });
}

if (__CHROMIUM_MV3__) {
    // See getExtensionPageTabMV3() for explanation of what it is
    chrome.runtime.onMessage.addListener((message, _, sendResponse) => {
        if (message === 'getExtensionPageTabMV3_ping') {
            sendResponse('getExtensionPageTabMV3_pong');
        }
    });
}

```

### ui\popup\body\style.less

```
.mobile {
    body {
        border: none;
        height: auto;
        position: relative;
    }
}

.mobile,
.preview {
    .m-section {
        width: 100%;

        &:not(:first-child) {
            margin-top: @indent-large;
        }

        > :not(:first-child) {
            margin-top: @indent-small;
        }
    }

    .pages-section {
        height: 24.4375rem;
    }

    .m-logo {
        background-image: url('../assets/images/darkreader-type.svg');
        background-position: center;
        background-size: 100%;
        display: inline-block;
        grid-area: logo;
        height: @popup-content-width / 10;
        margin: 0 auto;
        outline: none;
        text-indent: -999rem;
        width: @popup-content-width;
    }

    .m-help-button {
        align-items: center;
        background-image: @icon-right;
        background-position: center right 0.25rem;
        background-repeat: no-repeat;
        background-size: 1rem;
        border: @size-border solid @color-border;
        display: inline-flex;
        justify-content: center;
        height: @size-control-inner;
        text-decoration: none;
        width: calc(100% - 2 * @size-border);

        &:hover {
            background-color: @color-control-hover;
            transition: background-color @time-fast;
        }

        &__text {
            color: @color-control-fore;
            display: inline-block;
            line-height: @size-control-inner;
            height: @size-control-inner;
            -moz-user-select: none;
            user-select: none;

            &::before {
                border: @size-border-inner solid @color-control-fore;
                border-radius: 50%;
                color: @color-control-fore;
                content: "?";
                display: inline-block;
                font-weight: bold;
                height: 0.875rem;
                left: 0;
                line-height: 0.875rem;
                margin-right: 0.25rem;
                text-align: center;
                top: 0;
                width: 0.875rem;
            }
        }
    }

    .m-donate-group {
        align-items: stretch;
        display: flex;
        flex-direction: column;
    }

    .m-donate-button {
        align-items: center;
        background-color: @color-control-active;
        display: inline-flex;
        height: @size-control-inner + 2 * @size-border;
        isolation: isolate;
        justify-content: center;
        text-decoration: none;
        position: relative;
        width: 100%;

        &__text {
            color: @color-control-fore;
            display: inline-block;
            font-weight: bold;
            height: @size-control-inner;
            line-height: @size-control-inner;
            text-transform: uppercase;
            transform: skewX(-10deg);
            -moz-user-select: none;
            user-select: none;
        }

        &__icon {
            display: none;
            isolation: isolate;

            &::before,
            &::after {
                border-radius: 50%;
                content: "";
                display: inline-block;
                height: 1rem;
                mix-blend-mode: screen;
                position: absolute;
                top: 0.375rem;
                width: 1rem;
            }
    
            &::before {
                background-color: @color-heading;
                left: 0.375rem;
            }
    
            &::after {
                background-color: @color-fore;
                left: 1rem;
            }
        }

        &:hover {
            box-shadow: inset 0 0 0 1px #ffffff88;
        }
    }

    .m-donate-description,
    .darkreader-version {
        display: inline-block;
        font-size: @size-text-small;
        line-height: @size-text-small-height;
        text-align: center;
        -moz-user-select: none;
        user-select: none;
        width: 100%;
    }

    .darkreader-version {
        bottom: 0;
        margin-bottom: 0.125rem;
        position: absolute;
        right: 0;
    }
}

.mobile {
    .darkreader-version {
        position: relative;
    }
}

.preview .dev-tools-button {
    overflow: visible;
    position: relative;
    width: calc(100% - 2 * 0.125rem);
}

.mobile,
.preview {
    @import "../main-page/style.less";
    @import "../news-section/style.less";
    @import "../page-viewer/style.less";
    @import "../theme/controls/theme-control.less";
    @import "../theme/controls/mode.less";
    @import "../theme/page/style.less";
    @import "../theme/preset-picker/style.less";
}

.mobile.firefox {
    * {
        font-family: Inter, Open Sans, Segoe UI, Helvetica Neue, Ubuntu, sans-serif;
    }

    a,
    a *,
    button,
    button * {
        font-family: Metropolis, Open Sans, Segoe UI, Helvetica Neue, Ubuntu, sans-serif;
    }
}

@media screen and (min-width: 21.25rem) {
    .mobile {
        font-size: 20px;
    }
}

@media screen and (min-width: 25.5rem) {
    .mobile {
        font-size: 24px;
    }
}

@media screen and (min-resolution: 29.75rem) {
    .mobile {
        font-size: 28px;
    }
}

@media screen and (min-width: 34rem) {
    .mobile {
        font-size: 32px;
    }
}

.firefox {
    .darkreader-version {
        display: none;
    }
}

.preview:not(.mobile) {
    body {
        border-color: mix(@color-back, @color-control-fore);
    }
}

html:not(.mobile) {
    width: calc(@popup-content-width + 2 * @popup-content-padding + 4px);
}

```

### ui\popup\body\index.tsx

```
import {m} from 'malevic';
import {getContext} from 'malevic/dom';

import type {ViewProps} from '../../../definitions';
import {DONATE_URL, HOMEPAGE_URL} from '../../../utils/links';
import {getLocalMessage} from '../../../utils/locales';
import {isMobile} from '../../../utils/platform';
import {Overlay} from '../../controls';
import {openExtensionPage} from '../../utils';
import MainPage from '../main-page';
import NewsSection from '../news-section';
import {Page, PageViewer} from '../page-viewer';
import ThemePage from '../theme/page';

interface IndexStore {
    activePage: PageId;
}

function Logo() {
    return (
        <a
            class="m-logo"
            href={HOMEPAGE_URL}
            target="_blank"
            rel="noopener noreferrer"
        >
            Dark Reader
        </a>
    );
}

type PageId = (
    'main'
    | 'theme'
    | 'settings'
    | 'site-list'
    | 'automation'
    | 'manage-settings'
);

let popstate: (() => void) | null = null;
isMobile && window.addEventListener('popstate', () => popstate && popstate(), {passive: true});

function Pages(props: ViewProps) {
    const context = getContext();
    const store: IndexStore = context.store;
    if (store.activePage == null) {
        store.activePage = 'main';
    }

    function onThemeNavClick() {
        isMobile && history.pushState(undefined, '');
        store.activePage = 'theme';
        context.refresh();
    }

    function onSettingsNavClick() {
        openExtensionPage('options');
    }

    function goBack() {
        const activePage = store.activePage;
        const settingsPageSubpages: PageId[] = ['automation', 'manage-settings', 'site-list'];
        if (settingsPageSubpages.includes(activePage)) {
            store.activePage = 'settings';
        } else {
            store.activePage = 'main';
        }
        context.refresh();
    }

    popstate = goBack;

    function onBackClick() {
        if (isMobile) {
            history.back();
        } else {
            goBack();
        }
    }

    return (
        <PageViewer
            activePage={store.activePage}
            onBackButtonClick={onBackClick}
        >
            <Page id="main">
                <MainPage
                    {...props}
                    onThemeNavClick={onThemeNavClick}
                    onSettingsNavClick={onSettingsNavClick}
                />
            </Page>
            <Page id="theme">
                <ThemePage {...props} />
            </Page>

        </PageViewer>
    );
}

function DonateGroup() {
    return (
        <div class="m-donate-group">
            <a class="m-donate-button" href={DONATE_URL} target="_blank" rel="noopener noreferrer">
                <span class="m-donate-button__icon"></span>
                <span class="m-donate-button__text">
                    {getLocalMessage('donate')}
                </span>
            </a>
            <label class="m-donate-description">
                This project is sponsored by you
            </label>
        </div>
    );
}

export default function Body(props: ViewProps) {
    const context = getContext();
    context.onCreate(() => {
        if (isMobile) {
            window.addEventListener('contextmenu', ({preventDefault}) => preventDefault());
        }
    });
    context.onRemove(() => {
        document.documentElement.classList.remove('preview');
    });

    return (
        <body>
            <section class="m-section">
                <Logo />
            </section>
            <section class="m-section pages-section">
                <Pages {...props} />
            </section>
            <section class="m-section">
                <DonateGroup />
            </section>
            <NewsSection {...props} />
            <Overlay />
        </body>
    );
}

```

### ui\popup\components\custom-settings-toggle\style.less

```
@import "../../../theme";

.custom-settings-toggle {
    color: @color-fore;
    white-space: normal;

    &--checked,
    &:active,
    &--checked:hover {
        background-color: @color-control-active;
        color: mix(@color-fore, @color-control-fore, 80%);
        transition: background-color @time-fast, color @time-fast;
    }

    &--disabled {
        opacity: 0.5;
        pointer-events: none;
    }

    &__url {
        color: @color-control-fore;
        -moz-user-select: none;
        user-select: none;
    }

    .button__wrapper {
        align-items: center;
        display: inline-flex;
        justify-content: center;
        min-width: @popup-content-width - 2 * @size-border;
    }
}

```

### ui\popup\components\custom-settings-toggle\index.tsx

```
import {m} from 'malevic';

import type {ExtWrapper} from '../../../../definitions';
import {getLocalMessage} from '../../../../utils/locales';
import {getURLHostOrProtocol, isURLInList} from '../../../../utils/url';
import {Button} from '../../../controls';

declare const __THUNDERBIRD__: boolean;

export default function CustomSettingsToggle({data, actions}: ExtWrapper) {
    const tab = data.activeTab;
    const host = getURLHostOrProtocol(tab.url);

    const isCustom = data.settings.customThemes.some(({url}) => isURLInList(tab.url, url));

    const urlText = host
        .split('.')
        .reduce<string[]>((elements, part, i) => elements.concat(
            <wbr />,
            `${i > 0 ? '.' : ''}${part}`
        ), []);

    return (
        <Button
            class={{
                'custom-settings-toggle': true,
                'custom-settings-toggle--checked': isCustom,
                'custom-settings-toggle--disabled': __THUNDERBIRD__ || tab.isProtected,
            }}
            onclick={(e) => {
                if (isCustom) {
                    const filtered = data.settings.customThemes.filter(({url}) => !isURLInList(tab.url, url));
                    actions.changeSettings({customThemes: filtered});
                } else {
                    const extended = data.settings.customThemes.concat({
                        url: [host],
                        theme: {...data.settings.theme},
                    });
                    actions.changeSettings({customThemes: extended});
                    (e.currentTarget as HTMLElement).classList.add('custom-settings-toggle--checked'); // Speed-up reaction
                }
            }}
        >
            <span class="custom-settings-toggle__wrapper">
                {getLocalMessage('only_for')} <span class="custom-settings-toggle__url" >{urlText}</span>
            </span>
        </Button>
    );
}

```

### ui\popup\components\engine-switch\style.less

```
@import "../../../theme";

.engine-switch {
    align-items: stretch;
    display: flex;
    flex-direction: column;
    position: relative;

    &__description {
        font-size: @size-text-small;
        line-height: @size-text-small-height;
        text-align: center;
        white-space: nowrap;
    }

    &__css-edit-button {
        background-color: @color-heading;
        border-radius: @size-text-small-height / 2;
        color: @color-control-fore;
        cursor: pointer;
        display: none;
        font-size: @size-text-small;
        line-height: @size-text-small-height;
        min-width: @size-text-small-height;
        position: absolute;
        right: 0;
        text-align: center;
        top: -@size-text-small-height / 4;

        &_active {
            display: inline-block;
        }

        &::before {
            content: "✎";
            line-height: @size-text-small-height;
        }

        &:hover {
            box-shadow: 0 0 @indent-large @color-control-fore;
        }
    }
}

```

### ui\popup\components\engine-switch\index.tsx

```
import {m} from 'malevic';

import {ThemeEngine} from '../../../../generators/theme-engines';
import {getLocalMessage} from '../../../../utils/locales';
import {MultiSwitch} from '../../../controls';
import {openExtensionPage} from '../../../utils';

const engineNames: Array<[ThemeEngine, string]> = [
    [ThemeEngine.dynamicTheme, getLocalMessage('engine_dynamic')],
    [ThemeEngine.cssFilter, getLocalMessage('engine_filter')],
    [ThemeEngine.svgFilter, getLocalMessage('engine_filter_plus')],
    [ThemeEngine.staticTheme, getLocalMessage('engine_static')],
];

interface EngineSwitchProps {
    engine: ThemeEngine;
    onChange: (engine: ThemeEngine) => void;
}

function openCSSEditor() {
    openExtensionPage('stylesheet-editor');
}

export default function EngineSwitch({engine, onChange}: EngineSwitchProps) {
    return (
        <div class="engine-switch">
            <MultiSwitch
                value={engineNames.find(([code]) => code === engine)![1]}
                options={engineNames.map(([, name]) => name)}
                onChange={(value) => onChange(engineNames.find(([, name]) => name === value)![0])}
            />
            <span
                class={{
                    'engine-switch__css-edit-button': true,
                    'engine-switch__css-edit-button_active': engine === ThemeEngine.staticTheme,
                }}
                onclick={openCSSEditor}
            ></span>
            <label class="engine-switch__description">{getLocalMessage('theme_generation_mode')}</label>
        </div>
    );
}

```

### ui\popup\components\filter-settings\mode-toggle.tsx

```
import {m} from 'malevic';

import {getLocalMessage} from '../../../../utils/locales';
import {Button, Toggle} from '../../../controls';

interface ModeToggleProps {
    mode: number;
    onChange: (mode: number) => void;
}

export default function ModeToggle({mode, onChange}: ModeToggleProps) {
    return (
        <div class="mode-toggle">
            <div class="mode-toggle__line">
                <Button
                    class={{'mode-toggle__button--active': mode === 1}}
                    onclick={() => onChange(1)}
                >
                    <span class="icon icon--dark-mode"></span>
                </Button>
                <Toggle
                    checked={mode === 1}
                    labelOn={getLocalMessage('dark')}
                    labelOff={getLocalMessage('light')}
                    onChange={(checked) => onChange(checked ? 1 : 0)}
                />
                <Button
                    class={{'mode-toggle__button--active': mode === 0}}
                    onclick={() => onChange(0)}
                >
                    <span class="icon icon--light-mode"></span>
                </Button>
            </div>
            <label class="mode-toggle__label">{getLocalMessage('mode')}</label>
        </div>
    );
}

```

### ui\popup\components\filter-settings\style.less

```
@import "../../../theme";

.filter-settings {
    align-items: stretch;
    display: flex;
    flex-direction: column;
    width: 100%;

    > :not(:first-child) {
        margin-top: @indent-small;
    }

    &__content {
        align-items: center;
        display: flex;
        flex: auto;
        flex-direction: column;
        justify-content: center;
    }
}

.mode-toggle {
    align-items: stretch;
    display: flex;
    flex-direction: column;
    -moz-user-select: none;
    user-select: none;

    &__line {
        display: flex;
        flex-direction: row;

        > :not(:first-child) {
            margin-left: @indent-small;
        }
    }

    .toggle {
        flex: auto;
    }

    &__label {
        font-size: @size-text-small;
        line-height: @size-text-small-height;
        text-align: center;
    }

    &__button--active {
        background: @color-control-active;

        &:hover {
            background: @color-control-active;
        }
    }
}

.icon {
    background-size: contain;
    display: inline-block;
    height: 100%;
    width: 100%;
}

.icon--dark-mode {
    background-image: url(../assets/images/mode-dark-32.svg);
}

.icon--light-mode {
    background-image: url(../assets/images/mode-light-32.svg);
}

```

### ui\popup\components\filter-settings\index.tsx

```
import {m} from 'malevic';

import type {ExtWrapper, Theme} from '../../../../definitions';
import {getLocalMessage} from '../../../../utils/locales';
import {isURLInList} from '../../../../utils/url';
import {UpDown} from '../../../controls';
import CustomSettingsToggle from '../custom-settings-toggle';

import ModeToggle from './mode-toggle';

export default function FilterSettings({data, actions}: ExtWrapper, ...children: Malevic.Child[]) {
    const custom = data.settings.customThemes.find(({url}) => isURLInList(data.activeTab.url, url));
    const theme = custom ? custom.theme : data.settings.theme;

    function setConfig(config: Partial<Theme>) {
        if (custom) {
            custom.theme = {...custom.theme, ...config};
            actions.changeSettings({customThemes: data.settings.customThemes});
        } else {
            actions.setTheme(config);
        }
    }

    const brightness = (
        <UpDown
            value={theme.brightness}
            min={50}
            max={150}
            step={5}
            default={100}
            name={getLocalMessage('brightness')}
            onChange={(value) => setConfig({brightness: value})}
        />
    );

    const contrast = (
        <UpDown
            value={theme.contrast}
            min={50}
            max={150}
            step={5}
            default={100}
            name={getLocalMessage('contrast')}
            onChange={(value) => setConfig({contrast: value})}
        />
    );

    const grayscale = (
        <UpDown
            value={theme.grayscale}
            min={0}
            max={100}
            step={5}
            default={0}
            name={getLocalMessage('grayscale')}
            onChange={(value) => setConfig({grayscale: value})}
        />
    );

    const sepia = (
        <UpDown
            value={theme.sepia}
            min={0}
            max={100}
            step={5}
            default={0}
            name={getLocalMessage('sepia')}
            onChange={(value) => setConfig({sepia: value})}
        />
    );

    return (
        <section class="filter-settings">
            <ModeToggle mode={theme.mode} onChange={(mode) => setConfig({mode})} />
            {brightness}
            {contrast}
            {sepia}
            {grayscale}
            <CustomSettingsToggle data={data} actions={actions} />
            <div class="filter-settings__content">
                {...children}
            </div>
        </section>
    );
}

```

### ui\popup\components\font-settings\style.less

```
@import "../../../theme";

.font-settings {
    display: flex;
    flex-direction: column;
    width: 100%;

    &__font-select-container {
        display: flex;
        flex-direction: column;

        &__line {
            display: flex;
            flex-direction: row;

            > :not(:first-child) {
                margin-left: @indent-small;
            }

            .select {
                flex: auto;
            }
        }

        &__label {
            font-size: @size-text-small;
            line-height: @size-text-small-height;
            text-align: center;
            white-space: nowrap;
        }
    }

    > :not(:first-child) {
        margin-top: @indent-small;
    }
}

```

### ui\popup\components\font-settings\index.tsx

```
import {m} from 'malevic';

import type {Theme} from '../../../../definitions';
import {getLocalMessage} from '../../../../utils/locales';
import {CheckBox, UpDown, Select} from '../../../controls';

interface FontSettingsProps {
    config: Theme;
    fonts: string[];
    onChange: (config: Partial<Theme>) => void;
}

export default function FontSettings({config, fonts, onChange}: FontSettingsProps) {
    return (
        <section class="font-settings">
            <div class="font-settings__font-select-container">
                <div class="font-settings__font-select-container__line">
                    <CheckBox
                        checked={config.useFont}
                        onchange={(e: {target: HTMLInputElement}) => onChange({useFont: e.target.checked})}
                    />
                    <Select
                        value={config.fontFamily}
                        onChange={(value) =>
                            onChange({
                                fontFamily: value,
                                useFont: true,
                            })
                        }
                        options={fonts.reduce((map, font) => {
                            map[font] = (
                                <div style={{'font-family': font}}>
                                    {font}
                                </div>
                            );
                            return map;
                        }, {} as {[font: string]: Malevic.Spec})}
                    />
                </div>
                <label class="font-settings__font-select-container__label">
                    {getLocalMessage('select_font')}
                </label>
            </div>
            <UpDown
                value={config.textStroke}
                min={0}
                max={1}
                step={0.1}
                default={0}
                name={getLocalMessage('text_stroke')}
                onChange={(value) => onChange({textStroke: value})}
            />
        </section>
    );
}

```

### ui\popup\components\header\more-new-highlight.tsx

```
import {m} from 'malevic';

export default function MoreNewHighlight() {
    const a1 = {x: 244, y: 26};
    const aq = {x: 144, y: 26};
    const a2 = {x: 128, y: 8};

    const b1 = {x: 244, y: 22};
    const bq = {x: 208, y: 22};
    const b2 = {x: 200, y: 8};

    const r = 2;

    return (
        <div class="header__more-new-highlight">
            <svg class="header__more-new-highlight__lines" viewBox="0 0 272 32" width="272" height="32">
                <path d={`M${a1.x},${a1.y} Q${aq.x},${aq.y} ${a2.x},${a2.y}`} />
                <path d={`M${b1.x},${b1.y} Q${bq.x},${bq.y} ${b2.x},${b2.y}`} />
                <circle cx={a2.x} cy={a2.y} r={r} />
                <circle cx={b2.x} cy={b2.y} r={r} />
            </svg>
            <span class="header__more-new-highlight__text">New</span>
        </div>
    );
}

```

### ui\popup\components\header\index.tsx

```
import {m} from 'malevic';

import type {ExtensionData, ExtWrapper} from '../../../../definitions';
import {AutomationMode} from '../../../../utils/automation';
import {HOMEPAGE_URL} from '../../../../utils/links';
import {getLocalMessage} from '../../../../utils/locales';
import {isChromium} from '../../../../utils/platform';
import {isLocalFile} from '../../../../utils/url';
import {Toggle} from '../../../controls';
import {SettingsIcon, SunMoonIcon, SystemIcon, WatchIcon} from '../../../icons';
import SiteToggle from '../site-toggle';

import MoreNewHighlight from './more-new-highlight';
import MoreSiteSettings from './more-site-settings';
import MoreToggleSettings from './more-toggle-settings';


declare const __CHROMIUM_MV3__: boolean;

type HeaderProps = ExtWrapper & {
    onMoreSiteSettingsClick: () => void;
    onMoreToggleSettingsClick: () => void;
};

export function getAutomationMessage(props: {data: ExtensionData}) {
    const {data} = props;
    const isAutomation = data.settings.automation.enabled;
    const isTimeAutomation = data.settings.automation.mode === AutomationMode.TIME;
    const isLocationAutomation = data.settings.automation.mode === AutomationMode.LOCATION;
    return isAutomation
        ? (
            isTimeAutomation
                ? (data.isEnabled ? getLocalMessage('auto_night_time') : getLocalMessage('auto_day_time'))
                : isLocationAutomation
                    ? data.isEnabled ? getLocalMessage('auto_night_at_location') : getLocalMessage('auto_day_at_location')
                    : data.isEnabled ? getLocalMessage('auto_system_is_dark') : getLocalMessage('auto_system_is_light')
        )
        : getLocalMessage('configure_automation');
}

export function toggleExtension(props: ExtWrapper, enabled: boolean) {
    const {data, actions} = props;
    actions.changeSettings({
        enabled,
        automation: {...data.settings.automation, ...{enabled: false}},
    });
}

export function getSiteToggleMessage(props: ExtWrapper) {
    const {data} = props;
    const tab = data.activeTab;
    const isFile = isChromium && isLocalFile(tab.url);

    const isProtected = !isFile && ((!__CHROMIUM_MV3__ && !tab.isInjected) || tab.isProtected);

    return isProtected ?
        getLocalMessage('page_protected')
        : isFile && !data.isAllowedFileSchemeAccess ?
            getLocalMessage('local_files_forbidden')
            : tab.isInDarkList ?
                getLocalMessage('page_in_dark_list')
                : tab.isDarkThemeDetected ?
                    getLocalMessage('dark_theme_detected')
                    : getLocalMessage('configure_site_toggle');
}

function Header(props: HeaderProps) {
    const {data, actions, onMoreSiteSettingsClick, onMoreToggleSettingsClick} = props;

    function toggleApp(enabled: boolean) {
        toggleExtension(props, enabled);
    }

    const tab = data.activeTab;
    const isFile = isChromium && isLocalFile(tab.url);
    const isAutomation = data.settings.automation.enabled;
    const isTimeAutomation = data.settings.automation.mode === AutomationMode.TIME;
    const isLocationAutomation = data.settings.automation.mode === AutomationMode.LOCATION;
    const now = new Date();

    const automationMessage = getAutomationMessage({data});

    const isProtected = !isFile && ((!__CHROMIUM_MV3__ && !tab.isInjected) || tab.isProtected);
    const isProtectedFile = isFile && !data.isAllowedFileSchemeAccess;
    const isSiteEnabled = !(isProtected || isProtectedFile || tab.isInDarkList);

    const siteToggleMessage = getSiteToggleMessage(props);

    return (
        <header class="header">
            <a class="header__logo" href={HOMEPAGE_URL} target="_blank" rel="noopener noreferrer">
                Dark Reader
            </a>
            <div class="header__control header__site-toggle">
                <SiteToggle
                    data={data}
                    actions={actions}
                />
                <span
                    class={{
                        'header__more-settings-button': true,
                        'header__more-settings-button--off': !isSiteEnabled,
                    }}
                    onclick={onMoreSiteSettingsClick}
                >
                    <SettingsIcon class="header__more-settings-button__icon" />
                    {siteToggleMessage}
                </span>
            </div>
            <div class="header__control header__app-toggle">
                <Toggle checked={data.isEnabled} labelOn={getLocalMessage('on')} labelOff={getLocalMessage('off')} onChange={toggleApp} />
                <span
                    class={{
                        'header__more-settings-button': true,
                        'header__more-settings-button--off': !data.isEnabled,
                    }}
                    onclick={onMoreToggleSettingsClick}
                >
                    <SettingsIcon class="header__more-settings-button__icon" />
                    {automationMessage}
                </span>
                <span
                    class={{
                        'header__app-toggle__time': true,
                        'header__app-toggle__time--active': isAutomation,
                    }}
                >
                    {(isTimeAutomation
                        ? <WatchIcon hours={now.getHours()} minutes={now.getMinutes()} />
                        : (isLocationAutomation
                            ? (<SunMoonIcon date={now} latitude={data.settings.location.latitude!} longitude={data.settings.location.longitude!} />)
                            : <SystemIcon />))}
                </span>
            </div>
        </header>
    );
}

export {
    Header,
    MoreNewHighlight,
    MoreSiteSettings,
    MoreToggleSettings, // TODO: Implement portals to place elements into <body>.
};

```

### ui\popup\components\header\more-site-settings.tsx

```
import {m} from 'malevic';

import type {ExtWrapper} from '../../../../definitions';
import {DONATE_URL} from '../../../../utils/links';
import {getLocalMessage} from '../../../../utils/locales';
import {Button, CheckBox, Shortcut} from '../../../controls';
import {KeyboardIcon} from '../../../icons';

type MoreSiteSettingsProps = ExtWrapper & {
    isExpanded: boolean;
    onClose: () => void;
};

export default function MoreSiteSettings({data, actions, isExpanded, onClose}: MoreSiteSettingsProps) {
    function toggleEnabledByDefault() {
        actions.changeSettings({enabledByDefault: !data.settings.enabledByDefault});
    }

    function toggleDetectDarkTheme() {
        actions.changeSettings({detectDarkTheme: !data.settings.detectDarkTheme});
    }

    return (
        <div
            class={{
                'header__more-site-settings': true,
                'header__more-settings': true,
                'header__more-settings--expanded': isExpanded,
            }}
        >
            <div class="header__more-settings__top">
                <span class="header__more-settings__top__text">{getLocalMessage('site_toggle')}</span>
                <span class="header__more-settings__top__close" role="button" onclick={onClose}>✕</span>
            </div>
            <div class="header__more-settings__content">
                <div
                    class={[
                        'header__more-settings__line',
                        'header__more-settings__enabled-by-default',
                    ]}
                >
                    <CheckBox
                        class="header__more-settings__enabled-by-default__checkbox"
                        checked={data.settings.enabledByDefault}
                        onchange={toggleEnabledByDefault}
                    />
                    <Button
                        class={{
                            'header__more-settings__enabled-by-default__button': true,
                            'header__more-settings__enabled-by-default__button--active': data.settings.enabledByDefault,
                        }}
                        onclick={toggleEnabledByDefault}
                    >{getLocalMessage('enabled_by_default')}</Button>
                </div>
                <p class="header__more-settings__description">
                    {getLocalMessage('enable_for_all_sites_by_default')}
                </p>
                <div class={[
                    'header__more-settings__line',
                    'header__more-settings__detect-dark-theme',
                ]}
                >
                    <CheckBox
                        class="header__more-settings__detect-dark-theme__checkbox"
                        checked={data.settings.detectDarkTheme}
                        onchange={toggleDetectDarkTheme}
                    />
                    <Button
                        class={{
                            'header__more-settings__detect-dark-theme__button': true,
                            'header__more-settings__detect-dark-theme__button--active': data.settings.detectDarkTheme,
                        }}
                        onclick={toggleDetectDarkTheme}
                    >{getLocalMessage('detect_dark_theme')}</Button>
                </div>
                <p class="header__more-settings__description">
                    {getLocalMessage('detect_website_dark_theme')}
                </p>
                <span
                    class={{
                        'header__more-settings__shortcut-wrapper': true,
                        'header__more-settings__shortcut-wrapper--set': data.shortcuts['toggle'],
                    }}
                >
                    <Shortcut
                        class={{
                            'header__more-settings__shortcut': true,
                            'header__more-settings__shortcut--set': data.shortcuts['toggle'],
                        }}
                        commandName="addSite"
                        shortcuts={data.shortcuts}
                        textTemplate={(hotkey) => (hotkey
                            ? hotkey
                            : getLocalMessage('click_to_set_shortcut')
                        )}
                        onSetShortcut={(shortcut) => actions.setShortcut('addSite', shortcut)}
                    />
                    <KeyboardIcon />
                </span>
                <p class="header__more-settings__description">
                    {getLocalMessage('website_toggle_shortcut')}
                </p>
                <div class="header__more-settings__donate">
                    <a class="donate-link" href={DONATE_URL} target="_blank" rel="noopener noreferrer">
                        <span class="donate-link__text">{getLocalMessage('pay_for_using')}</span>
                    </a>
                    <p class="header__more-settings__description">
                        {getLocalMessage('support_out_work')}
                    </p>
                </div>
            </div>
        </div>
    );
}

```

### ui\popup\components\header\more-toggle-settings.tsx

```
import {m} from 'malevic';

import type {Automation, ExtWrapper} from '../../../../definitions';
import {AutomationMode} from '../../../../utils/automation';
import {DONATE_URL} from '../../../../utils/links';
import {getLocalMessage} from '../../../../utils/locales';
import {isMatchMediaChangeEventListenerBuggy} from '../../../../utils/platform';
import {Button, CheckBox, Shortcut, TextBox, TimeRangePicker} from '../../../controls';
import {KeyboardIcon} from '../../../icons';

type MoreToggleSettingsProps = ExtWrapper & {
    isExpanded: boolean;
    onClose: () => void;
};

export default function MoreToggleSettings({data, actions, isExpanded, onClose}: MoreToggleSettingsProps) {
    const isSystemAutomation = data.settings.automation.mode === AutomationMode.SYSTEM;
    const locationSettings = data.settings.location;
    const values = {
        'latitude': {
            min: -90,
            max: 90,
        },
        'longitude': {
            min: -180,
            max: 180,
        },
    };

    function getLocationString(location: number | null) {
        if (location == null) {
            return '';
        }

        return `${location}°`;
    }

    function locationChanged(inputElement: HTMLInputElement, newValue: string, type: 'latitude' | 'longitude') {
        if (newValue.trim() === '') {
            inputElement.value = '';

            actions.changeSettings({
                location: {
                    ...locationSettings,
                    [type]: null,
                },
            });

            return;
        }

        const min: number = values[type].min;
        const max: number = values[type].max;

        newValue = newValue.replace(',', '.').replace('°', '');

        let num = Number(newValue);
        if (isNaN(num)) {
            num = 0;
        } else if (num > max) {
            num = max;
        } else if (num < min) {
            num = min;
        }

        inputElement.value = getLocationString(num);

        actions.changeSettings({
            location: {
                ...locationSettings,
                [type]: num,
            },
        });
    }

    function changeAutomationMode(mode: Automation['mode']) {
        actions.changeSettings({automation: {...data.settings.automation, ...{mode, enabled: Boolean(mode)}}});
    }

    return (
        <div
            class={{
                'header__more-toggle-settings': true,
                'header__more-settings': true,
                'header__more-settings--expanded': isExpanded,
            }}
        >
            <div class="header__more-settings__top">
                <span class="header__more-settings__top__text">{getLocalMessage('automation')}</span>
                <span class="header__more-settings__top__close" role="button" onclick={onClose}>✕</span>
            </div>
            <div class="header__more-settings__content">
                <div class="header__more-settings__line">
                    <CheckBox
                        checked={data.settings.automation.mode === AutomationMode.TIME}
                        onchange={(e: {target: HTMLInputElement}) => changeAutomationMode(e.target.checked ? AutomationMode.TIME : AutomationMode.NONE)}
                    />
                    <TimeRangePicker
                        startTime={data.settings.time.activation}
                        endTime={data.settings.time.deactivation}
                        onChange={([start, end]) => actions.changeSettings({time: {activation: start, deactivation: end}})}
                    />
                </div>
                <p class="header__more-settings__description">
                    {getLocalMessage('set_active_hours')}
                </p>
                <div class="header__more-settings__line header__more-settings__location">
                    <CheckBox
                        checked={data.settings.automation.mode === AutomationMode.LOCATION}
                        onchange={(e: {target: HTMLInputElement}) => changeAutomationMode(e.target.checked ? AutomationMode.LOCATION : AutomationMode.NONE)}
                    />
                    <TextBox
                        class="header__more-settings__location__latitude"
                        placeholder={getLocalMessage('latitude')}
                        onchange={(e: {target: HTMLInputElement}) => locationChanged(e.target, e.target.value, 'latitude')}
                        oncreate={(node: HTMLInputElement) => node.value = getLocationString(locationSettings.latitude)}
                        onkeypress={(e: KeyboardEvent) => {
                            if (e.key === 'Enter') {
                                (e.target as HTMLInputElement).blur();
                            }
                        }}
                    />
                    <TextBox
                        class="header__more-settings__location__longitude"
                        placeholder={getLocalMessage('longitude')}
                        onchange={(e) => locationChanged(e.target, e.target.value, 'longitude')}
                        oncreate={(node: HTMLInputElement) => node.value = getLocationString(locationSettings.longitude)}
                        onkeypress={(e) => {
                            if (e.key === 'Enter') {
                                (e.target as HTMLInputElement).blur();
                            }
                        }}
                    />
                </div>
                <p class="header__more-settings__location-description">
                    {getLocalMessage('set_location')}
                </p>
                <div class={[
                    'header__more-settings__line',
                    'header__more-settings__system-dark-mode',
                ]}
                >
                    <CheckBox
                        class="header__more-settings__system-dark-mode__checkbox"
                        checked={isSystemAutomation}
                        onchange={(e: {target: HTMLInputElement}) => changeAutomationMode(e.target.checked ? AutomationMode.SYSTEM : AutomationMode.NONE)}
                    />
                    <Button
                        class={{
                            'header__more-settings__system-dark-mode__button': true,
                            'header__more-settings__system-dark-mode__button--active': isSystemAutomation,
                        }}
                        onclick={() => changeAutomationMode(isSystemAutomation ? AutomationMode.NONE : AutomationMode.SYSTEM)}
                    >{getLocalMessage('system_dark_mode')}</Button>
                </div>
                <p class="header__more-settings__description">
                    {getLocalMessage('system_dark_mode_description')}
                </p>
                {!isMatchMediaChangeEventListenerBuggy ? null :
                    <p class="header__more-settings__warning">
                        {getLocalMessage('system_dark_mode_chromium_warning')}
                    </p>
                }
                <span
                    class={{
                        'header__more-settings__shortcut-wrapper': true,
                        'header__more-settings__shortcut-wrapper--set': data.shortcuts['toggle'],
                    }}
                >
                    <Shortcut
                        class={{
                            'header__more-settings__shortcut': true,
                            'header__more-settings__shortcut--set': data.shortcuts['toggle'],
                        }}
                        commandName="toggle"
                        shortcuts={data.shortcuts}
                        textTemplate={(hotkey) => (hotkey
                            ? hotkey
                            : getLocalMessage('click_to_set_shortcut')
                        )}
                        onSetShortcut={(shortcut) => actions.setShortcut('toggle', shortcut)}
                    />
                    <KeyboardIcon />
                </span>
                <p class="header__more-settings__description">
                    {getLocalMessage('extension_toggle_shortcut')}
                </p>
                <div class="header__more-settings__donate">
                    <a class="donate-link" href={DONATE_URL} target="_blank" rel="noopener noreferrer">
                        <span class="donate-link__text">{getLocalMessage('pay_for_using')}</span>
                    </a>
                    <p class="header__more-settings__description">
                        {getLocalMessage('support_out_work')}
                    </p>
                </div>
            </div>
        </div>
    );
}

```

### ui\popup\components\header\style.less

```
@import "../../../theme";

@more-settings-line-height: 2 * @size-border + @size-control-inner + @size-text-small-height;  

.header {
    display: grid;
    grid:
        "logo logo"
        "site-toggle app-toggle"
        / 5.5fr 4.5fr;
    grid-gap: @indent-small;
    width: 100%;

    &__logo {
        background-image: url('../assets/images/darkreader-type.svg');
        background-size: 100%;
        grid-area: logo;
        height: @popup-content-width / 10;
        outline: none;
        text-indent: -999rem;
        width: @popup-content-width;

        &:hover {
            filter: brightness(1.05);
        }
    }

    &__control {
        display: flex;
        flex-direction: column;
    }

    &__site-toggle {
        grid-area: site-toggle;
        min-width: 0;
    }

    &__app-toggle {
        grid-area: app-toggle;
        min-width: 0;
        position: relative;

        &__time {
            background-color: @color-heading;
            border-radius: 50%;
            color: @color-control-fore;
            cursor: pointer;
            display: none;
            height: @size-text-small-height;
            pointer-events: none;
            position: absolute;
            right: -@size-text-small-height / 4;
            top: -@size-text-small-height / 4;
            transition: opacity @time-slow @time-slow;
            width: @size-text-small-height;

            &--active {
                display: inline-block;
            }
        }
    }

    &__more-settings-button {
        cursor: pointer;
        font-size: @size-text-small;
        line-height: @size-text-small-height;
        text-align: center;
        user-select: none;

        &:hover {
            text-decoration: underline;
        }

        &__icon {
            height: @size-text-small;
            margin-right: 0.125rem;
            position: relative;
            top: 0.0625rem;
            width: @size-text-small;

            g {
                fill: @color-fore;
            }
        }

        &--off {
            color: @color-heading;
        }

        &--off &__icon g {
            fill: @color-heading;
        }
    }

    &__more-site-settings {
        height: 14.5rem;
    }

    &__more-toggle-settings {
        height: 18rem;
    }

    &__more-settings {
        background-color: fadeout(@color-back, 10%);
        border-bottom: @size-border solid @color-border;
        border-top: @size-border solid @color-border;
        display: flex;
        flex-direction: column;
        left: 0;
        position: absolute;
        top: @popup-content-padding + 2 * @size-control-inner + @size-border + 2 * @size-text-small-height + 2 * @indent-small;
        transition: all @time-slow;
        width: 100%;
        z-index: 999;

        &:not(&--expanded) {
            height: 0;
            opacity: 0;
            pointer-events: none;
        }

        &__top {
            align-items: center;
            color: @color-heading;
            display: flex;
            flex: auto;
            font-size: @size-text-large;
            height: @size-control-inner;
            justify-content: space-between;
            overflow: hidden;
            padding-left: @popup-content-padding;

            &__text {
                line-height: @size-text-large-height;
            }

            &__close {
                color: @color-heading;
                cursor: pointer;
                display: inline-block;
                font-size: @size-control-inner * 3 / 4;
                height: @size-control-inner;
                line-height: @size-control-inner;
                text-align: center;
                user-select: none;
                width: @size-control-inner;

                &:hover {
                    background-color: fade(@color-control-active, 25%);
                }
            }
        }

        &__content {
            flex: auto;
            overflow: hidden;
            padding: @indent-large @popup-content-padding;
            transition: padding @time-slow;
        }

        &__line {
            display: flex;
            flex-direction: row;

            .checkbox {
                border-right: none;
                flex: none;
            }

            .time-range-picker .time-range-picker__input--start {
                border-left: @size-border-inner solid @color-border;
            }
        }

        &__description {
            font-size: @size-text-small;
            line-height: @size-text-small-height;
            margin: 0;
            text-align: center;
            white-space: nowrap;
        }

        &__warning {
            font-size: @size-text-small;
            line-height: @size-text-small-height;
            margin: 0;
            text-align: center;
            white-space: pre;
            color: @color-heading;
        }

        &__location-description {
            font-size: @size-text-small;
            line-height: @size-text-small-height;
            margin: 0;
            text-align: center;
            white-space: nowrap;
        }

        &::after {
            background-image: linear-gradient(to bottom, fadeout(@color-back, 10%), fadeout(@color-back, 100%));
            content: "";
            display: block;
            height: @size-control-inner;
            left: 0;
            margin-top: @size-border;
            pointer-events: none;
            position: absolute;
            top: 100%;
            transition: height @time-slow;
            width: 100%;
        }

        &__location {
            margin-top: @indent-small;

            &__latitude,
            &__longitude {
                flex: auto;
                text-align: center;
                text-indent: 0;
                width: 100%;
            }

            &__latitude {
                border-left: @size-border-inner solid @color-border;
                border-right: none;
            }

            &__longitude {
                border-left: @size-border-inner solid @color-border;
            }
        }

        &__system-dark-mode {
            display: flex;
            flex-direction: row;
            margin-top: @indent-small;

            &__checkbox {
                flex: none;
            }

            &__button {
                border-left-width: @size-border-inner;
                flex: auto;

                &:not(&--active) {
                    color: @color-input-fore;
                }
            }

            &:hover &__button,
            &:hover &__checkbox {
                background-color: @color-control-hover;
            }
        }

        &__shortcut-wrapper {
            display: inline-block;
            height: @size-control-inner + 2 * @size-border;
            margin-top: @indent-small;
            position: relative;
            width: 100%;

            svg {
                --icon-color: @color-control-fore-inactive;
                border-right: @size-border-inner solid @color-border;
                height: @size-control-inner;
                left: @size-border;
                pointer-events: none;
                position: absolute;
                top: @size-border;
                width: @size-control-inner;
            }

            &--set svg {
                --icon-color: @color-control-fore;
            }
        }

        &__shortcut {
            background-color: @color-control-back;
            border: @size-border solid @color-border;
            font-size: @size-text-normal;
            height: @size-control-inner;
            line-height: @size-control-inner;
            padding-left: @size-control-inner;
            position: relative;
            transition: all @time-fast;
            white-space: nowrap;
            width: calc(100% - 2 * @size-border - @size-control-inner);

            &:hover {
                background-color: @color-control-hover;
                text-decoration: none;

                &::before {
                    display: none;
                }
            }
        }

        &__enabled-by-default {
            display: flex;
            flex-direction: row;

            &__checkbox {
                flex: none;
            }

            &__button {
                border-left-width: @size-border-inner;
                flex: auto;

                &:not(&--active) {
                    color: @color-input-fore;
                }
            }

            &:hover &__button,
            &:hover &__checkbox {
                background-color: @color-control-hover;
            }
        }

        &__detect-dark-theme {
            display: flex;
            flex-direction: row;
            margin-top: @indent-small;

            &__checkbox {
                flex: none;
            }

            &__button {
                border-left-width: @size-border-inner;
                flex: auto;

                &:not(&--active) {
                    color: @color-input-fore;
                }
            }

            &:hover &__button,
            &:hover &__checkbox {
                background-color: @color-control-hover;
            }
        }

        &__donate {
            margin-top: @indent-small;

            .donate-link {
                width: 100%;
            }
        }
    }

    .shortcut {
        overflow: hidden;
    }

    &__more-new-highlight {
        height: 2rem;
        pointer-events: none;
        position: absolute;
        right: 0rem;
        top: 5.75rem;
        width: 17rem;

        &__text {
            background: @color-heading;
            bottom: 0;
            color: @color-control-fore;
            display: inline-block;
            line-height: 0.75rem;
            padding: 0.25rem;
            position: absolute;
            right: 0.5rem;
        }

        &__lines {
            path {
                fill: none;
                stroke: @color-heading;
                stroke-linecap: round;
                stroke-linejoin: round;
                stroke-width: 2;
            }

            circle {
                fill: @color-heading;
                stroke: none;
            }
        }
    }
}

```

### ui\popup\components\loader\index.tsx

```
import {m} from 'malevic';
import {getContext} from 'malevic/dom';
import {withState, useState} from 'malevic/state';

import {getLocalMessage} from '../../../../utils/locales';


interface LoaderProps {
    complete: boolean;
}

interface LoaderState {
    finished: boolean;
    errorOccured: boolean;
}

function Loader({complete = false}: LoaderProps) {
    const context = getContext();
    const {state, setState} = useState<LoaderState>({finished: false, errorOccured: false});

    // Add a setTimeout for 3 seconds(in which the UI should be loaded already)
    // after the 3 seconds show a generic error message that the UI couldn't be loaded.
    if (!state.errorOccured && !complete) {
        context.store.loaderTimeoutID = setTimeout(() => {
            setState({errorOccured: true});
            context.refresh();
        }, 3000);
    }
    if (complete) {
        clearTimeout(context.store.loaderTimeoutID);
    }

    const labelMessage = state.errorOccured ? "A unknown error has occured, the UI couldn't be loaded" : getLocalMessage('loading_please_wait');

    return (
        <div
            class={{
                'loader': true,
                'loader--complete': complete,
                'loader--transition-end': state.finished,
            }}
            ontransitionend={() => setState({finished: true})}
        >
            <label class={{
                'loader__message': true,
                'loader__error': state.errorOccured,
            }}>{labelMessage}</label>
        </div>
    );
}

export default withState(Loader);

```

### ui\popup\components\loader\style.less

```
@import "../../../theme";

@loading-fade-duration: @time-fast;
@loading-slide-duration: 2s;
@loading-slide-delay: 2 * @time-slow;

.loader {
    background-color: @color-back;
    height: @popup-content-height + 2 * @popup-content-padding;
    left: 50%;
    pointer-events: none;
    position: fixed;
    top: 50%;
    transform: translate(-50%, -50%);
    transition: background-color @loading-fade-duration ease-out;
    width: @popup-content-width + 2 * @popup-content-padding;
    z-index: 999;

    &--complete {
        background-color: fade(@color-back, 0%);

        &::before {
            opacity: 0;
            transition: opacity @loading-fade-duration ease-in;
        }
    }

    &--transition-end {
        display: none;
    }

    &::before {
        animation: @loading-slide-duration loading-slide @loading-slide-delay ease-in-out infinite, @loading-slide-duration * 2 @loading-slide-delay loading-color linear infinite;
        background-color: @color-border;
        content: "";
        display: block;
        height: @size-border-inner;
        left: 0%;
        position: absolute;
        top: @popup-content-padding + @size-control-inner + @indent-small;
        width: 0%;
    }

    &__message {
        animation: @loading-fade-duration loading-fade-in @loading-slide-delay ease-in forwards;
        color: @color-heading;
        font-size: @size-text-small;
        opacity: 0;
        position: absolute;
        right: @popup-content-padding;
        bottom: @popup-content-height + @popup-content-padding - @size-control-inner - @indent-small;
    }

    &__error {
        font-size: @size-text-normal; 
    }

    &--complete &__message {
        color: fade(@color-heading, 0%);
        transition: color @loading-fade-duration ease-out;
    }
}

@keyframes loading-slide {
    0% {
        left: 0%;
        width: 0%;
    }
    50% {
        left: 0%;
        width: 100%;
    }
    100% {
        left: 100%;
        width: 0%;
    }
}

@keyframes loading-color {
    0%, 49% {
        background-color: @color-border;
    }
    50%, 100% {
        background-color: @color-heading;
    }
}

@keyframes loading-fade-in {
    from {
        opacity: 0;
    }
    to {
        opacity: 1;
    }
}

```

### ui\popup\components\more-settings\index.tsx

```
import {m} from 'malevic';

import type {ExtWrapper, Theme} from '../../../../definitions';
import {getLocalMessage} from '../../../../utils/locales';
import {isFirefox} from '../../../../utils/platform';
import {isURLInList} from '../../../../utils/url';
import {Button, Toggle} from '../../../controls';
import {SettingsIcon} from '../../../icons';
import {openExtensionPage} from '../../../utils';
import CustomSettingsToggle from '../custom-settings-toggle';
import EngineSwitch from '../engine-switch';
import FontSettings from '../font-settings';

async function openSettings() {
    await openExtensionPage('options');
}

export default function MoreSettings({data, actions, fonts}: ExtWrapper & {fonts: string[]}) {
    const tab = data.activeTab;
    const custom = data.settings.customThemes.find(({url}) => isURLInList(tab.url, url));
    const theme = custom ? custom.theme : data.settings.theme;

    function setConfig(config: Partial<Theme>) {
        if (custom) {
            custom.theme = {...custom.theme, ...config};
            actions.changeSettings({customThemes: data.settings.customThemes});
        } else {
            actions.setTheme(config);
        }
    }

    return (
        <section class="more-settings">
            <div class="more-settings__section">
                <FontSettings config={theme} fonts={fonts} onChange={setConfig} />
            </div>
            <div class="more-settings__section">
                <EngineSwitch engine={theme.engine} onChange={(engine) => setConfig({engine})} />
            </div>
            <div class="more-settings__section">
                <CustomSettingsToggle data={data} actions={actions} />
                {tab.isProtected ? (
                    <p class="more-settings__description more-settings__description--warning">
                        {getLocalMessage('page_protected').replace(/\n/g, ' ')}
                    </p>
                ) : tab.isInDarkList ? (
                    <p class="more-settings__description more-settings__description--warning">
                        {getLocalMessage('page_in_dark_list').replace(/\n/g, ' ')}
                    </p>
                ) : (
                    <p class="more-settings__description">
                        {getLocalMessage('only_for_description')}
                    </p>
                )}
            </div>
            {isFirefox ? (
                <div class="more-settings__section">
                    <Toggle
                        checked={data.settings.changeBrowserTheme}
                        labelOn={getLocalMessage('custom_browser_theme_on')}
                        labelOff={getLocalMessage('custom_browser_theme_off')}
                        onChange={(checked) => actions.changeSettings({changeBrowserTheme: checked})}
                    />
                    <p class="more-settings__description">
                        {getLocalMessage('change_browser_theme')}
                    </p>
                </div>
            ) : null}
            <div class="more-settings__section">
                <Button onclick={openSettings} class="more-settings__settings-button">
                    <span class="more-settings__settings-button__wrapper">
                        <span class="more-settings__settings-button__icon">
                            <SettingsIcon />
                        </span>
                        <span class="more-settings__settings-button__text">
                            {getLocalMessage('all_settings')}
                        </span>
                    </span>
                </Button>
            </div>
        </section>
    );
}

```

### ui\popup\components\more-settings\style.less

```
@import "../../../theme";

.more-settings {
    display: flex;
    flex-direction: column;
    width: 100%;

    &__description {
        font-size: @size-text-small;
        line-height: @size-text-small-height;
        margin: 0 0 @size-border 0;
        min-width: 100%;
        overflow: hidden;
        text-align: center;
        white-space: pre;

        &--warning {
            color: @color-heading;
        }
    }

    &__warning {
        color: @color-heading;
        white-space: pre;
    }

    &__section {
        align-items: stretch;
        display: flex;
        flex-direction: column;

        &:not(:first-child) {
            margin-top: @indent-large;
        }
    }

    &__settings-button {
        &__wrapper {
            align-items: center;
            display: inline-flex;
            flex-direction: row;
            flex-wrap: nowrap;
            gap: 0.25rem;
            justify-content: center;
        }

        &__icon {
            display: inline-block;
            height: 1rem;
            width: 1rem;
        }

        &__text {
            display: inline-block;
            white-space: nowrap;
        }
    }
}

```

### ui\popup\components\news\style.less

```
@import "../../../theme";

@size-news-icon: 2.5rem;

.news {
    bottom: @size-control-inner + @size-border + @popup-content-padding;
    box-sizing: border-box;
    display: flex;
    flex-direction: column;
    left: 0;
    max-height: 0;
    opacity: 0;
    overflow: hidden;
    pointer-events: none;
    position: absolute;
    text-align: left;
    transition: all @time-slow;
    width: 100%;
    z-index: 1;

    &--expanded {
        max-height: 12rem;
        opacity: 1;
        pointer-events: initial;
    }

    &::before {
        background-image: linear-gradient(to top, @color-back, fade(@color-back, 0%));
        content: "";
        display: block;
        height: @size-control-inner;
        pointer-events: none;
        width: 100%;
    }

    &__header {
        align-items: flex-end;
        background-image: linear-gradient(to bottom, fade(@color-back, 90%), fade(@color-back, 95%));
        border-top: @size-border solid @color-border;
        color: @color-heading;
        display: flex;
        flex: none;
        font-size: @size-text-large;
        height: @size-control-inner;
        justify-content: space-between;
        padding-left: @popup-content-padding;

        &__text {
            line-height: @size-text-large-height;

            &__phone-icon {
                color: @color-fore;
                display: none;
                height: 1rem;
                margin: 0 0.25rem;
                position: relative;
                top: 0.125rem;
                width: 1rem;
            }

            &__dark-reader {
                font-weight: bold;
            }

            &__mobile {
                color: @color-control-fore;
            }
        }
    }

    &__close {
        color: @color-heading;
        cursor: pointer;
        display: inline-block;
        font-size: @size-control-inner * 3 / 4;
        height: @size-control-inner;
        line-height: @size-control-inner;
        text-align: center;
        user-select: none;
        width: @size-control-inner;

        &:hover {
            background-color: fade(@color-control-active, 25%);
        }
    }

    &__list {
        background-color: fade(@color-back, 95%);
        border-bottom: @size-border solid @color-border;
        flex: auto;
        padding: @indent-large @popup-content-padding;
        position: relative;

        > :not(:first-child) {
            margin-top: @indent-small;
        }
    }

    &__event {
        color: @color-fore;
        display: block;
        flex: none;
        position: relative;

        &__date {
            display: block;
            font-size: @size-text-small;
        }

        &__link {
            color: inherit;
            display: inline-block;
            text-decoration: none;

            &:hover {
                text-decoration: underline;
            }
        }

        &__icon {
            background-position: center;
            background-repeat: no-repeat;
            background-size: contain;
            display: inline-block;
            height: @size-news-icon;
            left: 0;
            position: absolute;
            top: calc(50% - @size-news-icon / 2);
            width: @size-news-icon;
        }

        &--has-icon {
            padding-left: @size-news-icon + @indent-small;
        }

        &--unread {
            font-weight: bold;

            &:first-child {
                color: @color-heading;
            }
        }

        &--important {
            color: @color-heading;
        }

        &--important&--unread {
            &::before {
                background-color: @color-heading;
                content: "";
                height: 100%;
                position: absolute;
                right: calc(100% + @indent-large / 2);
                text-align: center;
                top: 0;
                width: @size-border;
            }
        }
    }

    &__read-more {
        color: inherit;
        display: block;
        text-decoration: none;

        &:hover {
            text-decoration: underline;
        }

        &--unread {
            font-weight: bold;
        }
    }

    &__mobile {
        align-items: center;
        display: flex;
        flex-direction: row;
        gap: @indent-small;
        padding-bottom: @size-border;

        &__left {
            display: flex;
            flex: auto;
            flex-direction: column;
            gap: @indent-small;
        }

        &__right {
            display: flex;
            flex: none;
        }

        &__learn-more-container {
            align-items: center;
            display: flex;
            flex-direction: row;
            gap: @indent-small;
        }

        &__logos {
            display: flex;
            flex-direction: row;
            flex: none;
            gap: 0.25rem;
        }

        &__learn-more {
            color: @color-fore;
            font-weight: bold;
            transition: color @time-slow;

            &:hover {
                color: @color-control-fore;
            }
        }
    }

    &__qr-code {
        border-radius: 5%;
        display: inline-block;
        height: 5rem;
        width: 5rem;
    }

    &__os-icon {
        display: inline-block;
        height: 1.25rem;
        width: 1.25rem;
    }
}

.news-button {
    overflow: visible;
    position: relative;

    &--active {
        border-top: none;
        padding-top: @size-border;
        z-index: 2;
    }

    &::after {
        background-color: @color-heading;
        border-radius: @size-text-small-height / 2;
        color: @color-control-fore;
        content: attr(data-count);
        font-size: @size-text-small;
        line-height: @size-text-small-height;
        min-width: @size-text-small-height;
        position: absolute;
        right: -@size-text-small-height / 3;
        top: -@size-text-small-height / 3;
        z-index: 3;
    }

    &__phone-icon {
        display: inline-block;
        height: 1rem;
        width: 1rem;
    }

    &__wrapper {
        align-items: center;
        display: flex;
        flex-direction: row;
        justify-content: center;
    }
}

```

### ui\popup\components\news\index.tsx

```
import {m} from 'malevic';

import type {News} from '../../../../definitions';
import {BLOG_URL} from '../../../../utils/links';
import {getLocalMessage, getUILanguage} from '../../../../utils/locales';
import {Button} from '../../../controls';

interface NewsProps {
    news: News[];
    expanded: boolean;
    onNewsOpen: (...news: News[]) => void;
    onClose: () => void;
}

const NEWS_COUNT = 2;

export function NewsGroup({news, expanded, onNewsOpen, onClose}: NewsProps) {
    return (
        <div class={{'news': true, 'news--expanded': expanded}}>
            <div class="news__header">
                <span class="news__header__text">{getLocalMessage('news')}</span>
                <span class="news__close" role="button" onclick={onClose}>✕</span>
            </div>
            <div class="news__list">
                {news.slice(0, NEWS_COUNT).map((event) => {
                    const date = new Date(event.date);
                    let formattedDate: string;
                    try {
                        // Workaround for https://bugs.chromium.org/p/chromium/issues/detail?id=811403
                        const locale = getUILanguage();
                        formattedDate = date.toLocaleDateString(locale, {month: 'short', day: 'numeric'});
                    } catch (err) {
                        formattedDate = date.toISOString().substring(0, 10);
                    }
                    return (
                        <div
                            class={{
                                'news__event': true,
                                'news__event--unread': !event.read,
                                'news__event--has-icon': event.icon,
                            }}
                        >
                            <a class="news__event__link" onclick={() => onNewsOpen(event)} href={event.url} target="_blank" rel="noopener noreferrer">
                                {event.icon ?
                                    <span class="news__event__icon" style={{'background-image': `url('${event.icon}')`}}></span>
                                    : null}
                                <span class="news__event__date">
                                    {formattedDate}
                                </span>
                                {event.headline}
                            </a>
                        </div>
                    );
                })}
                {(news.length <= NEWS_COUNT
                    ? null
                    : <a
                        class={{
                            'news__read-more': true,
                            'news__read-more--unread': news.slice(NEWS_COUNT).find(({read}) => !read),
                        }}
                        href={BLOG_URL}
                        target="_blank"
                        onclick={() => onNewsOpen(...news)}
                        rel="noopener noreferrer"
                    >{getLocalMessage('read_more')}</a>
                )}
            </div>
        </div>
    );
}

interface NewsButtonProps {
    active: boolean;
    count: number;
    onClick: () => void;
}

export function NewsButton({active, count, onClick}: NewsButtonProps) {
    return (
        <Button
            class={{'news-button': true, 'news-button--active': active}}
            href="#news"
            data-count={count > 0 && !active ? count : null}
            onclick={(e) => {
                (e.currentTarget as HTMLElement).blur();
                onClick();
            }}
        >
            {getLocalMessage('news')}
        </Button>
    );
}

```

### ui\popup\components\news\mobile-links.tsx

```
import {m} from 'malevic';
import {isFirefox} from 'utils/platform';

import {PhoneIcon} from '../../../../ui/icons/phone-icon';
import {MOBILE_URL} from '../../../../utils/links';
import {getLocalMessage} from '../../../../utils/locales';
import {Button} from '../../../controls';


interface MobileLinksProps {
    expanded: boolean;
    onLinkClick: () => void;
    onClose: () => void;
}

export function MobileLinks({expanded, onLinkClick, onClose}: MobileLinksProps) {
    return (
        <div class={{'news': true, 'news--expanded': expanded}}>
            <div class="news__header">
                <span class="news__header__text">
                    <span class="news__header__text__dark-reader">
                        Dark Reader
                    </span>
                    {' '}
                    <span class="news__header__text__mobile">
                        Mobile
                    </span>
                    <i class="news__header__text__phone-icon">
                        <PhoneIcon />
                    </i>
                </span>
                <span class="news__close" role="button" onclick={onClose}>✕</span>
            </div>
            <div class="news__list">
                <div class="news__mobile">
                    <div class="news__mobile__left">
                        <div class="news__mobile__text">
                            {getLocalMessage('mobile_text')}
                        </div>
                        <div class="news__mobile__learn-more-container">
                            <a
                                href={MOBILE_URL}
                                class="news__mobile__learn-more"
                                onclick={onLinkClick}
                                target="_blank"
                                rel="noopener noreferrer"
                            >
                                {getLocalMessage('learn_more')}
                            </a>
                            <div class="news__mobile__logos">
                                <img class="news__os-icon" src="../assets/images/icon-android-dark.svg" />
                                <img class="news__os-icon" src="../assets/images/icon-apple-white.svg" />
                            </div>
                        </div>
                    </div>
                    <div class="news__mobile__right">
                        <img
                            class="news__qr-code"
                            src={`../assets/images/${isFirefox ? 'mobile-qr-code-firefox.png' : 'mobile-qr-code.png'}`}
                        />
                    </div>
                </div>
            </div>
        </div>
    );
}

interface NewsButtonProps {
    active: boolean;
    onClick: () => void;
}

export function MobileLinksButton({active, onClick}: NewsButtonProps) {
    return (
        <Button
            class={{'news-button': true, 'news-button--active': active}}
            onclick={(e) => {
                (e.currentTarget as HTMLElement).blur();
                onClick();
            }}
        >
            <span class="news-button__wrapper">
                <i class="news-button__phone-icon">
                    <PhoneIcon />
                </i>
                {getLocalMessage('mobile')}
            </span>
        </Button>
    );
}

```

### ui\popup\components\site-list-settings\index.tsx

```
import {m} from 'malevic';

import type {ExtWrapper} from '../../../../definitions';
import {getLocalMessage} from '../../../../utils/locales';
import {Toggle, TextList, Shortcut} from '../../../controls';

interface SiteListSettingsProps extends ExtWrapper {
    isFocused: boolean;
}

export default function SiteListSettings({data, actions, isFocused}: SiteListSettingsProps) {
    function isSiteUrlValid(value: string) {
        return /^([^\.\s]+?\.?)+$/.test(value);
    }

    return (
        <section class="site-list-settings">
            <Toggle
                class="site-list-settings__toggle"
                checked={!data.settings.enabledByDefault}
                labelOn={getLocalMessage('invert_listed_only')}
                labelOff={getLocalMessage('not_invert_listed')}
                onChange={(value) => actions.changeSettings({enabledByDefault: !value})}
            />
            <TextList
                class="site-list-settings__text-list"
                placeholder="google.com/maps"
                values={data.settings.enabledByDefault ? data.settings.disabledFor : data.settings.enabledFor}
                isFocused={isFocused}
                onChange={(values) => {
                    const siteList = values.filter(isSiteUrlValid);
                    const changes = data.settings.enabledByDefault
                        ? {disabledFor: siteList}
                        : {enabledFor: siteList};
                    actions.changeSettings(changes);
                }}
            />
            <Shortcut
                class="site-list-settings__shortcut"
                commandName="addSite"
                shortcuts={data.shortcuts}
                textTemplate={(hotkey) => (hotkey
                    ? `${getLocalMessage('add_site_to_list')}: ${hotkey}`
                    : getLocalMessage('setup_add_site_hotkey')
                )}
                onSetShortcut={(shortcut) => actions.setShortcut('addSite', shortcut)}
            />
        </section>
    );
}

```

### ui\popup\components\site-list-settings\style.less

```
@import "../../../theme";

.site-list-settings {
    align-items: stretch;
    display: flex;
    flex-direction: column;
    min-height: 0;
    width: 100%;

    &__toggle {
        border-bottom: none;
        flex: none;
    }

    &__shortcut {
        flex: none;
        white-space: nowrap;
    }

    &__text-list {
        flex: initial;
    }
}

```

### ui\popup\components\site-toggle\style.less

```
@import "../../../theme";

.site-toggle {
    color: @color-input-fore;
    white-space: normal;

    &--disabled {
        opacity: 0.5;
        pointer-events: none;
    }

    &__mark {
        svg {
            fill: currentColor;
            height: @size-text-normal;
            vertical-align: bottom;
            width: @size-text-normal;
        }
    }

    &--active {
        color: @color-input-fore-active;
    }
}

```

### ui\popup\components\site-toggle\index.tsx

```
import {m} from 'malevic';

import type {ExtWrapper} from '../../../../definitions';
import {getURLHostOrProtocol, isURLEnabled, isPDF} from '../../../../utils/url';
import {Button} from '../../../controls';

import CheckmarkIcon from './checkmark-icon';

declare const __THUNDERBIRD__: boolean;

export function getSiteToggleData(props: ExtWrapper) {
    const {data, actions} = props;
    const tab = data.activeTab;

    function onSiteToggleClick() {
        if (pdf) {
            actions.changeSettings({enableForPDF: !data.settings.enableForPDF});
        } else {
            actions.toggleActiveTab();
        }
    }

    const pdf = isPDF(tab.url);
    const toggleHasEffect = (
        data.settings.enableForProtectedPages ||
        (!tab.isProtected && !pdf) ||
        tab.isInjected
    );
    const isSiteEnabled: boolean = isURLEnabled(tab.url, data.settings, tab, data.isAllowedFileSchemeAccess) && Boolean(tab.isInjected);
    const host = getURLHostOrProtocol(tab.url);
    const displayHost = host.startsWith('www.') ? host.substring(4) : host;

    const urlText = pdf ? 'PDF' : displayHost
        .split('.')
        .reduce<string[]>((elements, part, i) => elements.concat(
            i > 0 ? <wbr /> : null,
            `${i > 0 ? '.' : ''}${part}`
        ), []);

    return {urlText, onSiteToggleClick, toggleHasEffect, isSiteEnabled};
}

export default function SiteToggleButton(props: ExtWrapper) {
    const {urlText, onSiteToggleClick, toggleHasEffect, isSiteEnabled} = getSiteToggleData(props);

    return (
        <Button
            class={{
                'site-toggle': true,
                'site-toggle--active': isSiteEnabled,
                'site-toggle--disabled': __THUNDERBIRD__ || !toggleHasEffect,
            }}
            onclick={onSiteToggleClick}
        >
            <span class="site-toggle__mark"><CheckmarkIcon isChecked={isSiteEnabled} /></span>
            {' '}
            <span class="site-toggle__url" >{urlText}</span>
        </Button>
    );
}

```

### ui\popup\components\site-toggle\checkmark-icon.tsx

```
import {m} from 'malevic';

export default function CheckmarkIcon({isChecked}: {isChecked: boolean}) {
    return (
        <svg viewBox="0 0 8 8">
            <path
                d={(isChecked ?
                    'M1,4 l2,2 l4,-4 v1 l-4,4 l-2,-2 Z' :
                    'M2,2 l4,4 v1 l-4,-4 Z M2,6 l4,-4 v1 l-4,4 Z'
                )} />
        </svg>
    );
}

```

### ui\popup\components\body.tsx

```
import {m} from 'malevic';
import {getContext} from 'malevic/dom';
import {withForms} from 'malevic/forms';
import {withState, useState} from 'malevic/state';

import type {ExtensionData, ExtensionActions, News as NewsObject} from '../../../definitions';
import {DONATE_URL, HOMEPAGE_URL, MOBILE_URL, getHelpURL} from '../../../utils/links';
import {getLocalMessage} from '../../../utils/locales';
import {isMobile} from '../../../utils/platform';
import {getDuration} from '../../../utils/time';
import {TabPanel} from '../../controls';
import {compose} from '../../utils';
import NewBody from '../body';

import FilterSettings from './filter-settings';
import {Header, MoreSiteSettings, MoreToggleSettings} from './header';
import Loader from './loader';
import MoreSettings from './more-settings';
import {NewsGroup, NewsButton} from './news';
import {MobileLinks, MobileLinksButton} from './news/mobile-links';
import SiteListSettings from './site-list-settings';


import {PlusBody} from '@plus/popup/plus-body';

declare const __THUNDERBIRD__: boolean;
declare const __PLUS__: boolean;

interface BodyProps {
    data: ExtensionData;
    actions: ExtensionActions;
}

interface BodyState {
    activeTab: string;
    newsOpen: boolean;
    mobileLinksOpen: boolean;
    didNewsSlideIn: boolean;
    didMobileLinksSlideIn: boolean;
    moreSiteSettingsOpen: boolean;
    moreToggleSettingsOpen: boolean;
    newToggleMenusHighlightHidden: boolean;
}

function Body(props: BodyProps & {fonts: string[]} & {installation: {date: number; version: string}}) {
    const context = getContext();
    const {state, setState} = useState<BodyState>({
        activeTab: 'Filter',
        newsOpen: false,
        mobileLinksOpen: false,
        didNewsSlideIn: false,
        didMobileLinksSlideIn: false,
        moreSiteSettingsOpen: false,
        moreToggleSettingsOpen: false,
        newToggleMenusHighlightHidden: false,
    });

    if (!props.data.isReady) {
        return (
            <body>
                <Loader complete={false} />
            </body>
        );
    }

    const v = props.installation?.version?.split('.').map((p) => parseInt(p));
    const n = v && v.length >= 3 ? (v[0] * 1e6 + v[1] * 1e3 + v[2]) : 0;

    if (
        __PLUS__ && (
            props.data.settings.previewNewestDesign || (isMobile && n && n >= 4009093)
        )
    ) {
        return <PlusBody {...props} fonts={props.fonts} />;
    }

    if (isMobile || props.data.settings.previewNewDesign) {
        return <NewBody {...props} fonts={props.fonts} />;
    }

    const unreadNews = props.data.news.filter(({read}) => !read);
    const latestNews = props.data.news.length > 0 ? props.data.news[0] : null;
    const isFirstNewsUnread = latestNews && !latestNews.read;
    let newsWereLongTimeAgo = true;
    if (unreadNews.length > 0) {
        const latest = new Date(unreadNews[0].date);
        const today = new Date();
        newsWereLongTimeAgo = latest.getTime() < today.getTime() - getDuration({days: 30});
    }
    const displayedNewsCount = newsWereLongTimeAgo ? 0 : unreadNews.length;

    context.onRender(() => {
        if (props.data.uiHighlights.includes('mobile-links') && !state.mobileLinksOpen && !state.didMobileLinksSlideIn) {
            setTimeout(toggleMobileLinks, 750);
        } else if (props.data.settings.fetchNews && isFirstNewsUnread && !state.newsOpen && !state.didNewsSlideIn && !newsWereLongTimeAgo) {
            setTimeout(toggleNews, 750);
        }
    });

    function toggleNews() {
        if (state.newsOpen && unreadNews.length > 0) {
            props.actions.markNewsAsRead(unreadNews.map(({id}) => id));
        }
        setState({newsOpen: !state.newsOpen, didNewsSlideIn: state.didNewsSlideIn || !state.newsOpen});
    }

    function toggleMobileLinks() {
        setState({mobileLinksOpen: !state.mobileLinksOpen, didMobileLinksSlideIn: state.didMobileLinksSlideIn || !state.mobileLinksOpen});
        if (state.mobileLinksOpen && props.data.uiHighlights.includes('mobile-links')) {
            disableMobileLinksSlideIn();
        }
    }

    function disableMobileLinksSlideIn() {
        if (props.data.uiHighlights.includes('mobile-links')) {
            props.actions.hideHighlights(['mobile-links']);
        }
    }

    function onNewsOpen(...news: NewsObject[]) {
        const unread = news.filter(({read}) => !read);
        if (unread.length > 0) {
            props.actions.markNewsAsRead(unread.map(({id}) => id));
        }
    }

    function toggleMoreSiteSettings() {
        setState({moreSiteSettingsOpen: !state.moreSiteSettingsOpen, moreToggleSettingsOpen: false, newToggleMenusHighlightHidden: true});
        if (props.data.uiHighlights.includes('new-toggle-menus')) {
            props.actions.hideHighlights(['new-toggle-menus']);
        }
    }

    function toggleMoreToggleSettings() {
        setState({moreToggleSettingsOpen: !state.moreToggleSettingsOpen, moreSiteSettingsOpen: false, newToggleMenusHighlightHidden: true});
        if (props.data.uiHighlights.includes('new-toggle-menus')) {
            props.actions.hideHighlights(['new-toggle-menus']);
        }
    }

    const birthdayMessage = getLocalMessage('we_celebrate_10_years');
    let birthdayMessageSpec = <span>{birthdayMessage}</span>;
    try {
        const index10 = birthdayMessage.indexOf('10');
        const indexDot = birthdayMessage.indexOf('.', index10);
        if (index10 >= 0 && indexDot > index10) {
            birthdayMessageSpec = (
                <span>
                    {birthdayMessage.substring(0, index10)}
                    <a href={`${HOMEPAGE_URL}/timeline/`} target="_blank" rel="noopener noreferrer">
                        {birthdayMessage.substring(index10, indexDot)}
                    </a>
                    {birthdayMessage.substring(indexDot)}
                </span>
            );
        }
    } catch (err) {
        console.error(err);
    }

    const filterTab = <FilterSettings data={props.data} actions={props.actions}>
        <div class="birthday-container">
            <i class="birthday-icon">🎉</i>
            <span class="birthday-message">
                {birthdayMessageSpec}
            </span>
            <a class="donate-link" href={DONATE_URL} target="_blank" rel="noopener noreferrer">
                <span class="donate-link__text">{getLocalMessage('pay_for_using')}</span>
            </a>
        </div>
    </FilterSettings>;

    const moreTab = <MoreSettings data={props.data} actions={props.actions} fonts={props.fonts} />;

    return (
        <body class={{'ext-disabled': !props.data.isEnabled}}>
            <Loader complete />

            <Header
                data={props.data}
                actions={props.actions}
                onMoreSiteSettingsClick={toggleMoreSiteSettings}
                onMoreToggleSettingsClick={toggleMoreToggleSettings}
            />

            <TabPanel
                activeTab={state.activeTab}
                onSwitchTab={(tab) => setState({activeTab: tab})}
                tabs={__THUNDERBIRD__ ? {
                    'Filter': filterTab,
                    'More': moreTab,
                } : {
                    'Filter': filterTab,
                    'Site list': (
                        <SiteListSettings data={props.data} actions={props.actions} isFocused={state.activeTab === 'Site list'} />
                    ),
                    'More': moreTab,
                }}
                tabLabels={{
                    'Filter': getLocalMessage('filter'),
                    'Site list': getLocalMessage('site_list'),
                    'More': getLocalMessage('more'),
                }}
            />

            <div class="mobile-link-container">
                <a class="mobile-link" href={MOBILE_URL} target="_blank" rel="noopener noreferrer">
                    <span class="mobile-link__icon"></span>
                    <span class="mobile-link__text">
                        {getLocalMessage('mobile_link')}
                    </span>
                </a>
            </div>
            <footer>
                <div class="footer-buttons">
                    <a class="footer-help-link" href={getHelpURL()} target="_blank" rel="noopener noreferrer">{getLocalMessage('help')}</a>
                    <NewsButton active={state.newsOpen} count={displayedNewsCount} onClick={toggleNews} />
                    <MobileLinksButton active={state.mobileLinksOpen} onClick={toggleMobileLinks} />
                </div>
            </footer>
            <NewsGroup
                news={props.data.news}
                expanded={state.newsOpen}
                onNewsOpen={onNewsOpen}
                onClose={toggleNews}
            />
            <MobileLinks
                expanded={state.mobileLinksOpen}
                onLinkClick={disableMobileLinksSlideIn}
                onClose={toggleMobileLinks}
            />
            <MoreSiteSettings
                data={props.data}
                actions={props.actions}
                isExpanded={state.moreSiteSettingsOpen}
                onClose={toggleMoreSiteSettings}
            />
            <MoreToggleSettings
                data={props.data}
                actions={props.actions}
                isExpanded={state.moreToggleSettingsOpen}
                onClose={toggleMoreToggleSettings}
            />
        </body>
    );
}

export default compose(Body, withState, withForms);

```

### ui\popup\main-page\theme-group.tsx

```
import {m} from 'malevic';

import type {Theme, ViewProps} from '../../../definitions';
import {Button} from '../../controls';
import {Brightness, Contrast, Scheme, Mode} from '../theme/controls';
import ThemePresetPicker from '../theme/preset-picker';
import {getCurrentThemePreset} from '../theme/utils';

function ThemeControls(props: {theme: Theme; onChange: (theme: Partial<Theme>) => void}) {
    const {theme, onChange} = props;
    return (
        <section class="m-section m-theme-controls">
            <Brightness
                value={theme.brightness}
                onChange={(v) => onChange({brightness: v})}
            />
            <Contrast
                value={theme.contrast}
                onChange={(v) => onChange({contrast: v})}
            />
            <Scheme
                isDark={theme.mode === 1}
                onChange={(isDark) => onChange({mode: isDark ? 1 : 0})}
            />
            <Mode
                mode={theme.engine}
                onChange={(mode) => onChange({engine: mode})}
            />
        </section>
    );
}

export default function ThemeGroup(props: ViewProps & {onThemeNavClick: () => void}) {
    const preset = getCurrentThemePreset(props);

    return (
        <div class="theme-group">
            <div class="theme-group__presets-wrapper">
                <ThemePresetPicker {...props} />
            </div>
            <div class="theme-group__controls-wrapper">
                <ThemeControls
                    theme={preset.theme}
                    onChange={preset.change}
                />
                <Button class="theme-group__more-button" onclick={props.onThemeNavClick}>
                    See all options
                </Button>
            </div>
            <label class="theme-group__description">
                Configure theme
            </label>
        </div>
    );
}

```

### ui\popup\main-page\site-toggle.tsx

```
import {m} from 'malevic';

import type {ViewProps} from '../../../definitions';
import {getLocalMessage} from '../../../utils/locales';
import {isChromium} from '../../../utils/platform';
import {isURLEnabled, isPDF, isLocalFile} from '../../../utils/url';
import {ControlGroup} from '../../controls';
import SiteToggle from '../components/site-toggle';

export default function SiteToggleGroup(props: ViewProps) {
    const tab = props.data.activeTab;
    const isPageEnabled = isURLEnabled(tab.url, props.data.settings, tab, props.data.isAllowedFileSchemeAccess);
    const isFile = isChromium && isLocalFile(tab.url);
    const {isDarkThemeDetected, isProtected, isInDarkList} = tab;
    let descriptionText = '';

    if (isFile && !props.data.isAllowedFileSchemeAccess) {
        descriptionText = getLocalMessage('local_files_forbidden');
    } else if (isPDF(tab.url)) {
        descriptionText = isPageEnabled ? 'Enabled for PDF files' : 'Disabled for PDF files';
    } else if (isDarkThemeDetected) {
        descriptionText = 'Dark theme detected on page';
    } else if (isPageEnabled) {
        descriptionText = 'Enabled for current website';
    } else if (isProtected) {
        descriptionText = getLocalMessage('page_protected');
    } else if (isInDarkList) {
        descriptionText = getLocalMessage('page_in_dark_list');
    } else {
        descriptionText = 'Disabled for current website';
    }

    const description = (
        <span
            class={{
                'site-toggle-group__description': true,
                'site-toggle-group__description--on': isPageEnabled,
                'site-toggle-group__description--off': !isPageEnabled,
            }}
        >{descriptionText}</span>
    );

    return (
        <ControlGroup class="site-toggle-group">
            <ControlGroup.Control class="site-toggle-group__control">
                <SiteToggle {...props} />
            </ControlGroup.Control>
            <ControlGroup.Description>
                {description}
            </ControlGroup.Description>
        </ControlGroup>
    );
}

```

### ui\popup\main-page\app-switch.tsx

```
import {m} from 'malevic';

import type {ViewProps} from '../../../definitions';
import {AutomationMode} from '../../../utils/automation';
import {getLocalMessage} from '../../../utils/locales';
import {ControlGroup, MultiSwitch} from '../../controls';
import {SunMoonIcon, SystemIcon, WatchIcon} from '../../icons';

export default function AppSwitch(props: ViewProps) {
    const isOn = props.data.settings.enabled === true && !props.data.settings.automation.enabled;
    const isOff = props.data.settings.enabled === false && !props.data.settings.automation.enabled;
    const isAutomation = props.data.settings.automation.enabled;
    const isTimeAutomation = props.data.settings.automation.mode === AutomationMode.TIME;
    const isLocationAutomation = props.data.settings.automation.mode === AutomationMode.LOCATION;
    const now = new Date();

    // TODO: Replace messages with some IDs.
    const values = [
        getLocalMessage('on'),
        'Auto',
        getLocalMessage('off'),
    ];
    const value = isOn ? values[0] : isOff ? values[2] : values[1];

    function onSwitchChange(v: string) {
        const index = values.indexOf(v);
        if (index === 0) {
            props.actions.changeSettings({
                enabled: true,
                automation: {... props.data.settings.automation, ...{enabled: false}},
            });
        } else if (index === 2) {
            props.actions.changeSettings({
                enabled: false,
                automation:  {... props.data.settings.automation, ...{enabled: false}},
            });
        } else if (index === 1) {
            props.actions.changeSettings({
                automation: {... props.data.settings.automation, ...{mode: AutomationMode.SYSTEM, enabled: true}},
            });
        }
    }

    const descriptionText = isOn ?
        'Extension is enabled' :
        isOff ?
            'Extension is disabled' :
            isTimeAutomation ?
                'Switches according to specified time' :
                isLocationAutomation ?
                    'Switched according to location' :
                    'Switches according to system dark mode';
    const description = (
        <span
            class={{
                'app-switch__description': true,
                'app-switch__description--on': props.data.isEnabled,
                'app-switch__description--off': !props.data.isEnabled,
            }}
        >
            {descriptionText}
        </span>
    );

    return (
        <ControlGroup class="app-switch">
            <ControlGroup.Control>
                <MultiSwitch
                    class="app-switch__control"
                    options={values}
                    value={value}
                    onChange={onSwitchChange}
                >
                    <span
                        class={{
                            'app-switch__time': true,
                            'app-switch__time--active': isAutomation,
                        }}
                    >
                        {(isTimeAutomation
                            ? <WatchIcon hours={now.getHours()} minutes={now.getMinutes()} />
                            : (isLocationAutomation
                                ? (<SunMoonIcon date={now} latitude={props.data.settings.location.latitude!} longitude={props.data.settings.location.longitude!} />)
                                : <SystemIcon />))}
                    </span>
                </MultiSwitch>
            </ControlGroup.Control>
            <ControlGroup.Description>
                {description}
            </ControlGroup.Description>
        </ControlGroup>
    );
}

```

### ui\popup\main-page\style.less

```
@import "../../theme.less";

.app-switch {
    &__control {
        width: calc(100% - @size-border * 2);
    }

    &__description {
        &--on {
            color: @color-ok-fore;
        }

        &--off {
            color: @color-heading;
        }
    }

    &__time {
        background-color: @color-heading;
        border-radius: 50%;
        color: @color-control-fore;
        cursor: pointer;
        display: none;
        height: @size-text-small-height;
        pointer-events: none;
        position: absolute;
        right: calc(33% + @size-border / 3);
        top: -@size-text-small-height / 4;
        transition: opacity @time-slow @time-slow;
        width: @size-text-small-height;

        &--active {
            display: inline-block;
        }
    }
}

.settings-button-icon {
    background-image: @icon-settings;
    background-size: cover;
    display: inline-block;
    height: 1rem;
    margin-right: 0.125rem;
    width: 1rem;
}

.site-toggle-group {
    .site-toggle {
        width: calc(100% - @size-border * 2);
    }

    &__description {
        &--on {
            color: @color-ok-fore;
        }

        &--off {
            color: @color-heading;
        }
    }
}

.theme-group {
    align-items: stretch;
    display: flex;
    flex-direction: column;

    &__presets-wrapper {
        background-color: @color-control-active;
        border: @size-border solid @color-border;
        height: @size-control-inner;
        position: relative;

        &::before {
            border: @size-border solid @color-border;
            border-bottom: none;
            content: "";
            display: inline-block;
            height: @size-control-inner + 2 * @size-border;
            left: -@size-border;
            position: absolute;
            top: -@size-border;
            width: 100%;
        }
    }

    &__controls-wrapper {
        border-bottom: @size-border solid @color-border;
        border-left: @size-border solid @color-border;
        border-right: @size-border solid @color-border;
        padding: @indent-small;
    }

    &__more-button {
        background-color: @color-control-active;
        background-image: @icon-right;
        background-position: center right 0.25rem;
        background-repeat: no-repeat;
        background-size: 1rem;
        border: none;
        height: @size-control-inner - 0.25rem;
        margin-bottom: 0.125rem;
        margin-top: @indent-small + 0.125rem;
        width: 100%;
    }

    &__description {
        display: inline-block;
        font-size: @size-text-small;
        line-height: @size-text-small-height;
        text-align: center;
        -moz-user-select: none;
        user-select: none;
        width: 100%;
    }
}

```

### ui\popup\main-page\help.tsx

```
import {m} from 'malevic';

import {HELP_URL} from '../../../utils/links';
import {getLocalMessage} from '../../../utils/locales';
import {ControlGroup} from '../../controls';

export default function HelpGroup() {
    return (
        <ControlGroup>
            <ControlGroup.Control>
                <a class="m-help-button" href={`${HELP_URL}/v5/`} target="_blank" rel="noopener noreferrer">
                    <span class="m-help-button__text">
                        {getLocalMessage('help')}
                    </span>
                </a>
            </ControlGroup.Control>
        </ControlGroup>
    );
}

```

### ui\popup\main-page\index.tsx

```
import {m} from 'malevic';

import type {ViewProps} from '../../../definitions';
import {NavButton} from '../../controls';

import AppSwitch from './app-switch';
import HelpGroup from './help';
import SiteToggleGroup from './site-toggle';
import ThemeGroup from './theme-group';

function SwitchGroup(props: ViewProps) {
    return (
        <Array>
            <AppSwitch {...props} />
            <SiteToggleGroup {...props} />
        </Array>
    );
}

function SettingsNavButton(props: {onClick: () => void}) {
    return (
        <NavButton onClick={props.onClick}>
            <span class="settings-button-icon" />
            Settings
        </NavButton>
    );
}

type MainPageProps = ViewProps & {
    onThemeNavClick: () => void;
    onSettingsNavClick: () => void;
};

export default function MainPage(props: MainPageProps) {
    return (
        <Array>
            <section class="m-section">
                <SwitchGroup {...props} />
            </section>
            <section class="m-section">
                <ThemeGroup {...props} />
            </section>
            <section class="m-section">
                <SettingsNavButton onClick={props.onSettingsNavClick} />
                <HelpGroup />
            </section>
        </Array>
    );
}

```

### ui\popup\news-section\index.tsx

```
import {m} from 'malevic';
import {getContext} from 'malevic/dom';

import type {News, ViewProps} from '../../../definitions';
import {HOMEPAGE_URL} from '../../../utils/links';
import {getDuration} from '../../../utils/time';

function isFresh(n: News) {
    try {
        const now = Date.now();
        const date = (new Date(n.date)).getTime();
        return (now - date) < getDuration({days: 30});
    } catch (err) {
        return false;
    }
}

function NewsLink(props: {news: News; isSmall?: boolean; onClick?: () => void}) {
    const {news} = props;
    return (
        <a
            href={news.url}
            class={{
                'news-section__news': true,
                'news-section__news--highlight': !news.read && isFresh(news),
                'news-section__news--has-icon': news.icon,
                'news-section__news--small': props.isSmall,
            }}
            onclick={props.onClick}
            target="_blank"
            rel="noopener noreferrer"
        >
            {news.icon ?
                <span
                    class="news-section__news__icon"
                    style={{'background-image': `url('${news.icon}')`}}
                ></span>
                : null}
            <span class="news-section__news__text">{news.headline}</span>
        </a>
    );
}

export default function NewsSection(props: ViewProps) {
    const context = getContext();
    const store = context.getStore({
        expanded: false,
        didNewsSlideIn: false,
    });
    const {expanded, didNewsSlideIn} = store;

    const news = props.data.news;
    const latest = news && news.length > 0 ? news[0] : null;

    function markLatestAsRead() {
        if (latest) {
            props.actions.markNewsAsRead([latest.id]);
        }
    }

    function toggleNews() {
        if (expanded) {
            markLatestAsRead();
        }
        store.expanded = !expanded;
        store.didNewsSlideIn = didNewsSlideIn || !store.expanded;
        context.refresh();
    }

    context.onRender(() => {
        if (latest && !latest.read && !store.expanded && !store.didNewsSlideIn) {
            setTimeout(toggleNews, 750);
        }
    });

    const birthdayExpired = (new Date(2024, 7, 2)).getTime();
    const birthdayNews = {
        id: 'birthday',
        date: '2024-07-07T00:00:00Z',
        url: `${HOMEPAGE_URL}/timeline/`,
        headline: 'On July 7th we celebrate 10 years!',
        icon: '/ui/assets/images/birthday-icon.svg',
    };
    const birthdayLink = <NewsLink isSmall news={birthdayNews} />;

    return (
        <div class={{'news-section': true, 'news-section--expanded': expanded}}>
            {Date.now() < birthdayExpired ? birthdayLink : latest ? <NewsLink isSmall news={latest} onClick={markLatestAsRead} /> : null}
            <div class="news-section__popover">
                <div class="news-section__popover__top">
                    <div class="news-section__title">
                        What's New
                    </div>
                    <span role="button" class="news-section__close" onclick={toggleNews}>✕</span>
                </div>
                {latest ? <NewsLink news={latest} onClick={markLatestAsRead} /> : null}
            </div>
        </div>
    );
}

```

### ui\popup\news-section\style.less

```
@import "../../theme.less";

@news-section-expanded-height: 6rem;
@news-section-collapsed-height: 1.875rem;

.news-section {
    background-color: @color-back;
    border-bottom-left-radius: @news-section-collapsed-height / 2;
    border-bottom-right-radius: @news-section-collapsed-height / 2;
    bottom: 0;
    box-sizing: border-box;
    display: flex;
    flex-direction: column;
    height: @news-section-collapsed-height;
    left: 0;
    overflow: hidden;
    padding: 0;
    position: absolute;
    text-align: center;
    transition: height @time-slow;
    user-select: none;
    white-space: nowrap;
    width: 100%;

    &__popover {
        align-items: stretch;
        background-color: @color-back;
        display: flex;
        flex-direction: column;
        left: 0;
        height: @news-section-expanded-height;
        opacity: 0;
        pointer-events: none;
        position: absolute;
        top: 0;
        transition: opacity @time-slow;
        width: 100%;

        &__top {
            border-top: @size-border solid @color-border;
            display: flex;
            flex-direction: row;
            justify-content: space-between;
            margin-bottom: @indent-small;
        }
    }

    &__title {
        color: @color-heading;
        font-size: @size-text-large;
        line-height: @size-control-inner;
        margin-left: @popup-content-padding;
    }

    &__news {
        align-items: center;
        box-sizing: border-box;
        color: @color-fore;
        display: flex;
        flex-direction: row;
        font-weight: normal;
        justify-content: flex-start;
        height: 2.5rem;
        padding: 0 @popup-content-padding;
        width: 100%;

        &__icon {
            background-position: center;
            background-repeat: no-repeat;
            background-size: contain;
            display: inline-block;
            flex: none;
            height: 3rem;
            margin-right: @indent-small;
            width: 3rem;
        }

        &__text {
            flex: auto;
            font-size: @size-text-large;
            display: inline-block;
            line-height: @size-text-large;
            text-align: left;
            white-space: normal;
        }

        &--highlight {
            color: @color-heading;
            font-weight: bold;
        }

        &:hover {
            color: @color-control-fore;
        }
    }

    &__close {
        color: @color-heading;
        cursor: pointer;
        display: inline-block;
        font-size: @size-control-inner * 3 / 4;
        height: @size-control-inner;
        line-height: @size-control-inner;
        text-align: center;
        user-select: none;
        width: @size-control-inner;

        &:hover {
            background-color: fade(@color-control-active, 25%);
        }
    }

    &--expanded {
        height: @news-section-expanded-height;
    }
}

.news-section--expanded .news-section__popover {
    opacity: 1;
    pointer-events: all;
}

.news-section__news--small {
    bottom: 0;
    font-weight: bold;
    height: @news-section-collapsed-height;
    padding: 0 @popup-content-padding;
}

.news-section__news--small .news-section__news__icon {
    height: 1.5rem;
    margin-right: @indent-small / 2;
    width: 1.5rem;
}

.news-section__news--small .news-section__news__text {
    font-size: @size-text-normal;
    line-height: @size-text-normal-height;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
}

```

### ui\popup\page-viewer\style.less

```
@import "../../theme.less";

.page-viewer {
    height: 100%;
    position: relative;
}

.page {
    align-items: stretch;
    background-color: @color-back;
    display: none;
    flex-direction: column;
    height: 100%;
    justify-content: stretch;
    left: 0;
    position: absolute;
    top: 0;
    width: 100%;

    &--active {
        display: flex;
    }

    &__back-button {
        background-image: @icon-left;
        background-position: center left 0.25rem;
        background-repeat: no-repeat;
        background-size: 1rem;
        flex: none;
        margin-top: @indent-small;
        width: calc(100% - 2 * @size-border);
    }
}

```

### ui\popup\page-viewer\index.tsx

```
import {m} from 'malevic';

import {Button} from '../../controls';

interface PageProps {
    id: string;
    active?: boolean;
    first?: boolean;
    onBackButtonClick?: () => void;
}

export function Page(props: PageProps, content: Malevic.Spec) {
    return (
        <div class={{'page': true, 'page--active': props.active}}>
            <div class="page__content">
                {content}
            </div>
            {props.first ? null : (
                <Button class="page__back-button" onclick={props.onBackButtonClick}>
                    Back
                </Button>
            )}
        </div>
    );
}

interface PageViewerProps {
    activePage: string;
    onBackButtonClick: () => void;
}

export function PageViewer(
    props: PageViewerProps,
    ...pages: Array<Malevic.ComponentSpec<PageProps>>
) {
    return (
        <div class="page-viewer">
            {pages.map((pageSpec, i) => {
                return {
                    ...pageSpec,
                    props: {
                        ...pageSpec.props,
                        active: props.activePage === pageSpec.props.id,
                        first: i === 0,
                        onBackButtonClick: props.onBackButtonClick,
                    },
                } as Malevic.ComponentSpec<PageProps>;
            })}
        </div>
    );
}

```

### ui\popup\theme\controls\style-system-controls.tsx

```
import {m} from 'malevic';

import {DropDown} from '../../../controls';

import ThemeControl from './theme-control';

export default function StyleSystemControls(props: {value: boolean; onChange: (value: boolean) => void}) {
    const options = [{id: true, content: 'Yes'}, {id: false, content: 'No'}];
    return (
        <ThemeControl label="Style system controls">
            <DropDown
                options={options}
                onChange={props.onChange}
                selected={props.value}
            />
        </ThemeControl>
    );
}

```

### ui\popup\theme\controls\reset-button.tsx

```
import {m} from 'malevic';

import {DEFAULT_SETTINGS} from '../../../../defaults';
import type {ViewProps} from '../../../../definitions';
import {ControlGroup, ResetButton} from '../../../controls';

export default function ResetButtonGroup(props: ViewProps) {
    function reset() {
        props.actions.setTheme(DEFAULT_SETTINGS.theme);
    }

    return (
        <ControlGroup>
            <ControlGroup.Control>
                <ResetButton onClick={reset}>
                    Reset to defaults
                </ResetButton>
            </ControlGroup.Control>
            <ControlGroup.Description>
                Restore current theme values to defaults
            </ControlGroup.Description>
        </ControlGroup>
    );
}

```

### ui\popup\theme\controls\sepia.tsx

```
import {m} from 'malevic';

import {getLocalMessage} from '../../../../utils/locales';
import {Slider} from '../../../controls';

import {formatPercent} from './format';
import ThemeControl from './theme-control';

export default function Sepia(props: {value: number; onChange: (v: number) => void}) {
    return (
        <ThemeControl label={getLocalMessage('sepia')}>
            <Slider
                value={props.value}
                min={0}
                max={100}
                step={1}
                formatValue={formatPercent}
                onChange={props.onChange}
            />
        </ThemeControl>
    );
}

```

### ui\popup\theme\controls\mode.tsx

```
import {m} from 'malevic';

import {ThemeEngine} from '../../../../generators/theme-engines';
import {getLocalMessage} from '../../../../utils/locales';
import {DropDown} from '../../../controls';
import {openExtensionPage} from '../../../utils';

import ThemeControl from './theme-control';

export default function Mode(props: {mode: ThemeEngine; onChange: (mode: ThemeEngine) => void}) {
    async function openCSSEditor() {
        await openExtensionPage('stylesheet-editor');
    }

    const modes = [
        {id: ThemeEngine.dynamicTheme, content: getLocalMessage('engine_dynamic')},
        {id: ThemeEngine.cssFilter, content: getLocalMessage('engine_filter')},
        {id: ThemeEngine.svgFilter, content: getLocalMessage('engine_filter_plus')},
        {id: ThemeEngine.staticTheme, content: getLocalMessage('engine_static')},
    ];
    return (
        <ThemeControl label="Mode">
            <div class="mode-control-container">
                <DropDown
                    selected={modes.find((m) => m.id === props.mode)!.id}
                    options={modes}
                    onChange={props.onChange}
                />
                <span
                    class={{
                        'static-edit-button': true,
                        'static-edit-button--hidden': props.mode !== ThemeEngine.staticTheme,
                    }}
                    onclick={openCSSEditor}
                />
            </div>
        </ThemeControl>
    );
}

```

### ui\popup\theme\controls\grayscale.tsx

```
import {m} from 'malevic';

import {getLocalMessage} from '../../../../utils/locales';
import {Slider} from '../../../controls';

import {formatPercent} from './format';
import ThemeControl from './theme-control';

export default function Grayscale(props: {value: number; onChange: (v: number) => void}) {
    return (
        <ThemeControl label={getLocalMessage('grayscale')}>
            <Slider
                value={props.value}
                min={0}
                max={100}
                step={1}
                formatValue={formatPercent}
                onChange={props.onChange}
            />
        </ThemeControl>
    );
}

```

### ui\popup\theme\controls\index.tsx

```
import BackgroundColor from './background-color';
import Brightness from './brightness';
import ColorSchemeDropDown from './color-scheme';
import Contrast from './contrast';
import {ExportTheme} from './export-theme';
import FontPicker from './font-picker';
import Grayscale from './grayscale';
import ImmediateModify from './immediate-modify';
import Mode from './mode';
import ResetButton from './reset-button';
import Scheme from './scheme';
import Scrollbar from './scrollbar';
import SelectionColorEditor from './selection';
import Sepia from './sepia';
import StyleSystemControls from './style-system-controls';
import TextColor from './text-color';
import TextStroke from './text-stroke';
import UseFont from './use-font';

export {
    BackgroundColor,
    Brightness,
    Contrast,
    ColorSchemeDropDown,
    ExportTheme,
    FontPicker,
    Grayscale,
    ImmediateModify,
    Mode,
    ResetButton,
    Scheme,
    Scrollbar,
    SelectionColorEditor,
    Sepia,
    StyleSystemControls,
    TextColor,
    TextStroke,
    UseFont,
};

```

### ui\popup\theme\controls\immediate-modify.tsx

```
import {m} from 'malevic';

import {DropDown} from '../../../controls';

import ThemeControl from './theme-control';

export default function ImmediateModify(props: {value: boolean; onChange: (value: boolean) => void}) {
    const options = [{id: true, content: 'Yes'}, {id: false, content: 'No'}];
    return (
        <ThemeControl label="Immediate modify">
            <DropDown
                options={options}
                onChange={props.onChange}
                selected={props.value}
            />
        </ThemeControl>
    );
}

```

### ui\popup\theme\controls\color-scheme.tsx

```
import {m} from 'malevic';

import {DropDown} from '../../../controls';

import ThemeControl from './theme-control';

interface ColorSchemeDropDownProps {
    selected: string;
    values: Array<{id: string; content: string}>;
    onChange: (value: string) => void;
}

export default function ColorSchemeDropDown(props: ColorSchemeDropDownProps) {
    function onColorSchemeChange(value: string) {
        props.onChange(value);
    }

    return (
        <ThemeControl label="Color Scheme">
            <DropDown
                selected={props.selected}
                options={props.values}
                onChange={onColorSchemeChange}
            />
        </ThemeControl>
    );
}

```

### ui\popup\theme\controls\font-picker.tsx

```
import {m} from 'malevic';

import type {Theme} from '../../../../definitions';
import {Select} from '../../../controls';

import ThemeControl from './theme-control';

interface FontPickerProps {
    theme: Theme;
    fonts: string[];
    onChange: (font: string) => void;
}

export default function FontPicker(props: FontPickerProps) {
    return (
        <ThemeControl label="Font name">
            <Select
                class={{
                    'font-picker': true,
                    'font-picker--disabled': !props.theme.useFont,
                }}
                value={props.theme.fontFamily}
                onChange={props.onChange}
                options={props.fonts.reduce((map, font) => {
                    map[font] = (
                        <div style={{'font-family': font}}>
                            {font}
                        </div>
                    );
                    return map;
                }, {} as {[font: string]: Malevic.Spec})}
            />
        </ThemeControl>
    );
}

```

### ui\popup\theme\controls\mode.less

```
@import "../../../theme";

.static-edit-button {
    background-color: @color-heading;
    border-radius: @size-text-small-height / 2;
    color: @color-control-fore;
    cursor: pointer;
    font-size: @size-text-small;
    line-height: @size-text-small-height;
    left: 0.25rem;
    min-width: @size-text-small-height;
    position: absolute;
    text-align: center;
    top: 0.25rem;

    &--hidden {
        display: none;
    }

    &::before {
        content: "\270E";
        line-height: @size-text-small-height;
    }

    &:hover {
        box-shadow: 0 0 @indent-large @color-control-fore;
    }
}

.mode-control-container {
    height: @size-control-inner;
    position: relative;
    width: 100%
}

```

### ui\popup\theme\controls\theme-control.less

```
.theme-control {
    align-items: center;
    display: flex;
    flex-direction: row;
    justify-content: center;
    min-height: @size-control-inner;
    width: 100%;

    &__label {
        font-size: @size-text-normal;
        line-height: @size-text-normal;
        text-align: left;
        -moz-user-select: none;
        user-select: none;
        width: 50%;
    }
}

.export-theme-button {
    background-color: @color-control-active;
    border: none;
    height: 1.25rem;
    margin-bottom: 0.25rem;
    margin-top: 0.625rem;
    width: 100%;
}

```

### ui\popup\theme\controls\export-theme.tsx

```
import {m} from 'malevic';

import type {ViewProps, MessageCStoUI, MessageUItoCS} from '../../../../definitions';
import {MessageTypeCStoUI, MessageTypeUItoCS} from '../../../../utils/message';
import {getURLHostOrProtocol} from '../../../../utils/url';
import {Button} from '../../../controls';
import {saveFile} from '../../../utils';

declare const __CHROMIUM_MV2__: boolean;
declare const __CHROMIUM_MV3__: boolean;
declare const __FIREFOX_MV2__: boolean;
declare const __THUNDERBIRD__: boolean;

export function ExportTheme({data}: ViewProps): Malevic.Child {
    const documentId = data.activeTab.documentId!;
    const tabId = data.activeTab.id;
    const listener = ({type, data}: MessageCStoUI, sender: chrome.runtime.MessageSender) => {
        if (type === MessageTypeCStoUI.EXPORT_CSS_RESPONSE && sender.tab && sender.tab.id === tabId && (
            __CHROMIUM_MV3__ ? sender.documentId === documentId :
                (__CHROMIUM_MV2__ ? (!sender.documentId || sender.documentId === documentId) :
                    ((__FIREFOX_MV2__ || __THUNDERBIRD__) ? (!(sender as any).contextId || (sender as any).contextId === documentId) : true))
        )) {
            const url = getURLHostOrProtocol(sender.tab!.url!).replace(/[^a-z0-1\-]/g, '-');
            saveFile(`DarkReader-${url}.css`, data);
            chrome.runtime.onMessage.removeListener(listener);
        }
    };

    async function exportCSS() {
        if (!data.activeTab || !data.activeTab.id) {
            return;
        }
        chrome.runtime.onMessage.addListener(listener);
        // Here we use both frameId and documentId just in case page had already started navigation away
        chrome.tabs.sendMessage<MessageUItoCS>(data.activeTab.id, {type: MessageTypeUItoCS.EXPORT_CSS}, (__CHROMIUM_MV3__ || __CHROMIUM_MV2__ && documentId) ? {frameId: 0, documentId} : {frameId: 0});
    }

    return (
        <Button
            onclick={exportCSS}
            class="export-theme-button"
        >
            Export Dynamic Theme
        </Button>
    );
}

```

### ui\popup\theme\controls\brightness.tsx

```
import {m} from 'malevic';

import {getLocalMessage} from '../../../../utils/locales';
import {Slider} from '../../../controls';

import {formatPercent} from './format';
import ThemeControl from './theme-control';

export default function Brightness(props: {value: number; onChange: (v: number) => void}) {
    return (
        <ThemeControl label={getLocalMessage('brightness')}>
            <Slider
                value={props.value}
                min={50}
                max={150}
                step={1}
                formatValue={formatPercent}
                onChange={props.onChange}
            />
        </ThemeControl>
    );
}

```

### ui\popup\theme\controls\contrast.tsx

```
import {m} from 'malevic';

import {getLocalMessage} from '../../../../utils/locales';
import {Slider} from '../../../controls';

import {formatPercent} from './format';
import ThemeControl from './theme-control';

export default function Contrast(props: {value: number; onChange: (v: number) => void}) {
    return (
        <ThemeControl label={getLocalMessage('contrast')}>
            <Slider
                value={props.value}
                min={50}
                max={150}
                step={1}
                formatValue={formatPercent}
                onChange={props.onChange}
            />
        </ThemeControl>
    );
}

```

### ui\popup\theme\controls\format.ts

```
export function formatPercent(v: number): string {
    return `${v}%`;
}

```

### ui\popup\theme\controls\background-color.tsx

```
import {m} from 'malevic';

import {ColorPicker} from '../../../controls';

import ThemeControl from './theme-control';

type BgColorValue = 'auto' | string;

interface BgColorEditorProps {
    value: BgColorValue;
    onChange: (value: BgColorValue) => void;
    canReset: boolean;
    onReset: () => void;
}

export default function BackgroundColorEditor(props: BgColorEditorProps) {
    return (
        <ThemeControl label="Background">
            <ColorPicker
                color={props.value}
                onChange={props.onChange}
                canReset={props.canReset}
                onReset={props.onReset}
            />
        </ThemeControl>
    );
}

```

### ui\popup\theme\controls\use-font.tsx

```
import {m} from 'malevic';

import {DropDown} from '../../../controls';

import ThemeControl from './theme-control';

export default function UseFont(props: {value: boolean; onChange: (value: boolean) => void}) {
    const options = [{id: true, content: 'Yes'}, {id: false, content: 'No'}];
    return (
        <ThemeControl label="Change font">
            <DropDown
                options={options}
                onChange={props.onChange}
                selected={props.value}
            />
        </ThemeControl>
    );
}

```

### ui\popup\theme\controls\theme-control.tsx

```
import {m} from 'malevic';

export default function ThemeControl(props: {label: Malevic.Child}, controls: Malevic.Child[]) {
    return (
        <span class="theme-control">
            <label class="theme-control__label">
                {props.label}
            </label>
            {controls}
        </span>
    );
}

```

### ui\popup\theme\controls\text-stroke.tsx

```
import {m} from 'malevic';

import {Slider} from '../../../controls';

import ThemeControl from './theme-control';

export default function TextStroke(props: {value: number; onChange: (v: number) => void}) {
    return (
        <ThemeControl label="Text stroke">
            <Slider
                value={props.value}
                min={0}
                max={1}
                step={0.1}
                formatValue={String}
                onChange={props.onChange}
            />
        </ThemeControl>
    );
}

```

### ui\popup\theme\controls\text-color.tsx

```
import {m} from 'malevic';

import {ColorPicker} from '../../../controls';

import ThemeControl from './theme-control';

type TextColorValue = 'auto' | string;

interface TextColorEditorProps {
    value: TextColorValue;
    onChange: (value: TextColorValue) => void;
    canReset: boolean;
    onReset: () => void;
}

export default function TextColorEditor(props: TextColorEditorProps) {
    return (
        <ThemeControl label="Text">
            <ColorPicker
                color={props.value}
                onChange={props.onChange}
                canReset={props.canReset}
                onReset={props.onReset}
            />
        </ThemeControl>
    );
}

```

### ui\popup\theme\controls\scrollbar.tsx

```
import {m} from 'malevic';

import {ColorDropDown} from '../../../controls';

import ThemeControl from './theme-control';

type ScrollbarColorValue = '' | 'auto' | string;

interface ScrollbarEditorProps {
    value: ScrollbarColorValue;
    onChange: (value: ScrollbarColorValue) => void;
    onReset: () => void;
}

export default function ScrollbarEditor(props: ScrollbarEditorProps) {
    return (
        <ThemeControl label="Scrollbar">
            <ColorDropDown
                value={props.value}
                colorSuggestion={'#959799'}
                onChange={props.onChange}
                onReset={props.onReset}
                hasAutoOption
                hasDefaultOption
            />
        </ThemeControl>
    );
}

```

### ui\popup\theme\controls\scheme.tsx

```
import {m} from 'malevic';

import {getLocalMessage} from '../../../../utils/locales';
import {DropDown} from '../../../controls';

import ThemeControl from './theme-control';

export default function Scheme(props: {isDark: boolean; onChange: (dark: boolean) => void}) {
    return (
        <ThemeControl label="Scheme">
            <DropDown
                selected={props.isDark}
                options={[
                    {id: true, content: getLocalMessage('dark')},
                    {id: false, content: getLocalMessage('light')},
                ]}
                onChange={props.onChange}
            />
        </ThemeControl>
    );
}

```

### ui\popup\theme\controls\selection.tsx

```
import {m} from 'malevic';

import {ColorDropDown} from '../../../controls';

import ThemeControl from './theme-control';

type SelectionColorValue = '' | 'auto' | string;

interface SelectionEditorProps {
    value: SelectionColorValue;
    onChange: (value: SelectionColorValue) => void;
    onReset: () => void;
}

export default function SelectionColorEditor(props: SelectionEditorProps) {
    return (
        <ThemeControl label="Selection">
            <ColorDropDown
                value={props.value}
                colorSuggestion={'#005ccc'}
                onChange={props.onChange}
                onReset={props.onReset}
                hasAutoOption
                hasDefaultOption
            />
        </ThemeControl>
    );
}

```

### ui\popup\theme\page\collapsible-panel.less

```
@import "../../../theme";

@collapsible-panel-button-size: 1.25rem;

.collapsible-panel {
    &__group {
        &__expand-button {
            align-items: center;
            background-color: @color-control-active;
            background-image: @icon-plus;
            background-position: center left 0.375rem;
            background-repeat: no-repeat;
            background-size: 0.5rem;
            color: @color-control-fore;
            cursor: pointer;
            display: none;
            height: @collapsible-panel-button-size;
            justify-content: center;
            line-height: @collapsible-panel-button-size;
            text-align: center;
            width: 100%;
        }

        &--collapsed {
            .collapsible-panel__group__expand-button {
                display: inline-flex;
            }
    
            .collapsible-panel__group__content {
                display: none;
            }
        }

        &--collapse-top {
            .collapsible-panel__group__expand-button {
                margin-bottom: @indent-small + 0.125rem;
                margin-top: 0.125rem;
            }
        }

        &--collapse-bottom {
            .collapsible-panel__group__expand-button {
                margin-bottom: 0.125rem;
                margin-top: @indent-small + 0.125rem;
            }
        }
    }
}

```

### ui\popup\theme\page\index.tsx

```
import {m} from 'malevic';

import {DEFAULT_SETTINGS, DEFAULT_THEME, DEFAULT_COLORS} from '../../../../defaults';
import type {Theme, ViewProps} from '../../../../definitions';
import {ThemeEngine} from '../../../../generators/theme-engines';
import type {ParsedColorSchemeConfig} from '../../../../utils/colorscheme-parser';
import {isURLEnabled, isURLInList} from '../../../../utils/url';
import {
    BackgroundColor,
    Brightness,
    ColorSchemeDropDown,
    Contrast,
    ExportTheme,
    FontPicker,
    Grayscale,
    ImmediateModify,
    Mode,
    ResetButton,
    Scheme,
    Scrollbar,
    SelectionColorEditor,
    Sepia,
    StyleSystemControls,
    TextColor,
    TextStroke,
    UseFont,
} from '../controls';
import ThemePresetPicker from '../preset-picker';
import {getCurrentThemePreset} from '../utils';

import Collapsible from './collapsible-panel';

interface ThemeGroupProps {
    theme: Theme;
    change: (theme: Partial<Theme>) => void;
}

function MainGroup({theme, change}: ThemeGroupProps) {
    return (
        <Array>
            <Brightness
                value={theme.brightness}
                onChange={(v) => change({brightness: v})}
            />
            <Contrast
                value={theme.contrast}
                onChange={(v) => change({contrast: v})}
            />
            <Sepia
                value={theme.sepia}
                onChange={(v) => change({sepia: v})}
            />
            <Grayscale
                value={theme.grayscale}
                onChange={(v) => change({grayscale: v})}
            />
            <Scheme
                isDark={theme.mode === 1}
                onChange={(isDark) => change({mode: isDark ? 1 : 0})}
            />
            <Mode
                mode={theme.engine}
                onChange={(mode) => change({engine: mode})}
            />
        </Array>
    );
}

interface ColorsGroupProps extends ThemeGroupProps {
    colorSchemes: ParsedColorSchemeConfig;
}

function ColorsGroup({theme, change, colorSchemes}: ColorsGroupProps) {
    const isDarkScheme = theme.mode === 1;
    const csProp: keyof Theme = isDarkScheme ? 'darkColorScheme' : 'lightColorScheme';
    const bgProp: keyof Theme = isDarkScheme ? 'darkSchemeBackgroundColor' : 'lightSchemeBackgroundColor';
    const fgProp: keyof Theme = isDarkScheme ? 'darkSchemeTextColor' : 'lightSchemeTextColor';
    const defaultSchemeColors = isDarkScheme ? DEFAULT_COLORS.darkScheme : DEFAULT_COLORS.lightScheme;
    const defaultMatrixValues: Partial<Theme> = {brightness: DEFAULT_THEME.brightness, contrast: DEFAULT_THEME.contrast, sepia: DEFAULT_THEME.sepia, grayscale: DEFAULT_THEME.grayscale};
    const currentColorScheme = isDarkScheme ? theme.darkColorScheme : theme.lightColorScheme;
    const currentSchemeColors = isDarkScheme ? colorSchemes.dark : colorSchemes.light;
    const sortedColorSchemeValues: Array<{id: string; content: string}> = Object.keys(currentSchemeColors)
        .sort((a, b) => a.localeCompare(b))
        .map((value) => {
            return {id: value, content: value};
        });

    function onColorSchemeChange(newColor: string) {
        change({[csProp]: newColor});
        change({[bgProp]: currentSchemeColors[newColor].backgroundColor});
        change({[fgProp]: currentSchemeColors[newColor].textColor});
    }

    return (
        <Array>
            <BackgroundColor
                value={theme[bgProp] === 'auto' ? defaultSchemeColors.background : theme[bgProp]}
                onChange={(v) => change({[bgProp]: v, ...defaultMatrixValues, [csProp]: 'Default'})}
                canReset={theme[bgProp] !== defaultSchemeColors.background}
                onReset={() => change({[bgProp]: DEFAULT_SETTINGS.theme[bgProp], [csProp]: 'Default'})}
            />
            <TextColor
                value={theme[fgProp] === 'auto' ? defaultSchemeColors.text : theme[fgProp]}
                onChange={(v) => change({[fgProp]: v, ...defaultMatrixValues, [csProp]: 'Default'})}
                canReset={theme[fgProp] !== defaultSchemeColors.text}
                onReset={() => change({[fgProp]: DEFAULT_SETTINGS.theme[fgProp], [csProp]: 'Default'})}
            />
            <Scrollbar
                value={theme.scrollbarColor}
                onChange={(v) => change({scrollbarColor: v})}
                onReset={() => change({scrollbarColor: DEFAULT_SETTINGS.theme.scrollbarColor})}
            />
            <SelectionColorEditor
                value={theme.selectionColor}
                onChange={(v) => change({selectionColor: v})}
                onReset={() => change({selectionColor: DEFAULT_SETTINGS.theme.selectionColor})}
            />
            <ColorSchemeDropDown
                selected={currentColorScheme}
                values={sortedColorSchemeValues}
                onChange={(v) => onColorSchemeChange(v)}
            />
        </Array>
    );
}

interface FontGroupsProps extends ThemeGroupProps {
    fonts: string[];
    viewProps: ViewProps;
}

function FontGroup({theme, fonts, viewProps, change}: FontGroupsProps) {
    const {settings, activeTab, isAllowedFileSchemeAccess} = viewProps.data;
    const {isDarkThemeDetected, isInDarkList, isInjected, isProtected} = activeTab;

    const custom = settings.customThemes.find((custom) => isURLInList(activeTab.url, custom.url));
    const engine = custom ? custom.theme.engine : settings.theme.engine;
    const canExportTheme = engine === ThemeEngine.dynamicTheme && activeTab.id
        && !isDarkThemeDetected && !isInDarkList && !isProtected && isInjected !== false
        && isURLEnabled(activeTab.url, settings, activeTab, isAllowedFileSchemeAccess);

    return (
        <Array>
            <UseFont
                value={theme.useFont}
                onChange={(useFont) => change({useFont})}
            />
            <FontPicker
                theme={theme}
                fonts={fonts}
                onChange={(fontFamily) => change({fontFamily})}
            />
            <TextStroke
                value={theme.textStroke}
                onChange={(textStroke) => change({textStroke})}
            />
            <StyleSystemControls
                value={theme.styleSystemControls}
                onChange={(styleSystemControls) => change({styleSystemControls})}
            />
            <ImmediateModify
                value={theme.immediateModify}
                onChange={(immediateModify) => change({immediateModify})}
            />
            {canExportTheme ? <ExportTheme {...viewProps} /> : null}
        </Array>
    );
}

export default function ThemePage(props: ViewProps) {
    const {theme, change} = getCurrentThemePreset(props);

    return (
        <section class="m-section theme-page">
            <ThemePresetPicker {...props} />
            <Collapsible>
                <Collapsible.Group id="main" label="Brightness, contrast, mode">
                    <MainGroup theme={theme} change={change} />
                </Collapsible.Group>
                <Collapsible.Group id="colors" label="Colors">
                    <ColorsGroup theme={theme} change={change} colorSchemes={props.data.colorScheme} />
                </Collapsible.Group>
                <Collapsible.Group id="font" label="Font & more">
                    <FontGroup theme={theme} fonts={props.fonts!} viewProps={props} change={change} />
                </Collapsible.Group>
            </Collapsible>
            <ResetButton {...props} />
        </section>
    );
}

```

### ui\popup\theme\page\collapsible-panel.tsx

```
import {m} from 'malevic';
import {getContext} from 'malevic/dom';

interface CollapsiblePanelStore {
    activeGroup: string;
}

function CollapsiblePanel({}, ...groups: Array<Malevic.ComponentSpec<CollapsibleGroupProps>>) {
    const context = getContext();
    const store: CollapsiblePanelStore = context.store;
    if (store.activeGroup == null) {
        store.activeGroup = groups[0].props.id;
    }
    return (
        <div class="collapsible-panel">
            {...groups.map((spec, i) => {
                const activeIndex = groups.findIndex((g) => store.activeGroup === g.props.id);
                const collapsed = i !== activeIndex;
                const collapseTop = i < activeIndex;
                const collapseBottom = i > activeIndex;
                const onExpand = () => {
                    store.activeGroup = spec.props.id;
                    context.refresh();
                };

                return {
                    ...spec,
                    props: {
                        ...spec.props,
                        collapsed,
                        collapseBottom,
                        collapseTop,
                        onExpand,
                    },
                };
            })}
        </div>
    );
}

interface CollapsibleGroupProps {
    id: string;
    label: string;
    collapsed?: boolean;
    collapseBottom?: boolean;
    collapseTop?: boolean;
    onExpand?: () => void;
}

function Group(props: CollapsibleGroupProps, content: Malevic.Child) {
    return (
        <div
            class={{
                'collapsible-panel__group': true,
                'collapsible-panel__group--collapsed': props.collapsed,
                'collapsible-panel__group--collapse-top': props.collapseTop,
                'collapsible-panel__group--collapse-bottom': props.collapseBottom,
            }}
        >
            <div class="collapsible-panel__group__content">
                {content}
            </div>
            <span role="button" class="collapsible-panel__group__expand-button" onclick={props.onExpand}>
                {props.label}
            </span>
        </div>
    );
}

export default Object.assign(CollapsiblePanel, {Group});

```

### ui\popup\theme\page\style.less

```
@import "../../../theme";
@import "./collapsible-panel";

.theme-page {
    .theme-preset-picker.dropdown {
        height: @size-control-inner + 2 * @size-border;
    }

    .theme-preset-picker {
        .dropdown {
            &__selected {
                height: @size-control-inner + 2 * @size-border;
            }
        
            &__list {
                border: @size-border solid @color-border;
                border-top: none;
                box-shadow: 0 0 0.25rem 0.0625rem black;
                box-sizing: border-box;

                &__item {
                    min-height: @size-control-inner + 2 * @size-border;
                }
            }
        }
    }

    .theme-control:not(:first-child) {
        margin-top: @indent-small;
    }

    .font-picker {
        box-sizing: border-box;
        height: 1.5rem;
        padding-top: 0.125rem;
        position: relative;
        width: 100%;

        &--disabled {
            opacity: 0.5;
            pointer-events: none;
        }

        .select {
            &__textbox,
            &__expand,
            &__list {
                border: none;
            }

            &__line {
                position: relative;
            }

            &__textbox {
                background-color: @color-control-active;
                color: @color-control-fore;
                height: 1.25rem;
                line-height: 1.25rem;
                text-align: center;
                width: 100%;

                &:hover {
                    background-color: @color-input-hover;
                }

                &:focus {
                    background-color: @color-input-hover;
                    border: @size-border solid @color-border;
                    margin-top: -0.125rem;
                }
            }

            &__expand {
                background-color: @color-control-active;
                height: 1.25rem;
                min-width: 1.5rem;
                position: absolute;
                right: 0;
                top: 0;
                width: 1.5rem;

                &__icon {
                    background-image: @icon-down;
                    background-position: center;
                    background-repeat: no-repeat;
                    background-size: 1rem;

                    &::before,
                    &::after {
                        display: none;
                    }
                }
            }

            &__list {
                border-left: @size-border solid @color-border;
                border-right: @size-border solid @color-border;
                top: 100%;
                width: 100%;

                &--expanded {
                    border-bottom: @size-border solid @color-border;
                }

                &::-webkit-scrollbar {
                    background-color: transparent;
                }
            }
        }

        &.select--expanded {
            background-color: @color-border;
            height: 1.5rem;
            padding-top: 0;

            .select__textbox {
                border: @size-border solid @color-border;

                &:focus {
                    margin-top: 0;
                }
            }

            .select__expand {
                margin-top: @size-border;
            }

            &::before {
                background-color: @color-back;
                content: "";
                display: inline-block;
                height: 0.75rem;
                left: @size-border;
                position: absolute;
                top: 0.75rem;
                width: calc(100% - 2 * @size-border);
            }
        }
    }
}

```

### ui\popup\theme\preset-picker\style.less

```
@import "../../../theme";

@theme-preset-height: 1.5rem;
@theme-preset-picker-button-size: 1.5rem;

.theme-preset-picker {
    .dropdown {
        &__selected {
            height: @size-control-inner;
            margin-top: 0;
        }

        &__list {
            border: none;
            box-shadow: 0 0 0 @size-border @color-border, 0 0 0.25rem 0.0625rem + @size-border black;
        }
    }

    &__preset {
        align-items: center;
        display: inline-flex;
        justify-content: center;
        min-height: @theme-preset-height;
        position: relative;
        width: 100%;

        &__remove-button {
            cursor: pointer;
            display: inline-block;
            height: @theme-preset-picker-button-size;
            position: absolute;
            right: 0;
            top: 0;
            width: @theme-preset-picker-button-size;

            &::after {
                content: "\2715";
                display: inline-block;
                line-height: @theme-preset-picker-button-size;
                text-align: center;
            }

            &:hover {
                background-color: @color-control-active;
                color: @color-control-fore;
            }
        }
    }
}

```

### ui\popup\theme\preset-picker\index.tsx

```
import {m} from 'malevic';
import {getContext} from 'malevic/dom';

import type {ThemePreset, ViewProps} from '../../../../definitions';
import {generateUID} from '../../../../utils/uid';
import {isURLInList, isURLMatched, getURLHostOrProtocol} from '../../../../utils/url';
import {DropDown, MessageBox} from '../../../controls';
import type {DropDownOption} from '../../../controls/dropdown';

interface PresetItemStore {
    isConfirmationVisible: boolean;
}

function PresetItem(props: ViewProps & {preset: ThemePreset}) {
    const context = getContext();
    const store: PresetItemStore = context.store;

    function onRemoveClick(e: MouseEvent) {
        e.stopPropagation();
        store.isConfirmationVisible = true;
        context.refresh();
    }

    function onConfirmRemoveClick() {
        const filtered = props.data.settings.presets.filter((p) => p.id !== props.preset.id);
        props.actions.changeSettings({presets: filtered});
    }

    function onCancelRemoveClick() {
        store.isConfirmationVisible = false;
        context.refresh();
    }

    const confirmation = store.isConfirmationVisible ? (
        <MessageBox
            caption={`Are you sure you want to remove ${props.preset.name}?`}
            onOK={onConfirmRemoveClick}
            onCancel={onCancelRemoveClick}
        />
    ) : null;

    return (
        <span class="theme-preset-picker__preset">
            <span class="theme-preset-picker__preset__name">{props.preset.name}</span>
            <span class="theme-preset-picker__preset__remove-button" onclick={onRemoveClick}></span>
            {confirmation}
        </span>
    );
}

const MAX_ALLOWED_PRESETS = 3;

export default function PresetPicker(props: ViewProps) {
    const tab = props.data.activeTab;
    const host = getURLHostOrProtocol(tab.url);
    const preset = props.data.settings.presets.find(
        ({urls}) => isURLInList(tab.url, urls)
    );
    const custom = props.data.settings.customThemes.find(
        ({url}) => isURLInList(tab.url, url)
    );

    const selectedPresetId = custom ? 'custom' : preset ? preset.id : 'default';

    const defaultOption = {id: 'default', content: 'Theme for all websites'};
    const addNewPresetOption = props.data.settings.presets.length < MAX_ALLOWED_PRESETS ?
        {id: 'add-preset', content: '\uff0b Create new theme'} :
        null;
    const userPresetsOptions = props.data.settings.presets.map((preset) => {
        if (preset.id === selectedPresetId) {
            return {id: preset.id, content: preset.name};
        }
        return {
            id: preset.id,
            content: <PresetItem {...props} preset={preset} />,
        };
    });
    const customSitePresetOption = {
        id: 'custom',
        content: `${selectedPresetId === 'custom' ? '\u2605' : '\u2606'} Theme for ${host}`,
    };

    const dropdownOptions = [
        defaultOption,
        ...userPresetsOptions,
        addNewPresetOption,
        customSitePresetOption,
    ].filter(Boolean) as Array<DropDownOption<string>>;

    function onPresetChange(id: string) {
        const filteredCustomThemes = props.data.settings.customThemes.filter(({url}) => !isURLInList(tab.url, url));
        const filteredPresets = props.data.settings.presets.map((preset) => {
            return {
                ...preset,
                urls: preset.urls.filter((template) => !isURLMatched(tab.url, template)),
            };
        });
        if (id === 'default') {
            props.actions.changeSettings({
                customThemes: filteredCustomThemes,
                presets: filteredPresets,
            });
        } else if (id === 'custom') {
            const extended = filteredCustomThemes.concat({
                url: [host],
                theme: {...props.data.settings.theme},
            });
            props.actions.changeSettings({
                customThemes: extended,
                presets: filteredPresets,
            });
        } else if (id === 'add-preset') {
            let newPresetName: string;
            for (let i = 0; i <= props.data.settings.presets.length; i++) {
                newPresetName = `Theme ${i + 1}`;
                if (props.data.settings.presets.every((p) => p.name !== newPresetName)) {
                    break;
                }
            }

            const extended = filteredPresets.concat({
                id: `preset-${generateUID()}`,
                name: newPresetName!,
                urls: [host],
                theme: {...props.data.settings.theme},
            });
            props.actions.changeSettings({
                customThemes: filteredCustomThemes,
                presets: extended,
            });
        } else {
            const chosenPresetId = id;
            const extended = filteredPresets.map((preset) => {
                if (preset.id === chosenPresetId) {
                    return {
                        ...preset,
                        urls: preset.urls.concat(host),
                    };
                }
                return preset;
            });
            props.actions.changeSettings({
                customThemes: filteredCustomThemes,
                presets: extended,
            });
        }
    }

    return (
        <DropDown
            class="theme-preset-picker"
            selected={selectedPresetId}
            options={dropdownOptions}
            onChange={onPresetChange}
        />
    );
}

```

### ui\popup\theme\utils.ts

```
import type {Theme, ViewProps} from '../../../definitions';
import {isURLInList} from '../../../utils/url';

interface ThemePresets {
    theme: Theme;
    change: (config: Partial<Theme>) => void;
}

export function getCurrentThemePreset(props: ViewProps): ThemePresets {
    const custom = props.data.settings.customThemes.find(
        ({url}) => isURLInList(props.data.activeTab.url, url)
    );
    const preset = custom ? null : props.data.settings.presets.find(
        ({urls}) => isURLInList(props.data.activeTab.url, urls)
    );
    let theme = custom ?
        custom.theme :
        preset ?
            preset.theme :
            props.data.settings.theme;
    if (props.data.forcedScheme) {
        const mode = props.data.forcedScheme === 'dark' ? 1 : 0;
        theme = {...theme, mode};
    }

    function setTheme(config: Partial<Theme>) {
        if (custom) {
            custom.theme = {...custom.theme, ...config};
            props.actions.changeSettings({
                customThemes: props.data.settings.customThemes,
            });
        } else if (preset) {
            preset.theme = {...preset.theme, ...config};
            props.actions.changeSettings({
                presets: props.data.settings.presets,
            });
        } else {
            props.actions.setTheme(config);
        }
        if (
            config.mode != null &&
            props.data.settings.automation.behavior === 'Scheme'
        ) {
            props.actions.changeSettings({
                automation: {...props.data.settings.automation, ...{enabled: false}},
            });
        }
    }

    return {
        theme,
        change: setTheme,
    };
}

```

### ui\popup\utils\issues.ts

```
declare const __THUNDERBIRD__: boolean;

export function fixNotClosingPopupOnNavigation(): void {
    // This event listener must not be passive since it calls e.preventDefault()
    document.addEventListener('click', (e) => {
        if (e.defaultPrevented || e.button === 2) {
            return;
        }
        let target = e.target as HTMLElement;
        while (target && !(target instanceof HTMLAnchorElement)) {
            target = target.parentElement!;
        }
        if (target && target.hasAttribute('href')) {
            chrome.tabs.create({url: target.getAttribute('href')!});
            e.preventDefault();
            if (!__THUNDERBIRD__) {
                window.close();
            }
        }
    });
}

```

### ui\popup\utils\markdown.tsx

```
import {m} from 'malevic';

export function compileMarkdown(markdown: string) {
    return markdown.split('**')
        .map((text, i) => i % 2 ? (<strong>{text}</strong>) : text);
}

```

### ui\popup\style.less

```
@import "../theme";
@import "../shared";

@popup-content-width: 15rem;
@popup-content-height: 30rem;
@popup-content-padding: 1rem;

@import "./components/custom-settings-toggle/style";
@import "./components/engine-switch/style";
@import "./components/filter-settings/style";
@import "./components/font-settings/style";
@import "./components/header/style";
@import "./components/loader/style";
@import "./components/more-settings/style";
@import "./components/news/style";
@import "./components/site-list-settings/style";
@import "./components/site-toggle/style";

body {
    align-items: stretch;
    box-sizing: content-box;
    display: flex;
    flex-direction: column;
    height: @popup-content-height;
    margin: 0 auto;
    padding: @popup-content-padding;
    position: relative;
    width: @popup-content-width;
}

.header {
    flex: none;
}

.tab-panel {
    flex: auto;
    margin-top: @indent-large;
}

footer {
    align-items: stretch;
    display: flex;
    flex: none;
    flex-direction: column;
    justify-content: center;
    margin-top: @indent-large;

    p {
        margin: 0 0 @size-border 0;
        text-align: center;
        white-space: pre;
    }
}

.footer-links {
    align-items: stretch;
    display: flex;
    flex: none;
    justify-content: center;
    margin-bottom: @indent-small;

    &__link {
        color: @color-fore;
        line-height: @size-text-normal-height;
        text-align: center;
        text-decoration: none;

        &:hover {
            text-decoration: underline;
        }
    }

    > :not(:first-child) {
        margin-left: @indent-small;
    }
}

.footer-buttons {
    align-items: stretch;
    display: flex;
    flex-direction: row;
    justify-content: stretch;
    width: 100%;

    > * {
        flex: auto;
    }

    > :not(:first-child) {
        margin-left: @indent-small;
    }
}

.donate-link {
    align-items: center;
    background-color: @color-control-active;
    color: @color-control-fore;
    cursor: pointer;
    display: inline-flex;
    height: @size-control-inner + 2 * @size-border;
    justify-content: center;
    margin: 0;
    position: relative;
    text-decoration: none;
    transition: all @time-fast;

    &:hover {
        box-shadow: 0 0 @indent-large @color-control-active;
    }

    &__text {
        font-weight: bold;
        line-height: @size-text-normal;
        text-align: center;
        transform: skewX(-10deg);
    }
}

.dev-tools-button {
    overflow: visible;
    position: relative;
}

.ext-disabled {
    .site-toggle--disabled {
        opacity: 1;
    }

    .header__site-toggle,
    .tab-panel {
        opacity: 0.5;
        pointer-events: none;
    }

    .tab-panel__tab--active {
        pointer-events: none;
    }
}

.mobile-link {
    align-items: center;
    background-color: @color-control-back;
    border: @size-border solid @color-border;
    border-bottom-left-radius: @size-text-normal-height;
    border-top-left-radius: @size-text-normal-height;
    box-sizing: border-box;
    cursor: pointer;
    display: flex;
    flex-direction: row;
    justify-content: space-between;
    margin-top: @indent-large;
    position: relative;
    text-decoration: none;
    user-select: none;

    &__icon {
        background-image: url('../assets/images/mobile-icon-40x64.svg');
        background-position: center;
        background-repeat: no-repeat;
        background-size: cover;
        border-radius: 0.4375rem;
        display: inline-block;
        flex: none;
        height: 2.8rem;
        left: -@size-border;
        overflow: hidden;
        position: absolute;
        width: 1.75rem;
    }
    &__text {
        color: @color-control-fore;
        flex: auto;
        font-weight: bold;
        height: @size-text-normal-height * 2;
        line-height: @size-text-normal-height;
        margin: @size-border 1rem @size-border 2rem;
        text-align: center;
        overflow: hidden;

        &::after {
            content: " →";
            font-weight: bold;
        }
    }

    &:hover {
        background-color: @color-control-hover;
    }

    &:hover &__icon {
        box-shadow: 0 0 0.5rem @color-fore;
    }

    &:active {
        background-color: @color-control-active;
    }
}

.mobile-link {
    display: none;
}

.birthday-container {
    align-items: stretch;
    column-gap: @indent-small;
    display: grid;
    grid:
        "icon message" auto
        "button button" @size-control-inner + 2 * @size-border
        e('/') 2rem auto;
    width: @popup-content-width;

    .birthday-icon {
        background-image: url(../assets/images/birthday-icon.svg);
        background-position: center;
        background-repeat: no-repeat;
        background-size: contain;
        display: inline-block;
        grid-area: icon;
        height: 2rem;
        line-height: 2rem;
        margin: 0.5rem 0;
        text-align: center;
        text-indent: -999rem;
        width: 2rem;
    }

    .birthday-message {
        align-items: center;
        color: @color-control-fore;
        display: flex;
        flex-direction: column;
        grid-area: message;
        height: 3rem;
        line-height: 1rem;
        justify-content: center;
        text-align: left;

        a {
            color: @color-control-fore;
        }
    }

    .donate-link {
        background-color: @color-control-back;
        background-image: linear-gradient(135deg, #954d6d, transparent 10%, transparent 90%, #31367d);
        border: @size-border solid @color-border;
        box-shadow: none;
        box-sizing: border-box;
        grid-area: button;
        transition: all @time-slow;
        width: 100%;

        &:hover {
            background-color: @color-control-hover;
            box-shadow: none;
        }
    }
}

.footer-help-link {
    align-items: center;
    background-color: @color-control-active;
    color: @color-control-fore;
    cursor: pointer;
    display: inline-flex;
    font-weight: bold;
    justify-content: center;
    margin: 0;
    position: relative;
    text-decoration: none;
    transition: all @time-fast;

    &::before {
        background-color: @color-control-fore;
        border-radius: 50%;
        box-sizing: border-box;
        color: @color-control-active;
        content: "?";
        display: inline-block;
        font-weight: bold;
        height: @size-text-normal-height;
        margin-right: 0.125rem;
        text-align: center;
        -webkit-text-stroke: 0.0625rem;
        width: @size-text-normal-height;
    }

    &:hover {
        box-shadow: 0 0 @indent-large @color-control-active;
    }
}

//
// Make popup borders the same
// across platforms and browser versions

body {
    border: 2px solid white;
}

html:not(.mobile):not(.preview) body {
    height: @popup-content-height + 4rem;
}

.overlay {
    height: calc(100% - 4px);
    left: 2px;
    top: 2px;
    width: calc(100% - 4px);
}

@import "./body/style";

/* @plus-start */
@import "../../plus/popup/plus-body.less";
/* @plus-end */

```

### ui\popup\compatibility.js

```
(function () {
    if ('userAgentData' in navigator) {
        return;
    }
    var match = navigator.userAgent.toLowerCase().match(/chrom[e|ium]\/([^ \.]+)/);
    if (!match) {
        return;
    }
    var version = parseInt(match[1]);
    var minChromeVersion = 63;
    if (version >= minChromeVersion) {
        return;
    }
    var warning = document.createElement('div');
    warning.className = 'compatibility-warning';
    var text = document.createTextNode([
        'Your Google Chrome (or Chromium) version ' + version + ' is out of date.',
        'In order to use this extension update your Google Chrome.',
        'If you cannot update, install the old Dark Reader version, which works for at least Chrome 49, from '
    ].join(' '));
    var link = document.createElement('a');
    link.href = 'https://chrome.google.com/webstore/detail/oibheihomapbjogmoabgfbkchjchpdfp';
    link.target = '_blank';
    link.textContent = 'here';
    warning.appendChild(text);
    warning.appendChild(link);
    warning.style.backgroundColor = '#00222b';
    warning.style.boxSizing = 'border-box';
    warning.style.color = '#e96c4c';
    warning.style.height = '100%';
    warning.style.left = '0';
    warning.style.padding = '40% 1rem 0 1rem';
    warning.style.position = 'fixed';
    warning.style.textAlign = 'justify';
    warning.style.textAlignLast = 'center';
    warning.style.top = '0';
    warning.style.width = '100%';
    warning.style.zIndex = '2014';
    link.style.color = '#e96c4c';
    link.style.outline = 'none';
    document.body.appendChild(warning);
})();
```

### ui\popup\index.tsx

```
import {m} from 'malevic';
import {sync} from 'malevic/dom';

import type {ExtensionData, ExtensionActions, DebugMessageBGtoCS, DebugMessageBGtoUI} from '../../definitions';
import {DebugMessageTypeBGtoUI} from '../../utils/message';
import {isMobile, isFirefox} from '../../utils/platform';
import Connector from '../connect/connector';
import {getFontList, saveFile} from '../utils';

import Body from './components/body';
import {fixNotClosingPopupOnNavigation} from './utils/issues';

function renderBody(data: ExtensionData, fonts: string[], installation: {date: number; version: string}, actions: ExtensionActions) {
    if (data.settings.previewNewDesign) {
        if (!document.documentElement.classList.contains('preview')) {
            document.documentElement.classList.add('preview');
        }
    } else if (document.documentElement.classList.contains('preview')) {
        document.documentElement.classList.remove('preview');
    }

    if (data.news && data.news.length > 0) {
        const latest = data.news[0];
        if (latest && !latest.displayed) {
            actions.markNewsAsDisplayed([latest.id]);
        }
    }

    sync(document.body, (
        <Body data={data} actions={actions} fonts={fonts} installation={installation} />
    ));
}

async function getInstallationData() {
    return new Promise<any>((resolve) => {
        chrome.storage.local.get({installation: {}}, (data) => {
            if (data?.installation?.version) {
                resolve(data.installation);
            } else {
                resolve({});
            }
        });
    });
}

async function start() {
    const connector = new Connector();
    window.addEventListener('unload', () => connector.disconnect(), {passive: true});

    const [data, fonts, installation] = await Promise.all([
        connector.getData(),
        getFontList(),
        getInstallationData(),
    ]);
    renderBody(data, fonts, installation, connector);
    connector.subscribeToChanges((data) => renderBody(data, fonts, installation, connector));
}

addEventListener('load', start, {passive: true});

document.documentElement.classList.toggle('mobile', isMobile);
document.documentElement.classList.toggle('firefox', isFirefox);

if (isFirefox) {
    fixNotClosingPopupOnNavigation();
}

declare const __DEBUG__: boolean;
if (__DEBUG__) {
    chrome.runtime.onMessage.addListener(({type}: DebugMessageBGtoCS | DebugMessageBGtoUI) => {
        if (type === DebugMessageTypeBGtoUI.CSS_UPDATE) {
            document.querySelectorAll('link[rel="stylesheet"]').forEach((link: HTMLLinkElement) => {
                const url = link.href;
                link.disabled = true;
                const newLink = document.createElement('link');
                newLink.rel = 'stylesheet';
                newLink.href = url.replace(/\?.*$/, `?nocache=${Date.now()}`);
                link.parentElement!.insertBefore(newLink, link);
                link.remove();
            });
        }

        if (type === DebugMessageTypeBGtoUI.UPDATE) {
            location.reload();
        }
    });
}

declare const __TEST__: boolean;
if (__TEST__) {
    const socket = new WebSocket(`ws://localhost:8894`);
    socket.onopen = async () => {
        socket.send(JSON.stringify({
            data: {
                type: 'popup',
                uuid: `ready-${document.location.pathname}`,
            },
            id: null,
        }));
    };
    socket.onmessage = (e) => {
        const respond = (message: {id?: number; data?: any; error?: string}) => socket.send(JSON.stringify(message));
        try {
            const message: {type: string; id: number; data: any} = JSON.parse(e.data);
            const {type, id, data} = message;
            switch (type) {
                case 'popup-click': {
                    // The required element may not exist yet
                    const check = () => {
                        const element: HTMLElement | null = document.querySelector(data);
                        if (element) {
                            element.click();
                            respond({id});
                        } else {
                            requestIdleCallback(check, {timeout: 500});
                        }
                    };

                    check();
                    break;
                }
                case 'popup-exists': {
                    // The required element may not exist yet
                    const check = () => {
                        const element: HTMLElement | null = document.querySelector(data);
                        if (element) {
                            respond({id, data: true});
                        } else {
                            requestIdleCallback(check, {timeout: 500});
                        }
                    };

                    check();
                    break;
                }
                case 'popup-saveFile': {
                    const {name, content} = data;
                    saveFile(name, content);
                    respond({id});
                    break;
                }
                default:
            }
        } catch (err) {
            respond({error: String(err)});
        }
    };
}

```

### ui\stylesheet-editor\components\body.tsx

```
import {m} from 'malevic';
import {getContext} from 'malevic/dom';

import type {ExtWrapper} from '../../../definitions';
import {getURLHostOrProtocol, isURLInList} from '../../../utils/url';
import {Button, MessageBox, Overlay} from '../../controls';

export default function Body({data, actions}: ExtWrapper) {
    const context = getContext();
    const host = getURLHostOrProtocol(data.activeTab.url);
    const custom = data.settings.customThemes.find(({url}) => isURLInList(data.activeTab.url, url));

    let textNode: HTMLTextAreaElement;

    const placeholderText = [
        '* {',
        '    background-color: #234 !important;',
        '    color: #cba !important;',
        '}',
    ].join('\n');

    function onTextRender(node: HTMLTextAreaElement) {
        textNode = node;
        textNode.value = (custom ? custom.theme.stylesheet : data.settings.theme.stylesheet) || '';
        if (document.activeElement !== textNode) {
            textNode.focus();
        }
    }

    function applyStyleSheet(css: string) {
        if (custom) {
            custom.theme = {...custom.theme, ...{stylesheet: css}};
            actions.changeSettings({customThemes: data.settings.customThemes});
        } else {
            actions.setTheme({stylesheet: css});
        }
    }

    function showDialog() {
        context.store.isDialogVisible = true;
        context.refresh();
    }

    function hideDialog() {
        context.store.isDialogVisible = false;
        context.refresh();
    }

    const dialog = context && context.store.isDialogVisible ? (
        <MessageBox
            caption="Are you sure you want to remove current changes? You cannot restore them later."
            onOK={reset}
            onCancel={hideDialog}
        />
    ) : null;

    function reset() {
        context.store.isDialogVisible = false;
        applyStyleSheet('');
    }

    function apply() {
        const css = textNode.value;
        applyStyleSheet(css);
    }

    return (
        <body>
            <header>
                <img id="logo" src="../assets/images/darkreader-type.svg" alt="Dark Reader" />
                <h1 id="title">CSS Editor</h1>
            </header>
            <h3 class="sub-title">{custom ? host : 'All websites'}</h3>
            <textarea
                class="editor"
                native
                placeholder={placeholderText}
                onrender={onTextRender}
                spellcheck="false"
                autocorrect="off"
                autocomplete="off"
                autocapitalize="off"
            />
            <div class="buttons">
                <Button onclick={showDialog}>
                    Reset changes
                    {dialog}
                </Button>
                <Button onclick={apply}>Apply</Button>
            </div>
            <Overlay />
        </body>
    );
}

```

### ui\stylesheet-editor\index.tsx

```
import {m} from 'malevic';
import {sync} from 'malevic/dom';

import type {ExtensionActions, ExtensionData} from '../../definitions';
import Connector from '../connect/connector';

import Body from './components/body';

function renderBody(data: ExtensionData, actions: ExtensionActions) {
    sync(document.body, <Body data={data} actions={actions} />);
}

async function start() {
    const connector = new Connector();
    window.addEventListener('unload', () => connector.disconnect(), {passive: true});

    const data = await connector.getData();
    renderBody(data, connector);
    connector.subscribeToChanges((data) => renderBody(data, connector));
}

start();

```

### ui\stylesheet-editor\style.less

```
@import "../devtools/style";

```

### ui\theme.less

```
@color-back: #141e24;
@color-fore: #53a1b3;

@color-control-back: #141e24;
@color-control-hover: #193945;
@color-control-active: #316e7d;
@color-control-fore: #ffffff;
@color-control-fore-inactive: #316e7d;

@color-input-back: #141e24;
@color-input-hover: #193945;
@color-input-active: #193945;
@color-input-fore: #53a1b3;
@color-input-fore-active: #ffffff;
@color-input-fore-placeholder: #316e7d;

@color-border: #316e7d;
@color-heading: #e96c4c;
@color-error: #db4245;
@color-ok: #317c4e;
@color-ok-fore: #3bc077;
@color-selection-back: #e96c4c;
@color-selection-fore: #ffffff;

@font-family: Open Sans, Segoe UI, Helvetica Neue, Ubuntu, sans-serif;

@size-border: 0.125rem;
@size-border-inner: 0.0625rem;
@size-control-inner: 1.5rem;
@size-control-description: 0.75rem;
@size-scrollbar-padding: 0.25rem;
@size-scrollbar-thickness: 0.75rem;
@size-text-normal: 0.75rem;
@size-text-normal-height: 1rem;
@size-text-small: 0.625rem;
@size-text-small-height: 0.875rem;
@size-text-large: 0.875rem;
@size-text-large-height: 1rem;

@indent-large: 0.75rem;
@indent-small: 0.5rem;

@time-fast: 125ms;
@time-slow: 250ms;

```

### ui\utils.ts

```
import {isMobile} from '../utils/platform';

declare const __CHROMIUM_MV3__: boolean;

export function classes(...args: Array<string | {[cls: string]: boolean}>): string {
    const classes: string[] = [];
    args.filter((c) => Boolean(c)).forEach((c) => {
        if (typeof c === 'string') {
            classes.push(c);
        } else if (typeof c === 'object') {
            classes.push(...Object.keys(c).filter((key) => Boolean(c[key])));
        }
    });
    return classes.join(' ');
}

export function compose<T extends Malevic.Component>(type: T, ...wrappers: Array<(t: T) => T>): T {
    return wrappers.reduce((t, w) => w(t), type);
}

export function openFile(options: {extensions: string[]}, callback: (content: string) => void): void {
    const input = document.createElement('input');
    input.type = 'file';
    input.style.display = 'none';
    if (options.extensions && options.extensions.length > 0) {
        input.accept = options.extensions.map((ext) => `.${ext}`).join(',');
    }
    const reader = new FileReader();
    reader.onloadend = () => callback(reader.result as string);
    input.onchange = () => {
        if (input.files![0]) {
            reader.readAsText(input.files![0]);
            document.body.removeChild(input);
        }
    };
    document.body.appendChild(input);
    input.click();
}

export function saveFile(name: string, content: string): void {
    const a = document.createElement('a');
    a.href = URL.createObjectURL(new Blob([content]));
    a.download = name;
    a.click();
}

type AnyVoidFunction = (...args: any[]) => void;

export function throttle<F extends AnyVoidFunction>(callback: F): F {
    let frameId: number | null = null;
    return ((...args: any[]) => {
        if (!frameId) {
            callback(...args);
            frameId = requestAnimationFrame(() => (frameId = null));
        }
    }) as F;
}

interface SwipeEventObject {
    clientX: number;
    clientY: number;
}

type SwipeEventHandler<T = void> = (e: SwipeEventObject, nativeEvent: MouseEvent | TouchEvent) => T;
type StartSwipeHandler = SwipeEventHandler<{move: SwipeEventHandler; up: SwipeEventHandler}>;

function onSwipeStart(
    startEventObj: MouseEvent | TouchEvent,
    startHandler: StartSwipeHandler,
): void {
    const isTouchEvent =
        typeof TouchEvent !== 'undefined' &&
        startEventObj instanceof TouchEvent;
    const touchId = isTouchEvent
        ? (startEventObj).changedTouches[0].identifier
        : null;
    const pointerMoveEvent = isTouchEvent ? 'touchmove' : 'mousemove';
    const pointerUpEvent = isTouchEvent ? 'touchend' : 'mouseup';

    if (!isTouchEvent) {
        startEventObj.preventDefault();
    }

    function getSwipeEventObject(e: MouseEvent | TouchEvent) {
        const {clientX, clientY} = isTouchEvent
            ? getTouch(e as TouchEvent)
            : e as MouseEvent;
        return {clientX, clientY};
    }

    const startSE = getSwipeEventObject(startEventObj);
    const {move: moveHandler, up: upHandler} = startHandler(startSE, startEventObj);

    function getTouch(e: TouchEvent) {
        return Array.from(e.changedTouches).find(
            ({identifier: id}) => id === touchId,
        )!;
    }

    const onPointerMove = throttle((e) => {
        const se = getSwipeEventObject(e);
        moveHandler(se, e);
    });

    function onPointerUp(e: MouseEvent) {
        unsubscribe();
        const se = getSwipeEventObject(e);
        upHandler(se, e);
    }

    function unsubscribe() {
        window.removeEventListener(pointerMoveEvent, onPointerMove);
        window.removeEventListener(pointerUpEvent, onPointerUp);
    }

    window.addEventListener(pointerMoveEvent, onPointerMove, {passive: true});
    window.addEventListener(pointerUpEvent, onPointerUp, {passive: true});
}

export function createSwipeHandler(startHandler: StartSwipeHandler): (e: MouseEvent | TouchEvent) => void {
    return (e: MouseEvent | TouchEvent) => onSwipeStart(e, startHandler);
}

export async function getFontList(): Promise<string[]> {
    return new Promise<string[]>((resolve) => {
        if (!chrome.fontSettings) {
            // Todo: Remove it as soon as Firefox and Edge get support.
            resolve([
                'serif',
                'sans-serif',
                'monospace',
                'cursive',
                'fantasy',
                'system-ui',
            ]);
            return;
        }
        chrome.fontSettings.getFontList((list) => {
            const fonts = list.map((f) => f.fontId);
            resolve(fonts);
        });
    });
}

type ExtensionPage = 'devtools' | 'options' | 'stylesheet-editor';

// TODO(Anton): There must be a better way to do this
// This function ping-pongs a message to possible DevTools popups.
// This function should have reasonable performance since it sends
// messages only to popups and not regular windows.
async function getExtensionPageTabMV3(): Promise<chrome.tabs.Tab | null> {
    return new Promise((resolve) => {
        chrome.windows.getAll({
            populate: true,
            windowTypes: ['popup'],
        }, (w) => {
            const responses: Array<Promise<string>> = [];
            let found = false;
            for (const window of w) {
                const response = chrome.tabs.sendMessage<string, 'getExtensionPageTabMV3_pong'>(window.tabs![0]!.id!, 'getExtensionPageTabMV3_ping', {frameId: 0});
                response.then((response) => {
                    if (response === 'getExtensionPageTabMV3_pong') {
                        found = true;
                        resolve(window.tabs![0]);
                    }
                });
                responses.push(response);
            }
            Promise.all(responses).then(() => !found && resolve(null));
        });
    });
}

async function getExtensionPageTab(url: string): Promise<chrome.tabs.Tab | null> {
    if (__CHROMIUM_MV3__) {
        return getExtensionPageTabMV3();
    }
    return new Promise<chrome.tabs.Tab>((resolve) => {
        chrome.tabs.query({
            url,
        }, ([tab]) => resolve(tab || null));
    });
}

export async function openExtensionPage(page: ExtensionPage): Promise<void> {
    const url = chrome.runtime.getURL(`/ui/${page}/index.html`);
    if (isMobile || page === 'options') {
        const extensionPageTab = await getExtensionPageTab(url);
        if (extensionPageTab !== null) {
            chrome.tabs.update(extensionPageTab.id!, {active: true});
            window.close();
        } else {
            chrome.tabs.create({url});
            window.close();
        }
    } else {
        const extensionPageTab = await getExtensionPageTab(url);
        if (extensionPageTab !== null) {
            chrome.windows.update(extensionPageTab.windowId, {focused: true});
            window.close();
        } else {
            chrome.windows.create({
                type: 'popup',
                url,
                width: 800,
                height: 600,
            });
            window.close();
        }
    }
}

```

### ui\shared.less

```
@import "./theme.less";
@import "./icons/icons.less";

@font-face {
    font-family: 'Open Sans';
    src: url('../assets/fonts/OpenSans-Regular.ttf') format('truetype');
    font-weight: normal;
    font-style: normal;
}

@font-face {
    font-family: 'Open Sans';
    src: url('../assets/fonts/OpenSans-SemiBold.ttf') format('truetype');
    font-weight: bold;
    font-style: normal;
}

@font-face {
    font-family: 'Open Sans';
    src: url('../assets/fonts/OpenSans-Light.ttf') format('truetype');
    font-weight: 100;
    font-style: normal;
}

@import "./controls/style";

html {
    background-color: @color-back;
    color: @color-fore;
    color-scheme: dark;
    font-family: @font-family;
    font-size: 16px;
}

body {
    font-family: @font-family;
    font-size: @size-text-normal;
}

input, button {
    font-family: @font-family;
    font-size: @size-text-normal;
}

::-moz-selection {
    background-color: @color-selection-back;
    color: @color-selection-fore;
}

::selection {
    background-color: @color-selection-back;
    color: @color-selection-fore;
}

::-webkit-scrollbar {
    background-color: @color-back;
    width: @size-scrollbar-thickness;

    &-thumb {
        background-color: @color-control-hover;

        &:hover {
            background-color: mix(@color-control-hover, @color-control-active, 50%);
        }

        &:active {
            background-color: @color-control-active;
        }
    }

    &-corner {
        background-color: @color-back;
    }
}

* {
    scrollbar-color: @color-control-hover @color-back;
}

```

### utils\css-text\parse-gradient.ts

```
import {getParenthesesRange} from '../text';

const gradientLength = 'gradient'.length;
const conicGradient = 'conic-';
const conicGradientLength = conicGradient.length;
const radialGradient = 'radial-';
const linearGradient = 'linear-';

export interface ParsedGradient {
    typeGradient: string;
    match: string;
    hasComma: boolean;
    index: number;
    offset: number;
}

// Parse the value according to the specification.
//
// Specification: https://drafts.csswg.org/css-images-4/#gradients
export function parseGradient(value: string): ParsedGradient[] {
    const result: ParsedGradient[] = [];

    // Loop trough the value until we find the first `gradient` keyword.
    // We will be using the indexOf to find the keyword. From their on
    // we will check which specific gradient we are dealing with.
    // Then we will try to parse the rest of the value as a gradient.
    let index = 0;
    let startIndex = conicGradient.length;
    while ((index = value.indexOf('gradient', startIndex)) !== -1) {
        let typeGradient: string | undefined;
        // Now we check the type of gradient.
        // the current index starts at `g` of gradient.
        // So we have to do a reverse lookup to find the type of gradient.
        // Because each type of gradient has a different length
        // will we get the substring of the possible gradient types.
        [linearGradient, radialGradient, conicGradient].find((possibleType) => {
            if (index - possibleType.length >= 0) {
                const possibleGradient = value.substring(index - possibleType.length, index);
                if (possibleGradient === possibleType) {
                    // Check if the type has a `-` before the `type-gradient` keyword.
                    // If it does, it's a repeating gradient.
                    if (value.slice(index - possibleType.length - 10, index - possibleType.length - 1) === 'repeating') {
                        typeGradient = `repeating-${possibleType}gradient`;
                        return true;
                    }
                    if (value.slice(index - possibleType.length - 8, index - possibleType.length - 1) === '-webkit') {
                        typeGradient = `-webkit-${possibleType}gradient`;
                        return true;
                    }
                    typeGradient = `${possibleType}gradient`;
                    return true;
                }
            }
        });

        if (!typeGradient) {
            break;
        }

        // Now we know the type of gradient.
        // We can go parse the rest of the value as a gradient.
        const {start, end} = getParenthesesRange(value, index + gradientLength)!;

        const match = value.substring(start + 1, end - 1);
        startIndex = end + 1 + conicGradientLength;

        result.push({
            typeGradient,
            match,
            // <type>-gradient() is not within match, so in order to still "skip" that section
            // we add that length as offset.
            offset: typeGradient.length + 2,
            index: index - typeGradient.length + gradientLength,
            hasComma: true,
        });
    }

    // Set the last result to not have a comma.
    if (result.length) {
        result[result.length - 1].hasComma = false;
    }


    return result;
}

```

### utils\css-text\format-css.ts

```
import {isParsedStyleRule, parseCSS} from '../css-text/parse-css';
import type {ParsedAtRule, ParsedCSS, ParsedDeclaration, ParsedStyleRule} from '../css-text/parse-css';

export function formatCSS(cssText: string): string {
    const parsed = parseCSS(cssText);
    return formatParsedCSS(parsed);
}

export function formatParsedCSS(parsed: ParsedCSS): string {
    const lines: string[] = [];
    const tab = '    ';

    function formatRule(rule: ParsedAtRule | ParsedStyleRule, indent: string) {
        if (isParsedStyleRule(rule)) {
            formatStyleRule(rule as ParsedStyleRule, indent);
        } else {
            formatAtRule(rule, indent);
        }
    }

    function formatAtRule({type, query, rules}: ParsedAtRule, indent: string) {
        lines.push(`${indent}${type} ${query} {`);
        rules.forEach((child) => formatRule(child, `${indent}${tab}`));
        lines.push(`${indent}}`);
    }

    function formatStyleRule({selectors, declarations}: ParsedStyleRule, indent: string) {
        const lastSelectorIndex = selectors.length - 1;
        selectors.forEach((selector, i) => {
            lines.push(`${indent}${selector}${i < lastSelectorIndex ? ',' : ' {'}`);
        });
        const sorted = sortDeclarations(declarations);
        sorted.forEach(({property, value, important}) => {
            lines.push(`${indent}${tab}${property}: ${value}${important ? ' !important' : ''};`);
        });
        lines.push(`${indent}}`);
    }

    clearEmptyRules(parsed);
    parsed.forEach((rule) => formatRule(rule, ''));
    return lines.join('\n');
}

function sortDeclarations(declarations: ParsedDeclaration[]) {
    const prefixRegex = /^-[a-z]-/;
    return [...declarations].sort((a, b) => {
        const aProp = a.property;
        const bProp = b.property;
        const aPrefix = aProp.match(prefixRegex)?.[0] ?? '';
        const bPrefix = bProp.match(prefixRegex)?.[0] ?? '';
        const aNorm = aPrefix ? aProp.replace(prefixRegex, '') : aProp;
        const bNorm = bPrefix ? bProp.replace(prefixRegex, '') : bProp;
        if (aNorm === bNorm) {
            return aPrefix.localeCompare(bPrefix);
        }
        return aNorm.localeCompare(bNorm);
    });
}

function clearEmptyRules(rules: Array<ParsedAtRule | ParsedStyleRule>) {
    for (let i = rules.length - 1; i >= 0; i--) {
        const rule = rules[i];
        if (isParsedStyleRule(rule)) {
            if (rule.declarations.length === 0) {
                rules.splice(i, 1);
            }
        } else {
            clearEmptyRules(rule.rules);
            if (rule.rules.length === 0) {
                rules.splice(i, 1);
            }
        }
    }
}

```

### utils\css-text\parse-css.ts

```
import {getOpenCloseRange, splitExcluding} from '../text';
import type {TextRange} from '../text';

import {removeCSSComments} from './css-text';

export interface ParsedDeclaration {
    property: string;
    value: string;
    important: boolean;
}

export interface ParsedStyleRule {
    selectors: string[];
    declarations: ParsedDeclaration[];
}

export interface ParsedAtRule {
    type: string;
    query: string;
    rules: Array<ParsedAtRule | ParsedStyleRule>;
}

export type ParsedCSS = Array<ParsedAtRule | ParsedStyleRule>;

export function parseCSS(cssText: string): ParsedCSS {
    cssText = removeCSSComments(cssText);
    cssText = cssText.trim();
    if (!cssText) {
        return [];
    }

    const rules: ParsedCSS = [];

    // Find {...} ranges excluding inside of "...", [...] etc.
    const excludeRanges = getTokenExclusionRanges(cssText);
    const bracketRanges = getAllOpenCloseRanges(cssText, '{', '}', excludeRanges);

    let ruleStart = 0;
    bracketRanges.forEach((brackets) => {
        const key = cssText.substring(ruleStart, brackets.start).trim();
        const content = cssText.substring(brackets.start + 1, brackets.end - 1);

        if (key.startsWith('@')) {
            const typeEndIndex = key.search(/[\s\(]/);
            const rule: ParsedAtRule = {
                type: typeEndIndex < 0 ? key : key.substring(0, typeEndIndex),
                query: typeEndIndex < 0 ? '' : key.substring(typeEndIndex).trim(),
                rules: parseCSS(content),
            };
            rules.push(rule);
        } else {
            const rule: ParsedStyleRule = {
                selectors: parseSelectors(key),
                declarations: parseDeclarations(content),
            };
            rules.push(rule);
        }

        ruleStart = brackets.end;
    });

    return rules;
}

function getAllOpenCloseRanges(
    input: string,
    openToken: string,
    closeToken: string,
    excludeRanges: TextRange[] = [],
) {
    const ranges: TextRange[] = [];
    let i = 0;
    let range: TextRange | null;
    while ((range = getOpenCloseRange(input, i, openToken, closeToken, excludeRanges))) {
        ranges.push(range);
        i = range.end;
    }
    return ranges;
}

function getTokenExclusionRanges(cssText: string) {
    const singleQuoteGoesFirst = cssText.indexOf("'") < cssText.indexOf('"');
    const firstQuote = singleQuoteGoesFirst ? "'" : '"';
    const secondQuote = singleQuoteGoesFirst ? '"' : "'";
    const excludeRanges: TextRange[] = getAllOpenCloseRanges(cssText, firstQuote, firstQuote);
    excludeRanges.push(...getAllOpenCloseRanges(cssText, secondQuote, secondQuote, excludeRanges));
    excludeRanges.push(...getAllOpenCloseRanges(cssText, '[', ']', excludeRanges));
    excludeRanges.push(...getAllOpenCloseRanges(cssText, '(', ')', excludeRanges));
    return excludeRanges;
}

function parseSelectors(selectorText: string) {
    const excludeRanges = getTokenExclusionRanges(selectorText);
    return splitExcluding(selectorText, ',', excludeRanges);
}

function parseDeclarations(cssDeclarationsText: string) {
    const declarations: ParsedDeclaration[] = [];
    const excludeRanges = getTokenExclusionRanges(cssDeclarationsText);
    splitExcluding(cssDeclarationsText, ';', excludeRanges).forEach((part) => {
        const colonIndex = part.indexOf(':');
        if (colonIndex > 0) {
            const importantIndex = part.indexOf('!important');
            declarations.push({
                property: part.substring(0, colonIndex).trim(),
                value: part.substring(colonIndex + 1, importantIndex > 0 ? importantIndex : part.length).trim(),
                important: importantIndex > 0,
            });
        }
    });
    return declarations;
}

export function isParsedStyleRule(rule: ParsedAtRule | ParsedStyleRule): rule is ParsedStyleRule {
    return 'selectors' in rule;
}

```

### utils\css-text\css-text.ts

```
const cssCommentsRegex = /\/\*[\s\S]*?\*\//g;

export function removeCSSComments(cssText: string): string {
    return cssText.replace(cssCommentsRegex, '');
}

```

### utils\array.ts

```
function isArrayLike<T>(items: Iterable<T> | ArrayLike<T>): items is ArrayLike<T> {
    return (items as ArrayLike<T>).length != null;
}

// NOTE: Iterating Array-like items using `for .. of` is 3x slower in Firefox
// https://jsben.ch/kidOp
export function forEach<T>(items: Iterable<T> | ArrayLike<T> | Set<T>, iterator: (item: T) => void): void {
    if (isArrayLike(items)) {
        for (let i = 0, len = items.length; i < len; i++) {
            iterator(items[i]);
        }
    } else {
        for (const item of items) {
            iterator(item);
        }
    }
}

// NOTE: Pushing items like `arr.push(...items)` is 3x slower in Firefox
// https://jsben.ch/nr9OF
export function push<T>(array: T[], addition: Iterable<T> | ArrayLike<T>): void {
    forEach(addition, (a) => array.push(a));
}

// NOTE: Using `Array.from()` is 2x (FF) — 5x (Chrome) slower for ArrayLike (not for Iterable)
// https://jsben.ch/FJ1mO
// https://jsben.ch/ZmViL
export function toArray<T>(items: ArrayLike<T>): T[] {
    const results: T[] = [];
    for (let i = 0, len = items.length; i < len; i++) {
        results.push(items[i]);
    }
    return results;
}

```

### utils\visibility.ts

```
/**
 * The following code contains a workaround for extensions designed to prevent page from knowing when it is hidden
 * GitHub issue: https://github.com/darkreader/darkreader/issues/10004
 * GitHub PR: https://github.com/darkreader/darkreader/pull/10047
 *
 * Due to the intentional breakage introduced by these extensions, this utility might incorrectly report that document
 * is visible while it is not, but it will never report document as hidden while it is visible.
 *
 * This code exploits the fact that most such extensions block only a subset of Page Lifecycle API,
 * which notifies page of being hidden but not of being shown, while Dark Reader really cares only about
 * page being shown.
 * Specifically:
 *  - extensions block visibilitychange and blur event
 *  - extensions do not block focus event; browsers deliver focus event when user switches to
 *    a previously hidden tab or previously hidden window (assuming DevTools are closed so window gets the focus)
 *    if document has focus, then we can assume that it is visible
 *  - some extensions overwrite document.hidden but not document.visibilityState
 *  - Firefox has a bug: if extension overwrites document.hidden and document.visibilityState via Object.defineProperty,
 *    then Firefox will reset them to true and 'hidden' when tab is activated, but document.hasFocus() will be true
 *  - Safari supports document.visibilityState === 'prerender' which makes document.hidden === true even when document
 *    is visible to the user
 *
 * Note: This utility supports adding only one callback since currently calling code sets only one listener and Firefox
 * has issues optimizing code with multiple callbacks stored in array or in a set.
 */

let documentVisibilityListener: (() => void) | null = null;

let documentIsVisible_ = !document.hidden;

// TODO: use EventListenerOptions class once it is updated
const listenerOptions: any = {
    capture: true,
    passive: true,
};

function watchForDocumentVisibility(): void {
    document.addEventListener('visibilitychange', documentVisibilityListener!, listenerOptions);
    window.addEventListener('pageshow', documentVisibilityListener!, listenerOptions);
    window.addEventListener('focus', documentVisibilityListener!, listenerOptions);
}

function stopWatchingForDocumentVisibility(): void {
    document.removeEventListener('visibilitychange', documentVisibilityListener!, listenerOptions);
    window.removeEventListener('pageshow', documentVisibilityListener!, listenerOptions);
    window.removeEventListener('focus', documentVisibilityListener!, listenerOptions);
}

export function setDocumentVisibilityListener(callback: () => void): void {
    const alreadyWatching = Boolean(documentVisibilityListener);
    documentVisibilityListener = () => {
        if (!document.hidden) {
            removeDocumentVisibilityListener();
            callback();
            documentIsVisible_ = true;
        }
    };
    if (!alreadyWatching) {
        watchForDocumentVisibility();
    }
}

export function removeDocumentVisibilityListener(): void {
    stopWatchingForDocumentVisibility();
    documentVisibilityListener = null;
}

export function documentIsVisible(): boolean {
    return documentIsVisible_;
}

```

### utils\uid.ts

```
function hexify(number: number): string {
    return ((number < 16 ? '0' : '') + number.toString(16));
}

export function generateUID(): string {
    if ('randomUUID' in crypto) {
        const uuid = crypto.randomUUID();
        return uuid.substring(0, 8) + uuid.substring(9, 13) + uuid.substring(14, 18) + uuid.substring(19, 23) + uuid.substring(24);
    }

    if ('getRandomValues' in crypto) {
        return Array.from((crypto as Crypto).getRandomValues(new Uint8Array(16))).map((x) => hexify(x)).join('');
    }

    return Math.floor(Math.random() * 2 ** 55).toString(36);
}

```

### utils\url.ts

```
import type {UserSettings, TabInfo} from '../definitions';

import {cachedFactory} from './cache';

let anchor: HTMLAnchorElement;

export const parsedURLCache = new Map<string, URL>();

function fixBaseURL($url: string): string {
    if (!anchor) {
        anchor = document.createElement('a');
    }
    anchor.href = $url;
    return anchor.href;
}

export function parseURL($url: string, $base: string | null = null): URL {
    const key = `${$url}${$base ? `;${$base}` : ''}`;
    if (parsedURLCache.has(key)) {
        return parsedURLCache.get(key)!;
    }
    if ($base) {
        const parsedURL = new URL($url, fixBaseURL($base));
        parsedURLCache.set(key, parsedURL);
        return parsedURL;
    }
    const parsedURL = new URL(fixBaseURL($url));
    parsedURLCache.set($url, parsedURL);
    return parsedURL;
}

export function getAbsoluteURL($base: string, $relative: string): string {
    if ($relative.match(/^data\\?\:/)) {
        return $relative;
    }
    // Check if relative starts with `//hostname...`.
    // We have to add a protocol to make it absolute.
    if (/^\/\//.test($relative)) {
        return `${location.protocol}${$relative}`;
    }
    const b = parseURL($base);
    const a = parseURL($relative, b.href);
    return a.href;
}

// Check if any relative URL is on the window.location;
// So that https://duck.com/ext.css would return true on https://duck.com/
// But https://duck.com/styles/ext.css would return false on https://duck.com/
// Visa versa https://duck.com/ext.css should return fasle on https://duck.com/search/
// We're checking if any relative value within ext.css could potentially not be on the same path.
export function isRelativeHrefOnAbsolutePath(href: string): boolean {
    if (href.startsWith('data:')) {
        return true;
    }
    const url = parseURL(href);

    if (url.protocol !== location.protocol) {
        return false;
    }
    if (url.hostname !== location.hostname) {
        return false;
    }
    if (url.port !== location.port) {
        return false;
    }
    // Now check if the path is on the same path as the base
    // We do this by getting the pathname up until the last slash.
    return url.pathname === location.pathname;
}

export function getURLHostOrProtocol($url: string): string {
    const url = new URL($url);
    if (url.host) {
        return url.host;
    } else if (url.protocol === 'file:') {
        return url.pathname;
    }
    return url.protocol;
}

export function compareURLPatterns(a: string, b: string): number {
    return a.localeCompare(b);
}

/**
 * Determines whether URL has a match in URL template list.
 * @param url Site URL.
 * @paramlist List to search into.
 */
export function isURLInList(url: string, list: string[]): boolean {
    for (let i = 0; i < list.length; i++) {
        if (isURLMatched(url, list[i])) {
            return true;
        }
    }
    return false;
}

/**
 * Determines whether URL matches the template.
 * @param url URL.
 * @param urlTemplate URL template ("google.*", "youtube.com" etc).
 */
export function isURLMatched(url: string, urlTemplate: string): boolean {
    if (isRegExp(urlTemplate)) {
        const regexp = createRegExp(urlTemplate);
        return regexp ? regexp.test(url) : false;
    }
    return matchURLPattern(url, urlTemplate);
}

const URL_CACHE_SIZE = 32;
const prepareURL = cachedFactory((url: string) => {
    let parsed: URL;
    try {
        parsed = new URL(url);
    } catch (err) {
        return null;
    }
    const {hostname, pathname, protocol, port} = parsed;
    const hostParts = hostname.split('.').reverse();
    const pathParts = pathname.split('/').slice(1);
    if (!pathParts[pathParts.length - 1]) {
        pathParts.splice(pathParts.length - 1, 1);
    }
    return {
        hostParts,
        pathParts,
        port,
        protocol,
    };
}, URL_CACHE_SIZE);

const URL_MATCH_CACHE_SIZE = 32 * 1024;
const preparePattern = cachedFactory((pattern: string) => {
    if (!pattern) {
        return null;
    }

    const exactStart = pattern.startsWith('^');
    const exactEnd = pattern.endsWith('$');
    if (exactStart) {
        pattern = pattern.substring(1);
    }
    if (exactEnd) {
        pattern = pattern.substring(0, pattern.length - 1);
    }

    let protocol = '';
    const protocolIndex = pattern.indexOf('://');
    if (protocolIndex > 0) {
        protocol = pattern.substring(0, protocolIndex + 1);
        pattern = pattern.substring(protocolIndex + 3);
    }

    const slashIndex = pattern.indexOf('/');
    const host = slashIndex < 0 ? pattern : pattern.substring(0, slashIndex);

    let hostName = host;

    let isIPv6 = false;
    let ipV6End = -1;
    if (host.startsWith('[')) {
        ipV6End = host.indexOf(']');
        if (ipV6End > 0) {
            isIPv6 = true;
        }
    }

    let port = '*';
    const portIndex = host.lastIndexOf(':');
    if (portIndex >= 0 && (!isIPv6 || ipV6End < portIndex)) {
        hostName = host.substring(0, portIndex);
        port = host.substring(portIndex + 1);
    }

    if (isIPv6) {
        try {
            const ipV6URL = new URL(`http://${hostName}`);
            hostName = ipV6URL.hostname;
        } catch (err) {
        }
    }

    const hostParts = hostName.split('.').reverse();

    const path = slashIndex < 0 ? '' : pattern.substring(slashIndex + 1);
    const pathParts = path.split('/');
    if (!pathParts[pathParts.length - 1]) {
        pathParts.splice(pathParts.length - 1, 1);
    }

    return {
        hostParts,
        pathParts,
        port,
        exactStart,
        exactEnd,
        protocol,
    };
}, URL_MATCH_CACHE_SIZE);

function matchURLPattern(url: string, pattern: string) {
    const u = prepareURL(url);
    const p = preparePattern(pattern);

    if (
        !(u && p)
        || (p.hostParts.length > u.hostParts.length)
        || (p.exactStart && p.hostParts.length !== u.hostParts.length)
        || (p.exactEnd && p.pathParts.length !== u.pathParts.length)
        || (p.port !== '*' && p.port !== u.port)
        || (p.protocol && p.protocol !== u.protocol)
    ) {
        return false;
    }

    for (let i = 0; i < p.hostParts.length; i++) {
        const pHostPart = p.hostParts[i];
        const uHostPart = u.hostParts[i];
        if (pHostPart !== '*' && pHostPart !== uHostPart) {
            return false;
        }
    }

    if (
        p.hostParts.length >= 2
        && p.hostParts.at(-1) !== '*'
        && (
            p.hostParts.length < u.hostParts.length - 1
            || (
                p.hostParts.length === u.hostParts.length - 1
                && u.hostParts.at(-1) !== 'www'
            )
        )
    ) {
        return false;
    }

    if (p.pathParts.length === 0) {
        return true;
    }

    if (p.pathParts.length > u.pathParts.length) {
        return false;
    }

    for (let i = 0; i < p.pathParts.length; i++) {
        const pPathPart = p.pathParts[i];
        const uPathPart = u.pathParts[i];
        if (pPathPart !== '*' && pPathPart !== uPathPart) {
            return false;
        }
    }

    return true;
}

function isRegExp(pattern: string) {
    return pattern.startsWith('/') && pattern.endsWith('/') && pattern.length > 2;
}

const REGEXP_CACHE_SIZE = 1024;
const createRegExp = cachedFactory((pattern: string) => {
    if (pattern.startsWith('/')) {
        pattern = pattern.substring(1);
    }
    if (pattern.endsWith('/')) {
        pattern = pattern.substring(0, pattern.length - 1);
    }
    try {
        return new RegExp(pattern);
    } catch (err) {
        return null;
    }
}, REGEXP_CACHE_SIZE);

export function isPDF(url: string): boolean {
    try {
        const {hostname, pathname} = new URL(url);
        if (pathname.includes('.pdf')) {
            if (
                (hostname.match(/(wikipedia|wikimedia)\.org$/i) && pathname.match(/^\/.*\/[a-z]+\:[^\:\/]+\.pdf/i)) ||
                (hostname.match(/timetravel\.mementoweb\.org$/i) && pathname.match(/^\/reconstruct/i) && pathname.match(/\.pdf$/i)) ||
                (hostname.match(/dropbox\.com$/i) && pathname.match(/^\/s\//i) && pathname.match(/\.pdf$/i))
            ) {
                return false;
            }
            if (pathname.endsWith('.pdf')) {
                for (let i = pathname.length; i >= 0; i--) {
                    if (pathname[i] === '=') {
                        return false;
                    } else if (pathname[i] === '/') {
                        return true;
                    }
                }
            } else {
                return false;
            }
        }
    } catch (e) {
        // Do nothing
    }
    return false;
}

export function isURLEnabled(url: string, userSettings: UserSettings, {isProtected, isInDarkList, isDarkThemeDetected}: Partial<TabInfo>, isAllowedFileSchemeAccess = true): boolean {
    if (isLocalFile(url) && !isAllowedFileSchemeAccess) {
        return false;
    }
    if (isProtected && !userSettings.enableForProtectedPages) {
        return false;
    }
    if (isPDF(url)) {
        return userSettings.enableForPDF;
    }
    const isURLInDisabledList = isURLInList(url, userSettings.disabledFor);
    const isURLInEnabledList = isURLInList(url, userSettings.enabledFor);

    if (!userSettings.enabledByDefault) {
        return isURLInEnabledList;
    }
    if (isURLInEnabledList) {
        return true;
    }
    if (isInDarkList || (userSettings.detectDarkTheme && isDarkThemeDetected)) {
        return false;
    }
    return !isURLInDisabledList;
}

export function isFullyQualifiedDomain(candidate: string): boolean {
    return /^[a-z0-9\.\-]+$/i.test(candidate) && candidate.indexOf('..') === -1;
}

export function isFullyQualifiedDomainWildcard(candidate: string): boolean {
    if (!candidate.includes('*') || !/^[a-z0-9\.\-\*]+$/i.test(candidate)) {
        return false;
    }
    const labels = candidate.split('.');
    for (const label of labels) {
        if (label !== '*' && !/^[a-z0-9\-]+$/i.test(label)) {
            return false;
        }
    }
    return true;
}

export function fullyQualifiedDomainMatchesWildcard(wildcard: string, candidate: string): boolean {
    const wildcardLabels = wildcard.toLowerCase().split('.');
    const candidateLabels = candidate.toLowerCase().split('.');
    if (candidateLabels.length < wildcardLabels.length) {
        return false;
    }
    while (wildcardLabels.length) {
        const wildcardLabel = wildcardLabels.pop();
        const candidateLabel = candidateLabels.pop();
        if (wildcardLabel !== '*' && wildcardLabel !== candidateLabel) {
            return false;
        }
    }
    return true;
}

export function isLocalFile(url: string): boolean {
    return Boolean(url) && url.startsWith('file:///');
}

```

### utils\time.ts

```
export function parseTime($time: string): [number, number] {
    const parts = $time.split(':').slice(0, 2);
    const lowercased = $time.trim().toLowerCase();
    const isAM = lowercased.endsWith('am') || lowercased.endsWith('a.m.');
    const isPM = lowercased.endsWith('pm') || lowercased.endsWith('p.m.');

    let hours = parts.length > 0 ? parseInt(parts[0]) : 0;
    if (isNaN(hours) || hours > 23) {
        hours = 0;
    }
    if (isAM && hours === 12) {
        hours = 0;
    }
    if (isPM && hours < 12) {
        hours += 12;
    }

    let minutes = parts.length > 1 ? parseInt(parts[1]) : 0;
    if (isNaN(minutes) || minutes > 59) {
        minutes = 0;
    }

    return [hours, minutes];
}

function parse24HTime(time: string): number[] {
    return time.split(':').map((x) => parseInt(x));
}

function compareTime(time1: number[], time2: number[]): -1 | 0 | 1 {
    if (time1[0] === time2[0] && time1[1] === time2[1]) {
        return 0;
    }
    if (time1[0] < time2[0] || (time1[0] === time2[0] && time1[1] < time2[1])) {
        return -1;
    }
    return 1;
}

export function nextTimeInterval(time0: string, time1: string, date: Date = new Date()): number | null {
    const a = parse24HTime(time0);
    const b = parse24HTime(time1);
    const t = [date.getHours(), date.getMinutes()];

    // Ensure a <= b
    if (compareTime(a, b) > 0) {
        return nextTimeInterval(time1, time0, date);
    }

    if (compareTime(a, b) === 0) {
        return null;
    }

    if (compareTime(t, a) < 0) {
        // t < a <= b
        // Schedule for todate at time a
        date.setHours(a[0]);
        date.setMinutes(a[1]);
        date.setSeconds(0);
        date.setMilliseconds(0);
        return date.getTime();
    }

    if (compareTime(t, b) < 0) {
        // a <= t < b
        // Schedule for today at time b
        date.setHours(b[0]);
        date.setMinutes(b[1]);
        date.setSeconds(0);
        date.setMilliseconds(0);
        return date.getTime();
    }

    // a <= b <= t
    // Schedule for tomorrow at time a
    return (new Date(date.getFullYear(), date.getMonth(), date.getDate() + 1, a[0], a[1])).getTime();
}

export function isInTimeIntervalLocal(time0: string, time1: string, date: Date = new Date()): boolean {
    const a = parse24HTime(time0);
    const b = parse24HTime(time1);
    const t = [date.getHours(), date.getMinutes()];
    if (compareTime(a, b) > 0) {
        return compareTime(a, t) <= 0 || compareTime(t, b) < 0;
    }
    return compareTime(a, t) <= 0 && compareTime(t, b) < 0;
}

function isInTimeIntervalUTC(time0: number, time1: number, timestamp: number): boolean {
    if (time1 < time0) {
        return timestamp <= time1 || time0 <= timestamp;
    }
    return time0 < timestamp && timestamp < time1;
}

interface Duration {
    days?: number;
    hours?: number;
    minutes?: number;
    seconds?: number;
}

export function getDuration(time: Duration): number {
    let duration = 0;
    if (time.seconds) {
        duration += time.seconds * 1000;
    }
    if (time.minutes) {
        duration += time.minutes * 60 * 1000;
    }
    if (time.hours) {
        duration += time.hours * 60 * 60 * 1000;
    }
    if (time.days) {
        duration += time.days * 24 * 60 * 60 * 1000;
    }
    return duration;
}

export function getDurationInMinutes(time: Duration): number {
    return getDuration(time) / 1000 / 60;
}

function getSunsetSunriseUTCTime(
    latitude: number,
    longitude: number,
    date: Date,
) {
    const dec31 = Date.UTC(date.getUTCFullYear(), 0, 0, 0, 0, 0, 0);
    const oneDay = getDuration({days: 1});
    const dayOfYear = Math.floor((date.getTime() - dec31) / oneDay);

    const zenith = 90.83333333333333;
    const D2R = Math.PI / 180;
    const R2D = 180 / Math.PI;

    // convert the longitude to hour value and calculate an approximate time
    const lnHour = longitude / 15;

    function getTime(isSunrise: boolean) {
        const t = dayOfYear + (((isSunrise ? 6 : 18) - lnHour) / 24);

        // calculate the Sun's mean anomaly
        const M = (0.9856 * t) - 3.289;

        // calculate the Sun's true longitude
        let L = M + (1.916 * Math.sin(M * D2R)) + (0.020 * Math.sin(2 * M * D2R)) + 282.634;
        if (L > 360) {
            L -= 360;
        } else if (L < 0) {
            L += 360;
        }

        // calculate the Sun's right ascension
        let RA = R2D * Math.atan(0.91764 * Math.tan(L * D2R));
        if (RA > 360) {
            RA -= 360;
        } else if (RA < 0) {
            RA += 360;
        }

        // right ascension value needs to be in the same qua
        const Lquadrant = (Math.floor(L / (90))) * 90;
        const RAquadrant = (Math.floor(RA / 90)) * 90;
        RA += (Lquadrant - RAquadrant);

        // right ascension value needs to be converted into hours
        RA /= 15;

        // calculate the Sun's declination
        const sinDec = 0.39782 * Math.sin(L * D2R);
        const cosDec = Math.cos(Math.asin(sinDec));

        // calculate the Sun's local hour angle
        const cosH = (Math.cos(zenith * D2R) - (sinDec * Math.sin(latitude * D2R))) / (cosDec * Math.cos(latitude * D2R));
        if (cosH > 1) {
            // always night
            return {
                alwaysDay: false,
                alwaysNight: true,
                time: 0,
            };
        } else if (cosH < -1) {
            // always day
            return {
                alwaysDay: true,
                alwaysNight: false,
                time: 0,
            };
        }

        const H = (isSunrise ? (360 - R2D * Math.acos(cosH)) : (R2D * Math.acos(cosH))) / 15;

        // calculate local mean time of rising/setting
        const T = H + RA - (0.06571 * t) - 6.622;

        // adjust back to UTC
        let UT = T - lnHour;
        if (UT > 24) {
            UT -= 24;
        } else if (UT < 0) {
            UT += 24;
        }

        // convert to milliseconds
        return {
            alwaysDay: false,
            alwaysNight: false,
            time: Math.round(UT * getDuration({hours: 1})),
        };
    }

    const sunriseTime = getTime(true);
    const sunsetTime = getTime(false);

    if (sunriseTime.alwaysDay || sunsetTime.alwaysDay) {
        return {
            alwaysDay: true,
            alwaysNight: false,
            sunriseTime: 0,
            sunsetTime: 0,
        };
    } else if (sunriseTime.alwaysNight || sunsetTime.alwaysNight) {
        return {
            alwaysDay: false,
            alwaysNight: true,
            sunriseTime: 0,
            sunsetTime: 0,
        };
    }

    return {
        alwaysDay: false,
        alwaysNight: false,
        sunriseTime: sunriseTime.time,
        sunsetTime: sunsetTime.time,
    };
}

export function isNightAtLocation(
    latitude: number,
    longitude: number,
    date: Date = new Date(),
): boolean {
    const time = getSunsetSunriseUTCTime(latitude, longitude, date);

    if (time.alwaysDay) {
        return false;
    } else if (time.alwaysNight) {
        return true;
    }

    const sunriseTime = time.sunriseTime;
    const sunsetTime = time.sunsetTime;
    const currentTime = (
        date.getUTCHours() * getDuration({hours: 1}) +
        date.getUTCMinutes() * getDuration({minutes: 1}) +
        date.getUTCSeconds() * getDuration({seconds: 1}) +
        date.getUTCMilliseconds()
    );

    return isInTimeIntervalUTC(sunsetTime, sunriseTime, currentTime);
}

export function nextTimeChangeAtLocation(
    latitude: number,
    longitude: number,
    date: Date = new Date(),
): number {
    const time = getSunsetSunriseUTCTime(latitude, longitude, date);

    if (time.alwaysDay) {
        return date.getTime() + getDuration({days: 1});
    } else if (time.alwaysNight) {
        return date.getTime() + getDuration({days: 1});
    }

    const [firstTimeOnDay, lastTimeOnDay] = time.sunriseTime < time.sunsetTime ? [time.sunriseTime, time.sunsetTime] : [time.sunsetTime, time.sunriseTime];
    const currentTime = (
        date.getUTCHours() * getDuration({hours: 1}) +
        date.getUTCMinutes() * getDuration({minutes: 1}) +
        date.getUTCSeconds() * getDuration({seconds: 1}) +
        date.getUTCMilliseconds()
    );

    if (currentTime <= firstTimeOnDay!) {
        // Timeline:
        // --- firstTimeOnDay <---> lastTimeOnDay ---
        //  ^
        // Current time
        return Date.UTC(date.getUTCFullYear(), date.getUTCMonth(), date.getUTCDate(), 0, 0, 0, firstTimeOnDay);
    }
    if (currentTime <= lastTimeOnDay!) {
        // Timeline:
        // --- firstTimeOnDay <---> lastTimeOnDay ---
        //                      ^
        //                 Current time
        return Date.UTC(date.getUTCFullYear(), date.getUTCMonth(), date.getUTCDate(), 0, 0, 0, lastTimeOnDay);
    }
    // Timeline:
    // --- firstTimeOnDay <---> lastTimeOnDay ---
    //                                         ^
    //                                    Current time
    return Date.UTC(date.getUTCFullYear(), date.getUTCMonth(), date.getUTCDate() + 1, 0, 0, 0, firstTimeOnDay);
}

```

### utils\throttle.ts

```
export function throttle<T extends(...args: any[]) => any>(callback: T): T & {cancel: () => void} {
    let pending = false;
    let frameId: number | null = null;
    let lastArgs: any[];

    const throttled: T = ((...args: any[]) => {
        lastArgs = args;
        if (frameId) {
            pending = true;
        } else {
            callback(...lastArgs);
            frameId = requestAnimationFrame(() => {
                frameId = null;
                if (pending) {
                    callback(...lastArgs);
                    pending = false;
                }
            });
        }
    }) as any;

    const cancel = () => {
        // TODO: resolve cast once types are updated
        cancelAnimationFrame(frameId!);
        pending = false;
        frameId = null;
    };

    return Object.assign(throttled, {cancel});
}

type Task = () => void;

declare const __TEST__: boolean;

interface AsyncTaskQueue {
    add: (task: Task) => void;
    cancel: () => void;
}

export function createAsyncTasksQueue(): AsyncTaskQueue {
    const tasks: Task[] = [];
    let frameId: number | null = null;

    function runTasks() {
        let task: Task | undefined;
        while ((task = tasks.shift())) {
            task();
        }
        frameId = null;
        if (__TEST__) {
            document.dispatchEvent(new CustomEvent('__darkreader__test__asyncQueueComplete'));
        }
    }

    function add(task: Task) {
        tasks.push(task);
        if (!frameId) {
            frameId = requestAnimationFrame(runTasks);
        }
    }

    function cancel() {
        tasks.splice(0);
        // TODO: resolve cast once types are updated
        cancelAnimationFrame(frameId!);
        frameId = null;
    }

    return {add, cancel};
}

const delayTokens = new Set<symbol>;

export function requestAnimationFrameOnce(token: symbol, callback: () => void): void {
    if (delayTokens.has(token)) {
        return;
    }
    delayTokens.add(token);
    requestAnimationFrame(() => {
        delayTokens.delete(token);
        callback();
    });
}

```

### utils\tabs.ts

```
declare const __TEST__: boolean;
declare const __DEBUG__: boolean;

// Promissified version of chrome.tabs.query
export async function queryTabs(query: chrome.tabs.QueryInfo = {}): Promise<chrome.tabs.Tab[]> {
    return new Promise<chrome.tabs.Tab[]>((resolve) => chrome.tabs.query(query, resolve));
}

/**
 * Attempts to find the current active tab
 * Despite all efforts, sometimes active tab may not be determined so we explicitly return nullable value,
 * and handle this case in callers explicitly
 */
export async function getActiveTab(): Promise<chrome.tabs.Tab | null> {
    let log: string | null = null;
    let tab = (await queryTabs({
        active: true,
        lastFocusedWindow: true,
        // Explicitly exclude Dark Reader's Dev Tools and other special windows from the query
        windowType: 'normal',
    }))[0];
    if (!tab) {
        tab = (await queryTabs({
            active: true,
            lastFocusedWindow: true,
            windowType: 'app',
        }))[0];
    }
    if (!tab) {
        if (__DEBUG__ || __TEST__) {
            log = 'method 1';
        }
        // When Dark Reader's DevTools are open, last focused window might be the DevTools window
        // so we lift this restriction and try again (with the best guess)
        tab = (await queryTabs({
            active: true,
            windowType: 'normal',
        }))[0];
    }
    if (!tab) {
        if (__DEBUG__ || __TEST__) {
            log = 'method 2';
        }
        tab = (await queryTabs({
            active: true,
            windowType: 'app',
        }))[0];
    }
    if (log) {
        console.warn(`TabManager.getActiveTab() could not reliably find the active tab, picking the best guess ${log}`, tab);
    }
    // In rare cases tab can be null, despite what TypeScript says
    return tab || null;
}

export async function getActiveTabURL(): Promise<string | null> {
    const tab = await getActiveTab();
    return tab && tab.url || null;
}

```

### utils\text.ts

```
export interface TextRange {
    start: number;
    end: number;
}

export function getTextPositionMessage(text: string, index: number): string {
    if (!isFinite(index)) {
        throw new Error(`Wrong char index ${index}`);
    }
    let message = '';
    let line = 0;
    let prevLn: number;
    let nextLn = 0;
    do {
        line++;
        prevLn = nextLn;
        nextLn = text.indexOf('\n', prevLn + 1);
    } while (nextLn >= 0 && nextLn <= index);
    const column = index - prevLn;
    message += `line ${line}, column ${column}`;
    message += '\n';
    if (index < text.length) {
        message += text.substring(prevLn + 1, nextLn);
    } else {
        message += text.substring(text.lastIndexOf('\n') + 1);
    }
    message += '\n';
    message += `${new Array(column).join('-')}^`;
    return message;
}

export function getTextDiffIndex(a: string, b: string): number {
    const short = Math.min(a.length, b.length);
    for (let i = 0; i < short; i++) {
        if (a[i] !== b[i]) {
            return i;
        }
    }
    if (a.length !== b.length) {
        return short;
    }
    return -1;
}

export function parseArray(text: string): string[] {
    return text.replace(/\r/g, '')
        .split('\n')
        .map((s) => s.trim())
        .filter((s) => s);
}

export function formatArray(arr: readonly string[]): string {
    return arr.concat('').join('\n');
}

export function getMatches(regex: RegExp, input: string, group = 0): string[] {
    const matches: string[] = [];
    let m: RegExpMatchArray | null;
    while ((m = regex.exec(input))) {
        matches.push(m[group]);
    }
    return matches;
}

export function getMatchesWithOffsets(regex: RegExp, input: string, group = 0): Array<{text: string; offset: number}> {
    const matches: Array<{text: string; offset: number}> = [];
    let m: RegExpMatchArray | null;
    while ((m = regex.exec(input))) {
        matches.push({text: m[group], offset: m.index!});
    }
    return matches;
}

export function getStringSize(value: string): number {
    return value.length * 2;
}

export function getHashCode(text: string): number {
    const len = text.length;
    let hash = 0;
    for (let i = 0; i < len; i++) {
        const c = text.charCodeAt(i);
        hash = ((hash << 5) - hash + c) & 4294967295;
    }
    return hash;
}

export function escapeRegExpSpecialChars(input: string): string {
    return input.replaceAll(/[\^$.*+?\(\)\[\]{}|\-\\]/g, '\\$&');
}

export function getParenthesesRange(input: string, searchStartIndex = 0): TextRange | null {
    return getOpenCloseRange(input, searchStartIndex, '(', ')', []);
}

export function getOpenCloseRange(
    input: string,
    searchStartIndex: number,
    openToken: string,
    closeToken: string,
    excludeRanges: TextRange[],
): TextRange | null {
    let indexOf: (token: string, pos: number) => number;
    if (excludeRanges.length === 0) {
        indexOf = (token: string, pos: number) => input.indexOf(token, pos);
    } else {
        indexOf = (token: string, pos: number) => indexOfExcluding(input, token, pos, excludeRanges);
    }

    const {length} = input;
    let depth = 0;
    let firstOpenIndex = -1;
    for (let i = searchStartIndex; i < length; i++) {
        if (depth === 0) {
            const openIndex = indexOf(openToken, i);
            if (openIndex < 0) {
                break;
            }
            firstOpenIndex = openIndex;
            depth++;
            i = openIndex;
        } else {
            const closeIndex = indexOf(closeToken, i);
            if (closeIndex < 0) {
                break;
            }
            const openIndex = indexOf(openToken, i);
            if (openIndex < 0 || closeIndex <= openIndex) {
                depth--;
                if (depth === 0) {
                    return {start: firstOpenIndex, end: closeIndex + 1};
                }
                i = closeIndex;
            } else {
                depth++;
                i = openIndex;
            }
        }
    }
    return null;
}

function indexOfExcluding(input: string, search: string, position: number, excludeRanges: TextRange[]) {
    const i = input.indexOf(search, position);
    const exclusion = excludeRanges.find((r) => i >= r.start && i < r.end);
    if (exclusion) {
        return indexOfExcluding(input, search, exclusion.end, excludeRanges);
    }
    return i;
}

export function splitExcluding(input: string, separator: string, excludeRanges: TextRange[]): string[] {
    const parts: string[] = [];
    let commaIndex = -1;
    let currIndex = 0;
    while ((commaIndex = indexOfExcluding(input, separator, currIndex, excludeRanges)) >= 0) {
        parts.push(input.substring(currIndex, commaIndex).trim());
        currIndex = commaIndex + 1;
    }
    parts.push(input.substring(currIndex).trim());
    return parts;
}

```

### utils\state-manager.ts

```
/**
 * This class exists only to simplify Jest testing of the real implementation
 * which is in StateManagerImpl class.
 */

import {isNonPersistent} from './platform';
import {StateManagerImpl} from './state-manager-impl';


export class StateManager<T extends Record<string, unknown>> {
    private stateManager: StateManagerImpl<T> | null;

    constructor(localStorageKey: string, parent: any, defaults: T, logWarn: (log: string) => void){
        if (isNonPersistent) {
            function addListener(listener: (data: T) => void) {
                chrome.storage.local.onChanged.addListener((changes) => {
                    if (localStorageKey in changes) {
                        listener(changes[localStorageKey].newValue);
                    }
                });
            }

            this.stateManager = new StateManagerImpl(
                localStorageKey,
                parent,
                defaults,
                chrome.storage.local,
                addListener,
                logWarn,
            );
        }
    }

    async saveState(): Promise<void> {
        if (this.stateManager) {
            return this.stateManager.saveState();
        }
    }

    async loadState(): Promise<void> {
        if (this.stateManager) {
            return this.stateManager.loadState();
        }
    }
}

```

### utils\state-manager-impl.ts

```
import {PromiseBarrier} from './promise-barrier';

/*
 * This class synchronizes some JS object's attributes and data stored in
 * chrome.storage.local, with minimal delay. It follows these principles:
 *  - no debouncing, data is saved as soon as saveState() is called
 *  - no concurrent writes (calls to s.c.l.set()): if saveState() is called
 *    repeatedly before previous call is complete, this class will wait for
 *    active write to complete and will save new data.
 *  - no concurrent reads (calls to s.c.l.get()): if loadState() is called
 *    repeatedly before previous call is complete, this class will wait for
 *    active read to complete and will resolve all loadState() calls at once.
 *  - all simultaneously active calls to saveState() and loadState() wait for
 *    data to settle and resolve only after data is guaranteed to be coherent.
 *  - data saved with the browser always wins (because JS typically has only
 *    default values and to ensure that if the same class exists in multiple
 *    contexts every instance of this class has the same values)
 * In practice, these principles imply that at any given moment there is either
 * no active read and write operations or this class is performing exactly one
 * read or exactly one write operation.
 *
 * State manager is a state machine which works as follows:
 *       +-----------+
 *       |  Initial  |
 *       +-----------+
 *              |
 *              | StateManagerImpl.loadState() is called,
 *              | StateManagerImpl will call chrome.storage.local.get()
 *              |
 *              v
 *       +------------+
 * +-----|  Loading R |
 * |     +------------+
 * |            |
 * |            | chrome.storage.local.get() callback is called,
 * | [1]        | StateManagerImpl has loaded the data.
 * |            |
 * |            v
 * |      +----------+<-------------------------------------------+
 * |      |  Ready   |                                            |
 * |      +----------+<-------------------------------------+     |
 * |            |                                           |     |
 * |            | StateManagerImpl.saveState() is called,   |     |
 * |            | StateManagerImpl will callect data and    |     |
 * |            | call chrome.storage.local.set()           |     |
 * |            v                                           |     |
 * |     +-----------+--------------------------------------+     |
 * |  +--|  Saving W |                                            |
 * |  |  +-----------+<-------------------------------------+     |
 * |  |         |                                           |     |
 * |  |         | StateManagerImpl.saveState() is called    |     |
 * |  |         | before ongoing write operation ends.      |     |
 * |  |         |                                           |     |
 * |  |         v                                           |     |
 * |  |  +-------------------+                              |     |
 * |  |  | Saving Override W |------------------------------+     |
 * |  |  +-------------------+                                    |
 * |  |         |                                                 |
 * |  |         |     onChange handler is called during an active |
 * |  | [1]     | [1] read/write operation                        |
 * |  |         |                                                 |
 * |  |         v                                                 |
 * |  +->+-------------------+       +------------+               |
 * |     | OnChange Race R/W |------>| Recovery R |---------------+
 * +---->+-------------------+       +------------+
 *                 ^                       |
 *                 +---------------------- +
 *                             [1]
 *
 * R and W indicate active read (get) and write (set) operations.
 *
 * Initial - Only constructor was called.
 * Loading - loadState() is called
 * Ready - data was retreived from storage.
 * Saving - saveState() is called and there is no chrome.storage.local.set()
 *   operation in progress. We just need to collect and save the data.
 * Saving Override - saveState() is called before the last write operation
 *   was complete (data became obsolete even before it was written to storage).
 *   We wait for ongoing write operation to end and only then start a new one.
 * OnChange Race - chrome.storage.onChanged listener was called during an active
 *   read/write operation. StateManager needs to wait for that operation to end
 *   and re-request data again.
 * Recovery - state manager detected a race condition, probably caused by an
 *   onChanged event during data loading or saving. State Manager will load data
 *   from browser to ensure data coherence.
 */

declare const __TEST__: boolean;

enum StateManagerImplState {
    INITIAL = 0,
    LOADING = 1,
    READY = 2,
    SAVING = 3,
    SAVING_OVERRIDE = 4,
    ONCHANGE_RACE = 5,
    RECOVERY = 6
}

export class StateManagerImpl<T extends Record<string, unknown>> {
    private localStorageKey: string;
    private parent;
    private defaults: T;
    private logWarn: (log: string) => void;

    private meta: StateManagerImplState;
    private barrier: PromiseBarrier<void, void> | null = null;

    private storage: {
        get: (storageKey: string, callback: (items: { [key: string]: any }) => void) => void;
        set: (items: { [key: string]: any }, callback: () => void) => void;
    };

    private listeners: Set<() => void>;

    constructor(localStorageKey: string, parent: any, defaults: T, storage: {get: (storageKey: string, callback: (items: { [key: string]: any }) => void) => void; set: (items: { [key: string]: any }, callback: () => void) => void}, addListener: (listener: (data: T) => void) => void, logWarn: (log: string) => void){
        this.localStorageKey = localStorageKey;
        this.parent = parent;
        this.defaults = defaults;
        this.storage = storage;
        addListener((change) => this.onChange(change));
        this.logWarn = logWarn;

        this.meta = StateManagerImplState.INITIAL;
        this.barrier = new PromiseBarrier();
        this.listeners = new Set();

        // TODO(Anton): consider calling this.loadState() to preload data,
        // and remove StateManagerImplState.INITIAL.
    }

    private collectState() {
        const state = {} as T;
        for (const key of Object.keys(this.defaults) as Array<keyof T>) {
            state[key] = this.parent[key] || this.defaults[key];
        }
        return state;
    }

    private applyState(storage: T) {
        Object.assign(this.parent, this.defaults, storage);
    }

    private releaseBarrier() {
        const barrier = this.barrier;
        this.barrier = new PromiseBarrier();
        barrier!.resolve();
    }

    private notifyListeners() {
        this.listeners.forEach((listener) => listener());
    }

    private onChange(state: T) {
        switch (this.meta) {
            case StateManagerImplState.INITIAL:
                this.meta = StateManagerImplState.READY;
                // fallthrough
            case StateManagerImplState.READY:
                this.applyState(state);
                this.notifyListeners();
                return;
            case StateManagerImplState.LOADING:
                this.meta = StateManagerImplState.ONCHANGE_RACE;
                return;
            case StateManagerImplState.SAVING:
                this.meta = StateManagerImplState.ONCHANGE_RACE;
                return;
            case StateManagerImplState.SAVING_OVERRIDE:
                this.meta = StateManagerImplState.ONCHANGE_RACE;
                break;
            case StateManagerImplState.ONCHANGE_RACE:
                // We are already waiting for an active read/write operation to end
                break;
            case StateManagerImplState.RECOVERY:
                this.meta = StateManagerImplState.ONCHANGE_RACE;
                break;
        }
    }

    private saveStateInternal() {
        this.storage.set({[this.localStorageKey]: this.collectState()}, () => {
            switch (this.meta) {
                case StateManagerImplState.INITIAL:
                    // fallthrough
                case StateManagerImplState.LOADING:
                    // fallthrough
                case StateManagerImplState.READY:
                    // fallthrough
                case StateManagerImplState.RECOVERY:
                    this.logWarn('Unexpected state. Possible data race!');
                    this.meta = StateManagerImplState.ONCHANGE_RACE;
                    this.loadStateInternal();
                    return;
                case StateManagerImplState.SAVING:
                    this.meta = StateManagerImplState.READY;
                    this.releaseBarrier();
                    return;
                case StateManagerImplState.SAVING_OVERRIDE:
                    this.meta = StateManagerImplState.SAVING;
                    this.saveStateInternal();
                    return;
                case StateManagerImplState.ONCHANGE_RACE:
                    this.meta = StateManagerImplState.RECOVERY;
                    this.loadStateInternal();
            }
        });
    }

    // This function is not guaranteed to save state before returning
    async saveState(): Promise<void> {
        switch (this.meta) {
            case StateManagerImplState.INITIAL:
                // Make sure not to overwrite data before it is loaded
                this.logWarn('StateManager.saveState was called before StateManager.loadState(). Possible data race! Loading data instead.');
                return this.loadState();
            case StateManagerImplState.LOADING:
                // Need to wait for active read operation to end
                this.logWarn('StateManager.saveState was called before StateManager.loadState() resolved. Possible data race! Loading data instead.');
                return this.barrier!.entry();
            case StateManagerImplState.READY: {
                this.meta = StateManagerImplState.SAVING;
                const entry = this.barrier!.entry();
                this.saveStateInternal();
                return entry;
            }
            case StateManagerImplState.SAVING:
                // Another save is in progress
                this.meta = StateManagerImplState.SAVING_OVERRIDE;
                return this.barrier!.entry();
            case StateManagerImplState.SAVING_OVERRIDE:
                return this.barrier!.entry();
            case StateManagerImplState.ONCHANGE_RACE:
                this.logWarn('StateManager.saveState was called during active read/write operation. Possible data race! Loading data instead.');
                return this.barrier!.entry();
            case StateManagerImplState.RECOVERY:
                this.logWarn('StateManager.saveState was called during active read operation. Possible data race! Waiting for data load instead.');
                return this.barrier!.entry();
        }
    }

    private loadStateInternal() {
        this.storage.get(this.localStorageKey, (data: any) => {
            switch (this.meta) {
                case StateManagerImplState.INITIAL:
                case StateManagerImplState.READY:
                case StateManagerImplState.SAVING:
                case StateManagerImplState.SAVING_OVERRIDE:
                    this.logWarn('Unexpected state. Possible data race!');
                    return;
                case StateManagerImplState.LOADING:
                    this.meta = StateManagerImplState.READY;
                    this.applyState(data[this.localStorageKey]);
                    this.releaseBarrier();
                    return;
                case StateManagerImplState.ONCHANGE_RACE:
                    this.meta = StateManagerImplState.RECOVERY;
                    this.loadStateInternal();
                // eslint-disable-next-line no-fallthrough
                case StateManagerImplState.RECOVERY:
                    this.meta = StateManagerImplState.READY;
                    this.applyState(data[this.localStorageKey]);
                    this.releaseBarrier();
                    this.notifyListeners();
            }
        });
    }

    async loadState(): Promise<void> {
        switch (this.meta) {
            case StateManagerImplState.INITIAL: {
                this.meta = StateManagerImplState.LOADING;
                const entry = this.barrier!.entry();
                this.loadStateInternal();
                return entry;
            }
            case StateManagerImplState.READY:
                return;
            case StateManagerImplState.SAVING:
                return this.barrier!.entry();
            case StateManagerImplState.SAVING_OVERRIDE:
                return this.barrier!.entry();
            case StateManagerImplState.LOADING:
                return this.barrier!.entry();
            case StateManagerImplState.ONCHANGE_RACE:
                return this.barrier!.entry();
            case StateManagerImplState.RECOVERY:
                return this.barrier!.entry();
        }
    }

    addChangeListener(callback: () => void): void {
        this.listeners.add(callback);
    }

    getStateForTesting(): string {
        if (!__TEST__) {
            return '';
        }
        switch (this.meta) {
            case StateManagerImplState.INITIAL:
                return 'Initial';
            case StateManagerImplState.LOADING:
                return 'Loading';
            case StateManagerImplState.READY:
                return 'Ready';
            case StateManagerImplState.SAVING:
                return 'Saving';
            case StateManagerImplState.SAVING_OVERRIDE:
                return 'Saving Override';
            case StateManagerImplState.ONCHANGE_RACE:
                return 'Onchange Race';
            case StateManagerImplState.RECOVERY:
                return 'Recovery';
        }
    }
}

```

### utils\promise-barrier.ts

```
export class PromiseBarrier<RESOLVUTION, REJECTION> {
    private resolves: Array<(value: RESOLVUTION) => void> = [];
    private rejects: Array<(reason: REJECTION) => void> = [];
    private wasResolved = false;
    private wasRejected = false;
    private resolution: RESOLVUTION;
    private reason: REJECTION;

    async entry(): Promise<RESOLVUTION>{
        if (this.wasResolved) {
            return Promise.resolve(this.resolution);
        }
        if (this.wasRejected) {
            return Promise.reject(this.reason);
        }
        return new Promise((resolve, reject) => {
            this.resolves.push(resolve);
            this.rejects.push(reject);
        });
    }

    async resolve(value: RESOLVUTION): Promise<void> {
        if (this.wasRejected || this.wasResolved) {
            return;
        }
        this.wasResolved = true;
        this.resolution = value;
        this.resolves.forEach((resolve) => resolve(value));
        this.resolves = [];
        this.rejects = [];
        return new Promise<void>((resolve) => setTimeout(() => resolve()));
    }

    async reject(reason: REJECTION): Promise<void> {
        if (this.wasRejected || this.wasResolved) {
            return;
        }
        this.wasRejected = true;
        this.reason = reason;
        this.rejects.forEach((reject) => reject(reason));
        this.resolves = [];
        this.rejects = [];
        return new Promise<void>((resolve) => setTimeout(() => resolve()));
    }

    isPending(): boolean {
        return !this.wasResolved && !this.wasRejected;
    }

    isFulfilled(): boolean {
        return this.wasResolved;
    }

    isRejected(): boolean {
        return this.wasRejected;
    }
}

```

### utils\platform.ts

```
declare const __CHROMIUM_MV3__: boolean;
declare const __TEST__: boolean;

interface UserAgentData {
    brands: Array<{
        brand: string;
        version: string;
    }>;
    mobile: boolean;
    platform: string;
}

declare global {
    interface NavigatorID {
        userAgentData: UserAgentData;
    }
}

const isNavigatorDefined = typeof navigator !== 'undefined';
const userAgent = isNavigatorDefined ? (navigator.userAgentData && Array.isArray(navigator.userAgentData.brands)) ?
    navigator.userAgentData.brands.map((brand) => `${brand.brand.toLowerCase()} ${brand.version}`).join(' ') : navigator.userAgent.toLowerCase()
    : 'some useragent';

const platform = isNavigatorDefined ? (navigator.userAgentData && typeof navigator.userAgentData.platform === 'string') ?
    navigator.userAgentData.platform.toLowerCase() : navigator.platform.toLowerCase()
    : 'some platform';

// Note: if you are using these constants in tests, make sure they are not compiled out by adding __TEST__ to them
export const isChromium = true;
export const isFirefox = false;
export const isVivaldi = userAgent.includes('vivaldi');
export const isYaBrowser = userAgent.includes('yabrowser');
export const isOpera = userAgent.includes('opr') || userAgent.includes('opera');
export const isEdge = userAgent.includes('edg');
export const isSafari = userAgent.includes('safari') && !isChromium;
export const isWindows = platform.startsWith('win');
export const isMacOS = platform.startsWith('mac');
export const isMobile = (isNavigatorDefined && navigator.userAgentData) ? navigator.userAgentData.mobile : userAgent.includes('mobile');
export const isShadowDomSupported = typeof ShadowRoot === 'function';
export const isMatchMediaChangeEventListenerSupported = __CHROMIUM_MV3__ || (
    typeof MediaQueryList === 'function' &&
    typeof MediaQueryList.prototype.addEventListener === 'function'
);
export const isLayerRuleSupported = typeof CSSLayerBlockRule === 'function';
// Return true if browser is known to have a bug with Media Queries, specifically Chromium on Linux and Kiwi on Android
// We assume that if we are on Android, then we are running in Kiwi since it is the only mobile browser we can install Dark Reader in
export const isMatchMediaChangeEventListenerBuggy = !__TEST__ && __CHROMIUM_MV3__ && (
    ((isNavigatorDefined && navigator.userAgentData) && ['Linux', 'Android'].includes(navigator.userAgentData.platform))
    || platform.startsWith('linux'));
// Note: make sure that this value matches manifest.json keys
export const isNonPersistent = __CHROMIUM_MV3__ || isSafari;

export const chromiumVersion = (() => {
    const m = userAgent.match(/chrom(?:e|ium)(?:\/| )([^ ]+)/);
    if (m && m[1]) {
        return m[1];
    }
    return '';
})();

export const firefoxVersion = (() => {
    const m = userAgent.match(/(?:firefox|librewolf)(?:\/| )([^ ]+)/);
    if (m && m[1]) {
        return m[1];
    }
    return '';
})();

export const isDefinedSelectorSupported = (() => {
    try {
        document.querySelector(':defined');
        return true;
    } catch (err) {
        return false;
    }
})();

export function compareChromeVersions($a: string, $b: string): -1 | 0 | 1 {
    const a = $a.split('.').map((x) => parseInt(x));
    const b = $b.split('.').map((x) => parseInt(x));
    for (let i = 0; i < a.length; i++) {
        if (a[i] !== b[i]) {
            return a[i] < b[i] ? -1 : 1;
        }
    }
    return 0;
}

export const isXMLHttpRequestSupported = typeof XMLHttpRequest === 'function';

export const isFetchSupported = typeof fetch === 'function';

export const isCSSColorSchemePropSupported = __CHROMIUM_MV3__ || (() => {
    try {
        if (typeof document === 'undefined') {
            return false;
        }
        const el = document.createElement('div');
        if (!el || typeof el.style !== 'object') {
            return false;
        }
        if (typeof el.style.colorScheme === 'string') {
            return true;
        }

        // TODO: remove the following code after enforcing strong CSP in all builds
        // This feature detection method requires weak or missing CSP in manifest.json
        el.setAttribute('style', 'color-scheme: dark');
        return el.style.colorScheme === 'dark';
    } catch (e) {
        return false;
    }
})();

```

### utils\network.ts

```
import {isFirefox} from './platform';

async function getOKResponse(url: string, mimeType?: string, origin?: string): Promise<Response> {
    const credentials = origin && url.startsWith(`${origin}/`) ? undefined : 'omit';
    const response = await fetch(
        url,
        {
            cache: 'force-cache',
            credentials,
            referrer: origin,
        },
    );

    // Firefox bug, content type is "application/x-unknown-content-type"
    if (isFirefox && mimeType === 'text/css' && url.startsWith('moz-extension://') && url.endsWith('.css')) {
        return response;
    }

    if (mimeType && !response.headers.get('Content-Type')!.startsWith(mimeType)) {
        throw new Error(`Mime type mismatch when loading ${url}`);
    }

    if (!response.ok) {
        throw new Error(`Unable to load ${url} ${response.status} ${response.statusText}`);
    }

    return response;
}

export async function loadAsDataURL(url: string, mimeType?: string): Promise<string> {
    const response = await getOKResponse(url, mimeType);
    return await readResponseAsDataURL(response);
}

export async function loadAsBlob(url: string, mimeType?: string): Promise<Blob> {
    const response = await getOKResponse(url, mimeType);
    return await response.blob();
}

export async function readResponseAsDataURL(response: Response): Promise<string> {
    const blob = await response.blob();
    const dataURL = await (new Promise<string>((resolve) => {
        const reader = new FileReader();
        reader.onloadend = () => resolve(reader.result as string);
        reader.readAsDataURL(blob);
    }));
    return dataURL;
}

export async function loadAsText(url: string, mimeType?: string, origin?: string): Promise<string> {
    const response = await getOKResponse(url, mimeType, origin);
    return await response.text();
}

```

### utils\message.ts

```
export enum MessageTypeUItoBG {
    GET_DATA = 'ui-bg-get-data',
    GET_DEVTOOLS_DATA = 'ui-bg-get-devtools-data',
    SUBSCRIBE_TO_CHANGES = 'ui-bg-subscribe-to-changes',
    UNSUBSCRIBE_FROM_CHANGES = 'ui-bg-unsubscribe-from-changes',
    CHANGE_SETTINGS = 'ui-bg-change-settings',
    SET_THEME = 'ui-bg-set-theme',
    TOGGLE_ACTIVE_TAB = 'ui-bg-toggle-active-tab',
    MARK_NEWS_AS_READ = 'ui-bg-mark-news-as-read',
    MARK_NEWS_AS_DISPLAYED = 'ui-bg-mark-news-as-displayed',
    LOAD_CONFIG = 'ui-bg-load-config',
    APPLY_DEV_DYNAMIC_THEME_FIXES = 'ui-bg-apply-dev-dynamic-theme-fixes',
    RESET_DEV_DYNAMIC_THEME_FIXES = 'ui-bg-reset-dev-dynamic-theme-fixes',
    APPLY_DEV_INVERSION_FIXES = 'ui-bg-apply-dev-inversion-fixes',
    RESET_DEV_INVERSION_FIXES = 'ui-bg-reset-dev-inversion-fixes',
    APPLY_DEV_STATIC_THEMES = 'ui-bg-apply-dev-static-themes',
    RESET_DEV_STATIC_THEMES = 'ui-bg-reset-dev-static-themes',
    COLOR_SCHEME_CHANGE = 'ui-bg-color-scheme-change',
    HIDE_HIGHLIGHTS = 'ui-bg-hide-highlights'
}

export enum MessageTypeBGtoUI {
    CHANGES = 'bg-ui-changes'
}

export enum DebugMessageTypeBGtoUI {
    CSS_UPDATE = 'debug-bg-ui-css-update',
    UPDATE = 'debug-bg-ui-update'
}

export enum MessageTypeBGtoCS {
    ADD_CSS_FILTER = 'bg-cs-add-css-filter',
    ADD_DYNAMIC_THEME = 'bg-cs-add-dynamic-theme',
    ADD_STATIC_THEME = 'bg-cs-add-static-theme',
    ADD_SVG_FILTER = 'bg-cs-add-svg-filter',
    CLEAN_UP = 'bg-cs-clean-up',
    FETCH_RESPONSE = 'bg-cs-fetch-response',
    UNSUPPORTED_SENDER = 'bg-cs-unsupported-sender'
}

export enum DebugMessageTypeBGtoCS {
    RELOAD = 'debug-bg-cs-reload'
}

export enum MessageTypeCStoBG {
    COLOR_SCHEME_CHANGE = 'cs-bg-color-scheme-change',
    DARK_THEME_DETECTED = 'cs-bg-dark-theme-detected',
    DARK_THEME_NOT_DETECTED = 'cs-bg-dark-theme-not-detected',
    FETCH = 'cs-bg-fetch',
    DOCUMENT_CONNECT = 'cs-bg-document-connect',
    DOCUMENT_FORGET = 'cs-bg-document-forget',
    DOCUMENT_FREEZE = 'cs-bg-document-freeze',
    DOCUMENT_RESUME = 'cs-bg-document-resume'
}

export enum DebugMessageTypeCStoBG {
    LOG = 'debug-cs-bg-log'
}

export enum MessageTypeCStoUI {
    EXPORT_CSS_RESPONSE = 'cs-ui-export-css-response'
}

export enum MessageTypeUItoCS {
    EXPORT_CSS = 'ui-cs-export-css'
}

```

### utils\media-query.ts

```
import {isMatchMediaChangeEventListenerSupported} from './platform';

declare const __TEST__: boolean;
let override: boolean | null = null;

let query: MediaQueryList | null = null;
const onChange: ({matches}: {matches: boolean}) => void = ({matches}) => listeners.forEach((listener) => listener(matches));
const listeners = new Set<(isDark: boolean) => void>();

export function runColorSchemeChangeDetector(callback: (isDark: boolean) => void): void {
    listeners.add(callback);
    if (query) {
        return;
    }
    query = matchMedia('(prefers-color-scheme: dark)');
    if (isMatchMediaChangeEventListenerSupported) {
        // MediaQueryList change event is not cancellable and does not bubble
        query.addEventListener('change', onChange);
    } else {
        query.addListener(onChange);
    }
}

export function stopColorSchemeChangeDetector(): void {
    if (!query || !onChange) {
        return;
    }
    if (isMatchMediaChangeEventListenerSupported) {
        query.removeEventListener('change', onChange);
    } else {
        query.removeListener(onChange);
    }
    listeners.clear();
    query = null;
}

export function emulateColorScheme(colorScheme: 'light' | 'dark'): void {
    if (__TEST__) {
        const isDark = colorScheme === 'dark';
        override = isDark;
        listeners.forEach((l) => l(isDark));
    }
}

export const isSystemDarkModeEnabled = (): boolean => (__TEST__ && typeof override === 'boolean') ? override : (query || matchMedia('(prefers-color-scheme: dark)')).matches;

```

### utils\math.ts

```
export type Matrix5x5 = [
    [number, number, number, number, number],
    [number, number, number, number, number],
    [number, number, number, number, number],
    [number, number, number, number, number],
    [number, number, number, number, number]
];

export type Matrix5x1 = [
    [number],
    [number],
    [number],
    [number],
    [number]
];

export type Matrix = Matrix5x5 | Matrix5x1;

export function scale(x: number, inLow: number, inHigh: number, outLow: number, outHigh: number): number {
    return (x - inLow) * (outHigh - outLow) / (inHigh - inLow) + outLow;
}

export function clamp(x: number, min: number, max: number): number {
    return Math.min(max, Math.max(min, x));
}

// Note: the caller is responsible for ensuring that matrix dimensions make sense
export function multiplyMatrices<M extends Matrix>(m1: Matrix5x5, m2: Matrix5x5 | Matrix5x1): M {
    const result: number[][] = [];
    for (let i = 0, len = m1.length; i < len; i++) {
        result[i] = [];
        for (let j = 0, len2 = m2[0].length; j < len2; j++) {
            let sum = 0;
            for (let k = 0, len3 = m1[0].length; k < len3; k++) {
                sum += m1[i][k] * m2[k][j];
            }
            result[i][j] = sum;
        }
    }
    return result as M;
}

```

### utils\math-eval.ts

```
// evalMath is a function that's able to evaluates a mathematical expression and return it's output.
//
// Internally it uses the Shunting Yard algorithm. First it produces a reverse polish notation(RPN) stack.
// Example: 1 + 2 * 3 -> [1, 2, 3, *, +] which with parentheses means 1 (2 3 *) +
//
// Then it evaluates the RPN stack and returns the output.
export function evalMath(expression: string): number {
    // Stack where operators & numbers are stored in RPN.
    const rpnStack: string[] = [];
    // The working stack where new tokens are pushed.
    const workingStack: string[] = [];

    let lastToken: string | undefined;
    // Iterate over the expression.
    for (let i = 0, len = expression.length; i < len; i++) {
        const token = expression[i];

        // Skip if the token is empty or a whitespace.
        if (!token || token === ' ') {
            continue;
        }

        // Is the token a operator?
        if (operators.has(token)) {
            const op = operators.get(token);

            // Go trough the workingstack and determine it's place in the workingStack
            while (workingStack.length) {
                const currentOp = operators.get(workingStack[0]);
                if (!currentOp) {
                    break;
                }

                // Is the current operation equal or less than the current operation?
                // Then move that operation to the rpnStack.
                if (op!.lessOrEqualThan(currentOp)) {
                    rpnStack.push(workingStack.shift()!);
                } else {
                    break;
                }
            }
            // Add the operation to the workingStack.
            workingStack.unshift(token);
        // Otherwise was the last token a operator?
        } else if (!lastToken || operators.has(lastToken)) {
            rpnStack.push(token);
        // Otherwise just append the result to the last token(e.g. multiple digits numbers).
        } else {
            rpnStack[rpnStack.length - 1] += token;
        }
        // Set the last token.
        lastToken = token;
    }

    // Push the working stack on top of the rpnStack.
    rpnStack.push(...workingStack);

    // Now evaluate the rpnStack.
    const stack: number[] = [];
    for (let i = 0, len = rpnStack.length; i < len; i++) {
        const op = operators.get(rpnStack[i]);
        if (op) {
            // Get the arguments of for the operation(first two in the stack).
            const args = stack.splice(0, 2);
            // Excute it, because of reverse notation we first pass second item then the first item.
            stack.push(op.exec(args[1], args[0]));
        } else {
            // Add the number to the stack.
            stack.unshift(parseFloat(rpnStack[i]));
        }
    }

    return stack[0];
}

// Operator class  defines a operator that can be parsed & evaluated by evalMath.
class Operator {
    private precendce: number;
    private execMethod: (left: number, right: number) => number;

    constructor(precedence: number, method: (left: number, right: number) => number) {
        this.precendce = precedence;
        this.execMethod = method;
    }

    exec(left: number, right: number): number {
        return this.execMethod(left, right);
    }

    lessOrEqualThan(op: Operator) {
        return this.precendce <= op.precendce;
    }
}

const operators: Readonly<Map<string, Operator>> = new Map([
    ['+', new Operator(1, (left: number, right: number): number => left + right)],
    ['-', new Operator(1, (left: number, right: number): number => left - right)],
    ['*', new Operator(2, (left: number, right: number): number => left * right)],
    ['/', new Operator(2, (left: number, right: number): number => left / right)],
]);

```

### utils\locales.ts

```
export function getLocalMessage(messageName: string): string {
    return chrome.i18n.getMessage(messageName) || messageName;
}

export function getUILanguage(): string {
    let code: string;
    if ('i18n' in chrome && 'getUILanguage' in chrome.i18n && typeof chrome.i18n.getUILanguage === 'function') {
        code = chrome.i18n.getUILanguage();
    } else {
        // Background service workers do not have access to "foreground" APIs like chrome.i18n
        code = navigator.language.split('-')[0];
    }
    if (code.endsWith('-mac')) {
        return code.substring(0, code.length - 4);
    }
    return code;
}

```

### utils\links.ts

```
import {getUILanguage} from './locales';
import {isEdge, isMobile} from './platform';

export const HOMEPAGE_URL = 'https://darkreader.org';
export const BLOG_URL = 'https://darkreader.org/blog/';
export const NEWS_URL = 'https://darkreader.org/blog/posts.json';
export const DEVTOOLS_DOCS_URL = 'https://github.com/darkreader/darkreader/blob/main/CONTRIBUTING.md';
export const DONATE_URL = 'https://darkreader.org/support-us/';
export const GITHUB_URL = 'https://github.com/darkreader/darkreader';
export const MOBILE_URL = 'https://darkreader.org/tips/mobile/';
export const PRIVACY_URL = 'https://darkreader.org/privacy/';
export const TWITTER_URL = 'https://twitter.com/darkreaderapp';
export const UNINSTALL_URL = 'https://darkreader.org/goodluck/';
export const HELP_URL = 'https://darkreader.org/help';
export const CONFIG_URL_BASE = 'https://raw.githubusercontent.com/darkreader/darkreader/main/src/config';

const helpLocales = [
    'be',
    'cs',
    'de',
    'en',
    'es',
    'fr',
    'it',
    'ja',
    'nl',
    'pt',
    'ru',
    'sr',
    'tr',
    'zh-CN',
    'zh-TW',
];

export function getHelpURL(): string {
    if (isEdge && isMobile) {
        return `${HELP_URL}/mobile/`;
    }
    const locale = getUILanguage();
    const matchLocale = helpLocales.find((hl) => hl === locale) || helpLocales.find((hl) => locale.startsWith(hl)) || 'en';
    return `${HELP_URL}/${matchLocale}/`;
}

export function getBlogPostURL(postId: string): string {
    return `${BLOG_URL}${postId}/`;
}

```

### utils\debounce.ts

```
type AnyFn = (...args: any[]) => void;

export function debounce<F extends AnyFn>(delay: number, fn: F): F {
    let timeoutId: ReturnType<typeof setTimeout> | null = null;
    return ((...args: any[]) => {
        if (timeoutId) {
            clearTimeout(timeoutId);
        }
        timeoutId = setTimeout(() => {
            timeoutId = null;
            fn(...args);
        }, delay);
    }) as F;
}

```

### utils\csp.ts

```
import {HOMEPAGE_URL, BLOG_URL, DEVTOOLS_DOCS_URL, GITHUB_URL, PRIVACY_URL, TWITTER_URL, UNINSTALL_URL, HELP_URL} from './links';

enum CSP {
    NONE = "'none'",
    SELF = "'self'"
}

function check() {
    const prefixed = [BLOG_URL, PRIVACY_URL, UNINSTALL_URL, HELP_URL];
    if (prefixed.some((url) => !url.startsWith(HOMEPAGE_URL))) {
        throw new Error('Some navigation URL is not within main site!');
    }
}

export function prepareCSPMV3(): chrome.runtime.ManifestV3['content_security_policy'] {
    check();

    const result: any = {};
    const policy: any = {
        extension_pages: {
            'default-src': [CSP.NONE],
            'script-src': [CSP.SELF],
            'style-src': [CSP.SELF],
            'img-src': [
                '*',
                'data:',
            ],
            'connect-src': ['*'],
            'navigate-to': [
                CSP.SELF,
                `${HOMEPAGE_URL}/*`,
                DEVTOOLS_DOCS_URL,
                GITHUB_URL,
                TWITTER_URL,
            ],
            'media-src': [CSP.NONE],
            'child-src': [CSP.NONE],
            'worker-src': [CSP.NONE],
            'object-src': [CSP.NONE],
        },
    };
    for (const p in policy) {
        const outputs: string[] = [];
        for (const directive in policy[p]) {
            outputs.push(`${directive} ${policy[p][directive].join(' ')}`);
        }
        result[p] = outputs.join('; ');
    }
    return result;
}

```

### utils\colorscheme-parser.ts

```
// Seperator is to indicate that the it should start with a new defined colorscheme.
const SEPERATOR = '='.repeat(32);

// Just a few constants to make the code more readable.
const backgroundPropertyLength = 'background: '.length;
const textPropertyLength = 'text: '.length;

// Should return a humanized version of the given number.
// For example:
// humanizeNumber(0) => '0'
// humanizeNumber(1) => '1st'
// humanizeNumber(2) => '2nd'
// humanizeNumber(3) => '3rd'
// humanizeNumber(4) => '4th'
// TODO(Anton): rewrite me with case-default
// eslint-disable-next-line
// @ts-ignore
const humanizeNumber = (number: number): string => {
    if (number > 3) {
        return `${number}th`;
    }
    switch (number) {
        case 0:
            return '0';
        case 1:
            return '1st';
        case 2:
            return '2nd';
        case 3:
            return '3rd';
    }
};

// Should return if the given string is a valid 3 or 6 digit hex color.
const isValidHexColor = (color: string): boolean => {
    return /^#([0-9a-fA-F]{3}){1,2}$/.test(color);
};

interface ColorSchemeVariant {
    // The background color of the color scheme in hex format.
    backgroundColor: string;
    // The text color of the color scheme in hex format.
    textColor: string;
}

export interface ParsedColorSchemeConfig {
    // All defined light color schemes.
    light: { [name: string]: ColorSchemeVariant };
    // All defined dark color schemes.
    dark: { [name: string]: ColorSchemeVariant };
}

export function parseColorSchemeConfig(config: string): { result: ParsedColorSchemeConfig; error: string | null } {
    // Let's first get all "possible" sections of the text.
    // We're adding `\n` so the sections "first" word is the
    // name of the color scheme. We could remove this and
    // skip this in the process of parsing, but because
    // the first entry will not have this first '\n' it will
    // be more complicated to otherwise just add this '\n' here.
    const sections = config.split(`${SEPERATOR }\n\n`);

    const definedColorSchemeNames: Set<string> = new Set();
    let lastDefinedColorSchemeName: string | undefined = '';

    const definedColorSchemes: ParsedColorSchemeConfig = {
        light: {},
        dark: {},
    };

    // Define the interrupt and error variables.
    // Interrupt is to indicate that the parsing should stop.
    // But because we cannot break out of a forEach loop,
    // we need to use an interrupt variable.
    // The error is to indicate that there was an error.
    // And also the reason why the parsing failed.
    // It will be the first error that is found.
    let interrupt = false;
    let error: string | null = null;

    const throwError = (message: string) => {
        if (!interrupt) {
            interrupt = true;
            error = message;
        }
    };

    // Now we will iterate troughout each section.
    // We will always assume bad-faith and make sure to have
    // guards in place. As this could also be bad code.
    // We shouldn't rely on that the input is correct.
    sections.forEach((section) => {
        // Check if the interrupt variable is set.
        // If it is, we should stop parsing.
        if (interrupt) {
            return;
        }

        // First we split the section into lines.
        const lines = section.split('\n');

        // We have to make sure that the first line is a valid color scheme name.
        // We will also make sure that the name is not already defined.
        const name = lines[0];
        if (!name) {
            throwError('No color scheme name was found.');
            return;
        }
        if (definedColorSchemeNames.has(name)) {
            throwError(`The color scheme name "${name}" is already defined.`);
            return;
        }
        // Check if the name is on alphabetical order.
        if (lastDefinedColorSchemeName && lastDefinedColorSchemeName !== 'Default' && name.localeCompare(lastDefinedColorSchemeName) < 0) {
            throwError(`The color scheme name "${name}" is not in alphabetical order.`);
            return;
        }
        lastDefinedColorSchemeName = name;

        // Add the name to the set of defined color scheme names.
        definedColorSchemeNames.add(name);

        // Check if line[1] is empty, which is must be.
        if (lines[1]) {
            throwError(`The second line of the color scheme "${name}" is not empty.`);
            return;
        }

        const checkVariant = (lineIndex: number, isSecondVariant: boolean): (ColorSchemeVariant & { variant?: string }) | undefined => {
            // Get the possible variant name.
            const variant = lines[lineIndex];
            if (!variant) {
                throwError(`The third line of the color scheme "${name}" is not defined.`);
                return;
            }

            // Check if the variant is valid.
            // if isSecondVariant is true, then we will check if the variant is 'Light', 'Dark' is not considered valid.
            if (variant !== 'LIGHT' && variant !== 'DARK' && (isSecondVariant && variant === 'Light')) {
                throwError(`The ${humanizeNumber(lineIndex)} line of the color scheme "${name}" is not a valid variant.`);
                return;
            }

            // Get the possible background color.
            const firstProperty = lines[lineIndex + 1];
            if (!firstProperty) {
                throwError(`The ${humanizeNumber(lineIndex + 1)} line of the color scheme "${name}" is not defined.`);
                return;
            }

            // Check if the property is background color.
            if (!firstProperty.startsWith('background: ')) {
                throwError(`The ${humanizeNumber(lineIndex + 1)} line of the color scheme "${name}" is not background-color property.`);
                return;
            }

            // Get the background color and check if it is a valid hex color.
            const backgroundColor = firstProperty.slice(backgroundPropertyLength);
            if (!isValidHexColor(backgroundColor)) {
                throwError(`The ${humanizeNumber(lineIndex + 1)} line of the color scheme "${name}" is not a valid hex color.`);
                return;
            }

            // Get the possible text color.
            const secondProperty = lines[lineIndex + 2];
            if (!secondProperty) {
                throwError(`The ${humanizeNumber(lineIndex + 2)} line of the color scheme "${name}" is not defined.`);
                return;
            }
            // Check if the property is text color.
            if (!secondProperty.startsWith('text: ')) {
                throwError(`The ${humanizeNumber(lineIndex + 2)} line of the color scheme "${name}" is not text-color property.`);
                return;
            }
            // Get the text color and check if it is a valid hex color.
            const textColor = secondProperty.slice(textPropertyLength);
            if (!isValidHexColor(textColor)) {
                throwError(`The ${humanizeNumber(lineIndex + 2)} line of the color scheme "${name}" is not a valid hex color.`);
                return;
            }
            // If the variant is the second variant, then we will return the variant and the variant name.
            return {
                backgroundColor,
                textColor,
                variant,
            };
        };

        const firstVariant = checkVariant(2, false)!;
        const isFirstVariantLight = firstVariant.variant === 'LIGHT';
        delete firstVariant.variant;
        // If the interrupt variable is set, we should stop parsing.
        if (interrupt) {
            return;
        }
        let secondVariant: typeof firstVariant | null = null;
        let isSecondVariantLight = false;
        // Check if the 7th line is defined otherwise we should stop parsing.
        if (lines[6]) {
            secondVariant = checkVariant(6, true)!;
            isSecondVariantLight = secondVariant.variant === 'LIGHT';
            delete secondVariant.variant;
            // If the interrupt variable is set, we should stop parsing.
            if (interrupt) {
                return;
            }
            // Must end with 1 new line(two Variants).
            if (lines.length > 11 || lines[9] || lines[10]) {
                throwError(`The color scheme "${name}" doesn't end with 1 new line.`);
                return;
            }
        } else if (lines.length > 7) {
            throwError(`The color scheme "${name}" doesn't end with 1 new line.`);
            return;
        }
        if (secondVariant) {
            if (isFirstVariantLight === isSecondVariantLight) {
                throwError(`The color scheme "${name}" has the same variant twice.`);
                return;
            }
            if (isFirstVariantLight) {
                definedColorSchemes.light[name] = firstVariant;
                definedColorSchemes.dark[name] = secondVariant;
            } else {
                definedColorSchemes.light[name] = secondVariant;
                definedColorSchemes.dark[name] = firstVariant;
            }
        } else if (isFirstVariantLight) {
            definedColorSchemes.light[name] = firstVariant;
        } else {
            definedColorSchemes.dark[name] = firstVariant;
        }
    });

    return {result: definedColorSchemes, error: error};
}

```

### utils\cache.ts

```
export function cachedFactory<K, V>(factory: (key: K) => V, size: number): (key: K) => V {
    const cache = new Map<K, V>();

    return (key: K) => {
        if (cache.has(key)) {
            return cache.get(key)!;
        }
        const value = factory(key);
        cache.set(key, value);
        if (cache.size > size) {
            const first = cache.keys().next().value;
            cache.delete(first);
        }
        return value;
    };
}

```

### utils\automation.ts

```
export enum AutomationMode {
    NONE = '',
    TIME = 'time',
    SYSTEM = 'system',
    LOCATION = 'location'
}

```

### utils\color.ts

```
import {evalMath} from './math-eval';
import {isSystemDarkModeEnabled} from './media-query';
import {getParenthesesRange} from './text';

export interface RGBA {
    r: number;
    g: number;
    b: number;
    a?: number;
}

export interface HSLA {
    h: number;
    s: number;
    l: number;
    a?: number;
}

const hslaParseCache = new Map<string, HSLA>();
const rgbaParseCache = new Map<string, RGBA>();

export function parseColorWithCache($color: string): RGBA | null {
    $color = $color.trim();
    if (rgbaParseCache.has($color)) {
        return rgbaParseCache.get($color)!;
    }
    // We cannot _really_ parse any color which has the calc() expression,
    // so we try our best to remove those and then parse the value.
    if ($color.includes('calc(')) {
        $color = lowerCalcExpression($color);
    }
    const color = parse($color);
    if (color) {
        rgbaParseCache.set($color, color);
        return color;
    }
    return null;
}

export function parseToHSLWithCache(color: string): HSLA | null {
    if (hslaParseCache.has(color)) {
        return hslaParseCache.get(color)!;
    }
    const rgb = parseColorWithCache(color);
    if (!rgb) {
        return null;
    }
    const hsl = rgbToHSL(rgb);
    hslaParseCache.set(color, hsl);
    return hsl;
}

export function clearColorCache(): void {
    hslaParseCache.clear();
    rgbaParseCache.clear();
}

// https://en.wikipedia.org/wiki/HSL_and_HSV
export function hslToRGB({h, s, l, a = 1}: HSLA): RGBA {
    if (s === 0) {
        const [r, b, g] = [l, l, l].map((x) => Math.round(x * 255));
        return {r, g, b, a};
    }

    const c = (1 - Math.abs(2 * l - 1)) * s;
    const x = c * (1 - Math.abs((h / 60) % 2 - 1));
    const m = l - c / 2;
    const [r, g, b] = (
        h < 60 ? [c, x, 0] :
            h < 120 ? [x, c, 0] :
                h < 180 ? [0, c, x] :
                    h < 240 ? [0, x, c] :
                        h < 300 ? [x, 0, c] :
                            [c, 0, x]
    ).map((n) => Math.round((n + m) * 255));

    return {r, g, b, a};
}

// https://en.wikipedia.org/wiki/HSL_and_HSV
export function rgbToHSL({r: r255, g: g255, b: b255, a = 1}: RGBA): HSLA {
    const r = r255 / 255;
    const g = g255 / 255;
    const b = b255 / 255;

    const max = Math.max(r, g, b);
    const min = Math.min(r, g, b);
    const c = max - min;

    const l = (max + min) / 2;

    if (c === 0) {
        return {h: 0, s: 0, l, a};
    }

    let h = (
        max === r ? (((g - b) / c) % 6) :
            max === g ? ((b - r) / c + 2) :
                ((r - g) / c + 4)
    ) * 60;
    if (h < 0) {
        h += 360;
    }

    const s = c / (1 - Math.abs(2 * l - 1));

    return {h, s, l, a};
}

function toFixed(n: number, digits = 0): string {
    const fixed = n.toFixed(digits);
    if (digits === 0) {
        return fixed;
    }
    const dot = fixed.indexOf('.');
    if (dot >= 0) {
        const zerosMatch = fixed.match(/0+$/);
        if (zerosMatch) {
            if (zerosMatch.index === dot + 1) {
                return fixed.substring(0, dot);
            }
            return fixed.substring(0, zerosMatch.index);
        }
    }
    return fixed;
}

export function rgbToString(rgb: RGBA): string {
    const {r, g, b, a} = rgb;
    if (a != null && a < 1) {
        return `rgba(${toFixed(r)}, ${toFixed(g)}, ${toFixed(b)}, ${toFixed(a, 2)})`;
    }
    return `rgb(${toFixed(r)}, ${toFixed(g)}, ${toFixed(b)})`;
}

export function rgbToHexString({r, g, b, a}: RGBA): string {
    return `#${(a != null && a < 1 ? [r, g, b, Math.round(a * 255)] : [r, g, b]).map((x) => {
        return `${x < 16 ? '0' : ''}${x.toString(16)}`;
    }).join('')}`;
}

export function hslToString(hsl: HSLA): string {
    const {h, s, l, a} = hsl;
    if (a != null && a < 1) {
        return `hsla(${toFixed(h)}, ${toFixed(s * 100)}%, ${toFixed(l * 100)}%, ${toFixed(a, 2)})`;
    }
    return `hsl(${toFixed(h)}, ${toFixed(s * 100)}%, ${toFixed(l * 100)}%)`;
}

const rgbMatch = /^rgba?\([^\(\)]+\)$/;
const hslMatch = /^hsla?\([^\(\)]+\)$/;
const hexMatch = /^#[0-9a-f]+$/i;

const supportedColorFuncs = [
    'color',
    'color-mix',
    'hwb',
    'lab',
    'lch',
    'oklab',
    'oklch',
];

export function parse($color: string): RGBA | null {
    const c = $color.trim().toLowerCase();
    if (c.includes('(from ')) {
        return domParseColor(c);
    }

    if (c.match(rgbMatch)) {
        if (c.startsWith('rgb(#') || c.startsWith('rgba(#')) {
            return domParseColor(c);
        }
        return parseRGB(c);
    }

    if (c.match(hslMatch)) {
        return parseHSL(c);
    }

    if (c.match(hexMatch)) {
        return parseHex(c);
    }

    if (knownColors.has(c)) {
        return getColorByName(c);
    }

    if (systemColors.has(c)) {
        return getSystemColor(c);
    }

    if (c === 'transparent') {
        return {r: 0, g: 0, b: 0, a: 0};
    }

    if (c.endsWith(')') && supportedColorFuncs.some((fn) => c.startsWith(fn) && c[fn.length] === '(')) {
        return domParseColor(c);
    }

    if (c.startsWith('light-dark(') && c.endsWith(')')) {
        // light-dark([color()], [color()])
        const match = c.match(/^light-dark\(\s*([a-z]+(\(.*\))?),\s*([a-z]+(\(.*\))?)\s*\)$/);
        if (match) {
            const schemeColor = isSystemDarkModeEnabled() ? match[3] : match[1];
            return parse(schemeColor);
        }
    }

    return null;
}

function getNumbers($color: string) {
    const numbers: string[] = [];
    let prevPos = 0;
    let isMining = false;
    // Get the first `(`.
    const startIndex = $color.indexOf('(');
    $color = $color.substring(startIndex + 1, $color.length - 1);
    for (let i = 0; i < $color.length; i++) {
        const c = $color[i];
        // Check if `c` is a digit.
        if (c >= '0' && c <= '9' || c === '.' || c === '+' || c === '-') {
            // Enable the mining flag.
            isMining = true;
        } else if (isMining && (c === ' ' || c === ',' || c === '/')) {
            // isMining is true and we got a terminating
            // character. So we can push the current number
            // into the array.
            numbers.push($color.substring(prevPos, i));
            // Disable the mining flag.
            isMining = false;
            // Ensure the prevPos is correct.
            prevPos = i + 1;
        } else if (!isMining) {
            // Ensure the prevPos is correct.
            prevPos = i + 1;
        }
    }
    // Push the last number.
    if (isMining) {
        numbers.push($color.substring(prevPos, $color.length));
    }
    return numbers;
}

function getNumbersFromString(str: string, range: number[], units: {[unit: string]: number}) {
    const raw = getNumbers(str);
    const unitsList = Object.entries(units);
    const numbers = raw.map((r) => r.trim()).map((r, i) => {
        let n: number;
        const unit = unitsList.find(([u]) => r.endsWith(u));
        if (unit) {
            n = parseFloat(r.substring(0, r.length - unit[0].length)) / unit[1] * range[i];
        } else {
            n = parseFloat(r);
        }
        if (range[i] > 1) {
            return Math.round(n);
        }
        return n;
    });
    return numbers;
}

const rgbRange = [255, 255, 255, 1];
const rgbUnits = {'%': 100};

function parseRGB($rgb: string): RGBA | null {
    const [r, g, b, a = 1] = getNumbersFromString($rgb, rgbRange, rgbUnits);
    if (r == null || g == null || b == null || a == null) {
        return null;
    }
    return {r, g, b, a};
}

const hslRange = [360, 1, 1, 1];
const hslUnits = {'%': 100, 'deg': 360, 'rad': 2 * Math.PI, 'turn': 1};

function parseHSL($hsl: string): RGBA | null {
    const [h, s, l, a = 1] = getNumbersFromString($hsl, hslRange, hslUnits);
    if (h == null || s == null || l == null || a == null) {
        return null;
    }
    return hslToRGB({h, s, l, a});
}

function parseHex($hex: string): RGBA | null {
    const h = $hex.substring(1);
    switch (h.length) {
        case 3:
        case 4: {
            const [r, g, b] = [0, 1, 2].map((i) => parseInt(`${h[i]}${h[i]}`, 16));
            const a = h.length === 3 ? 1 : (parseInt(`${h[3]}${h[3]}`, 16) / 255);
            return {r, g, b, a};
        }
        case 6:
        case 8: {
            const [r, g, b] = [0, 2, 4].map((i) => parseInt(h.substring(i, i + 2), 16));
            const a = h.length === 6 ? 1 : (parseInt(h.substring(6, 8), 16) / 255);
            return {r, g, b, a};
        }
    }
    return null;
}

function getColorByName($color: string): RGBA {
    const n = knownColors.get($color)!;
    return {
        r: (n >> 16) & 255,
        g: (n >> 8) & 255,
        b: (n >> 0) & 255,
        a: 1,
    };
}

function getSystemColor($color: string): RGBA {
    const n = systemColors.get($color)!;
    return {
        r: (n >> 16) & 255,
        g: (n >> 8) & 255,
        b: (n >> 0) & 255,
        a: 1,
    };
}

// lowerCalcExpression is a helper function that tries to remove `calc(...)`
// expressions from the given string. It can only lower expressions to a certain
// degree so we can keep this function easy and simple to understand.
export function lowerCalcExpression(color: string): string {
    // searchIndex will be used as searchIndex and as a "cursor" within
    // the calc(...) expression.
    let searchIndex = 0;

    // Replace the content between two indices.
    const replaceBetweenIndices = (start: number, end: number, replacement: string) => {
        color = color.substring(0, start) + replacement + color.substring(end);
    };

    // Run this code until it doesn't find any `calc(...)`.
    while ((searchIndex = color.indexOf('calc(')) !== -1) {
        // Get the parentheses ranges of `calc(...)`.
        const range = getParenthesesRange(color, searchIndex);
        if (!range) {
            break;
        }

        // Get the content between the parentheses.
        let slice = color.slice(range.start + 1, range.end - 1);
        // Does the content include a percentage?
        const includesPercentage = slice.includes('%');
        // Remove all percentages.
        slice = slice.split('%').join('');

        // Pass the content to the evalMath library and round its output.
        const output = Math.round(evalMath(slice));

        // Replace `calc(...)` with the result.
        replaceBetweenIndices(range.start - 4, range.end, output + (includesPercentage ? '%' : ''));
    }
    return color;
}

const knownColors: Map<string, number> = new Map(Object.entries({
    aliceblue: 0xf0f8ff,
    antiquewhite: 0xfaebd7,
    aqua: 0x00ffff,
    aquamarine: 0x7fffd4,
    azure: 0xf0ffff,
    beige: 0xf5f5dc,
    bisque: 0xffe4c4,
    black: 0x000000,
    blanchedalmond: 0xffebcd,
    blue: 0x0000ff,
    blueviolet: 0x8a2be2,
    brown: 0xa52a2a,
    burlywood: 0xdeb887,
    cadetblue: 0x5f9ea0,
    chartreuse: 0x7fff00,
    chocolate: 0xd2691e,
    coral: 0xff7f50,
    cornflowerblue: 0x6495ed,
    cornsilk: 0xfff8dc,
    crimson: 0xdc143c,
    cyan: 0x00ffff,
    darkblue: 0x00008b,
    darkcyan: 0x008b8b,
    darkgoldenrod: 0xb8860b,
    darkgray: 0xa9a9a9,
    darkgrey: 0xa9a9a9,
    darkgreen: 0x006400,
    darkkhaki: 0xbdb76b,
    darkmagenta: 0x8b008b,
    darkolivegreen: 0x556b2f,
    darkorange: 0xff8c00,
    darkorchid: 0x9932cc,
    darkred: 0x8b0000,
    darksalmon: 0xe9967a,
    darkseagreen: 0x8fbc8f,
    darkslateblue: 0x483d8b,
    darkslategray: 0x2f4f4f,
    darkslategrey: 0x2f4f4f,
    darkturquoise: 0x00ced1,
    darkviolet: 0x9400d3,
    deeppink: 0xff1493,
    deepskyblue: 0x00bfff,
    dimgray: 0x696969,
    dimgrey: 0x696969,
    dodgerblue: 0x1e90ff,
    firebrick: 0xb22222,
    floralwhite: 0xfffaf0,
    forestgreen: 0x228b22,
    fuchsia: 0xff00ff,
    gainsboro: 0xdcdcdc,
    ghostwhite: 0xf8f8ff,
    gold: 0xffd700,
    goldenrod: 0xdaa520,
    gray: 0x808080,
    grey: 0x808080,
    green: 0x008000,
    greenyellow: 0xadff2f,
    honeydew: 0xf0fff0,
    hotpink: 0xff69b4,
    indianred: 0xcd5c5c,
    indigo: 0x4b0082,
    ivory: 0xfffff0,
    khaki: 0xf0e68c,
    lavender: 0xe6e6fa,
    lavenderblush: 0xfff0f5,
    lawngreen: 0x7cfc00,
    lemonchiffon: 0xfffacd,
    lightblue: 0xadd8e6,
    lightcoral: 0xf08080,
    lightcyan: 0xe0ffff,
    lightgoldenrodyellow: 0xfafad2,
    lightgray: 0xd3d3d3,
    lightgrey: 0xd3d3d3,
    lightgreen: 0x90ee90,
    lightpink: 0xffb6c1,
    lightsalmon: 0xffa07a,
    lightseagreen: 0x20b2aa,
    lightskyblue: 0x87cefa,
    lightslategray: 0x778899,
    lightslategrey: 0x778899,
    lightsteelblue: 0xb0c4de,
    lightyellow: 0xffffe0,
    lime: 0x00ff00,
    limegreen: 0x32cd32,
    linen: 0xfaf0e6,
    magenta: 0xff00ff,
    maroon: 0x800000,
    mediumaquamarine: 0x66cdaa,
    mediumblue: 0x0000cd,
    mediumorchid: 0xba55d3,
    mediumpurple: 0x9370db,
    mediumseagreen: 0x3cb371,
    mediumslateblue: 0x7b68ee,
    mediumspringgreen: 0x00fa9a,
    mediumturquoise: 0x48d1cc,
    mediumvioletred: 0xc71585,
    midnightblue: 0x191970,
    mintcream: 0xf5fffa,
    mistyrose: 0xffe4e1,
    moccasin: 0xffe4b5,
    navajowhite: 0xffdead,
    navy: 0x000080,
    oldlace: 0xfdf5e6,
    olive: 0x808000,
    olivedrab: 0x6b8e23,
    orange: 0xffa500,
    orangered: 0xff4500,
    orchid: 0xda70d6,
    palegoldenrod: 0xeee8aa,
    palegreen: 0x98fb98,
    paleturquoise: 0xafeeee,
    palevioletred: 0xdb7093,
    papayawhip: 0xffefd5,
    peachpuff: 0xffdab9,
    peru: 0xcd853f,
    pink: 0xffc0cb,
    plum: 0xdda0dd,
    powderblue: 0xb0e0e6,
    purple: 0x800080,
    rebeccapurple: 0x663399,
    red: 0xff0000,
    rosybrown: 0xbc8f8f,
    royalblue: 0x4169e1,
    saddlebrown: 0x8b4513,
    salmon: 0xfa8072,
    sandybrown: 0xf4a460,
    seagreen: 0x2e8b57,
    seashell: 0xfff5ee,
    sienna: 0xa0522d,
    silver: 0xc0c0c0,
    skyblue: 0x87ceeb,
    slateblue: 0x6a5acd,
    slategray: 0x708090,
    slategrey: 0x708090,
    snow: 0xfffafa,
    springgreen: 0x00ff7f,
    steelblue: 0x4682b4,
    tan: 0xd2b48c,
    teal: 0x008080,
    thistle: 0xd8bfd8,
    tomato: 0xff6347,
    turquoise: 0x40e0d0,
    violet: 0xee82ee,
    wheat: 0xf5deb3,
    white: 0xffffff,
    whitesmoke: 0xf5f5f5,
    yellow: 0xffff00,
    yellowgreen: 0x9acd32,
}));

const systemColors: Map<string, number> = new Map(Object.entries({
    ActiveBorder: 0x3b99fc,
    ActiveCaption: 0x000000,
    AppWorkspace: 0xaaaaaa,
    Background: 0x6363ce,
    ButtonFace: 0xffffff,
    ButtonHighlight: 0xe9e9e9,
    ButtonShadow: 0x9fa09f,
    ButtonText: 0x000000,
    CaptionText: 0x000000,
    GrayText: 0x7f7f7f,
    Highlight: 0xb2d7ff,
    HighlightText: 0x000000,
    InactiveBorder: 0xffffff,
    InactiveCaption: 0xffffff,
    InactiveCaptionText: 0x000000,
    InfoBackground: 0xfbfcc5,
    InfoText: 0x000000,
    Menu: 0xf6f6f6,
    MenuText: 0xffffff,
    Scrollbar: 0xaaaaaa,
    ThreeDDarkShadow: 0x000000,
    ThreeDFace: 0xc0c0c0,
    ThreeDHighlight: 0xffffff,
    ThreeDLightShadow: 0xffffff,
    ThreeDShadow: 0x000000,
    Window: 0xececec,
    WindowFrame: 0xaaaaaa,
    WindowText: 0x000000,
    '-webkit-focus-ring-color': 0xe59700,
}).map(([key, value]) => [key.toLowerCase(), value] as [string, number]));

// https://en.wikipedia.org/wiki/Relative_luminance
export function getSRGBLightness(r: number, g: number, b: number): number {
    return (0.2126 * r + 0.7152 * g + 0.0722 * b) / 255;
}

let canvas: HTMLCanvasElement;
let context: CanvasRenderingContext2D;

function domParseColor($color: string) {
    if (!context) {
        canvas = document.createElement('canvas');
        canvas.width = 1;
        canvas.height = 1;
        context = canvas.getContext('2d', {willReadFrequently: true})!;
    }
    context.fillStyle = $color;
    context.fillRect(0, 0, 1, 1);
    const d = context.getImageData(0, 0, 1, 1).data;
    const color = `rgba(${d[0]}, ${d[1]}, ${d[2]}, ${(d[3] / 255).toFixed(2)})`;
    return parseRGB(color);
}

```

### utils\async-queue.ts

```
export type Task = () => void;

const MAX_FRAME_DURATION = 1000 / 60;

export default class AsyncQueue {
    private queue: Task[] = [];
    private timerId: number | null = null;

    addTask(task: Task): void {
        this.queue.push(task);
        this.scheduleFrame();
    }

    stop(): void {
        if (this.timerId !== null) {
            cancelAnimationFrame(this.timerId);
            this.timerId = null;
        }
        this.queue = [];
    }

    private scheduleFrame(): void {
        if (this.timerId) {
            return;
        }
        this.timerId = requestAnimationFrame(() => {
            this.timerId = null;
            const start = Date.now();
            let cb: Task | undefined;
            while ((cb = this.queue.shift())) {
                cb();
                if (Date.now() - start >= MAX_FRAME_DURATION) {
                    this.scheduleFrame();
                    break;
                }
            }
        });
    }
}

```

### utils\validation.ts

```
import {DEFAULT_SETTINGS, DEFAULT_THEME} from '../defaults';
import type {UserSettings, Theme, ThemePreset, CustomSiteConfig, TimeSettings, LocationSettings, Automation} from '../definitions';

import {AutomationMode} from './automation';

function isBoolean(x: any): x is boolean {
    return typeof x === 'boolean';
}

function isPlainObject(x: any): x is Record<string, unknown> {
    return typeof x === 'object' && x != null && !Array.isArray(x);
}

function isArray(x: any) {
    return Array.isArray(x);
}

function isString(x: any): x is string {
    return typeof x === 'string';
}

function isNonEmptyString(x: any): x is string {
    return x && isString(x);
}

function isNonEmptyArrayOfNonEmptyStrings(x: any): x is any[] {
    return Array.isArray(x) && x.length > 0 && x.every((s) => isNonEmptyString(s));
}

function isRegExpMatch(regexp: RegExp) {
    return (x: any): x is string => {
        return isString(x) && x.match(regexp) != null;
    };
}

const isTime = isRegExpMatch(/^((0?[0-9])|(1[0-9])|(2[0-3])):([0-5][0-9])$/);
function isNumber(x: any): x is number {
    return typeof x === 'number' && !isNaN(x);
}

function isNumberBetween(min: number, max: number) {
    return (x: any): x is number => {
        return isNumber(x) && x >= min && x <= max;
    };
}

function isOneOf(...values: any[]) {
    return (x: any) => values.includes(x);
}

function hasRequiredProperties<T extends Record<string, unknown>>(obj: T, keys: Array<keyof T>) {
    return keys.every((key) => obj.hasOwnProperty(key));
}

function createValidator() {
    const errors: string[] = [];

    function validateProperty<T extends Record<string, unknown>>(obj: T, key: keyof T, validator: (x: any) => boolean, fallback: T) {
        if (!obj.hasOwnProperty(key) || validator(obj[key])) {
            return;
        }
        errors.push(`Unexpected value for "${key as string}": ${JSON.stringify(obj[key])}`);
        obj[key] = fallback[key];
    }

    function validateArray<T extends Record<string, unknown>, V>(obj: T, key: keyof T, validator: (x: V) => boolean) {
        if (!obj.hasOwnProperty(key)) {
            return;
        }
        const wrongValues = new Set();
        const arr: any[] = obj[key] as any;
        for (let i = 0; i < arr.length; i++) {
            if (!validator(arr[i])) {
                wrongValues.add(arr[i]);
                arr.splice(i, 1);
                i--;
            }
        }
        if (wrongValues.size > 0) {
            errors.push(`Array "${key as string}" has wrong values: ${Array.from(wrongValues).map((v) => JSON.stringify(v)).join('; ')}`);
        }
    }

    return {validateProperty, validateArray, errors};
}

interface SettingValidationResult {
    settings: Partial<UserSettings>;
    errors: string[];
}

export function validateSettings(settings: Partial<UserSettings>): SettingValidationResult {
    if (!isPlainObject(settings)) {
        return {errors: ['Settings are not a plain object'], settings: DEFAULT_SETTINGS};
    }

    const {validateProperty, validateArray, errors} = createValidator();
    const isValidPresetTheme = (theme: Theme) => {
        if (!isPlainObject(theme)) {
            return false;
        }
        const {errors: themeErrors} = validateTheme(theme);
        return themeErrors.length === 0;
    };

    validateProperty(settings, 'schemeVersion', isNumber, DEFAULT_SETTINGS);

    validateProperty(settings, 'enabled', isBoolean, DEFAULT_SETTINGS);
    validateProperty(settings, 'fetchNews', isBoolean, DEFAULT_SETTINGS);

    validateProperty(settings, 'theme', isPlainObject, DEFAULT_SETTINGS);
    const {errors: themeErrors} = validateTheme(settings.theme);
    errors.push(...themeErrors);

    validateProperty(settings, 'presets', isArray, DEFAULT_SETTINGS);
    validateArray(settings, 'presets', (preset: ThemePreset) => {
        const presetValidator = createValidator();
        if (!(isPlainObject(preset) && hasRequiredProperties(preset, ['id', 'name', 'urls', 'theme']))) {
            return false;
        }
        presetValidator.validateProperty(preset, 'id', isNonEmptyString, preset);
        presetValidator.validateProperty(preset, 'name', isNonEmptyString, preset);
        presetValidator.validateProperty(preset, 'urls', isNonEmptyArrayOfNonEmptyStrings, preset);
        presetValidator.validateProperty(preset, 'theme', isValidPresetTheme, preset);
        return presetValidator.errors.length === 0;
    });

    validateProperty(settings, 'customThemes', isArray, DEFAULT_SETTINGS);
    validateArray(settings, 'customThemes', (custom: CustomSiteConfig) => {
        if (!(isPlainObject(custom) && hasRequiredProperties(custom, ['url', 'theme']))) {
            return false;
        }
        const presetValidator = createValidator();
        presetValidator.validateProperty(custom, 'url', isNonEmptyArrayOfNonEmptyStrings, custom);
        presetValidator.validateProperty(custom, 'theme', isValidPresetTheme, custom);
        return presetValidator.errors.length === 0;
    });

    validateProperty(settings, 'enabledFor', isArray, DEFAULT_SETTINGS);
    validateArray(settings, 'enabledFor', isNonEmptyString);
    validateProperty(settings, 'disabledFor', isArray, DEFAULT_SETTINGS);
    validateArray(settings, 'disabledFor', isNonEmptyString);

    validateProperty(settings, 'enabledByDefault', isBoolean, DEFAULT_SETTINGS);
    validateProperty(settings, 'changeBrowserTheme', isBoolean, DEFAULT_SETTINGS);
    validateProperty(settings, 'syncSettings', isBoolean, DEFAULT_SETTINGS);
    validateProperty(settings, 'syncSitesFixes', isBoolean, DEFAULT_SETTINGS);
    validateProperty(settings, 'automation', (automation: Automation) => {
        if (!isPlainObject(automation)) {
            return false;
        }

        const automationValidator = createValidator();
        automationValidator.validateProperty(automation, 'enabled', isBoolean, automation);
        automationValidator.validateProperty(automation, 'mode', isOneOf(AutomationMode.SYSTEM, AutomationMode.TIME, AutomationMode.LOCATION, AutomationMode.NONE), automation);
        automationValidator.validateProperty(automation, 'behavior', isOneOf('OnOff', 'Scheme'), automation);
        return automationValidator.errors.length === 0;
    }, DEFAULT_SETTINGS);

    validateProperty(settings, AutomationMode.TIME, (time: TimeSettings) => {
        if (!isPlainObject(time)) {
            return false;
        }
        const timeValidator = createValidator();
        timeValidator.validateProperty(time, 'activation', isTime, time);
        timeValidator.validateProperty(time, 'deactivation', isTime, time);
        return timeValidator.errors.length === 0;
    }, DEFAULT_SETTINGS);

    validateProperty(settings, AutomationMode.LOCATION, (location: LocationSettings) => {
        if (!isPlainObject(location)) {
            return false;
        }
        const locValidator = createValidator();
        const isValidLoc = (x: any) => x === null || isNumber(x);
        locValidator.validateProperty(location, 'latitude', isValidLoc, location);
        locValidator.validateProperty(location, 'longitude', isValidLoc, location);
        return locValidator.errors.length === 0;
    }, DEFAULT_SETTINGS);

    validateProperty(settings, 'previewNewDesign', isBoolean, DEFAULT_SETTINGS);
    validateProperty(settings, 'previewNewestDesign', isBoolean, DEFAULT_SETTINGS);
    validateProperty(settings, 'enableForPDF', isBoolean, DEFAULT_SETTINGS);
    validateProperty(settings, 'enableForProtectedPages', isBoolean, DEFAULT_SETTINGS);
    validateProperty(settings, 'enableContextMenus', isBoolean, DEFAULT_SETTINGS);
    validateProperty(settings, 'detectDarkTheme', isBoolean, DEFAULT_SETTINGS);

    return {errors, settings};
}

interface ThemeValidationResult {
    theme: Partial<Theme>;
    errors: string[];
}

export function validateTheme(theme: Partial<Theme> | null | undefined): ThemeValidationResult {
    if (!isPlainObject(theme)) {
        return {errors: ['Theme is not a plain object'], theme: DEFAULT_THEME};
    }

    const {validateProperty, errors} = createValidator();
    validateProperty(theme, 'mode', isOneOf(0, 1), DEFAULT_THEME);
    validateProperty(theme, 'brightness', isNumberBetween(0, 200), DEFAULT_THEME);
    validateProperty(theme, 'contrast', isNumberBetween(0, 200), DEFAULT_THEME);
    validateProperty(theme, 'grayscale', isNumberBetween(0, 100), DEFAULT_THEME);
    validateProperty(theme, 'sepia', isNumberBetween(0, 100), DEFAULT_THEME);
    validateProperty(theme, 'useFont', isBoolean, DEFAULT_THEME);
    validateProperty(theme, 'fontFamily', isNonEmptyString, DEFAULT_THEME);
    validateProperty(theme, 'textStroke', isNumberBetween(0, 1), DEFAULT_THEME);
    validateProperty(theme, 'engine', isOneOf('dynamicTheme', 'staticTheme', 'cssFilter', 'svgFilter'), DEFAULT_THEME);
    validateProperty(theme, 'stylesheet', isString, DEFAULT_THEME);
    validateProperty(theme, 'darkSchemeBackgroundColor', isRegExpMatch(/^#[0-9a-f]{6}$/i), DEFAULT_THEME);
    validateProperty(theme, 'darkSchemeTextColor', isRegExpMatch(/^#[0-9a-f]{6}$/i), DEFAULT_THEME);
    validateProperty(theme, 'lightSchemeBackgroundColor', isRegExpMatch(/^#[0-9a-f]{6}$/i), DEFAULT_THEME);
    validateProperty(theme, 'lightSchemeTextColor', isRegExpMatch(/^#[0-9a-f]{6}$/i), DEFAULT_THEME);
    validateProperty(theme, 'scrollbarColor', (x: any) => x === '' || isRegExpMatch(/^(auto)|(#[0-9a-f]{6})$/i)(x), DEFAULT_THEME);
    validateProperty(theme, 'selectionColor', isRegExpMatch(/^(auto)|(#[0-9a-f]{6})$/i), DEFAULT_THEME);
    validateProperty(theme, 'styleSystemControls', isBoolean, DEFAULT_THEME);
    validateProperty(theme, 'lightColorScheme', isNonEmptyString, DEFAULT_THEME);
    validateProperty(theme, 'darkColorScheme', isNonEmptyString, DEFAULT_THEME);
    validateProperty(theme, 'immediateModify', isBoolean, DEFAULT_THEME);

    return {errors, theme};
}

```

### _locales\en-GB.config

```
@extension_description
Dark mode for every website. Take care of your eyes, use dark theme for night and daily browsing.

@loading_please_wait
Loading, please wait

@on
On

@off
Off

@toggle_current_site
Toggle current site

@setup_hotkey_toggle_site
Setup current site
toggle hotkey

@toggle_extension
Toggle extension

@setup_hotkey_toggle_extension
Setup extension
toggle hotkey

@automation
Automation

@set_active_hours
Set active hours

@set_location
Activate after sunset at location

@longitude
Longitude

@latitude
Latitude

@page_protected
This page is protected
by browser

@local_files_forbidden
Not allowed to access
local files

@page_in_dark_list
This site is in global
Dark List

@system_dark_mode
Use system colour scheme

@system_dark_mode_description
Activate when system dark mode is on

@system_dark_mode_chromium_warning
This option might not work due to
a bug in your browser

@filter
Filter

@mode
Mode

@dark
Dark

@light
Light

@brightness
Brightness

@contrast
Contrast

@grayscale
Grayscale

@sepia
Sepia

@only_for
Only for

@only_for_description
Apply settings to current website only

@site_list
Site list

@invert_listed_only
Invert listed only

@not_invert_listed
Not invert listed

@add_site_to_list
Add site to list

@setup_add_site_hotkey
Setup a hotkey for adding site

@more
More

@select_font
Select a font

@text_stroke
Text stroke

@try_experimental_theme_engines
Try out **experimental** theme engines:
**Filter+** preserves colours saturation, uses GPU
**Static theme** generates a simple fast theme
**Dynamic theme** analyzes colours and images

@engine_filter
Filter

@engine_filter_plus
Filter+

@engine_static
Static

@engine_dynamic
Dynamic

@theme_generation_mode
Theme generation mode

@custom_browser_theme_on
Custom

@custom_browser_theme_off
Default

@change_browser_theme
Change the browser theme

@privacy
Privacy

@help
Help

@donate
Donate

@we_celebrate_10_years
Dark Reader celebrates 10 years.
Please support our work.

@pay_for_using
Pay for using Dark Reader

@news
News

@read_more
Read more

@open_dev_tools
Dev tools

@mobile
Mobile

@learn_more
Learn more

@mobile_text
Reduce eye strain when reading on your phone or tablet.
Simply scan the QR code to install.

@all_settings
All settings

@version
Version

@configure_automation
Configure automation

@auto_night_time
Auto (nighttime)

@auto_day_time
Auto (daytime)

@auto_night_at_location
Auto (night at location)

@auto_day_at_location
Auto (day at location)

@auto_system_is_dark
Auto (the system is dark)

@auto_system_is_light
Auto (the system is light)

@click_to_set_shortcut
Click to set the shortcut

@extension_toggle_shortcut
Extension on/off keyboard shortcut

@configure_site_toggle
Configure website toggling

@site_toggle
Site Toggling

@enabled_by_default
Enabled by Default

@enable_for_all_sites_by_default
Enabled for all websites by default

@detect_dark_theme
Detect dark theme

@detect_website_dark_theme
Detect the website's dark theme

@dark_theme_detected
Dark theme detected

@website_toggle_shortcut
Website toggle keyboard shortcut

@support_out_work
Support our work

@mobile_link
Mobile Dark Reader is available. Learn more

@store_listing
This eye-care extension enables night mode by creating dark themes for websites on the fly. Dark Reader inverts bright colours, making them high contrast and easy to read at night.

You can adjust the brightness, contrast, sepia filter, dark mode, font settings, and the ignore list.

We may ask you to support the app's development with a donation. You may see news about Dark Reader in the settings popup. There are Developer Tools for experienced users.

Dark Reader doesn't show ads or send users' data anywhere. It's fully open source: https://github.com/darkreader/darkreader

Before you install it, disable similar extensions. Enjoy watching!

```

### _locales\en-US.config

```
@extension_description
Dark mode for every website. Take care of your eyes, use dark theme for night and daily browsing.

@loading_please_wait
Loading, please wait

@on
On

@off
Off

@toggle_current_site
Toggle current site

@setup_hotkey_toggle_site
Setup current site
toggle hotkey

@toggle_extension
Toggle extension

@setup_hotkey_toggle_extension
Setup extension
toggle hotkey

@automation
Automation

@set_active_hours
Set active hours

@set_location
Activate after sunset at location

@longitude
Longitude

@latitude
Latitude

@page_protected
This page is protected
by browser

@local_files_forbidden
Not allowed to access
local files

@page_in_dark_list
This site is in global
Dark List

@system_dark_mode
Use system color scheme

@system_dark_mode_description
Activate when system dark mode is on

@system_dark_mode_chromium_warning
This option might not work due to
a bug in your browser

@filter
Filter

@mode
Mode

@dark
Dark

@light
Light

@brightness
Brightness

@contrast
Contrast

@grayscale
Grayscale

@sepia
Sepia

@only_for
Only for

@only_for_description
Apply settings to current website only

@site_list
Site list

@invert_listed_only
Invert listed only

@not_invert_listed
Not invert listed

@add_site_to_list
Add site to list

@setup_add_site_hotkey
Setup a hotkey for adding site

@more
More

@select_font
Select a font

@text_stroke
Text stroke

@try_experimental_theme_engines
Try out **experimental** theme engines:
**Filter+** preserves colors saturation, uses GPU
**Static theme** generates a simple fast theme
**Dynamic theme** analyzes colors and images

@engine_filter
Filter

@engine_filter_plus
Filter+

@engine_static
Static

@engine_dynamic
Dynamic

@theme_generation_mode
Theme generation mode

@custom_browser_theme_on
Custom

@custom_browser_theme_off
Default

@change_browser_theme
Change the browser theme

@privacy
Privacy

@help
Help

@donate
Donate

@we_celebrate_10_years
Dark Reader celebrates 10 years.
Please support our work.

@pay_for_using
Pay for using Dark Reader

@news
News

@read_more
Read more

@open_dev_tools
Dev tools

@mobile
Mobile

@learn_more
Learn more

@mobile_text
Reduce eye strain when reading on your phone or tablet.
Simply scan the QR code to install.

@all_settings
All settings

@version
Version

@configure_automation
Configure automation

@auto_night_time
Auto (nighttime)

@auto_day_time
Auto (daytime)

@auto_night_at_location
Auto (night at location)

@auto_day_at_location
Auto (day at location)

@auto_system_is_dark
Auto (the system is dark)

@auto_system_is_light
Auto (the system is light)

@click_to_set_shortcut
Click to set the shortcut

@extension_toggle_shortcut
Extension on/off keyboard shortcut

@configure_site_toggle
Configure website toggling

@site_toggle
Site Toggling

@enabled_by_default
Enabled by Default

@enable_for_all_sites_by_default
Enabled for all websites by default

@detect_dark_theme
Detect dark theme

@detect_website_dark_theme
Detect the website's dark theme

@dark_theme_detected
Dark theme detected

@website_toggle_shortcut
Website toggle keyboard shortcut

@support_out_work
Support our work

@mobile_link
Mobile Dark Reader is available. Learn more

@store_listing
This eye-care extension enables night mode by creating dark themes for websites on the fly. Dark Reader inverts bright colors, making them high contrast and easy to read at night.

You can adjust the brightness, contrast, sepia filter, dark mode, font settings, and the ignore list.

We may ask you to support the app's development with a donation. You may see news about Dark Reader in the settings popup. There are Developer Tools for experienced users.

Dark Reader doesn't show ads or send users' data anywhere. It's fully open source: https://github.com/darkreader/darkreader

Before you install it, disable similar extensions. Enjoy watching!

```

### _locales\en.config

```
@extension_description
Dark mode for every website. Take care of your eyes, use dark theme for night and daily browsing.

@loading_please_wait
Loading, please wait

@on
On

@off
Off

@toggle_current_site
Toggle current site

@setup_hotkey_toggle_site
Setup current site
toggle hotkey

@toggle_extension
Toggle extension

@setup_hotkey_toggle_extension
Setup extension
toggle hotkey

@automation
Automation

@set_active_hours
Set active hours

@set_location
Activate after sunset at location

@longitude
Longitude

@latitude
Latitude

@page_protected
This page is protected
by browser

@local_files_forbidden
Not allowed to access
local files

@page_in_dark_list
This site is in global
Dark List

@system_dark_mode
Use system color scheme

@system_dark_mode_description
Activate when system dark mode is on

@system_dark_mode_chromium_warning
This option might not work due to
a bug in your browser

@filter
Filter

@mode
Mode

@dark
Dark

@light
Light

@brightness
Brightness

@contrast
Contrast

@grayscale
Grayscale

@sepia
Sepia

@only_for
Only for

@only_for_description
Apply settings to current website only

@site_list
Site list

@invert_listed_only
Invert listed only

@not_invert_listed
Not invert listed

@add_site_to_list
Add site to list

@setup_add_site_hotkey
Setup a hotkey for adding site

@more
More

@select_font
Select a font

@text_stroke
Text stroke

@try_experimental_theme_engines
Try out **experimental** theme engines:
**Filter+** preserves colors saturation, uses GPU
**Static theme** generates a simple fast theme
**Dynamic theme** analyzes colors and images

@engine_filter
Filter

@engine_filter_plus
Filter+

@engine_static
Static

@engine_dynamic
Dynamic

@theme_generation_mode
Theme generation mode

@custom_browser_theme_on
Custom

@custom_browser_theme_off
Default

@change_browser_theme
Change the browser theme

@privacy
Privacy

@help
Help

@donate
Donate

@we_celebrate_10_years
Dark Reader celebrates 10 years.
Please support our work.

@pay_for_using
Pay for using Dark Reader

@news
News

@read_more
Read more

@open_dev_tools
Dev tools

@mobile
Mobile

@learn_more
Learn more

@mobile_text
Reduce eye strain when reading on your phone or tablet.
Simply scan the QR code to install.

@all_settings
All settings

@version
Version

@configure_automation
Configure automation

@auto_night_time
Auto (nighttime)

@auto_day_time
Auto (daytime)

@auto_night_at_location
Auto (night at location)

@auto_day_at_location
Auto (day at location)

@auto_system_is_dark
Auto (the system is dark)

@auto_system_is_light
Auto (the system is light)

@click_to_set_shortcut
Click to set the shortcut

@extension_toggle_shortcut
Extension on/off keyboard shortcut

@configure_site_toggle
Configure website toggling

@site_toggle
Site Toggling

@enabled_by_default
Enabled by Default

@enable_for_all_sites_by_default
Enabled for all websites by default

@detect_dark_theme
Detect dark theme

@detect_website_dark_theme
Detect the website's dark theme

@dark_theme_detected
Dark theme detected

@website_toggle_shortcut
Website toggle keyboard shortcut

@support_out_work
Support our work

@mobile_link
Mobile Dark Reader is available. Learn more

@store_listing
This eye-care extension enables night mode by creating dark themes for websites on the fly. Dark Reader inverts bright colors, making them high contrast and easy to read at night.

You can adjust the brightness, contrast, sepia filter, dark mode, font settings, and the ignore list.

We may ask you to support the app's development with a donation. You may see news about Dark Reader in the settings popup. There are Developer Tools for experienced users.

Dark Reader doesn't show ads or send users' data anywhere. It's fully open source: https://github.com/darkreader/darkreader

Before you install it, disable similar extensions. Enjoy watching!

```

### tsconfig.json

```
{
    "compilerOptions": {
        "target": "ES2019",
        "baseUrl": "./",
        "module": "ES2015",
        "moduleResolution": "node",
        "lib": [
            "ES2022",
            "Dom",
            "DOM.Iterable"
        ],
        "types": [
            "chrome"
        ],
        "allowJs": true,
        "downlevelIteration": true,
        "noImplicitAny": true,
        "noUnusedLocals": true,
        "resolveJsonModule": true,
        "strictNullChecks": true,
        "jsx": "react",
        "jsxFactory": "m",
        "noEmit": true,
        "paths": {
            "@plus/*": ["./stubs/*"]
        }
    }
}

```

### manifest.json

```
{
    "manifest_version": 2,
    "name": "Dark Reader",
    "version": "4.9.106",
    "author": "Alexander Shutau",
    "description": "__MSG_extension_description__",
    "default_locale": "en",
    "browser_action": {
        "default_title": "Dark Reader",
        "default_icon": {
            "38": "icons/dr_active_38.png",
            "19": "icons/dr_active_19.png"
        },
        "default_popup": "ui/popup/index.html"
    },
    "icons": {
        "16": "icons/dr_16.png",
        "48": "icons/dr_48.png",
        "128": "icons/dr_128.png"
    },
    "background": {
        "persistent": true,
        "page": "background/index.html"
    },
    "content_scripts": [
        {
            "matches": [
                "<all_urls>"
            ],
            "js": [
                "inject/fallback.js",
                "inject/index.js"
            ],
            "run_at": "document_start",
            "all_frames": true,
            "match_about_blank": true
        }
    ],
    "permissions": [
        "alarms",
        "fontSettings",
        "storage",
        "tabs",
        "<all_urls>"
    ],
    "optional_permissions": [
        "contextMenus"
    ],
    "commands": {
        "toggle": {
            "suggested_key": {
                "default": "Alt+Shift+D"
            },
            "description": "__MSG_toggle_extension__"
        },
        "addSite": {
            "suggested_key": {
                "default": "Alt+Shift+A"
            },
            "description": "__MSG_toggle_current_site__"
        },
        "switchEngine": {
            "description": "__MSG_theme_generation_mode__"
        }
    }
}

```

### manifest-chrome-mv3.json

```
{
    "manifest_version": 3,
    "minimum_chrome_version": "106.0.0.0",
    "action": {
        "default_title": "Dark Reader",
        "default_icon": {
            "38": "icons/dr_active_38.png",
            "19": "icons/dr_active_19.png"
        },
        "default_popup": "ui/popup/index.html"
    },
    "options_ui": {
        "page": "ui/popup/index.html"
    },
    "background": {
        "service_worker": "background/index.js"
    },
    "content_security_policy": {
        "extension_pages": "default-src 'none'; script-src 'self'; style-src 'self'; img-src * data:; connect-src *; navigate-to 'self' https://darkreader.org/* https://github.com/darkreader/darkreader/blob/main/CONTRIBUTING.md https://github.com/darkreader/darkreader https://twitter.com/darkreaderapp; media-src 'none'; child-src 'none'; worker-src 'none'; object-src 'none'"
    },
    "content_scripts": [
        {
            "matches": [
                "<all_urls>"
            ],
            "js": [
                "inject/proxy.js"
            ],
            "run_at": "document_start",
            "all_frames": true,
            "match_about_blank": true,
            "world": "MAIN"
        },
        {
            "matches": [
                "<all_urls>"
            ],
            "js": [
                "inject/fallback.js",
                "inject/index.js"
            ],
            "run_at": "document_start",
            "all_frames": true,
            "match_about_blank": true,
            "world": "ISOLATED"
        },
        {
            "matches": [
                "<all_urls>"
            ],
            "js": [
                "inject/color-scheme-watcher.js"
            ],
            "run_at": "document_idle",
            "all_frames": false,
            "match_about_blank": false,
            "world": "ISOLATED"
        }
    ],
    "permissions": [
        "alarms",
        "fontSettings",
        "scripting",
        "storage"
    ],
    "host_permissions": [
        "*://*/*"
    ]
}

```

### definitions.d.ts

```
import type {FilterMode} from './generators/css-filter';
import type {ThemeEngine} from './generators/theme-engines';
import type {AutomationMode} from './utils/automation';
import type {ParsedColorSchemeConfig} from './utils/colorscheme-parser';
import type {DebugMessageTypeBGtoCS, DebugMessageTypeBGtoUI, DebugMessageTypeCStoBG, MessageTypeBGtoCS, MessageTypeBGtoUI, MessageTypeCStoBG, MessageTypeCStoUI, MessageTypeUItoBG, MessageTypeUItoCS} from './utils/message';

export type ColorScheme = 'dark' | 'light';

export interface ExtensionData {
    isEnabled: boolean;
    isReady: boolean;
    isAllowedFileSchemeAccess: boolean;
    settings: UserSettings;
    news: News[];
    shortcuts: Shortcuts;
    colorScheme: ParsedColorSchemeConfig;
    forcedScheme: 'dark' | 'light' | null;
    activeTab: TabInfo;
    uiHighlights: string[];
}

export interface DevToolsData {
    dynamicFixesText: string;
    filterFixesText: string;
    staticThemesText: string;
}

export interface TabData {
    type: MessageTypeBGtoCS;
    data?: any;
}

export interface ExtensionActions {
    changeSettings(settings: Partial<UserSettings>): void;
    setTheme(theme: Partial<Theme>): void;
    setShortcut(command: string, shortcut: string): Promise<string | null>;
    toggleActiveTab(): void;
    markNewsAsRead(ids: string[]): void;
    markNewsAsDisplayed(ids: string[]): void;
    loadConfig(options: {local: boolean}): void;
    applyDevDynamicThemeFixes(text: string): Promise<void>;
    resetDevDynamicThemeFixes(): void;
    applyDevInversionFixes(text: string): Promise<void>;
    resetDevInversionFixes(): void;
    applyDevStaticThemes(text: string): Promise<void>;
    resetDevStaticThemes(): void;
    hideHighlights(ids: string[]): void;
}

export interface ExtWrapper {
    data: ExtensionData;
    actions: ExtensionActions;
}

export type ViewProps = ExtWrapper & {
    fonts?: string[];
};

export interface Theme {
    mode: FilterMode;
    brightness: number;
    contrast: number;
    grayscale: number;
    sepia: number;
    useFont: boolean;
    fontFamily: string;
    textStroke: number;
    engine: ThemeEngine;
    stylesheet: string;
    darkSchemeBackgroundColor: string;
    darkSchemeTextColor: string;
    lightSchemeBackgroundColor: string;
    lightSchemeTextColor: string;
    scrollbarColor: '' | 'auto' | string;
    selectionColor: '' | 'auto' | string;
    styleSystemControls: boolean;
    lightColorScheme: string;
    darkColorScheme: string;
    immediateModify: boolean;
}

export interface CustomSiteConfig {
    url: string[];
    theme: Theme;
    builtIn?: boolean;
}

export interface ThemePreset {
    id: string;
    name: string;
    urls: string[];
    theme: Theme;
}

export interface Automation {
    enabled: boolean;
    mode: AutomationMode;
    behavior: 'OnOff' | 'Scheme';
}

export interface UserSettings {
    schemeVersion: number;
    enabled: boolean;
    fetchNews: boolean;
    theme: Theme;
    presets: ThemePreset[];
    customThemes: CustomSiteConfig[];
    enabledByDefault: boolean;
    enabledFor: string[];
    disabledFor: string[];
    changeBrowserTheme: boolean;
    syncSettings: boolean;
    syncSitesFixes: boolean;
    automation: Automation;
    time: TimeSettings;
    location: LocationSettings;
    previewNewDesign: boolean;
    previewNewestDesign: boolean;
    enableForPDF: boolean;
    enableForProtectedPages: boolean;
    enableContextMenus: boolean;
    detectDarkTheme: boolean;
}

export interface TimeSettings {
    activation: string;
    deactivation: string;
}

export interface LocationSettings {
    latitude: number | null;
    longitude: number | null;
}

export interface TabInfo {
    url: string;
    id: number | null;
    documentId: string | null;
    isProtected: boolean;
    isInjected: boolean | null;
    isInDarkList: boolean;
    isDarkThemeDetected: boolean | null;
}

export interface MessageCStoBG {
    id?: string;
    scriptId?: string;
    type: MessageTypeCStoBG;
    data?: any;
}

export interface MessageUItoCS {
    type: MessageTypeUItoCS;
}

export interface MessageCStoUI {
    type: MessageTypeCStoUI;
    data: any;
}

export interface MessageBGtoCS {
    id?: string;
    scriptId?: string;
    type: MessageTypeBGtoCS;
    data?: any;
    error?: any;
}

export interface MessageUItoBG {
    type: MessageTypeUItoBG;
    data?: any;
    error?: any;
}

export interface MessageBGtoUI {
    type: MessageTypeBGtoUI;
    data?: any;
}

export interface DebugMessageBGtoCS {
    type: DebugMessageTypeBGtoCS;
}

export interface DebugMessageBGtoUI {
    type: DebugMessageTypeBGtoUI;
}

export interface DebugMessageCStoBG {
    type: DebugMessageTypeCStoBG;
    data?: any;
}

export interface Shortcuts {
    [name: string]: string;
}

export interface DynamicThemeFix {
    url: string[];
    invert: string[];
    css: string;
    ignoreInlineStyle: string[];
    ignoreImageAnalysis: string[];
    disableStyleSheetsProxy: boolean;
    disableCustomElementRegistryProxy: boolean;
}

export interface InversionFix {
    url: string[];
    invert: string[];
    noinvert: string[];
    removebg: string[];
    css: string;
}

export interface DetectorHint {
    url: string[];
    target: string;
    match: string[];
    noDarkTheme: boolean;
    systemTheme: boolean;
    iframe: boolean;
}

export interface StaticTheme {
    url: string[];
    neutralBg?: string[];
    neutralBgActive?: string[];
    neutralText?: string[];
    neutralTextActive?: string[];
    neutralBorder?: string[];
    redBg?: string[];
    redBgActive?: string[];
    redText?: string[];
    redTextActive?: string[];
    redBorder?: string[];
    greenBg?: string[];
    greenBgActive?: string[];
    greenText?: string[];
    greenTextActive?: string[];
    greenBorder?: string[];
    blueBg?: string[];
    blueBgActive?: string[];
    blueText?: string[];
    blueTextActive?: string[];
    blueBorder?: string[];
    fadeBg?: string[];
    fadeText?: string[];
    transparentBg?: string[];
    noImage?: string[];
    invert?: string[];
    noCommon?: boolean;
}

export interface News {
    id: string;
    date: string;
    url: string;
    headline: string;
    read?: boolean;
    displayed?: boolean;
    badge?: string;
    icon?: string;
}

// These values need to match those in Manifest
export type Command = 'toggle' | 'addSite' | 'switchEngine';

```

### defaults.ts

```
import {extendThemeDefaults} from '@plus/defaults';
import type {Theme, UserSettings} from './definitions';
import {ThemeEngine} from './generators/theme-engines';
import {AutomationMode} from './utils/automation';
import type {ParsedColorSchemeConfig} from './utils/colorscheme-parser';
import {isMacOS, isWindows, isCSSColorSchemePropSupported, isEdge, isMobile} from './utils/platform';

declare const __CHROMIUM_MV3__: boolean;
declare const __PLUS__: boolean;

export const DEFAULT_COLORS = {
    darkScheme: {
        background: '#181a1b',
        text: '#e8e6e3',
    },
    lightScheme: {
        background: '#dcdad7',
        text: '#181a1b',
    },
};

export const DEFAULT_THEME: Theme = {
    mode: 1,
    brightness: 100,
    contrast: 100,
    grayscale: 0,
    sepia: 0,
    useFont: false,
    fontFamily: isMacOS ? 'Helvetica Neue' : isWindows ? 'Segoe UI' : 'Open Sans',
    textStroke: 0,
    engine: ThemeEngine.dynamicTheme,
    stylesheet: '',
    darkSchemeBackgroundColor: DEFAULT_COLORS.darkScheme.background,
    darkSchemeTextColor: DEFAULT_COLORS.darkScheme.text,
    lightSchemeBackgroundColor: DEFAULT_COLORS.lightScheme.background,
    lightSchemeTextColor: DEFAULT_COLORS.lightScheme.text,
    scrollbarColor: '',
    selectionColor: 'auto',
    styleSystemControls: __CHROMIUM_MV3__ ? false : !isCSSColorSchemePropSupported,
    lightColorScheme: 'Default',
    darkColorScheme: 'Default',
    immediateModify: false,
};

if (__PLUS__) {
    extendThemeDefaults(DEFAULT_THEME);
}

export const DEFAULT_COLORSCHEME: ParsedColorSchemeConfig = {
    light: {
        Default: {
            backgroundColor: DEFAULT_COLORS.lightScheme.background,
            textColor: DEFAULT_COLORS.lightScheme.text,
        },
    },
    dark: {
        Default: {
            backgroundColor: DEFAULT_COLORS.darkScheme.background,
            textColor: DEFAULT_COLORS.darkScheme.text,
        },
    },
};

const filterModeSites = [
    '*.officeapps.live.com',
    '*.sharepoint.com',
    'docs.google.com',
    'onedrive.live.com',
];

export const DEFAULT_SETTINGS: UserSettings = {
    schemeVersion: 0,
    enabled: true,
    fetchNews: true,
    theme: DEFAULT_THEME,
    presets: [],
    customThemes: filterModeSites.map((url) => {
        const engine: ThemeEngine = ThemeEngine.cssFilter;
        return {
            url: [url],
            theme: {...DEFAULT_THEME, engine},
            builtIn: true,
        };
    }),
    enabledByDefault: true,
    enabledFor: [],
    disabledFor: [],
    changeBrowserTheme: false,
    syncSettings: true,
    syncSitesFixes: false,
    automation: {
        enabled: isEdge && isMobile ? true : false,
        mode: isEdge && isMobile ? AutomationMode.SYSTEM : AutomationMode.NONE,
        behavior: 'OnOff',
    },
    time: {
        activation: '18:00',
        deactivation: '9:00',
    },
    location: {
        latitude: null,
        longitude: null,
    },
    previewNewDesign: false,
    previewNewestDesign: false,
    enableForPDF: true,
    enableForProtectedPages: false,
    enableContextMenus: false,
    detectDarkTheme: true,
};

```
